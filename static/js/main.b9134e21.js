/*! For license information please see main.b9134e21.js.LICENSE.txt */
(()=>{var e={446:(e,t,n)=>{var i=/^\s+|\s+$/g,r=/^[-+]0x[0-9a-f]+$/i,s=/^0b[01]+$/i,a=/^0o[0-7]+$/i,o=parseInt,l="object"==typeof n.g&&n.g&&n.g.Object===Object&&n.g,c="object"==typeof self&&self&&self.Object===Object&&self,h=l||c||Function("return this")(),u=Object.prototype.toString,d=Math.max,p=Math.min,f=function(){return h.Date.now()};function m(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}function g(e){if("number"==typeof e)return e;if(function(e){return"symbol"==typeof e||function(e){return!!e&&"object"==typeof e}(e)&&"[object Symbol]"==u.call(e)}(e))return NaN;if(m(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=m(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=e.replace(i,"");var n=s.test(e);return n||a.test(e)?o(e.slice(2),n?2:8):r.test(e)?NaN:+e}e.exports=function(e,t,n){var i,r,s,a,o,l,c=0,h=!1,u=!1,v=!0;if("function"!=typeof e)throw new TypeError("Expected a function");function y(t){var n=i,s=r;return i=r=void 0,c=t,a=e.apply(s,n)}function b(e){var n=e-l;return void 0===l||n>=t||n<0||u&&e-c>=s}function x(){var e=f();if(b(e))return w(e);o=setTimeout(x,function(e){var n=t-(e-l);return u?p(n,s-(e-c)):n}(e))}function w(e){return o=void 0,v&&i?y(e):(i=r=void 0,a)}function S(){var e=f(),n=b(e);if(i=arguments,r=this,l=e,n){if(void 0===o)return function(e){return c=e,o=setTimeout(x,t),h?y(e):a}(l);if(u)return o=setTimeout(x,t),y(l)}return void 0===o&&(o=setTimeout(x,t)),a}return t=g(t)||0,m(n)&&(h=!!n.leading,s=(u="maxWait"in n)?d(g(n.maxWait)||0,t):s,v="trailing"in n?!!n.trailing:v),S.cancel=function(){void 0!==o&&clearTimeout(o),c=0,i=l=r=o=void 0},S.flush=function(){return void 0===o?a:w(f())},S}},4:(e,t,n)=>{"use strict";var i=n(67),r=n(43),s=n(950);function a(e){var t="https://react.dev/errors/"+e;if(1<arguments.length){t+="?args[]="+encodeURIComponent(arguments[1]);for(var n=2;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n])}return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function o(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType)}var l=Symbol.for("react.element"),c=Symbol.for("react.transitional.element"),h=Symbol.for("react.portal"),u=Symbol.for("react.fragment"),d=Symbol.for("react.strict_mode"),p=Symbol.for("react.profiler"),f=Symbol.for("react.provider"),m=Symbol.for("react.consumer"),g=Symbol.for("react.context"),v=Symbol.for("react.forward_ref"),y=Symbol.for("react.suspense"),b=Symbol.for("react.suspense_list"),x=Symbol.for("react.memo"),w=Symbol.for("react.lazy");Symbol.for("react.scope"),Symbol.for("react.debug_trace_mode");var S=Symbol.for("react.offscreen");Symbol.for("react.legacy_hidden"),Symbol.for("react.tracing_marker");var _=Symbol.for("react.memo_cache_sentinel"),E=Symbol.iterator;function A(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=E&&e[E]||e["@@iterator"])?e:null}var C=Symbol.for("react.client.reference");function M(e){if(null==e)return null;if("function"===typeof e)return e.$$typeof===C?null:e.displayName||e.name||null;if("string"===typeof e)return e;switch(e){case u:return"Fragment";case h:return"Portal";case p:return"Profiler";case d:return"StrictMode";case y:return"Suspense";case b:return"SuspenseList"}if("object"===typeof e)switch(e.$$typeof){case g:return(e.displayName||"Context")+".Provider";case m:return(e._context.displayName||"Context")+".Consumer";case v:var t=e.render;return(e=e.displayName)||(e=""!==(e=t.displayName||t.name||"")?"ForwardRef("+e+")":"ForwardRef"),e;case x:return null!==(t=e.displayName||null)?t:M(e.type)||"Memo";case w:t=e._payload,e=e._init;try{return M(e(t))}catch(n){}}return null}var T,P,D=r.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,O=Object.assign;function I(e){if(void 0===T)try{throw Error()}catch(n){var t=n.stack.trim().match(/\n( *(at )?)/);T=t&&t[1]||"",P=-1<n.stack.indexOf("\n    at")?" (<anonymous>)":-1<n.stack.indexOf("@")?"@unknown:0:0":""}return"\n"+T+e+P}var R=!1;function k(e,t){if(!e||R)return"";R=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var i={DetermineComponentFrameRoot:function(){try{if(t){var n=function(){throw Error()};if(Object.defineProperty(n.prototype,"props",{set:function(){throw Error()}}),"object"===typeof Reflect&&Reflect.construct){try{Reflect.construct(n,[])}catch(r){var i=r}Reflect.construct(e,[],n)}else{try{n.call()}catch(s){i=s}e.call(n.prototype)}}else{try{throw Error()}catch(a){i=a}(n=e())&&"function"===typeof n.catch&&n.catch((function(){}))}}catch(o){if(o&&i&&"string"===typeof o.stack)return[o.stack,i.stack]}return[null,null]}};i.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var r=Object.getOwnPropertyDescriptor(i.DetermineComponentFrameRoot,"name");r&&r.configurable&&Object.defineProperty(i.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var s=i.DetermineComponentFrameRoot(),a=s[0],o=s[1];if(a&&o){var l=a.split("\n"),c=o.split("\n");for(r=i=0;i<l.length&&!l[i].includes("DetermineComponentFrameRoot");)i++;for(;r<c.length&&!c[r].includes("DetermineComponentFrameRoot");)r++;if(i===l.length||r===c.length)for(i=l.length-1,r=c.length-1;1<=i&&0<=r&&l[i]!==c[r];)r--;for(;1<=i&&0<=r;i--,r--)if(l[i]!==c[r]){if(1!==i||1!==r)do{if(i--,0>--r||l[i]!==c[r]){var h="\n"+l[i].replace(" at new "," at ");return e.displayName&&h.includes("<anonymous>")&&(h=h.replace("<anonymous>",e.displayName)),h}}while(1<=i&&0<=r);break}}}finally{R=!1,Error.prepareStackTrace=n}return(n=e?e.displayName||e.name:"")?I(n):""}function L(e){switch(e.tag){case 26:case 27:case 5:return I(e.type);case 16:return I("Lazy");case 13:return I("Suspense");case 19:return I("SuspenseList");case 0:case 15:return e=k(e.type,!1);case 11:return e=k(e.type.render,!1);case 1:return e=k(e.type,!0);default:return""}}function B(e){try{var t="";do{t+=L(e),e=e.return}while(e);return t}catch(n){return"\nError generating stack: "+n.message+"\n"+n.stack}}function z(e){var t=e,n=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do{0!==(4098&(t=e).flags)&&(n=t.return),e=t.return}while(e)}return 3===t.tag?n:null}function N(e){if(13===e.tag){var t=e.memoizedState;if(null===t&&(null!==(e=e.alternate)&&(t=e.memoizedState)),null!==t)return t.dehydrated}return null}function F(e){if(z(e)!==e)throw Error(a(188))}function U(e){var t=e.tag;if(5===t||26===t||27===t||6===t)return e;for(e=e.child;null!==e;){if(null!==(t=U(e)))return t;e=e.sibling}return null}var j=Array.isArray,V=s.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,G={pending:!1,data:null,method:null,action:null},H=[],W=-1;function q(e){return{current:e}}function X(e){0>W||(e.current=H[W],H[W]=null,W--)}function Y(e,t){W++,H[W]=e.current,e.current=t}var Q=q(null),K=q(null),Z=q(null),J=q(null);function $(e,t){switch(Y(Z,t),Y(K,e),Y(Q,null),e=t.nodeType){case 9:case 11:t=(t=t.documentElement)&&(t=t.namespaceURI)?Kh(t):0;break;default:if(t=(e=8===e?t.parentNode:t).tagName,e=e.namespaceURI)t=Zh(e=Kh(e),t);else switch(t){case"svg":t=1;break;case"math":t=2;break;default:t=0}}X(Q),Y(Q,t)}function ee(){X(Q),X(K),X(Z)}function te(e){null!==e.memoizedState&&Y(J,e);var t=Q.current,n=Zh(t,e.type);t!==n&&(Y(K,e),Y(Q,n))}function ne(e){K.current===e&&(X(Q),X(K)),J.current===e&&(X(J),Bu._currentValue=G)}var ie=Object.prototype.hasOwnProperty,re=i.unstable_scheduleCallback,se=i.unstable_cancelCallback,ae=i.unstable_shouldYield,oe=i.unstable_requestPaint,le=i.unstable_now,ce=i.unstable_getCurrentPriorityLevel,he=i.unstable_ImmediatePriority,ue=i.unstable_UserBlockingPriority,de=i.unstable_NormalPriority,pe=i.unstable_LowPriority,fe=i.unstable_IdlePriority,me=i.log,ge=i.unstable_setDisableYieldValue,ve=null,ye=null;function be(e){if("function"===typeof me&&ge(e),ye&&"function"===typeof ye.setStrictMode)try{ye.setStrictMode(ve,e)}catch(t){}}var xe=Math.clz32?Math.clz32:function(e){return 0===(e>>>=0)?32:31-(we(e)/Se|0)|0},we=Math.log,Se=Math.LN2;var _e=128,Ee=4194304;function Ae(e){var t=42&e;if(0!==t)return t;switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return 4194176&e;case 4194304:case 8388608:case 16777216:case 33554432:return 62914560&e;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return e}}function Ce(e,t){var n=e.pendingLanes;if(0===n)return 0;var i=0,r=e.suspendedLanes,s=e.pingedLanes,a=e.warmLanes;e=0!==e.finishedLanes;var o=134217727&n;return 0!==o?0!==(n=o&~r)?i=Ae(n):0!==(s&=o)?i=Ae(s):e||0!==(a=o&~a)&&(i=Ae(a)):0!==(o=n&~r)?i=Ae(o):0!==s?i=Ae(s):e||0!==(a=n&~a)&&(i=Ae(a)),0===i?0:0!==t&&t!==i&&0===(t&r)&&((r=i&-i)>=(a=t&-t)||32===r&&0!==(4194176&a))?t:i}function Me(e,t){return 0===(e.pendingLanes&~(e.suspendedLanes&~e.pingedLanes)&t)}function Te(e,t){switch(e){case 1:case 2:case 4:case 8:return t+250;case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;default:return-1}}function Pe(){var e=_e;return 0===(4194176&(_e<<=1))&&(_e=128),e}function De(){var e=Ee;return 0===(62914560&(Ee<<=1))&&(Ee=4194304),e}function Oe(e){for(var t=[],n=0;31>n;n++)t.push(e);return t}function Ie(e,t){e.pendingLanes|=t,268435456!==t&&(e.suspendedLanes=0,e.pingedLanes=0,e.warmLanes=0)}function Re(e,t,n){e.pendingLanes|=t,e.suspendedLanes&=~t;var i=31-xe(t);e.entangledLanes|=t,e.entanglements[i]=1073741824|e.entanglements[i]|4194218&n}function ke(e,t){var n=e.entangledLanes|=t;for(e=e.entanglements;n;){var i=31-xe(n),r=1<<i;r&t|e[i]&t&&(e[i]|=t),n&=~r}}function Le(e){return 2<(e&=-e)?8<e?0!==(134217727&e)?32:268435456:8:2}function Be(){var e=V.p;return 0!==e?e:void 0===(e=window.event)?32:Zu(e.type)}var ze=Math.random().toString(36).slice(2),Ne="__reactFiber$"+ze,Fe="__reactProps$"+ze,Ue="__reactContainer$"+ze,je="__reactEvents$"+ze,Ve="__reactListeners$"+ze,Ge="__reactHandles$"+ze,He="__reactResources$"+ze,We="__reactMarker$"+ze;function qe(e){delete e[Ne],delete e[Fe],delete e[je],delete e[Ve],delete e[Ge]}function Xe(e){var t=e[Ne];if(t)return t;for(var n=e.parentNode;n;){if(t=n[Ue]||n[Ne]){if(n=t.alternate,null!==t.child||null!==n&&null!==n.child)for(e=lu(e);null!==e;){if(n=e[Ne])return n;e=lu(e)}return t}n=(e=n).parentNode}return null}function Ye(e){if(e=e[Ne]||e[Ue]){var t=e.tag;if(5===t||6===t||13===t||26===t||27===t||3===t)return e}return null}function Qe(e){var t=e.tag;if(5===t||26===t||27===t||6===t)return e.stateNode;throw Error(a(33))}function Ke(e){var t=e[He];return t||(t=e[He]={hoistableStyles:new Map,hoistableScripts:new Map}),t}function Ze(e){e[We]=!0}var Je=new Set,$e={};function et(e,t){tt(e,t),tt(e+"Capture",t)}function tt(e,t){for($e[e]=t,e=0;e<t.length;e++)Je.add(t[e])}var nt=!("undefined"===typeof window||"undefined"===typeof window.document||"undefined"===typeof window.document.createElement),it=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),rt={},st={};function at(e,t,n){if(r=t,ie.call(st,r)||!ie.call(rt,r)&&(it.test(r)?st[r]=!0:(rt[r]=!0,0)))if(null===n)e.removeAttribute(t);else{switch(typeof n){case"undefined":case"function":case"symbol":return void e.removeAttribute(t);case"boolean":var i=t.toLowerCase().slice(0,5);if("data-"!==i&&"aria-"!==i)return void e.removeAttribute(t)}e.setAttribute(t,""+n)}var r}function ot(e,t,n){if(null===n)e.removeAttribute(t);else{switch(typeof n){case"undefined":case"function":case"symbol":case"boolean":return void e.removeAttribute(t)}e.setAttribute(t,""+n)}}function lt(e,t,n,i){if(null===i)e.removeAttribute(n);else{switch(typeof i){case"undefined":case"function":case"symbol":case"boolean":return void e.removeAttribute(n)}e.setAttributeNS(t,n,""+i)}}function ct(e){switch(typeof e){case"bigint":case"boolean":case"number":case"string":case"undefined":case"object":return e;default:return""}}function ht(e){var t=e.type;return(e=e.nodeName)&&"input"===e.toLowerCase()&&("checkbox"===t||"radio"===t)}function ut(e){e._valueTracker||(e._valueTracker=function(e){var t=ht(e)?"checked":"value",n=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),i=""+e[t];if(!e.hasOwnProperty(t)&&"undefined"!==typeof n&&"function"===typeof n.get&&"function"===typeof n.set){var r=n.get,s=n.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return r.call(this)},set:function(e){i=""+e,s.call(this,e)}}),Object.defineProperty(e,t,{enumerable:n.enumerable}),{getValue:function(){return i},setValue:function(e){i=""+e},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}(e))}function dt(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var n=t.getValue(),i="";return e&&(i=ht(e)?e.checked?"true":"false":e.value),(e=i)!==n&&(t.setValue(e),!0)}function pt(e){if("undefined"===typeof(e=e||("undefined"!==typeof document?document:void 0)))return null;try{return e.activeElement||e.body}catch(t){return e.body}}var ft=/[\n"\\]/g;function mt(e){return e.replace(ft,(function(e){return"\\"+e.charCodeAt(0).toString(16)+" "}))}function gt(e,t,n,i,r,s,a,o){e.name="",null!=a&&"function"!==typeof a&&"symbol"!==typeof a&&"boolean"!==typeof a?e.type=a:e.removeAttribute("type"),null!=t?"number"===a?(0===t&&""===e.value||e.value!=t)&&(e.value=""+ct(t)):e.value!==""+ct(t)&&(e.value=""+ct(t)):"submit"!==a&&"reset"!==a||e.removeAttribute("value"),null!=t?yt(e,a,ct(t)):null!=n?yt(e,a,ct(n)):null!=i&&e.removeAttribute("value"),null==r&&null!=s&&(e.defaultChecked=!!s),null!=r&&(e.checked=r&&"function"!==typeof r&&"symbol"!==typeof r),null!=o&&"function"!==typeof o&&"symbol"!==typeof o&&"boolean"!==typeof o?e.name=""+ct(o):e.removeAttribute("name")}function vt(e,t,n,i,r,s,a,o){if(null!=s&&"function"!==typeof s&&"symbol"!==typeof s&&"boolean"!==typeof s&&(e.type=s),null!=t||null!=n){if(!("submit"!==s&&"reset"!==s||void 0!==t&&null!==t))return;n=null!=n?""+ct(n):"",t=null!=t?""+ct(t):n,o||t===e.value||(e.value=t),e.defaultValue=t}i="function"!==typeof(i=null!=i?i:r)&&"symbol"!==typeof i&&!!i,e.checked=o?e.checked:!!i,e.defaultChecked=!!i,null!=a&&"function"!==typeof a&&"symbol"!==typeof a&&"boolean"!==typeof a&&(e.name=a)}function yt(e,t,n){"number"===t&&pt(e.ownerDocument)===e||e.defaultValue===""+n||(e.defaultValue=""+n)}function bt(e,t,n,i){if(e=e.options,t){t={};for(var r=0;r<n.length;r++)t["$"+n[r]]=!0;for(n=0;n<e.length;n++)r=t.hasOwnProperty("$"+e[n].value),e[n].selected!==r&&(e[n].selected=r),r&&i&&(e[n].defaultSelected=!0)}else{for(n=""+ct(n),t=null,r=0;r<e.length;r++){if(e[r].value===n)return e[r].selected=!0,void(i&&(e[r].defaultSelected=!0));null!==t||e[r].disabled||(t=e[r])}null!==t&&(t.selected=!0)}}function xt(e,t,n){null==t||((t=""+ct(t))!==e.value&&(e.value=t),null!=n)?e.defaultValue=null!=n?""+ct(n):"":e.defaultValue!==t&&(e.defaultValue=t)}function wt(e,t,n,i){if(null==t){if(null!=i){if(null!=n)throw Error(a(92));if(j(i)){if(1<i.length)throw Error(a(93));i=i[0]}n=i}null==n&&(n=""),t=n}n=ct(t),e.defaultValue=n,(i=e.textContent)===n&&""!==i&&null!==i&&(e.value=i)}function St(e,t){if(t){var n=e.firstChild;if(n&&n===e.lastChild&&3===n.nodeType)return void(n.nodeValue=t)}e.textContent=t}var _t=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function Et(e,t,n){var i=0===t.indexOf("--");null==n||"boolean"===typeof n||""===n?i?e.setProperty(t,""):"float"===t?e.cssFloat="":e[t]="":i?e.setProperty(t,n):"number"!==typeof n||0===n||_t.has(t)?"float"===t?e.cssFloat=n:e[t]=(""+n).trim():e[t]=n+"px"}function At(e,t,n){if(null!=t&&"object"!==typeof t)throw Error(a(62));if(e=e.style,null!=n){for(var i in n)!n.hasOwnProperty(i)||null!=t&&t.hasOwnProperty(i)||(0===i.indexOf("--")?e.setProperty(i,""):"float"===i?e.cssFloat="":e[i]="");for(var r in t)i=t[r],t.hasOwnProperty(r)&&n[r]!==i&&Et(e,r,i)}else for(var s in t)t.hasOwnProperty(s)&&Et(e,s,t[s])}function Ct(e){if(-1===e.indexOf("-"))return!1;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Mt=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),Tt=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function Pt(e){return Tt.test(""+e)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":e}var Dt=null;function Ot(e){return(e=e.target||e.srcElement||window).correspondingUseElement&&(e=e.correspondingUseElement),3===e.nodeType?e.parentNode:e}var It=null,Rt=null;function kt(e){var t=Ye(e);if(t&&(e=t.stateNode)){var n=e[Fe]||null;e:switch(e=t.stateNode,t.type){case"input":if(gt(e,n.value,n.defaultValue,n.defaultValue,n.checked,n.defaultChecked,n.type,n.name),t=n.name,"radio"===n.type&&null!=t){for(n=e;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll('input[name="'+mt(""+t)+'"][type="radio"]'),t=0;t<n.length;t++){var i=n[t];if(i!==e&&i.form===e.form){var r=i[Fe]||null;if(!r)throw Error(a(90));gt(i,r.value,r.defaultValue,r.defaultValue,r.checked,r.defaultChecked,r.type,r.name)}}for(t=0;t<n.length;t++)(i=n[t]).form===e.form&&dt(i)}break e;case"textarea":xt(e,n.value,n.defaultValue);break e;case"select":null!=(t=n.value)&&bt(e,!!n.multiple,t,!1)}}}var Lt=!1;function Bt(e,t,n){if(Lt)return e(t,n);Lt=!0;try{return e(t)}finally{if(Lt=!1,(null!==It||null!==Rt)&&(Nc(),It&&(t=It,e=Rt,Rt=It=null,kt(t),e)))for(t=0;t<e.length;t++)kt(e[t])}}function zt(e,t){var n=e.stateNode;if(null===n)return null;var i=n[Fe]||null;if(null===i)return null;n=i[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(i=!i.disabled)||(i=!("button"===(e=e.type)||"input"===e||"select"===e||"textarea"===e)),e=!i;break e;default:e=!1}if(e)return null;if(n&&"function"!==typeof n)throw Error(a(231,t,typeof n));return n}var Nt=!1;if(nt)try{var Ft={};Object.defineProperty(Ft,"passive",{get:function(){Nt=!0}}),window.addEventListener("test",Ft,Ft),window.removeEventListener("test",Ft,Ft)}catch(wd){Nt=!1}var Ut=null,jt=null,Vt=null;function Gt(){if(Vt)return Vt;var e,t,n=jt,i=n.length,r="value"in Ut?Ut.value:Ut.textContent,s=r.length;for(e=0;e<i&&n[e]===r[e];e++);var a=i-e;for(t=1;t<=a&&n[i-t]===r[s-t];t++);return Vt=r.slice(e,1<t?1-t:void 0)}function Ht(e){var t=e.keyCode;return"charCode"in e?0===(e=e.charCode)&&13===t&&(e=13):e=t,10===e&&(e=13),32<=e||13===e?e:0}function Wt(){return!0}function qt(){return!1}function Xt(e){function t(t,n,i,r,s){for(var a in this._reactName=t,this._targetInst=i,this.type=n,this.nativeEvent=r,this.target=s,this.currentTarget=null,e)e.hasOwnProperty(a)&&(t=e[a],this[a]=t?t(r):r[a]);return this.isDefaultPrevented=(null!=r.defaultPrevented?r.defaultPrevented:!1===r.returnValue)?Wt:qt,this.isPropagationStopped=qt,this}return O(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var e=this.nativeEvent;e&&(e.preventDefault?e.preventDefault():"unknown"!==typeof e.returnValue&&(e.returnValue=!1),this.isDefaultPrevented=Wt)},stopPropagation:function(){var e=this.nativeEvent;e&&(e.stopPropagation?e.stopPropagation():"unknown"!==typeof e.cancelBubble&&(e.cancelBubble=!0),this.isPropagationStopped=Wt)},persist:function(){},isPersistent:Wt}),t}var Yt,Qt,Kt,Zt={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Jt=Xt(Zt),$t=O({},Zt,{view:0,detail:0}),en=Xt($t),tn=O({},$t,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:pn,button:0,buttons:0,relatedTarget:function(e){return void 0===e.relatedTarget?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==Kt&&(Kt&&"mousemove"===e.type?(Yt=e.screenX-Kt.screenX,Qt=e.screenY-Kt.screenY):Qt=Yt=0,Kt=e),Yt)},movementY:function(e){return"movementY"in e?e.movementY:Qt}}),nn=Xt(tn),rn=Xt(O({},tn,{dataTransfer:0})),sn=Xt(O({},$t,{relatedTarget:0})),an=Xt(O({},Zt,{animationName:0,elapsedTime:0,pseudoElement:0})),on=Xt(O({},Zt,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}})),ln=Xt(O({},Zt,{data:0})),cn={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},hn={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},un={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function dn(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):!!(e=un[e])&&!!t[e]}function pn(){return dn}var fn=Xt(O({},$t,{key:function(e){if(e.key){var t=cn[e.key]||e.key;if("Unidentified"!==t)return t}return"keypress"===e.type?13===(e=Ht(e))?"Enter":String.fromCharCode(e):"keydown"===e.type||"keyup"===e.type?hn[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:pn,charCode:function(e){return"keypress"===e.type?Ht(e):0},keyCode:function(e){return"keydown"===e.type||"keyup"===e.type?e.keyCode:0},which:function(e){return"keypress"===e.type?Ht(e):"keydown"===e.type||"keyup"===e.type?e.keyCode:0}})),mn=Xt(O({},tn,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0})),gn=Xt(O({},$t,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:pn})),vn=Xt(O({},Zt,{propertyName:0,elapsedTime:0,pseudoElement:0})),yn=Xt(O({},tn,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0})),bn=Xt(O({},Zt,{newState:0,oldState:0})),xn=[9,13,27,32],wn=nt&&"CompositionEvent"in window,Sn=null;nt&&"documentMode"in document&&(Sn=document.documentMode);var _n=nt&&"TextEvent"in window&&!Sn,En=nt&&(!wn||Sn&&8<Sn&&11>=Sn),An=String.fromCharCode(32),Cn=!1;function Mn(e,t){switch(e){case"keyup":return-1!==xn.indexOf(t.keyCode);case"keydown":return 229!==t.keyCode;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Tn(e){return"object"===typeof(e=e.detail)&&"data"in e?e.data:null}var Pn=!1;var Dn={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function On(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return"input"===t?!!Dn[e.type]:"textarea"===t}function In(e,t,n,i){It?Rt?Rt.push(i):Rt=[i]:It=i,0<(t=Bh(t,"onChange")).length&&(n=new Jt("onChange","change",null,n,i),e.push({event:n,listeners:t}))}var Rn=null,kn=null;function Ln(e){Th(e,0)}function Bn(e){if(dt(Qe(e)))return e}function zn(e,t){if("change"===e)return t}var Nn=!1;if(nt){var Fn;if(nt){var Un="oninput"in document;if(!Un){var jn=document.createElement("div");jn.setAttribute("oninput","return;"),Un="function"===typeof jn.oninput}Fn=Un}else Fn=!1;Nn=Fn&&(!document.documentMode||9<document.documentMode)}function Vn(){Rn&&(Rn.detachEvent("onpropertychange",Gn),kn=Rn=null)}function Gn(e){if("value"===e.propertyName&&Bn(kn)){var t=[];In(t,kn,e,Ot(e)),Bt(Ln,t)}}function Hn(e,t,n){"focusin"===e?(Vn(),kn=n,(Rn=t).attachEvent("onpropertychange",Gn)):"focusout"===e&&Vn()}function Wn(e){if("selectionchange"===e||"keyup"===e||"keydown"===e)return Bn(kn)}function qn(e,t){if("click"===e)return Bn(t)}function Xn(e,t){if("input"===e||"change"===e)return Bn(t)}var Yn="function"===typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e===1/t)||e!==e&&t!==t};function Qn(e,t){if(Yn(e,t))return!0;if("object"!==typeof e||null===e||"object"!==typeof t||null===t)return!1;var n=Object.keys(e),i=Object.keys(t);if(n.length!==i.length)return!1;for(i=0;i<n.length;i++){var r=n[i];if(!ie.call(t,r)||!Yn(e[r],t[r]))return!1}return!0}function Kn(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function Zn(e,t){var n,i=Kn(e);for(e=0;i;){if(3===i.nodeType){if(n=e+i.textContent.length,e<=t&&n>=t)return{node:i,offset:t-e};e=n}e:{for(;i;){if(i.nextSibling){i=i.nextSibling;break e}i=i.parentNode}i=void 0}i=Kn(i)}}function Jn(e,t){return!(!e||!t)&&(e===t||(!e||3!==e.nodeType)&&(t&&3===t.nodeType?Jn(e,t.parentNode):"contains"in e?e.contains(t):!!e.compareDocumentPosition&&!!(16&e.compareDocumentPosition(t))))}function $n(e){for(var t=pt((e=null!=e&&null!=e.ownerDocument&&null!=e.ownerDocument.defaultView?e.ownerDocument.defaultView:window).document);t instanceof e.HTMLIFrameElement;){try{var n="string"===typeof t.contentWindow.location.href}catch(i){n=!1}if(!n)break;t=pt((e=t.contentWindow).document)}return t}function ei(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&("input"===t&&("text"===e.type||"search"===e.type||"tel"===e.type||"url"===e.type||"password"===e.type)||"textarea"===t||"true"===e.contentEditable)}function ti(e,t){var n=$n(t);t=e.focusedElem;var i=e.selectionRange;if(n!==t&&t&&t.ownerDocument&&Jn(t.ownerDocument.documentElement,t)){if(null!==i&&ei(t))if(e=i.start,void 0===(n=i.end)&&(n=e),"selectionStart"in t)t.selectionStart=e,t.selectionEnd=Math.min(n,t.value.length);else if((n=(e=t.ownerDocument||document)&&e.defaultView||window).getSelection){n=n.getSelection();var r=t.textContent.length,s=Math.min(i.start,r);i=void 0===i.end?s:Math.min(i.end,r),!n.extend&&s>i&&(r=i,i=s,s=r),r=Zn(t,s);var a=Zn(t,i);r&&a&&(1!==n.rangeCount||n.anchorNode!==r.node||n.anchorOffset!==r.offset||n.focusNode!==a.node||n.focusOffset!==a.offset)&&((e=e.createRange()).setStart(r.node,r.offset),n.removeAllRanges(),s>i?(n.addRange(e),n.extend(a.node,a.offset)):(e.setEnd(a.node,a.offset),n.addRange(e)))}for(e=[],n=t;n=n.parentNode;)1===n.nodeType&&e.push({element:n,left:n.scrollLeft,top:n.scrollTop});for("function"===typeof t.focus&&t.focus(),t=0;t<e.length;t++)(n=e[t]).element.scrollLeft=n.left,n.element.scrollTop=n.top}}var ni=nt&&"documentMode"in document&&11>=document.documentMode,ii=null,ri=null,si=null,ai=!1;function oi(e,t,n){var i=n.window===n?n.document:9===n.nodeType?n:n.ownerDocument;ai||null==ii||ii!==pt(i)||("selectionStart"in(i=ii)&&ei(i)?i={start:i.selectionStart,end:i.selectionEnd}:i={anchorNode:(i=(i.ownerDocument&&i.ownerDocument.defaultView||window).getSelection()).anchorNode,anchorOffset:i.anchorOffset,focusNode:i.focusNode,focusOffset:i.focusOffset},si&&Qn(si,i)||(si=i,0<(i=Bh(ri,"onSelect")).length&&(t=new Jt("onSelect","select",null,t,n),e.push({event:t,listeners:i}),t.target=ii)))}function li(e,t){var n={};return n[e.toLowerCase()]=t.toLowerCase(),n["Webkit"+e]="webkit"+t,n["Moz"+e]="moz"+t,n}var ci={animationend:li("Animation","AnimationEnd"),animationiteration:li("Animation","AnimationIteration"),animationstart:li("Animation","AnimationStart"),transitionrun:li("Transition","TransitionRun"),transitionstart:li("Transition","TransitionStart"),transitioncancel:li("Transition","TransitionCancel"),transitionend:li("Transition","TransitionEnd")},hi={},ui={};function di(e){if(hi[e])return hi[e];if(!ci[e])return e;var t,n=ci[e];for(t in n)if(n.hasOwnProperty(t)&&t in ui)return hi[e]=n[t];return e}nt&&(ui=document.createElement("div").style,"AnimationEvent"in window||(delete ci.animationend.animation,delete ci.animationiteration.animation,delete ci.animationstart.animation),"TransitionEvent"in window||delete ci.transitionend.transition);var pi=di("animationend"),fi=di("animationiteration"),mi=di("animationstart"),gi=di("transitionrun"),vi=di("transitionstart"),yi=di("transitioncancel"),bi=di("transitionend"),xi=new Map,wi="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll scrollEnd toggle touchMove waiting wheel".split(" ");function Si(e,t){xi.set(e,t),et(t,[e])}var _i=[],Ei=0,Ai=0;function Ci(){for(var e=Ei,t=Ai=Ei=0;t<e;){var n=_i[t];_i[t++]=null;var i=_i[t];_i[t++]=null;var r=_i[t];_i[t++]=null;var s=_i[t];if(_i[t++]=null,null!==i&&null!==r){var a=i.pending;null===a?r.next=r:(r.next=a.next,a.next=r),i.pending=r}0!==s&&Di(n,r,s)}}function Mi(e,t,n,i){_i[Ei++]=e,_i[Ei++]=t,_i[Ei++]=n,_i[Ei++]=i,Ai|=i,e.lanes|=i,null!==(e=e.alternate)&&(e.lanes|=i)}function Ti(e,t,n,i){return Mi(e,t,n,i),Oi(e)}function Pi(e,t){return Mi(e,null,null,t),Oi(e)}function Di(e,t,n){e.lanes|=n;var i=e.alternate;null!==i&&(i.lanes|=n);for(var r=!1,s=e.return;null!==s;)s.childLanes|=n,null!==(i=s.alternate)&&(i.childLanes|=n),22===s.tag&&(null===(e=s.stateNode)||1&e._visibility||(r=!0)),e=s,s=s.return;r&&null!==t&&3===e.tag&&(s=e.stateNode,r=31-xe(n),null===(e=(s=s.hiddenUpdates)[r])?s[r]=[t]:e.push(t),t.lane=536870912|n)}function Oi(e){if(50<Tc)throw Tc=0,Pc=null,Error(a(185));for(var t=e.return;null!==t;)t=(e=t).return;return 3===e.tag?e.stateNode:null}var Ii={},Ri=new WeakMap;function ki(e,t){if("object"===typeof e&&null!==e){var n=Ri.get(e);return void 0!==n?n:(t={value:e,source:t,stack:B(t)},Ri.set(e,t),t)}return{value:e,source:t,stack:B(t)}}var Li=[],Bi=0,zi=null,Ni=0,Fi=[],Ui=0,ji=null,Vi=1,Gi="";function Hi(e,t){Li[Bi++]=Ni,Li[Bi++]=zi,zi=e,Ni=t}function Wi(e,t,n){Fi[Ui++]=Vi,Fi[Ui++]=Gi,Fi[Ui++]=ji,ji=e;var i=Vi;e=Gi;var r=32-xe(i)-1;i&=~(1<<r),n+=1;var s=32-xe(t)+r;if(30<s){var a=r-r%5;s=(i&(1<<a)-1).toString(32),i>>=a,r-=a,Vi=1<<32-xe(t)+r|n<<r|i,Gi=s+e}else Vi=1<<s|n<<r|i,Gi=e}function qi(e){null!==e.return&&(Hi(e,1),Wi(e,1,0))}function Xi(e){for(;e===zi;)zi=Li[--Bi],Li[Bi]=null,Ni=Li[--Bi],Li[Bi]=null;for(;e===ji;)ji=Fi[--Ui],Fi[Ui]=null,Gi=Fi[--Ui],Fi[Ui]=null,Vi=Fi[--Ui],Fi[Ui]=null}var Yi=null,Qi=null,Ki=!1,Zi=null,Ji=!1,$i=Error(a(519));function er(e){throw sr(ki(Error(a(418,"")),e)),$i}function tr(e){var t=e.stateNode,n=e.type,i=e.memoizedProps;switch(t[Ne]=e,t[Fe]=i,n){case"dialog":Ph("cancel",t),Ph("close",t);break;case"iframe":case"object":case"embed":Ph("load",t);break;case"video":case"audio":for(n=0;n<Ch.length;n++)Ph(Ch[n],t);break;case"source":Ph("error",t);break;case"img":case"image":case"link":Ph("error",t),Ph("load",t);break;case"details":Ph("toggle",t);break;case"input":Ph("invalid",t),vt(t,i.value,i.defaultValue,i.checked,i.defaultChecked,i.type,i.name,!0),ut(t);break;case"select":Ph("invalid",t);break;case"textarea":Ph("invalid",t),wt(t,i.value,i.defaultValue,i.children),ut(t)}"string"!==typeof(n=i.children)&&"number"!==typeof n&&"bigint"!==typeof n||t.textContent===""+n||!0===i.suppressHydrationWarning||Vh(t.textContent,n)?(null!=i.popover&&(Ph("beforetoggle",t),Ph("toggle",t)),null!=i.onScroll&&Ph("scroll",t),null!=i.onScrollEnd&&Ph("scrollend",t),null!=i.onClick&&(t.onclick=Gh),t=!0):t=!1,t||er(e)}function nr(e){for(Yi=e.return;Yi;)switch(Yi.tag){case 3:case 27:return void(Ji=!0);case 5:case 13:return void(Ji=!1);default:Yi=Yi.return}}function ir(e){if(e!==Yi)return!1;if(!Ki)return nr(e),Ki=!0,!1;var t,n=!1;if((t=3!==e.tag&&27!==e.tag)&&((t=5===e.tag)&&(t=!("form"!==(t=e.type)&&"button"!==t)||Jh(e.type,e.memoizedProps)),t=!t),t&&(n=!0),n&&Qi&&er(e),nr(e),13===e.tag){if(!(e=null!==(e=e.memoizedState)?e.dehydrated:null))throw Error(a(317));e:{for(e=e.nextSibling,n=0;e;){if(8===e.nodeType)if("/$"===(t=e.data)){if(0===n){Qi=ou(e.nextSibling);break e}n--}else"$"!==t&&"$!"!==t&&"$?"!==t||n++;e=e.nextSibling}Qi=null}}else Qi=Yi?ou(e.stateNode.nextSibling):null;return!0}function rr(){Qi=Yi=null,Ki=!1}function sr(e){null===Zi?Zi=[e]:Zi.push(e)}var ar=Error(a(460)),or=Error(a(474)),lr={then:function(){}};function cr(e){return"fulfilled"===(e=e.status)||"rejected"===e}function hr(){}function ur(e,t,n){switch(void 0===(n=e[n])?e.push(t):n!==t&&(t.then(hr,hr),t=n),t.status){case"fulfilled":return t.value;case"rejected":if((e=t.reason)===ar)throw Error(a(483));throw e;default:if("string"===typeof t.status)t.then(hr,hr);else{if(null!==(e=tc)&&100<e.shellSuspendCounter)throw Error(a(482));(e=t).status="pending",e.then((function(e){if("pending"===t.status){var n=t;n.status="fulfilled",n.value=e}}),(function(e){if("pending"===t.status){var n=t;n.status="rejected",n.reason=e}}))}switch(t.status){case"fulfilled":return t.value;case"rejected":if((e=t.reason)===ar)throw Error(a(483));throw e}throw dr=t,ar}}var dr=null;function pr(){if(null===dr)throw Error(a(459));var e=dr;return dr=null,e}var fr=null,mr=0;function gr(e){var t=mr;return mr+=1,null===fr&&(fr=[]),ur(fr,e,t)}function vr(e,t){t=t.props.ref,e.ref=void 0!==t?t:null}function yr(e,t){if(t.$$typeof===l)throw Error(a(525));throw e=Object.prototype.toString.call(t),Error(a(31,"[object Object]"===e?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function br(e){return(0,e._init)(e._payload)}function xr(e){function t(t,n){if(e){var i=t.deletions;null===i?(t.deletions=[n],t.flags|=16):i.push(n)}}function n(n,i){if(!e)return null;for(;null!==i;)t(n,i),i=i.sibling;return null}function i(e){for(var t=new Map;null!==e;)null!==e.key?t.set(e.key,e):t.set(e.index,e),e=e.sibling;return t}function r(e,t){return(e=zl(e,t)).index=0,e.sibling=null,e}function s(t,n,i){return t.index=i,e?null!==(i=t.alternate)?(i=i.index)<n?(t.flags|=33554434,n):i:(t.flags|=33554434,n):(t.flags|=1048576,n)}function o(t){return e&&null===t.alternate&&(t.flags|=33554434),t}function l(e,t,n,i){return null===t||6!==t.tag?((t=Vl(n,e.mode,i)).return=e,t):((t=r(t,n)).return=e,t)}function d(e,t,n,i){var s=n.type;return s===u?f(e,t,n.props.children,i,n.key):null!==t&&(t.elementType===s||"object"===typeof s&&null!==s&&s.$$typeof===w&&br(s)===t.type)?(vr(t=r(t,n.props),n),t.return=e,t):(vr(t=Fl(n.type,n.key,n.props,null,e.mode,i),n),t.return=e,t)}function p(e,t,n,i){return null===t||4!==t.tag||t.stateNode.containerInfo!==n.containerInfo||t.stateNode.implementation!==n.implementation?((t=Gl(n,e.mode,i)).return=e,t):((t=r(t,n.children||[])).return=e,t)}function f(e,t,n,i,s){return null===t||7!==t.tag?((t=Ul(n,e.mode,i,s)).return=e,t):((t=r(t,n)).return=e,t)}function m(e,t,n){if("string"===typeof t&&""!==t||"number"===typeof t||"bigint"===typeof t)return(t=Vl(""+t,e.mode,n)).return=e,t;if("object"===typeof t&&null!==t){switch(t.$$typeof){case c:return vr(n=Fl(t.type,t.key,t.props,null,e.mode,n),t),n.return=e,n;case h:return(t=Gl(t,e.mode,n)).return=e,t;case w:return m(e,t=(0,t._init)(t._payload),n)}if(j(t)||A(t))return(t=Ul(t,e.mode,n,null)).return=e,t;if("function"===typeof t.then)return m(e,gr(t),n);if(t.$$typeof===g)return m(e,Co(e,t),n);yr(e,t)}return null}function v(e,t,n,i){var r=null!==t?t.key:null;if("string"===typeof n&&""!==n||"number"===typeof n||"bigint"===typeof n)return null!==r?null:l(e,t,""+n,i);if("object"===typeof n&&null!==n){switch(n.$$typeof){case c:return n.key===r?d(e,t,n,i):null;case h:return n.key===r?p(e,t,n,i):null;case w:return v(e,t,n=(r=n._init)(n._payload),i)}if(j(n)||A(n))return null!==r?null:f(e,t,n,i,null);if("function"===typeof n.then)return v(e,t,gr(n),i);if(n.$$typeof===g)return v(e,t,Co(e,n),i);yr(e,n)}return null}function y(e,t,n,i,r){if("string"===typeof i&&""!==i||"number"===typeof i||"bigint"===typeof i)return l(t,e=e.get(n)||null,""+i,r);if("object"===typeof i&&null!==i){switch(i.$$typeof){case c:return d(t,e=e.get(null===i.key?n:i.key)||null,i,r);case h:return p(t,e=e.get(null===i.key?n:i.key)||null,i,r);case w:return y(e,t,n,i=(0,i._init)(i._payload),r)}if(j(i)||A(i))return f(t,e=e.get(n)||null,i,r,null);if("function"===typeof i.then)return y(e,t,n,gr(i),r);if(i.$$typeof===g)return y(e,t,n,Co(t,i),r);yr(t,i)}return null}function b(l,d,p,f){if("object"===typeof p&&null!==p&&p.type===u&&null===p.key&&(p=p.props.children),"object"===typeof p&&null!==p){switch(p.$$typeof){case c:e:{for(var x=p.key;null!==d;){if(d.key===x){if((x=p.type)===u){if(7===d.tag){n(l,d.sibling),(f=r(d,p.props.children)).return=l,l=f;break e}}else if(d.elementType===x||"object"===typeof x&&null!==x&&x.$$typeof===w&&br(x)===d.type){n(l,d.sibling),vr(f=r(d,p.props),p),f.return=l,l=f;break e}n(l,d);break}t(l,d),d=d.sibling}p.type===u?((f=Ul(p.props.children,l.mode,f,p.key)).return=l,l=f):(vr(f=Fl(p.type,p.key,p.props,null,l.mode,f),p),f.return=l,l=f)}return o(l);case h:e:{for(x=p.key;null!==d;){if(d.key===x){if(4===d.tag&&d.stateNode.containerInfo===p.containerInfo&&d.stateNode.implementation===p.implementation){n(l,d.sibling),(f=r(d,p.children||[])).return=l,l=f;break e}n(l,d);break}t(l,d),d=d.sibling}(f=Gl(p,l.mode,f)).return=l,l=f}return o(l);case w:return b(l,d,p=(x=p._init)(p._payload),f)}if(j(p))return function(r,a,o,l){for(var c=null,h=null,u=a,d=a=0,p=null;null!==u&&d<o.length;d++){u.index>d?(p=u,u=null):p=u.sibling;var f=v(r,u,o[d],l);if(null===f){null===u&&(u=p);break}e&&u&&null===f.alternate&&t(r,u),a=s(f,a,d),null===h?c=f:h.sibling=f,h=f,u=p}if(d===o.length)return n(r,u),Ki&&Hi(r,d),c;if(null===u){for(;d<o.length;d++)null!==(u=m(r,o[d],l))&&(a=s(u,a,d),null===h?c=u:h.sibling=u,h=u);return Ki&&Hi(r,d),c}for(u=i(u);d<o.length;d++)null!==(p=y(u,r,d,o[d],l))&&(e&&null!==p.alternate&&u.delete(null===p.key?d:p.key),a=s(p,a,d),null===h?c=p:h.sibling=p,h=p);return e&&u.forEach((function(e){return t(r,e)})),Ki&&Hi(r,d),c}(l,d,p,f);if(A(p)){if("function"!==typeof(x=A(p)))throw Error(a(150));return function(r,o,l,c){if(null==l)throw Error(a(151));for(var h=null,u=null,d=o,p=o=0,f=null,g=l.next();null!==d&&!g.done;p++,g=l.next()){d.index>p?(f=d,d=null):f=d.sibling;var b=v(r,d,g.value,c);if(null===b){null===d&&(d=f);break}e&&d&&null===b.alternate&&t(r,d),o=s(b,o,p),null===u?h=b:u.sibling=b,u=b,d=f}if(g.done)return n(r,d),Ki&&Hi(r,p),h;if(null===d){for(;!g.done;p++,g=l.next())null!==(g=m(r,g.value,c))&&(o=s(g,o,p),null===u?h=g:u.sibling=g,u=g);return Ki&&Hi(r,p),h}for(d=i(d);!g.done;p++,g=l.next())null!==(g=y(d,r,p,g.value,c))&&(e&&null!==g.alternate&&d.delete(null===g.key?p:g.key),o=s(g,o,p),null===u?h=g:u.sibling=g,u=g);return e&&d.forEach((function(e){return t(r,e)})),Ki&&Hi(r,p),h}(l,d,p=x.call(p),f)}if("function"===typeof p.then)return b(l,d,gr(p),f);if(p.$$typeof===g)return b(l,d,Co(l,p),f);yr(l,p)}return"string"===typeof p&&""!==p||"number"===typeof p||"bigint"===typeof p?(p=""+p,null!==d&&6===d.tag?(n(l,d.sibling),(f=r(d,p)).return=l,l=f):(n(l,d),(f=Vl(p,l.mode,f)).return=l,l=f),o(l)):n(l,d)}return function(e,t,n,i){try{mr=0;var r=b(e,t,n,i);return fr=null,r}catch(a){if(a===ar)throw a;var s=Ll(29,a,null,e.mode);return s.lanes=i,s.return=e,s}}}var wr=xr(!0),Sr=xr(!1),_r=q(null),Er=q(0);function Ar(e,t){Y(Er,e=cc),Y(_r,t),cc=e|t.baseLanes}function Cr(){Y(Er,cc),Y(_r,_r.current)}function Mr(){cc=Er.current,X(_r),X(Er)}var Tr=q(null),Pr=null;function Dr(e){var t=e.alternate;Y(kr,1&kr.current),Y(Tr,e),null===Pr&&(null===t||null!==_r.current||null!==t.memoizedState)&&(Pr=e)}function Or(e){if(22===e.tag){if(Y(kr,kr.current),Y(Tr,e),null===Pr){var t=e.alternate;null!==t&&null!==t.memoizedState&&(Pr=e)}}else Ir()}function Ir(){Y(kr,kr.current),Y(Tr,Tr.current)}function Rr(e){X(Tr),Pr===e&&(Pr=null),X(kr)}var kr=q(0);function Lr(e){for(var t=e;null!==t;){if(13===t.tag){var n=t.memoizedState;if(null!==n&&(null===(n=n.dehydrated)||"$?"===n.data||"$!"===n.data))return t}else if(19===t.tag&&void 0!==t.memoizedProps.revealOrder){if(0!==(128&t.flags))return t}else if(null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var Br="undefined"!==typeof AbortController?AbortController:function(){var e=[],t=this.signal={aborted:!1,addEventListener:function(t,n){e.push(n)}};this.abort=function(){t.aborted=!0,e.forEach((function(e){return e()}))}},zr=i.unstable_scheduleCallback,Nr=i.unstable_NormalPriority,Fr={$$typeof:g,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function Ur(){return{controller:new Br,data:new Map,refCount:0}}function jr(e){e.refCount--,0===e.refCount&&zr(Nr,(function(){e.controller.abort()}))}var Vr=null,Gr=0,Hr=0,Wr=null;function qr(){if(0===--Gr&&null!==Vr){null!==Wr&&(Wr.status="fulfilled");var e=Vr;Vr=null,Hr=0,Wr=null;for(var t=0;t<e.length;t++)(0,e[t])()}}var Xr=D.S;D.S=function(e,t){"object"===typeof t&&null!==t&&"function"===typeof t.then&&function(e,t){if(null===Vr){var n=Vr=[];Gr=0,Hr=wh(),Wr={status:"pending",value:void 0,then:function(e){n.push(e)}}}Gr++,t.then(qr,qr)}(0,t),null!==Xr&&Xr(e,t)};var Yr=q(null);function Qr(){var e=Yr.current;return null!==e?e:tc.pooledCache}function Kr(e,t){Y(Yr,null===t?Yr.current:t.pool)}function Zr(){var e=Qr();return null===e?null:{parent:Fr._currentValue,pool:e}}var Jr=0,$r=null,es=null,ts=null,ns=!1,is=!1,rs=!1,ss=0,as=0,os=null,ls=0;function cs(){throw Error(a(321))}function hs(e,t){if(null===t)return!1;for(var n=0;n<t.length&&n<e.length;n++)if(!Yn(e[n],t[n]))return!1;return!0}function us(e,t,n,i,r,s){return Jr=s,$r=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,D.H=null===e||null===e.memoizedState?Aa:Ca,rs=!1,s=n(i,r),rs=!1,is&&(s=ps(t,n,i,r)),ds(e),s}function ds(e){D.H=Ea;var t=null!==es&&null!==es.next;if(Jr=0,ts=es=$r=null,ns=!1,as=0,os=null,t)throw Error(a(300));null===e||Ga||null!==(e=e.dependencies)&&_o(e)&&(Ga=!0)}function ps(e,t,n,i){$r=e;var r=0;do{if(is&&(os=null),as=0,is=!1,25<=r)throw Error(a(301));if(r+=1,ts=es=null,null!=e.updateQueue){var s=e.updateQueue;s.lastEffect=null,s.events=null,s.stores=null,null!=s.memoCache&&(s.memoCache.index=0)}D.H=Ma,s=t(n,i)}while(is);return s}function fs(){var e=D.H,t=e.useState()[0];return t="function"===typeof t.then?xs(t):t,e=e.useState()[0],(null!==es?es.memoizedState:null)!==e&&($r.flags|=1024),t}function ms(){var e=0!==ss;return ss=0,e}function gs(e,t,n){t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~n}function vs(e){if(ns){for(e=e.memoizedState;null!==e;){var t=e.queue;null!==t&&(t.pending=null),e=e.next}ns=!1}Jr=0,ts=es=$r=null,is=!1,as=ss=0,os=null}function ys(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===ts?$r.memoizedState=ts=e:ts=ts.next=e,ts}function bs(){if(null===es){var e=$r.alternate;e=null!==e?e.memoizedState:null}else e=es.next;var t=null===ts?$r.memoizedState:ts.next;if(null!==t)ts=t,es=e;else{if(null===e){if(null===$r.alternate)throw Error(a(467));throw Error(a(310))}e={memoizedState:(es=e).memoizedState,baseState:es.baseState,baseQueue:es.baseQueue,queue:es.queue,next:null},null===ts?$r.memoizedState=ts=e:ts=ts.next=e}return ts}function xs(e){var t=as;return as+=1,null===os&&(os=[]),e=ur(os,e,t),t=$r,null===(null===ts?t.memoizedState:ts.next)&&(t=t.alternate,D.H=null===t||null===t.memoizedState?Aa:Ca),e}function ws(e){if(null!==e&&"object"===typeof e){if("function"===typeof e.then)return xs(e);if(e.$$typeof===g)return Ao(e)}throw Error(a(438,String(e)))}function Ss(e){var t=null,n=$r.updateQueue;if(null!==n&&(t=n.memoCache),null==t){var i=$r.alternate;null!==i&&(null!==(i=i.updateQueue)&&(null!=(i=i.memoCache)&&(t={data:i.data.map((function(e){return e.slice()})),index:0})))}if(null==t&&(t={data:[],index:0}),null===n&&(n={lastEffect:null,events:null,stores:null,memoCache:null},$r.updateQueue=n),n.memoCache=t,void 0===(n=t.data[t.index]))for(n=t.data[t.index]=Array(e),i=0;i<e;i++)n[i]=_;return t.index++,n}function _s(e,t){return"function"===typeof t?t(e):t}function Es(e){return As(bs(),es,e)}function As(e,t,n){var i=e.queue;if(null===i)throw Error(a(311));i.lastRenderedReducer=n;var r=e.baseQueue,s=i.pending;if(null!==s){if(null!==r){var o=r.next;r.next=s.next,s.next=o}t.baseQueue=r=s,i.pending=null}if(s=e.baseState,null===r)e.memoizedState=s;else{var l=o=null,c=null,h=t=r.next,u=!1;do{var d=-536870913&h.lane;if(d!==h.lane?(ic&d)===d:(Jr&d)===d){var p=h.revertLane;if(0===p)null!==c&&(c=c.next={lane:0,revertLane:0,action:h.action,hasEagerState:h.hasEagerState,eagerState:h.eagerState,next:null}),d===Hr&&(u=!0);else{if((Jr&p)===p){h=h.next,p===Hr&&(u=!0);continue}d={lane:0,revertLane:h.revertLane,action:h.action,hasEagerState:h.hasEagerState,eagerState:h.eagerState,next:null},null===c?(l=c=d,o=s):c=c.next=d,$r.lanes|=p,uc|=p}d=h.action,rs&&n(s,d),s=h.hasEagerState?h.eagerState:n(s,d)}else p={lane:d,revertLane:h.revertLane,action:h.action,hasEagerState:h.hasEagerState,eagerState:h.eagerState,next:null},null===c?(l=c=p,o=s):c=c.next=p,$r.lanes|=d,uc|=d;h=h.next}while(null!==h&&h!==t);if(null===c?o=s:c.next=l,!Yn(s,e.memoizedState)&&(Ga=!0,u&&null!==(n=Wr)))throw n;e.memoizedState=s,e.baseState=o,e.baseQueue=c,i.lastRenderedState=s}return null===r&&(i.lanes=0),[e.memoizedState,i.dispatch]}function Cs(e){var t=bs(),n=t.queue;if(null===n)throw Error(a(311));n.lastRenderedReducer=e;var i=n.dispatch,r=n.pending,s=t.memoizedState;if(null!==r){n.pending=null;var o=r=r.next;do{s=e(s,o.action),o=o.next}while(o!==r);Yn(s,t.memoizedState)||(Ga=!0),t.memoizedState=s,null===t.baseQueue&&(t.baseState=s),n.lastRenderedState=s}return[s,i]}function Ms(e,t,n){var i=$r,r=bs(),s=Ki;if(s){if(void 0===n)throw Error(a(407));n=n()}else n=t();var o=!Yn((es||r).memoizedState,n);if(o&&(r.memoizedState=n,Ga=!0),r=r.queue,Js(Ds.bind(null,i,r,e),[e]),r.getSnapshot!==t||o||null!==ts&&1&ts.memoizedState.tag){if(i.flags|=2048,Xs(9,Ps.bind(null,i,r,n,t),{destroy:void 0},null),null===tc)throw Error(a(349));s||0!==(60&Jr)||Ts(i,t,n)}return n}function Ts(e,t,n){e.flags|=16384,e={getSnapshot:t,value:n},null===(t=$r.updateQueue)?(t={lastEffect:null,events:null,stores:null,memoCache:null},$r.updateQueue=t,t.stores=[e]):null===(n=t.stores)?t.stores=[e]:n.push(e)}function Ps(e,t,n,i){t.value=n,t.getSnapshot=i,Os(t)&&Is(e)}function Ds(e,t,n){return n((function(){Os(t)&&Is(e)}))}function Os(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!Yn(e,n)}catch(i){return!0}}function Is(e){var t=Pi(e,2);null!==t&&Ic(t,e,2)}function Rs(e){var t=ys();if("function"===typeof e){var n=e;if(e=n(),rs){be(!0);try{n()}finally{be(!1)}}}return t.memoizedState=t.baseState=e,t.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:_s,lastRenderedState:e},t}function ks(e,t,n,i){return e.baseState=n,As(e,es,"function"===typeof i?i:_s)}function Ls(e,t,n,i,r){if(wa(e))throw Error(a(485));if(null!==(e=t.action)){var s={payload:r,action:e,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(e){s.listeners.push(e)}};null!==D.T?n(!0):s.isTransition=!1,i(s),null===(n=t.pending)?(s.next=t.pending=s,Bs(t,s)):(s.next=n.next,t.pending=n.next=s)}}function Bs(e,t){var n=t.action,i=t.payload,r=e.state;if(t.isTransition){var s=D.T,a={};D.T=a;try{var o=n(r,i),l=D.S;null!==l&&l(a,o),zs(e,t,o)}catch(c){Fs(e,t,c)}finally{D.T=s}}else try{zs(e,t,s=n(r,i))}catch(h){Fs(e,t,h)}}function zs(e,t,n){null!==n&&"object"===typeof n&&"function"===typeof n.then?n.then((function(n){Ns(e,t,n)}),(function(n){return Fs(e,t,n)})):Ns(e,t,n)}function Ns(e,t,n){t.status="fulfilled",t.value=n,Us(t),e.state=n,null!==(t=e.pending)&&((n=t.next)===t?e.pending=null:(n=n.next,t.next=n,Bs(e,n)))}function Fs(e,t,n){var i=e.pending;if(e.pending=null,null!==i){i=i.next;do{t.status="rejected",t.reason=n,Us(t),t=t.next}while(t!==i)}e.action=null}function Us(e){e=e.listeners;for(var t=0;t<e.length;t++)(0,e[t])()}function js(e,t){return t}function Vs(e,t){if(Ki){var n=tc.formState;if(null!==n){e:{var i=$r;if(Ki){if(Qi){t:{for(var r=Qi,s=Ji;8!==r.nodeType;){if(!s){r=null;break t}if(null===(r=ou(r.nextSibling))){r=null;break t}}r="F!"===(s=r.data)||"F"===s?r:null}if(r){Qi=ou(r.nextSibling),i="F!"===r.data;break e}}er(i)}i=!1}i&&(t=n[0])}}return(n=ys()).memoizedState=n.baseState=t,i={pending:null,lanes:0,dispatch:null,lastRenderedReducer:js,lastRenderedState:t},n.queue=i,n=ya.bind(null,$r,i),i.dispatch=n,i=Rs(!1),s=xa.bind(null,$r,!1,i.queue),r={state:t,dispatch:null,action:e,pending:null},(i=ys()).queue=r,n=Ls.bind(null,$r,r,s,n),r.dispatch=n,i.memoizedState=e,[t,n,!1]}function Gs(e){return Hs(bs(),es,e)}function Hs(e,t,n){t=As(e,t,js)[0],e=Es(_s)[0],t="object"===typeof t&&null!==t&&"function"===typeof t.then?xs(t):t;var i=bs(),r=i.queue,s=r.dispatch;return n!==i.memoizedState&&($r.flags|=2048,Xs(9,Ws.bind(null,r,n),{destroy:void 0},null)),[t,s,e]}function Ws(e,t){e.action=t}function qs(e){var t=bs(),n=es;if(null!==n)return Hs(t,n,e);bs(),t=t.memoizedState;var i=(n=bs()).queue.dispatch;return n.memoizedState=e,[t,i,!1]}function Xs(e,t,n,i){return e={tag:e,create:t,inst:n,deps:i,next:null},null===(t=$r.updateQueue)&&(t={lastEffect:null,events:null,stores:null,memoCache:null},$r.updateQueue=t),null===(n=t.lastEffect)?t.lastEffect=e.next=e:(i=n.next,n.next=e,e.next=i,t.lastEffect=e),e}function Ys(){return bs().memoizedState}function Qs(e,t,n,i){var r=ys();$r.flags|=e,r.memoizedState=Xs(1|t,n,{destroy:void 0},void 0===i?null:i)}function Ks(e,t,n,i){var r=bs();i=void 0===i?null:i;var s=r.memoizedState.inst;null!==es&&null!==i&&hs(i,es.memoizedState.deps)?r.memoizedState=Xs(t,n,s,i):($r.flags|=e,r.memoizedState=Xs(1|t,n,s,i))}function Zs(e,t){Qs(8390656,8,e,t)}function Js(e,t){Ks(2048,8,e,t)}function $s(e,t){return Ks(4,2,e,t)}function ea(e,t){return Ks(4,4,e,t)}function ta(e,t){if("function"===typeof t){e=e();var n=t(e);return function(){"function"===typeof n?n():t(null)}}if(null!==t&&void 0!==t)return e=e(),t.current=e,function(){t.current=null}}function na(e,t,n){n=null!==n&&void 0!==n?n.concat([e]):null,Ks(4,4,ta.bind(null,t,e),n)}function ia(){}function ra(e,t){var n=bs();t=void 0===t?null:t;var i=n.memoizedState;return null!==t&&hs(t,i[1])?i[0]:(n.memoizedState=[e,t],e)}function sa(e,t){var n=bs();t=void 0===t?null:t;var i=n.memoizedState;if(null!==t&&hs(t,i[1]))return i[0];if(i=e(),rs){be(!0);try{e()}finally{be(!1)}}return n.memoizedState=[i,t],i}function aa(e,t,n){return void 0===n||0!==(1073741824&Jr)?e.memoizedState=t:(e.memoizedState=n,e=Oc(),$r.lanes|=e,uc|=e,n)}function oa(e,t,n,i){return Yn(n,t)?n:null!==_r.current?(e=aa(e,n,i),Yn(e,t)||(Ga=!0),e):0===(42&Jr)?(Ga=!0,e.memoizedState=n):(e=Oc(),$r.lanes|=e,uc|=e,t)}function la(e,t,n,i,r){var s=V.p;V.p=0!==s&&8>s?s:8;var a=D.T,o={};D.T=o,xa(e,!1,t,n);try{var l=r(),c=D.S;if(null!==c&&c(o,l),null!==l&&"object"===typeof l&&"function"===typeof l.then)ba(e,t,function(e,t){var n=[],i={status:"pending",value:null,reason:null,then:function(e){n.push(e)}};return e.then((function(){i.status="fulfilled",i.value=t;for(var e=0;e<n.length;e++)(0,n[e])(t)}),(function(e){for(i.status="rejected",i.reason=e,e=0;e<n.length;e++)(0,n[e])(void 0)})),i}(l,i),Dc());else ba(e,t,i,Dc())}catch(h){ba(e,t,{then:function(){},status:"rejected",reason:h},Dc())}finally{V.p=s,D.T=a}}function ca(){}function ha(e,t,n,i){if(5!==e.tag)throw Error(a(476));var r=ua(e).queue;la(e,r,t,G,null===n?ca:function(){return da(e),n(i)})}function ua(e){var t=e.memoizedState;if(null!==t)return t;var n={};return(t={memoizedState:G,baseState:G,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:_s,lastRenderedState:G},next:null}).next={memoizedState:n,baseState:n,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:_s,lastRenderedState:n},next:null},e.memoizedState=t,null!==(e=e.alternate)&&(e.memoizedState=t),t}function da(e){ba(e,ua(e).next.queue,{},Dc())}function pa(){return Ao(Bu)}function fa(){return bs().memoizedState}function ma(){return bs().memoizedState}function ga(e){for(var t=e.return;null!==t;){switch(t.tag){case 24:case 3:var n=Dc(),i=Io(t,e=Oo(n),n);return null!==i&&(Ic(i,t,n),Ro(i,t,n)),t={cache:Ur()},void(e.payload=t)}t=t.return}}function va(e,t,n){var i=Dc();n={lane:i,revertLane:0,action:n,hasEagerState:!1,eagerState:null,next:null},wa(e)?Sa(t,n):null!==(n=Ti(e,t,n,i))&&(Ic(n,e,i),_a(n,t,i))}function ya(e,t,n){ba(e,t,n,Dc())}function ba(e,t,n,i){var r={lane:i,revertLane:0,action:n,hasEagerState:!1,eagerState:null,next:null};if(wa(e))Sa(t,r);else{var s=e.alternate;if(0===e.lanes&&(null===s||0===s.lanes)&&null!==(s=t.lastRenderedReducer))try{var a=t.lastRenderedState,o=s(a,n);if(r.hasEagerState=!0,r.eagerState=o,Yn(o,a))return Mi(e,t,r,0),null===tc&&Ci(),!1}catch(l){}if(null!==(n=Ti(e,t,r,i)))return Ic(n,e,i),_a(n,t,i),!0}return!1}function xa(e,t,n,i){if(i={lane:2,revertLane:wh(),action:i,hasEagerState:!1,eagerState:null,next:null},wa(e)){if(t)throw Error(a(479))}else null!==(t=Ti(e,n,i,2))&&Ic(t,e,2)}function wa(e){var t=e.alternate;return e===$r||null!==t&&t===$r}function Sa(e,t){is=ns=!0;var n=e.pending;null===n?t.next=t:(t.next=n.next,n.next=t),e.pending=t}function _a(e,t,n){if(0!==(4194176&n)){var i=t.lanes;n|=i&=e.pendingLanes,t.lanes=n,ke(e,n)}}var Ea={readContext:Ao,use:ws,useCallback:cs,useContext:cs,useEffect:cs,useImperativeHandle:cs,useLayoutEffect:cs,useInsertionEffect:cs,useMemo:cs,useReducer:cs,useRef:cs,useState:cs,useDebugValue:cs,useDeferredValue:cs,useTransition:cs,useSyncExternalStore:cs,useId:cs};Ea.useCacheRefresh=cs,Ea.useMemoCache=cs,Ea.useHostTransitionStatus=cs,Ea.useFormState=cs,Ea.useActionState=cs,Ea.useOptimistic=cs;var Aa={readContext:Ao,use:ws,useCallback:function(e,t){return ys().memoizedState=[e,void 0===t?null:t],e},useContext:Ao,useEffect:Zs,useImperativeHandle:function(e,t,n){n=null!==n&&void 0!==n?n.concat([e]):null,Qs(4194308,4,ta.bind(null,t,e),n)},useLayoutEffect:function(e,t){return Qs(4194308,4,e,t)},useInsertionEffect:function(e,t){Qs(4,2,e,t)},useMemo:function(e,t){var n=ys();t=void 0===t?null:t;var i=e();if(rs){be(!0);try{e()}finally{be(!1)}}return n.memoizedState=[i,t],i},useReducer:function(e,t,n){var i=ys();if(void 0!==n){var r=n(t);if(rs){be(!0);try{n(t)}finally{be(!1)}}}else r=t;return i.memoizedState=i.baseState=r,e={pending:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:r},i.queue=e,e=e.dispatch=va.bind(null,$r,e),[i.memoizedState,e]},useRef:function(e){return e={current:e},ys().memoizedState=e},useState:function(e){var t=(e=Rs(e)).queue,n=ya.bind(null,$r,t);return t.dispatch=n,[e.memoizedState,n]},useDebugValue:ia,useDeferredValue:function(e,t){return aa(ys(),e,t)},useTransition:function(){var e=Rs(!1);return e=la.bind(null,$r,e.queue,!0,!1),ys().memoizedState=e,[!1,e]},useSyncExternalStore:function(e,t,n){var i=$r,r=ys();if(Ki){if(void 0===n)throw Error(a(407));n=n()}else{if(n=t(),null===tc)throw Error(a(349));0!==(60&ic)||Ts(i,t,n)}r.memoizedState=n;var s={value:n,getSnapshot:t};return r.queue=s,Zs(Ds.bind(null,i,s,e),[e]),i.flags|=2048,Xs(9,Ps.bind(null,i,s,n,t),{destroy:void 0},null),n},useId:function(){var e=ys(),t=tc.identifierPrefix;if(Ki){var n=Gi;t=":"+t+"R"+(n=(Vi&~(1<<32-xe(Vi)-1)).toString(32)+n),0<(n=ss++)&&(t+="H"+n.toString(32)),t+=":"}else t=":"+t+"r"+(n=ls++).toString(32)+":";return e.memoizedState=t},useCacheRefresh:function(){return ys().memoizedState=ga.bind(null,$r)}};Aa.useMemoCache=Ss,Aa.useHostTransitionStatus=pa,Aa.useFormState=Vs,Aa.useActionState=Vs,Aa.useOptimistic=function(e){var t=ys();t.memoizedState=t.baseState=e;var n={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return t.queue=n,t=xa.bind(null,$r,!0,n),n.dispatch=t,[e,t]};var Ca={readContext:Ao,use:ws,useCallback:ra,useContext:Ao,useEffect:Js,useImperativeHandle:na,useInsertionEffect:$s,useLayoutEffect:ea,useMemo:sa,useReducer:Es,useRef:Ys,useState:function(){return Es(_s)},useDebugValue:ia,useDeferredValue:function(e,t){return oa(bs(),es.memoizedState,e,t)},useTransition:function(){var e=Es(_s)[0],t=bs().memoizedState;return["boolean"===typeof e?e:xs(e),t]},useSyncExternalStore:Ms,useId:fa};Ca.useCacheRefresh=ma,Ca.useMemoCache=Ss,Ca.useHostTransitionStatus=pa,Ca.useFormState=Gs,Ca.useActionState=Gs,Ca.useOptimistic=function(e,t){return ks(bs(),0,e,t)};var Ma={readContext:Ao,use:ws,useCallback:ra,useContext:Ao,useEffect:Js,useImperativeHandle:na,useInsertionEffect:$s,useLayoutEffect:ea,useMemo:sa,useReducer:Cs,useRef:Ys,useState:function(){return Cs(_s)},useDebugValue:ia,useDeferredValue:function(e,t){var n=bs();return null===es?aa(n,e,t):oa(n,es.memoizedState,e,t)},useTransition:function(){var e=Cs(_s)[0],t=bs().memoizedState;return["boolean"===typeof e?e:xs(e),t]},useSyncExternalStore:Ms,useId:fa};function Ta(e,t,n,i){n=null===(n=n(i,t=e.memoizedState))||void 0===n?t:O({},t,n),e.memoizedState=n,0===e.lanes&&(e.updateQueue.baseState=n)}Ma.useCacheRefresh=ma,Ma.useMemoCache=Ss,Ma.useHostTransitionStatus=pa,Ma.useFormState=qs,Ma.useActionState=qs,Ma.useOptimistic=function(e,t){var n=bs();return null!==es?ks(n,0,e,t):(n.baseState=e,[e,n.queue.dispatch])};var Pa={isMounted:function(e){return!!(e=e._reactInternals)&&z(e)===e},enqueueSetState:function(e,t,n){e=e._reactInternals;var i=Dc(),r=Oo(i);r.payload=t,void 0!==n&&null!==n&&(r.callback=n),null!==(t=Io(e,r,i))&&(Ic(t,e,i),Ro(t,e,i))},enqueueReplaceState:function(e,t,n){e=e._reactInternals;var i=Dc(),r=Oo(i);r.tag=1,r.payload=t,void 0!==n&&null!==n&&(r.callback=n),null!==(t=Io(e,r,i))&&(Ic(t,e,i),Ro(t,e,i))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var n=Dc(),i=Oo(n);i.tag=2,void 0!==t&&null!==t&&(i.callback=t),null!==(t=Io(e,i,n))&&(Ic(t,e,n),Ro(t,e,n))}};function Da(e,t,n,i,r,s,a){return"function"===typeof(e=e.stateNode).shouldComponentUpdate?e.shouldComponentUpdate(i,s,a):!t.prototype||!t.prototype.isPureReactComponent||(!Qn(n,i)||!Qn(r,s))}function Oa(e,t,n,i){e=t.state,"function"===typeof t.componentWillReceiveProps&&t.componentWillReceiveProps(n,i),"function"===typeof t.UNSAFE_componentWillReceiveProps&&t.UNSAFE_componentWillReceiveProps(n,i),t.state!==e&&Pa.enqueueReplaceState(t,t.state,null)}function Ia(e,t){var n=t;if("ref"in t)for(var i in n={},t)"ref"!==i&&(n[i]=t[i]);if(e=e.defaultProps)for(var r in n===t&&(n=O({},n)),e)void 0===n[r]&&(n[r]=e[r]);return n}var Ra="function"===typeof reportError?reportError:function(e){if("object"===typeof window&&"function"===typeof window.ErrorEvent){var t=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:"object"===typeof e&&null!==e&&"string"===typeof e.message?String(e.message):String(e),error:e});if(!window.dispatchEvent(t))return}else if("object"===typeof process&&"function"===typeof process.emit)return void process.emit("uncaughtException",e);console.error(e)};function ka(e){Ra(e)}function La(e){console.error(e)}function Ba(e){Ra(e)}function za(e,t){try{(0,e.onUncaughtError)(t.value,{componentStack:t.stack})}catch(n){setTimeout((function(){throw n}))}}function Na(e,t,n){try{(0,e.onCaughtError)(n.value,{componentStack:n.stack,errorBoundary:1===t.tag?t.stateNode:null})}catch(i){setTimeout((function(){throw i}))}}function Fa(e,t,n){return(n=Oo(n)).tag=3,n.payload={element:null},n.callback=function(){za(e,t)},n}function Ua(e){return(e=Oo(e)).tag=3,e}function ja(e,t,n,i){var r=n.type.getDerivedStateFromError;if("function"===typeof r){var s=i.value;e.payload=function(){return r(s)},e.callback=function(){Na(t,n,i)}}var a=n.stateNode;null!==a&&"function"===typeof a.componentDidCatch&&(e.callback=function(){Na(t,n,i),"function"!==typeof r&&(null===Sc?Sc=new Set([this]):Sc.add(this));var e=i.stack;this.componentDidCatch(i.value,{componentStack:null!==e?e:""})})}var Va=Error(a(461)),Ga=!1;function Ha(e,t,n,i){t.child=null===e?Sr(t,null,n,i):wr(t,e.child,n,i)}function Wa(e,t,n,i,r){n=n.render;var s=t.ref;if("ref"in i){var a={};for(var o in i)"ref"!==o&&(a[o]=i[o])}else a=i;return Eo(t),i=us(e,t,n,a,s,r),o=ms(),null===e||Ga?(Ki&&o&&qi(t),t.flags|=1,Ha(e,t,i,r),t.child):(gs(e,t,r),uo(e,t,r))}function qa(e,t,n,i,r){if(null===e){var s=n.type;return"function"!==typeof s||Bl(s)||void 0!==s.defaultProps||null!==n.compare?((e=Fl(n.type,null,i,t,t.mode,r)).ref=t.ref,e.return=t,t.child=e):(t.tag=15,t.type=s,Xa(e,t,s,i,r))}if(s=e.child,!po(e,r)){var a=s.memoizedProps;if((n=null!==(n=n.compare)?n:Qn)(a,i)&&e.ref===t.ref)return uo(e,t,r)}return t.flags|=1,(e=zl(s,i)).ref=t.ref,e.return=t,t.child=e}function Xa(e,t,n,i,r){if(null!==e){var s=e.memoizedProps;if(Qn(s,i)&&e.ref===t.ref){if(Ga=!1,t.pendingProps=i=s,!po(e,r))return t.lanes=e.lanes,uo(e,t,r);0!==(131072&e.flags)&&(Ga=!0)}}return Za(e,t,n,i,r)}function Ya(e,t,n){var i=t.pendingProps,r=i.children,s=0!==(2&t.stateNode._pendingVisibility),a=null!==e?e.memoizedState:null;if(Ka(e,t),"hidden"===i.mode||s){if(0!==(128&t.flags)){if(i=null!==a?a.baseLanes|n:n,null!==e){for(r=t.child=e.child,s=0;null!==r;)s=s|r.lanes|r.childLanes,r=r.sibling;t.childLanes=s&~i}else t.childLanes=0,t.child=null;return Qa(e,t,i,n)}if(0===(536870912&n))return t.lanes=t.childLanes=536870912,Qa(e,t,null!==a?a.baseLanes|n:n,n);t.memoizedState={baseLanes:0,cachePool:null},null!==e&&Kr(0,null!==a?a.cachePool:null),null!==a?Ar(t,a):Cr(),Or(t)}else null!==a?(Kr(0,a.cachePool),Ar(t,a),Ir(),t.memoizedState=null):(null!==e&&Kr(0,null),Cr(),Ir());return Ha(e,t,r,n),t.child}function Qa(e,t,n,i){var r=Qr();return r=null===r?null:{parent:Fr._currentValue,pool:r},t.memoizedState={baseLanes:n,cachePool:r},null!==e&&Kr(0,null),Cr(),Or(t),null!==e&&So(e,t,i,!0),null}function Ka(e,t){var n=t.ref;if(null===n)null!==e&&null!==e.ref&&(t.flags|=2097664);else{if("function"!==typeof n&&"object"!==typeof n)throw Error(a(284));null!==e&&e.ref===n||(t.flags|=2097664)}}function Za(e,t,n,i,r){return Eo(t),n=us(e,t,n,i,void 0,r),i=ms(),null===e||Ga?(Ki&&i&&qi(t),t.flags|=1,Ha(e,t,n,r),t.child):(gs(e,t,r),uo(e,t,r))}function Ja(e,t,n,i,r,s){return Eo(t),t.updateQueue=null,n=ps(t,i,n,r),ds(e),i=ms(),null===e||Ga?(Ki&&i&&qi(t),t.flags|=1,Ha(e,t,n,s),t.child):(gs(e,t,s),uo(e,t,s))}function $a(e,t,n,i,r){if(Eo(t),null===t.stateNode){var s=Ii,a=n.contextType;"object"===typeof a&&null!==a&&(s=Ao(a)),s=new n(i,s),t.memoizedState=null!==s.state&&void 0!==s.state?s.state:null,s.updater=Pa,t.stateNode=s,s._reactInternals=t,(s=t.stateNode).props=i,s.state=t.memoizedState,s.refs={},Po(t),a=n.contextType,s.context="object"===typeof a&&null!==a?Ao(a):Ii,s.state=t.memoizedState,"function"===typeof(a=n.getDerivedStateFromProps)&&(Ta(t,n,a,i),s.state=t.memoizedState),"function"===typeof n.getDerivedStateFromProps||"function"===typeof s.getSnapshotBeforeUpdate||"function"!==typeof s.UNSAFE_componentWillMount&&"function"!==typeof s.componentWillMount||(a=s.state,"function"===typeof s.componentWillMount&&s.componentWillMount(),"function"===typeof s.UNSAFE_componentWillMount&&s.UNSAFE_componentWillMount(),a!==s.state&&Pa.enqueueReplaceState(s,s.state,null),zo(t,i,s,r),Bo(),s.state=t.memoizedState),"function"===typeof s.componentDidMount&&(t.flags|=4194308),i=!0}else if(null===e){s=t.stateNode;var o=t.memoizedProps,l=Ia(n,o);s.props=l;var c=s.context,h=n.contextType;a=Ii,"object"===typeof h&&null!==h&&(a=Ao(h));var u=n.getDerivedStateFromProps;h="function"===typeof u||"function"===typeof s.getSnapshotBeforeUpdate,o=t.pendingProps!==o,h||"function"!==typeof s.UNSAFE_componentWillReceiveProps&&"function"!==typeof s.componentWillReceiveProps||(o||c!==a)&&Oa(t,s,i,a),To=!1;var d=t.memoizedState;s.state=d,zo(t,i,s,r),Bo(),c=t.memoizedState,o||d!==c||To?("function"===typeof u&&(Ta(t,n,u,i),c=t.memoizedState),(l=To||Da(t,n,l,i,d,c,a))?(h||"function"!==typeof s.UNSAFE_componentWillMount&&"function"!==typeof s.componentWillMount||("function"===typeof s.componentWillMount&&s.componentWillMount(),"function"===typeof s.UNSAFE_componentWillMount&&s.UNSAFE_componentWillMount()),"function"===typeof s.componentDidMount&&(t.flags|=4194308)):("function"===typeof s.componentDidMount&&(t.flags|=4194308),t.memoizedProps=i,t.memoizedState=c),s.props=i,s.state=c,s.context=a,i=l):("function"===typeof s.componentDidMount&&(t.flags|=4194308),i=!1)}else{s=t.stateNode,Do(e,t),h=Ia(n,a=t.memoizedProps),s.props=h,u=t.pendingProps,d=s.context,c=n.contextType,l=Ii,"object"===typeof c&&null!==c&&(l=Ao(c)),(c="function"===typeof(o=n.getDerivedStateFromProps)||"function"===typeof s.getSnapshotBeforeUpdate)||"function"!==typeof s.UNSAFE_componentWillReceiveProps&&"function"!==typeof s.componentWillReceiveProps||(a!==u||d!==l)&&Oa(t,s,i,l),To=!1,d=t.memoizedState,s.state=d,zo(t,i,s,r),Bo();var p=t.memoizedState;a!==u||d!==p||To||null!==e&&null!==e.dependencies&&_o(e.dependencies)?("function"===typeof o&&(Ta(t,n,o,i),p=t.memoizedState),(h=To||Da(t,n,h,i,d,p,l)||null!==e&&null!==e.dependencies&&_o(e.dependencies))?(c||"function"!==typeof s.UNSAFE_componentWillUpdate&&"function"!==typeof s.componentWillUpdate||("function"===typeof s.componentWillUpdate&&s.componentWillUpdate(i,p,l),"function"===typeof s.UNSAFE_componentWillUpdate&&s.UNSAFE_componentWillUpdate(i,p,l)),"function"===typeof s.componentDidUpdate&&(t.flags|=4),"function"===typeof s.getSnapshotBeforeUpdate&&(t.flags|=1024)):("function"!==typeof s.componentDidUpdate||a===e.memoizedProps&&d===e.memoizedState||(t.flags|=4),"function"!==typeof s.getSnapshotBeforeUpdate||a===e.memoizedProps&&d===e.memoizedState||(t.flags|=1024),t.memoizedProps=i,t.memoizedState=p),s.props=i,s.state=p,s.context=l,i=h):("function"!==typeof s.componentDidUpdate||a===e.memoizedProps&&d===e.memoizedState||(t.flags|=4),"function"!==typeof s.getSnapshotBeforeUpdate||a===e.memoizedProps&&d===e.memoizedState||(t.flags|=1024),i=!1)}return s=i,Ka(e,t),i=0!==(128&t.flags),s||i?(s=t.stateNode,n=i&&"function"!==typeof n.getDerivedStateFromError?null:s.render(),t.flags|=1,null!==e&&i?(t.child=wr(t,e.child,null,r),t.child=wr(t,null,n,r)):Ha(e,t,n,r),t.memoizedState=s.state,e=t.child):e=uo(e,t,r),e}function eo(e,t,n,i){return rr(),t.flags|=256,Ha(e,t,n,i),t.child}var to={dehydrated:null,treeContext:null,retryLane:0};function no(e){return{baseLanes:e,cachePool:Zr()}}function io(e,t,n){return e=null!==e?e.childLanes&~n:0,t&&(e|=fc),e}function ro(e,t,n){var i,r=t.pendingProps,s=!1,o=0!==(128&t.flags);if((i=o)||(i=(null===e||null!==e.memoizedState)&&0!==(2&kr.current)),i&&(s=!0,t.flags&=-129),i=0!==(32&t.flags),t.flags&=-33,null===e){if(Ki){if(s?Dr(t):Ir(),Ki){var l,c=Qi;if(l=c){e:{for(l=c,c=Ji;8!==l.nodeType;){if(!c){c=null;break e}if(null===(l=ou(l.nextSibling))){c=null;break e}}c=l}null!==c?(t.memoizedState={dehydrated:c,treeContext:null!==ji?{id:Vi,overflow:Gi}:null,retryLane:536870912},(l=Ll(18,null,null,0)).stateNode=c,l.return=t,t.child=l,Yi=t,Qi=null,l=!0):l=!1}l||er(t)}if(null!==(c=t.memoizedState)&&null!==(c=c.dehydrated))return"$!"===c.data?t.lanes=16:t.lanes=536870912,null;Rr(t)}return c=r.children,r=r.fallback,s?(Ir(),c=ao({mode:"hidden",children:c},s=t.mode),r=Ul(r,s,n,null),c.return=t,r.return=t,c.sibling=r,t.child=c,(s=t.child).memoizedState=no(n),s.childLanes=io(e,i,n),t.memoizedState=to,r):(Dr(t),so(t,c))}if(null!==(l=e.memoizedState)&&null!==(c=l.dehydrated)){if(o)256&t.flags?(Dr(t),t.flags&=-257,t=oo(e,t,n)):null!==t.memoizedState?(Ir(),t.child=e.child,t.flags|=128,t=null):(Ir(),s=r.fallback,c=t.mode,r=ao({mode:"visible",children:r.children},c),(s=Ul(s,c,n,null)).flags|=2,r.return=t,s.return=t,r.sibling=s,t.child=r,wr(t,e.child,null,n),(r=t.child).memoizedState=no(n),r.childLanes=io(e,i,n),t.memoizedState=to,t=s);else if(Dr(t),"$!"===c.data){if(i=c.nextSibling&&c.nextSibling.dataset)var h=i.dgst;i=h,(r=Error(a(419))).stack="",r.digest=i,sr({value:r,source:null,stack:null}),t=oo(e,t,n)}else if(Ga||So(e,t,n,!1),i=0!==(n&e.childLanes),Ga||i){if(null!==(i=tc)){if(0!==(42&(r=n&-n)))r=1;else switch(r){case 2:r=1;break;case 8:r=4;break;case 32:r=16;break;case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:r=64;break;case 268435456:r=134217728;break;default:r=0}if(0!==(r=0!==(r&(i.suspendedLanes|n))?0:r)&&r!==l.retryLane)throw l.retryLane=r,Pi(e,r),Ic(i,e,r),Va}"$?"===c.data||Hc(),t=oo(e,t,n)}else"$?"===c.data?(t.flags|=128,t.child=e.child,t=oh.bind(null,e),c._reactRetry=t,t=null):(e=l.treeContext,Qi=ou(c.nextSibling),Yi=t,Ki=!0,Zi=null,Ji=!1,null!==e&&(Fi[Ui++]=Vi,Fi[Ui++]=Gi,Fi[Ui++]=ji,Vi=e.id,Gi=e.overflow,ji=t),(t=so(t,r.children)).flags|=4096);return t}return s?(Ir(),s=r.fallback,c=t.mode,h=(l=e.child).sibling,(r=zl(l,{mode:"hidden",children:r.children})).subtreeFlags=31457280&l.subtreeFlags,null!==h?s=zl(h,s):(s=Ul(s,c,n,null)).flags|=2,s.return=t,r.return=t,r.sibling=s,t.child=r,r=s,s=t.child,null===(c=e.child.memoizedState)?c=no(n):(null!==(l=c.cachePool)?(h=Fr._currentValue,l=l.parent!==h?{parent:h,pool:h}:l):l=Zr(),c={baseLanes:c.baseLanes|n,cachePool:l}),s.memoizedState=c,s.childLanes=io(e,i,n),t.memoizedState=to,r):(Dr(t),e=(n=e.child).sibling,(n=zl(n,{mode:"visible",children:r.children})).return=t,n.sibling=null,null!==e&&(null===(i=t.deletions)?(t.deletions=[e],t.flags|=16):i.push(e)),t.child=n,t.memoizedState=null,n)}function so(e,t){return(t=ao({mode:"visible",children:t},e.mode)).return=e,e.child=t}function ao(e,t){return jl(e,t,0,null)}function oo(e,t,n){return wr(t,e.child,null,n),(e=so(t,t.pendingProps.children)).flags|=2,t.memoizedState=null,e}function lo(e,t,n){e.lanes|=t;var i=e.alternate;null!==i&&(i.lanes|=t),xo(e.return,t,n)}function co(e,t,n,i,r){var s=e.memoizedState;null===s?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:i,tail:n,tailMode:r}:(s.isBackwards=t,s.rendering=null,s.renderingStartTime=0,s.last=i,s.tail=n,s.tailMode=r)}function ho(e,t,n){var i=t.pendingProps,r=i.revealOrder,s=i.tail;if(Ha(e,t,i.children,n),0!==(2&(i=kr.current)))i=1&i|2,t.flags|=128;else{if(null!==e&&0!==(128&e.flags))e:for(e=t.child;null!==e;){if(13===e.tag)null!==e.memoizedState&&lo(e,n,t);else if(19===e.tag)lo(e,n,t);else if(null!==e.child){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;null===e.sibling;){if(null===e.return||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}i&=1}switch(Y(kr,i),r){case"forwards":for(n=t.child,r=null;null!==n;)null!==(e=n.alternate)&&null===Lr(e)&&(r=n),n=n.sibling;null===(n=r)?(r=t.child,t.child=null):(r=n.sibling,n.sibling=null),co(t,!1,r,n,s);break;case"backwards":for(n=null,r=t.child,t.child=null;null!==r;){if(null!==(e=r.alternate)&&null===Lr(e)){t.child=r;break}e=r.sibling,r.sibling=n,n=r,r=e}co(t,!0,n,null,s);break;case"together":co(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function uo(e,t,n){if(null!==e&&(t.dependencies=e.dependencies),uc|=t.lanes,0===(n&t.childLanes)){if(null===e)return null;if(So(e,t,n,!1),0===(n&t.childLanes))return null}if(null!==e&&t.child!==e.child)throw Error(a(153));if(null!==t.child){for(n=zl(e=t.child,e.pendingProps),t.child=n,n.return=t;null!==e.sibling;)e=e.sibling,(n=n.sibling=zl(e,e.pendingProps)).return=t;n.sibling=null}return t.child}function po(e,t){return 0!==(e.lanes&t)||!(null===(e=e.dependencies)||!_o(e))}function fo(e,t,n){if(null!==e)if(e.memoizedProps!==t.pendingProps)Ga=!0;else{if(!po(e,n)&&0===(128&t.flags))return Ga=!1,function(e,t,n){switch(t.tag){case 3:$(t,t.stateNode.containerInfo),yo(t,Fr,e.memoizedState.cache),rr();break;case 27:case 5:te(t);break;case 4:$(t,t.stateNode.containerInfo);break;case 10:yo(t,t.type,t.memoizedProps.value);break;case 13:var i=t.memoizedState;if(null!==i)return null!==i.dehydrated?(Dr(t),t.flags|=128,null):0!==(n&t.child.childLanes)?ro(e,t,n):(Dr(t),null!==(e=uo(e,t,n))?e.sibling:null);Dr(t);break;case 19:var r=0!==(128&e.flags);if((i=0!==(n&t.childLanes))||(So(e,t,n,!1),i=0!==(n&t.childLanes)),r){if(i)return ho(e,t,n);t.flags|=128}if(null!==(r=t.memoizedState)&&(r.rendering=null,r.tail=null,r.lastEffect=null),Y(kr,kr.current),i)break;return null;case 22:case 23:return t.lanes=0,Ya(e,t,n);case 24:yo(t,Fr,e.memoizedState.cache)}return uo(e,t,n)}(e,t,n);Ga=0!==(131072&e.flags)}else Ga=!1,Ki&&0!==(1048576&t.flags)&&Wi(t,Ni,t.index);switch(t.lanes=0,t.tag){case 16:e:{e=t.pendingProps;var i=t.elementType,r=i._init;if(i=r(i._payload),t.type=i,"function"!==typeof i){if(void 0!==i&&null!==i){if((r=i.$$typeof)===v){t.tag=11,t=Wa(null,t,i,e,n);break e}if(r===x){t.tag=14,t=qa(null,t,i,e,n);break e}}throw t=M(i)||i,Error(a(306,t,""))}Bl(i)?(e=Ia(i,e),t.tag=1,t=$a(null,t,i,e,n)):(t.tag=0,t=Za(null,t,i,e,n))}return t;case 0:return Za(e,t,t.type,t.pendingProps,n);case 1:return $a(e,t,i=t.type,r=Ia(i,t.pendingProps),n);case 3:e:{if($(t,t.stateNode.containerInfo),null===e)throw Error(a(387));var s=t.pendingProps;i=(r=t.memoizedState).element,Do(e,t),zo(t,s,null,n);var o=t.memoizedState;if(s=o.cache,yo(t,Fr,s),s!==r.cache&&wo(t,[Fr],n,!0),Bo(),s=o.element,r.isDehydrated){if(r={element:s,isDehydrated:!1,cache:o.cache},t.updateQueue.baseState=r,t.memoizedState=r,256&t.flags){t=eo(e,t,s,n);break e}if(s!==i){sr(i=ki(Error(a(424)),t)),t=eo(e,t,s,n);break e}for(Qi=ou(t.stateNode.containerInfo.firstChild),Yi=t,Ki=!0,Zi=null,Ji=!0,n=Sr(t,null,s,n),t.child=n;n;)n.flags=-3&n.flags|4096,n=n.sibling}else{if(rr(),s===i){t=uo(e,t,n);break e}Ha(e,t,s,n)}t=t.child}return t;case 26:return Ka(e,t),null===e?(n=gu(t.type,null,t.pendingProps,null))?t.memoizedState=n:Ki||(n=t.type,e=t.pendingProps,(i=Qh(Z.current).createElement(n))[Ne]=t,i[Fe]=e,qh(i,n,e),Ze(i),t.stateNode=i):t.memoizedState=gu(t.type,e.memoizedProps,t.pendingProps,e.memoizedState),null;case 27:return te(t),null===e&&Ki&&(i=t.stateNode=cu(t.type,t.pendingProps,Z.current),Yi=t,Ji=!0,Qi=ou(i.firstChild)),i=t.pendingProps.children,null!==e||Ki?Ha(e,t,i,n):t.child=wr(t,null,i,n),Ka(e,t),t.child;case 5:return null===e&&Ki&&((r=i=Qi)&&(null!==(i=function(e,t,n,i){for(;1===e.nodeType;){var r=n;if(e.nodeName.toLowerCase()!==t.toLowerCase()){if(!i&&("INPUT"!==e.nodeName||"hidden"!==e.type))break}else if(i){if(!e[We])switch(t){case"meta":if(!e.hasAttribute("itemprop"))break;return e;case"link":if("stylesheet"===(s=e.getAttribute("rel"))&&e.hasAttribute("data-precedence"))break;if(s!==r.rel||e.getAttribute("href")!==(null==r.href?null:r.href)||e.getAttribute("crossorigin")!==(null==r.crossOrigin?null:r.crossOrigin)||e.getAttribute("title")!==(null==r.title?null:r.title))break;return e;case"style":if(e.hasAttribute("data-precedence"))break;return e;case"script":if(((s=e.getAttribute("src"))!==(null==r.src?null:r.src)||e.getAttribute("type")!==(null==r.type?null:r.type)||e.getAttribute("crossorigin")!==(null==r.crossOrigin?null:r.crossOrigin))&&s&&e.hasAttribute("async")&&!e.hasAttribute("itemprop"))break;return e;default:return e}}else{if("input"!==t||"hidden"!==e.type)return e;var s=null==r.name?null:""+r.name;if("hidden"===r.type&&e.getAttribute("name")===s)return e}if(null===(e=ou(e.nextSibling)))break}return null}(i,t.type,t.pendingProps,Ji))?(t.stateNode=i,Yi=t,Qi=ou(i.firstChild),Ji=!1,r=!0):r=!1),r||er(t)),te(t),r=t.type,s=t.pendingProps,o=null!==e?e.memoizedProps:null,i=s.children,Jh(r,s)?i=null:null!==o&&Jh(r,o)&&(t.flags|=32),null!==t.memoizedState&&(r=us(e,t,fs,null,null,n),Bu._currentValue=r),Ka(e,t),Ha(e,t,i,n),t.child;case 6:return null===e&&Ki&&((e=n=Qi)&&(null!==(n=function(e,t,n){if(""===t)return null;for(;3!==e.nodeType;){if((1!==e.nodeType||"INPUT"!==e.nodeName||"hidden"!==e.type)&&!n)return null;if(null===(e=ou(e.nextSibling)))return null}return e}(n,t.pendingProps,Ji))?(t.stateNode=n,Yi=t,Qi=null,e=!0):e=!1),e||er(t)),null;case 13:return ro(e,t,n);case 4:return $(t,t.stateNode.containerInfo),i=t.pendingProps,null===e?t.child=wr(t,null,i,n):Ha(e,t,i,n),t.child;case 11:return Wa(e,t,t.type,t.pendingProps,n);case 7:return Ha(e,t,t.pendingProps,n),t.child;case 8:case 12:return Ha(e,t,t.pendingProps.children,n),t.child;case 10:return i=t.pendingProps,yo(t,t.type,i.value),Ha(e,t,i.children,n),t.child;case 9:return r=t.type._context,i=t.pendingProps.children,Eo(t),i=i(r=Ao(r)),t.flags|=1,Ha(e,t,i,n),t.child;case 14:return qa(e,t,t.type,t.pendingProps,n);case 15:return Xa(e,t,t.type,t.pendingProps,n);case 19:return ho(e,t,n);case 22:return Ya(e,t,n);case 24:return Eo(t),i=Ao(Fr),null===e?(null===(r=Qr())&&(r=tc,s=Ur(),r.pooledCache=s,s.refCount++,null!==s&&(r.pooledCacheLanes|=n),r=s),t.memoizedState={parent:i,cache:r},Po(t),yo(t,Fr,r)):(0!==(e.lanes&n)&&(Do(e,t),zo(t,null,null,n),Bo()),r=e.memoizedState,s=t.memoizedState,r.parent!==i?(r={parent:i,cache:i},t.memoizedState=r,0===t.lanes&&(t.memoizedState=t.updateQueue.baseState=r),yo(t,Fr,i)):(i=s.cache,yo(t,Fr,i),i!==r.cache&&wo(t,[Fr],n,!0))),Ha(e,t,t.pendingProps.children,n),t.child;case 29:throw t.pendingProps}throw Error(a(156,t.tag))}var mo=q(null),go=null,vo=null;function yo(e,t,n){Y(mo,t._currentValue),t._currentValue=n}function bo(e){e._currentValue=mo.current,X(mo)}function xo(e,t,n){for(;null!==e;){var i=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,null!==i&&(i.childLanes|=t)):null!==i&&(i.childLanes&t)!==t&&(i.childLanes|=t),e===n)break;e=e.return}}function wo(e,t,n,i){var r=e.child;for(null!==r&&(r.return=e);null!==r;){var s=r.dependencies;if(null!==s){var o=r.child;s=s.firstContext;e:for(;null!==s;){var l=s;s=r;for(var c=0;c<t.length;c++)if(l.context===t[c]){s.lanes|=n,null!==(l=s.alternate)&&(l.lanes|=n),xo(s.return,n,e),i||(o=null);break e}s=l.next}}else if(18===r.tag){if(null===(o=r.return))throw Error(a(341));o.lanes|=n,null!==(s=o.alternate)&&(s.lanes|=n),xo(o,n,e),o=null}else o=r.child;if(null!==o)o.return=r;else for(o=r;null!==o;){if(o===e){o=null;break}if(null!==(r=o.sibling)){r.return=o.return,o=r;break}o=o.return}r=o}}function So(e,t,n,i){e=null;for(var r=t,s=!1;null!==r;){if(!s)if(0!==(524288&r.flags))s=!0;else if(0!==(262144&r.flags))break;if(10===r.tag){var o=r.alternate;if(null===o)throw Error(a(387));if(null!==(o=o.memoizedProps)){var l=r.type;Yn(r.pendingProps.value,o.value)||(null!==e?e.push(l):e=[l])}}else if(r===J.current){if(null===(o=r.alternate))throw Error(a(387));o.memoizedState.memoizedState!==r.memoizedState.memoizedState&&(null!==e?e.push(Bu):e=[Bu])}r=r.return}null!==e&&wo(t,e,n,i),t.flags|=262144}function _o(e){for(e=e.firstContext;null!==e;){if(!Yn(e.context._currentValue,e.memoizedValue))return!0;e=e.next}return!1}function Eo(e){go=e,vo=null,null!==(e=e.dependencies)&&(e.firstContext=null)}function Ao(e){return Mo(go,e)}function Co(e,t){return null===go&&Eo(e),Mo(e,t)}function Mo(e,t){var n=t._currentValue;if(t={context:t,memoizedValue:n,next:null},null===vo){if(null===e)throw Error(a(308));vo=t,e.dependencies={lanes:0,firstContext:t},e.flags|=524288}else vo=vo.next=t;return n}var To=!1;function Po(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function Do(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,callbacks:null})}function Oo(e){return{lane:e,tag:0,payload:null,callback:null,next:null}}function Io(e,t,n){var i=e.updateQueue;if(null===i)return null;if(i=i.shared,0!==(2&ec)){var r=i.pending;return null===r?t.next=t:(t.next=r.next,r.next=t),i.pending=t,t=Oi(e),Di(e,null,n),t}return Mi(e,i,t,n),Oi(e)}function Ro(e,t,n){if(null!==(t=t.updateQueue)&&(t=t.shared,0!==(4194176&n))){var i=t.lanes;n|=i&=e.pendingLanes,t.lanes=n,ke(e,n)}}function ko(e,t){var n=e.updateQueue,i=e.alternate;if(null!==i&&n===(i=i.updateQueue)){var r=null,s=null;if(null!==(n=n.firstBaseUpdate)){do{var a={lane:n.lane,tag:n.tag,payload:n.payload,callback:null,next:null};null===s?r=s=a:s=s.next=a,n=n.next}while(null!==n);null===s?r=s=t:s=s.next=t}else r=s=t;return n={baseState:i.baseState,firstBaseUpdate:r,lastBaseUpdate:s,shared:i.shared,callbacks:i.callbacks},void(e.updateQueue=n)}null===(e=n.lastBaseUpdate)?n.firstBaseUpdate=t:e.next=t,n.lastBaseUpdate=t}var Lo=!1;function Bo(){if(Lo){if(null!==Wr)throw Wr}}function zo(e,t,n,i){Lo=!1;var r=e.updateQueue;To=!1;var s=r.firstBaseUpdate,a=r.lastBaseUpdate,o=r.shared.pending;if(null!==o){r.shared.pending=null;var l=o,c=l.next;l.next=null,null===a?s=c:a.next=c,a=l;var h=e.alternate;null!==h&&((o=(h=h.updateQueue).lastBaseUpdate)!==a&&(null===o?h.firstBaseUpdate=c:o.next=c,h.lastBaseUpdate=l))}if(null!==s){var u=r.baseState;for(a=0,h=c=l=null,o=s;;){var d=-536870913&o.lane,p=d!==o.lane;if(p?(ic&d)===d:(i&d)===d){0!==d&&d===Hr&&(Lo=!0),null!==h&&(h=h.next={lane:0,tag:o.tag,payload:o.payload,callback:null,next:null});e:{var f=e,m=o;d=t;var g=n;switch(m.tag){case 1:if("function"===typeof(f=m.payload)){u=f.call(g,u,d);break e}u=f;break e;case 3:f.flags=-65537&f.flags|128;case 0:if(null===(d="function"===typeof(f=m.payload)?f.call(g,u,d):f)||void 0===d)break e;u=O({},u,d);break e;case 2:To=!0}}null!==(d=o.callback)&&(e.flags|=64,p&&(e.flags|=8192),null===(p=r.callbacks)?r.callbacks=[d]:p.push(d))}else p={lane:d,tag:o.tag,payload:o.payload,callback:o.callback,next:null},null===h?(c=h=p,l=u):h=h.next=p,a|=d;if(null===(o=o.next)){if(null===(o=r.shared.pending))break;o=(p=o).next,p.next=null,r.lastBaseUpdate=p,r.shared.pending=null}}null===h&&(l=u),r.baseState=l,r.firstBaseUpdate=c,r.lastBaseUpdate=h,null===s&&(r.shared.lanes=0),uc|=a,e.lanes=a,e.memoizedState=u}}function No(e,t){if("function"!==typeof e)throw Error(a(191,e));e.call(t)}function Fo(e,t){var n=e.callbacks;if(null!==n)for(e.callbacks=null,e=0;e<n.length;e++)No(n[e],t)}function Uo(e,t){try{var n=t.updateQueue,i=null!==n?n.lastEffect:null;if(null!==i){var r=i.next;n=r;do{if((n.tag&e)===e){i=void 0;var s=n.create,a=n.inst;i=s(),a.destroy=i}n=n.next}while(n!==r)}}catch(o){ih(t,t.return,o)}}function jo(e,t,n){try{var i=t.updateQueue,r=null!==i?i.lastEffect:null;if(null!==r){var s=r.next;i=s;do{if((i.tag&e)===e){var a=i.inst,o=a.destroy;if(void 0!==o){a.destroy=void 0,r=t;var l=n;try{o()}catch(c){ih(r,l,c)}}}i=i.next}while(i!==s)}}catch(c){ih(t,t.return,c)}}function Vo(e){var t=e.updateQueue;if(null!==t){var n=e.stateNode;try{Fo(t,n)}catch(i){ih(e,e.return,i)}}}function Go(e,t,n){n.props=Ia(e.type,e.memoizedProps),n.state=e.memoizedState;try{n.componentWillUnmount()}catch(i){ih(e,t,i)}}function Ho(e,t){try{var n=e.ref;if(null!==n){var i=e.stateNode;switch(e.tag){case 26:case 27:case 5:var r=i;break;default:r=i}"function"===typeof n?e.refCleanup=n(r):n.current=r}}catch(s){ih(e,t,s)}}function Wo(e,t){var n=e.ref,i=e.refCleanup;if(null!==n)if("function"===typeof i)try{i()}catch(r){ih(e,t,r)}finally{e.refCleanup=null,null!=(e=e.alternate)&&(e.refCleanup=null)}else if("function"===typeof n)try{n(null)}catch(s){ih(e,t,s)}else n.current=null}function qo(e){var t=e.type,n=e.memoizedProps,i=e.stateNode;try{e:switch(t){case"button":case"input":case"select":case"textarea":n.autoFocus&&i.focus();break e;case"img":n.src?i.src=n.src:n.srcSet&&(i.srcset=n.srcSet)}}catch(r){ih(e,e.return,r)}}function Xo(e,t,n){try{var i=e.stateNode;!function(e,t,n,i){switch(t){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var r=null,s=null,o=null,l=null,c=null,h=null,u=null;for(f in n){var d=n[f];if(n.hasOwnProperty(f)&&null!=d)switch(f){case"checked":case"value":break;case"defaultValue":c=d;default:i.hasOwnProperty(f)||Hh(e,t,f,null,i,d)}}for(var p in i){var f=i[p];if(d=n[p],i.hasOwnProperty(p)&&(null!=f||null!=d))switch(p){case"type":s=f;break;case"name":r=f;break;case"checked":h=f;break;case"defaultChecked":u=f;break;case"value":o=f;break;case"defaultValue":l=f;break;case"children":case"dangerouslySetInnerHTML":if(null!=f)throw Error(a(137,t));break;default:f!==d&&Hh(e,t,p,f,i,d)}}return void gt(e,o,l,c,h,u,s,r);case"select":for(s in f=o=l=p=null,n)if(c=n[s],n.hasOwnProperty(s)&&null!=c)switch(s){case"value":break;case"multiple":f=c;default:i.hasOwnProperty(s)||Hh(e,t,s,null,i,c)}for(r in i)if(s=i[r],c=n[r],i.hasOwnProperty(r)&&(null!=s||null!=c))switch(r){case"value":p=s;break;case"defaultValue":l=s;break;case"multiple":o=s;default:s!==c&&Hh(e,t,r,s,i,c)}return t=l,n=o,i=f,void(null!=p?bt(e,!!n,p,!1):!!i!==!!n&&(null!=t?bt(e,!!n,t,!0):bt(e,!!n,n?[]:"",!1)));case"textarea":for(l in f=p=null,n)if(r=n[l],n.hasOwnProperty(l)&&null!=r&&!i.hasOwnProperty(l))switch(l){case"value":case"children":break;default:Hh(e,t,l,null,i,r)}for(o in i)if(r=i[o],s=n[o],i.hasOwnProperty(o)&&(null!=r||null!=s))switch(o){case"value":p=r;break;case"defaultValue":f=r;break;case"children":break;case"dangerouslySetInnerHTML":if(null!=r)throw Error(a(91));break;default:r!==s&&Hh(e,t,o,r,i,s)}return void xt(e,p,f);case"option":for(var m in n)if(p=n[m],n.hasOwnProperty(m)&&null!=p&&!i.hasOwnProperty(m))if("selected"===m)e.selected=!1;else Hh(e,t,m,null,i,p);for(c in i)if(p=i[c],f=n[c],i.hasOwnProperty(c)&&p!==f&&(null!=p||null!=f))if("selected"===c)e.selected=p&&"function"!==typeof p&&"symbol"!==typeof p;else Hh(e,t,c,p,i,f);return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var g in n)p=n[g],n.hasOwnProperty(g)&&null!=p&&!i.hasOwnProperty(g)&&Hh(e,t,g,null,i,p);for(h in i)if(p=i[h],f=n[h],i.hasOwnProperty(h)&&p!==f&&(null!=p||null!=f))switch(h){case"children":case"dangerouslySetInnerHTML":if(null!=p)throw Error(a(137,t));break;default:Hh(e,t,h,p,i,f)}return;default:if(Ct(t)){for(var v in n)p=n[v],n.hasOwnProperty(v)&&void 0!==p&&!i.hasOwnProperty(v)&&Wh(e,t,v,void 0,i,p);for(u in i)p=i[u],f=n[u],!i.hasOwnProperty(u)||p===f||void 0===p&&void 0===f||Wh(e,t,u,p,i,f);return}}for(var y in n)p=n[y],n.hasOwnProperty(y)&&null!=p&&!i.hasOwnProperty(y)&&Hh(e,t,y,null,i,p);for(d in i)p=i[d],f=n[d],!i.hasOwnProperty(d)||p===f||null==p&&null==f||Hh(e,t,d,p,i,f)}(i,e.type,n,t),i[Fe]=t}catch(r){ih(e,e.return,r)}}function Yo(e){return 5===e.tag||3===e.tag||26===e.tag||27===e.tag||4===e.tag}function Qo(e){e:for(;;){for(;null===e.sibling;){if(null===e.return||Yo(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;5!==e.tag&&6!==e.tag&&27!==e.tag&&18!==e.tag;){if(2&e.flags)continue e;if(null===e.child||4===e.tag)continue e;e.child.return=e,e=e.child}if(!(2&e.flags))return e.stateNode}}function Ko(e,t,n){var i=e.tag;if(5===i||6===i)e=e.stateNode,t?8===n.nodeType?n.parentNode.insertBefore(e,t):n.insertBefore(e,t):(8===n.nodeType?(t=n.parentNode).insertBefore(e,n):(t=n).appendChild(e),null!==(n=n._reactRootContainer)&&void 0!==n||null!==t.onclick||(t.onclick=Gh));else if(4!==i&&27!==i&&null!==(e=e.child))for(Ko(e,t,n),e=e.sibling;null!==e;)Ko(e,t,n),e=e.sibling}function Zo(e,t,n){var i=e.tag;if(5===i||6===i)e=e.stateNode,t?n.insertBefore(e,t):n.appendChild(e);else if(4!==i&&27!==i&&null!==(e=e.child))for(Zo(e,t,n),e=e.sibling;null!==e;)Zo(e,t,n),e=e.sibling}var Jo=!1,$o=!1,el=!1,tl="function"===typeof WeakSet?WeakSet:Set,nl=null,il=!1;function rl(e,t,n){var i=n.flags;switch(n.tag){case 0:case 11:case 15:vl(e,n),4&i&&Uo(5,n);break;case 1:if(vl(e,n),4&i)if(e=n.stateNode,null===t)try{e.componentDidMount()}catch(o){ih(n,n.return,o)}else{var r=Ia(n.type,t.memoizedProps);t=t.memoizedState;try{e.componentDidUpdate(r,t,e.__reactInternalSnapshotBeforeUpdate)}catch(l){ih(n,n.return,l)}}64&i&&Vo(n),512&i&&Ho(n,n.return);break;case 3:if(vl(e,n),64&i&&null!==(i=n.updateQueue)){if(e=null,null!==n.child)switch(n.child.tag){case 27:case 5:case 1:e=n.child.stateNode}try{Fo(i,e)}catch(o){ih(n,n.return,o)}}break;case 26:vl(e,n),512&i&&Ho(n,n.return);break;case 27:case 5:vl(e,n),null===t&&4&i&&qo(n),512&i&&Ho(n,n.return);break;case 12:default:vl(e,n);break;case 13:vl(e,n),4&i&&hl(e,n);break;case 22:if(!(r=null!==n.memoizedState||Jo)){t=null!==t&&null!==t.memoizedState||$o;var s=Jo,a=$o;Jo=r,($o=t)&&!a?bl(e,n,0!==(8772&n.subtreeFlags)):vl(e,n),Jo=s,$o=a}512&i&&("manual"===n.memoizedProps.mode?Ho(n,n.return):Wo(n,n.return))}}function sl(e){var t=e.alternate;null!==t&&(e.alternate=null,sl(t)),e.child=null,e.deletions=null,e.sibling=null,5===e.tag&&(null!==(t=e.stateNode)&&qe(t)),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}var al=null,ol=!1;function ll(e,t,n){for(n=n.child;null!==n;)cl(e,t,n),n=n.sibling}function cl(e,t,n){if(ye&&"function"===typeof ye.onCommitFiberUnmount)try{ye.onCommitFiberUnmount(ve,n)}catch(a){}switch(n.tag){case 26:$o||Wo(n,t),ll(e,t,n),n.memoizedState?n.memoizedState.count--:n.stateNode&&(n=n.stateNode).parentNode.removeChild(n);break;case 27:$o||Wo(n,t);var i=al,r=ol;for(al=n.stateNode,ll(e,t,n),t=(n=n.stateNode).attributes;t.length;)n.removeAttributeNode(t[0]);qe(n),al=i,ol=r;break;case 5:$o||Wo(n,t);case 6:r=al;var s=ol;if(al=null,ll(e,t,n),ol=s,null!==(al=r))if(ol)try{e=al,i=n.stateNode,8===e.nodeType?e.parentNode.removeChild(i):e.removeChild(i)}catch(o){ih(n,t,o)}else try{al.removeChild(n.stateNode)}catch(o){ih(n,t,o)}break;case 18:null!==al&&(ol?(t=al,n=n.stateNode,8===t.nodeType?su(t.parentNode,n):1===t.nodeType&&su(t,n),md(t)):su(al,n.stateNode));break;case 4:i=al,r=ol,al=n.stateNode.containerInfo,ol=!0,ll(e,t,n),al=i,ol=r;break;case 0:case 11:case 14:case 15:$o||jo(2,n,t),$o||jo(4,n,t),ll(e,t,n);break;case 1:$o||(Wo(n,t),"function"===typeof(i=n.stateNode).componentWillUnmount&&Go(n,t,i)),ll(e,t,n);break;case 21:ll(e,t,n);break;case 22:$o||Wo(n,t),$o=(i=$o)||null!==n.memoizedState,ll(e,t,n),$o=i;break;default:ll(e,t,n)}}function hl(e,t){if(null===t.memoizedState&&(null!==(e=t.alternate)&&(null!==(e=e.memoizedState)&&null!==(e=e.dehydrated))))try{md(e)}catch(n){ih(t,t.return,n)}}function ul(e,t){var n=function(e){switch(e.tag){case 13:case 19:var t=e.stateNode;return null===t&&(t=e.stateNode=new tl),t;case 22:return null===(t=(e=e.stateNode)._retryCache)&&(t=e._retryCache=new tl),t;default:throw Error(a(435,e.tag))}}(e);t.forEach((function(t){var i=lh.bind(null,e,t);n.has(t)||(n.add(t),t.then(i,i))}))}function dl(e,t){var n=t.deletions;if(null!==n)for(var i=0;i<n.length;i++){var r=n[i],s=e,o=t,l=o;e:for(;null!==l;){switch(l.tag){case 27:case 5:al=l.stateNode,ol=!1;break e;case 3:case 4:al=l.stateNode.containerInfo,ol=!0;break e}l=l.return}if(null===al)throw Error(a(160));cl(s,o,r),al=null,ol=!1,null!==(s=r.alternate)&&(s.return=null),r.return=null}if(13878&t.subtreeFlags)for(t=t.child;null!==t;)fl(t,e),t=t.sibling}var pl=null;function fl(e,t){var n=e.alternate,i=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:dl(t,e),ml(e),4&i&&(jo(3,e,e.return),Uo(3,e),jo(5,e,e.return));break;case 1:dl(t,e),ml(e),512&i&&($o||null===n||Wo(n,n.return)),64&i&&Jo&&(null!==(e=e.updateQueue)&&(null!==(i=e.callbacks)&&(n=e.shared.hiddenCallbacks,e.shared.hiddenCallbacks=null===n?i:n.concat(i))));break;case 26:var r=pl;if(dl(t,e),ml(e),512&i&&($o||null===n||Wo(n,n.return)),4&i){var s=null!==n?n.memoizedState:null;if(i=e.memoizedState,null===n)if(null===i)if(null===e.stateNode){e:{i=e.type,n=e.memoizedProps,r=r.ownerDocument||r;t:switch(i){case"title":(!(s=r.getElementsByTagName("title")[0])||s[We]||s[Ne]||"http://www.w3.org/2000/svg"===s.namespaceURI||s.hasAttribute("itemprop"))&&(s=r.createElement(i),r.head.insertBefore(s,r.querySelector("head > title"))),qh(s,i,n),s[Ne]=e,Ze(s),i=s;break e;case"link":var o=Mu("link","href",r).get(i+(n.href||""));if(o)for(var l=0;l<o.length;l++)if((s=o[l]).getAttribute("href")===(null==n.href?null:n.href)&&s.getAttribute("rel")===(null==n.rel?null:n.rel)&&s.getAttribute("title")===(null==n.title?null:n.title)&&s.getAttribute("crossorigin")===(null==n.crossOrigin?null:n.crossOrigin)){o.splice(l,1);break t}qh(s=r.createElement(i),i,n),r.head.appendChild(s);break;case"meta":if(o=Mu("meta","content",r).get(i+(n.content||"")))for(l=0;l<o.length;l++)if((s=o[l]).getAttribute("content")===(null==n.content?null:""+n.content)&&s.getAttribute("name")===(null==n.name?null:n.name)&&s.getAttribute("property")===(null==n.property?null:n.property)&&s.getAttribute("http-equiv")===(null==n.httpEquiv?null:n.httpEquiv)&&s.getAttribute("charset")===(null==n.charSet?null:n.charSet)){o.splice(l,1);break t}qh(s=r.createElement(i),i,n),r.head.appendChild(s);break;default:throw Error(a(468,i))}s[Ne]=e,Ze(s),i=s}e.stateNode=i}else Tu(r,e.type,e.stateNode);else e.stateNode=Su(r,i,e.memoizedProps);else s!==i?(null===s?null!==n.stateNode&&(n=n.stateNode).parentNode.removeChild(n):s.count--,null===i?Tu(r,e.type,e.stateNode):Su(r,i,e.memoizedProps)):null===i&&null!==e.stateNode&&Xo(e,e.memoizedProps,n.memoizedProps)}break;case 27:if(4&i&&null===e.alternate){r=e.stateNode,s=e.memoizedProps;try{for(var c=r.firstChild;c;){var h=c.nextSibling,u=c.nodeName;c[We]||"HEAD"===u||"BODY"===u||"SCRIPT"===u||"STYLE"===u||"LINK"===u&&"stylesheet"===c.rel.toLowerCase()||r.removeChild(c),c=h}for(var d=e.type,p=r.attributes;p.length;)r.removeAttributeNode(p[0]);qh(r,d,s),r[Ne]=e,r[Fe]=s}catch(m){ih(e,e.return,m)}}case 5:if(dl(t,e),ml(e),512&i&&($o||null===n||Wo(n,n.return)),32&e.flags){r=e.stateNode;try{St(r,"")}catch(m){ih(e,e.return,m)}}4&i&&null!=e.stateNode&&Xo(e,r=e.memoizedProps,null!==n?n.memoizedProps:r),1024&i&&(el=!0);break;case 6:if(dl(t,e),ml(e),4&i){if(null===e.stateNode)throw Error(a(162));i=e.memoizedProps,n=e.stateNode;try{n.nodeValue=i}catch(m){ih(e,e.return,m)}}break;case 3:if(Cu=null,r=pl,pl=du(t.containerInfo),dl(t,e),pl=r,ml(e),4&i&&null!==n&&n.memoizedState.isDehydrated)try{md(t.containerInfo)}catch(m){ih(e,e.return,m)}el&&(el=!1,gl(e));break;case 4:i=pl,pl=du(e.stateNode.containerInfo),dl(t,e),ml(e),pl=i;break;case 12:dl(t,e),ml(e);break;case 13:dl(t,e),ml(e),8192&e.child.flags&&null!==e.memoizedState!==(null!==n&&null!==n.memoizedState)&&(bc=le()),4&i&&(null!==(i=e.updateQueue)&&(e.updateQueue=null,ul(e,i)));break;case 22:if(512&i&&($o||null===n||Wo(n,n.return)),c=null!==e.memoizedState,h=null!==n&&null!==n.memoizedState,Jo=(u=Jo)||c,$o=(d=$o)||h,dl(t,e),$o=d,Jo=u,ml(e),(t=e.stateNode)._current=e,t._visibility&=-3,t._visibility|=2&t._pendingVisibility,8192&i&&(t._visibility=c?-2&t._visibility:1|t._visibility,c&&(t=Jo||$o,null===n||h||t||yl(e)),null===e.memoizedProps||"manual"!==e.memoizedProps.mode))e:for(n=null,t=e;;){if(5===t.tag||26===t.tag||27===t.tag){if(null===n){h=n=t;try{if(r=h.stateNode,c)"function"===typeof(s=r.style).setProperty?s.setProperty("display","none","important"):s.display="none";else{o=h.stateNode;var f=void 0!==(l=h.memoizedProps.style)&&null!==l&&l.hasOwnProperty("display")?l.display:null;o.style.display=null==f||"boolean"===typeof f?"":(""+f).trim()}}catch(m){ih(h,h.return,m)}}}else if(6===t.tag){if(null===n){h=t;try{h.stateNode.nodeValue=c?"":h.memoizedProps}catch(m){ih(h,h.return,m)}}}else if((22!==t.tag&&23!==t.tag||null===t.memoizedState||t===e)&&null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;null===t.sibling;){if(null===t.return||t.return===e)break e;n===t&&(n=null),t=t.return}n===t&&(n=null),t.sibling.return=t.return,t=t.sibling}4&i&&(null!==(i=e.updateQueue)&&(null!==(n=i.retryQueue)&&(i.retryQueue=null,ul(e,n))));break;case 19:dl(t,e),ml(e),4&i&&(null!==(i=e.updateQueue)&&(e.updateQueue=null,ul(e,i)));break;case 21:break;default:dl(t,e),ml(e)}}function ml(e){var t=e.flags;if(2&t){try{if(27!==e.tag){e:{for(var n=e.return;null!==n;){if(Yo(n)){var i=n;break e}n=n.return}throw Error(a(160))}switch(i.tag){case 27:var r=i.stateNode;Zo(e,Qo(e),r);break;case 5:var s=i.stateNode;32&i.flags&&(St(s,""),i.flags&=-33),Zo(e,Qo(e),s);break;case 3:case 4:var o=i.stateNode.containerInfo;Ko(e,Qo(e),o);break;default:throw Error(a(161))}}}catch(l){ih(e,e.return,l)}e.flags&=-3}4096&t&&(e.flags&=-4097)}function gl(e){if(1024&e.subtreeFlags)for(e=e.child;null!==e;){var t=e;gl(t),5===t.tag&&1024&t.flags&&t.stateNode.reset(),e=e.sibling}}function vl(e,t){if(8772&t.subtreeFlags)for(t=t.child;null!==t;)rl(e,t.alternate,t),t=t.sibling}function yl(e){for(e=e.child;null!==e;){var t=e;switch(t.tag){case 0:case 11:case 14:case 15:jo(4,t,t.return),yl(t);break;case 1:Wo(t,t.return);var n=t.stateNode;"function"===typeof n.componentWillUnmount&&Go(t,t.return,n),yl(t);break;case 26:case 27:case 5:Wo(t,t.return),yl(t);break;case 22:Wo(t,t.return),null===t.memoizedState&&yl(t);break;default:yl(t)}e=e.sibling}}function bl(e,t,n){for(n=n&&0!==(8772&t.subtreeFlags),t=t.child;null!==t;){var i=t.alternate,r=e,s=t,a=s.flags;switch(s.tag){case 0:case 11:case 15:bl(r,s,n),Uo(4,s);break;case 1:if(bl(r,s,n),"function"===typeof(r=(i=s).stateNode).componentDidMount)try{r.componentDidMount()}catch(c){ih(i,i.return,c)}if(null!==(r=(i=s).updateQueue)){var o=i.stateNode;try{var l=r.shared.hiddenCallbacks;if(null!==l)for(r.shared.hiddenCallbacks=null,r=0;r<l.length;r++)No(l[r],o)}catch(c){ih(i,i.return,c)}}n&&64&a&&Vo(s),Ho(s,s.return);break;case 26:case 27:case 5:bl(r,s,n),n&&null===i&&4&a&&qo(s),Ho(s,s.return);break;case 12:default:bl(r,s,n);break;case 13:bl(r,s,n),n&&4&a&&hl(r,s);break;case 22:null===s.memoizedState&&bl(r,s,n),Ho(s,s.return)}t=t.sibling}}function xl(e,t){var n=null;null!==e&&null!==e.memoizedState&&null!==e.memoizedState.cachePool&&(n=e.memoizedState.cachePool.pool),e=null,null!==t.memoizedState&&null!==t.memoizedState.cachePool&&(e=t.memoizedState.cachePool.pool),e!==n&&(null!=e&&e.refCount++,null!=n&&jr(n))}function wl(e,t){e=null,null!==t.alternate&&(e=t.alternate.memoizedState.cache),(t=t.memoizedState.cache)!==e&&(t.refCount++,null!=e&&jr(e))}function Sl(e,t,n,i){if(10256&t.subtreeFlags)for(t=t.child;null!==t;)_l(e,t,n,i),t=t.sibling}function _l(e,t,n,i){var r=t.flags;switch(t.tag){case 0:case 11:case 15:Sl(e,t,n,i),2048&r&&Uo(9,t);break;case 3:Sl(e,t,n,i),2048&r&&(e=null,null!==t.alternate&&(e=t.alternate.memoizedState.cache),(t=t.memoizedState.cache)!==e&&(t.refCount++,null!=e&&jr(e)));break;case 12:if(2048&r){Sl(e,t,n,i),e=t.stateNode;try{var s=t.memoizedProps,a=s.id,o=s.onPostCommit;"function"===typeof o&&o(a,null===t.alternate?"mount":"update",e.passiveEffectDuration,-0)}catch(l){ih(t,t.return,l)}}else Sl(e,t,n,i);break;case 23:break;case 22:s=t.stateNode,null!==t.memoizedState?4&s._visibility?Sl(e,t,n,i):Al(e,t):4&s._visibility?Sl(e,t,n,i):(s._visibility|=4,El(e,t,n,i,0!==(10256&t.subtreeFlags))),2048&r&&xl(t.alternate,t);break;case 24:Sl(e,t,n,i),2048&r&&wl(t.alternate,t);break;default:Sl(e,t,n,i)}}function El(e,t,n,i,r){for(r=r&&0!==(10256&t.subtreeFlags),t=t.child;null!==t;){var s=e,a=t,o=n,l=i,c=a.flags;switch(a.tag){case 0:case 11:case 15:El(s,a,o,l,r),Uo(8,a);break;case 23:break;case 22:var h=a.stateNode;null!==a.memoizedState?4&h._visibility?El(s,a,o,l,r):Al(s,a):(h._visibility|=4,El(s,a,o,l,r)),r&&2048&c&&xl(a.alternate,a);break;case 24:El(s,a,o,l,r),r&&2048&c&&wl(a.alternate,a);break;default:El(s,a,o,l,r)}t=t.sibling}}function Al(e,t){if(10256&t.subtreeFlags)for(t=t.child;null!==t;){var n=e,i=t,r=i.flags;switch(i.tag){case 22:Al(n,i),2048&r&&xl(i.alternate,i);break;case 24:Al(n,i),2048&r&&wl(i.alternate,i);break;default:Al(n,i)}t=t.sibling}}var Cl=8192;function Ml(e){if(e.subtreeFlags&Cl)for(e=e.child;null!==e;)Tl(e),e=e.sibling}function Tl(e){switch(e.tag){case 26:Ml(e),e.flags&Cl&&null!==e.memoizedState&&function(e,t,n){if(null===Du)throw Error(a(475));var i=Du;if("stylesheet"===t.type&&("string"!==typeof n.media||!1!==matchMedia(n.media).matches)&&0===(4&t.state.loading)){if(null===t.instance){var r=vu(n.href),s=e.querySelector(yu(r));if(s)return null!==(e=s._p)&&"object"===typeof e&&"function"===typeof e.then&&(i.count++,i=Iu.bind(i),e.then(i,i)),t.state.loading|=4,t.instance=s,void Ze(s);s=e.ownerDocument||e,n=bu(n),(r=hu.get(r))&&Eu(n,r),Ze(s=s.createElement("link"));var o=s;o._p=new Promise((function(e,t){o.onload=e,o.onerror=t})),qh(s,"link",n),t.instance=s}null===i.stylesheets&&(i.stylesheets=new Map),i.stylesheets.set(t,e),(e=t.state.preload)&&0===(3&t.state.loading)&&(i.count++,t=Iu.bind(i),e.addEventListener("load",t),e.addEventListener("error",t))}}(pl,e.memoizedState,e.memoizedProps);break;case 5:default:Ml(e);break;case 3:case 4:var t=pl;pl=du(e.stateNode.containerInfo),Ml(e),pl=t;break;case 22:null===e.memoizedState&&(null!==(t=e.alternate)&&null!==t.memoizedState?(t=Cl,Cl=16777216,Ml(e),Cl=t):Ml(e))}}function Pl(e){var t=e.alternate;if(null!==t&&null!==(e=t.child)){t.child=null;do{t=e.sibling,e.sibling=null,e=t}while(null!==e)}}function Dl(e){var t=e.deletions;if(0!==(16&e.flags)){if(null!==t)for(var n=0;n<t.length;n++){var i=t[n];nl=i,Rl(i,e)}Pl(e)}if(10256&e.subtreeFlags)for(e=e.child;null!==e;)Ol(e),e=e.sibling}function Ol(e){switch(e.tag){case 0:case 11:case 15:Dl(e),2048&e.flags&&jo(9,e,e.return);break;case 3:case 12:default:Dl(e);break;case 22:var t=e.stateNode;null!==e.memoizedState&&4&t._visibility&&(null===e.return||13!==e.return.tag)?(t._visibility&=-5,Il(e)):Dl(e)}}function Il(e){var t=e.deletions;if(0!==(16&e.flags)){if(null!==t)for(var n=0;n<t.length;n++){var i=t[n];nl=i,Rl(i,e)}Pl(e)}for(e=e.child;null!==e;){switch((t=e).tag){case 0:case 11:case 15:jo(8,t,t.return),Il(t);break;case 22:4&(n=t.stateNode)._visibility&&(n._visibility&=-5,Il(t));break;default:Il(t)}e=e.sibling}}function Rl(e,t){for(;null!==nl;){var n=nl;switch(n.tag){case 0:case 11:case 15:jo(8,n,t);break;case 23:case 22:if(null!==n.memoizedState&&null!==n.memoizedState.cachePool){var i=n.memoizedState.cachePool.pool;null!=i&&i.refCount++}break;case 24:jr(n.memoizedState.cache)}if(null!==(i=n.child))i.return=n,nl=i;else e:for(n=e;null!==nl;){var r=(i=nl).sibling,s=i.return;if(sl(i),i===n){nl=null;break e}if(null!==r){r.return=s,nl=r;break e}nl=s}}}function kl(e,t,n,i){this.tag=e,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=i,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Ll(e,t,n,i){return new kl(e,t,n,i)}function Bl(e){return!(!(e=e.prototype)||!e.isReactComponent)}function zl(e,t){var n=e.alternate;return null===n?((n=Ll(e.tag,t,e.key,e.mode)).elementType=e.elementType,n.type=e.type,n.stateNode=e.stateNode,n.alternate=e,e.alternate=n):(n.pendingProps=t,n.type=e.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=31457280&e.flags,n.childLanes=e.childLanes,n.lanes=e.lanes,n.child=e.child,n.memoizedProps=e.memoizedProps,n.memoizedState=e.memoizedState,n.updateQueue=e.updateQueue,t=e.dependencies,n.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext},n.sibling=e.sibling,n.index=e.index,n.ref=e.ref,n.refCleanup=e.refCleanup,n}function Nl(e,t){e.flags&=31457282;var n=e.alternate;return null===n?(e.childLanes=0,e.lanes=t,e.child=null,e.subtreeFlags=0,e.memoizedProps=null,e.memoizedState=null,e.updateQueue=null,e.dependencies=null,e.stateNode=null):(e.childLanes=n.childLanes,e.lanes=n.lanes,e.child=n.child,e.subtreeFlags=0,e.deletions=null,e.memoizedProps=n.memoizedProps,e.memoizedState=n.memoizedState,e.updateQueue=n.updateQueue,e.type=n.type,t=n.dependencies,e.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext}),e}function Fl(e,t,n,i,r,s){var o=0;if(i=e,"function"===typeof e)Bl(e)&&(o=1);else if("string"===typeof e)o=function(e,t,n){if(1===n||null!=t.itemProp)return!1;switch(e){case"meta":case"title":return!0;case"style":if("string"!==typeof t.precedence||"string"!==typeof t.href||""===t.href)break;return!0;case"link":if("string"!==typeof t.rel||"string"!==typeof t.href||""===t.href||t.onLoad||t.onError)break;return"stylesheet"!==t.rel||(e=t.disabled,"string"===typeof t.precedence&&null==e);case"script":if(t.async&&"function"!==typeof t.async&&"symbol"!==typeof t.async&&!t.onLoad&&!t.onError&&t.src&&"string"===typeof t.src)return!0}return!1}(e,n,Q.current)?26:"html"===e||"head"===e||"body"===e?27:5;else e:switch(e){case u:return Ul(n.children,r,s,t);case d:o=8,r|=24;break;case p:return(e=Ll(12,n,t,2|r)).elementType=p,e.lanes=s,e;case y:return(e=Ll(13,n,t,r)).elementType=y,e.lanes=s,e;case b:return(e=Ll(19,n,t,r)).elementType=b,e.lanes=s,e;case S:return jl(n,r,s,t);default:if("object"===typeof e&&null!==e)switch(e.$$typeof){case f:case g:o=10;break e;case m:o=9;break e;case v:o=11;break e;case x:o=14;break e;case w:o=16,i=null;break e}o=29,n=Error(a(130,null===e?"null":typeof e,"")),i=null}return(t=Ll(o,n,t,r)).elementType=e,t.type=i,t.lanes=s,t}function Ul(e,t,n,i){return(e=Ll(7,e,i,t)).lanes=n,e}function jl(e,t,n,i){(e=Ll(22,e,i,t)).elementType=S,e.lanes=n;var r={_visibility:1,_pendingVisibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null,_current:null,detach:function(){var e=r._current;if(null===e)throw Error(a(456));if(0===(2&r._pendingVisibility)){var t=Pi(e,2);null!==t&&(r._pendingVisibility|=2,Ic(t,e,2))}},attach:function(){var e=r._current;if(null===e)throw Error(a(456));if(0!==(2&r._pendingVisibility)){var t=Pi(e,2);null!==t&&(r._pendingVisibility&=-3,Ic(t,e,2))}}};return e.stateNode=r,e}function Vl(e,t,n){return(e=Ll(6,e,null,t)).lanes=n,e}function Gl(e,t,n){return(t=Ll(4,null!==e.children?e.children:[],e.key,t)).lanes=n,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function Hl(e){e.flags|=4}function Wl(e,t){if("stylesheet"!==t.type||0!==(4&t.state.loading))e.flags&=-16777217;else if(e.flags|=16777216,!Pu(t)){if(null!==(t=Tr.current)&&((4194176&ic)===ic?null!==Pr:(62914560&ic)!==ic&&0===(536870912&ic)||t!==Pr))throw dr=lr,or;e.flags|=8192}}function ql(e,t){null!==t&&(e.flags|=4),16384&e.flags&&(t=22!==e.tag?De():536870912,e.lanes|=t,mc|=t)}function Xl(e,t){if(!Ki)switch(e.tailMode){case"hidden":t=e.tail;for(var n=null;null!==t;)null!==t.alternate&&(n=t),t=t.sibling;null===n?e.tail=null:n.sibling=null;break;case"collapsed":n=e.tail;for(var i=null;null!==n;)null!==n.alternate&&(i=n),n=n.sibling;null===i?t||null===e.tail?e.tail=null:e.tail.sibling=null:i.sibling=null}}function Yl(e){var t=null!==e.alternate&&e.alternate.child===e.child,n=0,i=0;if(t)for(var r=e.child;null!==r;)n|=r.lanes|r.childLanes,i|=31457280&r.subtreeFlags,i|=31457280&r.flags,r.return=e,r=r.sibling;else for(r=e.child;null!==r;)n|=r.lanes|r.childLanes,i|=r.subtreeFlags,i|=r.flags,r.return=e,r=r.sibling;return e.subtreeFlags|=i,e.childLanes=n,t}function Ql(e,t,n){var i=t.pendingProps;switch(Xi(t),t.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:case 1:return Yl(t),null;case 3:return n=t.stateNode,i=null,null!==e&&(i=e.memoizedState.cache),t.memoizedState.cache!==i&&(t.flags|=2048),bo(Fr),ee(),n.pendingContext&&(n.context=n.pendingContext,n.pendingContext=null),null!==e&&null!==e.child||(ir(t)?Hl(t):null===e||e.memoizedState.isDehydrated&&0===(256&t.flags)||(t.flags|=1024,null!==Zi&&(kc(Zi),Zi=null))),Yl(t),null;case 26:return n=t.memoizedState,null===e?(Hl(t),null!==n?(Yl(t),Wl(t,n)):(Yl(t),t.flags&=-16777217)):n?n!==e.memoizedState?(Hl(t),Yl(t),Wl(t,n)):(Yl(t),t.flags&=-16777217):(e.memoizedProps!==i&&Hl(t),Yl(t),t.flags&=-16777217),null;case 27:ne(t),n=Z.current;var r=t.type;if(null!==e&&null!=t.stateNode)e.memoizedProps!==i&&Hl(t);else{if(!i){if(null===t.stateNode)throw Error(a(166));return Yl(t),null}e=Q.current,ir(t)?tr(t):(e=cu(r,i,n),t.stateNode=e,Hl(t))}return Yl(t),null;case 5:if(ne(t),n=t.type,null!==e&&null!=t.stateNode)e.memoizedProps!==i&&Hl(t);else{if(!i){if(null===t.stateNode)throw Error(a(166));return Yl(t),null}if(e=Q.current,ir(t))tr(t);else{switch(r=Qh(Z.current),e){case 1:e=r.createElementNS("http://www.w3.org/2000/svg",n);break;case 2:e=r.createElementNS("http://www.w3.org/1998/Math/MathML",n);break;default:switch(n){case"svg":e=r.createElementNS("http://www.w3.org/2000/svg",n);break;case"math":e=r.createElementNS("http://www.w3.org/1998/Math/MathML",n);break;case"script":(e=r.createElement("div")).innerHTML="<script><\/script>",e=e.removeChild(e.firstChild);break;case"select":e="string"===typeof i.is?r.createElement("select",{is:i.is}):r.createElement("select"),i.multiple?e.multiple=!0:i.size&&(e.size=i.size);break;default:e="string"===typeof i.is?r.createElement(n,{is:i.is}):r.createElement(n)}}e[Ne]=t,e[Fe]=i;e:for(r=t.child;null!==r;){if(5===r.tag||6===r.tag)e.appendChild(r.stateNode);else if(4!==r.tag&&27!==r.tag&&null!==r.child){r.child.return=r,r=r.child;continue}if(r===t)break e;for(;null===r.sibling;){if(null===r.return||r.return===t)break e;r=r.return}r.sibling.return=r.return,r=r.sibling}t.stateNode=e;e:switch(qh(e,n,i),n){case"button":case"input":case"select":case"textarea":e=!!i.autoFocus;break e;case"img":e=!0;break e;default:e=!1}e&&Hl(t)}}return Yl(t),t.flags&=-16777217,null;case 6:if(e&&null!=t.stateNode)e.memoizedProps!==i&&Hl(t);else{if("string"!==typeof i&&null===t.stateNode)throw Error(a(166));if(e=Z.current,ir(t)){if(e=t.stateNode,n=t.memoizedProps,i=null,null!==(r=Yi))switch(r.tag){case 27:case 5:i=r.memoizedProps}e[Ne]=t,(e=!!(e.nodeValue===n||null!==i&&!0===i.suppressHydrationWarning||Vh(e.nodeValue,n)))||er(t)}else(e=Qh(e).createTextNode(i))[Ne]=t,t.stateNode=e}return Yl(t),null;case 13:if(i=t.memoizedState,null===e||null!==e.memoizedState&&null!==e.memoizedState.dehydrated){if(r=ir(t),null!==i&&null!==i.dehydrated){if(null===e){if(!r)throw Error(a(318));if(!(r=null!==(r=t.memoizedState)?r.dehydrated:null))throw Error(a(317));r[Ne]=t}else rr(),0===(128&t.flags)&&(t.memoizedState=null),t.flags|=4;Yl(t),r=!1}else null!==Zi&&(kc(Zi),Zi=null),r=!0;if(!r)return 256&t.flags?(Rr(t),t):(Rr(t),null)}if(Rr(t),0!==(128&t.flags))return t.lanes=n,t;if(n=null!==i,e=null!==e&&null!==e.memoizedState,n){r=null,null!==(i=t.child).alternate&&null!==i.alternate.memoizedState&&null!==i.alternate.memoizedState.cachePool&&(r=i.alternate.memoizedState.cachePool.pool);var s=null;null!==i.memoizedState&&null!==i.memoizedState.cachePool&&(s=i.memoizedState.cachePool.pool),s!==r&&(i.flags|=2048)}return n!==e&&n&&(t.child.flags|=8192),ql(t,t.updateQueue),Yl(t),null;case 4:return ee(),null===e&&Ih(t.stateNode.containerInfo),Yl(t),null;case 10:return bo(t.type),Yl(t),null;case 19:if(X(kr),null===(r=t.memoizedState))return Yl(t),null;if(i=0!==(128&t.flags),null===(s=r.rendering))if(i)Xl(r,!1);else{if(0!==hc||null!==e&&0!==(128&e.flags))for(e=t.child;null!==e;){if(null!==(s=Lr(e))){for(t.flags|=128,Xl(r,!1),e=s.updateQueue,t.updateQueue=e,ql(t,e),t.subtreeFlags=0,e=n,n=t.child;null!==n;)Nl(n,e),n=n.sibling;return Y(kr,1&kr.current|2),t.child}e=e.sibling}null!==r.tail&&le()>xc&&(t.flags|=128,i=!0,Xl(r,!1),t.lanes=4194304)}else{if(!i)if(null!==(e=Lr(s))){if(t.flags|=128,i=!0,e=e.updateQueue,t.updateQueue=e,ql(t,e),Xl(r,!0),null===r.tail&&"hidden"===r.tailMode&&!s.alternate&&!Ki)return Yl(t),null}else 2*le()-r.renderingStartTime>xc&&536870912!==n&&(t.flags|=128,i=!0,Xl(r,!1),t.lanes=4194304);r.isBackwards?(s.sibling=t.child,t.child=s):(null!==(e=r.last)?e.sibling=s:t.child=s,r.last=s)}return null!==r.tail?(t=r.tail,r.rendering=t,r.tail=t.sibling,r.renderingStartTime=le(),t.sibling=null,e=kr.current,Y(kr,i?1&e|2:1&e),t):(Yl(t),null);case 22:case 23:return Rr(t),Mr(),i=null!==t.memoizedState,null!==e?null!==e.memoizedState!==i&&(t.flags|=8192):i&&(t.flags|=8192),i?0!==(536870912&n)&&0===(128&t.flags)&&(Yl(t),6&t.subtreeFlags&&(t.flags|=8192)):Yl(t),null!==(n=t.updateQueue)&&ql(t,n.retryQueue),n=null,null!==e&&null!==e.memoizedState&&null!==e.memoizedState.cachePool&&(n=e.memoizedState.cachePool.pool),i=null,null!==t.memoizedState&&null!==t.memoizedState.cachePool&&(i=t.memoizedState.cachePool.pool),i!==n&&(t.flags|=2048),null!==e&&X(Yr),null;case 24:return n=null,null!==e&&(n=e.memoizedState.cache),t.memoizedState.cache!==n&&(t.flags|=2048),bo(Fr),Yl(t),null;case 25:return null}throw Error(a(156,t.tag))}function Kl(e,t){switch(Xi(t),t.tag){case 1:return 65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 3:return bo(Fr),ee(),0!==(65536&(e=t.flags))&&0===(128&e)?(t.flags=-65537&e|128,t):null;case 26:case 27:case 5:return ne(t),null;case 13:if(Rr(t),null!==(e=t.memoizedState)&&null!==e.dehydrated){if(null===t.alternate)throw Error(a(340));rr()}return 65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 19:return X(kr),null;case 4:return ee(),null;case 10:return bo(t.type),null;case 22:case 23:return Rr(t),Mr(),null!==e&&X(Yr),65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 24:return bo(Fr),null;default:return null}}function Zl(e,t){switch(Xi(t),t.tag){case 3:bo(Fr),ee();break;case 26:case 27:case 5:ne(t);break;case 4:ee();break;case 13:Rr(t);break;case 19:X(kr);break;case 10:bo(t.type);break;case 22:case 23:Rr(t),Mr(),null!==e&&X(Yr);break;case 24:bo(Fr)}}var Jl={getCacheForType:function(e){var t=Ao(Fr),n=t.data.get(e);return void 0===n&&(n=e(),t.data.set(e,n)),n}},$l="function"===typeof WeakMap?WeakMap:Map,ec=0,tc=null,nc=null,ic=0,rc=0,sc=null,ac=!1,oc=!1,lc=!1,cc=0,hc=0,uc=0,dc=0,pc=0,fc=0,mc=0,gc=null,vc=null,yc=!1,bc=0,xc=1/0,wc=null,Sc=null,_c=!1,Ec=null,Ac=0,Cc=0,Mc=null,Tc=0,Pc=null;function Dc(){if(0!==(2&ec)&&0!==ic)return ic&-ic;if(null!==D.T){return 0!==Hr?Hr:wh()}return Be()}function Oc(){0===fc&&(fc=0===(536870912&ic)||Ki?Pe():536870912);var e=Tr.current;return null!==e&&(e.flags|=32),fc}function Ic(e,t,n){(e===tc&&2===rc||null!==e.cancelPendingCommit)&&(Uc(e,0),zc(e,ic,fc,!1)),Ie(e,n),0!==(2&ec)&&e===tc||(e===tc&&(0===(2&ec)&&(dc|=n),4===hc&&zc(e,ic,fc,!1)),mh(e))}function Rc(e,t,n){if(0!==(6&ec))throw Error(a(327));for(var i=!n&&0===(60&t)&&0===(t&e.expiredLanes)||Me(e,t),r=i?function(e,t){var n=ec;ec|=2;var i=Vc(),r=Gc();tc!==e||ic!==t?(wc=null,xc=le()+500,Uc(e,t)):oc=Me(e,t);e:for(;;)try{if(0!==rc&&null!==nc){t=nc;var s=sc;t:switch(rc){case 1:rc=0,sc=null,Kc(e,t,s,1);break;case 2:if(cr(s)){rc=0,sc=null,Qc(t);break}t=function(){2===rc&&tc===e&&(rc=7),mh(e)},s.then(t,t);break e;case 3:rc=7;break e;case 4:rc=5;break e;case 7:cr(s)?(rc=0,sc=null,Qc(t)):(rc=0,sc=null,Kc(e,t,s,7));break;case 5:var o=null;switch(nc.tag){case 26:o=nc.memoizedState;case 5:case 27:var l=nc;if(!o||Pu(o)){rc=0,sc=null;var c=l.sibling;if(null!==c)nc=c;else{var h=l.return;null!==h?(nc=h,Zc(h)):nc=null}break t}}rc=0,sc=null,Kc(e,t,s,5);break;case 6:rc=0,sc=null,Kc(e,t,s,6);break;case 8:Fc(),hc=6;break e;default:throw Error(a(462))}}Xc();break}catch(u){jc(e,u)}return vo=go=null,D.H=i,D.A=r,ec=n,null!==nc?0:(tc=null,ic=0,Ci(),hc)}(e,t):Wc(e,t,!0),s=i;;){if(0===r){oc&&!i&&zc(e,t,0,!1);break}if(6===r)zc(e,t,0,!ac);else{if(n=e.current.alternate,s&&!Bc(n)){r=Wc(e,t,!1),s=!1;continue}if(2===r){if(s=t,e.errorRecoveryDisabledLanes&s)var o=0;else o=0!==(o=-536870913&e.pendingLanes)?o:536870912&o?536870912:0;if(0!==o){t=o;e:{var l=e;r=gc;var c=l.current.memoizedState.isDehydrated;if(c&&(Uc(l,o).flags|=256),2!==(o=Wc(l,o,!1))){if(lc&&!c){l.errorRecoveryDisabledLanes|=s,dc|=s,r=4;break e}s=vc,vc=r,null!==s&&kc(s)}r=o}if(s=!1,2!==r)continue}}if(1===r){Uc(e,0),zc(e,t,0,!0);break}e:{switch(i=e,r){case 0:case 1:throw Error(a(345));case 4:if((4194176&t)===t){zc(i,t,fc,!ac);break e}break;case 2:vc=null;break;case 3:case 5:break;default:throw Error(a(329))}if(i.finishedWork=n,i.finishedLanes=t,(62914560&t)===t&&10<(s=bc+300-le())){if(zc(i,t,fc,!ac),0!==Ce(i,0))break e;i.timeoutHandle=eu(Lc.bind(null,i,n,vc,wc,yc,t,fc,dc,mc,ac,2,-0,0),s)}else Lc(i,n,vc,wc,yc,t,fc,dc,mc,ac,0,-0,0)}}break}mh(e)}function kc(e){null===vc?vc=e:vc.push.apply(vc,e)}function Lc(e,t,n,i,r,s,o,l,c,h,u,d,p){var f=t.subtreeFlags;if((8192&f||16785408===(16785408&f))&&(Du={stylesheets:null,count:0,unsuspend:Ou},Tl(t),null!==(t=function(){if(null===Du)throw Error(a(475));var e=Du;return e.stylesheets&&0===e.count&&ku(e,e.stylesheets),0<e.count?function(t){var n=setTimeout((function(){if(e.stylesheets&&ku(e,e.stylesheets),e.unsuspend){var t=e.unsuspend;e.unsuspend=null,t()}}),6e4);return e.unsuspend=t,function(){e.unsuspend=null,clearTimeout(n)}}:null}())))return e.cancelPendingCommit=t($c.bind(null,e,n,i,r,o,l,c,1,d,p)),void zc(e,s,o,!h);$c(e,n,i,r,o,l,c,u,d,p)}function Bc(e){for(var t=e;;){var n=t.tag;if((0===n||11===n||15===n)&&16384&t.flags&&(null!==(n=t.updateQueue)&&null!==(n=n.stores)))for(var i=0;i<n.length;i++){var r=n[i],s=r.getSnapshot;r=r.value;try{if(!Yn(s(),r))return!1}catch(a){return!1}}if(n=t.child,16384&t.subtreeFlags&&null!==n)n.return=t,t=n;else{if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}function zc(e,t,n,i){t&=~pc,t&=~dc,e.suspendedLanes|=t,e.pingedLanes&=~t,i&&(e.warmLanes|=t),i=e.expirationTimes;for(var r=t;0<r;){var s=31-xe(r),a=1<<s;i[s]=-1,r&=~a}0!==n&&Re(e,n,t)}function Nc(){return 0!==(6&ec)||(gh(0,!1),!1)}function Fc(){if(null!==nc){if(0===rc)var e=nc.return;else vo=go=null,vs(e=nc),fr=null,mr=0,e=nc;for(;null!==e;)Zl(e.alternate,e),e=e.return;nc=null}}function Uc(e,t){e.finishedWork=null,e.finishedLanes=0;var n=e.timeoutHandle;-1!==n&&(e.timeoutHandle=-1,tu(n)),null!==(n=e.cancelPendingCommit)&&(e.cancelPendingCommit=null,n()),Fc(),tc=e,nc=n=zl(e.current,null),ic=t,rc=0,sc=null,ac=!1,oc=Me(e,t),lc=!1,mc=fc=pc=dc=uc=hc=0,vc=gc=null,yc=!1,0!==(8&t)&&(t|=32&t);var i=e.entangledLanes;if(0!==i)for(e=e.entanglements,i&=t;0<i;){var r=31-xe(i),s=1<<r;t|=e[r],i&=~s}return cc=t,Ci(),n}function jc(e,t){$r=null,D.H=Ea,t===ar?(t=pr(),rc=3):t===or?(t=pr(),rc=4):rc=t===Va?8:null!==t&&"object"===typeof t&&"function"===typeof t.then?6:1,sc=t,null===nc&&(hc=1,za(e,ki(t,e.current)))}function Vc(){var e=D.H;return D.H=Ea,null===e?Ea:e}function Gc(){var e=D.A;return D.A=Jl,e}function Hc(){hc=4,ac||(4194176&ic)!==ic&&null!==Tr.current||(oc=!0),0===(134217727&uc)&&0===(134217727&dc)||null===tc||zc(tc,ic,fc,!1)}function Wc(e,t,n){var i=ec;ec|=2;var r=Vc(),s=Gc();tc===e&&ic===t||(wc=null,Uc(e,t)),t=!1;var a=hc;e:for(;;)try{if(0!==rc&&null!==nc){var o=nc,l=sc;switch(rc){case 8:Fc(),a=6;break e;case 3:case 2:case 6:null===Tr.current&&(t=!0);var c=rc;if(rc=0,sc=null,Kc(e,o,l,c),n&&oc){a=0;break e}break;default:c=rc,rc=0,sc=null,Kc(e,o,l,c)}}qc(),a=hc;break}catch(h){jc(e,h)}return t&&e.shellSuspendCounter++,vo=go=null,ec=i,D.H=r,D.A=s,null===nc&&(tc=null,ic=0,Ci()),a}function qc(){for(;null!==nc;)Yc(nc)}function Xc(){for(;null!==nc&&!ae();)Yc(nc)}function Yc(e){var t=fo(e.alternate,e,cc);e.memoizedProps=e.pendingProps,null===t?Zc(e):nc=t}function Qc(e){var t=e,n=t.alternate;switch(t.tag){case 15:case 0:t=Ja(n,t,t.pendingProps,t.type,void 0,ic);break;case 11:t=Ja(n,t,t.pendingProps,t.type.render,t.ref,ic);break;case 5:vs(t);default:Zl(n,t),t=fo(n,t=nc=Nl(t,cc),cc)}e.memoizedProps=e.pendingProps,null===t?Zc(e):nc=t}function Kc(e,t,n,i){vo=go=null,vs(t),fr=null,mr=0;var r=t.return;try{if(function(e,t,n,i,r){if(n.flags|=32768,null!==i&&"object"===typeof i&&"function"===typeof i.then){if(null!==(t=n.alternate)&&So(t,n,r,!0),null!==(n=Tr.current)){switch(n.tag){case 13:return null===Pr?Hc():null===n.alternate&&0===hc&&(hc=3),n.flags&=-257,n.flags|=65536,n.lanes=r,i===lr?n.flags|=16384:(null===(t=n.updateQueue)?n.updateQueue=new Set([i]):t.add(i),rh(e,i,r)),!1;case 22:return n.flags|=65536,i===lr?n.flags|=16384:(null===(t=n.updateQueue)?(t={transitions:null,markerInstances:null,retryQueue:new Set([i])},n.updateQueue=t):null===(n=t.retryQueue)?t.retryQueue=new Set([i]):n.add(i),rh(e,i,r)),!1}throw Error(a(435,n.tag))}return rh(e,i,r),Hc(),!1}if(Ki)return null!==(t=Tr.current)?(0===(65536&t.flags)&&(t.flags|=256),t.flags|=65536,t.lanes=r,i!==$i&&sr(ki(e=Error(a(422),{cause:i}),n))):(i!==$i&&sr(ki(t=Error(a(423),{cause:i}),n)),(e=e.current.alternate).flags|=65536,r&=-r,e.lanes|=r,i=ki(i,n),ko(e,r=Fa(e.stateNode,i,r)),4!==hc&&(hc=2)),!1;var s=Error(a(520),{cause:i});if(s=ki(s,n),null===gc?gc=[s]:gc.push(s),4!==hc&&(hc=2),null===t)return!0;i=ki(i,n),n=t;do{switch(n.tag){case 3:return n.flags|=65536,e=r&-r,n.lanes|=e,ko(n,e=Fa(n.stateNode,i,e)),!1;case 1:if(t=n.type,s=n.stateNode,0===(128&n.flags)&&("function"===typeof t.getDerivedStateFromError||null!==s&&"function"===typeof s.componentDidCatch&&(null===Sc||!Sc.has(s))))return n.flags|=65536,r&=-r,n.lanes|=r,ja(r=Ua(r),e,n,i),ko(n,r),!1}n=n.return}while(null!==n);return!1}(e,r,t,n,ic))return hc=1,za(e,ki(n,e.current)),void(nc=null)}catch(s){if(null!==r)throw nc=r,s;return hc=1,za(e,ki(n,e.current)),void(nc=null)}32768&t.flags?(Ki||1===i?e=!0:oc||0!==(536870912&ic)?e=!1:(ac=e=!0,(2===i||3===i||6===i)&&(null!==(i=Tr.current)&&13===i.tag&&(i.flags|=16384))),Jc(t,e)):Zc(t)}function Zc(e){var t=e;do{if(0!==(32768&t.flags))return void Jc(t,ac);e=t.return;var n=Ql(t.alternate,t,cc);if(null!==n)return void(nc=n);if(null!==(t=t.sibling))return void(nc=t);nc=t=e}while(null!==t);0===hc&&(hc=5)}function Jc(e,t){do{var n=Kl(e.alternate,e);if(null!==n)return n.flags&=32767,void(nc=n);if(null!==(n=e.return)&&(n.flags|=32768,n.subtreeFlags=0,n.deletions=null),!t&&null!==(e=e.sibling))return void(nc=e);nc=e=n}while(null!==e);hc=6,nc=null}function $c(e,t,n,i,r,s,o,l,c,h){var u=D.T,d=V.p;try{V.p=2,D.T=null,function(e,t,n,i,r,s,o,l){do{th()}while(null!==Ec);if(0!==(6&ec))throw Error(a(327));var c=e.finishedWork;if(i=e.finishedLanes,null===c)return null;if(e.finishedWork=null,e.finishedLanes=0,c===e.current)throw Error(a(177));e.callbackNode=null,e.callbackPriority=0,e.cancelPendingCommit=null;var h=c.lanes|c.childLanes;if(function(e,t,n,i,r,s){var a=e.pendingLanes;e.pendingLanes=n,e.suspendedLanes=0,e.pingedLanes=0,e.warmLanes=0,e.expiredLanes&=n,e.entangledLanes&=n,e.errorRecoveryDisabledLanes&=n,e.shellSuspendCounter=0;var o=e.entanglements,l=e.expirationTimes,c=e.hiddenUpdates;for(n=a&~n;0<n;){var h=31-xe(n),u=1<<h;o[h]=0,l[h]=-1;var d=c[h];if(null!==d)for(c[h]=null,h=0;h<d.length;h++){var p=d[h];null!==p&&(p.lane&=-536870913)}n&=~u}0!==i&&Re(e,i,0),0!==s&&0===r&&0!==e.tag&&(e.suspendedLanes|=s&~(a&~t))}(e,i,h|=Ai,s,o,l),e===tc&&(nc=tc=null,ic=0),0===(10256&c.subtreeFlags)&&0===(10256&c.flags)||_c||(_c=!0,Cc=h,Mc=n,function(e,t){re(e,t)}(de,(function(){return th(),null}))),n=0!==(15990&c.flags),0!==(15990&c.subtreeFlags)||n?(n=D.T,D.T=null,s=V.p,V.p=2,o=ec,ec|=4,function(e,t){if(e=e.containerInfo,Xh=Hu,ei(e=$n(e))){if("selectionStart"in e)var n={start:e.selectionStart,end:e.selectionEnd};else e:{var i=(n=(n=e.ownerDocument)&&n.defaultView||window).getSelection&&n.getSelection();if(i&&0!==i.rangeCount){n=i.anchorNode;var r=i.anchorOffset,s=i.focusNode;i=i.focusOffset;try{n.nodeType,s.nodeType}catch(g){n=null;break e}var o=0,l=-1,c=-1,h=0,u=0,d=e,p=null;t:for(;;){for(var f;d!==n||0!==r&&3!==d.nodeType||(l=o+r),d!==s||0!==i&&3!==d.nodeType||(c=o+i),3===d.nodeType&&(o+=d.nodeValue.length),null!==(f=d.firstChild);)p=d,d=f;for(;;){if(d===e)break t;if(p===n&&++h===r&&(l=o),p===s&&++u===i&&(c=o),null!==(f=d.nextSibling))break;p=(d=p).parentNode}d=f}n=-1===l||-1===c?null:{start:l,end:c}}else n=null}n=n||{start:0,end:0}}else n=null;for(Yh={focusedElem:e,selectionRange:n},Hu=!1,nl=t;null!==nl;)if(e=(t=nl).child,0!==(1028&t.subtreeFlags)&&null!==e)e.return=t,nl=e;else for(;null!==nl;){switch(s=(t=nl).alternate,e=t.flags,t.tag){case 0:case 11:case 15:case 5:case 26:case 27:case 6:case 4:case 17:break;case 1:if(0!==(1024&e)&&null!==s){e=void 0,n=t,r=s.memoizedProps,s=s.memoizedState,i=n.stateNode;try{var m=Ia(n.type,r,(n.elementType,n.type));e=i.getSnapshotBeforeUpdate(m,s),i.__reactInternalSnapshotBeforeUpdate=e}catch(v){ih(n,n.return,v)}}break;case 3:if(0!==(1024&e))if(9===(n=(e=t.stateNode.containerInfo).nodeType))au(e);else if(1===n)switch(e.nodeName){case"HEAD":case"HTML":case"BODY":au(e);break;default:e.textContent=""}break;default:if(0!==(1024&e))throw Error(a(163))}if(null!==(e=t.sibling)){e.return=t.return,nl=e;break}nl=t.return}m=il,il=!1}(e,c),fl(c,e),ti(Yh,e.containerInfo),Hu=!!Xh,Yh=Xh=null,e.current=c,rl(e,c.alternate,c),oe(),ec=o,V.p=s,D.T=n):e.current=c,_c?(_c=!1,Ec=e,Ac=i):eh(e,h),h=e.pendingLanes,0===h&&(Sc=null),function(e){if(ye&&"function"===typeof ye.onCommitFiberRoot)try{ye.onCommitFiberRoot(ve,e,void 0,128===(128&e.current.flags))}catch(t){}}(c.stateNode),mh(e),null!==t)for(r=e.onRecoverableError,c=0;c<t.length;c++)h=t[c],r(h.value,{componentStack:h.stack});0!==(3&Ac)&&th(),h=e.pendingLanes,0!==(4194218&i)&&0!==(42&h)?e===Pc?Tc++:(Tc=0,Pc=e):Tc=0,gh(0,!1)}(e,t,n,i,d,r,s,o)}finally{D.T=u,V.p=d}}function eh(e,t){0===(e.pooledCacheLanes&=t)&&(null!=(t=e.pooledCache)&&(e.pooledCache=null,jr(t)))}function th(){if(null!==Ec){var e=Ec,t=Cc;Cc=0;var n=Le(Ac),i=D.T,r=V.p;try{if(V.p=32>n?32:n,D.T=null,null===Ec)var s=!1;else{n=Mc,Mc=null;var o=Ec,l=Ac;if(Ec=null,Ac=0,0!==(6&ec))throw Error(a(331));var c=ec;if(ec|=4,Ol(o.current),_l(o,o.current,l,n),ec=c,gh(0,!1),ye&&"function"===typeof ye.onPostCommitFiberRoot)try{ye.onPostCommitFiberRoot(ve,o)}catch(h){}s=!0}return s}finally{V.p=r,D.T=i,eh(e,t)}}return!1}function nh(e,t,n){t=ki(n,t),null!==(e=Io(e,t=Fa(e.stateNode,t,2),2))&&(Ie(e,2),mh(e))}function ih(e,t,n){if(3===e.tag)nh(e,e,n);else for(;null!==t;){if(3===t.tag){nh(t,e,n);break}if(1===t.tag){var i=t.stateNode;if("function"===typeof t.type.getDerivedStateFromError||"function"===typeof i.componentDidCatch&&(null===Sc||!Sc.has(i))){e=ki(n,e),null!==(i=Io(t,n=Ua(2),2))&&(ja(n,i,t,e),Ie(i,2),mh(i));break}}t=t.return}}function rh(e,t,n){var i=e.pingCache;if(null===i){i=e.pingCache=new $l;var r=new Set;i.set(t,r)}else void 0===(r=i.get(t))&&(r=new Set,i.set(t,r));r.has(n)||(lc=!0,r.add(n),e=sh.bind(null,e,t,n),t.then(e,e))}function sh(e,t,n){var i=e.pingCache;null!==i&&i.delete(t),e.pingedLanes|=e.suspendedLanes&n,e.warmLanes&=~n,tc===e&&(ic&n)===n&&(4===hc||3===hc&&(62914560&ic)===ic&&300>le()-bc?0===(2&ec)&&Uc(e,0):pc|=n,mc===ic&&(mc=0)),mh(e)}function ah(e,t){0===t&&(t=De()),null!==(e=Pi(e,t))&&(Ie(e,t),mh(e))}function oh(e){var t=e.memoizedState,n=0;null!==t&&(n=t.retryLane),ah(e,n)}function lh(e,t){var n=0;switch(e.tag){case 13:var i=e.stateNode,r=e.memoizedState;null!==r&&(n=r.retryLane);break;case 19:i=e.stateNode;break;case 22:i=e.stateNode._retryCache;break;default:throw Error(a(314))}null!==i&&i.delete(t),ah(e,n)}var ch=null,hh=null,uh=!1,dh=!1,ph=!1,fh=0;function mh(e){var t;e!==hh&&null===e.next&&(null===hh?ch=hh=e:hh=hh.next=e),dh=!0,uh||(uh=!0,t=vh,iu((function(){0!==(6&ec)?re(he,t):t()})))}function gh(e,t){if(!ph&&dh){ph=!0;do{for(var n=!1,i=ch;null!==i;){if(!t)if(0!==e){var r=i.pendingLanes;if(0===r)var s=0;else{var a=i.suspendedLanes,o=i.pingedLanes;s=(1<<31-xe(42|e)+1)-1,s=201326677&(s&=r&~(a&~o))?201326677&s|1:s?2|s:0}0!==s&&(n=!0,xh(i,s))}else s=ic,0===(3&(s=Ce(i,i===tc?s:0)))||Me(i,s)||(n=!0,xh(i,s));i=i.next}}while(n);ph=!1}}function vh(){dh=uh=!1;var e=0;0!==fh&&(function(){var e=window.event;if(e&&"popstate"===e.type)return e!==$h&&($h=e,!0);return $h=null,!1}()&&(e=fh),fh=0);for(var t=le(),n=null,i=ch;null!==i;){var r=i.next,s=yh(i,t);0===s?(i.next=null,null===n?ch=r:n.next=r,null===r&&(hh=n)):(n=i,(0!==e||0!==(3&s))&&(dh=!0)),i=r}gh(e,!1)}function yh(e,t){for(var n=e.suspendedLanes,i=e.pingedLanes,r=e.expirationTimes,s=-62914561&e.pendingLanes;0<s;){var a=31-xe(s),o=1<<a,l=r[a];-1===l?0!==(o&n)&&0===(o&i)||(r[a]=Te(o,t)):l<=t&&(e.expiredLanes|=o),s&=~o}if(n=ic,n=Ce(e,e===(t=tc)?n:0),i=e.callbackNode,0===n||e===t&&2===rc||null!==e.cancelPendingCommit)return null!==i&&null!==i&&se(i),e.callbackNode=null,e.callbackPriority=0;if(0===(3&n)||Me(e,n)){if((t=n&-n)===e.callbackPriority)return t;switch(null!==i&&se(i),Le(n)){case 2:case 8:n=ue;break;case 32:default:n=de;break;case 268435456:n=fe}return i=bh.bind(null,e),n=re(n,i),e.callbackPriority=t,e.callbackNode=n,t}return null!==i&&null!==i&&se(i),e.callbackPriority=2,e.callbackNode=null,2}function bh(e,t){var n=e.callbackNode;if(th()&&e.callbackNode!==n)return null;var i=ic;return 0===(i=Ce(e,e===tc?i:0))?null:(Rc(e,i,t),yh(e,le()),null!=e.callbackNode&&e.callbackNode===n?bh.bind(null,e):null)}function xh(e,t){if(th())return null;Rc(e,t,!0)}function wh(){return 0===fh&&(fh=Pe()),fh}function Sh(e){return null==e||"symbol"===typeof e||"boolean"===typeof e?null:"function"===typeof e?e:Pt(""+e)}function _h(e,t){var n=t.ownerDocument.createElement("input");return n.name=t.name,n.value=t.value,e.id&&n.setAttribute("form",e.id),t.parentNode.insertBefore(n,t),e=new FormData(e),n.parentNode.removeChild(n),e}for(var Eh=0;Eh<wi.length;Eh++){var Ah=wi[Eh];Si(Ah.toLowerCase(),"on"+(Ah[0].toUpperCase()+Ah.slice(1)))}Si(pi,"onAnimationEnd"),Si(fi,"onAnimationIteration"),Si(mi,"onAnimationStart"),Si("dblclick","onDoubleClick"),Si("focusin","onFocus"),Si("focusout","onBlur"),Si(gi,"onTransitionRun"),Si(vi,"onTransitionStart"),Si(yi,"onTransitionCancel"),Si(bi,"onTransitionEnd"),tt("onMouseEnter",["mouseout","mouseover"]),tt("onMouseLeave",["mouseout","mouseover"]),tt("onPointerEnter",["pointerout","pointerover"]),tt("onPointerLeave",["pointerout","pointerover"]),et("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),et("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),et("onBeforeInput",["compositionend","keypress","textInput","paste"]),et("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),et("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),et("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Ch="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Mh=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(Ch));function Th(e,t){t=0!==(4&t);for(var n=0;n<e.length;n++){var i=e[n],r=i.event;i=i.listeners;e:{var s=void 0;if(t)for(var a=i.length-1;0<=a;a--){var o=i[a],l=o.instance,c=o.currentTarget;if(o=o.listener,l!==s&&r.isPropagationStopped())break e;s=o,r.currentTarget=c;try{s(r)}catch(h){Ra(h)}r.currentTarget=null,s=l}else for(a=0;a<i.length;a++){if(l=(o=i[a]).instance,c=o.currentTarget,o=o.listener,l!==s&&r.isPropagationStopped())break e;s=o,r.currentTarget=c;try{s(r)}catch(h){Ra(h)}r.currentTarget=null,s=l}}}}function Ph(e,t){var n=t[je];void 0===n&&(n=t[je]=new Set);var i=e+"__bubble";n.has(i)||(Rh(t,e,2,!1),n.add(i))}function Dh(e,t,n){var i=0;t&&(i|=4),Rh(n,e,i,t)}var Oh="_reactListening"+Math.random().toString(36).slice(2);function Ih(e){if(!e[Oh]){e[Oh]=!0,Je.forEach((function(t){"selectionchange"!==t&&(Mh.has(t)||Dh(t,!1,e),Dh(t,!0,e))}));var t=9===e.nodeType?e:e.ownerDocument;null===t||t[Oh]||(t[Oh]=!0,Dh("selectionchange",!1,t))}}function Rh(e,t,n,i){switch(Zu(t)){case 2:var r=Wu;break;case 8:r=qu;break;default:r=Xu}n=r.bind(null,t,n,e),r=void 0,!Nt||"touchstart"!==t&&"touchmove"!==t&&"wheel"!==t||(r=!0),i?void 0!==r?e.addEventListener(t,n,{capture:!0,passive:r}):e.addEventListener(t,n,!0):void 0!==r?e.addEventListener(t,n,{passive:r}):e.addEventListener(t,n,!1)}function kh(e,t,n,i,r){var s=i;if(0===(1&t)&&0===(2&t)&&null!==i)e:for(;;){if(null===i)return;var a=i.tag;if(3===a||4===a){var o=i.stateNode.containerInfo;if(o===r||8===o.nodeType&&o.parentNode===r)break;if(4===a)for(a=i.return;null!==a;){var l=a.tag;if((3===l||4===l)&&((l=a.stateNode.containerInfo)===r||8===l.nodeType&&l.parentNode===r))return;a=a.return}for(;null!==o;){if(null===(a=Xe(o)))return;if(5===(l=a.tag)||6===l||26===l||27===l){i=s=a;continue e}o=o.parentNode}}i=i.return}Bt((function(){var i=s,r=Ot(n),a=[];e:{var o=xi.get(e);if(void 0!==o){var l=Jt,c=e;switch(e){case"keypress":if(0===Ht(n))break e;case"keydown":case"keyup":l=fn;break;case"focusin":c="focus",l=sn;break;case"focusout":c="blur",l=sn;break;case"beforeblur":case"afterblur":l=sn;break;case"click":if(2===n.button)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":l=nn;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":l=rn;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":l=gn;break;case pi:case fi:case mi:l=an;break;case bi:l=vn;break;case"scroll":case"scrollend":l=en;break;case"wheel":l=yn;break;case"copy":case"cut":case"paste":l=on;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":l=mn;break;case"toggle":case"beforetoggle":l=bn}var h=0!==(4&t),u=!h&&("scroll"===e||"scrollend"===e),d=h?null!==o?o+"Capture":null:o;h=[];for(var p,f=i;null!==f;){var m=f;if(p=m.stateNode,5!==(m=m.tag)&&26!==m&&27!==m||null===p||null===d||null!=(m=zt(f,d))&&h.push(Lh(f,m,p)),u)break;f=f.return}0<h.length&&(o=new l(o,c,null,n,r),a.push({event:o,listeners:h}))}}if(0===(7&t)){if(l="mouseout"===e||"pointerout"===e,(!(o="mouseover"===e||"pointerover"===e)||n===Dt||!(c=n.relatedTarget||n.fromElement)||!Xe(c)&&!c[Ue])&&(l||o)&&(o=r.window===r?r:(o=r.ownerDocument)?o.defaultView||o.parentWindow:window,l?(l=i,null!==(c=(c=n.relatedTarget||n.toElement)?Xe(c):null)&&(u=z(c),h=c.tag,c!==u||5!==h&&27!==h&&6!==h)&&(c=null)):(l=null,c=i),l!==c)){if(h=nn,m="onMouseLeave",d="onMouseEnter",f="mouse","pointerout"!==e&&"pointerover"!==e||(h=mn,m="onPointerLeave",d="onPointerEnter",f="pointer"),u=null==l?o:Qe(l),p=null==c?o:Qe(c),(o=new h(m,f+"leave",l,n,r)).target=u,o.relatedTarget=p,m=null,Xe(r)===i&&((h=new h(d,f+"enter",c,n,r)).target=p,h.relatedTarget=u,m=h),u=m,l&&c)e:{for(d=c,f=0,p=h=l;p;p=zh(p))f++;for(p=0,m=d;m;m=zh(m))p++;for(;0<f-p;)h=zh(h),f--;for(;0<p-f;)d=zh(d),p--;for(;f--;){if(h===d||null!==d&&h===d.alternate)break e;h=zh(h),d=zh(d)}h=null}else h=null;null!==l&&Nh(a,o,l,h,!1),null!==c&&null!==u&&Nh(a,u,c,h,!0)}if("select"===(l=(o=i?Qe(i):window).nodeName&&o.nodeName.toLowerCase())||"input"===l&&"file"===o.type)var g=zn;else if(On(o))if(Nn)g=Xn;else{g=Wn;var v=Hn}else!(l=o.nodeName)||"input"!==l.toLowerCase()||"checkbox"!==o.type&&"radio"!==o.type?i&&Ct(i.elementType)&&(g=zn):g=qn;switch(g&&(g=g(e,i))?In(a,g,n,r):(v&&v(e,o,i),"focusout"===e&&i&&"number"===o.type&&null!=i.memoizedProps.value&&yt(o,"number",o.value)),v=i?Qe(i):window,e){case"focusin":(On(v)||"true"===v.contentEditable)&&(ii=v,ri=i,si=null);break;case"focusout":si=ri=ii=null;break;case"mousedown":ai=!0;break;case"contextmenu":case"mouseup":case"dragend":ai=!1,oi(a,n,r);break;case"selectionchange":if(ni)break;case"keydown":case"keyup":oi(a,n,r)}var y;if(wn)e:{switch(e){case"compositionstart":var b="onCompositionStart";break e;case"compositionend":b="onCompositionEnd";break e;case"compositionupdate":b="onCompositionUpdate";break e}b=void 0}else Pn?Mn(e,n)&&(b="onCompositionEnd"):"keydown"===e&&229===n.keyCode&&(b="onCompositionStart");b&&(En&&"ko"!==n.locale&&(Pn||"onCompositionStart"!==b?"onCompositionEnd"===b&&Pn&&(y=Gt()):(jt="value"in(Ut=r)?Ut.value:Ut.textContent,Pn=!0)),0<(v=Bh(i,b)).length&&(b=new ln(b,e,null,n,r),a.push({event:b,listeners:v}),y?b.data=y:null!==(y=Tn(n))&&(b.data=y))),(y=_n?function(e,t){switch(e){case"compositionend":return Tn(t);case"keypress":return 32!==t.which?null:(Cn=!0,An);case"textInput":return(e=t.data)===An&&Cn?null:e;default:return null}}(e,n):function(e,t){if(Pn)return"compositionend"===e||!wn&&Mn(e,t)?(e=Gt(),Vt=jt=Ut=null,Pn=!1,e):null;switch(e){case"paste":default:return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return En&&"ko"!==t.locale?null:t.data}}(e,n))&&(0<(b=Bh(i,"onBeforeInput")).length&&(v=new ln("onBeforeInput","beforeinput",null,n,r),a.push({event:v,listeners:b}),v.data=y)),function(e,t,n,i,r){if("submit"===t&&n&&n.stateNode===r){var s=Sh((r[Fe]||null).action),a=i.submitter;a&&null!==(t=(t=a[Fe]||null)?Sh(t.formAction):a.getAttribute("formAction"))&&(s=t,a=null);var o=new Jt("action","action",null,i,r);e.push({event:o,listeners:[{instance:null,listener:function(){if(i.defaultPrevented){if(0!==fh){var e=a?_h(r,a):new FormData(r);ha(n,{pending:!0,data:e,method:r.method,action:s},null,e)}}else"function"===typeof s&&(o.preventDefault(),e=a?_h(r,a):new FormData(r),ha(n,{pending:!0,data:e,method:r.method,action:s},s,e))},currentTarget:r}]})}}(a,e,i,n,r)}Th(a,t)}))}function Lh(e,t,n){return{instance:e,listener:t,currentTarget:n}}function Bh(e,t){for(var n=t+"Capture",i=[];null!==e;){var r=e,s=r.stateNode;5!==(r=r.tag)&&26!==r&&27!==r||null===s||(null!=(r=zt(e,n))&&i.unshift(Lh(e,r,s)),null!=(r=zt(e,t))&&i.push(Lh(e,r,s))),e=e.return}return i}function zh(e){if(null===e)return null;do{e=e.return}while(e&&5!==e.tag&&27!==e.tag);return e||null}function Nh(e,t,n,i,r){for(var s=t._reactName,a=[];null!==n&&n!==i;){var o=n,l=o.alternate,c=o.stateNode;if(o=o.tag,null!==l&&l===i)break;5!==o&&26!==o&&27!==o||null===c||(l=c,r?null!=(c=zt(n,s))&&a.unshift(Lh(n,c,l)):r||null!=(c=zt(n,s))&&a.push(Lh(n,c,l))),n=n.return}0!==a.length&&e.push({event:t,listeners:a})}var Fh=/\r\n?/g,Uh=/\u0000|\uFFFD/g;function jh(e){return("string"===typeof e?e:""+e).replace(Fh,"\n").replace(Uh,"")}function Vh(e,t){return t=jh(t),jh(e)===t}function Gh(){}function Hh(e,t,n,i,r,s){switch(n){case"children":"string"===typeof i?"body"===t||"textarea"===t&&""===i||St(e,i):("number"===typeof i||"bigint"===typeof i)&&"body"!==t&&St(e,""+i);break;case"className":ot(e,"class",i);break;case"tabIndex":ot(e,"tabindex",i);break;case"dir":case"role":case"viewBox":case"width":case"height":ot(e,n,i);break;case"style":At(e,i,s);break;case"data":if("object"!==t){ot(e,"data",i);break}case"src":case"href":if(""===i&&("a"!==t||"href"!==n)){e.removeAttribute(n);break}if(null==i||"function"===typeof i||"symbol"===typeof i||"boolean"===typeof i){e.removeAttribute(n);break}i=Pt(""+i),e.setAttribute(n,i);break;case"action":case"formAction":if("function"===typeof i){e.setAttribute(n,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}if("function"===typeof s&&("formAction"===n?("input"!==t&&Hh(e,t,"name",r.name,r,null),Hh(e,t,"formEncType",r.formEncType,r,null),Hh(e,t,"formMethod",r.formMethod,r,null),Hh(e,t,"formTarget",r.formTarget,r,null)):(Hh(e,t,"encType",r.encType,r,null),Hh(e,t,"method",r.method,r,null),Hh(e,t,"target",r.target,r,null))),null==i||"symbol"===typeof i||"boolean"===typeof i){e.removeAttribute(n);break}i=Pt(""+i),e.setAttribute(n,i);break;case"onClick":null!=i&&(e.onclick=Gh);break;case"onScroll":null!=i&&Ph("scroll",e);break;case"onScrollEnd":null!=i&&Ph("scrollend",e);break;case"dangerouslySetInnerHTML":if(null!=i){if("object"!==typeof i||!("__html"in i))throw Error(a(61));if(null!=(n=i.__html)){if(null!=r.children)throw Error(a(60));e.innerHTML=n}}break;case"multiple":e.multiple=i&&"function"!==typeof i&&"symbol"!==typeof i;break;case"muted":e.muted=i&&"function"!==typeof i&&"symbol"!==typeof i;break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":case"autoFocus":break;case"xlinkHref":if(null==i||"function"===typeof i||"boolean"===typeof i||"symbol"===typeof i){e.removeAttribute("xlink:href");break}n=Pt(""+i),e.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",n);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":null!=i&&"function"!==typeof i&&"symbol"!==typeof i?e.setAttribute(n,""+i):e.removeAttribute(n);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":i&&"function"!==typeof i&&"symbol"!==typeof i?e.setAttribute(n,""):e.removeAttribute(n);break;case"capture":case"download":!0===i?e.setAttribute(n,""):!1!==i&&null!=i&&"function"!==typeof i&&"symbol"!==typeof i?e.setAttribute(n,i):e.removeAttribute(n);break;case"cols":case"rows":case"size":case"span":null!=i&&"function"!==typeof i&&"symbol"!==typeof i&&!isNaN(i)&&1<=i?e.setAttribute(n,i):e.removeAttribute(n);break;case"rowSpan":case"start":null==i||"function"===typeof i||"symbol"===typeof i||isNaN(i)?e.removeAttribute(n):e.setAttribute(n,i);break;case"popover":Ph("beforetoggle",e),Ph("toggle",e),at(e,"popover",i);break;case"xlinkActuate":lt(e,"http://www.w3.org/1999/xlink","xlink:actuate",i);break;case"xlinkArcrole":lt(e,"http://www.w3.org/1999/xlink","xlink:arcrole",i);break;case"xlinkRole":lt(e,"http://www.w3.org/1999/xlink","xlink:role",i);break;case"xlinkShow":lt(e,"http://www.w3.org/1999/xlink","xlink:show",i);break;case"xlinkTitle":lt(e,"http://www.w3.org/1999/xlink","xlink:title",i);break;case"xlinkType":lt(e,"http://www.w3.org/1999/xlink","xlink:type",i);break;case"xmlBase":lt(e,"http://www.w3.org/XML/1998/namespace","xml:base",i);break;case"xmlLang":lt(e,"http://www.w3.org/XML/1998/namespace","xml:lang",i);break;case"xmlSpace":lt(e,"http://www.w3.org/XML/1998/namespace","xml:space",i);break;case"is":at(e,"is",i);break;case"innerText":case"textContent":break;default:(!(2<n.length)||"o"!==n[0]&&"O"!==n[0]||"n"!==n[1]&&"N"!==n[1])&&at(e,n=Mt.get(n)||n,i)}}function Wh(e,t,n,i,r,s){switch(n){case"style":At(e,i,s);break;case"dangerouslySetInnerHTML":if(null!=i){if("object"!==typeof i||!("__html"in i))throw Error(a(61));if(null!=(n=i.__html)){if(null!=r.children)throw Error(a(60));e.innerHTML=n}}break;case"children":"string"===typeof i?St(e,i):("number"===typeof i||"bigint"===typeof i)&&St(e,""+i);break;case"onScroll":null!=i&&Ph("scroll",e);break;case"onScrollEnd":null!=i&&Ph("scrollend",e);break;case"onClick":null!=i&&(e.onclick=Gh);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":case"innerText":case"textContent":break;default:$e.hasOwnProperty(n)||("o"!==n[0]||"n"!==n[1]||(r=n.endsWith("Capture"),t=n.slice(2,r?n.length-7:void 0),"function"===typeof(s=null!=(s=e[Fe]||null)?s[n]:null)&&e.removeEventListener(t,s,r),"function"!==typeof i)?n in e?e[n]=i:!0===i?e.setAttribute(n,""):at(e,n,i):("function"!==typeof s&&null!==s&&(n in e?e[n]=null:e.hasAttribute(n)&&e.removeAttribute(n)),e.addEventListener(t,i,r)))}}function qh(e,t,n){switch(t){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":Ph("error",e),Ph("load",e);var i,r=!1,s=!1;for(i in n)if(n.hasOwnProperty(i)){var o=n[i];if(null!=o)switch(i){case"src":r=!0;break;case"srcSet":s=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(a(137,t));default:Hh(e,t,i,o,n,null)}}return s&&Hh(e,t,"srcSet",n.srcSet,n,null),void(r&&Hh(e,t,"src",n.src,n,null));case"input":Ph("invalid",e);var l=i=o=s=null,c=null,h=null;for(r in n)if(n.hasOwnProperty(r)){var u=n[r];if(null!=u)switch(r){case"name":s=u;break;case"type":o=u;break;case"checked":c=u;break;case"defaultChecked":h=u;break;case"value":i=u;break;case"defaultValue":l=u;break;case"children":case"dangerouslySetInnerHTML":if(null!=u)throw Error(a(137,t));break;default:Hh(e,t,r,u,n,null)}}return vt(e,i,l,c,h,o,s,!1),void ut(e);case"select":for(s in Ph("invalid",e),r=o=i=null,n)if(n.hasOwnProperty(s)&&null!=(l=n[s]))switch(s){case"value":i=l;break;case"defaultValue":o=l;break;case"multiple":r=l;default:Hh(e,t,s,l,n,null)}return t=i,n=o,e.multiple=!!r,void(null!=t?bt(e,!!r,t,!1):null!=n&&bt(e,!!r,n,!0));case"textarea":for(o in Ph("invalid",e),i=s=r=null,n)if(n.hasOwnProperty(o)&&null!=(l=n[o]))switch(o){case"value":r=l;break;case"defaultValue":s=l;break;case"children":i=l;break;case"dangerouslySetInnerHTML":if(null!=l)throw Error(a(91));break;default:Hh(e,t,o,l,n,null)}return wt(e,r,s,i),void ut(e);case"option":for(c in n)if(n.hasOwnProperty(c)&&null!=(r=n[c]))if("selected"===c)e.selected=r&&"function"!==typeof r&&"symbol"!==typeof r;else Hh(e,t,c,r,n,null);return;case"dialog":Ph("cancel",e),Ph("close",e);break;case"iframe":case"object":Ph("load",e);break;case"video":case"audio":for(r=0;r<Ch.length;r++)Ph(Ch[r],e);break;case"image":Ph("error",e),Ph("load",e);break;case"details":Ph("toggle",e);break;case"embed":case"source":case"link":Ph("error",e),Ph("load",e);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(h in n)if(n.hasOwnProperty(h)&&null!=(r=n[h]))switch(h){case"children":case"dangerouslySetInnerHTML":throw Error(a(137,t));default:Hh(e,t,h,r,n,null)}return;default:if(Ct(t)){for(u in n)n.hasOwnProperty(u)&&(void 0!==(r=n[u])&&Wh(e,t,u,r,n,void 0));return}}for(l in n)n.hasOwnProperty(l)&&(null!=(r=n[l])&&Hh(e,t,l,r,n,null))}var Xh=null,Yh=null;function Qh(e){return 9===e.nodeType?e:e.ownerDocument}function Kh(e){switch(e){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function Zh(e,t){if(0===e)switch(t){case"svg":return 1;case"math":return 2;default:return 0}return 1===e&&"foreignObject"===t?0:e}function Jh(e,t){return"textarea"===e||"noscript"===e||"string"===typeof t.children||"number"===typeof t.children||"bigint"===typeof t.children||"object"===typeof t.dangerouslySetInnerHTML&&null!==t.dangerouslySetInnerHTML&&null!=t.dangerouslySetInnerHTML.__html}var $h=null;var eu="function"===typeof setTimeout?setTimeout:void 0,tu="function"===typeof clearTimeout?clearTimeout:void 0,nu="function"===typeof Promise?Promise:void 0,iu="function"===typeof queueMicrotask?queueMicrotask:"undefined"!==typeof nu?function(e){return nu.resolve(null).then(e).catch(ru)}:eu;function ru(e){setTimeout((function(){throw e}))}function su(e,t){var n=t,i=0;do{var r=n.nextSibling;if(e.removeChild(n),r&&8===r.nodeType)if("/$"===(n=r.data)){if(0===i)return e.removeChild(r),void md(t);i--}else"$"!==n&&"$?"!==n&&"$!"!==n||i++;n=r}while(n);md(t)}function au(e){var t=e.firstChild;for(t&&10===t.nodeType&&(t=t.nextSibling);t;){var n=t;switch(t=t.nextSibling,n.nodeName){case"HTML":case"HEAD":case"BODY":au(n),qe(n);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if("stylesheet"===n.rel.toLowerCase())continue}e.removeChild(n)}}function ou(e){for(;null!=e;e=e.nextSibling){var t=e.nodeType;if(1===t||3===t)break;if(8===t){if("$"===(t=e.data)||"$!"===t||"$?"===t||"F!"===t||"F"===t)break;if("/$"===t)return null}}return e}function lu(e){e=e.previousSibling;for(var t=0;e;){if(8===e.nodeType){var n=e.data;if("$"===n||"$!"===n||"$?"===n){if(0===t)return e;t--}else"/$"===n&&t++}e=e.previousSibling}return null}function cu(e,t,n){switch(t=Qh(n),e){case"html":if(!(e=t.documentElement))throw Error(a(452));return e;case"head":if(!(e=t.head))throw Error(a(453));return e;case"body":if(!(e=t.body))throw Error(a(454));return e;default:throw Error(a(451))}}var hu=new Map,uu=new Set;function du(e){return"function"===typeof e.getRootNode?e.getRootNode():e.ownerDocument}var pu=V.d;V.d={f:function(){var e=pu.f(),t=Nc();return e||t},r:function(e){var t=Ye(e);null!==t&&5===t.tag&&"form"===t.type?da(t):pu.r(e)},D:function(e){pu.D(e),mu("dns-prefetch",e,null)},C:function(e,t){pu.C(e,t),mu("preconnect",e,t)},L:function(e,t,n){pu.L(e,t,n);var i=fu;if(i&&e&&t){var r='link[rel="preload"][as="'+mt(t)+'"]';"image"===t&&n&&n.imageSrcSet?(r+='[imagesrcset="'+mt(n.imageSrcSet)+'"]',"string"===typeof n.imageSizes&&(r+='[imagesizes="'+mt(n.imageSizes)+'"]')):r+='[href="'+mt(e)+'"]';var s=r;switch(t){case"style":s=vu(e);break;case"script":s=xu(e)}hu.has(s)||(e=O({rel:"preload",href:"image"===t&&n&&n.imageSrcSet?void 0:e,as:t},n),hu.set(s,e),null!==i.querySelector(r)||"style"===t&&i.querySelector(yu(s))||"script"===t&&i.querySelector(wu(s))||(qh(t=i.createElement("link"),"link",e),Ze(t),i.head.appendChild(t)))}},m:function(e,t){pu.m(e,t);var n=fu;if(n&&e){var i=t&&"string"===typeof t.as?t.as:"script",r='link[rel="modulepreload"][as="'+mt(i)+'"][href="'+mt(e)+'"]',s=r;switch(i){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":s=xu(e)}if(!hu.has(s)&&(e=O({rel:"modulepreload",href:e},t),hu.set(s,e),null===n.querySelector(r))){switch(i){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(n.querySelector(wu(s)))return}qh(i=n.createElement("link"),"link",e),Ze(i),n.head.appendChild(i)}}},X:function(e,t){pu.X(e,t);var n=fu;if(n&&e){var i=Ke(n).hoistableScripts,r=xu(e),s=i.get(r);s||((s=n.querySelector(wu(r)))||(e=O({src:e,async:!0},t),(t=hu.get(r))&&Au(e,t),Ze(s=n.createElement("script")),qh(s,"link",e),n.head.appendChild(s)),s={type:"script",instance:s,count:1,state:null},i.set(r,s))}},S:function(e,t,n){pu.S(e,t,n);var i=fu;if(i&&e){var r=Ke(i).hoistableStyles,s=vu(e);t=t||"default";var a=r.get(s);if(!a){var o={loading:0,preload:null};if(a=i.querySelector(yu(s)))o.loading=5;else{e=O({rel:"stylesheet",href:e,"data-precedence":t},n),(n=hu.get(s))&&Eu(e,n);var l=a=i.createElement("link");Ze(l),qh(l,"link",e),l._p=new Promise((function(e,t){l.onload=e,l.onerror=t})),l.addEventListener("load",(function(){o.loading|=1})),l.addEventListener("error",(function(){o.loading|=2})),o.loading|=4,_u(a,t,i)}a={type:"stylesheet",instance:a,count:1,state:o},r.set(s,a)}}},M:function(e,t){pu.M(e,t);var n=fu;if(n&&e){var i=Ke(n).hoistableScripts,r=xu(e),s=i.get(r);s||((s=n.querySelector(wu(r)))||(e=O({src:e,async:!0,type:"module"},t),(t=hu.get(r))&&Au(e,t),Ze(s=n.createElement("script")),qh(s,"link",e),n.head.appendChild(s)),s={type:"script",instance:s,count:1,state:null},i.set(r,s))}}};var fu="undefined"===typeof document?null:document;function mu(e,t,n){var i=fu;if(i&&"string"===typeof t&&t){var r=mt(t);r='link[rel="'+e+'"][href="'+r+'"]',"string"===typeof n&&(r+='[crossorigin="'+n+'"]'),uu.has(r)||(uu.add(r),e={rel:e,crossOrigin:n,href:t},null===i.querySelector(r)&&(qh(t=i.createElement("link"),"link",e),Ze(t),i.head.appendChild(t)))}}function gu(e,t,n,i){var r,s,o,l,c=(c=Z.current)?du(c):null;if(!c)throw Error(a(446));switch(e){case"meta":case"title":return null;case"style":return"string"===typeof n.precedence&&"string"===typeof n.href?(t=vu(n.href),(i=(n=Ke(c).hoistableStyles).get(t))||(i={type:"style",instance:null,count:0,state:null},n.set(t,i)),i):{type:"void",instance:null,count:0,state:null};case"link":if("stylesheet"===n.rel&&"string"===typeof n.href&&"string"===typeof n.precedence){e=vu(n.href);var h=Ke(c).hoistableStyles,u=h.get(e);if(u||(c=c.ownerDocument||c,u={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},h.set(e,u),(h=c.querySelector(yu(e)))&&!h._p&&(u.instance=h,u.state.loading=5),hu.has(e)||(n={rel:"preload",as:"style",href:n.href,crossOrigin:n.crossOrigin,integrity:n.integrity,media:n.media,hrefLang:n.hrefLang,referrerPolicy:n.referrerPolicy},hu.set(e,n),h||(r=c,s=e,o=n,l=u.state,r.querySelector('link[rel="preload"][as="style"]['+s+"]")?l.loading=1:(s=r.createElement("link"),l.preload=s,s.addEventListener("load",(function(){return l.loading|=1})),s.addEventListener("error",(function(){return l.loading|=2})),qh(s,"link",o),Ze(s),r.head.appendChild(s))))),t&&null===i)throw Error(a(528,""));return u}if(t&&null!==i)throw Error(a(529,""));return null;case"script":return t=n.async,"string"===typeof(n=n.src)&&t&&"function"!==typeof t&&"symbol"!==typeof t?(t=xu(n),(i=(n=Ke(c).hoistableScripts).get(t))||(i={type:"script",instance:null,count:0,state:null},n.set(t,i)),i):{type:"void",instance:null,count:0,state:null};default:throw Error(a(444,e))}}function vu(e){return'href="'+mt(e)+'"'}function yu(e){return'link[rel="stylesheet"]['+e+"]"}function bu(e){return O({},e,{"data-precedence":e.precedence,precedence:null})}function xu(e){return'[src="'+mt(e)+'"]'}function wu(e){return"script[async]"+e}function Su(e,t,n){if(t.count++,null===t.instance)switch(t.type){case"style":var i=e.querySelector('style[data-href~="'+mt(n.href)+'"]');if(i)return t.instance=i,Ze(i),i;var r=O({},n,{"data-href":n.href,"data-precedence":n.precedence,href:null,precedence:null});return Ze(i=(e.ownerDocument||e).createElement("style")),qh(i,"style",r),_u(i,n.precedence,e),t.instance=i;case"stylesheet":r=vu(n.href);var s=e.querySelector(yu(r));if(s)return t.state.loading|=4,t.instance=s,Ze(s),s;i=bu(n),(r=hu.get(r))&&Eu(i,r),Ze(s=(e.ownerDocument||e).createElement("link"));var o=s;return o._p=new Promise((function(e,t){o.onload=e,o.onerror=t})),qh(s,"link",i),t.state.loading|=4,_u(s,n.precedence,e),t.instance=s;case"script":return s=xu(n.src),(r=e.querySelector(wu(s)))?(t.instance=r,Ze(r),r):(i=n,(r=hu.get(s))&&Au(i=O({},n),r),Ze(r=(e=e.ownerDocument||e).createElement("script")),qh(r,"link",i),e.head.appendChild(r),t.instance=r);case"void":return null;default:throw Error(a(443,t.type))}else"stylesheet"===t.type&&0===(4&t.state.loading)&&(i=t.instance,t.state.loading|=4,_u(i,n.precedence,e));return t.instance}function _u(e,t,n){for(var i=n.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),r=i.length?i[i.length-1]:null,s=r,a=0;a<i.length;a++){var o=i[a];if(o.dataset.precedence===t)s=o;else if(s!==r)break}s?s.parentNode.insertBefore(e,s.nextSibling):(t=9===n.nodeType?n.head:n).insertBefore(e,t.firstChild)}function Eu(e,t){null==e.crossOrigin&&(e.crossOrigin=t.crossOrigin),null==e.referrerPolicy&&(e.referrerPolicy=t.referrerPolicy),null==e.title&&(e.title=t.title)}function Au(e,t){null==e.crossOrigin&&(e.crossOrigin=t.crossOrigin),null==e.referrerPolicy&&(e.referrerPolicy=t.referrerPolicy),null==e.integrity&&(e.integrity=t.integrity)}var Cu=null;function Mu(e,t,n){if(null===Cu){var i=new Map,r=Cu=new Map;r.set(n,i)}else(i=(r=Cu).get(n))||(i=new Map,r.set(n,i));if(i.has(e))return i;for(i.set(e,null),n=n.getElementsByTagName(e),r=0;r<n.length;r++){var s=n[r];if(!(s[We]||s[Ne]||"link"===e&&"stylesheet"===s.getAttribute("rel"))&&"http://www.w3.org/2000/svg"!==s.namespaceURI){var a=s.getAttribute(t)||"";a=e+a;var o=i.get(a);o?o.push(s):i.set(a,[s])}}return i}function Tu(e,t,n){(e=e.ownerDocument||e).head.insertBefore(n,"title"===t?e.querySelector("head > title"):null)}function Pu(e){return"stylesheet"!==e.type||0!==(3&e.state.loading)}var Du=null;function Ou(){}function Iu(){if(this.count--,0===this.count)if(this.stylesheets)ku(this,this.stylesheets);else if(this.unsuspend){var e=this.unsuspend;this.unsuspend=null,e()}}var Ru=null;function ku(e,t){e.stylesheets=null,null!==e.unsuspend&&(e.count++,Ru=new Map,t.forEach(Lu,e),Ru=null,Iu.call(e))}function Lu(e,t){if(!(4&t.state.loading)){var n=Ru.get(e);if(n)var i=n.get(null);else{n=new Map,Ru.set(e,n);for(var r=e.querySelectorAll("link[data-precedence],style[data-precedence]"),s=0;s<r.length;s++){var a=r[s];"LINK"!==a.nodeName&&"not all"===a.getAttribute("media")||(n.set(a.dataset.precedence,a),i=a)}i&&n.set(null,i)}a=(r=t.instance).getAttribute("data-precedence"),(s=n.get(a)||i)===i&&n.set(null,r),n.set(a,r),this.count++,i=Iu.bind(this),r.addEventListener("load",i),r.addEventListener("error",i),s?s.parentNode.insertBefore(r,s.nextSibling):(e=9===e.nodeType?e.head:e).insertBefore(r,e.firstChild),t.state.loading|=4}}var Bu={$$typeof:g,Provider:null,Consumer:null,_currentValue:G,_currentValue2:G,_threadCount:0};function zu(e,t,n,i,r,s,a,o){this.tag=1,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=Oe(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.finishedLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Oe(0),this.hiddenUpdates=Oe(null),this.identifierPrefix=i,this.onUncaughtError=r,this.onCaughtError=s,this.onRecoverableError=a,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=o,this.incompleteTransitions=new Map}function Nu(e,t,n,i,r,s,a,o,l,c,h,u){return e=new zu(e,t,n,a,o,l,c,u),t=1,!0===s&&(t|=24),s=Ll(3,null,null,t),e.current=s,s.stateNode=e,(t=Ur()).refCount++,e.pooledCache=t,t.refCount++,s.memoizedState={element:i,isDehydrated:n,cache:t},Po(s),e}function Fu(e){return e?e=Ii:Ii}function Uu(e,t,n,i,r,s){r=Fu(r),null===i.context?i.context=r:i.pendingContext=r,(i=Oo(t)).payload={element:n},null!==(s=void 0===s?null:s)&&(i.callback=s),null!==(n=Io(e,i,t))&&(Ic(n,0,t),Ro(n,e,t))}function ju(e,t){if(null!==(e=e.memoizedState)&&null!==e.dehydrated){var n=e.retryLane;e.retryLane=0!==n&&n<t?n:t}}function Vu(e,t){ju(e,t),(e=e.alternate)&&ju(e,t)}function Gu(e){if(13===e.tag){var t=Pi(e,67108864);null!==t&&Ic(t,0,67108864),Vu(e,67108864)}}var Hu=!0;function Wu(e,t,n,i){var r=D.T;D.T=null;var s=V.p;try{V.p=2,Xu(e,t,n,i)}finally{V.p=s,D.T=r}}function qu(e,t,n,i){var r=D.T;D.T=null;var s=V.p;try{V.p=8,Xu(e,t,n,i)}finally{V.p=s,D.T=r}}function Xu(e,t,n,i){if(Hu){var r=Yu(i);if(null===r)kh(e,t,i,Qu,n),ad(e,i);else if(function(e,t,n,i,r){switch(t){case"focusin":return $u=od($u,e,t,n,i,r),!0;case"dragenter":return ed=od(ed,e,t,n,i,r),!0;case"mouseover":return td=od(td,e,t,n,i,r),!0;case"pointerover":var s=r.pointerId;return nd.set(s,od(nd.get(s)||null,e,t,n,i,r)),!0;case"gotpointercapture":return s=r.pointerId,id.set(s,od(id.get(s)||null,e,t,n,i,r)),!0}return!1}(r,e,t,n,i))i.stopPropagation();else if(ad(e,i),4&t&&-1<sd.indexOf(e)){for(;null!==r;){var s=Ye(r);if(null!==s)switch(s.tag){case 3:if((s=s.stateNode).current.memoizedState.isDehydrated){var a=Ae(s.pendingLanes);if(0!==a){var o=s;for(o.pendingLanes|=2,o.entangledLanes|=2;a;){var l=1<<31-xe(a);o.entanglements[1]|=l,a&=~l}mh(s),0===(6&ec)&&(xc=le()+500,gh(0,!1))}}break;case 13:null!==(o=Pi(s,2))&&Ic(o,0,2),Nc(),Vu(s,2)}if(null===(s=Yu(i))&&kh(e,t,i,Qu,n),s===r)break;r=s}null!==r&&i.stopPropagation()}else kh(e,t,i,null,n)}}function Yu(e){return Ku(e=Ot(e))}var Qu=null;function Ku(e){if(Qu=null,null!==(e=Xe(e))){var t=z(e);if(null===t)e=null;else{var n=t.tag;if(13===n){if(null!==(e=N(t)))return e;e=null}else if(3===n){if(t.stateNode.current.memoizedState.isDehydrated)return 3===t.tag?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null)}}return Qu=e,null}function Zu(e){switch(e){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(ce()){case he:return 2;case ue:return 8;case de:case pe:return 32;case fe:return 268435456;default:return 32}default:return 32}}var Ju=!1,$u=null,ed=null,td=null,nd=new Map,id=new Map,rd=[],sd="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function ad(e,t){switch(e){case"focusin":case"focusout":$u=null;break;case"dragenter":case"dragleave":ed=null;break;case"mouseover":case"mouseout":td=null;break;case"pointerover":case"pointerout":nd.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":id.delete(t.pointerId)}}function od(e,t,n,i,r,s){return null===e||e.nativeEvent!==s?(e={blockedOn:t,domEventName:n,eventSystemFlags:i,nativeEvent:s,targetContainers:[r]},null!==t&&(null!==(t=Ye(t))&&Gu(t)),e):(e.eventSystemFlags|=i,t=e.targetContainers,null!==r&&-1===t.indexOf(r)&&t.push(r),e)}function ld(e){var t=Xe(e.target);if(null!==t){var n=z(t);if(null!==n)if(13===(t=n.tag)){if(null!==(t=N(n)))return e.blockedOn=t,void function(e,t){var n=V.p;try{return V.p=e,t()}finally{V.p=n}}(e.priority,(function(){if(13===n.tag){var e=Dc(),t=Pi(n,e);null!==t&&Ic(t,0,e),Vu(n,e)}}))}else if(3===t&&n.stateNode.current.memoizedState.isDehydrated)return void(e.blockedOn=3===n.tag?n.stateNode.containerInfo:null)}e.blockedOn=null}function cd(e){if(null!==e.blockedOn)return!1;for(var t=e.targetContainers;0<t.length;){var n=Yu(e.nativeEvent);if(null!==n)return null!==(t=Ye(n))&&Gu(t),e.blockedOn=n,!1;var i=new(n=e.nativeEvent).constructor(n.type,n);Dt=i,n.target.dispatchEvent(i),Dt=null,t.shift()}return!0}function hd(e,t,n){cd(e)&&n.delete(t)}function ud(){Ju=!1,null!==$u&&cd($u)&&($u=null),null!==ed&&cd(ed)&&(ed=null),null!==td&&cd(td)&&(td=null),nd.forEach(hd),id.forEach(hd)}function dd(e,t){e.blockedOn===t&&(e.blockedOn=null,Ju||(Ju=!0,i.unstable_scheduleCallback(i.unstable_NormalPriority,ud)))}var pd=null;function fd(e){pd!==e&&(pd=e,i.unstable_scheduleCallback(i.unstable_NormalPriority,(function(){pd===e&&(pd=null);for(var t=0;t<e.length;t+=3){var n=e[t],i=e[t+1],r=e[t+2];if("function"!==typeof i){if(null===Ku(i||n))continue;break}var s=Ye(n);null!==s&&(e.splice(t,3),t-=3,ha(s,{pending:!0,data:r,method:n.method,action:i},i,r))}})))}function md(e){function t(t){return dd(t,e)}null!==$u&&dd($u,e),null!==ed&&dd(ed,e),null!==td&&dd(td,e),nd.forEach(t),id.forEach(t);for(var n=0;n<rd.length;n++){var i=rd[n];i.blockedOn===e&&(i.blockedOn=null)}for(;0<rd.length&&null===(n=rd[0]).blockedOn;)ld(n),null===n.blockedOn&&rd.shift();if(null!=(n=(e.ownerDocument||e).$$reactFormReplay))for(i=0;i<n.length;i+=3){var r=n[i],s=n[i+1],a=r[Fe]||null;if("function"===typeof s)a||fd(n);else if(a){var o=null;if(s&&s.hasAttribute("formAction")){if(r=s,a=s[Fe]||null)o=a.formAction;else if(null!==Ku(r))continue}else o=a.action;"function"===typeof o?n[i+1]=o:(n.splice(i,3),i-=3),fd(n)}}}function gd(e){this._internalRoot=e}function vd(e){this._internalRoot=e}vd.prototype.render=gd.prototype.render=function(e){var t=this._internalRoot;if(null===t)throw Error(a(409));Uu(t.current,Dc(),e,t,null,null)},vd.prototype.unmount=gd.prototype.unmount=function(){var e=this._internalRoot;if(null!==e){this._internalRoot=null;var t=e.containerInfo;0===e.tag&&th(),Uu(e.current,2,null,e,null,null),Nc(),t[Ue]=null}},vd.prototype.unstable_scheduleHydration=function(e){if(e){var t=Be();e={blockedOn:null,target:e,priority:t};for(var n=0;n<rd.length&&0!==t&&t<rd[n].priority;n++);rd.splice(n,0,e),0===n&&ld(e)}};var yd=r.version;if("19.0.0"!==yd)throw Error(a(527,yd,"19.0.0"));V.findDOMNode=function(e){var t=e._reactInternals;if(void 0===t){if("function"===typeof e.render)throw Error(a(188));throw e=Object.keys(e).join(","),Error(a(268,e))}return e=function(e){var t=e.alternate;if(!t){if(null===(t=z(e)))throw Error(a(188));return t!==e?null:e}for(var n=e,i=t;;){var r=n.return;if(null===r)break;var s=r.alternate;if(null===s){if(null!==(i=r.return)){n=i;continue}break}if(r.child===s.child){for(s=r.child;s;){if(s===n)return F(r),e;if(s===i)return F(r),t;s=s.sibling}throw Error(a(188))}if(n.return!==i.return)n=r,i=s;else{for(var o=!1,l=r.child;l;){if(l===n){o=!0,n=r,i=s;break}if(l===i){o=!0,i=r,n=s;break}l=l.sibling}if(!o){for(l=s.child;l;){if(l===n){o=!0,n=s,i=r;break}if(l===i){o=!0,i=s,n=r;break}l=l.sibling}if(!o)throw Error(a(189))}}if(n.alternate!==i)throw Error(a(190))}if(3!==n.tag)throw Error(a(188));return n.stateNode.current===n?e:t}(t),e=null===(e=null!==e?U(e):null)?null:e.stateNode};var bd={bundleType:0,version:"19.0.0",rendererPackageName:"react-dom",currentDispatcherRef:D,findFiberByHostInstance:Xe,reconcilerVersion:"19.0.0"};if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__){var xd=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!xd.isDisabled&&xd.supportsFiber)try{ve=xd.inject(bd),ye=xd}catch(Sd){}}t.createRoot=function(e,t){if(!o(e))throw Error(a(299));var n=!1,i="",r=ka,s=La,l=Ba;return null!==t&&void 0!==t&&(!0===t.unstable_strictMode&&(n=!0),void 0!==t.identifierPrefix&&(i=t.identifierPrefix),void 0!==t.onUncaughtError&&(r=t.onUncaughtError),void 0!==t.onCaughtError&&(s=t.onCaughtError),void 0!==t.onRecoverableError&&(l=t.onRecoverableError),void 0!==t.unstable_transitionCallbacks&&t.unstable_transitionCallbacks),t=Nu(e,1,!1,null,0,n,i,r,s,l,0,null),e[Ue]=t.current,Ih(8===e.nodeType?e.parentNode:e),new gd(t)},t.hydrateRoot=function(e,t,n){if(!o(e))throw Error(a(299));var i=!1,r="",s=ka,l=La,c=Ba,h=null;return null!==n&&void 0!==n&&(!0===n.unstable_strictMode&&(i=!0),void 0!==n.identifierPrefix&&(r=n.identifierPrefix),void 0!==n.onUncaughtError&&(s=n.onUncaughtError),void 0!==n.onCaughtError&&(l=n.onCaughtError),void 0!==n.onRecoverableError&&(c=n.onRecoverableError),void 0!==n.unstable_transitionCallbacks&&n.unstable_transitionCallbacks,void 0!==n.formState&&(h=n.formState)),(t=Nu(e,1,!0,t,0,i,r,s,l,c,0,h)).context=Fu(null),n=t.current,(r=Oo(i=Dc())).callback=null,Io(n,r,i),t.current.lanes=i,Ie(t,i),mh(t),e[Ue]=t.current,Ih(e),new vd(t)},t.version="19.0.0"},672:(e,t,n)=>{"use strict";var i=n(43);function r(e){var t="https://react.dev/errors/"+e;if(1<arguments.length){t+="?args[]="+encodeURIComponent(arguments[1]);for(var n=2;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n])}return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function s(){}var a={d:{f:s,r:function(){throw Error(r(522))},D:s,C:s,L:s,m:s,X:s,S:s,M:s},p:0,findDOMNode:null},o=Symbol.for("react.portal");var l=i.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function c(e,t){return"font"===e?"":"string"===typeof t?"use-credentials"===t?t:"":void 0}t.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=a,t.createPortal=function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(!t||1!==t.nodeType&&9!==t.nodeType&&11!==t.nodeType)throw Error(r(299));return function(e,t,n){var i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:o,key:null==i?null:""+i,children:e,containerInfo:t,implementation:n}}(e,t,null,n)},t.flushSync=function(e){var t=l.T,n=a.p;try{if(l.T=null,a.p=2,e)return e()}finally{l.T=t,a.p=n,a.d.f()}},t.preconnect=function(e,t){"string"===typeof e&&(t?t="string"===typeof(t=t.crossOrigin)?"use-credentials"===t?t:"":void 0:t=null,a.d.C(e,t))},t.prefetchDNS=function(e){"string"===typeof e&&a.d.D(e)},t.preinit=function(e,t){if("string"===typeof e&&t&&"string"===typeof t.as){var n=t.as,i=c(n,t.crossOrigin),r="string"===typeof t.integrity?t.integrity:void 0,s="string"===typeof t.fetchPriority?t.fetchPriority:void 0;"style"===n?a.d.S(e,"string"===typeof t.precedence?t.precedence:void 0,{crossOrigin:i,integrity:r,fetchPriority:s}):"script"===n&&a.d.X(e,{crossOrigin:i,integrity:r,fetchPriority:s,nonce:"string"===typeof t.nonce?t.nonce:void 0})}},t.preinitModule=function(e,t){if("string"===typeof e)if("object"===typeof t&&null!==t){if(null==t.as||"script"===t.as){var n=c(t.as,t.crossOrigin);a.d.M(e,{crossOrigin:n,integrity:"string"===typeof t.integrity?t.integrity:void 0,nonce:"string"===typeof t.nonce?t.nonce:void 0})}}else null==t&&a.d.M(e)},t.preload=function(e,t){if("string"===typeof e&&"object"===typeof t&&null!==t&&"string"===typeof t.as){var n=t.as,i=c(n,t.crossOrigin);a.d.L(e,n,{crossOrigin:i,integrity:"string"===typeof t.integrity?t.integrity:void 0,nonce:"string"===typeof t.nonce?t.nonce:void 0,type:"string"===typeof t.type?t.type:void 0,fetchPriority:"string"===typeof t.fetchPriority?t.fetchPriority:void 0,referrerPolicy:"string"===typeof t.referrerPolicy?t.referrerPolicy:void 0,imageSrcSet:"string"===typeof t.imageSrcSet?t.imageSrcSet:void 0,imageSizes:"string"===typeof t.imageSizes?t.imageSizes:void 0,media:"string"===typeof t.media?t.media:void 0})}},t.preloadModule=function(e,t){if("string"===typeof e)if(t){var n=c(t.as,t.crossOrigin);a.d.m(e,{as:"string"===typeof t.as&&"script"!==t.as?t.as:void 0,crossOrigin:n,integrity:"string"===typeof t.integrity?t.integrity:void 0})}else a.d.m(e)},t.requestFormReset=function(e){a.d.r(e)},t.unstable_batchedUpdates=function(e,t){return e(t)},t.useFormState=function(e,t,n){return l.H.useFormState(e,t,n)},t.useFormStatus=function(){return l.H.useHostTransitionStatus()},t.version="19.0.0"},391:(e,t,n)=>{"use strict";!function e(){if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"===typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){console.error(t)}}(),e.exports=n(4)},950:(e,t,n)=>{"use strict";!function e(){if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"===typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){console.error(t)}}(),e.exports=n(672)},914:(e,t)=>{"use strict";function n(e,t){var n=e.length;e.push(t);e:for(;0<n;){var i=n-1>>>1,r=e[i];if(!(0<s(r,t)))break e;e[i]=t,e[n]=r,n=i}}function i(e){return 0===e.length?null:e[0]}function r(e){if(0===e.length)return null;var t=e[0],n=e.pop();if(n!==t){e[0]=n;e:for(var i=0,r=e.length,a=r>>>1;i<a;){var o=2*(i+1)-1,l=e[o],c=o+1,h=e[c];if(0>s(l,n))c<r&&0>s(h,l)?(e[i]=h,e[c]=n,i=c):(e[i]=l,e[o]=n,i=o);else{if(!(c<r&&0>s(h,n)))break e;e[i]=h,e[c]=n,i=c}}}return t}function s(e,t){var n=e.sortIndex-t.sortIndex;return 0!==n?n:e.id-t.id}if(t.unstable_now=void 0,"object"===typeof performance&&"function"===typeof performance.now){var a=performance;t.unstable_now=function(){return a.now()}}else{var o=Date,l=o.now();t.unstable_now=function(){return o.now()-l}}var c=[],h=[],u=1,d=null,p=3,f=!1,m=!1,g=!1,v="function"===typeof setTimeout?setTimeout:null,y="function"===typeof clearTimeout?clearTimeout:null,b="undefined"!==typeof setImmediate?setImmediate:null;function x(e){for(var t=i(h);null!==t;){if(null===t.callback)r(h);else{if(!(t.startTime<=e))break;r(h),t.sortIndex=t.expirationTime,n(c,t)}t=i(h)}}function w(e){if(g=!1,x(e),!m)if(null!==i(c))m=!0,O();else{var t=i(h);null!==t&&I(w,t.startTime-e)}}var S,_=!1,E=-1,A=5,C=-1;function M(){return!(t.unstable_now()-C<A)}function T(){if(_){var e=t.unstable_now();C=e;var n=!0;try{e:{m=!1,g&&(g=!1,y(E),E=-1),f=!0;var s=p;try{t:{for(x(e),d=i(c);null!==d&&!(d.expirationTime>e&&M());){var a=d.callback;if("function"===typeof a){d.callback=null,p=d.priorityLevel;var o=a(d.expirationTime<=e);if(e=t.unstable_now(),"function"===typeof o){d.callback=o,x(e),n=!0;break t}d===i(c)&&r(c),x(e)}else r(c);d=i(c)}if(null!==d)n=!0;else{var l=i(h);null!==l&&I(w,l.startTime-e),n=!1}}break e}finally{d=null,p=s,f=!1}n=void 0}}finally{n?S():_=!1}}}if("function"===typeof b)S=function(){b(T)};else if("undefined"!==typeof MessageChannel){var P=new MessageChannel,D=P.port2;P.port1.onmessage=T,S=function(){D.postMessage(null)}}else S=function(){v(T,0)};function O(){_||(_=!0,S())}function I(e,n){E=v((function(){e(t.unstable_now())}),n)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(e){e.callback=null},t.unstable_continueExecution=function(){m||f||(m=!0,O())},t.unstable_forceFrameRate=function(e){0>e||125<e?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):A=0<e?Math.floor(1e3/e):5},t.unstable_getCurrentPriorityLevel=function(){return p},t.unstable_getFirstCallbackNode=function(){return i(c)},t.unstable_next=function(e){switch(p){case 1:case 2:case 3:var t=3;break;default:t=p}var n=p;p=t;try{return e()}finally{p=n}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(e,t){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var n=p;p=e;try{return t()}finally{p=n}},t.unstable_scheduleCallback=function(e,r,s){var a=t.unstable_now();switch("object"===typeof s&&null!==s?s="number"===typeof(s=s.delay)&&0<s?a+s:a:s=a,e){case 1:var o=-1;break;case 2:o=250;break;case 5:o=1073741823;break;case 4:o=1e4;break;default:o=5e3}return e={id:u++,callback:r,priorityLevel:e,startTime:s,expirationTime:o=s+o,sortIndex:-1},s>a?(e.sortIndex=s,n(h,e),null===i(c)&&e===i(h)&&(g?(y(E),E=-1):g=!0,I(w,s-a))):(e.sortIndex=o,n(c,e),m||f||(m=!0,O())),e},t.unstable_shouldYield=M,t.unstable_wrapCallback=function(e){var t=p;return function(){var n=p;p=t;try{return e.apply(this,arguments)}finally{p=n}}}},67:(e,t,n)=>{"use strict";e.exports=n(914)},29:function(e,t,n){var i;i=function(e){return function(e){var t={};function n(i){if(t[i])return t[i].exports;var r=t[i]={i:i,l:!1,exports:{}};return e[i].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(i,r,function(t){return e[t]}.bind(null,r));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s="./src/react-webcam.tsx")}({"./src/react-webcam.tsx":function(e,t,n){"use strict";n.r(t);var i=n("react"),r=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},e(t,n)};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),s=function(){return s=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},s.apply(this,arguments)},a=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]])}return n};function o(){return!(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)}"undefined"!==typeof window&&(void 0===navigator.mediaDevices&&(navigator.mediaDevices={}),void 0===navigator.mediaDevices.getUserMedia&&(navigator.mediaDevices.getUserMedia=function(e){var t=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia;return t?new Promise((function(n,i){t.call(navigator,e,n,i)})):Promise.reject(new Error("getUserMedia is not implemented in this browser"))}));var l=function(e){function t(t){var n=e.call(this,t)||this;return n.canvas=null,n.ctx=null,n.requestUserMediaId=0,n.unmounted=!1,n.state={hasUserMedia:!1},n}return r(t,e),t.prototype.componentDidMount=function(){var e=this.state,t=this.props;this.unmounted=!1,o()?(e.hasUserMedia||this.requestUserMedia(),t.children&&"function"!=typeof t.children&&console.warn("children must be a function")):t.onUserMediaError("getUserMedia not supported")},t.prototype.componentDidUpdate=function(e){var t=this.props;if(o()){var n=JSON.stringify(e.audioConstraints)!==JSON.stringify(t.audioConstraints),i=JSON.stringify(e.videoConstraints)!==JSON.stringify(t.videoConstraints),r=e.minScreenshotWidth!==t.minScreenshotWidth,s=e.minScreenshotHeight!==t.minScreenshotHeight;(i||r||s)&&(this.canvas=null,this.ctx=null),(n||i)&&(this.stopAndCleanup(),this.requestUserMedia())}else t.onUserMediaError("getUserMedia not supported")},t.prototype.componentWillUnmount=function(){this.unmounted=!0,this.stopAndCleanup()},t.stopMediaStream=function(e){e&&(e.getVideoTracks&&e.getAudioTracks?(e.getVideoTracks().map((function(t){e.removeTrack(t),t.stop()})),e.getAudioTracks().map((function(t){e.removeTrack(t),t.stop()}))):e.stop())},t.prototype.stopAndCleanup=function(){var e=this.state;e.hasUserMedia&&(t.stopMediaStream(this.stream),e.src&&window.URL.revokeObjectURL(e.src))},t.prototype.getScreenshot=function(e){var t=this.state,n=this.props;if(!t.hasUserMedia)return null;var i=this.getCanvas(e);return i&&i.toDataURL(n.screenshotFormat,n.screenshotQuality)},t.prototype.getCanvas=function(e){var t=this.state,n=this.props;if(!this.video)return null;if(!t.hasUserMedia||!this.video.videoHeight)return null;if(!this.ctx){var i=this.video.videoWidth,r=this.video.videoHeight;if(!this.props.forceScreenshotSourceSize){var s=i/r;r=(i=n.minScreenshotWidth||this.video.clientWidth)/s,n.minScreenshotHeight&&r<n.minScreenshotHeight&&(i=(r=n.minScreenshotHeight)*s)}this.canvas=document.createElement("canvas"),this.canvas.width=(null===e||void 0===e?void 0:e.width)||i,this.canvas.height=(null===e||void 0===e?void 0:e.height)||r,this.ctx=this.canvas.getContext("2d")}var a=this.ctx,o=this.canvas;return a&&o&&(o.width=(null===e||void 0===e?void 0:e.width)||o.width,o.height=(null===e||void 0===e?void 0:e.height)||o.height,n.mirrored&&(a.translate(o.width,0),a.scale(-1,1)),a.imageSmoothingEnabled=n.imageSmoothing,a.drawImage(this.video,0,0,(null===e||void 0===e?void 0:e.width)||o.width,(null===e||void 0===e?void 0:e.height)||o.height),n.mirrored&&(a.scale(-1,1),a.translate(-o.width,0))),o},t.prototype.requestUserMedia=function(){var e=this,n=this.props,i=function(i,r){var s={video:"undefined"===typeof r||r};n.audio&&(s.audio="undefined"===typeof i||i),e.requestUserMediaId++;var a=e.requestUserMediaId;navigator.mediaDevices.getUserMedia(s).then((function(n){e.unmounted||a!==e.requestUserMediaId?t.stopMediaStream(n):e.handleUserMedia(null,n)})).catch((function(t){e.handleUserMedia(t)}))};if("mediaDevices"in navigator)i(n.audioConstraints,n.videoConstraints);else{var r=function(e){return{optional:[{sourceId:e}]}},s=function(e){var t=e.deviceId;return"string"===typeof t?t:Array.isArray(t)&&t.length>0?t[0]:"object"===typeof t&&t.ideal?t.ideal:null};MediaStreamTrack.getSources((function(e){var t=null,a=null;e.forEach((function(e){"audio"===e.kind?t=e.id:"video"===e.kind&&(a=e.id)}));var o=s(n.audioConstraints);o&&(t=o);var l=s(n.videoConstraints);l&&(a=l),i(r(t),r(a))}))}},t.prototype.handleUserMedia=function(e,t){var n=this.props;if(e||!t)return this.setState({hasUserMedia:!1}),void n.onUserMediaError(e);this.stream=t;try{this.video&&(this.video.srcObject=t),this.setState({hasUserMedia:!0})}catch(i){this.setState({hasUserMedia:!0,src:window.URL.createObjectURL(t)})}n.onUserMedia(t)},t.prototype.render=function(){var e=this,t=this.state,n=this.props,r=n.audio,o=(n.forceScreenshotSourceSize,n.disablePictureInPicture),l=(n.onUserMedia,n.onUserMediaError,n.screenshotFormat,n.screenshotQuality,n.minScreenshotWidth,n.minScreenshotHeight,n.audioConstraints,n.videoConstraints,n.imageSmoothing,n.mirrored),c=n.style,h=void 0===c?{}:c,u=n.children,d=a(n,["audio","forceScreenshotSourceSize","disablePictureInPicture","onUserMedia","onUserMediaError","screenshotFormat","screenshotQuality","minScreenshotWidth","minScreenshotHeight","audioConstraints","videoConstraints","imageSmoothing","mirrored","style","children"]),p=l?s(s({},h),{transform:(h.transform||"")+" scaleX(-1)"}):h,f={getScreenshot:this.getScreenshot.bind(this)};return i.createElement(i.Fragment,null,i.createElement("video",s({autoPlay:!0,disablePictureInPicture:o,src:t.src,muted:!r,playsInline:!0,ref:function(t){e.video=t},style:p},d)),u&&u(f))},t.defaultProps={audio:!1,disablePictureInPicture:!1,forceScreenshotSourceSize:!1,imageSmoothing:!0,mirrored:!1,onUserMedia:function(){},onUserMediaError:function(){},screenshotFormat:"image/webp",screenshotQuality:.92},t}(i.Component);t.default=l},react:function(t,n){t.exports=e}}).default},e.exports=i(n(43))},799:(e,t)=>{"use strict";var n=Symbol.for("react.transitional.element"),i=Symbol.for("react.fragment");function r(e,t,i){var r=null;if(void 0!==i&&(r=""+i),void 0!==t.key&&(r=""+t.key),"key"in t)for(var s in i={},t)"key"!==s&&(i[s]=t[s]);else i=t;return t=i.ref,{$$typeof:n,type:e,key:r,ref:void 0!==t?t:null,props:i}}t.Fragment=i,t.jsx=r,t.jsxs=r},288:(e,t)=>{"use strict";var n=Symbol.for("react.transitional.element"),i=Symbol.for("react.portal"),r=Symbol.for("react.fragment"),s=Symbol.for("react.strict_mode"),a=Symbol.for("react.profiler"),o=Symbol.for("react.consumer"),l=Symbol.for("react.context"),c=Symbol.for("react.forward_ref"),h=Symbol.for("react.suspense"),u=Symbol.for("react.memo"),d=Symbol.for("react.lazy"),p=Symbol.iterator;var f={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},m=Object.assign,g={};function v(e,t,n){this.props=e,this.context=t,this.refs=g,this.updater=n||f}function y(){}function b(e,t,n){this.props=e,this.context=t,this.refs=g,this.updater=n||f}v.prototype.isReactComponent={},v.prototype.setState=function(e,t){if("object"!==typeof e&&"function"!==typeof e&&null!=e)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")},v.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},y.prototype=v.prototype;var x=b.prototype=new y;x.constructor=b,m(x,v.prototype),x.isPureReactComponent=!0;var w=Array.isArray,S={H:null,A:null,T:null,S:null},_=Object.prototype.hasOwnProperty;function E(e,t,i,r,s,a){return i=a.ref,{$$typeof:n,type:e,key:t,ref:void 0!==i?i:null,props:a}}function A(e){return"object"===typeof e&&null!==e&&e.$$typeof===n}var C=/\/+/g;function M(e,t){return"object"===typeof e&&null!==e&&null!=e.key?function(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,(function(e){return t[e]}))}(""+e.key):t.toString(36)}function T(){}function P(e,t,r,s,a){var o=typeof e;"undefined"!==o&&"boolean"!==o||(e=null);var l,c,h=!1;if(null===e)h=!0;else switch(o){case"bigint":case"string":case"number":h=!0;break;case"object":switch(e.$$typeof){case n:case i:h=!0;break;case d:return P((h=e._init)(e._payload),t,r,s,a)}}if(h)return a=a(e),h=""===s?"."+M(e,0):s,w(a)?(r="",null!=h&&(r=h.replace(C,"$&/")+"/"),P(a,t,r,"",(function(e){return e}))):null!=a&&(A(a)&&(l=a,c=r+(null==a.key||e&&e.key===a.key?"":(""+a.key).replace(C,"$&/")+"/")+h,a=E(l.type,c,void 0,0,0,l.props)),t.push(a)),1;h=0;var u,f=""===s?".":s+":";if(w(e))for(var m=0;m<e.length;m++)h+=P(s=e[m],t,r,o=f+M(s,m),a);else if("function"===typeof(m=null===(u=e)||"object"!==typeof u?null:"function"===typeof(u=p&&u[p]||u["@@iterator"])?u:null))for(e=m.call(e),m=0;!(s=e.next()).done;)h+=P(s=s.value,t,r,o=f+M(s,m++),a);else if("object"===o){if("function"===typeof e.then)return P(function(e){switch(e.status){case"fulfilled":return e.value;case"rejected":throw e.reason;default:switch("string"===typeof e.status?e.then(T,T):(e.status="pending",e.then((function(t){"pending"===e.status&&(e.status="fulfilled",e.value=t)}),(function(t){"pending"===e.status&&(e.status="rejected",e.reason=t)}))),e.status){case"fulfilled":return e.value;case"rejected":throw e.reason}}throw e}(e),t,r,s,a);throw t=String(e),Error("Objects are not valid as a React child (found: "+("[object Object]"===t?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.")}return h}function D(e,t,n){if(null==e)return e;var i=[],r=0;return P(e,i,"","",(function(e){return t.call(n,e,r++)})),i}function O(e){if(-1===e._status){var t=e._result;(t=t()).then((function(t){0!==e._status&&-1!==e._status||(e._status=1,e._result=t)}),(function(t){0!==e._status&&-1!==e._status||(e._status=2,e._result=t)})),-1===e._status&&(e._status=0,e._result=t)}if(1===e._status)return e._result.default;throw e._result}var I="function"===typeof reportError?reportError:function(e){if("object"===typeof window&&"function"===typeof window.ErrorEvent){var t=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:"object"===typeof e&&null!==e&&"string"===typeof e.message?String(e.message):String(e),error:e});if(!window.dispatchEvent(t))return}else if("object"===typeof process&&"function"===typeof process.emit)return void process.emit("uncaughtException",e);console.error(e)};function R(){}t.Children={map:D,forEach:function(e,t,n){D(e,(function(){t.apply(this,arguments)}),n)},count:function(e){var t=0;return D(e,(function(){t++})),t},toArray:function(e){return D(e,(function(e){return e}))||[]},only:function(e){if(!A(e))throw Error("React.Children.only expected to receive a single React element child.");return e}},t.Component=v,t.Fragment=r,t.Profiler=a,t.PureComponent=b,t.StrictMode=s,t.Suspense=h,t.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=S,t.act=function(){throw Error("act(...) is not supported in production builds of React.")},t.cache=function(e){return function(){return e.apply(null,arguments)}},t.cloneElement=function(e,t,n){if(null===e||void 0===e)throw Error("The argument must be a React element, but you passed "+e+".");var i=m({},e.props),r=e.key;if(null!=t)for(s in void 0!==t.ref&&void 0,void 0!==t.key&&(r=""+t.key),t)!_.call(t,s)||"key"===s||"__self"===s||"__source"===s||"ref"===s&&void 0===t.ref||(i[s]=t[s]);var s=arguments.length-2;if(1===s)i.children=n;else if(1<s){for(var a=Array(s),o=0;o<s;o++)a[o]=arguments[o+2];i.children=a}return E(e.type,r,void 0,0,0,i)},t.createContext=function(e){return(e={$$typeof:l,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null}).Provider=e,e.Consumer={$$typeof:o,_context:e},e},t.createElement=function(e,t,n){var i,r={},s=null;if(null!=t)for(i in void 0!==t.key&&(s=""+t.key),t)_.call(t,i)&&"key"!==i&&"__self"!==i&&"__source"!==i&&(r[i]=t[i]);var a=arguments.length-2;if(1===a)r.children=n;else if(1<a){for(var o=Array(a),l=0;l<a;l++)o[l]=arguments[l+2];r.children=o}if(e&&e.defaultProps)for(i in a=e.defaultProps)void 0===r[i]&&(r[i]=a[i]);return E(e,s,void 0,0,0,r)},t.createRef=function(){return{current:null}},t.forwardRef=function(e){return{$$typeof:c,render:e}},t.isValidElement=A,t.lazy=function(e){return{$$typeof:d,_payload:{_status:-1,_result:e},_init:O}},t.memo=function(e,t){return{$$typeof:u,type:e,compare:void 0===t?null:t}},t.startTransition=function(e){var t=S.T,n={};S.T=n;try{var i=e(),r=S.S;null!==r&&r(n,i),"object"===typeof i&&null!==i&&"function"===typeof i.then&&i.then(R,I)}catch(s){I(s)}finally{S.T=t}},t.unstable_useCacheRefresh=function(){return S.H.useCacheRefresh()},t.use=function(e){return S.H.use(e)},t.useActionState=function(e,t,n){return S.H.useActionState(e,t,n)},t.useCallback=function(e,t){return S.H.useCallback(e,t)},t.useContext=function(e){return S.H.useContext(e)},t.useDebugValue=function(){},t.useDeferredValue=function(e,t){return S.H.useDeferredValue(e,t)},t.useEffect=function(e,t){return S.H.useEffect(e,t)},t.useId=function(){return S.H.useId()},t.useImperativeHandle=function(e,t,n){return S.H.useImperativeHandle(e,t,n)},t.useInsertionEffect=function(e,t){return S.H.useInsertionEffect(e,t)},t.useLayoutEffect=function(e,t){return S.H.useLayoutEffect(e,t)},t.useMemo=function(e,t){return S.H.useMemo(e,t)},t.useOptimistic=function(e,t){return S.H.useOptimistic(e,t)},t.useReducer=function(e,t,n){return S.H.useReducer(e,t,n)},t.useRef=function(e){return S.H.useRef(e)},t.useState=function(e){return S.H.useState(e)},t.useSyncExternalStore=function(e,t,n){return S.H.useSyncExternalStore(e,t,n)},t.useTransition=function(){return S.H.useTransition()},t.version="19.0.0"},43:(e,t,n)=>{"use strict";e.exports=n(288)},579:(e,t,n)=>{"use strict";e.exports=n(799)},330:(e,t,n)=>{"use strict";var i=n(43);var r="function"===typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e===1/t)||e!==e&&t!==t},s=i.useState,a=i.useEffect,o=i.useLayoutEffect,l=i.useDebugValue;function c(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!r(e,n)}catch(i){return!0}}var h="undefined"===typeof window||"undefined"===typeof window.document||"undefined"===typeof window.document.createElement?function(e,t){return t()}:function(e,t){var n=t(),i=s({inst:{value:n,getSnapshot:t}}),r=i[0].inst,h=i[1];return o((function(){r.value=n,r.getSnapshot=t,c(r)&&h({inst:r})}),[e,n,t]),a((function(){return c(r)&&h({inst:r}),e((function(){c(r)&&h({inst:r})}))}),[e]),l(n),n};t.useSyncExternalStore=void 0!==i.useSyncExternalStore?i.useSyncExternalStore:h},717:(e,t,n)=>{"use strict";var i=n(43),r=n(461);var s="function"===typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e===1/t)||e!==e&&t!==t},a=r.useSyncExternalStore,o=i.useRef,l=i.useEffect,c=i.useMemo,h=i.useDebugValue;t.useSyncExternalStoreWithSelector=function(e,t,n,i,r){var u=o(null);if(null===u.current){var d={hasValue:!1,value:null};u.current=d}else d=u.current;u=c((function(){function e(e){if(!l){if(l=!0,a=e,e=i(e),void 0!==r&&d.hasValue){var t=d.value;if(r(t,e))return o=t}return o=e}if(t=o,s(a,e))return t;var n=i(e);return void 0!==r&&r(t,n)?(a=e,t):(a=e,o=n)}var a,o,l=!1,c=void 0===n?null:n;return[function(){return e(t())},null===c?void 0:function(){return e(c())}]}),[t,n,i,r]);var p=a(e,u[0],u[1]);return l((function(){d.hasValue=!0,d.value=p}),[p]),h(p),p}},461:(e,t,n)=>{"use strict";e.exports=n(330)},443:(e,t,n)=>{"use strict";e.exports=n(717)}},t={};function n(i){var r=t[i];if(void 0!==r)return r.exports;var s=t[i]={exports:{}};return e[i].call(s.exports,s,s.exports,n),s.exports}n.m=e,n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var i in t)n.o(t,i)&&!n.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},n.f={},n.e=e=>Promise.all(Object.keys(n.f).reduce(((t,i)=>(n.f[i](e,t),t)),[])),n.u=e=>"static/js/"+e+"."+{23:"a6a39e0e",160:"c482054d",208:"ee108e1b",293:"30a31688",453:"5cb363bb",516:"b34b52ed",519:"f7236834",917:"cc4bb347",946:"97799d2f"}[e]+".chunk.js",n.miniCssF=e=>{},n.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}(),n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e={},t="mvp:";n.l=(i,r,s,a)=>{if(e[i])e[i].push(r);else{var o,l;if(void 0!==s)for(var c=document.getElementsByTagName("script"),h=0;h<c.length;h++){var u=c[h];if(u.getAttribute("src")==i||u.getAttribute("data-webpack")==t+s){o=u;break}}o||(l=!0,(o=document.createElement("script")).charset="utf-8",o.timeout=120,n.nc&&o.setAttribute("nonce",n.nc),o.setAttribute("data-webpack",t+s),o.src=i),e[i]=[r];var d=(t,n)=>{o.onerror=o.onload=null,clearTimeout(p);var r=e[i];if(delete e[i],o.parentNode&&o.parentNode.removeChild(o),r&&r.forEach((e=>e(n))),t)return t(n)},p=setTimeout(d.bind(null,void 0,{type:"timeout",target:o}),12e4);o.onerror=d.bind(null,o.onerror),o.onload=d.bind(null,o.onload),l&&document.head.appendChild(o)}}})(),n.r=e=>{"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.p="/SignWave/",(()=>{var e={792:0};n.f.j=(t,i)=>{var r=n.o(e,t)?e[t]:void 0;if(0!==r)if(r)i.push(r[2]);else{var s=new Promise(((n,i)=>r=e[t]=[n,i]));i.push(r[2]=s);var a=n.p+n.u(t),o=new Error;n.l(a,(i=>{if(n.o(e,t)&&(0!==(r=e[t])&&(e[t]=void 0),r)){var s=i&&("load"===i.type?"missing":i.type),a=i&&i.target&&i.target.src;o.message="Loading chunk "+t+" failed.\n("+s+": "+a+")",o.name="ChunkLoadError",o.type=s,o.request=a,r[1](o)}}),"chunk-"+t,t)}};var t=(t,i)=>{var r,s,a=i[0],o=i[1],l=i[2],c=0;if(a.some((t=>0!==e[t]))){for(r in o)n.o(o,r)&&(n.m[r]=o[r]);if(l)l(n)}for(t&&t(i);c<a.length;c++)s=a[c],n.o(e,s)&&e[s]&&e[s][0](),e[s]=0},i=self.webpackChunkmvp=self.webpackChunkmvp||[];i.forEach(t.bind(null,0)),i.push=t.bind(null,i.push.bind(i))})(),(()=>{"use strict";var e=n(43),t=n(391);function i(e){return i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i(e)}function r(e){var t=function(e,t){if("object"!=i(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=i(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==i(t)?t:t+""}function s(e,t,n){return(t=r(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){s(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,i,r=function(e,t){if(null==e)return{};var n={};for(var i in e)if({}.hasOwnProperty.call(e,i)){if(-1!==t.indexOf(i))continue;n[i]=e[i]}return n}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(i=0;i<s.length;i++)n=s[i],-1===t.indexOf(n)&&{}.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var c=n(579);function h(e,t){return h=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},h(e,t)}function u(){u=function(e,t){return new n(e,void 0,t)};var e=RegExp.prototype,t=new WeakMap;function n(e,i,r){var s=RegExp(e,i);return t.set(s,r||t.get(e)),h(s,n.prototype)}function r(e,n){var i=t.get(n);return Object.keys(i).reduce((function(t,n){var r=i[n];if("number"==typeof r)t[n]=e[r];else{for(var s=0;void 0===e[r[s]]&&s+1<r.length;)s++;t[n]=e[r[s]]}return t}),Object.create(null))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&h(e,t)}(n,RegExp),n.prototype.exec=function(t){var n=e.exec.call(this,t);if(n){n.groups=r(n,this);var i=n.indices;i&&(i.groups=r(i,this))}return n},n.prototype[Symbol.replace]=function(n,s){if("string"==typeof s){var a=t.get(this);return e[Symbol.replace].call(this,n,s.replace(/\$<([^>]+)>/g,(function(e,t){var n=a[t];return"$"+(Array.isArray(n)?n.join("$"):n)})))}if("function"==typeof s){var o=this;return e[Symbol.replace].call(this,n,(function(){var e=arguments;return"object"!=i(e[e.length-1])&&(e=[].slice.call(e)).push(r(e,o)),s.apply(this,e)}))}return e[Symbol.replace].call(this,n,s)},u.apply(this,arguments)}const d=["texture"],p=["texture"],f=["name"],m=["material"],g=["enabled"],v=["name"];var y=Object.create,b=Object.defineProperty,x=Object.getOwnPropertyDescriptor,w=Object.getOwnPropertyNames,S=Object.getPrototypeOf,_=Object.prototype.hasOwnProperty,E=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),A=(e,t,n)=>(n=null!=e?y(S(e)):{},((e,t,n,i)=>{if(t&&"object"==typeof t||"function"==typeof t)for(let r of w(t))!_.call(e,r)&&r!==n&&b(e,r,{get:()=>t[r],enumerable:!(i=x(t,r))||i.enumerable});return e})(!t&&e&&e.__esModule?n:b(n,"default",{value:e,enumerable:!0}),e)),C=(e,t,n)=>(((e,t,n)=>{t in e?b(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n})(e,"symbol"!=typeof t?t+"":t,n),n),M=E(((e,t)=>{!function(n,i){"object"==typeof e?t.exports=i():"function"==typeof define&&define.amd?define(i):n.Alea=i()}(e,(function(){return e.importState=function(t){var n=new e;return n.importState(t),n},e;function e(){return function(e){var t=0,n=0,i=0,r=1;0==e.length&&(e=[+new Date]);var s=function(){var e=4022871197,t=function(t){t=t.toString();for(var n=0;n<t.length;n++){var i=.02519603282416938*(e+=t.charCodeAt(n));i-=e=i>>>0,e=(i*=e)>>>0,e+=4294967296*(i-=e)}return 2.3283064365386963e-10*(e>>>0)};return t.version="Mash 0.9",t}();t=s(" "),n=s(" "),i=s(" ");for(var a=0;a<e.length;a++)(t-=s(e[a]))<0&&(t+=1),(n-=s(e[a]))<0&&(n+=1),(i-=s(e[a]))<0&&(i+=1);s=null;var o=function(){var e=2091639*t+2.3283064365386963e-10*r;return t=n,n=i,i=e-(r=0|e)};return o.next=o,o.uint32=function(){return 4294967296*o()},o.fract53=function(){return o()+11102230246251565e-32*(2097152*o()|0)},o.version="Alea 0.9",o.args=e,o.exportState=function(){return[t,n,i,r]},o.importState=function(e){t=+e[0]||0,n=+e[1]||0,i=+e[2]||0,r=+e[3]||0},o}(Array.prototype.slice.call(arguments))}}))})),T=E(((e,t)=>{!function(n,i){"object"==typeof e&&typeof t<"u"?i(e):"function"==typeof define&&define.amd?define(["exports"],i):i((n=typeof globalThis<"u"?globalThis:n||self).SVDJS={})}(e,(function(e){e.SVD=function(e,t,n,i,r){if(t=void 0===t||t,n=void 0===n||n,r=1e-64/(i=i||Math.pow(2,-52)),!e)throw new TypeError("Matrix a is not defined");var s,a,o,l,c,h,u,d,p,f,m,g,v=e[0].length,y=e.length;if(y<v)throw new TypeError("Invalid matrix: m < n");for(var b=[],x=[],w=[],S="f"===t?y:v,_=f=u=0;_<y;_++)x[_]=new Array(S).fill(0);for(_=0;_<v;_++)w[_]=new Array(v).fill(0);var E,A=new Array(v).fill(0);for(_=0;_<y;_++)for(s=0;s<v;s++)x[_][s]=e[_][s];for(_=0;_<v;_++){for(b[_]=u,p=0,o=_+1,s=_;s<y;s++)p+=Math.pow(x[s][_],2);if(p<r)u=0;else for(d=(h=x[_][_])*(u=h<0?Math.sqrt(p):-Math.sqrt(p))-p,x[_][_]=h-u,s=o;s<v;s++){for(p=0,a=_;a<y;a++)p+=x[a][_]*x[a][s];for(h=p/d,a=_;a<y;a++)x[a][s]=x[a][s]+h*x[a][_]}for(A[_]=u,p=0,s=o;s<v;s++)p+=Math.pow(x[_][s],2);if(p<r)u=0;else{for(d=(h=x[_][_+1])*(u=h<0?Math.sqrt(p):-Math.sqrt(p))-p,x[_][_+1]=h-u,s=o;s<v;s++)b[s]=x[_][s]/d;for(s=o;s<y;s++){for(p=0,a=o;a<v;a++)p+=x[s][a]*x[_][a];for(a=o;a<v;a++)x[s][a]=x[s][a]+p*b[a]}}f<(m=Math.abs(A[_])+Math.abs(b[_]))&&(f=m)}if(n)for(_=v-1;0<=_;_--){if(0!==u){for(d=x[_][_+1]*u,s=o;s<v;s++)w[s][_]=x[_][s]/d;for(s=o;s<v;s++){for(p=0,a=o;a<v;a++)p+=x[_][a]*w[a][s];for(a=o;a<v;a++)w[a][s]=w[a][s]+p*w[a][_]}}for(s=o;s<v;s++)w[_][s]=0,w[s][_]=0;w[_][_]=1,u=b[_],o=_}if(t){if("f"===t)for(_=v;_<y;_++){for(s=v;s<y;s++)x[_][s]=0;x[_][_]=1}for(_=v-1;0<=_;_--){for(o=_+1,u=A[_],s=o;s<S;s++)x[_][s]=0;if(0!==u){for(d=x[_][_]*u,s=o;s<S;s++){for(p=0,a=o;a<y;a++)p+=x[a][_]*x[a][s];for(h=p/d,a=_;a<y;a++)x[a][s]=x[a][s]+h*x[a][_]}for(s=_;s<y;s++)x[s][_]=x[s][_]/u}else for(s=_;s<y;s++)x[s][_]=0;x[_][_]=x[_][_]+1}}for(i*=f,a=v-1;0<=a;a--)for(var C=0;C<50;C++){for(E=!1,o=a;0<=o;o--){if(Math.abs(b[o])<=i){E=!0;break}if(Math.abs(A[o-1])<=i)break}if(!E)for(c=0,l=o-(p=1),_=o;_<a+1&&(h=p*b[_],b[_]=c*b[_],!(Math.abs(h)<=i));_++)if(u=A[_],A[_]=Math.sqrt(h*h+u*u),c=u/(d=A[_]),p=-h/d,t)for(s=0;s<y;s++)m=x[s][l],g=x[s][_],x[s][l]=m*c+g*p,x[s][_]=-m*p+g*c;if(g=A[a],o===a){if(g<0&&(A[a]=-g,n))for(s=0;s<v;s++)w[s][a]=-w[s][a];break}for(f=A[o],h=(((m=A[a-1])-g)*(m+g)+((u=b[a-1])-(d=b[a]))*(u+d))/(2*d*m),u=Math.sqrt(h*h+1),h=((f-g)*(f+g)+d*(m/(h<0?h-u:h+u)-d))/f,_=o+(p=c=1);_<a+1;_++){if(u=b[_],m=A[_],d=p*u,u*=c,g=Math.sqrt(h*h+d*d),h=f*(c=h/(b[_-1]=g))+u*(p=d/g),u=-f*p+u*c,d=m*p,m*=c,n)for(s=0;s<v;s++)f=w[s][_-1],g=w[s][_],w[s][_-1]=f*c+g*p,w[s][_]=-f*p+g*c;if(g=Math.sqrt(h*h+d*d),h=(c=h/(A[_-1]=g))*u+(p=d/g)*m,f=-p*u+c*m,t)for(s=0;s<y;s++)m=x[s][_-1],g=x[s][_],x[s][_-1]=m*c+g*p,x[s][_]=-m*p+g*c}b[o]=0,b[a]=h,A[a]=f}for(_=0;_<v;_++)A[_]<i&&(A[_]=0);return{u:x,q:A,v:w}},e.VERSION="1.1.1",Object.defineProperty(e,"__esModule",{value:!0})}))})),P=E(((e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(e){if(null===e||!0===e||!1===e)return NaN;var t=Number(e);return isNaN(t)?t:t<0?Math.ceil(t):Math.floor(t)},t.exports=e.default})),D=E(((e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(e){var t=new Date(Date.UTC(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds(),e.getMilliseconds()));return t.setUTCFullYear(e.getFullYear()),e.getTime()-t.getTime()},t.exports=e.default})),O=E(((e,t)=>{function n(e,t,i,r){this.message=e,this.expected=t,this.found=i,this.location=r,this.name="SyntaxError","function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,n)}!function(e,t){function n(){this.constructor=e}n.prototype=t.prototype,e.prototype=new n}(n,Error),n.buildMessage=function(e,t){var n={literal:function(e){return'"'+r(e.text)+'"'},class:function(e){var t,n="";for(t=0;t<e.parts.length;t++)n+=e.parts[t]instanceof Array?s(e.parts[t][0])+"-"+s(e.parts[t][1]):s(e.parts[t]);return"["+(e.inverted?"^":"")+n+"]"},any:function(e){return"any character"},end:function(e){return"end of input"},other:function(e){return e.description}};function i(e){return e.charCodeAt(0).toString(16).toUpperCase()}function r(e){return e.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(e){return"\\x0"+i(e)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(e){return"\\x"+i(e)}))}function s(e){return e.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(e){return"\\x0"+i(e)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(e){return"\\x"+i(e)}))}function a(e){return n[e.type](e)}return"Expected "+function(e){var t,n,i=new Array(e.length);for(t=0;t<e.length;t++)i[t]=a(e[t]);if(i.sort(),i.length>0){for(t=1,n=1;t<i.length;t++)i[t-1]!==i[t]&&(i[n]=i[t],n++);i.length=n}switch(i.length){case 1:return i[0];case 2:return i[0]+" or "+i[1];default:return i.slice(0,-1).join(", ")+", or "+i[i.length-1]}}(e)+" but "+function(e){return e?'"'+r(e)+'"':"end of input"}(t)+" found."},t.exports={SyntaxError:n,parse:function(e,t){t=void 0!==t?t:{};var i,r={},s={svg_path:ge},a=ge,o=function(e){if(!e)return[];for(var t=[],n=0;n<e.length;n++)t=t.concat.apply(t,e[n]);var i=t[0];return i&&"m"==i.code&&(delete i.relative,i.code="M"),t},l=function(e,t){return function(e,t){if(!t)return[e];for(var n=[e],i=0,r=t.length;i<r;i++)n[i+1]=t[i][1];return n}(e,t)},c=/^[Mm]/,h=ue(["M","m"],!1,!1),u=function(e,t,n){var i=Ne(e,[t]);return n&&(i=i.concat(Ne("M"==e?"L":"l",n[1]))),i},d=/^[Zz]/,p=ue(["Z","z"],!1,!1),f=function(){return Ne("Z")},m=/^[Ll]/,g=ue(["L","l"],!1,!1),v=function(e,t){return Ne(e,t)},y=/^[Hh]/,b=ue(["H","h"],!1,!1),x=function(e,t){return Ne(e,t.map((function(e){return{x:e}})))},w=/^[Vv]/,S=ue(["V","v"],!1,!1),_=function(e,t){return Ne(e,t.map((function(e){return{y:e}})))},E=/^[Cc]/,A=ue(["C","c"],!1,!1),C=function(e,t,n){return{x1:e.x,y1:e.y,x2:t.x,y2:t.y,x:n.x,y:n.y}},M=/^[Ss]/,T=ue(["S","s"],!1,!1),P=function(e,t){return{x2:e.x,y2:e.y,x:t.x,y:t.y}},D=/^[Qq]/,O=ue(["Q","q"],!1,!1),I=function(e,t){return{x1:e.x,y1:e.y,x:t.x,y:t.y}},R=/^[Tt]/,k=ue(["T","t"],!1,!1),L=/^[Aa]/,B=ue(["A","a"],!1,!1),z=function(e,t,n,i,r,s){return{rx:e,ry:t,xAxisRotation:n,largeArc:i,sweep:r,x:s.x,y:s.y}},N=function(e,t){return{x:e,y:t}},F=function(e){return 1*e},U=function(e){return 1*e.join("")},j=/^[01]/,V=ue(["0","1"],!1,!1),G=function(e){return"1"==e},H=function(){return""},W=",",q=he(",",!1),X=function(e){return e.join("")},Y=".",Q=he(".",!1),K=/^[eE]/,Z=ue(["e","E"],!1,!1),J=/^[+\-]/,$=ue(["+","-"],!1,!1),ee=/^[0-9]/,te=ue([["0","9"]],!1,!1),ne=function(e){return e.join("")},ie=/^[ \t\n\r]/,re=ue([" ","\t","\n","\r"],!1,!1),se=0,ae=[{line:1,column:1}],oe=0,le=[],ce=0;if("startRule"in t){if(!(t.startRule in s))throw new Error("Can't start parsing from rule \""+t.startRule+'".');a=s[t.startRule]}function he(e,t){return{type:"literal",text:e,ignoreCase:t}}function ue(e,t,n){return{type:"class",parts:e,inverted:t,ignoreCase:n}}function de(t){var n,i=ae[t];if(i)return i;for(n=t-1;!ae[n];)n--;for(i={line:(i=ae[n]).line,column:i.column};n<t;)10===e.charCodeAt(n)?(i.line++,i.column=1):i.column++,n++;return ae[t]=i,i}function pe(e,t){var n=de(e),i=de(t);return{start:{offset:e,line:n.line,column:n.column},end:{offset:t,line:i.line,column:i.column}}}function fe(e){se<oe||(se>oe&&(oe=se,le=[]),le.push(e))}function me(e,t,i){return new n(n.buildMessage(e,t),e,t,i)}function ge(){var e,t,n,i,s;for(e=se,t=[],n=Le();n!==r;)t.push(n),n=Le();if(t!==r)if(n=function(){var e,t,n,i,s,a;if(e=se,t=ve(),t!==r){for(n=[],i=se,s=[],a=Le();a!==r;)s.push(a),a=Le();for(s!==r?(a=ve())!==r?i=s=[s,a]:(se=i,i=r):(se=i,i=r);i!==r;){for(n.push(i),i=se,s=[],a=Le();a!==r;)s.push(a),a=Le();s!==r?(a=ve())!==r?i=s=[s,a]:(se=i,i=r):(se=i,i=r)}n!==r?e=t=l(t,n):(se=e,e=r)}else se=e,e=r;return e}(),n===r&&(n=null),n!==r){for(i=[],s=Le();s!==r;)i.push(s),s=Le();i!==r?e=t=o(n):(se=e,e=r)}else se=e,e=r;else se=e,e=r;return e}function ve(){var t,n,i,s,a,o;if(t=se,n=function(){var t,n,i,s,a,o,l;if(t=se,c.test(e.charAt(se))?(n=e.charAt(se),se++):(n=r,0===ce&&fe(h)),n!==r){for(i=[],s=Le();s!==r;)i.push(s),s=Le();i!==r?(s=Ae())!==r?(a=se,(o=Pe())===r&&(o=null),o!==r?(l=be())!==r?a=o=[o,l]:(se=a,a=r):(se=a,a=r),a===r&&(a=null),a!==r?t=n=u(n,s,a):(se=t,t=r)):(se=t,t=r):(se=t,t=r)}else se=t,t=r;return t}(),n!==r){for(i=[],s=se,a=[],o=Le();o!==r;)a.push(o),o=Le();for(a!==r?(o=ye())!==r?s=a=[a,o]:(se=s,s=r):(se=s,s=r);s!==r;){for(i.push(s),s=se,a=[],o=Le();o!==r;)a.push(o),o=Le();a!==r?(o=ye())!==r?s=a=[a,o]:(se=s,s=r):(se=s,s=r)}i!==r?t=n=l(n,i):(se=t,t=r)}else se=t,t=r;return t}function ye(){var t;return t=function(){var t,n;return t=se,d.test(e.charAt(se))?(n=e.charAt(se),se++):(n=r,0===ce&&fe(p)),n!==r&&(n=f()),t=n,t}(),t===r&&(t=function(){var t,n,i,s;if(t=se,m.test(e.charAt(se))?(n=e.charAt(se),se++):(n=r,0===ce&&fe(g)),n!==r){for(i=[],s=Le();s!==r;)i.push(s),s=Le();i!==r?(s=be())!==r?t=n=v(n,s):(se=t,t=r):(se=t,t=r)}else se=t,t=r;return t}(),t===r&&(t=function(){var t,n,i,s;if(t=se,y.test(e.charAt(se))?(n=e.charAt(se),se++):(n=r,0===ce&&fe(b)),n!==r){for(i=[],s=Le();s!==r;)i.push(s),s=Le();i!==r?(s=xe())!==r?t=n=x(n,s):(se=t,t=r):(se=t,t=r)}else se=t,t=r;return t}(),t===r&&(t=function(){var t,n,i,s;if(t=se,w.test(e.charAt(se))?(n=e.charAt(se),se++):(n=r,0===ce&&fe(S)),n!==r){for(i=[],s=Le();s!==r;)i.push(s),s=Le();i!==r?(s=xe())!==r?t=n=_(n,s):(se=t,t=r):(se=t,t=r)}else se=t,t=r;return t}(),t===r&&(t=function(){var t,n,i,s;if(t=se,E.test(e.charAt(se))?(n=e.charAt(se),se++):(n=r,0===ce&&fe(A)),n!==r){for(i=[],s=Le();s!==r;)i.push(s),s=Le();i!==r?(s=function(){var e,t,n,i,s,a;if(e=se,t=we(),t!==r){for(n=[],i=se,(s=Pe())===r&&(s=null),s!==r?(a=we())!==r?i=s=[s,a]:(se=i,i=r):(se=i,i=r);i!==r;)n.push(i),i=se,(s=Pe())===r&&(s=null),s!==r?(a=we())!==r?i=s=[s,a]:(se=i,i=r):(se=i,i=r);n!==r?e=t=l(t,n):(se=e,e=r)}else se=e,e=r;return e}(),s!==r?t=n=v(n,s):(se=t,t=r)):(se=t,t=r)}else se=t,t=r;return t}(),t===r&&(t=function(){var t,n,i,s;if(t=se,M.test(e.charAt(se))?(n=e.charAt(se),se++):(n=r,0===ce&&fe(T)),n!==r){for(i=[],s=Le();s!==r;)i.push(s),s=Le();i!==r?(s=function(){var e,t,n,i,s,a;if(e=se,t=Se(),t!==r){for(n=[],i=se,(s=Pe())===r&&(s=null),s!==r?(a=Se())!==r?i=s=[s,a]:(se=i,i=r):(se=i,i=r);i!==r;)n.push(i),i=se,(s=Pe())===r&&(s=null),s!==r?(a=Se())!==r?i=s=[s,a]:(se=i,i=r):(se=i,i=r);n!==r?e=t=l(t,n):(se=e,e=r)}else se=e,e=r;return e}(),s!==r?t=n=v(n,s):(se=t,t=r)):(se=t,t=r)}else se=t,t=r;return t}(),t===r&&(t=function(){var t,n,i,s;if(t=se,D.test(e.charAt(se))?(n=e.charAt(se),se++):(n=r,0===ce&&fe(O)),n!==r){for(i=[],s=Le();s!==r;)i.push(s),s=Le();i!==r?(s=function(){var e,t,n,i,s,a;if(e=se,t=_e(),t!==r){for(n=[],i=se,(s=Pe())===r&&(s=null),s!==r?(a=_e())!==r?i=s=[s,a]:(se=i,i=r):(se=i,i=r);i!==r;)n.push(i),i=se,(s=Pe())===r&&(s=null),s!==r?(a=_e())!==r?i=s=[s,a]:(se=i,i=r):(se=i,i=r);n!==r?e=t=l(t,n):(se=e,e=r)}else se=e,e=r;return e}(),s!==r?t=n=v(n,s):(se=t,t=r)):(se=t,t=r)}else se=t,t=r;return t}(),t===r&&(t=function(){var t,n,i,s;if(t=se,R.test(e.charAt(se))?(n=e.charAt(se),se++):(n=r,0===ce&&fe(k)),n!==r){for(i=[],s=Le();s!==r;)i.push(s),s=Le();i!==r?(s=function(){var e,t,n,i,s,a;if(e=se,t=Ae(),t!==r){for(n=[],i=se,(s=Pe())===r&&(s=null),s!==r?(a=Ae())!==r?i=s=[s,a]:(se=i,i=r):(se=i,i=r);i!==r;)n.push(i),i=se,(s=Pe())===r&&(s=null),s!==r?(a=Ae())!==r?i=s=[s,a]:(se=i,i=r):(se=i,i=r);n!==r?e=t=l(t,n):(se=e,e=r)}else se=e,e=r;return e}(),s!==r?t=n=v(n,s):(se=t,t=r)):(se=t,t=r)}else se=t,t=r;return t}(),t===r&&(t=function(){var t,n,i,s;if(t=se,L.test(e.charAt(se))?(n=e.charAt(se),se++):(n=r,0===ce&&fe(B)),n!==r){for(i=[],s=Le();s!==r;)i.push(s),s=Le();i!==r?(s=function(){var e,t,n,i,s,a;if(e=se,t=Ee(),t!==r){for(n=[],i=se,(s=Pe())===r&&(s=null),s!==r?(a=Ee())!==r?i=s=[s,a]:(se=i,i=r):(se=i,i=r);i!==r;)n.push(i),i=se,(s=Pe())===r&&(s=null),s!==r?(a=Ee())!==r?i=s=[s,a]:(se=i,i=r):(se=i,i=r);n!==r?e=t=l(t,n):(se=e,e=r)}else se=e,e=r;return e}(),s!==r?t=n=v(n,s):(se=t,t=r)):(se=t,t=r)}else se=t,t=r;return t}())))))))),t}function be(){var e,t,n,i,s,a;if(e=se,(t=Ae())!==r){for(n=[],i=se,(s=Pe())===r&&(s=null),s!==r?(a=Ae())!==r?i=s=[s,a]:(se=i,i=r):(se=i,i=r);i!==r;)n.push(i),i=se,(s=Pe())===r&&(s=null),s!==r?(a=Ae())!==r?i=s=[s,a]:(se=i,i=r):(se=i,i=r);n!==r?e=t=l(t,n):(se=e,e=r)}else se=e,e=r;return e}function xe(){var e,t,n,i,s,a;if(e=se,(t=Me())!==r){for(n=[],i=se,(s=Pe())===r&&(s=null),s!==r?(a=Me())!==r?i=s=[s,a]:(se=i,i=r):(se=i,i=r);i!==r;)n.push(i),i=se,(s=Pe())===r&&(s=null),s!==r?(a=Me())!==r?i=s=[s,a]:(se=i,i=r):(se=i,i=r);n!==r?e=t=l(t,n):(se=e,e=r)}else se=e,e=r;return e}function we(){var e,t,n,i,s,a;return e=se,(t=Ae())!==r?((n=Pe())===r&&(n=null),n!==r?(i=Ae())!==r?((s=Pe())===r&&(s=null),s!==r?(a=Ae())!==r?e=t=C(t,i,a):(se=e,e=r):(se=e,e=r)):(se=e,e=r):(se=e,e=r)):(se=e,e=r),e}function Se(){var e,t,n,i;return e=se,(t=Ae())!==r?((n=Pe())===r&&(n=null),n!==r?(i=Ae())!==r?e=t=P(t,i):(se=e,e=r):(se=e,e=r)):(se=e,e=r),e}function _e(){var e,t,n,i;return e=se,(t=Ae())!==r?((n=Pe())===r&&(n=null),n!==r?(i=Ae())!==r?e=t=I(t,i):(se=e,e=r):(se=e,e=r)):(se=e,e=r),e}function Ee(){var e,t,n,i,s,a,o,l,c,h,u;return e=se,(t=Ce())!==r?((n=Pe())===r&&(n=null),n!==r?(i=Ce())!==r?((s=Pe())===r&&(s=null),s!==r?(a=Me())!==r?Pe()!==r?(o=Te())!==r?((l=Pe())===r&&(l=null),l!==r?(c=Te())!==r?((h=Pe())===r&&(h=null),h!==r?(u=Ae())!==r?e=t=z(t,i,a,o,c,u):(se=e,e=r):(se=e,e=r)):(se=e,e=r):(se=e,e=r)):(se=e,e=r):(se=e,e=r):(se=e,e=r):(se=e,e=r)):(se=e,e=r):(se=e,e=r)):(se=e,e=r),e}function Ae(){var e,t,n,i;return e=se,(t=Me())!==r?((n=Pe())===r&&(n=null),n!==r?(i=Me())!==r?e=t=N(t,i):(se=e,e=r):(se=e,e=r)):(se=e,e=r),e}function Ce(){var e,t;return e=se,(t=Oe())===r&&(t=ke()),t!==r&&(t=F(t)),e=t}function Me(){var e,t,n,i;return e=se,t=se,(n=Re())===r&&(n=null),n!==r?(i=Oe())!==r?t=n=[n,i]:(se=t,t=r):(se=t,t=r),t===r&&(t=se,(n=Re())===r&&(n=null),n!==r?(i=ke())!==r?t=n=[n,i]:(se=t,t=r):(se=t,t=r)),t!==r&&(t=U(t)),e=t}function Te(){var t,n;return t=se,j.test(e.charAt(se))?(n=e.charAt(se),se++):(n=r,0===ce&&fe(V)),n!==r&&(n=G(n)),t=n}function Pe(){var e,t,n,i,s;if(e=se,t=[],(n=Le())!==r)for(;n!==r;)t.push(n),n=Le();else t=r;if(t!==r)if((n=De())===r&&(n=null),n!==r){for(i=[],s=Le();s!==r;)i.push(s),s=Le();i!==r?e=t=[t,n,i]:(se=e,e=r)}else se=e,e=r;else se=e,e=r;if(e===r){if(e=se,t=se,(n=De())!==r){for(i=[],s=Le();s!==r;)i.push(s),s=Le();i!==r?t=n=[n,i]:(se=t,t=r)}else se=t,t=r;t!==r&&(t=H()),e=t}return e}function De(){var t;return 44===e.charCodeAt(se)?(t=W,se++):(t=r,0===ce&&fe(q)),t}function Oe(){var t,n,i,s;return t=se,n=se,i=function(){var t,n,i,s,a;return t=se,n=se,i=ke(),i===r&&(i=null),i!==r?(46===e.charCodeAt(se)?(s=Y,se++):(s=r,0===ce&&fe(Q)),s!==r?(a=ke(),a!==r?(i=[i,s,a],n=i):(se=n,n=r)):(se=n,n=r)):(se=n,n=r),n===r&&(n=se,i=ke(),i!==r?(46===e.charCodeAt(se)?(s=Y,se++):(s=r,0===ce&&fe(Q)),s!==r?(i=[i,s],n=i):(se=n,n=r)):(se=n,n=r)),n!==r&&(n=X(n)),t=n,t}(),i!==r?((s=Ie())===r&&(s=null),s!==r?n=i=[i,s]:(se=n,n=r)):(se=n,n=r),n===r&&(n=se,(i=ke())!==r?(s=Ie())!==r?n=i=[i,s]:(se=n,n=r):(se=n,n=r)),n!==r&&(n=X(n)),t=n}function Ie(){var t,n,i,s,a;return t=se,n=se,K.test(e.charAt(se))?(i=e.charAt(se),se++):(i=r,0===ce&&fe(Z)),i!==r?((s=Re())===r&&(s=null),s!==r?(a=ke())!==r?n=i=[i,s,a]:(se=n,n=r):(se=n,n=r)):(se=n,n=r),n!==r&&(n=X(n)),t=n}function Re(){var t;return J.test(e.charAt(se))?(t=e.charAt(se),se++):(t=r,0===ce&&fe($)),t}function ke(){var t,n,i;if(t=se,n=[],ee.test(e.charAt(se))?(i=e.charAt(se),se++):(i=r,0===ce&&fe(te)),i!==r)for(;i!==r;)n.push(i),ee.test(e.charAt(se))?(i=e.charAt(se),se++):(i=r,0===ce&&fe(te));else n=r;return n!==r&&(n=ne(n)),t=n}function Le(){var t,n;return t=se,ie.test(e.charAt(se))?(n=e.charAt(se),se++):(n=r,0===ce&&fe(re)),n!==r&&(n=H()),t=n}var Be={m:"moveto",l:"lineto",h:"horizontal lineto",v:"vertical lineto",c:"curveto",s:"smooth curveto",q:"quadratic curveto",t:"smooth quadratic curveto",a:"elliptical arc",z:"closepath"};for(var ze in Be)Be[ze.toUpperCase()]=Be[ze];function Ne(e,t){t||(t=[{}]);for(var n=t.length;n--;){var i={code:e,command:Be[e]};for(var r in e==e.toLowerCase()&&(i.relative=!0),t[n])i[r]=t[n][r];t[n]=i}return t}if((i=a())!==r&&se===e.length)return i;throw i!==r&&se<e.length&&fe({type:"end"}),me(le,oe<e.length?e.charAt(oe):null,oe<e.length?pe(oe,oe+1):pe(oe,oe))}}})),I=E(((e,t)=>{var n=O().parse;n.parseSVG=n,n.makeAbsolute=function(e){var t,n={x:0,y:0},i={x:"x0",y:"y0",x1:"x0",y1:"y0",x2:"x0",y2:"y0"};return e.forEach((function(e){for(var r in"moveto"===e.command&&(t=e),e.x0=n.x,e.y0=n.y,i)r in e&&(e[r]+=e.relative?e[i[r]]:0);"x"in e||(e.x=n.x),"y"in e||(e.y=n.y),e.relative=!1,e.code=e.code.toUpperCase(),"closepath"==e.command&&(e.x=t.x,e.y=t.y),n=e})),e},t.exports=n})),R=E(((e,t)=>{t.exports=function(e,t){for(var n=e.split("."),i=t.split("."),r=0;r<3;r++){var s=Number(n[r]),a=Number(i[r]);if(s>a)return 1;if(a>s)return-1;if(!isNaN(s)&&isNaN(a))return 1;if(isNaN(s)&&!isNaN(a))return-1}return 0}})),k="149",L=0,B=1,z=2,N=3,F=0,U=1,j=2,V=100,G=101,H=102,W=200,q=201,X=202,Y=203,Q=204,K=205,Z=206,J=207,$=208,ee=209,te=210,ne=301,ie=302,re=306,se=1e3,ae=1001,oe=1002,le=1003,ce=1004,he=1005,ue=1006,de=1007,pe=1008,fe=1009,me=1014,ge=1015,ve=1016,ye=1020,be=1023,xe=1026,we=1027,Se=1028,_e=1030,Ee=33776,Ae=33777,Ce=33778,Me=33779,Te=36492,Pe=2202,De=2300,Oe=2301,Ie=2302,Re=2400,ke=2401,Le=2402,Be=2500,ze=3e3,Ne=3001,Fe=3200,Ue="srgb",je="srgb-linear",Ve=7680,Ge=35044,He="300 es",We=1035,qe=class{addEventListener(e,t){void 0===this._listeners&&(this._listeners={});let n=this._listeners;void 0===n[e]&&(n[e]=[]),-1===n[e].indexOf(t)&&n[e].push(t)}hasEventListener(e,t){if(void 0===this._listeners)return!1;let n=this._listeners;return void 0!==n[e]&&-1!==n[e].indexOf(t)}removeEventListener(e,t){if(void 0===this._listeners)return;let n=this._listeners[e];if(void 0!==n){let e=n.indexOf(t);-1!==e&&n.splice(e,1)}}dispatchEvent(e){if(void 0===this._listeners)return;let t=this._listeners[e.type];if(void 0!==t){e.target=this;let n=t.slice(0);for(let t=0,i=n.length;t<i;t++)n[t].call(this,e);e.target=null}}},Xe=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"],Ye=1234567,Qe=Math.PI/180,Ke=180/Math.PI;function Ze(){let e=4294967295*Math.random()|0,t=4294967295*Math.random()|0,n=4294967295*Math.random()|0,i=4294967295*Math.random()|0;return(Xe[255&e]+Xe[e>>8&255]+Xe[e>>16&255]+Xe[e>>24&255]+"-"+Xe[255&t]+Xe[t>>8&255]+"-"+Xe[t>>16&15|64]+Xe[t>>24&255]+"-"+Xe[63&n|128]+Xe[n>>8&255]+"-"+Xe[n>>16&255]+Xe[n>>24&255]+Xe[255&i]+Xe[i>>8&255]+Xe[i>>16&255]+Xe[i>>24&255]).toLowerCase()}function Je(e,t,n){return Math.max(t,Math.min(n,e))}function $e(e,t){return(e%t+t)%t}function et(e,t,n){return(1-n)*e+n*t}function tt(e){return 0===(e&e-1)&&0!==e}function nt(e){return Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))}function it(e){return Math.pow(2,Math.floor(Math.log(e)/Math.LN2))}function rt(e,t){switch(t.constructor){case Float32Array:return e;case Uint16Array:return e/65535;case Uint8Array:return e/255;case Int16Array:return Math.max(e/32767,-1);case Int8Array:return Math.max(e/127,-1);default:throw new Error("Invalid component type.")}}function st(e,t){switch(t.constructor){case Float32Array:return e;case Uint16Array:return Math.round(65535*e);case Uint8Array:return Math.round(255*e);case Int16Array:return Math.round(32767*e);case Int8Array:return Math.round(127*e);default:throw new Error("Invalid component type.")}}var at=Object.freeze({__proto__:null,DEG2RAD:Qe,RAD2DEG:Ke,ceilPowerOfTwo:nt,clamp:Je,damp:function(e,t,n,i){return et(e,t,1-Math.exp(-n*i))},degToRad:function(e){return e*Qe},denormalize:rt,euclideanModulo:$e,floorPowerOfTwo:it,generateUUID:Ze,inverseLerp:function(e,t,n){return e!==t?(n-e)/(t-e):0},isPowerOfTwo:tt,lerp:et,mapLinear:function(e,t,n,i,r){return i+(e-t)*(r-i)/(n-t)},normalize:st,pingpong:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return t-Math.abs($e(e,2*t)-t)},radToDeg:function(e){return e*Ke},randFloat:function(e,t){return e+Math.random()*(t-e)},randFloatSpread:function(e){return e*(.5-Math.random())},randInt:function(e,t){return e+Math.floor(Math.random()*(t-e+1))},seededRandom:function(e){void 0!==e&&(Ye=e);let t=Ye+=1831565813;return t=Math.imul(t^t>>>15,1|t),t^=t+Math.imul(t^t>>>7,61|t),((t^t>>>14)>>>0)/4294967296},setQuaternionFromProperEuler:function(e,t,n,i,r){let s=Math.cos,a=Math.sin,o=s(n/2),l=a(n/2),c=s((t+i)/2),h=a((t+i)/2),u=s((t-i)/2),d=a((t-i)/2),p=s((i-t)/2),f=a((i-t)/2);switch(r){case"XYX":e.set(o*h,l*u,l*d,o*c);break;case"YZY":e.set(l*d,o*h,l*u,o*c);break;case"ZXZ":e.set(l*u,l*d,o*h,o*c);break;case"XZX":e.set(o*h,l*f,l*p,o*c);break;case"YXY":e.set(l*p,o*h,l*f,o*c);break;case"ZYZ":e.set(l*f,l*p,o*h,o*c);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+r)}},smootherstep:function(e,t,n){return e<=t?0:e>=n?1:(e=(e-t)/(n-t))*e*e*(e*(6*e-15)+10)},smoothstep:function(e,t,n){return e<=t?0:e>=n?1:(e=(e-t)/(n-t))*e*(3-2*e)}}),ot=class{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;ot.prototype.isVector2=!0,this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){let t=this.x,n=this.y,i=e.elements;return this.x=i[0]*t+i[3]*n+i[6],this.y=i[1]*t+i[4]*n+i[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}clampLength(e,t){let n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){let t=this.x-e.x,n=this.y-e.y;return t*t+n*n}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.x=e[t],this.y=e[t+1],this}toArray(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){let n=Math.cos(t),i=Math.sin(t),r=this.x-e.x,s=this.y-e.y;return this.x=r*n-s*i+e.x,this.y=r*i+s*n+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}},lt=class{constructor(){lt.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1]}set(e,t,n,i,r,s,a,o,l){let c=this.elements;return c[0]=e,c[1]=i,c[2]=a,c[3]=t,c[4]=r,c[5]=o,c[6]=n,c[7]=s,c[8]=l,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){let t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],this}extractBasis(e,t,n){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this}setFromMatrix4(e){let t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){let n=e.elements,i=t.elements,r=this.elements,s=n[0],a=n[3],o=n[6],l=n[1],c=n[4],h=n[7],u=n[2],d=n[5],p=n[8],f=i[0],m=i[3],g=i[6],v=i[1],y=i[4],b=i[7],x=i[2],w=i[5],S=i[8];return r[0]=s*f+a*v+o*x,r[3]=s*m+a*y+o*w,r[6]=s*g+a*b+o*S,r[1]=l*f+c*v+h*x,r[4]=l*m+c*y+h*w,r[7]=l*g+c*b+h*S,r[2]=u*f+d*v+p*x,r[5]=u*m+d*y+p*w,r[8]=u*g+d*b+p*S,this}multiplyScalar(e){let t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){let e=this.elements,t=e[0],n=e[1],i=e[2],r=e[3],s=e[4],a=e[5],o=e[6],l=e[7],c=e[8];return t*s*c-t*a*l-n*r*c+n*a*o+i*r*l-i*s*o}invert(){let e=this.elements,t=e[0],n=e[1],i=e[2],r=e[3],s=e[4],a=e[5],o=e[6],l=e[7],c=e[8],h=c*s-a*l,u=a*o-c*r,d=l*r-s*o,p=t*h+n*u+i*d;if(0===p)return this.set(0,0,0,0,0,0,0,0,0);let f=1/p;return e[0]=h*f,e[1]=(i*l-c*n)*f,e[2]=(a*n-i*s)*f,e[3]=u*f,e[4]=(c*t-i*o)*f,e[5]=(i*r-a*t)*f,e[6]=d*f,e[7]=(n*o-l*t)*f,e[8]=(s*t-n*r)*f,this}transpose(){let e,t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){let t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,n,i,r,s,a){let o=Math.cos(r),l=Math.sin(r);return this.set(n*o,n*l,-n*(o*s+l*a)+s+e,-i*l,i*o,-i*(-l*s+o*a)+a+t,0,0,1),this}scale(e,t){return this.premultiply(ct.makeScale(e,t)),this}rotate(e){return this.premultiply(ct.makeRotation(-e)),this}translate(e,t){return this.premultiply(ct.makeTranslation(e,t)),this}makeTranslation(e,t){return this.set(1,0,e,0,1,t,0,0,1),this}makeRotation(e){let t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,n,t,0,0,0,1),this}makeScale(e,t){return this.set(e,0,0,0,t,0,0,0,1),this}equals(e){let t=this.elements,n=e.elements;for(let i=0;i<9;i++)if(t[i]!==n[i])return!1;return!0}fromArray(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;for(let n=0;n<9;n++)this.elements[n]=e[n+t];return this}toArray(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e}clone(){return(new this.constructor).fromArray(this.elements)}},ct=new lt;function ht(e){for(let t=e.length-1;t>=0;--t)if(e[t]>=65535)return!0;return!1}var ut={Int8Array:Int8Array,Uint8Array:Uint8Array,Uint8ClampedArray:Uint8ClampedArray,Int16Array:Int16Array,Uint16Array:Uint16Array,Int32Array:Int32Array,Uint32Array:Uint32Array,Float32Array:Float32Array,Float64Array:Float64Array};function dt(e,t){return new ut[e](t)}function pt(e){return document.createElementNS("http://www.w3.org/1999/xhtml",e)}function ft(e){return e<.04045?.0773993808*e:Math.pow(.9478672986*e+.0521327014,2.4)}function mt(e){return e<.0031308?12.92*e:1.055*Math.pow(e,.41666)-.055}var gt={[Ue]:{[je]:ft},[je]:{[Ue]:mt}},vt={legacyMode:!0,get workingColorSpace(){return je},set workingColorSpace(e){console.warn("THREE.ColorManagement: .workingColorSpace is readonly.")},convert:function(e,t,n){if(this.legacyMode||t===n||!t||!n)return e;if(gt[t]&&void 0!==gt[t][n]){let i=gt[t][n];return e.r=i(e.r),e.g=i(e.g),e.b=i(e.b),e}throw new Error("Unsupported color space conversion.")},fromWorkingColorSpace:function(e,t){return this.convert(e,this.workingColorSpace,t)},toWorkingColorSpace:function(e,t){return this.convert(e,t,this.workingColorSpace)}},yt={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},bt={r:0,g:0,b:0},xt={h:0,s:0,l:0},wt={h:0,s:0,l:0};function St(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+6*(t-e)*n:n<.5?t:n<2/3?e+6*(t-e)*(2/3-n):e}function _t(e,t){return t.r=e.r,t.g=e.g,t.b=e.b,t}var Et=class{constructor(e,t,n){return this.isColor=!0,this.r=1,this.g=1,this.b=1,void 0===t&&void 0===n?this.set(e):this.setRGB(e,t,n)}set(e){return e&&e.isColor?this.copy(e):"number"==typeof e?this.setHex(e):"string"==typeof e&&this.setStyle(e),this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Ue;return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,vt.toWorkingColorSpace(this,t),this}setRGB(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:vt.workingColorSpace;return this.r=e,this.g=t,this.b=n,vt.toWorkingColorSpace(this,i),this}setHSL(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:vt.workingColorSpace;if(e=$e(e,1),t=Je(t,0,1),n=Je(n,0,1),0===t)this.r=this.g=this.b=n;else{let i=n<=.5?n*(1+t):n+t-n*t,r=2*n-i;this.r=St(r,i,e+1/3),this.g=St(r,i,e),this.b=St(r,i,e-1/3)}return vt.toWorkingColorSpace(this,i),this}setStyle(e){let t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Ue;function i(t){void 0!==t&&parseFloat(t)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}if(t=/^((?:rgb|hsl)a?)\(([^\)]*)\)/.exec(e)){let e,r=t[1],s=t[2];switch(r){case"rgb":case"rgba":if(e=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(s))return this.r=Math.min(255,parseInt(e[1],10))/255,this.g=Math.min(255,parseInt(e[2],10))/255,this.b=Math.min(255,parseInt(e[3],10))/255,vt.toWorkingColorSpace(this,n),i(e[4]),this;if(e=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(s))return this.r=Math.min(100,parseInt(e[1],10))/100,this.g=Math.min(100,parseInt(e[2],10))/100,this.b=Math.min(100,parseInt(e[3],10))/100,vt.toWorkingColorSpace(this,n),i(e[4]),this;break;case"hsl":case"hsla":if(e=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(s)){let t=parseFloat(e[1])/360,r=parseFloat(e[2])/100,s=parseFloat(e[3])/100;return i(e[4]),this.setHSL(t,r,s,n)}}}else if(t=/^\#([A-Fa-f\d]+)$/.exec(e)){let e=t[1],i=e.length;if(3===i)return this.r=parseInt(e.charAt(0)+e.charAt(0),16)/255,this.g=parseInt(e.charAt(1)+e.charAt(1),16)/255,this.b=parseInt(e.charAt(2)+e.charAt(2),16)/255,vt.toWorkingColorSpace(this,n),this;if(6===i)return this.r=parseInt(e.charAt(0)+e.charAt(1),16)/255,this.g=parseInt(e.charAt(2)+e.charAt(3),16)/255,this.b=parseInt(e.charAt(4)+e.charAt(5),16)/255,vt.toWorkingColorSpace(this,n),this}return e&&e.length>0?this.setColorName(e,n):this}setColorName(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Ue,n=yt[e.toLowerCase()];return void 0!==n?this.setHex(n,t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=ft(e.r),this.g=ft(e.g),this.b=ft(e.b),this}copyLinearToSRGB(e){return this.r=mt(e.r),this.g=mt(e.g),this.b=mt(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Ue;return vt.fromWorkingColorSpace(_t(this,bt),e),Je(255*bt.r,0,255)<<16^Je(255*bt.g,0,255)<<8^Je(255*bt.b,0,255)}getHexString(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Ue;return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:vt.workingColorSpace;vt.fromWorkingColorSpace(_t(this,bt),t);let n,i,r=bt.r,s=bt.g,a=bt.b,o=Math.max(r,s,a),l=Math.min(r,s,a),c=(l+o)/2;if(l===o)n=0,i=0;else{let e=o-l;switch(i=c<=.5?e/(o+l):e/(2-o-l),o){case r:n=(s-a)/e+(s<a?6:0);break;case s:n=(a-r)/e+2;break;case a:n=(r-s)/e+4}n/=6}return e.h=n,e.s=i,e.l=c,e}getRGB(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:vt.workingColorSpace;return vt.fromWorkingColorSpace(_t(this,bt),t),e.r=bt.r,e.g=bt.g,e.b=bt.b,e}getStyle(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Ue;return vt.fromWorkingColorSpace(_t(this,bt),e),e!==Ue?"color(".concat(e," ").concat(bt.r," ").concat(bt.g," ").concat(bt.b,")"):"rgb(".concat(255*bt.r|0,",").concat(255*bt.g|0,",").concat(255*bt.b|0,")")}offsetHSL(e,t,n){return this.getHSL(xt),xt.h+=e,xt.s+=t,xt.l+=n,this.setHSL(xt.h,xt.s,xt.l),this}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,n){return this.r=e.r+(t.r-e.r)*n,this.g=e.g+(t.g-e.g)*n,this.b=e.b+(t.b-e.b)*n,this}lerpHSL(e,t){this.getHSL(xt),e.getHSL(wt);let n=et(xt.h,wt.h,t),i=et(xt.s,wt.s,t),r=et(xt.l,wt.l,t);return this.setHSL(n,i,r),this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}};Et.NAMES=yt;var At,Ct=class{static getDataURL(e){if(/^data:/i.test(e.src)||typeof HTMLCanvasElement>"u")return e.src;let t;if(e instanceof HTMLCanvasElement)t=e;else{void 0===At&&(At=pt("canvas")),At.width=e.width,At.height=e.height;let n=At.getContext("2d");e instanceof ImageData?n.putImageData(e,0,0):n.drawImage(e,0,0,e.width,e.height),t=At}return t.width>2048||t.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),t.toDataURL("image/jpeg",.6)):t.toDataURL("image/png")}static sRGBToLinear(e){if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap){let t=pt("canvas");t.width=e.width,t.height=e.height;let n=t.getContext("2d");n.drawImage(e,0,0,e.width,e.height);let i=n.getImageData(0,0,e.width,e.height),r=i.data;for(let e=0;e<r.length;e++)r[e]=255*ft(r[e]/255);return n.putImageData(i,0,0),t}if(e.data){let t=e.data.slice(0);for(let e=0;e<t.length;e++)t instanceof Uint8Array||t instanceof Uint8ClampedArray?t[e]=Math.floor(255*ft(t[e]/255)):t[e]=ft(t[e]);return{data:t,width:e.width,height:e.height}}return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}},Mt=class{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.isSource=!0,this.uuid=Ze(),this.data=e,this.version=0}set needsUpdate(e){!0===e&&this.version++}toJSON(e){let t=void 0===e||"string"==typeof e;if(!t&&void 0!==e.images[this.uuid])return e.images[this.uuid];let n={uuid:this.uuid,url:""},i=this.data;if(null!==i){let e;if(Array.isArray(i)){e=[];for(let t=0,n=i.length;t<n;t++)i[t].isDataTexture?e.push(Tt(i[t].image)):e.push(Tt(i[t]))}else e=Tt(i);n.url=e}return t||(e.images[this.uuid]=n),n}};function Tt(e){return typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap?Ct.getDataURL(e):e.data?{data:Array.from(e.data),width:e.width,height:e.height,type:e.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}var Pt=0,Dt=class extends qe{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Dt.DEFAULT_IMAGE,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Dt.DEFAULT_MAPPING,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:ae,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:ae,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:ue,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:pe,a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:be,o=arguments.length>7&&void 0!==arguments[7]?arguments[7]:fe,l=arguments.length>8&&void 0!==arguments[8]?arguments[8]:Dt.DEFAULT_ANISOTROPY,c=arguments.length>9&&void 0!==arguments[9]?arguments[9]:ze;super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:Pt++}),this.uuid=Ze(),this.name="",this.source=new Mt(e),this.mipmaps=[],this.mapping=t,this.wrapS=n,this.wrapT=i,this.magFilter=r,this.minFilter=s,this.anisotropy=l,this.format=a,this.internalFormat=null,this.type=o,this.offset=new ot(0,0),this.repeat=new ot(1,1),this.center=new ot(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new lt,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=c,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}get image(){return this.source.data}set image(e){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return(new this.constructor).copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.encoding=e.encoding,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}toJSON(e){let t=void 0===e||"string"==typeof e;if(!t&&void 0!==e.textures[this.uuid])return e.textures[this.uuid];let n={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(n.userData=this.userData),t||(e.textures[this.uuid]=n),n}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(300!==this.mapping)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case se:e.x=e.x-Math.floor(e.x);break;case ae:e.x=e.x<0?0:1;break;case oe:1===Math.abs(Math.floor(e.x)%2)?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x)}if(e.y<0||e.y>1)switch(this.wrapT){case se:e.y=e.y-Math.floor(e.y);break;case ae:e.y=e.y<0?0:1;break;case oe:1===Math.abs(Math.floor(e.y)%2)?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y)}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){!0===e&&(this.version++,this.source.needsUpdate=!0)}};Dt.DEFAULT_IMAGE=null,Dt.DEFAULT_MAPPING=300,Dt.DEFAULT_ANISOTROPY=1;var Ot=class{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;Ot.prototype.isVector4=!0,this.x=e,this.y=t,this.z=n,this.w=i}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,n,i){return this.x=e,this.y=t,this.z=n,this.w=i,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0!==e.w?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){let t=this.x,n=this.y,i=this.z,r=this.w,s=e.elements;return this.x=s[0]*t+s[4]*n+s[8]*i+s[12]*r,this.y=s[1]*t+s[5]*n+s[9]*i+s[13]*r,this.z=s[2]*t+s[6]*n+s[10]*i+s[14]*r,this.w=s[3]*t+s[7]*n+s[11]*i+s[15]*r,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);let t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,n,i,r,s=e.elements,a=s[0],o=s[4],l=s[8],c=s[1],h=s[5],u=s[9],d=s[2],p=s[6],f=s[10];if(Math.abs(o-c)<.01&&Math.abs(l-d)<.01&&Math.abs(u-p)<.01){if(Math.abs(o+c)<.1&&Math.abs(l+d)<.1&&Math.abs(u+p)<.1&&Math.abs(a+h+f-3)<.1)return this.set(1,0,0,0),this;t=Math.PI;let e=(a+1)/2,s=(h+1)/2,m=(f+1)/2,g=(o+c)/4,v=(l+d)/4,y=(u+p)/4;return e>s&&e>m?e<.01?(n=0,i=.707106781,r=.707106781):(n=Math.sqrt(e),i=g/n,r=v/n):s>m?s<.01?(n=.707106781,i=0,r=.707106781):(i=Math.sqrt(s),n=g/i,r=y/i):m<.01?(n=.707106781,i=.707106781,r=0):(r=Math.sqrt(m),n=v/r,i=y/r),this.set(n,i,r,t),this}let m=Math.sqrt((p-u)*(p-u)+(l-d)*(l-d)+(c-o)*(c-o));return Math.abs(m)<.001&&(m=1),this.x=(p-u)/m,this.y=(l-d)/m,this.z=(c-o)/m,this.w=Math.acos((a+h+f-1)/2),this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this}clampLength(e,t){let n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this.w=e.w+(t.w-e.w)*n,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}},It=class extends qe{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};super(),this.isWebGLRenderTarget=!0,this.width=e,this.height=t,this.depth=1,this.scissor=new Ot(0,0,e,t),this.scissorTest=!1,this.viewport=new Ot(0,0,e,t);let i={width:e,height:t,depth:1};this.texture=new Dt(i,n.mapping,n.wrapS,n.wrapT,n.magFilter,n.minFilter,n.format,n.type,n.anisotropy,n.encoding),this.texture.isRenderTargetTexture=!0,this.texture.flipY=!1,this.texture.generateMipmaps=void 0!==n.generateMipmaps&&n.generateMipmaps,this.texture.internalFormat=void 0!==n.internalFormat?n.internalFormat:null,this.texture.minFilter=void 0!==n.minFilter?n.minFilter:ue,this.depthBuffer=void 0===n.depthBuffer||n.depthBuffer,this.stencilBuffer=void 0!==n.stencilBuffer&&n.stencilBuffer,this.depthTexture=void 0!==n.depthTexture?n.depthTexture:null,this.samples=void 0!==n.samples?n.samples:0}setSize(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;(this.width!==e||this.height!==t||this.depth!==n)&&(this.width=e,this.height=t,this.depth=n,this.texture.image.width=e,this.texture.image.height=t,this.texture.image.depth=n,this.dispose()),this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return(new this.constructor).copy(this)}copy(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.texture.isRenderTargetTexture=!0;let t=Object.assign({},e.texture.image);return this.texture.source=new Mt(t),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,null!==e.depthTexture&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}},Rt=class extends Dt{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;super(null),this.isDataArrayTexture=!0,this.image={data:e,width:t,height:n,depth:i},this.magFilter=le,this.minFilter=le,this.wrapR=ae,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}},kt=class extends It{constructor(){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:{}),this.isWebGLMultipleRenderTargets=!0;let t=this.texture;this.texture=[];for(let n=0;n<e;n++)this.texture[n]=t.clone(),this.texture[n].isRenderTargetTexture=!0}setSize(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;if(this.width!==e||this.height!==t||this.depth!==n){this.width=e,this.height=t,this.depth=n;for(let i=0,r=this.texture.length;i<r;i++)this.texture[i].image.width=e,this.texture[i].image.height=t,this.texture[i].image.depth=n;this.dispose()}return this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t),this}copy(e){this.dispose(),this.width=e.width,this.height=e.height,this.depth=e.depth,this.viewport.set(0,0,this.width,this.height),this.scissor.set(0,0,this.width,this.height),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,null!==e.depthTexture&&(this.depthTexture=e.depthTexture.clone()),this.texture.length=0;for(let t=0,n=e.texture.length;t<n;t++)this.texture[t]=e.texture[t].clone(),this.texture[t].isRenderTargetTexture=!0;return this}},Lt=class{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;this.isQuaternion=!0,this._x=e,this._y=t,this._z=n,this._w=i}static slerpFlat(e,t,n,i,r,s,a){let o=n[i+0],l=n[i+1],c=n[i+2],h=n[i+3],u=r[s+0],d=r[s+1],p=r[s+2],f=r[s+3];if(0===a)return e[t+0]=o,e[t+1]=l,e[t+2]=c,void(e[t+3]=h);if(1===a)return e[t+0]=u,e[t+1]=d,e[t+2]=p,void(e[t+3]=f);if(h!==f||o!==u||l!==d||c!==p){let e=1-a,t=o*u+l*d+c*p+h*f,n=t>=0?1:-1,i=1-t*t;if(i>Number.EPSILON){let r=Math.sqrt(i),s=Math.atan2(r,t*n);e=Math.sin(e*s)/r,a=Math.sin(a*s)/r}let r=a*n;if(o=o*e+u*r,l=l*e+d*r,c=c*e+p*r,h=h*e+f*r,e===1-a){let e=1/Math.sqrt(o*o+l*l+c*c+h*h);o*=e,l*=e,c*=e,h*=e}}e[t]=o,e[t+1]=l,e[t+2]=c,e[t+3]=h}static multiplyQuaternionsFlat(e,t,n,i,r,s){let a=n[i],o=n[i+1],l=n[i+2],c=n[i+3],h=r[s],u=r[s+1],d=r[s+2],p=r[s+3];return e[t]=a*p+c*h+o*d-l*u,e[t+1]=o*p+c*u+l*h-a*d,e[t+2]=l*p+c*d+a*u-o*h,e[t+3]=c*p-a*h-o*u-l*d,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,n,i){return this._x=e,this._y=t,this._z=n,this._w=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t){let n=e._x,i=e._y,r=e._z,s=e._order,a=Math.cos,o=Math.sin,l=a(n/2),c=a(i/2),h=a(r/2),u=o(n/2),d=o(i/2),p=o(r/2);switch(s){case"XYZ":this._x=u*c*h+l*d*p,this._y=l*d*h-u*c*p,this._z=l*c*p+u*d*h,this._w=l*c*h-u*d*p;break;case"YXZ":this._x=u*c*h+l*d*p,this._y=l*d*h-u*c*p,this._z=l*c*p-u*d*h,this._w=l*c*h+u*d*p;break;case"ZXY":this._x=u*c*h-l*d*p,this._y=l*d*h+u*c*p,this._z=l*c*p+u*d*h,this._w=l*c*h-u*d*p;break;case"ZYX":this._x=u*c*h-l*d*p,this._y=l*d*h+u*c*p,this._z=l*c*p-u*d*h,this._w=l*c*h+u*d*p;break;case"YZX":this._x=u*c*h+l*d*p,this._y=l*d*h+u*c*p,this._z=l*c*p-u*d*h,this._w=l*c*h-u*d*p;break;case"XZY":this._x=u*c*h-l*d*p,this._y=l*d*h-u*c*p,this._z=l*c*p+u*d*h,this._w=l*c*h+u*d*p;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+s)}return!1!==t&&this._onChangeCallback(),this}setFromAxisAngle(e,t){let n=t/2,i=Math.sin(n);return this._x=e.x*i,this._y=e.y*i,this._z=e.z*i,this._w=Math.cos(n),this._onChangeCallback(),this}setFromRotationMatrix(e){let t=e.elements,n=t[0],i=t[4],r=t[8],s=t[1],a=t[5],o=t[9],l=t[2],c=t[6],h=t[10],u=n+a+h;if(u>0){let e=.5/Math.sqrt(u+1);this._w=.25/e,this._x=(c-o)*e,this._y=(r-l)*e,this._z=(s-i)*e}else if(n>a&&n>h){let e=2*Math.sqrt(1+n-a-h);this._w=(c-o)/e,this._x=.25*e,this._y=(i+s)/e,this._z=(r+l)/e}else if(a>h){let e=2*Math.sqrt(1+a-n-h);this._w=(r-l)/e,this._x=(i+s)/e,this._y=.25*e,this._z=(o+c)/e}else{let e=2*Math.sqrt(1+h-n-a);this._w=(s-i)/e,this._x=(r+l)/e,this._y=(o+c)/e,this._z=.25*e}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let n=e.dot(t)+1;return n<Number.EPSILON?(n=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=n):(this._x=0,this._y=-e.z,this._z=e.y,this._w=n)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=n),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(Je(this.dot(e),-1,1)))}rotateTowards(e,t){let n=this.angleTo(e);if(0===n)return this;let i=Math.min(1,t/n);return this.slerp(e,i),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return 0===e?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){let n=e._x,i=e._y,r=e._z,s=e._w,a=t._x,o=t._y,l=t._z,c=t._w;return this._x=n*c+s*a+i*l-r*o,this._y=i*c+s*o+r*a-n*l,this._z=r*c+s*l+n*o-i*a,this._w=s*c-n*a-i*o-r*l,this._onChangeCallback(),this}slerp(e,t){if(0===t)return this;if(1===t)return this.copy(e);let n=this._x,i=this._y,r=this._z,s=this._w,a=s*e._w+n*e._x+i*e._y+r*e._z;if(a<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,a=-a):this.copy(e),a>=1)return this._w=s,this._x=n,this._y=i,this._z=r,this;let o=1-a*a;if(o<=Number.EPSILON){let e=1-t;return this._w=e*s+t*this._w,this._x=e*n+t*this._x,this._y=e*i+t*this._y,this._z=e*r+t*this._z,this.normalize(),this._onChangeCallback(),this}let l=Math.sqrt(o),c=Math.atan2(l,a),h=Math.sin((1-t)*c)/l,u=Math.sin(t*c)/l;return this._w=s*h+this._w*u,this._x=n*h+this._x*u,this._y=i*h+this._y*u,this._z=r*h+this._z*u,this._onChangeCallback(),this}slerpQuaternions(e,t,n){return this.copy(e).slerp(t,n)}random(){let e=Math.random(),t=Math.sqrt(1-e),n=Math.sqrt(e),i=2*Math.PI*Math.random(),r=2*Math.PI*Math.random();return this.set(t*Math.cos(i),n*Math.sin(r),n*Math.cos(r),t*Math.sin(i))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}},Bt=class{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;Bt.prototype.isVector3=!0,this.x=e,this.y=t,this.z=n}set(e,t,n){return void 0===n&&(n=this.z),this.x=e,this.y=t,this.z=n,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return this.applyQuaternion(Nt.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(Nt.setFromAxisAngle(e,t))}applyMatrix3(e){let t=this.x,n=this.y,i=this.z,r=e.elements;return this.x=r[0]*t+r[3]*n+r[6]*i,this.y=r[1]*t+r[4]*n+r[7]*i,this.z=r[2]*t+r[5]*n+r[8]*i,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){let t=this.x,n=this.y,i=this.z,r=e.elements,s=1/(r[3]*t+r[7]*n+r[11]*i+r[15]);return this.x=(r[0]*t+r[4]*n+r[8]*i+r[12])*s,this.y=(r[1]*t+r[5]*n+r[9]*i+r[13])*s,this.z=(r[2]*t+r[6]*n+r[10]*i+r[14])*s,this}applyQuaternion(e){let t=this.x,n=this.y,i=this.z,r=e.x,s=e.y,a=e.z,o=e.w,l=o*t+s*i-a*n,c=o*n+a*t-r*i,h=o*i+r*n-s*t,u=-r*t-s*n-a*i;return this.x=l*o+u*-r+c*-a-h*-s,this.y=c*o+u*-s+h*-r-l*-a,this.z=h*o+u*-a+l*-s-c*-r,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){let t=this.x,n=this.y,i=this.z,r=e.elements;return this.x=r[0]*t+r[4]*n+r[8]*i,this.y=r[1]*t+r[5]*n+r[9]*i,this.z=r[2]*t+r[6]*n+r[10]*i,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this}clampLength(e,t){let n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,t){let n=e.x,i=e.y,r=e.z,s=t.x,a=t.y,o=t.z;return this.x=i*o-r*a,this.y=r*s-n*o,this.z=n*a-i*s,this}projectOnVector(e){let t=e.lengthSq();if(0===t)return this.set(0,0,0);let n=e.dot(this)/t;return this.copy(e).multiplyScalar(n)}projectOnPlane(e){return zt.copy(this).projectOnVector(e),this.sub(zt)}reflect(e){return this.sub(zt.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){let t=Math.sqrt(this.lengthSq()*e.lengthSq());if(0===t)return Math.PI/2;let n=this.dot(e)/t;return Math.acos(Je(n,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){let t=this.x-e.x,n=this.y-e.y,i=this.z-e.z;return t*t+n*n+i*i}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,n){let i=Math.sin(t)*e;return this.x=i*Math.sin(n),this.y=Math.cos(t)*e,this.z=i*Math.cos(n),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,n){return this.x=e*Math.sin(t),this.y=n,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){let t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){let t=this.setFromMatrixColumn(e,0).length(),n=this.setFromMatrixColumn(e,1).length(),i=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=n,this.z=i,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,4*t)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,3*t)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){let e=2*(Math.random()-.5),t=Math.random()*Math.PI*2,n=Math.sqrt(1-e**2);return this.x=n*Math.cos(t),this.y=n*Math.sin(t),this.z=e,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}},zt=new Bt,Nt=new Lt,Ft=class{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Bt(1/0,1/0,1/0),t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Bt(-1/0,-1/0,-1/0);this.isBox3=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){let t=1/0,n=1/0,i=1/0,r=-1/0,s=-1/0,a=-1/0;for(let o=0,l=e.length;o<l;o+=3){let l=e[o],c=e[o+1],h=e[o+2];l<t&&(t=l),c<n&&(n=c),h<i&&(i=h),l>r&&(r=l),c>s&&(s=c),h>a&&(a=h)}return this.min.set(t,n,i),this.max.set(r,s,a),this}setFromBufferAttribute(e){let t=1/0,n=1/0,i=1/0,r=-1/0,s=-1/0,a=-1/0;for(let o=0,l=e.count;o<l;o++){let l=e.getX(o),c=e.getY(o),h=e.getZ(o);l<t&&(t=l),c<n&&(n=c),h<i&&(i=h),l>r&&(r=l),c>s&&(s=c),h>a&&(a=h)}return this.min.set(t,n,i),this.max.set(r,s,a),this}setFromPoints(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){let n=jt.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}setFromObject(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this.makeEmpty(),this.expandByObject(e,t)}clone(){return(new this.constructor).copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];e.updateWorldMatrix(!1,!1);let n=e.geometry;if(void 0!==n)if(t&&null!=n.attributes&&void 0!==n.attributes.position){let t=n.attributes.position;for(let n=0,i=t.count;n<i;n++)jt.fromBufferAttribute(t,n).applyMatrix4(e.matrixWorld),this.expandByPoint(jt)}else null===n.boundingBox&&n.computeBoundingBox(),Vt.copy(n.boundingBox),Vt.applyMatrix4(e.matrixWorld),this.union(Vt);let i=e.children;for(let r=0,s=i.length;r<s;r++)this.expandByObject(i[r],t);return this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)}intersectsSphere(e){return this.clampPoint(e.center,jt),jt.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,n;return e.normal.x>0?(t=e.normal.x*this.min.x,n=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,n=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,n+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,n+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,n+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,n+=e.normal.z*this.min.z),t<=-e.constant&&n>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(Qt),Kt.subVectors(this.max,Qt),Gt.subVectors(e.a,Qt),Ht.subVectors(e.b,Qt),Wt.subVectors(e.c,Qt),qt.subVectors(Ht,Gt),Xt.subVectors(Wt,Ht),Yt.subVectors(Gt,Wt);let t=[0,-qt.z,qt.y,0,-Xt.z,Xt.y,0,-Yt.z,Yt.y,qt.z,0,-qt.x,Xt.z,0,-Xt.x,Yt.z,0,-Yt.x,-qt.y,qt.x,0,-Xt.y,Xt.x,0,-Yt.y,Yt.x,0];return!(!$t(t,Gt,Ht,Wt,Kt)||(t=[1,0,0,0,1,0,0,0,1],!$t(t,Gt,Ht,Wt,Kt)))&&(Zt.crossVectors(qt,Xt),t=[Zt.x,Zt.y,Zt.z],$t(t,Gt,Ht,Wt,Kt))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return jt.copy(e).clamp(this.min,this.max).sub(e).length()}getBoundingSphere(e){return this.getCenter(e.center),e.radius=.5*this.getSize(jt).length(),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()||(Ut[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),Ut[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),Ut[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),Ut[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),Ut[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),Ut[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),Ut[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),Ut[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(Ut)),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}},Ut=[new Bt,new Bt,new Bt,new Bt,new Bt,new Bt,new Bt,new Bt],jt=new Bt,Vt=new Ft,Gt=new Bt,Ht=new Bt,Wt=new Bt,qt=new Bt,Xt=new Bt,Yt=new Bt,Qt=new Bt,Kt=new Bt,Zt=new Bt,Jt=new Bt;function $t(e,t,n,i,r){for(let s=0,a=e.length-3;s<=a;s+=3){Jt.fromArray(e,s);let a=r.x*Math.abs(Jt.x)+r.y*Math.abs(Jt.y)+r.z*Math.abs(Jt.z),o=t.dot(Jt),l=n.dot(Jt),c=i.dot(Jt);if(Math.max(-Math.max(o,l,c),Math.min(o,l,c))>a)return!1}return!0}var en=new Ft,tn=new Bt,nn=new Bt,rn=class{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Bt,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1;this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){let n=this.center;void 0!==t?n.copy(t):en.setFromPoints(e).getCenter(n);let i=0;for(let r=0,s=e.length;r<s;r++)i=Math.max(i,n.distanceToSquared(e[r]));return this.radius=Math.sqrt(i),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){let t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){let n=this.center.distanceToSquared(e);return t.copy(e),n>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;tn.subVectors(e,this.center);let t=tn.lengthSq();if(t>this.radius*this.radius){let e=Math.sqrt(t),n=.5*(e-this.radius);this.center.addScaledVector(tn,n/e),this.radius+=n}return this}union(e){return e.isEmpty()?this:this.isEmpty()?(this.copy(e),this):(!0===this.center.equals(e.center)?this.radius=Math.max(this.radius,e.radius):(nn.subVectors(e.center,this.center).setLength(e.radius),this.expandByPoint(tn.copy(e.center).add(nn)),this.expandByPoint(tn.copy(e.center).sub(nn))),this)}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return(new this.constructor).copy(this)}},sn=new Bt,an=new Bt,on=new Bt,ln=new Bt,cn=new Bt,hn=new Bt,un=new Bt,dn=class{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Bt,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Bt(0,0,-1);this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.direction).multiplyScalar(e).add(this.origin)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,sn)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);let n=t.dot(this.direction);return n<0?t.copy(this.origin):t.copy(this.direction).multiplyScalar(n).add(this.origin)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){let t=sn.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(sn.copy(this.direction).multiplyScalar(t).add(this.origin),sn.distanceToSquared(e))}distanceSqToSegment(e,t,n,i){an.copy(e).add(t).multiplyScalar(.5),on.copy(t).sub(e).normalize(),ln.copy(this.origin).sub(an);let r,s,a,o,l=.5*e.distanceTo(t),c=-this.direction.dot(on),h=ln.dot(this.direction),u=-ln.dot(on),d=ln.lengthSq(),p=Math.abs(1-c*c);if(p>0)if(r=c*u-h,s=c*h-u,o=l*p,r>=0)if(s>=-o)if(s<=o){let e=1/p;r*=e,s*=e,a=r*(r+c*s+2*h)+s*(c*r+s+2*u)+d}else s=l,r=Math.max(0,-(c*s+h)),a=-r*r+s*(s+2*u)+d;else s=-l,r=Math.max(0,-(c*s+h)),a=-r*r+s*(s+2*u)+d;else s<=-o?(r=Math.max(0,-(-c*l+h)),s=r>0?-l:Math.min(Math.max(-l,-u),l),a=-r*r+s*(s+2*u)+d):s<=o?(r=0,s=Math.min(Math.max(-l,-u),l),a=s*(s+2*u)+d):(r=Math.max(0,-(c*l+h)),s=r>0?l:Math.min(Math.max(-l,-u),l),a=-r*r+s*(s+2*u)+d);else s=c>0?-l:l,r=Math.max(0,-(c*s+h)),a=-r*r+s*(s+2*u)+d;return n&&n.copy(this.direction).multiplyScalar(r).add(this.origin),i&&i.copy(on).multiplyScalar(s).add(an),a}intersectSphere(e,t){sn.subVectors(e.center,this.origin);let n=sn.dot(this.direction),i=sn.dot(sn)-n*n,r=e.radius*e.radius;if(i>r)return null;let s=Math.sqrt(r-i),a=n-s,o=n+s;return a<0&&o<0?null:a<0?this.at(o,t):this.at(a,t)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){let t=e.normal.dot(this.direction);if(0===t)return 0===e.distanceToPoint(this.origin)?0:null;let n=-(this.origin.dot(e.normal)+e.constant)/t;return n>=0?n:null}intersectPlane(e,t){let n=this.distanceToPlane(e);return null===n?null:this.at(n,t)}intersectsPlane(e){let t=e.distanceToPoint(this.origin);return 0===t||e.normal.dot(this.direction)*t<0}intersectBox(e,t){let n,i,r,s,a,o,l=1/this.direction.x,c=1/this.direction.y,h=1/this.direction.z,u=this.origin;return l>=0?(n=(e.min.x-u.x)*l,i=(e.max.x-u.x)*l):(n=(e.max.x-u.x)*l,i=(e.min.x-u.x)*l),c>=0?(r=(e.min.y-u.y)*c,s=(e.max.y-u.y)*c):(r=(e.max.y-u.y)*c,s=(e.min.y-u.y)*c),n>s||r>i||((r>n||isNaN(n))&&(n=r),(s<i||isNaN(i))&&(i=s),h>=0?(a=(e.min.z-u.z)*h,o=(e.max.z-u.z)*h):(a=(e.max.z-u.z)*h,o=(e.min.z-u.z)*h),n>o||a>i)||((a>n||n!==n)&&(n=a),(o<i||i!==i)&&(i=o),i<0)?null:this.at(n>=0?n:i,t)}intersectsBox(e){return null!==this.intersectBox(e,sn)}intersectTriangle(e,t,n,i,r){cn.subVectors(t,e),hn.subVectors(n,e),un.crossVectors(cn,hn);let s,a=this.direction.dot(un);if(a>0){if(i)return null;s=1}else{if(!(a<0))return null;s=-1,a=-a}ln.subVectors(this.origin,e);let o=s*this.direction.dot(hn.crossVectors(ln,hn));if(o<0)return null;let l=s*this.direction.dot(cn.cross(ln));if(l<0||o+l>a)return null;let c=-s*ln.dot(un);return c<0?null:this.at(c/a,r)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return(new this.constructor).copy(this)}},pn=class{constructor(){pn.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}set(e,t,n,i,r,s,a,o,l,c,h,u,d,p,f,m){let g=this.elements;return g[0]=e,g[4]=t,g[8]=n,g[12]=i,g[1]=r,g[5]=s,g[9]=a,g[13]=o,g[2]=l,g[6]=c,g[10]=h,g[14]=u,g[3]=d,g[7]=p,g[11]=f,g[15]=m,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return(new pn).fromArray(this.elements)}copy(e){let t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],this}copyPosition(e){let t=this.elements,n=e.elements;return t[12]=n[12],t[13]=n[13],t[14]=n[14],this}setFromMatrix3(e){let t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,n){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this}makeBasis(e,t,n){return this.set(e.x,t.x,n.x,0,e.y,t.y,n.y,0,e.z,t.z,n.z,0,0,0,0,1),this}extractRotation(e){let t=this.elements,n=e.elements,i=1/fn.setFromMatrixColumn(e,0).length(),r=1/fn.setFromMatrixColumn(e,1).length(),s=1/fn.setFromMatrixColumn(e,2).length();return t[0]=n[0]*i,t[1]=n[1]*i,t[2]=n[2]*i,t[3]=0,t[4]=n[4]*r,t[5]=n[5]*r,t[6]=n[6]*r,t[7]=0,t[8]=n[8]*s,t[9]=n[9]*s,t[10]=n[10]*s,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){let t=this.elements,n=e.x,i=e.y,r=e.z,s=Math.cos(n),a=Math.sin(n),o=Math.cos(i),l=Math.sin(i),c=Math.cos(r),h=Math.sin(r);if("XYZ"===e.order){let e=s*c,n=s*h,i=a*c,r=a*h;t[0]=o*c,t[4]=-o*h,t[8]=l,t[1]=n+i*l,t[5]=e-r*l,t[9]=-a*o,t[2]=r-e*l,t[6]=i+n*l,t[10]=s*o}else if("YXZ"===e.order){let e=o*c,n=o*h,i=l*c,r=l*h;t[0]=e+r*a,t[4]=i*a-n,t[8]=s*l,t[1]=s*h,t[5]=s*c,t[9]=-a,t[2]=n*a-i,t[6]=r+e*a,t[10]=s*o}else if("ZXY"===e.order){let e=o*c,n=o*h,i=l*c,r=l*h;t[0]=e-r*a,t[4]=-s*h,t[8]=i+n*a,t[1]=n+i*a,t[5]=s*c,t[9]=r-e*a,t[2]=-s*l,t[6]=a,t[10]=s*o}else if("ZYX"===e.order){let e=s*c,n=s*h,i=a*c,r=a*h;t[0]=o*c,t[4]=i*l-n,t[8]=e*l+r,t[1]=o*h,t[5]=r*l+e,t[9]=n*l-i,t[2]=-l,t[6]=a*o,t[10]=s*o}else if("YZX"===e.order){let e=s*o,n=s*l,i=a*o,r=a*l;t[0]=o*c,t[4]=r-e*h,t[8]=i*h+n,t[1]=h,t[5]=s*c,t[9]=-a*c,t[2]=-l*c,t[6]=n*h+i,t[10]=e-r*h}else if("XZY"===e.order){let e=s*o,n=s*l,i=a*o,r=a*l;t[0]=o*c,t[4]=-h,t[8]=l*c,t[1]=e*h+r,t[5]=s*c,t[9]=n*h-i,t[2]=i*h-n,t[6]=a*c,t[10]=r*h+e}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(gn,e,vn)}lookAt(e,t,n){let i=this.elements;return xn.subVectors(e,t),0===xn.lengthSq()&&(xn.z=1),xn.normalize(),yn.crossVectors(n,xn),0===yn.lengthSq()&&(1===Math.abs(n.z)?xn.x+=1e-4:xn.z+=1e-4,xn.normalize(),yn.crossVectors(n,xn)),yn.normalize(),bn.crossVectors(xn,yn),i[0]=yn.x,i[4]=bn.x,i[8]=xn.x,i[1]=yn.y,i[5]=bn.y,i[9]=xn.y,i[2]=yn.z,i[6]=bn.z,i[10]=xn.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){let n=e.elements,i=t.elements,r=this.elements,s=n[0],a=n[4],o=n[8],l=n[12],c=n[1],h=n[5],u=n[9],d=n[13],p=n[2],f=n[6],m=n[10],g=n[14],v=n[3],y=n[7],b=n[11],x=n[15],w=i[0],S=i[4],_=i[8],E=i[12],A=i[1],C=i[5],M=i[9],T=i[13],P=i[2],D=i[6],O=i[10],I=i[14],R=i[3],k=i[7],L=i[11],B=i[15];return r[0]=s*w+a*A+o*P+l*R,r[4]=s*S+a*C+o*D+l*k,r[8]=s*_+a*M+o*O+l*L,r[12]=s*E+a*T+o*I+l*B,r[1]=c*w+h*A+u*P+d*R,r[5]=c*S+h*C+u*D+d*k,r[9]=c*_+h*M+u*O+d*L,r[13]=c*E+h*T+u*I+d*B,r[2]=p*w+f*A+m*P+g*R,r[6]=p*S+f*C+m*D+g*k,r[10]=p*_+f*M+m*O+g*L,r[14]=p*E+f*T+m*I+g*B,r[3]=v*w+y*A+b*P+x*R,r[7]=v*S+y*C+b*D+x*k,r[11]=v*_+y*M+b*O+x*L,r[15]=v*E+y*T+b*I+x*B,this}multiplyScalar(e){let t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){let e=this.elements,t=e[0],n=e[4],i=e[8],r=e[12],s=e[1],a=e[5],o=e[9],l=e[13],c=e[2],h=e[6],u=e[10],d=e[14];return e[3]*(+r*o*h-i*l*h-r*a*u+n*l*u+i*a*d-n*o*d)+e[7]*(+t*o*d-t*l*u+r*s*u-i*s*d+i*l*c-r*o*c)+e[11]*(+t*l*h-t*a*d-r*s*h+n*s*d+r*a*c-n*l*c)+e[15]*(-i*a*c-t*o*h+t*a*u+i*s*h-n*s*u+n*o*c)}transpose(){let e,t=this.elements;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this}setPosition(e,t,n){let i=this.elements;return e.isVector3?(i[12]=e.x,i[13]=e.y,i[14]=e.z):(i[12]=e,i[13]=t,i[14]=n),this}invert(){let e=this.elements,t=e[0],n=e[1],i=e[2],r=e[3],s=e[4],a=e[5],o=e[6],l=e[7],c=e[8],h=e[9],u=e[10],d=e[11],p=e[12],f=e[13],m=e[14],g=e[15],v=h*m*l-f*u*l+f*o*d-a*m*d-h*o*g+a*u*g,y=p*u*l-c*m*l-p*o*d+s*m*d+c*o*g-s*u*g,b=c*f*l-p*h*l+p*a*d-s*f*d-c*a*g+s*h*g,x=p*h*o-c*f*o-p*a*u+s*f*u+c*a*m-s*h*m,w=t*v+n*y+i*b+r*x;if(0===w)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);let S=1/w;return e[0]=v*S,e[1]=(f*u*r-h*m*r-f*i*d+n*m*d+h*i*g-n*u*g)*S,e[2]=(a*m*r-f*o*r+f*i*l-n*m*l-a*i*g+n*o*g)*S,e[3]=(h*o*r-a*u*r-h*i*l+n*u*l+a*i*d-n*o*d)*S,e[4]=y*S,e[5]=(c*m*r-p*u*r+p*i*d-t*m*d-c*i*g+t*u*g)*S,e[6]=(p*o*r-s*m*r-p*i*l+t*m*l+s*i*g-t*o*g)*S,e[7]=(s*u*r-c*o*r+c*i*l-t*u*l-s*i*d+t*o*d)*S,e[8]=b*S,e[9]=(p*h*r-c*f*r-p*n*d+t*f*d+c*n*g-t*h*g)*S,e[10]=(s*f*r-p*a*r+p*n*l-t*f*l-s*n*g+t*a*g)*S,e[11]=(c*a*r-s*h*r-c*n*l+t*h*l+s*n*d-t*a*d)*S,e[12]=x*S,e[13]=(c*f*i-p*h*i+p*n*u-t*f*u-c*n*m+t*h*m)*S,e[14]=(p*a*i-s*f*i-p*n*o+t*f*o+s*n*m-t*a*m)*S,e[15]=(s*h*i-c*a*i+c*n*o-t*h*o-s*n*u+t*a*u)*S,this}scale(e){let t=this.elements,n=e.x,i=e.y,r=e.z;return t[0]*=n,t[4]*=i,t[8]*=r,t[1]*=n,t[5]*=i,t[9]*=r,t[2]*=n,t[6]*=i,t[10]*=r,t[3]*=n,t[7]*=i,t[11]*=r,this}getMaxScaleOnAxis(){let e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],n=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],i=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,n,i))}makeTranslation(e,t,n){return this.set(1,0,0,e,0,1,0,t,0,0,1,n,0,0,0,1),this}makeRotationX(e){let t=Math.cos(e),n=Math.sin(e);return this.set(1,0,0,0,0,t,-n,0,0,n,t,0,0,0,0,1),this}makeRotationY(e){let t=Math.cos(e),n=Math.sin(e);return this.set(t,0,n,0,0,1,0,0,-n,0,t,0,0,0,0,1),this}makeRotationZ(e){let t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,0,n,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){let n=Math.cos(t),i=Math.sin(t),r=1-n,s=e.x,a=e.y,o=e.z,l=r*s,c=r*a;return this.set(l*s+n,l*a-i*o,l*o+i*a,0,l*a+i*o,c*a+n,c*o-i*s,0,l*o-i*a,c*o+i*s,r*o*o+n,0,0,0,0,1),this}makeScale(e,t,n){return this.set(e,0,0,0,0,t,0,0,0,0,n,0,0,0,0,1),this}makeShear(e,t,n,i,r,s){return this.set(1,n,r,0,e,1,s,0,t,i,1,0,0,0,0,1),this}compose(e,t,n){let i=this.elements,r=t._x,s=t._y,a=t._z,o=t._w,l=r+r,c=s+s,h=a+a,u=r*l,d=r*c,p=r*h,f=s*c,m=s*h,g=a*h,v=o*l,y=o*c,b=o*h,x=n.x,w=n.y,S=n.z;return i[0]=(1-(f+g))*x,i[1]=(d+b)*x,i[2]=(p-y)*x,i[3]=0,i[4]=(d-b)*w,i[5]=(1-(u+g))*w,i[6]=(m+v)*w,i[7]=0,i[8]=(p+y)*S,i[9]=(m-v)*S,i[10]=(1-(u+f))*S,i[11]=0,i[12]=e.x,i[13]=e.y,i[14]=e.z,i[15]=1,this}decompose(e,t,n){let i=this.elements,r=fn.set(i[0],i[1],i[2]).length(),s=fn.set(i[4],i[5],i[6]).length(),a=fn.set(i[8],i[9],i[10]).length();this.determinant()<0&&(r=-r),e.x=i[12],e.y=i[13],e.z=i[14],mn.copy(this);let o=1/r,l=1/s,c=1/a;return mn.elements[0]*=o,mn.elements[1]*=o,mn.elements[2]*=o,mn.elements[4]*=l,mn.elements[5]*=l,mn.elements[6]*=l,mn.elements[8]*=c,mn.elements[9]*=c,mn.elements[10]*=c,t.setFromRotationMatrix(mn),n.x=r,n.y=s,n.z=a,this}makePerspective(e,t,n,i,r,s){let a=this.elements,o=2*r/(t-e),l=2*r/(n-i),c=(t+e)/(t-e),h=(n+i)/(n-i),u=-(s+r)/(s-r),d=-2*s*r/(s-r);return a[0]=o,a[4]=0,a[8]=c,a[12]=0,a[1]=0,a[5]=l,a[9]=h,a[13]=0,a[2]=0,a[6]=0,a[10]=u,a[14]=d,a[3]=0,a[7]=0,a[11]=-1,a[15]=0,this}makeOrthographic(e,t,n,i,r,s){let a=this.elements,o=1/(t-e),l=1/(n-i),c=1/(s-r),h=(t+e)*o,u=(n+i)*l,d=(s+r)*c;return a[0]=2*o,a[4]=0,a[8]=0,a[12]=-h,a[1]=0,a[5]=2*l,a[9]=0,a[13]=-u,a[2]=0,a[6]=0,a[10]=-2*c,a[14]=-d,a[3]=0,a[7]=0,a[11]=0,a[15]=1,this}equals(e){let t=this.elements,n=e.elements;for(let i=0;i<16;i++)if(t[i]!==n[i])return!1;return!0}fromArray(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;for(let n=0;n<16;n++)this.elements[n]=e[n+t];return this}toArray(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e[t+9]=n[9],e[t+10]=n[10],e[t+11]=n[11],e[t+12]=n[12],e[t+13]=n[13],e[t+14]=n[14],e[t+15]=n[15],e}},fn=new Bt,mn=new pn,gn=new Bt(0,0,0),vn=new Bt(1,1,1),yn=new Bt,bn=new Bt,xn=new Bt,wn=new pn,Sn=new Lt,_n=class{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:_n.DEFAULT_ORDER;this.isEuler=!0,this._x=e,this._y=t,this._z=n,this._order=i}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this._order;return this._x=e,this._y=t,this._z=n,this._order=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._order,n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],i=e.elements,r=i[0],s=i[4],a=i[8],o=i[1],l=i[5],c=i[9],h=i[2],u=i[6],d=i[10];switch(t){case"XYZ":this._y=Math.asin(Je(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-c,d),this._z=Math.atan2(-s,r)):(this._x=Math.atan2(u,l),this._z=0);break;case"YXZ":this._x=Math.asin(-Je(c,-1,1)),Math.abs(c)<.9999999?(this._y=Math.atan2(a,d),this._z=Math.atan2(o,l)):(this._y=Math.atan2(-h,r),this._z=0);break;case"ZXY":this._x=Math.asin(Je(u,-1,1)),Math.abs(u)<.9999999?(this._y=Math.atan2(-h,d),this._z=Math.atan2(-s,l)):(this._y=0,this._z=Math.atan2(o,r));break;case"ZYX":this._y=Math.asin(-Je(h,-1,1)),Math.abs(h)<.9999999?(this._x=Math.atan2(u,d),this._z=Math.atan2(o,r)):(this._x=0,this._z=Math.atan2(-s,l));break;case"YZX":this._z=Math.asin(Je(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(-c,l),this._y=Math.atan2(-h,r)):(this._x=0,this._y=Math.atan2(a,d));break;case"XZY":this._z=Math.asin(-Je(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(u,l),this._y=Math.atan2(a,r)):(this._x=Math.atan2(-c,d),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,!0===n&&this._onChangeCallback(),this}setFromQuaternion(e,t,n){return wn.makeRotationFromQuaternion(e),this.setFromRotationMatrix(wn,t,n)}setFromVector3(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._order;return this.set(e.x,e.y,e.z,t)}reorder(e){return Sn.setFromEuler(this),this.setFromQuaternion(Sn,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],void 0!==e[3]&&(this._order=e[3]),this._onChangeCallback(),this}toArray(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}};_n.DEFAULT_ORDER="XYZ";var En=class{constructor(){this.mask=1}set(e){this.mask=1<<e>>>0}enable(e){this.mask|=1<<e}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e}disable(e){this.mask&=~(1<<e)}disableAll(){this.mask=0}test(e){return 0!==(this.mask&e.mask)}isEnabled(e){return 0!==(this.mask&1<<e)}},An=0,Cn=new Bt,Mn=new Lt,Tn=new pn,Pn=new Bt,Dn=new Bt,On=new Bt,In=new Lt,Rn=new Bt(1,0,0),kn=new Bt(0,1,0),Ln=new Bt(0,0,1),Bn={type:"added"},zn={type:"removed"},Nn=class extends qe{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:An++}),this.uuid=Ze(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Nn.DEFAULT_UP.clone();let e=new Bt,t=new _n,n=new Lt,i=new Bt(1,1,1);t._onChange((function(){n.setFromEuler(t,!1)})),n._onChange((function(){t.setFromQuaternion(n,void 0,!1)})),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:n},scale:{configurable:!0,enumerable:!0,value:i},modelViewMatrix:{value:new pn},normalMatrix:{value:new lt}}),this.matrix=new pn,this.matrixWorld=new pn,this.matrixAutoUpdate=Nn.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.matrixWorldAutoUpdate=Nn.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.layers=new En,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return Mn.setFromAxisAngle(e,t),this.quaternion.multiply(Mn),this}rotateOnWorldAxis(e,t){return Mn.setFromAxisAngle(e,t),this.quaternion.premultiply(Mn),this}rotateX(e){return this.rotateOnAxis(Rn,e)}rotateY(e){return this.rotateOnAxis(kn,e)}rotateZ(e){return this.rotateOnAxis(Ln,e)}translateOnAxis(e,t){return Cn.copy(e).applyQuaternion(this.quaternion),this.position.add(Cn.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(Rn,e)}translateY(e){return this.translateOnAxis(kn,e)}translateZ(e){return this.translateOnAxis(Ln,e)}localToWorld(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(Tn.copy(this.matrixWorld).invert())}lookAt(e,t,n){e.isVector3?Pn.copy(e):Pn.set(e,t,n);let i=this.parent;this.updateWorldMatrix(!0,!1),Dn.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Tn.lookAt(Dn,Pn,this.up):Tn.lookAt(Pn,Dn,this.up),this.quaternion.setFromRotationMatrix(Tn),i&&(Tn.extractRotation(i.matrixWorld),Mn.setFromRotationMatrix(Tn),this.quaternion.premultiply(Mn.invert()))}add(e){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.add(arguments[e]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(null!==e.parent&&e.parent.remove(e),e.parent=this,this.children.push(e),e.dispatchEvent(Bn)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.remove(arguments[e]);return this}let t=this.children.indexOf(e);return-1!==t&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(zn)),this}removeFromParent(){let e=this.parent;return null!==e&&e.remove(this),this}clear(){for(let e=0;e<this.children.length;e++){let t=this.children[e];t.parent=null,t.dispatchEvent(zn)}return this.children.length=0,this}attach(e){return this.updateWorldMatrix(!0,!1),Tn.copy(this.matrixWorld).invert(),null!==e.parent&&(e.parent.updateWorldMatrix(!0,!1),Tn.multiply(e.parent.matrixWorld)),e.applyMatrix4(Tn),this.add(e),e.updateWorldMatrix(!1,!0),this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let n=0,i=this.children.length;n<i;n++){let i=this.children[n].getObjectByProperty(e,t);if(void 0!==i)return i}}getObjectsByProperty(e,t){let n=[];this[e]===t&&n.push(this);for(let i=0,r=this.children.length;i<r;i++){let r=this.children[i].getObjectsByProperty(e,t);r.length>0&&(n=n.concat(r))}return n}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Dn,e,On),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Dn,In,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);let t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(e){e(this);let t=this.children;for(let n=0,i=t.length;n<i;n++)t[n].traverse(e)}traverseVisible(e){if(!1===this.visible)return;e(this);let t=this.children;for(let n=0,i=t.length;n<i;n++)t[n].traverseVisible(e)}traverseAncestors(e){let t=this.parent;null!==t&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);let t=this.children;for(let n=0,i=t.length;n<i;n++){let i=t[n];(!0===i.matrixWorldAutoUpdate||!0===e)&&i.updateMatrixWorld(e)}}updateWorldMatrix(e,t){let n=this.parent;if(!0===e&&null!==n&&!0===n.matrixWorldAutoUpdate&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===t){let e=this.children;for(let t=0,n=e.length;t<n;t++){let n=e[t];!0===n.matrixWorldAutoUpdate&&n.updateWorldMatrix(!1,!0)}}}toJSON(e){let t=void 0===e||"string"==typeof e,n={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},n.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});let i={};function r(t,n){return void 0===t[n.uuid]&&(t[n.uuid]=n.toJSON(e)),n.uuid}if(i.uuid=this.uuid,i.type=this.type,""!==this.name&&(i.name=this.name),!0===this.castShadow&&(i.castShadow=!0),!0===this.receiveShadow&&(i.receiveShadow=!0),!1===this.visible&&(i.visible=!1),!1===this.frustumCulled&&(i.frustumCulled=!1),0!==this.renderOrder&&(i.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(i.userData=this.userData),i.layers=this.layers.mask,i.matrix=this.matrix.toArray(),!1===this.matrixAutoUpdate&&(i.matrixAutoUpdate=!1),this.isInstancedMesh&&(i.type="InstancedMesh",i.count=this.count,i.instanceMatrix=this.instanceMatrix.toJSON(),null!==this.instanceColor&&(i.instanceColor=this.instanceColor.toJSON())),this.isScene)this.background&&(this.background.isColor?i.background=this.background.toJSON():this.background.isTexture&&(i.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&!0!==this.environment.isRenderTargetTexture&&(i.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){i.geometry=r(e.geometries,this.geometry);let t=this.geometry.parameters;if(void 0!==t&&void 0!==t.shapes){let n=t.shapes;if(Array.isArray(n))for(let t=0,i=n.length;t<i;t++){let i=n[t];r(e.shapes,i)}else r(e.shapes,n)}}if(this.isSkinnedMesh&&(i.bindMode=this.bindMode,i.bindMatrix=this.bindMatrix.toArray(),void 0!==this.skeleton&&(r(e.skeletons,this.skeleton),i.skeleton=this.skeleton.uuid)),void 0!==this.material)if(Array.isArray(this.material)){let t=[];for(let n=0,i=this.material.length;n<i;n++)t.push(r(e.materials,this.material[n]));i.material=t}else i.material=r(e.materials,this.material);if(this.children.length>0){i.children=[];for(let t=0;t<this.children.length;t++)i.children.push(this.children[t].toJSON(e).object)}if(this.animations.length>0){i.animations=[];for(let t=0;t<this.animations.length;t++){let n=this.animations[t];i.animations.push(r(e.animations,n))}}if(t){let t=s(e.geometries),i=s(e.materials),r=s(e.textures),a=s(e.images),o=s(e.shapes),l=s(e.skeletons),c=s(e.animations),h=s(e.nodes);t.length>0&&(n.geometries=t),i.length>0&&(n.materials=i),r.length>0&&(n.textures=r),a.length>0&&(n.images=a),o.length>0&&(n.shapes=o),l.length>0&&(n.skeletons=l),c.length>0&&(n.animations=c),h.length>0&&(n.nodes=h)}return n.object=i,n;function s(e){let t=[];for(let n in e){let i=e[n];delete i.metadata,t.push(i)}return t}}clone(e){return(new this.constructor).copy(this,e)}copy(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.userData=JSON.parse(JSON.stringify(e.userData)),!0===t)for(let n=0;n<e.children.length;n++){let t=e.children[n];this.add(t.clone())}return this}};Nn.DEFAULT_UP=new Bt(0,1,0),Nn.DEFAULT_MATRIX_AUTO_UPDATE=!0,Nn.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;var Fn=new Bt,Un=new Bt,jn=new Bt,Vn=new Bt,Gn=new Bt,Hn=new Bt,Wn=new Bt,qn=new Bt,Xn=new Bt,Yn=new Bt,Qn=class{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Bt,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Bt,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Bt;this.a=e,this.b=t,this.c=n}static getNormal(e,t,n,i){i.subVectors(n,t),Fn.subVectors(e,t),i.cross(Fn);let r=i.lengthSq();return r>0?i.multiplyScalar(1/Math.sqrt(r)):i.set(0,0,0)}static getBarycoord(e,t,n,i,r){Fn.subVectors(i,t),Un.subVectors(n,t),jn.subVectors(e,t);let s=Fn.dot(Fn),a=Fn.dot(Un),o=Fn.dot(jn),l=Un.dot(Un),c=Un.dot(jn),h=s*l-a*a;if(0===h)return r.set(-2,-1,-1);let u=1/h,d=(l*o-a*c)*u,p=(s*c-a*o)*u;return r.set(1-d-p,p,d)}static containsPoint(e,t,n,i){return this.getBarycoord(e,t,n,i,Vn),Vn.x>=0&&Vn.y>=0&&Vn.x+Vn.y<=1}static getUV(e,t,n,i,r,s,a,o){return this.getBarycoord(e,t,n,i,Vn),o.set(0,0),o.addScaledVector(r,Vn.x),o.addScaledVector(s,Vn.y),o.addScaledVector(a,Vn.z),o}static isFrontFacing(e,t,n,i){return Fn.subVectors(n,t),Un.subVectors(e,t),Fn.cross(Un).dot(i)<0}set(e,t,n){return this.a.copy(e),this.b.copy(t),this.c.copy(n),this}setFromPointsAndIndices(e,t,n,i){return this.a.copy(e[t]),this.b.copy(e[n]),this.c.copy(e[i]),this}setFromAttributeAndIndices(e,t,n,i){return this.a.fromBufferAttribute(e,t),this.b.fromBufferAttribute(e,n),this.c.fromBufferAttribute(e,i),this}clone(){return(new this.constructor).copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return Fn.subVectors(this.c,this.b),Un.subVectors(this.a,this.b),.5*Fn.cross(Un).length()}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return Qn.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return Qn.getBarycoord(e,this.a,this.b,this.c,t)}getUV(e,t,n,i,r){return Qn.getUV(e,this.a,this.b,this.c,t,n,i,r)}containsPoint(e){return Qn.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return Qn.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){let n,i,r=this.a,s=this.b,a=this.c;Gn.subVectors(s,r),Hn.subVectors(a,r),qn.subVectors(e,r);let o=Gn.dot(qn),l=Hn.dot(qn);if(o<=0&&l<=0)return t.copy(r);Xn.subVectors(e,s);let c=Gn.dot(Xn),h=Hn.dot(Xn);if(c>=0&&h<=c)return t.copy(s);let u=o*h-c*l;if(u<=0&&o>=0&&c<=0)return n=o/(o-c),t.copy(r).addScaledVector(Gn,n);Yn.subVectors(e,a);let d=Gn.dot(Yn),p=Hn.dot(Yn);if(p>=0&&d<=p)return t.copy(a);let f=d*l-o*p;if(f<=0&&l>=0&&p<=0)return i=l/(l-p),t.copy(r).addScaledVector(Hn,i);let m=c*p-d*h;if(m<=0&&h-c>=0&&d-p>=0)return Wn.subVectors(a,s),i=(h-c)/(h-c+(d-p)),t.copy(s).addScaledVector(Wn,i);let g=1/(m+f+u);return n=f*g,i=u*g,t.copy(r).addScaledVector(Gn,n).addScaledVector(Hn,i)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}},Kn=0,Zn=class extends qe{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:Kn++}),this.uuid=Ze(),this.name="",this.type="Material",this.blending=1,this.side=0,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.blendSrc=204,this.blendDst=205,this.blendEquation=V,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=3,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=519,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=Ve,this.stencilZFail=Ve,this.stencilZPass=Ve,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(void 0!==e)for(let t in e){let n=e[t];if(void 0===n){console.warn("THREE.Material: '"+t+"' parameter is undefined.");continue}let i=this[t];void 0!==i?i&&i.isColor?i.set(n):i&&i.isVector3&&n&&n.isVector3?i.copy(n):this[t]=n:console.warn("THREE."+this.type+": '"+t+"' is not a property of this material.")}}toJSON(e){let t=void 0===e||"string"==typeof e;t&&(e={textures:{},images:{}});let n={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};function i(e){let t=[];for(let n in e){let i=e[n];delete i.metadata,t.push(i)}return t}if(n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),this.color&&this.color.isColor&&(n.color=this.color.getHex()),void 0!==this.roughness&&(n.roughness=this.roughness),void 0!==this.metalness&&(n.metalness=this.metalness),void 0!==this.sheen&&(n.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(n.sheenColor=this.sheenColor.getHex()),void 0!==this.sheenRoughness&&(n.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(n.emissive=this.emissive.getHex()),this.emissiveIntensity&&1!==this.emissiveIntensity&&(n.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(n.specular=this.specular.getHex()),void 0!==this.specularIntensity&&(n.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(n.specularColor=this.specularColor.getHex()),void 0!==this.shininess&&(n.shininess=this.shininess),void 0!==this.clearcoat&&(n.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(n.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(n.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(n.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(n.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,n.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),void 0!==this.iridescence&&(n.iridescence=this.iridescence),void 0!==this.iridescenceIOR&&(n.iridescenceIOR=this.iridescenceIOR),void 0!==this.iridescenceThicknessRange&&(n.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(n.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(n.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(n.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(n.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(n.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(n.lightMap=this.lightMap.toJSON(e).uuid,n.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(n.aoMap=this.aoMap.toJSON(e).uuid,n.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(n.bumpMap=this.bumpMap.toJSON(e).uuid,n.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(n.normalMap=this.normalMap.toJSON(e).uuid,n.normalMapType=this.normalMapType,n.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(n.displacementMap=this.displacementMap.toJSON(e).uuid,n.displacementScale=this.displacementScale,n.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(n.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(n.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(n.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(n.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(n.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(n.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(n.envMap=this.envMap.toJSON(e).uuid,void 0!==this.combine&&(n.combine=this.combine)),void 0!==this.envMapIntensity&&(n.envMapIntensity=this.envMapIntensity),void 0!==this.reflectivity&&(n.reflectivity=this.reflectivity),void 0!==this.refractionRatio&&(n.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(n.gradientMap=this.gradientMap.toJSON(e).uuid),void 0!==this.transmission&&(n.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(n.transmissionMap=this.transmissionMap.toJSON(e).uuid),void 0!==this.thickness&&(n.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(n.thicknessMap=this.thicknessMap.toJSON(e).uuid),void 0!==this.attenuationDistance&&this.attenuationDistance!==1/0&&(n.attenuationDistance=this.attenuationDistance),void 0!==this.attenuationColor&&(n.attenuationColor=this.attenuationColor.getHex()),void 0!==this.size&&(n.size=this.size),null!==this.shadowSide&&(n.shadowSide=this.shadowSide),void 0!==this.sizeAttenuation&&(n.sizeAttenuation=this.sizeAttenuation),1!==this.blending&&(n.blending=this.blending),0!==this.side&&(n.side=this.side),this.vertexColors&&(n.vertexColors=!0),this.opacity<1&&(n.opacity=this.opacity),!0===this.transparent&&(n.transparent=this.transparent),n.depthFunc=this.depthFunc,n.depthTest=this.depthTest,n.depthWrite=this.depthWrite,n.colorWrite=this.colorWrite,n.stencilWrite=this.stencilWrite,n.stencilWriteMask=this.stencilWriteMask,n.stencilFunc=this.stencilFunc,n.stencilRef=this.stencilRef,n.stencilFuncMask=this.stencilFuncMask,n.stencilFail=this.stencilFail,n.stencilZFail=this.stencilZFail,n.stencilZPass=this.stencilZPass,void 0!==this.rotation&&0!==this.rotation&&(n.rotation=this.rotation),!0===this.polygonOffset&&(n.polygonOffset=!0),0!==this.polygonOffsetFactor&&(n.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(n.polygonOffsetUnits=this.polygonOffsetUnits),void 0!==this.linewidth&&1!==this.linewidth&&(n.linewidth=this.linewidth),void 0!==this.dashSize&&(n.dashSize=this.dashSize),void 0!==this.gapSize&&(n.gapSize=this.gapSize),void 0!==this.scale&&(n.scale=this.scale),!0===this.dithering&&(n.dithering=!0),this.alphaTest>0&&(n.alphaTest=this.alphaTest),!0===this.alphaToCoverage&&(n.alphaToCoverage=this.alphaToCoverage),!0===this.premultipliedAlpha&&(n.premultipliedAlpha=this.premultipliedAlpha),!0===this.forceSinglePass&&(n.forceSinglePass=this.forceSinglePass),!0===this.wireframe&&(n.wireframe=this.wireframe),this.wireframeLinewidth>1&&(n.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(n.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(n.wireframeLinejoin=this.wireframeLinejoin),!0===this.flatShading&&(n.flatShading=this.flatShading),!1===this.visible&&(n.visible=!1),!1===this.toneMapped&&(n.toneMapped=!1),!1===this.fog&&(n.fog=!1),Object.keys(this.userData).length>0&&(n.userData=this.userData),t){let t=i(e.textures),r=i(e.images);t.length>0&&(n.textures=t),r.length>0&&(n.images=r)}return n}clone(){return(new this.constructor).copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;let t=e.clippingPlanes,n=null;if(null!==t){let e=t.length;n=new Array(e);for(let i=0;i!==e;++i)n[i]=t[i].clone()}return this.clippingPlanes=n,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.forceSinglePass=e.forceSinglePass,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){!0===e&&this.version++}},Jn=class extends Zn{constructor(e){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new Et(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}},$n=new Bt,ei=new ot,ti=class{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=e,this.itemSize=t,this.count=void 0!==e?e.length/t:0,this.normalized=n,this.usage=Ge,this.updateRange={offset:0,count:-1},this.version=0}onUploadCallback(){}set needsUpdate(e){!0===e&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this}copyAt(e,t,n){e*=this.itemSize,n*=t.itemSize;for(let i=0,r=this.itemSize;i<r;i++)this.array[e+i]=t.array[n+i];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(2===this.itemSize)for(let t=0,n=this.count;t<n;t++)ei.fromBufferAttribute(this,t),ei.applyMatrix3(e),this.setXY(t,ei.x,ei.y);else if(3===this.itemSize)for(let t=0,n=this.count;t<n;t++)$n.fromBufferAttribute(this,t),$n.applyMatrix3(e),this.setXYZ(t,$n.x,$n.y,$n.z);return this}applyMatrix4(e){for(let t=0,n=this.count;t<n;t++)$n.fromBufferAttribute(this,t),$n.applyMatrix4(e),this.setXYZ(t,$n.x,$n.y,$n.z);return this}applyNormalMatrix(e){for(let t=0,n=this.count;t<n;t++)$n.fromBufferAttribute(this,t),$n.applyNormalMatrix(e),this.setXYZ(t,$n.x,$n.y,$n.z);return this}transformDirection(e){for(let t=0,n=this.count;t<n;t++)$n.fromBufferAttribute(this,t),$n.transformDirection(e),this.setXYZ(t,$n.x,$n.y,$n.z);return this}set(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.array.set(e,t),this}getX(e){let t=this.array[e*this.itemSize];return this.normalized&&(t=rt(t,this.array)),t}setX(e,t){return this.normalized&&(t=st(t,this.array)),this.array[e*this.itemSize]=t,this}getY(e){let t=this.array[e*this.itemSize+1];return this.normalized&&(t=rt(t,this.array)),t}setY(e,t){return this.normalized&&(t=st(t,this.array)),this.array[e*this.itemSize+1]=t,this}getZ(e){let t=this.array[e*this.itemSize+2];return this.normalized&&(t=rt(t,this.array)),t}setZ(e,t){return this.normalized&&(t=st(t,this.array)),this.array[e*this.itemSize+2]=t,this}getW(e){let t=this.array[e*this.itemSize+3];return this.normalized&&(t=rt(t,this.array)),t}setW(e,t){return this.normalized&&(t=st(t,this.array)),this.array[e*this.itemSize+3]=t,this}setXY(e,t,n){return e*=this.itemSize,this.normalized&&(t=st(t,this.array),n=st(n,this.array)),this.array[e+0]=t,this.array[e+1]=n,this}setXYZ(e,t,n,i){return e*=this.itemSize,this.normalized&&(t=st(t,this.array),n=st(n,this.array),i=st(i,this.array)),this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=i,this}setXYZW(e,t,n,i,r){return e*=this.itemSize,this.normalized&&(t=st(t,this.array),n=st(n,this.array),i=st(i,this.array),r=st(r,this.array)),this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=i,this.array[e+3]=r,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){let e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return""!==this.name&&(e.name=this.name),this.usage!==Ge&&(e.usage=this.usage),(0!==this.updateRange.offset||-1!==this.updateRange.count)&&(e.updateRange=this.updateRange),e}copyColorsArray(){console.error("THREE.BufferAttribute: copyColorsArray() was removed in r144.")}copyVector2sArray(){console.error("THREE.BufferAttribute: copyVector2sArray() was removed in r144.")}copyVector3sArray(){console.error("THREE.BufferAttribute: copyVector3sArray() was removed in r144.")}copyVector4sArray(){console.error("THREE.BufferAttribute: copyVector4sArray() was removed in r144.")}},ni=class extends ti{constructor(e,t,n){super(new Uint16Array(e),t,n)}},ii=class extends ti{constructor(e,t,n){super(new Uint32Array(e),t,n)}},ri=class extends ti{constructor(e,t,n){super(new Float32Array(e),t,n)}},si=0,ai=new pn,oi=new Nn,li=new Bt,ci=new Ft,hi=new Ft,ui=new Bt,di=class extends qe{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:si++}),this.uuid=Ze(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(ht(e)?ii:ni)(e,1):this.index=e,this}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return void 0!==this.attributes[e]}addGroup(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.groups.push({start:e,count:t,materialIndex:n})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){let t=this.attributes.position;void 0!==t&&(t.applyMatrix4(e),t.needsUpdate=!0);let n=this.attributes.normal;if(void 0!==n){let t=(new lt).getNormalMatrix(e);n.applyNormalMatrix(t),n.needsUpdate=!0}let i=this.attributes.tangent;return void 0!==i&&(i.transformDirection(e),i.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}applyQuaternion(e){return ai.makeRotationFromQuaternion(e),this.applyMatrix4(ai),this}rotateX(e){return ai.makeRotationX(e),this.applyMatrix4(ai),this}rotateY(e){return ai.makeRotationY(e),this.applyMatrix4(ai),this}rotateZ(e){return ai.makeRotationZ(e),this.applyMatrix4(ai),this}translate(e,t,n){return ai.makeTranslation(e,t,n),this.applyMatrix4(ai),this}scale(e,t,n){return ai.makeScale(e,t,n),this.applyMatrix4(ai),this}lookAt(e){return oi.lookAt(e),oi.updateMatrix(),this.applyMatrix4(oi.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(li).negate(),this.translate(li.x,li.y,li.z),this}setFromPoints(e){let t=[];for(let n=0,i=e.length;n<i;n++){let i=e[n];t.push(i.x,i.y,i.z||0)}return this.setAttribute("position",new ri(t,3)),this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new Ft);let e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingBox.set(new Bt(-1/0,-1/0,-1/0),new Bt(1/0,1/0,1/0));if(void 0!==e){if(this.boundingBox.setFromBufferAttribute(e),t)for(let n=0,i=t.length;n<i;n++){let e=t[n];ci.setFromBufferAttribute(e),this.morphTargetsRelative?(ui.addVectors(this.boundingBox.min,ci.min),this.boundingBox.expandByPoint(ui),ui.addVectors(this.boundingBox.max,ci.max),this.boundingBox.expandByPoint(ui)):(this.boundingBox.expandByPoint(ci.min),this.boundingBox.expandByPoint(ci.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new rn);let e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingSphere.set(new Bt,1/0);if(e){let n=this.boundingSphere.center;if(ci.setFromBufferAttribute(e),t)for(let e=0,r=t.length;e<r;e++){let n=t[e];hi.setFromBufferAttribute(n),this.morphTargetsRelative?(ui.addVectors(ci.min,hi.min),ci.expandByPoint(ui),ui.addVectors(ci.max,hi.max),ci.expandByPoint(ui)):(ci.expandByPoint(hi.min),ci.expandByPoint(hi.max))}ci.getCenter(n);let i=0;for(let t=0,r=e.count;t<r;t++)ui.fromBufferAttribute(e,t),i=Math.max(i,n.distanceToSquared(ui));if(t)for(let r=0,s=t.length;r<s;r++){let s=t[r],a=this.morphTargetsRelative;for(let t=0,r=s.count;t<r;t++)ui.fromBufferAttribute(s,t),a&&(li.fromBufferAttribute(e,t),ui.add(li)),i=Math.max(i,n.distanceToSquared(ui))}this.boundingSphere.radius=Math.sqrt(i),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){let e=this.index,t=this.attributes;if(null===e||void 0===t.position||void 0===t.normal||void 0===t.uv)return void console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");let n=e.array,i=t.position.array,r=t.normal.array,s=t.uv.array,a=i.length/3;!1===this.hasAttribute("tangent")&&this.setAttribute("tangent",new ti(new Float32Array(4*a),4));let o=this.getAttribute("tangent").array,l=[],c=[];for(let A=0;A<a;A++)l[A]=new Bt,c[A]=new Bt;let h=new Bt,u=new Bt,d=new Bt,p=new ot,f=new ot,m=new ot,g=new Bt,v=new Bt;function y(e,t,n){h.fromArray(i,3*e),u.fromArray(i,3*t),d.fromArray(i,3*n),p.fromArray(s,2*e),f.fromArray(s,2*t),m.fromArray(s,2*n),u.sub(h),d.sub(h),f.sub(p),m.sub(p);let r=1/(f.x*m.y-m.x*f.y);!isFinite(r)||(g.copy(u).multiplyScalar(m.y).addScaledVector(d,-f.y).multiplyScalar(r),v.copy(d).multiplyScalar(f.x).addScaledVector(u,-m.x).multiplyScalar(r),l[e].add(g),l[t].add(g),l[n].add(g),c[e].add(v),c[t].add(v),c[n].add(v))}let b=this.groups;0===b.length&&(b=[{start:0,count:n.length}]);for(let A=0,C=b.length;A<C;++A){let e=b[A],t=e.start;for(let i=t,r=t+e.count;i<r;i+=3)y(n[i+0],n[i+1],n[i+2])}let x=new Bt,w=new Bt,S=new Bt,_=new Bt;function E(e){S.fromArray(r,3*e),_.copy(S);let t=l[e];x.copy(t),x.sub(S.multiplyScalar(S.dot(t))).normalize(),w.crossVectors(_,t);let n=w.dot(c[e])<0?-1:1;o[4*e]=x.x,o[4*e+1]=x.y,o[4*e+2]=x.z,o[4*e+3]=n}for(let A=0,C=b.length;A<C;++A){let e=b[A],t=e.start;for(let i=t,r=t+e.count;i<r;i+=3)E(n[i+0]),E(n[i+1]),E(n[i+2])}}computeVertexNormals(){let e=this.index,t=this.getAttribute("position");if(void 0!==t){let n=this.getAttribute("normal");if(void 0===n)n=new ti(new Float32Array(3*t.count),3),this.setAttribute("normal",n);else for(let e=0,t=n.count;e<t;e++)n.setXYZ(e,0,0,0);let i=new Bt,r=new Bt,s=new Bt,a=new Bt,o=new Bt,l=new Bt,c=new Bt,h=new Bt;if(e)for(let u=0,d=e.count;u<d;u+=3){let d=e.getX(u+0),p=e.getX(u+1),f=e.getX(u+2);i.fromBufferAttribute(t,d),r.fromBufferAttribute(t,p),s.fromBufferAttribute(t,f),c.subVectors(s,r),h.subVectors(i,r),c.cross(h),a.fromBufferAttribute(n,d),o.fromBufferAttribute(n,p),l.fromBufferAttribute(n,f),a.add(c),o.add(c),l.add(c),n.setXYZ(d,a.x,a.y,a.z),n.setXYZ(p,o.x,o.y,o.z),n.setXYZ(f,l.x,l.y,l.z)}else for(let e=0,u=t.count;e<u;e+=3)i.fromBufferAttribute(t,e+0),r.fromBufferAttribute(t,e+1),s.fromBufferAttribute(t,e+2),c.subVectors(s,r),h.subVectors(i,r),c.cross(h),n.setXYZ(e+0,c.x,c.y,c.z),n.setXYZ(e+1,c.x,c.y,c.z),n.setXYZ(e+2,c.x,c.y,c.z);this.normalizeNormals(),n.needsUpdate=!0}}merge(){return console.error("THREE.BufferGeometry.merge() has been removed. Use THREE.BufferGeometryUtils.mergeBufferGeometries() instead."),this}normalizeNormals(){let e=this.attributes.normal;for(let t=0,n=e.count;t<n;t++)ui.fromBufferAttribute(e,t),ui.normalize(),e.setXYZ(t,ui.x,ui.y,ui.z)}toNonIndexed(){function e(e,t){let n=e.array,i=e.itemSize,r=e.normalized,s=new n.constructor(t.length*i),a=0,o=0;for(let l=0,c=t.length;l<c;l++){a=e.isInterleavedBufferAttribute?t[l]*e.data.stride+e.offset:t[l]*i;for(let e=0;e<i;e++)s[o++]=n[a++]}return new ti(s,i,r)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;let t=new di,n=this.index.array,i=this.attributes;for(let a in i){let r=e(i[a],n);t.setAttribute(a,r)}let r=this.morphAttributes;for(let a in r){let i=[],s=r[a];for(let t=0,r=s.length;t<r;t++){let r=e(s[t],n);i.push(r)}t.morphAttributes[a]=i}t.morphTargetsRelative=this.morphTargetsRelative;let s=this.groups;for(let a=0,o=s.length;a<o;a++){let e=s[a];t.addGroup(e.start,e.count,e.materialIndex)}return t}toJSON(){let e={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),void 0!==this.parameters){let t=this.parameters;for(let n in t)void 0!==t[n]&&(e[n]=t[n]);return e}e.data={attributes:{}};let t=this.index;null!==t&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});let n=this.attributes;for(let o in n){let t=n[o];e.data.attributes[o]=t.toJSON(e.data)}let i={},r=!1;for(let o in this.morphAttributes){let t=this.morphAttributes[o],n=[];for(let i=0,r=t.length;i<r;i++){let r=t[i];n.push(r.toJSON(e.data))}n.length>0&&(i[o]=n,r=!0)}r&&(e.data.morphAttributes=i,e.data.morphTargetsRelative=this.morphTargetsRelative);let s=this.groups;s.length>0&&(e.data.groups=JSON.parse(JSON.stringify(s)));let a=this.boundingSphere;return null!==a&&(e.data.boundingSphere={center:a.center.toArray(),radius:a.radius}),e}clone(){return(new this.constructor).copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;let t={};this.name=e.name;let n=e.index;null!==n&&this.setIndex(n.clone(t));let i=e.attributes;for(let l in i){let e=i[l];this.setAttribute(l,e.clone(t))}let r=e.morphAttributes;for(let l in r){let e=[],n=r[l];for(let i=0,r=n.length;i<r;i++)e.push(n[i].clone(t));this.morphAttributes[l]=e}this.morphTargetsRelative=e.morphTargetsRelative;let s=e.groups;for(let l=0,c=s.length;l<c;l++){let e=s[l];this.addGroup(e.start,e.count,e.materialIndex)}let a=e.boundingBox;null!==a&&(this.boundingBox=a.clone());let o=e.boundingSphere;return null!==o&&(this.boundingSphere=o.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,void 0!==e.parameters&&(this.parameters=Object.assign({},e.parameters)),this}dispose(){this.dispatchEvent({type:"dispose"})}},pi=new pn,fi=new dn,mi=new rn,gi=new Bt,vi=new Bt,yi=new Bt,bi=new Bt,xi=new Bt,wi=new ot,Si=new ot,_i=new ot,Ei=new Bt,Ai=new Bt,Ci=class extends Nn{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new di,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Jn;super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),void 0!==e.morphTargetInfluences&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),void 0!==e.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=e.material,this.geometry=e.geometry,this}updateMorphTargets(){let e=this.geometry.morphAttributes,t=Object.keys(e);if(t.length>0){let n=e[t[0]];if(void 0!==n){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,t=n.length;e<t;e++){let t=n[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[t]=e}}}}getVertexPosition(e,t){let n=this.geometry,i=n.attributes.position,r=n.morphAttributes.position,s=n.morphTargetsRelative;t.fromBufferAttribute(i,e);let a=this.morphTargetInfluences;if(r&&a){xi.set(0,0,0);for(let n=0,i=r.length;n<i;n++){let i=a[n],o=r[n];0!==i&&(bi.fromBufferAttribute(o,e),s?xi.addScaledVector(bi,i):xi.addScaledVector(bi.sub(t),i))}t.add(xi)}return this.isSkinnedMesh&&this.boneTransform(e,t),t}raycast(e,t){let n=this.geometry,i=this.material,r=this.matrixWorld;if(void 0===i||(null===n.boundingSphere&&n.computeBoundingSphere(),mi.copy(n.boundingSphere),mi.applyMatrix4(r),!1===e.ray.intersectsSphere(mi))||(pi.copy(r).invert(),fi.copy(e.ray).applyMatrix4(pi),null!==n.boundingBox&&!1===fi.intersectsBox(n.boundingBox)))return;let s,a=n.index,o=n.attributes.position,l=n.attributes.uv,c=n.attributes.uv2,h=n.groups,u=n.drawRange;if(null!==a)if(Array.isArray(i))for(let d=0,p=h.length;d<p;d++){let n=h[d],r=i[n.materialIndex];for(let i=Math.max(n.start,u.start),o=Math.min(a.count,Math.min(n.start+n.count,u.start+u.count));i<o;i+=3){let o=a.getX(i),h=a.getX(i+1),u=a.getX(i+2);s=Mi(this,r,e,fi,l,c,o,h,u),s&&(s.faceIndex=Math.floor(i/3),s.face.materialIndex=n.materialIndex,t.push(s))}}else{for(let n=Math.max(0,u.start),r=Math.min(a.count,u.start+u.count);n<r;n+=3){let r=a.getX(n),o=a.getX(n+1),h=a.getX(n+2);s=Mi(this,i,e,fi,l,c,r,o,h),s&&(s.faceIndex=Math.floor(n/3),t.push(s))}}else if(void 0!==o)if(Array.isArray(i))for(let d=0,p=h.length;d<p;d++){let n=h[d],r=i[n.materialIndex];for(let i=Math.max(n.start,u.start),a=Math.min(o.count,Math.min(n.start+n.count,u.start+u.count));i<a;i+=3){s=Mi(this,r,e,fi,l,c,i,i+1,i+2),s&&(s.faceIndex=Math.floor(i/3),s.face.materialIndex=n.materialIndex,t.push(s))}}else{for(let n=Math.max(0,u.start),r=Math.min(o.count,u.start+u.count);n<r;n+=3){s=Mi(this,i,e,fi,l,c,n,n+1,n+2),s&&(s.faceIndex=Math.floor(n/3),t.push(s))}}}};function Mi(e,t,n,i,r,s,a,o,l){e.getVertexPosition(a,gi),e.getVertexPosition(o,vi),e.getVertexPosition(l,yi);let c=function(e,t,n,i,r,s,a,o){let l;if(l=1===t.side?i.intersectTriangle(a,s,r,!0,o):i.intersectTriangle(r,s,a,0===t.side,o),null===l)return null;Ai.copy(o),Ai.applyMatrix4(e.matrixWorld);let c=n.ray.origin.distanceTo(Ai);return c<n.near||c>n.far?null:{distance:c,point:Ai.clone(),object:e}}(e,t,n,i,gi,vi,yi,Ei);if(c){r&&(wi.fromBufferAttribute(r,a),Si.fromBufferAttribute(r,o),_i.fromBufferAttribute(r,l),c.uv=Qn.getUV(Ei,gi,vi,yi,wi,Si,_i,new ot)),s&&(wi.fromBufferAttribute(s,a),Si.fromBufferAttribute(s,o),_i.fromBufferAttribute(s,l),c.uv2=Qn.getUV(Ei,gi,vi,yi,wi,Si,_i,new ot));let e={a:a,b:o,c:l,normal:new Bt,materialIndex:0};Qn.getNormal(gi,vi,yi,e.normal),c.face=e}return c}var Ti=class extends di{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1;super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:n,widthSegments:i,heightSegments:r,depthSegments:s};let a=this;i=Math.floor(i),r=Math.floor(r),s=Math.floor(s);let o=[],l=[],c=[],h=[],u=0,d=0;function p(e,t,n,i,r,s,p,f,m,g,v){let y=s/m,b=p/g,x=s/2,w=p/2,S=f/2,_=m+1,E=g+1,A=0,C=0,M=new Bt;for(let a=0;a<E;a++){let s=a*b-w;for(let o=0;o<_;o++){let u=o*y-x;M[e]=u*i,M[t]=s*r,M[n]=S,l.push(M.x,M.y,M.z),M[e]=0,M[t]=0,M[n]=f>0?1:-1,c.push(M.x,M.y,M.z),h.push(o/m),h.push(1-a/g),A+=1}}for(let a=0;a<g;a++)for(let e=0;e<m;e++){let t=u+e+_*a,n=u+e+_*(a+1),i=u+(e+1)+_*(a+1),r=u+(e+1)+_*a;o.push(t,n,r),o.push(n,i,r),C+=6}a.addGroup(d,C,v),d+=C,u+=A}p("z","y","x",-1,-1,n,t,e,s,r,0),p("z","y","x",1,-1,n,t,-e,s,r,1),p("x","z","y",1,1,e,n,t,i,s,2),p("x","z","y",1,-1,e,n,-t,i,s,3),p("x","y","z",1,-1,e,t,n,i,r,4),p("x","y","z",-1,-1,e,t,-n,i,r,5),this.setIndex(o),this.setAttribute("position",new ri(l,3)),this.setAttribute("normal",new ri(c,3)),this.setAttribute("uv",new ri(h,2))}static fromJSON(e){return new Ti(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}};function Pi(e){let t={};for(let n in e){t[n]={};for(let i in e[n]){let r=e[n][i];r&&(r.isColor||r.isMatrix3||r.isMatrix4||r.isVector2||r.isVector3||r.isVector4||r.isTexture||r.isQuaternion)?t[n][i]=r.clone():Array.isArray(r)?t[n][i]=r.slice():t[n][i]=r}}return t}function Di(e){let t={};for(let n=0;n<e.length;n++){let i=Pi(e[n]);for(let e in i)t[e]=i[e]}return t}function Oi(e){return null===e.getRenderTarget()&&e.outputEncoding===Ne?Ue:je}var Ii={clone:Pi,merge:Di},Ri=class extends Zn{constructor(e){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,void 0!==e&&this.setValues(e)}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=Pi(e.uniforms),this.uniformsGroups=function(e){let t=[];for(let n=0;n<e.length;n++)t.push(e[n].clone());return t}(e.uniformsGroups),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){let t=super.toJSON(e);t.glslVersion=this.glslVersion,t.uniforms={};for(let i in this.uniforms){let n=this.uniforms[i].value;n&&n.isTexture?t.uniforms[i]={type:"t",value:n.toJSON(e).uuid}:n&&n.isColor?t.uniforms[i]={type:"c",value:n.getHex()}:n&&n.isVector2?t.uniforms[i]={type:"v2",value:n.toArray()}:n&&n.isVector3?t.uniforms[i]={type:"v3",value:n.toArray()}:n&&n.isVector4?t.uniforms[i]={type:"v4",value:n.toArray()}:n&&n.isMatrix3?t.uniforms[i]={type:"m3",value:n.toArray()}:n&&n.isMatrix4?t.uniforms[i]={type:"m4",value:n.toArray()}:t.uniforms[i]={value:n}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader;let n={};for(let i in this.extensions)!0===this.extensions[i]&&(n[i]=!0);return Object.keys(n).length>0&&(t.extensions=n),t}},ki=class extends Nn{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new pn,this.projectionMatrix=new pn,this.projectionMatrixInverse=new pn}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this}getWorldDirection(e){this.updateWorldMatrix(!0,!1);let t=this.matrixWorld.elements;return e.set(-t[8],-t[9],-t[10]).normalize()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return(new this.constructor).copy(this)}},Li=class extends ki{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:50,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.1,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2e3;super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=n,this.far=i,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=null===e.view?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){let t=.5*this.getFilmHeight()/e;this.fov=2*Ke*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){let e=Math.tan(.5*Qe*this.fov);return.5*this.getFilmHeight()/e}getEffectiveFOV(){return 2*Ke*Math.atan(Math.tan(.5*Qe*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(e,t,n,i,r,s){this.aspect=e/t,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=i,this.view.width=r,this.view.height=s,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){let e=this.near,t=e*Math.tan(.5*Qe*this.fov)/this.zoom,n=2*t,i=this.aspect*n,r=-.5*i,s=this.view;if(null!==this.view&&this.view.enabled){let e=s.fullWidth,a=s.fullHeight;r+=s.offsetX*i/e,t-=s.offsetY*n/a,i*=s.width/e,n*=s.height/a}let a=this.filmOffset;0!==a&&(r+=e*a/this.getFilmWidth()),this.projectionMatrix.makePerspective(r,r+i,t,t-n,e,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){let t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,null!==this.view&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}},Bi=-90,zi=class extends Nn{constructor(e,t,n){super(),this.type="CubeCamera",this.renderTarget=n;let i=new Li(Bi,1,e,t);i.layers=this.layers,i.up.set(0,1,0),i.lookAt(1,0,0),this.add(i);let r=new Li(Bi,1,e,t);r.layers=this.layers,r.up.set(0,1,0),r.lookAt(-1,0,0),this.add(r);let s=new Li(Bi,1,e,t);s.layers=this.layers,s.up.set(0,0,-1),s.lookAt(0,1,0),this.add(s);let a=new Li(Bi,1,e,t);a.layers=this.layers,a.up.set(0,0,1),a.lookAt(0,-1,0),this.add(a);let o=new Li(Bi,1,e,t);o.layers=this.layers,o.up.set(0,1,0),o.lookAt(0,0,1),this.add(o);let l=new Li(Bi,1,e,t);l.layers=this.layers,l.up.set(0,1,0),l.lookAt(0,0,-1),this.add(l)}update(e,t){null===this.parent&&this.updateMatrixWorld();let n=this.renderTarget,[i,r,s,a,o,l]=this.children,c=e.getRenderTarget(),h=e.toneMapping,u=e.xr.enabled;e.toneMapping=0,e.xr.enabled=!1;let d=n.texture.generateMipmaps;n.texture.generateMipmaps=!1,e.setRenderTarget(n,0),e.render(t,i),e.setRenderTarget(n,1),e.render(t,r),e.setRenderTarget(n,2),e.render(t,s),e.setRenderTarget(n,3),e.render(t,a),e.setRenderTarget(n,4),e.render(t,o),n.texture.generateMipmaps=d,e.setRenderTarget(n,5),e.render(t,l),e.setRenderTarget(c),e.toneMapping=h,e.xr.enabled=u,n.texture.needsPMREMUpdate=!0}},Ni=class extends Dt{constructor(e,t,n,i,r,s,a,o,l,c){super(e=void 0!==e?e:[],t=void 0!==t?t:ne,n,i,r,s,a,o,l,c),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}},Fi=class extends It{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(e,e,t),this.isWebGLCubeRenderTarget=!0;let n={width:e,height:e,depth:1},i=[n,n,n,n,n,n];this.texture=new Ni(i,t.mapping,t.wrapS,t.wrapT,t.magFilter,t.minFilter,t.format,t.type,t.anisotropy,t.encoding),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=void 0!==t.generateMipmaps&&t.generateMipmaps,this.texture.minFilter=void 0!==t.minFilter?t.minFilter:ue}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.encoding=t.encoding,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;let n={tEquirect:{value:null}},i="\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\tvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\n\t\t\t\t\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n\n\t\t\t\t}\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvWorldDirection = transformDirection( position, modelMatrix );\n\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t\t#include <project_vertex>\n\n\t\t\t\t}\n\t\t\t",r="\n\n\t\t\t\tuniform sampler2D tEquirect;\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\t#include <common>\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvec3 direction = normalize( vWorldDirection );\n\n\t\t\t\t\tvec2 sampleUV = equirectUv( direction );\n\n\t\t\t\t\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\n\t\t\t\t}\n\t\t\t",s=new Ti(5,5,5),a=new Ri({name:"CubemapFromEquirect",uniforms:Pi(n),vertexShader:i,fragmentShader:r,side:1,blending:0});a.uniforms.tEquirect.value=t;let o=new Ci(s,a),l=t.minFilter;return t.minFilter===pe&&(t.minFilter=ue),new zi(1,10,this).update(e,o),t.minFilter=l,o.geometry.dispose(),o.material.dispose(),this}clear(e,t,n,i){let r=e.getRenderTarget();for(let s=0;s<6;s++)e.setRenderTarget(this,s),e.clear(t,n,i);e.setRenderTarget(r)}},Ui=new Bt,ji=new Bt,Vi=new lt,Gi=class{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Bt(1,0,0),t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.isPlane=!0,this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,n,i){return this.normal.set(e,t,n),this.constant=i,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,n){let i=Ui.subVectors(n,t).cross(ji.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(i,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){let e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t.copy(this.normal).multiplyScalar(-this.distanceToPoint(e)).add(e)}intersectLine(e,t){let n=e.delta(Ui),i=this.normal.dot(n);if(0===i)return 0===this.distanceToPoint(e.start)?t.copy(e.start):null;let r=-(e.start.dot(this.normal)+this.constant)/i;return r<0||r>1?null:t.copy(n).multiplyScalar(r).add(e.start)}intersectsLine(e){let t=this.distanceToPoint(e.start),n=this.distanceToPoint(e.end);return t<0&&n>0||n<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){let n=t||Vi.getNormalMatrix(e),i=this.coplanarPoint(Ui).applyMatrix4(e),r=this.normal.applyMatrix3(n).normalize();return this.constant=-i.dot(r),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return(new this.constructor).copy(this)}},Hi=new rn,Wi=new Bt,qi=class{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Gi,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Gi,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Gi,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new Gi,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new Gi,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:new Gi;this.planes=[e,t,n,i,r,s]}set(e,t,n,i,r,s){let a=this.planes;return a[0].copy(e),a[1].copy(t),a[2].copy(n),a[3].copy(i),a[4].copy(r),a[5].copy(s),this}copy(e){let t=this.planes;for(let n=0;n<6;n++)t[n].copy(e.planes[n]);return this}setFromProjectionMatrix(e){let t=this.planes,n=e.elements,i=n[0],r=n[1],s=n[2],a=n[3],o=n[4],l=n[5],c=n[6],h=n[7],u=n[8],d=n[9],p=n[10],f=n[11],m=n[12],g=n[13],v=n[14],y=n[15];return t[0].setComponents(a-i,h-o,f-u,y-m).normalize(),t[1].setComponents(a+i,h+o,f+u,y+m).normalize(),t[2].setComponents(a+r,h+l,f+d,y+g).normalize(),t[3].setComponents(a-r,h-l,f-d,y-g).normalize(),t[4].setComponents(a-s,h-c,f-p,y-v).normalize(),t[5].setComponents(a+s,h+c,f+p,y+v).normalize(),this}intersectsObject(e){let t=e.geometry;return null===t.boundingSphere&&t.computeBoundingSphere(),Hi.copy(t.boundingSphere).applyMatrix4(e.matrixWorld),this.intersectsSphere(Hi)}intersectsSprite(e){return Hi.center.set(0,0,0),Hi.radius=.7071067811865476,Hi.applyMatrix4(e.matrixWorld),this.intersectsSphere(Hi)}intersectsSphere(e){let t=this.planes,n=e.center,i=-e.radius;for(let r=0;r<6;r++)if(t[r].distanceToPoint(n)<i)return!1;return!0}intersectsBox(e){let t=this.planes;for(let n=0;n<6;n++){let i=t[n];if(Wi.x=i.normal.x>0?e.max.x:e.min.x,Wi.y=i.normal.y>0?e.max.y:e.min.y,Wi.z=i.normal.z>0?e.max.z:e.min.z,i.distanceToPoint(Wi)<0)return!1}return!0}containsPoint(e){let t=this.planes;for(let n=0;n<6;n++)if(t[n].distanceToPoint(e)<0)return!1;return!0}clone(){return(new this.constructor).copy(this)}};function Xi(){let e=null,t=!1,n=null,i=null;function r(t,s){n(t,s),i=e.requestAnimationFrame(r)}return{start:function(){!0!==t&&null!==n&&(i=e.requestAnimationFrame(r),t=!0)},stop:function(){e.cancelAnimationFrame(i),t=!1},setAnimationLoop:function(e){n=e},setContext:function(t){e=t}}}function Yi(e,t){let n=t.isWebGL2,i=new WeakMap;return{get:function(e){return e.isInterleavedBufferAttribute&&(e=e.data),i.get(e)},remove:function(t){t.isInterleavedBufferAttribute&&(t=t.data);let n=i.get(t);n&&(e.deleteBuffer(n.buffer),i.delete(t))},update:function(t,r){if(t.isGLBufferAttribute){let e=i.get(t);return void((!e||e.version<t.version)&&i.set(t,{buffer:t.buffer,type:t.type,bytesPerElement:t.elementSize,version:t.version}))}t.isInterleavedBufferAttribute&&(t=t.data);let s=i.get(t);void 0===s?i.set(t,function(t,i){let r,s=t.array,a=t.usage,o=e.createBuffer();if(e.bindBuffer(i,o),e.bufferData(i,s,a),t.onUploadCallback(),s instanceof Float32Array)r=5126;else if(s instanceof Uint16Array)if(t.isFloat16BufferAttribute){if(!n)throw new Error("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2.");r=5131}else r=5123;else if(s instanceof Int16Array)r=5122;else if(s instanceof Uint32Array)r=5125;else if(s instanceof Int32Array)r=5124;else if(s instanceof Int8Array)r=5120;else if(s instanceof Uint8Array)r=5121;else{if(!(s instanceof Uint8ClampedArray))throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+s);r=5121}return{buffer:o,type:r,bytesPerElement:s.BYTES_PER_ELEMENT,version:t.version}}(t,r)):s.version<t.version&&(function(t,i,r){let s=i.array,a=i.updateRange;e.bindBuffer(r,t),-1===a.count?e.bufferSubData(r,0,s):(n?e.bufferSubData(r,a.offset*s.BYTES_PER_ELEMENT,s,a.offset,a.count):e.bufferSubData(r,a.offset*s.BYTES_PER_ELEMENT,s.subarray(a.offset,a.offset+a.count)),a.count=-1),i.onUploadCallback()}(s.buffer,t,r),s.version=t.version)}}}var Qi=class extends di{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;super(),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:n,heightSegments:i};let r=e/2,s=t/2,a=Math.floor(n),o=Math.floor(i),l=a+1,c=o+1,h=e/a,u=t/o,d=[],p=[],f=[],m=[];for(let g=0;g<c;g++){let e=g*u-s;for(let t=0;t<l;t++){let n=t*h-r;p.push(n,-e,0),f.push(0,0,1),m.push(t/a),m.push(1-g/o)}}for(let g=0;g<o;g++)for(let e=0;e<a;e++){let t=e+l*g,n=e+l*(g+1),i=e+1+l*(g+1),r=e+1+l*g;d.push(t,n,r),d.push(n,i,r)}this.setIndex(d),this.setAttribute("position",new ri(p,3)),this.setAttribute("normal",new ri(f,3)),this.setAttribute("uv",new ri(m,2))}static fromJSON(e){return new Qi(e.width,e.height,e.widthSegments,e.heightSegments)}},Ki={alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n#endif",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",alphatest_fragment:"#ifdef USE_ALPHATEST\n\tif ( diffuseColor.a < alphaTest ) discard;\n#endif",alphatest_pars_fragment:"#ifdef USE_ALPHATEST\n\tuniform float alphaTest;\n#endif",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );\n\t#endif\n#endif",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",begin_vertex:"vec3 transformed = vec3( position );",beginnormal_vertex:"vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n\tvec3 objectTangent = vec3( tangent.xyz );\n#endif",bsdfs:"vec3 BRDF_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n}\nfloat F_Schlick( const in float f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n}\nvec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {\n    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );\n    float x2 = x * x;\n    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );\n    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );\n}\nfloat V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\nvec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float roughness ) {\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( f0, f90, dotVH );\n\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\tfloat D = D_GGX( alpha, dotNH );\n\treturn F * ( V * D );\n}\n#ifdef USE_IRIDESCENCE\n\tvec3 BRDF_GGX_Iridescence( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float iridescence, const in vec3 iridescenceFresnel, const in float roughness ) {\n\t\tfloat alpha = pow2( roughness );\n\t\tvec3 halfDir = normalize( lightDir + viewDir );\n\t\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\t\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\t\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\t\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\t\tvec3 F = mix( F_Schlick( f0, f90, dotVH ), iridescenceFresnel, iridescence );\n\t\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\t\tfloat D = D_GGX( alpha, dotNH );\n\t\treturn F * ( V * D );\n\t}\n#endif\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\nfloat G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, 1.0, dotVH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n}\n#if defined( USE_SHEEN )\nfloat D_Charlie( float roughness, float dotNH ) {\n\tfloat alpha = pow2( roughness );\n\tfloat invAlpha = 1.0 / alpha;\n\tfloat cos2h = dotNH * dotNH;\n\tfloat sin2h = max( 1.0 - cos2h, 0.0078125 );\n\treturn ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );\n}\nfloat V_Neubelt( float dotNV, float dotNL ) {\n\treturn saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );\n}\nvec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat D = D_Charlie( sheenRoughness, dotNH );\n\tfloat V = V_Neubelt( dotNV, dotNL );\n\treturn sheenColor * ( D * V );\n}\n#endif",iridescence_fragment:"#ifdef USE_IRIDESCENCE\n\tconst mat3 XYZ_TO_REC709 = mat3(\n\t\t 3.2404542, -0.9692660,  0.0556434,\n\t\t-1.5371385,  1.8760108, -0.2040259,\n\t\t-0.4985314,  0.0415560,  1.0572252\n\t);\n\tvec3 Fresnel0ToIor( vec3 fresnel0 ) {\n\t\tvec3 sqrtF0 = sqrt( fresnel0 );\n\t\treturn ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );\n\t}\n\tvec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {\n\t\treturn pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );\n\t}\n\tfloat IorToFresnel0( float transmittedIor, float incidentIor ) {\n\t\treturn pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));\n\t}\n\tvec3 evalSensitivity( float OPD, vec3 shift ) {\n\t\tfloat phase = 2.0 * PI * OPD * 1.0e-9;\n\t\tvec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );\n\t\tvec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );\n\t\tvec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );\n\t\tvec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );\n\t\txyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );\n\t\txyz /= 1.0685e-7;\n\t\tvec3 rgb = XYZ_TO_REC709 * xyz;\n\t\treturn rgb;\n\t}\n\tvec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {\n\t\tvec3 I;\n\t\tfloat iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );\n\t\tfloat sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );\n\t\tfloat cosTheta2Sq = 1.0 - sinTheta2Sq;\n\t\tif ( cosTheta2Sq < 0.0 ) {\n\t\t\t return vec3( 1.0 );\n\t\t}\n\t\tfloat cosTheta2 = sqrt( cosTheta2Sq );\n\t\tfloat R0 = IorToFresnel0( iridescenceIOR, outsideIOR );\n\t\tfloat R12 = F_Schlick( R0, 1.0, cosTheta1 );\n\t\tfloat R21 = R12;\n\t\tfloat T121 = 1.0 - R12;\n\t\tfloat phi12 = 0.0;\n\t\tif ( iridescenceIOR < outsideIOR ) phi12 = PI;\n\t\tfloat phi21 = PI - phi12;\n\t\tvec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );\t\tvec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );\n\t\tvec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );\n\t\tvec3 phi23 = vec3( 0.0 );\n\t\tif ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;\n\t\tif ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;\n\t\tif ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;\n\t\tfloat OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;\n\t\tvec3 phi = vec3( phi21 ) + phi23;\n\t\tvec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );\n\t\tvec3 r123 = sqrt( R123 );\n\t\tvec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );\n\t\tvec3 C0 = R12 + Rs;\n\t\tI = C0;\n\t\tvec3 Cm = Rs - T121;\n\t\tfor ( int m = 1; m <= 2; ++ m ) {\n\t\t\tCm *= r123;\n\t\t\tvec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );\n\t\t\tI += Cm * Sm;\n\t\t}\n\t\treturn max( I, vec3( 0.0 ) );\n\t}\n#endif",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {\n\t\tvec3 vSigmaX = dFdx( surf_pos.xyz );\n\t\tvec3 vSigmaY = dFdy( surf_pos.xyz );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 ) * faceDirection;\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\tplane = clippingPlanes[ i ];\n\t\tif ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;\n\t}\n\t#pragma unroll_loop_end\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\tbool clipped = true;\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\tif ( clipped ) discard;\n\t#endif\n#endif",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n#endif",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvClipPosition = - mvPosition.xyz;\n#endif",color_fragment:"#if defined( USE_COLOR_ALPHA )\n\tdiffuseColor *= vColor;\n#elif defined( USE_COLOR )\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR )\n\tvarying vec3 vColor;\n#endif",color_pars_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvarying vec3 vColor;\n#endif",color_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvColor = vec4( 1.0 );\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvColor = vec3( 1.0 );\n#endif\n#ifdef USE_COLOR\n\tvColor *= color;\n#endif\n#ifdef USE_INSTANCING_COLOR\n\tvColor.xyz *= instanceColor.xyz;\n#endif",common:"#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement( a ) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nvec3 pow2( const in vec3 x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }\nfloat average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract( sin( sn ) * c );\n}\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent = max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal;\n#endif\n};\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nfloat luminance( const in vec3 rgb ) {\n\tconst vec3 weights = vec3( 0.2126729, 0.7151522, 0.0721750 );\n\treturn dot( weights, rgb );\n}\nbool isPerspectiveMatrix( mat4 m ) {\n\treturn m[ 2 ][ 3 ] == - 1.0;\n}\nvec2 equirectUv( in vec3 dir ) {\n\tfloat u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;\n\tfloat v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\treturn vec2( u, v );\n}",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n\t#define cubeUV_minMipLevel 4.0\n\t#define cubeUV_minTileSize 16.0\n\tfloat getFace( vec3 direction ) {\n\t\tvec3 absDirection = abs( direction );\n\t\tfloat face = - 1.0;\n\t\tif ( absDirection.x > absDirection.z ) {\n\t\t\tif ( absDirection.x > absDirection.y )\n\t\t\t\tface = direction.x > 0.0 ? 0.0 : 3.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t} else {\n\t\t\tif ( absDirection.z > absDirection.y )\n\t\t\t\tface = direction.z > 0.0 ? 2.0 : 5.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t}\n\t\treturn face;\n\t}\n\tvec2 getUV( vec3 direction, float face ) {\n\t\tvec2 uv;\n\t\tif ( face == 0.0 ) {\n\t\t\tuv = vec2( direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 1.0 ) {\n\t\t\tuv = vec2( - direction.x, - direction.z ) / abs( direction.y );\n\t\t} else if ( face == 2.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.y ) / abs( direction.z );\n\t\t} else if ( face == 3.0 ) {\n\t\t\tuv = vec2( - direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 4.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.z ) / abs( direction.y );\n\t\t} else {\n\t\t\tuv = vec2( direction.x, direction.y ) / abs( direction.z );\n\t\t}\n\t\treturn 0.5 * ( uv + 1.0 );\n\t}\n\tvec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {\n\t\tfloat face = getFace( direction );\n\t\tfloat filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );\n\t\tmipInt = max( mipInt, cubeUV_minMipLevel );\n\t\tfloat faceSize = exp2( mipInt );\n\t\thighp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;\n\t\tif ( face > 2.0 ) {\n\t\t\tuv.y += faceSize;\n\t\t\tface -= 3.0;\n\t\t}\n\t\tuv.x += face * faceSize;\n\t\tuv.x += filterInt * 3.0 * cubeUV_minTileSize;\n\t\tuv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );\n\t\tuv.x *= CUBEUV_TEXEL_WIDTH;\n\t\tuv.y *= CUBEUV_TEXEL_HEIGHT;\n\t\t#ifdef texture2DGradEXT\n\t\t\treturn texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;\n\t\t#else\n\t\t\treturn texture2D( envMap, uv ).rgb;\n\t\t#endif\n\t}\n\t#define cubeUV_r0 1.0\n\t#define cubeUV_v0 0.339\n\t#define cubeUV_m0 - 2.0\n\t#define cubeUV_r1 0.8\n\t#define cubeUV_v1 0.276\n\t#define cubeUV_m1 - 1.0\n\t#define cubeUV_r4 0.4\n\t#define cubeUV_v4 0.046\n\t#define cubeUV_m4 2.0\n\t#define cubeUV_r5 0.305\n\t#define cubeUV_v5 0.016\n\t#define cubeUV_m5 3.0\n\t#define cubeUV_r6 0.21\n\t#define cubeUV_v6 0.0038\n\t#define cubeUV_m6 4.0\n\tfloat roughnessToMip( float roughness ) {\n\t\tfloat mip = 0.0;\n\t\tif ( roughness >= cubeUV_r1 ) {\n\t\t\tmip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;\n\t\t} else if ( roughness >= cubeUV_r4 ) {\n\t\t\tmip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;\n\t\t} else if ( roughness >= cubeUV_r5 ) {\n\t\t\tmip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;\n\t\t} else if ( roughness >= cubeUV_r6 ) {\n\t\t\tmip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;\n\t\t} else {\n\t\t\tmip = - 2.0 * log2( 1.16 * roughness );\t\t}\n\t\treturn mip;\n\t}\n\tvec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {\n\t\tfloat mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );\n\t\tfloat mipF = fract( mip );\n\t\tfloat mipInt = floor( mip );\n\t\tvec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );\n\t\tif ( mipF == 0.0 ) {\n\t\t\treturn vec4( color0, 1.0 );\n\t\t} else {\n\t\t\tvec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );\n\t\t\treturn vec4( mix( color0, color1, mipF ), 1.0 );\n\t\t}\n\t}\n#endif",defaultnormal_vertex:"vec3 transformedNormal = objectNormal;\n#ifdef USE_INSTANCING\n\tmat3 m = mat3( instanceMatrix );\n\ttransformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );\n\ttransformedNormal = m * transformedNormal;\n#endif\ntransformedNormal = normalMatrix * transformedNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n\tvec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#ifdef FLIP_SIDED\n\t\ttransformedTangent = - transformedTangent;\n\t#endif\n#endif",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );\n#endif",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif",encodings_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",encodings_pars_fragment:"vec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}",envmap_fragment:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvec3 cameraToFrag;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif",envmap_common_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float envMapIntensity;\n\tuniform float flipEnvMap;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\t\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float reflectivity;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\tvarying vec3 vWorldPosition;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\t\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif",envmap_physical_pars_fragment:"#if defined( USE_ENVMAP )\n\tvec3 getIBLIrradiance( const in vec3 normal ) {\n\t\t#if defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );\n\t\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n\tvec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {\n\t\t#if defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 reflectVec = reflect( - viewDir, normal );\n\t\t\treflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n\t\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );\n\t\t\treturn envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif",fog_vertex:"#ifdef USE_FOG\n\tvFogDepth = - mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n\tvarying float vFogDepth;\n#endif",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, vFogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float vFogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",gradientmap_pars_fragment:"#ifdef USE_GRADIENTMAP\n\tuniform sampler2D gradientMap;\n#endif\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\tfloat dotNL = dot( normal, lightDirection );\n\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t#ifdef USE_GRADIENTMAP\n\t\treturn vec3( texture2D( gradientMap, coord ).r );\n\t#else\n\t\tvec2 fw = fwidth( coord ) * 0.5;\n\t\treturn mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );\n\t#endif\n}",lightmap_fragment:"#ifdef USE_LIGHTMAP\n\tvec4 lightMapTexel = texture2D( lightMap, vUv2 );\n\tvec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n\treflectedLight.indirectDiffuse += lightMapIrradiance;\n#endif",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_fragment:"LambertMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularStrength = specularStrength;",lights_lambert_pars_fragment:"varying vec3 vViewPosition;\nstruct LambertMaterial {\n\tvec3 diffuseColor;\n\tfloat specularStrength;\n};\nvoid RE_Direct_Lambert( const in IncidentLight directLight, const in GeometricContext geometry, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in GeometricContext geometry, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Lambert\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Lambert",lights_pars_begin:"uniform bool receiveShadow;\nuniform vec3 ambientLightColor;\nuniform vec3 lightProbe[ 9 ];\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\treturn result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {\n\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\treturn irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\treturn irradiance;\n}\nfloat getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n\t#if defined ( PHYSICALLY_CORRECT_LIGHTS )\n\t\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\t\tif ( cutoffDistance > 0.0 ) {\n\t\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t\t}\n\t\treturn distanceFalloff;\n\t#else\n\t\tif ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {\n\t\t\treturn pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );\n\t\t}\n\t\treturn 1.0;\n\t#endif\n}\nfloat getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {\n\treturn smoothstep( coneCosine, penumbraCosine, angleCosine );\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalLightInfo( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tlight.color = directionalLight.color;\n\t\tlight.direction = directionalLight.direction;\n\t\tlight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointLightInfo( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tlight.color = pointLight.color;\n\t\tlight.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );\n\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotLightInfo( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat angleCos = dot( light.direction, spotLight.direction );\n\t\tfloat spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\tif ( spotAttenuation > 0.0 ) {\n\t\t\tfloat lightDistance = length( lVector );\n\t\t\tlight.color = spotLight.color * spotAttenuation;\n\t\t\tlight.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t\t} else {\n\t\t\tlight.color = vec3( 0.0 );\n\t\t\tlight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {\n\t\tfloat dotNL = dot( normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\treturn irradiance;\n\t}\n#endif",lights_toon_fragment:"ToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;",lights_toon_pars_fragment:"varying vec3 vViewPosition;\nstruct ToonMaterial {\n\tvec3 diffuseColor;\n};\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Toon\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_phong_pars_fragment:"varying vec3 vViewPosition;\nstruct BlinnPhongMaterial {\n\tvec3 diffuseColor;\n\tvec3 specularColor;\n\tfloat specularShininess;\n\tfloat specularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nvec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\nmaterial.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;\nmaterial.roughness = min( material.roughness, 1.0 );\n#ifdef IOR\n\tmaterial.ior = ior;\n\t#ifdef SPECULAR\n\t\tfloat specularIntensityFactor = specularIntensity;\n\t\tvec3 specularColorFactor = specularColor;\n\t\t#ifdef USE_SPECULARINTENSITYMAP\n\t\t\tspecularIntensityFactor *= texture2D( specularIntensityMap, vUv ).a;\n\t\t#endif\n\t\t#ifdef USE_SPECULARCOLORMAP\n\t\t\tspecularColorFactor *= texture2D( specularColorMap, vUv ).rgb;\n\t\t#endif\n\t\tmaterial.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );\n\t#else\n\t\tfloat specularIntensityFactor = 1.0;\n\t\tvec3 specularColorFactor = vec3( 1.0 );\n\t\tmaterial.specularF90 = 1.0;\n\t#endif\n\tmaterial.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );\n\tmaterial.specularF90 = 1.0;\n#endif\n#ifdef USE_CLEARCOAT\n\tmaterial.clearcoat = clearcoat;\n\tmaterial.clearcoatRoughness = clearcoatRoughness;\n\tmaterial.clearcoatF0 = vec3( 0.04 );\n\tmaterial.clearcoatF90 = 1.0;\n\t#ifdef USE_CLEARCOATMAP\n\t\tmaterial.clearcoat *= texture2D( clearcoatMap, vUv ).x;\n\t#endif\n\t#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\t\tmaterial.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;\n\t#endif\n\tmaterial.clearcoat = saturate( material.clearcoat );\tmaterial.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );\n\tmaterial.clearcoatRoughness += geometryRoughness;\n\tmaterial.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n#endif\n#ifdef USE_IRIDESCENCE\n\tmaterial.iridescence = iridescence;\n\tmaterial.iridescenceIOR = iridescenceIOR;\n\t#ifdef USE_IRIDESCENCEMAP\n\t\tmaterial.iridescence *= texture2D( iridescenceMap, vUv ).r;\n\t#endif\n\t#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\t\tmaterial.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vUv ).g + iridescenceThicknessMinimum;\n\t#else\n\t\tmaterial.iridescenceThickness = iridescenceThicknessMaximum;\n\t#endif\n#endif\n#ifdef USE_SHEEN\n\tmaterial.sheenColor = sheenColor;\n\t#ifdef USE_SHEENCOLORMAP\n\t\tmaterial.sheenColor *= texture2D( sheenColorMap, vUv ).rgb;\n\t#endif\n\tmaterial.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );\n\t#ifdef USE_SHEENROUGHNESSMAP\n\t\tmaterial.sheenRoughness *= texture2D( sheenRoughnessMap, vUv ).a;\n\t#endif\n#endif",lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3 diffuseColor;\n\tfloat roughness;\n\tvec3 specularColor;\n\tfloat specularF90;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat clearcoat;\n\t\tfloat clearcoatRoughness;\n\t\tvec3 clearcoatF0;\n\t\tfloat clearcoatF90;\n\t#endif\n\t#ifdef USE_IRIDESCENCE\n\t\tfloat iridescence;\n\t\tfloat iridescenceIOR;\n\t\tfloat iridescenceThickness;\n\t\tvec3 iridescenceFresnel;\n\t\tvec3 iridescenceF0;\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tvec3 sheenColor;\n\t\tfloat sheenRoughness;\n\t#endif\n\t#ifdef IOR\n\t\tfloat ior;\n\t#endif\n\t#ifdef USE_TRANSMISSION\n\t\tfloat transmission;\n\t\tfloat transmissionAlpha;\n\t\tfloat thickness;\n\t\tfloat attenuationDistance;\n\t\tvec3 attenuationColor;\n\t#endif\n};\nvec3 clearcoatSpecular = vec3( 0.0 );\nvec3 sheenSpecular = vec3( 0.0 );\nfloat IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat r2 = roughness * roughness;\n\tfloat a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;\n\tfloat b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;\n\tfloat DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );\n\treturn saturate( DG * RECIPROCAL_PI );\n}\nvec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\tvec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;\n\treturn fab;\n}\nvec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\treturn specularColor * fab.x + specularF90 * fab.y;\n}\n#ifdef USE_IRIDESCENCE\nvoid computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#else\nvoid computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#endif\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\t#ifdef USE_IRIDESCENCE\n\t\tvec3 Fr = mix( specularColor, iridescenceF0, iridescence );\n\t#else\n\t\tvec3 Fr = specularColor;\n\t#endif\n\tvec3 FssEss = Fr * fab.x + specularF90 * fab.y;\n\tfloat Ess = fab.x + fab.y;\n\tfloat Ems = 1.0 - Ess;\n\tvec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometry.normal;\n\t\tvec3 viewDir = geometry.viewDir;\n\t\tvec3 position = geometry.position;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.roughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNLcc = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );\n\t\tvec3 ccIrradiance = dotNLcc * directLight.color;\n\t\tclearcoatSpecular += ccIrradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.clearcoatNormal, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecular += irradiance * BRDF_Sheen( directLight.direction, geometry.viewDir, geometry.normal, material.sheenColor, material.sheenRoughness );\n\t#endif\n\t#ifdef USE_IRIDESCENCE\n\t\treflectedLight.directSpecular += irradiance * BRDF_GGX_Iridescence( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness );\n\t#else\n\t\treflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.roughness );\n\t#endif\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatSpecular += clearcoatRadiance * EnvironmentBRDF( geometry.clearcoatNormal, geometry.viewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecular += irradiance * material.sheenColor * IBLSheenBRDF( geometry.normal, geometry.viewDir, material.sheenRoughness );\n\t#endif\n\tvec3 singleScattering = vec3( 0.0 );\n\tvec3 multiScattering = vec3( 0.0 );\n\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\t#ifdef USE_IRIDESCENCE\n\t\tcomputeMultiscatteringIridescence( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );\n\t#else\n\t\tcomputeMultiscattering( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );\n\t#endif\n\tvec3 totalScattering = singleScattering + multiScattering;\n\tvec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );\n\treflectedLight.indirectSpecular += radiance * singleScattering;\n\treflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",lights_fragment_begin:"\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\n#ifdef USE_CLEARCOAT\n\tgeometry.clearcoatNormal = clearcoatNormal;\n#endif\n#ifdef USE_IRIDESCENCE\n\tfloat dotNVi = saturate( dot( normal, geometry.viewDir ) );\n\tif ( material.iridescenceThickness == 0.0 ) {\n\t\tmaterial.iridescence = 0.0;\n\t} else {\n\t\tmaterial.iridescence = saturate( material.iridescence );\n\t}\n\tif ( material.iridescence > 0.0 ) {\n\t\tmaterial.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );\n\t\tmaterial.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );\n\t}\n#endif\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointLightInfo( pointLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tpointLightShadow = pointLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\tvec4 spotColor;\n\tvec3 spotLightCoord;\n\tbool inSpotLightMap;\n\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotLightInfo( spotLight, geometry, directLight );\n\t\t#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )\n\t\t#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX\n\t\t#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\t#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS\n\t\t#else\n\t\t#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )\n\t\t#endif\n\t\t#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )\n\t\t\tspotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;\n\t\t\tinSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );\n\t\t\tspotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );\n\t\t\tdirectLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;\n\t\t#endif\n\t\t#undef SPOT_LIGHT_MAP_INDEX\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tspotLightShadow = spotLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalLightInfo( directionalLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectionalLightShadow = directionalLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 iblIrradiance = vec3( 0.0 );\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\tirradiance += getLightProbeIrradiance( lightProbe, geometry.normal );\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n#endif",lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vUv2 );\n\t\tvec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tiblIrradiance += getIBLIrradiance( geometry.normal );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\tradiance += getIBLRadiance( geometry.viewDir, geometry.normal, material.roughness );\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatRadiance += getIBLRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness );\n\t#endif\n#endif",lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );\n#endif",logdepthbuf_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tgl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t\tvarying float vIsPerspective;\n\t#else\n\t\tuniform float logDepthBufFC;\n\t#endif\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n\t#else\n\t\tif ( isPerspectiveMatrix( projectionMatrix ) ) {\n\t\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n\t\t\tgl_Position.z *= gl_Position.w;\n\t\t}\n\t#endif\n#endif",map_fragment:"#ifdef USE_MAP\n\tvec4 sampledDiffuseColor = texture2D( map, vUv );\n\t#ifdef DECODE_VIDEO_TEXTURE\n\t\tsampledDiffuseColor = vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );\n\t#endif\n\tdiffuseColor *= sampledDiffuseColor;\n#endif",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif",map_particle_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n#endif\n#ifdef USE_MAP\n\tdiffuseColor *= texture2D( map, uv );\n#endif\n#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\n#endif",map_particle_pars_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tuniform mat3 uvTransform;\n#endif\n#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphcolor_vertex:"#if defined( USE_MORPHCOLORS ) && defined( MORPHTARGETS_TEXTURE )\n\tvColor *= morphTargetBaseInfluence;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t#if defined( USE_COLOR_ALPHA )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];\n\t\t#elif defined( USE_COLOR )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];\n\t\t#endif\n\t}\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal *= morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];\n\t\t}\n\t#else\n\t\tobjectNormal += morphNormal0 * morphTargetInfluences[ 0 ];\n\t\tobjectNormal += morphNormal1 * morphTargetInfluences[ 1 ];\n\t\tobjectNormal += morphNormal2 * morphTargetInfluences[ 2 ];\n\t\tobjectNormal += morphNormal3 * morphTargetInfluences[ 3 ];\n\t#endif\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\tuniform float morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tuniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];\n\t\tuniform sampler2DArray morphTargetsTexture;\n\t\tuniform ivec2 morphTargetsTextureSize;\n\t\tvec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {\n\t\t\tint texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;\n\t\t\tint y = texelIndex / morphTargetsTextureSize.x;\n\t\t\tint x = texelIndex - y * morphTargetsTextureSize.x;\n\t\t\tivec3 morphUV = ivec3( x, y, morphTargetIndex );\n\t\t\treturn texelFetch( morphTargetsTexture, morphUV, 0 );\n\t\t}\n\t#else\n\t\t#ifndef USE_MORPHNORMALS\n\t\t\tuniform float morphTargetInfluences[ 8 ];\n\t\t#else\n\t\t\tuniform float morphTargetInfluences[ 4 ];\n\t\t#endif\n\t#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed *= morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];\n\t\t}\n\t#else\n\t\ttransformed += morphTarget0 * morphTargetInfluences[ 0 ];\n\t\ttransformed += morphTarget1 * morphTargetInfluences[ 1 ];\n\t\ttransformed += morphTarget2 * morphTargetInfluences[ 2 ];\n\t\ttransformed += morphTarget3 * morphTargetInfluences[ 3 ];\n\t\t#ifndef USE_MORPHNORMALS\n\t\t\ttransformed += morphTarget4 * morphTargetInfluences[ 4 ];\n\t\t\ttransformed += morphTarget5 * morphTargetInfluences[ 5 ];\n\t\t\ttransformed += morphTarget6 * morphTargetInfluences[ 6 ];\n\t\t\ttransformed += morphTarget7 * morphTargetInfluences[ 7 ];\n\t\t#endif\n\t#endif\n#endif",normal_fragment_begin:"float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;\n#ifdef FLAT_SHADED\n\tvec3 fdx = dFdx( vViewPosition );\n\tvec3 fdy = dFdy( vViewPosition );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\t#ifdef USE_TANGENT\n\t\tvec3 tangent = normalize( vTangent );\n\t\tvec3 bitangent = normalize( vBitangent );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\ttangent = tangent * faceDirection;\n\t\t\tbitangent = bitangent * faceDirection;\n\t\t#endif\n\t\t#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )\n\t\t\tmat3 vTBN = mat3( tangent, bitangent, normal );\n\t\t#endif\n\t#endif\n#endif\nvec3 geometryNormal = normal;",normal_fragment_maps:"#ifdef OBJECTSPACE_NORMALMAP\n\tnormal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t#ifdef FLIP_SIDED\n\t\tnormal = - normal;\n\t#endif\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\tnormal = normalize( normalMatrix * normal );\n#elif defined( TANGENTSPACE_NORMALMAP )\n\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\tmapN.xy *= normalScale;\n\t#ifdef USE_TANGENT\n\t\tnormal = normalize( vTBN * mapN );\n\t#else\n\t\tnormal = perturbNormal2Arb( - vViewPosition, normal, mapN, faceDirection );\n\t#endif\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );\n#endif",normal_pars_fragment:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_pars_vertex:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_vertex:"#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n#endif\n#ifdef OBJECTSPACE_NORMALMAP\n\tuniform mat3 normalMatrix;\n#endif\n#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN, float faceDirection ) {\n\t\tvec3 q0 = dFdx( eye_pos.xyz );\n\t\tvec3 q1 = dFdy( eye_pos.xyz );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\t\tvec3 N = surf_norm;\n\t\tvec3 q1perp = cross( q1, N );\n\t\tvec3 q0perp = cross( N, q0 );\n\t\tvec3 T = q1perp * st0.x + q0perp * st1.x;\n\t\tvec3 B = q1perp * st0.y + q0perp * st1.y;\n\t\tfloat det = max( dot( T, T ), dot( B, B ) );\n\t\tfloat scale = ( det == 0.0 ) ? 0.0 : faceDirection * inversesqrt( det );\n\t\treturn normalize( T * ( mapN.x * scale ) + B * ( mapN.y * scale ) + N * mapN.z );\n\t}\n#endif",clearcoat_normal_fragment_begin:"#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal = geometryNormal;\n#endif",clearcoat_normal_fragment_maps:"#ifdef USE_CLEARCOAT_NORMALMAP\n\tvec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;\n\tclearcoatMapN.xy *= clearcoatNormalScale;\n\t#ifdef USE_TANGENT\n\t\tclearcoatNormal = normalize( vTBN * clearcoatMapN );\n\t#else\n\t\tclearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN, faceDirection );\n\t#endif\n#endif",clearcoat_pars_fragment:"#ifdef USE_CLEARCOATMAP\n\tuniform sampler2D clearcoatMap;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform sampler2D clearcoatRoughnessMap;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n#endif",iridescence_pars_fragment:"#ifdef USE_IRIDESCENCEMAP\n\tuniform sampler2D iridescenceMap;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tuniform sampler2D iridescenceThicknessMap;\n#endif",output_fragment:"#ifdef OPAQUE\ndiffuseColor.a = 1.0;\n#endif\n#ifdef USE_TRANSMISSION\ndiffuseColor.a *= material.transmissionAlpha + 0.1;\n#endif\ngl_FragColor = vec4( outgoingLight, diffuseColor.a );",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nvec2 packDepthToRG( in highp float v ) {\n\treturn packDepthToRGBA( v ).yx;\n}\nfloat unpackRGToDepth( const in highp vec2 v ) {\n\treturn unpackRGBAToDepth( vec4( v.xy, 0.0, 0.0 ) );\n}\nvec4 pack2HalfToRGBA( vec2 v ) {\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );\n}\nvec2 unpackRGBATo2Half( vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\n\treturn linearClipZ * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * invClipZ - far );\n}",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif",project_vertex:"vec4 mvPosition = vec4( transformed, 1.0 );\n#ifdef USE_INSTANCING\n\tmvPosition = instanceMatrix * mvPosition;\n#endif\nmvPosition = modelViewMatrix * mvPosition;\ngl_Position = projectionMatrix * mvPosition;",dithering_fragment:"#ifdef DITHERING\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",dithering_pars_fragment:"#ifdef DITHERING\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\n\troughnessFactor *= texelRoughness.g;\n#endif",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#if NUM_SPOT_LIGHT_COORDS > 0\n  varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];\n#endif\n#if NUM_SPOT_LIGHT_MAPS > 0\n  uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];\n#endif\n#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\t\treturn unpackRGBATo2Half( texture2D( shadow, uv ) );\n\t}\n\tfloat VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\t\tfloat occlusion = 1.0;\n\t\tvec2 distribution = texture2DDistribution( shadow, uv );\n\t\tfloat hard_shadow = step( compare , distribution.x );\n\t\tif (hard_shadow != 1.0 ) {\n\t\t\tfloat distance = compare - distribution.x ;\n\t\t\tfloat variance = max( 0.00000, distribution.y * distribution.y );\n\t\t\tfloat softness_probability = variance / (variance + distance * distance );\t\t\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );\t\t\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\t\t}\n\t\treturn occlusion;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;\n\t\tbool frustumTest = inFrustum && shadowCoord.z <= 1.0;\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx = texelSize.x;\n\t\t\tfloat dy = texelSize.y;\n\t\t\tvec2 uv = shadowCoord.xy;\n\t\t\tvec2 f = fract( uv * shadowMapSize + 0.5 );\n\t\t\tuv -= f * texelSize;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, uv, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t f.y )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_VSM )\n\t\t\tshadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\tdp += shadowBias;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif",shadowmap_pars_vertex:"#if NUM_SPOT_LIGHT_COORDS > 0\n  uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];\n  varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];\n#endif\n#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n#endif",shadowmap_vertex:"#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )\n\tvec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\tvec4 shadowWorldPosition;\n#endif\n#if defined( USE_SHADOWMAP )\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );\n\t\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );\n\t\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if NUM_SPOT_LIGHT_COORDS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition;\n\t\t#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\t\tshadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;\n\t\t#endif\n\t\tvSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n#endif",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tdirectionalLight = directionalLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tspotLight = spotLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tpointLight = pointLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#endif\n\treturn shadow;\n}",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\tuniform highp sampler2D boneTexture;\n\tuniform int boneTextureSize;\n\tmat4 getBoneMatrix( const in float i ) {\n\t\tfloat j = i * 4.0;\n\t\tfloat x = mod( j, float( boneTextureSize ) );\n\t\tfloat y = floor( j / float( boneTextureSize ) );\n\t\tfloat dx = 1.0 / float( boneTextureSize );\n\t\tfloat dy = 1.0 / float( boneTextureSize );\n\t\ty = dy * ( y + 0.5 );\n\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\treturn bone;\n\t}\n#endif",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\t#ifdef USE_TANGENT\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#endif\n#endif",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",tonemapping_pars_fragment:"#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn toneMappingExposure * color;\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 RRTAndODTFit( vec3 v ) {\n\tvec3 a = v * ( v + 0.0245786 ) - 0.000090537;\n\tvec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;\n\treturn a / b;\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tconst mat3 ACESInputMat = mat3(\n\t\tvec3( 0.59719, 0.07600, 0.02840 ),\t\tvec3( 0.35458, 0.90834, 0.13383 ),\n\t\tvec3( 0.04823, 0.01566, 0.83777 )\n\t);\n\tconst mat3 ACESOutputMat = mat3(\n\t\tvec3(  1.60475, -0.10208, -0.00327 ),\t\tvec3( -0.53108,  1.10813, -0.07276 ),\n\t\tvec3( -0.07367, -0.00605,  1.07602 )\n\t);\n\tcolor *= toneMappingExposure / 0.6;\n\tcolor = ACESInputMat * color;\n\tcolor = RRTAndODTFit( color );\n\tcolor = ACESOutputMat * color;\n\treturn saturate( color );\n}\nvec3 CustomToneMapping( vec3 color ) { return color; }",transmission_fragment:"#ifdef USE_TRANSMISSION\n\tmaterial.transmission = transmission;\n\tmaterial.transmissionAlpha = 1.0;\n\tmaterial.thickness = thickness;\n\tmaterial.attenuationDistance = attenuationDistance;\n\tmaterial.attenuationColor = attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tmaterial.transmission *= texture2D( transmissionMap, vUv ).r;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tmaterial.thickness *= texture2D( thicknessMap, vUv ).g;\n\t#endif\n\tvec3 pos = vWorldPosition;\n\tvec3 v = normalize( cameraPosition - pos );\n\tvec3 n = inverseTransformDirection( normal, viewMatrix );\n\tvec4 transmission = getIBLVolumeRefraction(\n\t\tn, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,\n\t\tpos, modelMatrix, viewMatrix, projectionMatrix, material.ior, material.thickness,\n\t\tmaterial.attenuationColor, material.attenuationDistance );\n\tmaterial.transmissionAlpha = mix( material.transmissionAlpha, transmission.a, material.transmission );\n\ttotalDiffuse = mix( totalDiffuse, transmission.rgb, material.transmission );\n#endif",transmission_pars_fragment:"#ifdef USE_TRANSMISSION\n\tuniform float transmission;\n\tuniform float thickness;\n\tuniform float attenuationDistance;\n\tuniform vec3 attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tuniform sampler2D transmissionMap;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tuniform sampler2D thicknessMap;\n\t#endif\n\tuniform vec2 transmissionSamplerSize;\n\tuniform sampler2D transmissionSamplerMap;\n\tuniform mat4 modelMatrix;\n\tuniform mat4 projectionMatrix;\n\tvarying vec3 vWorldPosition;\n\tvec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {\n\t\tvec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );\n\t\tvec3 modelScale;\n\t\tmodelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );\n\t\tmodelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );\n\t\tmodelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );\n\t\treturn normalize( refractionVector ) * thickness * modelScale;\n\t}\n\tfloat applyIorToRoughness( const in float roughness, const in float ior ) {\n\t\treturn roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );\n\t}\n\tvec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {\n\t\tfloat framebufferLod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );\n\t\t#ifdef texture2DLodEXT\n\t\t\treturn texture2DLodEXT( transmissionSamplerMap, fragCoord.xy, framebufferLod );\n\t\t#else\n\t\t\treturn texture2D( transmissionSamplerMap, fragCoord.xy, framebufferLod );\n\t\t#endif\n\t}\n\tvec3 applyVolumeAttenuation( const in vec3 radiance, const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tif ( isinf( attenuationDistance ) ) {\n\t\t\treturn radiance;\n\t\t} else {\n\t\t\tvec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;\n\t\t\tvec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );\t\t\treturn transmittance * radiance;\n\t\t}\n\t}\n\tvec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,\n\t\tconst in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,\n\t\tconst in mat4 viewMatrix, const in mat4 projMatrix, const in float ior, const in float thickness,\n\t\tconst in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tvec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );\n\t\tvec3 refractedRayExit = position + transmissionRay;\n\t\tvec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );\n\t\tvec2 refractionCoords = ndcPos.xy / ndcPos.w;\n\t\trefractionCoords += 1.0;\n\t\trefractionCoords /= 2.0;\n\t\tvec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );\n\t\tvec3 attenuatedColor = applyVolumeAttenuation( transmittedLight.rgb, length( transmissionRay ), attenuationColor, attenuationDistance );\n\t\tvec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );\n\t\treturn vec4( ( 1.0 - F ) * attenuatedColor * diffuseColor, transmittedLight.a );\n\t}\n#endif",uv_pars_fragment:"#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )\n\tvarying vec2 vUv;\n#endif",uv_pars_vertex:"#ifdef USE_UV\n\t#ifdef UVS_VERTEX_ONLY\n\t\tvec2 vUv;\n\t#else\n\t\tvarying vec2 vUv;\n\t#endif\n\tuniform mat3 uvTransform;\n#endif",uv_vertex:"#ifdef USE_UV\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n#endif",uv2_pars_fragment:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvarying vec2 vUv2;\n#endif",uv2_pars_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tattribute vec2 uv2;\n\tvarying vec2 vUv2;\n\tuniform mat3 uv2Transform;\n#endif",uv2_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0\n\tvec4 worldPosition = vec4( transformed, 1.0 );\n\t#ifdef USE_INSTANCING\n\t\tworldPosition = instanceMatrix * worldPosition;\n\t#endif\n\tworldPosition = modelMatrix * worldPosition;\n#endif",background_vert:"varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",background_frag:"uniform sampler2D t2D;\nuniform float backgroundIntensity;\nvarying vec2 vUv;\nvoid main() {\n\tvec4 texColor = texture2D( t2D, vUv );\n\t#ifdef DECODE_VIDEO_TEXTURE\n\t\ttexColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );\n\t#endif\n\ttexColor.rgb *= backgroundIntensity;\n\tgl_FragColor = texColor;\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",backgroundCube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",backgroundCube_frag:"#ifdef ENVMAP_TYPE_CUBE\n\tuniform samplerCube envMap;\n#elif defined( ENVMAP_TYPE_CUBE_UV )\n\tuniform sampler2D envMap;\n#endif\nuniform float flipEnvMap;\nuniform float backgroundBlurriness;\nuniform float backgroundIntensity;\nvarying vec3 vWorldDirection;\n#include <cube_uv_reflection_fragment>\nvoid main() {\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 texColor = textureCube( envMap, vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );\n\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\tvec4 texColor = textureCubeUV( envMap, vWorldDirection, backgroundBlurriness );\n\t#else\n\t\tvec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t#endif\n\ttexColor.rgb *= backgroundIntensity;\n\tgl_FragColor = texColor;\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",cube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",cube_frag:"uniform samplerCube tCube;\nuniform float tFlip;\nuniform float opacity;\nvarying vec3 vWorldDirection;\nvoid main() {\n\tvec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );\n\tgl_FragColor = texColor;\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",depth_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvHighPrecisionZW = gl_Position.zw;\n}",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <logdepthbuf_fragment>\n\tfloat fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( fragCoordZ );\n\t#endif\n}",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}",equirect_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV = equirectUv( direction );\n\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\tvLineDistance = scale * lineDistance;\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",meshbasic_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinbase_vertex>\n\t\t#include <skinnormal_vertex>\n\t\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vUv2 );\n\t\treflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshlambert_vert:"#define LAMBERT\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshlambert_frag:"#define LAMBERT\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_lambert_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_lambert_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshmatcap_vert:"#define MATCAP\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}",meshmatcap_frag:"#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t#else\n\t\tvec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshnormal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}",meshnormal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n\t#ifdef OPAQUE\n\t\tgl_FragColor.a = 1.0;\n\t#endif\n}",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphysical_vert:"#define STANDARD\nvarying vec3 vViewPosition;\n#ifdef USE_TRANSMISSION\n\tvarying vec3 vWorldPosition;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n#ifdef USE_TRANSMISSION\n\tvWorldPosition = worldPosition.xyz;\n#endif\n}",meshphysical_frag:"#define STANDARD\n#ifdef PHYSICAL\n\t#define IOR\n\t#define SPECULAR\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef IOR\n\tuniform float ior;\n#endif\n#ifdef SPECULAR\n\tuniform float specularIntensity;\n\tuniform vec3 specularColor;\n\t#ifdef USE_SPECULARINTENSITYMAP\n\t\tuniform sampler2D specularIntensityMap;\n\t#endif\n\t#ifdef USE_SPECULARCOLORMAP\n\t\tuniform sampler2D specularColorMap;\n\t#endif\n#endif\n#ifdef USE_CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n#ifdef USE_IRIDESCENCE\n\tuniform float iridescence;\n\tuniform float iridescenceIOR;\n\tuniform float iridescenceThicknessMinimum;\n\tuniform float iridescenceThicknessMaximum;\n#endif\n#ifdef USE_SHEEN\n\tuniform vec3 sheenColor;\n\tuniform float sheenRoughness;\n\t#ifdef USE_SHEENCOLORMAP\n\t\tuniform sampler2D sheenColorMap;\n\t#endif\n\t#ifdef USE_SHEENROUGHNESSMAP\n\t\tuniform sampler2D sheenRoughnessMap;\n\t#endif\n#endif\nvarying vec3 vViewPosition;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <bsdfs>\n#include <iridescence_fragment>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_physical_pars_fragment>\n#include <transmission_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <iridescence_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;\n\tvec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;\n\t#include <transmission_fragment>\n\tvec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;\n\t#ifdef USE_SHEEN\n\t\tfloat sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );\n\t\toutgoingLight = outgoingLight * sheenEnergyComp + sheenSpecular;\n\t#endif\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );\n\t\tvec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );\n\t\toutgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + clearcoatSpecular * material.clearcoat;\n\t#endif\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshtoon_vert:"#define TOON\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshtoon_frag:"#define TOON\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_toon_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",shadow_vert:"#include <common>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",sprite_vert:"uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",sprite_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}"},Zi={common:{diffuse:{value:new Et(16777215)},opacity:{value:1},map:{value:null},uvTransform:{value:new lt},uv2Transform:{value:new lt},alphaMap:{value:null},alphaTest:{value:0}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new ot(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Et(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new Et(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new lt}},sprite:{diffuse:{value:new Et(16777215)},opacity:{value:1},center:{value:new ot(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new lt}}},Ji={basic:{uniforms:Di([Zi.common,Zi.specularmap,Zi.envmap,Zi.aomap,Zi.lightmap,Zi.fog]),vertexShader:Ki.meshbasic_vert,fragmentShader:Ki.meshbasic_frag},lambert:{uniforms:Di([Zi.common,Zi.specularmap,Zi.envmap,Zi.aomap,Zi.lightmap,Zi.emissivemap,Zi.bumpmap,Zi.normalmap,Zi.displacementmap,Zi.fog,Zi.lights,{emissive:{value:new Et(0)}}]),vertexShader:Ki.meshlambert_vert,fragmentShader:Ki.meshlambert_frag},phong:{uniforms:Di([Zi.common,Zi.specularmap,Zi.envmap,Zi.aomap,Zi.lightmap,Zi.emissivemap,Zi.bumpmap,Zi.normalmap,Zi.displacementmap,Zi.fog,Zi.lights,{emissive:{value:new Et(0)},specular:{value:new Et(1118481)},shininess:{value:30}}]),vertexShader:Ki.meshphong_vert,fragmentShader:Ki.meshphong_frag},standard:{uniforms:Di([Zi.common,Zi.envmap,Zi.aomap,Zi.lightmap,Zi.emissivemap,Zi.bumpmap,Zi.normalmap,Zi.displacementmap,Zi.roughnessmap,Zi.metalnessmap,Zi.fog,Zi.lights,{emissive:{value:new Et(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:Ki.meshphysical_vert,fragmentShader:Ki.meshphysical_frag},toon:{uniforms:Di([Zi.common,Zi.aomap,Zi.lightmap,Zi.emissivemap,Zi.bumpmap,Zi.normalmap,Zi.displacementmap,Zi.gradientmap,Zi.fog,Zi.lights,{emissive:{value:new Et(0)}}]),vertexShader:Ki.meshtoon_vert,fragmentShader:Ki.meshtoon_frag},matcap:{uniforms:Di([Zi.common,Zi.bumpmap,Zi.normalmap,Zi.displacementmap,Zi.fog,{matcap:{value:null}}]),vertexShader:Ki.meshmatcap_vert,fragmentShader:Ki.meshmatcap_frag},points:{uniforms:Di([Zi.points,Zi.fog]),vertexShader:Ki.points_vert,fragmentShader:Ki.points_frag},dashed:{uniforms:Di([Zi.common,Zi.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:Ki.linedashed_vert,fragmentShader:Ki.linedashed_frag},depth:{uniforms:Di([Zi.common,Zi.displacementmap]),vertexShader:Ki.depth_vert,fragmentShader:Ki.depth_frag},normal:{uniforms:Di([Zi.common,Zi.bumpmap,Zi.normalmap,Zi.displacementmap,{opacity:{value:1}}]),vertexShader:Ki.meshnormal_vert,fragmentShader:Ki.meshnormal_frag},sprite:{uniforms:Di([Zi.sprite,Zi.fog]),vertexShader:Ki.sprite_vert,fragmentShader:Ki.sprite_frag},background:{uniforms:{uvTransform:{value:new lt},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:Ki.background_vert,fragmentShader:Ki.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1}},vertexShader:Ki.backgroundCube_vert,fragmentShader:Ki.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:Ki.cube_vert,fragmentShader:Ki.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:Ki.equirect_vert,fragmentShader:Ki.equirect_frag},distanceRGBA:{uniforms:Di([Zi.common,Zi.displacementmap,{referencePosition:{value:new Bt},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:Ki.distanceRGBA_vert,fragmentShader:Ki.distanceRGBA_frag},shadow:{uniforms:Di([Zi.lights,Zi.fog,{color:{value:new Et(0)},opacity:{value:1}}]),vertexShader:Ki.shadow_vert,fragmentShader:Ki.shadow_frag}};Ji.physical={uniforms:Di([Ji.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new ot(1,1)},clearcoatNormalMap:{value:null},iridescence:{value:0},iridescenceMap:{value:null},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},sheen:{value:0},sheenColor:{value:new Et(0)},sheenColorMap:{value:null},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},transmission:{value:0},transmissionMap:{value:null},transmissionSamplerSize:{value:new ot},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},attenuationDistance:{value:0},attenuationColor:{value:new Et(0)},specularIntensity:{value:1},specularIntensityMap:{value:null},specularColor:{value:new Et(1,1,1)},specularColorMap:{value:null}}]),vertexShader:Ki.meshphysical_vert,fragmentShader:Ki.meshphysical_frag};var $i={r:0,b:0,g:0};function er(e,t,n,i,r,s,a){let o,l,c=new Et(0),h=!0===s?0:1,u=null,d=0,p=null;function f(t,n){t.getRGB($i,Oi(e)),i.buffers.color.setClear($i.r,$i.g,$i.b,n,a)}return{getClearColor:function(){return c},setClearColor:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;c.set(e),h=t,f(c,h)},getClearAlpha:function(){return h},setClearAlpha:function(e){h=e,f(c,h)},render:function(i,s){let a=!1,m=!0===s.isScene?s.background:null;m&&m.isTexture&&(m=(s.backgroundBlurriness>0?n:t).get(m));let g=e.xr,v=g.getSession&&g.getSession();v&&"additive"===v.environmentBlendMode&&(m=null),null===m?f(c,h):m&&m.isColor&&(f(m,1),a=!0),(e.autoClear||a)&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),m&&(m.isCubeTexture||m.mapping===re)?(void 0===l&&(l=new Ci(new Ti(1,1,1),new Ri({name:"BackgroundCubeMaterial",uniforms:Pi(Ji.backgroundCube.uniforms),vertexShader:Ji.backgroundCube.vertexShader,fragmentShader:Ji.backgroundCube.fragmentShader,side:1,depthTest:!1,depthWrite:!1,fog:!1})),l.geometry.deleteAttribute("normal"),l.geometry.deleteAttribute("uv"),l.onBeforeRender=function(e,t,n){this.matrixWorld.copyPosition(n.matrixWorld)},Object.defineProperty(l.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),r.update(l)),l.material.uniforms.envMap.value=m,l.material.uniforms.flipEnvMap.value=m.isCubeTexture&&!1===m.isRenderTargetTexture?-1:1,l.material.uniforms.backgroundBlurriness.value=s.backgroundBlurriness,l.material.uniforms.backgroundIntensity.value=s.backgroundIntensity,l.material.toneMapped=m.encoding!==Ne,(u!==m||d!==m.version||p!==e.toneMapping)&&(l.material.needsUpdate=!0,u=m,d=m.version,p=e.toneMapping),l.layers.enableAll(),i.unshift(l,l.geometry,l.material,0,0,null)):m&&m.isTexture&&(void 0===o&&(o=new Ci(new Qi(2,2),new Ri({name:"BackgroundMaterial",uniforms:Pi(Ji.background.uniforms),vertexShader:Ji.background.vertexShader,fragmentShader:Ji.background.fragmentShader,side:0,depthTest:!1,depthWrite:!1,fog:!1})),o.geometry.deleteAttribute("normal"),Object.defineProperty(o.material,"map",{get:function(){return this.uniforms.t2D.value}}),r.update(o)),o.material.uniforms.t2D.value=m,o.material.uniforms.backgroundIntensity.value=s.backgroundIntensity,o.material.toneMapped=m.encoding!==Ne,!0===m.matrixAutoUpdate&&m.updateMatrix(),o.material.uniforms.uvTransform.value.copy(m.matrix),(u!==m||d!==m.version||p!==e.toneMapping)&&(o.material.needsUpdate=!0,u=m,d=m.version,p=e.toneMapping),o.layers.enableAll(),i.unshift(o,o.geometry,o.material,0,0,null))}}}function tr(e,t,n,i){let r=e.getParameter(34921),s=i.isWebGL2?null:t.get("OES_vertex_array_object"),a=i.isWebGL2||null!==s,o={},l=p(null),c=l,h=!1;function u(t){return i.isWebGL2?e.bindVertexArray(t):s.bindVertexArrayOES(t)}function d(t){return i.isWebGL2?e.deleteVertexArray(t):s.deleteVertexArrayOES(t)}function p(e){let t=[],n=[],i=[];for(let s=0;s<r;s++)t[s]=0,n[s]=0,i[s]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:t,enabledAttributes:n,attributeDivisors:i,object:e,attributes:{},index:null}}function f(){let e=c.newAttributes;for(let t=0,n=e.length;t<n;t++)e[t]=0}function m(e){g(e,0)}function g(n,r){let s=c.newAttributes,a=c.enabledAttributes,o=c.attributeDivisors;s[n]=1,0===a[n]&&(e.enableVertexAttribArray(n),a[n]=1),o[n]!==r&&((i.isWebGL2?e:t.get("ANGLE_instanced_arrays"))[i.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](n,r),o[n]=r)}function v(){let t=c.newAttributes,n=c.enabledAttributes;for(let i=0,r=n.length;i<r;i++)n[i]!==t[i]&&(e.disableVertexAttribArray(i),n[i]=0)}function y(t,n,r,s,a,o){!0!==i.isWebGL2||5124!==r&&5125!==r?e.vertexAttribPointer(t,n,r,s,a,o):e.vertexAttribIPointer(t,n,r,a,o)}function b(){x(),h=!0,c!==l&&(c=l,u(c.object))}function x(){l.geometry=null,l.program=null,l.wireframe=!1}return{setup:function(r,l,d,b,x){let w=!1;if(a){let t=function(t,n,r){let a=!0===r.wireframe,l=o[t.id];void 0===l&&(l={},o[t.id]=l);let c=l[n.id];void 0===c&&(c={},l[n.id]=c);let h=c[a];return void 0===h&&(h=p(i.isWebGL2?e.createVertexArray():s.createVertexArrayOES()),c[a]=h),h}(b,d,l);c!==t&&(c=t,u(c.object)),w=function(e,t,n,i){let r=c.attributes,s=t.attributes,a=0,o=n.getAttributes();for(let l in o)if(o[l].location>=0){let t=r[l],n=s[l];if(void 0===n&&("instanceMatrix"===l&&e.instanceMatrix&&(n=e.instanceMatrix),"instanceColor"===l&&e.instanceColor&&(n=e.instanceColor)),void 0===t||t.attribute!==n||n&&t.data!==n.data)return!0;a++}return c.attributesNum!==a||c.index!==i}(r,b,d,x),w&&function(e,t,n,i){let r={},s=t.attributes,a=0,o=n.getAttributes();for(let l in o)if(o[l].location>=0){let t=s[l];void 0===t&&("instanceMatrix"===l&&e.instanceMatrix&&(t=e.instanceMatrix),"instanceColor"===l&&e.instanceColor&&(t=e.instanceColor));let n={};n.attribute=t,t&&t.data&&(n.data=t.data),r[l]=n,a++}c.attributes=r,c.attributesNum=a,c.index=i}(r,b,d,x)}else{let e=!0===l.wireframe;(c.geometry!==b.id||c.program!==d.id||c.wireframe!==e)&&(c.geometry=b.id,c.program=d.id,c.wireframe=e,w=!0)}null!==x&&n.update(x,34963),(w||h)&&(h=!1,function(r,s,a,o){if(!1===i.isWebGL2&&(r.isInstancedMesh||o.isInstancedBufferGeometry)&&null===t.get("ANGLE_instanced_arrays"))return;f();let l=o.attributes,c=a.getAttributes(),h=s.defaultAttributeValues;for(let t in c){let i=c[t];if(i.location>=0){let s=l[t];if(void 0===s&&("instanceMatrix"===t&&r.instanceMatrix&&(s=r.instanceMatrix),"instanceColor"===t&&r.instanceColor&&(s=r.instanceColor)),void 0!==s){let t=s.normalized,a=s.itemSize,l=n.get(s);if(void 0===l)continue;let c=l.buffer,h=l.type,u=l.bytesPerElement;if(s.isInterleavedBufferAttribute){let n=s.data,l=n.stride,d=s.offset;if(n.isInstancedInterleavedBuffer){for(let e=0;e<i.locationSize;e++)g(i.location+e,n.meshPerAttribute);!0!==r.isInstancedMesh&&void 0===o._maxInstanceCount&&(o._maxInstanceCount=n.meshPerAttribute*n.count)}else for(let e=0;e<i.locationSize;e++)m(i.location+e);e.bindBuffer(34962,c);for(let e=0;e<i.locationSize;e++)y(i.location+e,a/i.locationSize,h,t,l*u,(d+a/i.locationSize*e)*u)}else{if(s.isInstancedBufferAttribute){for(let e=0;e<i.locationSize;e++)g(i.location+e,s.meshPerAttribute);!0!==r.isInstancedMesh&&void 0===o._maxInstanceCount&&(o._maxInstanceCount=s.meshPerAttribute*s.count)}else for(let e=0;e<i.locationSize;e++)m(i.location+e);e.bindBuffer(34962,c);for(let e=0;e<i.locationSize;e++)y(i.location+e,a/i.locationSize,h,t,a*u,a/i.locationSize*e*u)}}else if(void 0!==h){let n=h[t];if(void 0!==n)switch(n.length){case 2:e.vertexAttrib2fv(i.location,n);break;case 3:e.vertexAttrib3fv(i.location,n);break;case 4:e.vertexAttrib4fv(i.location,n);break;default:e.vertexAttrib1fv(i.location,n)}}}}v()}(r,l,d,b),null!==x&&e.bindBuffer(34963,n.get(x).buffer))},reset:b,resetDefaultState:x,dispose:function(){b();for(let e in o){let t=o[e];for(let e in t){let n=t[e];for(let e in n)d(n[e].object),delete n[e];delete t[e]}delete o[e]}},releaseStatesOfGeometry:function(e){if(void 0===o[e.id])return;let t=o[e.id];for(let n in t){let e=t[n];for(let t in e)d(e[t].object),delete e[t];delete t[n]}delete o[e.id]},releaseStatesOfProgram:function(e){for(let t in o){let n=o[t];if(void 0===n[e.id])continue;let i=n[e.id];for(let e in i)d(i[e].object),delete i[e];delete n[e.id]}},initAttributes:f,enableAttribute:m,disableUnusedAttributes:v}}function nr(e,t,n,i){let r,s=i.isWebGL2;this.setMode=function(e){r=e},this.render=function(t,i){e.drawArrays(r,t,i),n.update(i,r,1)},this.renderInstances=function(i,a,o){if(0===o)return;let l,c;if(s)l=e,c="drawArraysInstanced";else if(l=t.get("ANGLE_instanced_arrays"),c="drawArraysInstancedANGLE",null===l)return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");l[c](r,i,a,o),n.update(a,r,o)}}function ir(e,t,n){let i;function r(t){if("highp"===t){if(e.getShaderPrecisionFormat(35633,36338).precision>0&&e.getShaderPrecisionFormat(35632,36338).precision>0)return"highp";t="mediump"}return"mediump"===t&&e.getShaderPrecisionFormat(35633,36337).precision>0&&e.getShaderPrecisionFormat(35632,36337).precision>0?"mediump":"lowp"}let s=typeof WebGL2RenderingContext<"u"&&e instanceof WebGL2RenderingContext,a=void 0!==n.precision?n.precision:"highp",o=r(a);o!==a&&(console.warn("THREE.WebGLRenderer:",a,"not supported, using",o,"instead."),a=o);let l=s||t.has("WEBGL_draw_buffers"),c=!0===n.logarithmicDepthBuffer,h=e.getParameter(34930),u=e.getParameter(35660),d=e.getParameter(3379),p=e.getParameter(34076),f=e.getParameter(34921),m=e.getParameter(36347),g=e.getParameter(36348),v=e.getParameter(36349),y=u>0,b=s||t.has("OES_texture_float");return{isWebGL2:s,drawBuffers:l,getMaxAnisotropy:function(){if(void 0!==i)return i;if(!0===t.has("EXT_texture_filter_anisotropic")){let n=t.get("EXT_texture_filter_anisotropic");i=e.getParameter(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else i=0;return i},getMaxPrecision:r,precision:a,logarithmicDepthBuffer:c,maxTextures:h,maxVertexTextures:u,maxTextureSize:d,maxCubemapSize:p,maxAttributes:f,maxVertexUniforms:m,maxVaryings:g,maxFragmentUniforms:v,vertexTextures:y,floatFragmentTextures:b,floatVertexTextures:y&&b,maxSamples:s?e.getParameter(36183):0}}function rr(e){let t=this,n=null,i=0,r=!1,s=!1,a=new Gi,o=new lt,l={value:null,needsUpdate:!1};function c(e,n,i,r){let s=null!==e?e.length:0,c=null;if(0!==s){if(c=l.value,!0!==r||null===c){let t=i+4*s,r=n.matrixWorldInverse;o.getNormalMatrix(r),(null===c||c.length<t)&&(c=new Float32Array(t));for(let n=0,l=i;n!==s;++n,l+=4)a.copy(e[n]).applyMatrix4(r,o),a.normal.toArray(c,l),c[l+3]=a.constant}l.value=c,l.needsUpdate=!0}return t.numPlanes=s,t.numIntersection=0,c}this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(e,t){let n=0!==e.length||t||0!==i||r;return r=t,i=e.length,n},this.beginShadows=function(){s=!0,c(null)},this.endShadows=function(){s=!1},this.setGlobalState=function(e,t){n=c(e,t,0)},this.setState=function(a,o,h){let u=a.clippingPlanes,d=a.clipIntersection,p=a.clipShadows,f=e.get(a);if(!r||null===u||0===u.length||s&&!p)s?c(null):(l.value!==n&&(l.value=n,l.needsUpdate=i>0),t.numPlanes=i,t.numIntersection=0);else{let e=s?0:i,t=4*e,r=f.clippingState||null;l.value=r,r=c(u,o,t,h);for(let i=0;i!==t;++i)r[i]=n[i];f.clippingState=r,this.numIntersection=d?this.numPlanes:0,this.numPlanes+=e}}}function sr(e){let t=new WeakMap;function n(e,t){return 303===t?e.mapping=ne:304===t&&(e.mapping=ie),e}function i(e){let n=e.target;n.removeEventListener("dispose",i);let r=t.get(n);void 0!==r&&(t.delete(n),r.dispose())}return{get:function(r){if(r&&r.isTexture&&!1===r.isRenderTargetTexture){let s=r.mapping;if(303===s||304===s){if(t.has(r)){return n(t.get(r).texture,r.mapping)}{let s=r.image;if(s&&s.height>0){let a=new Fi(s.height/2);return a.fromEquirectangularTexture(e,r),t.set(r,a),r.addEventListener("dispose",i),n(a.texture,r.mapping)}return null}}}return r},dispose:function(){t=new WeakMap}}}var ar=class extends ki{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:-1,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.1,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:2e3;super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=n,this.bottom=i,this.near=r,this.far=s,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=null===e.view?null:Object.assign({},e.view),this}setViewOffset(e,t,n,i,r,s){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=i,this.view.width=r,this.view.height=s,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){let e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,i=(this.top+this.bottom)/2,r=n-e,s=n+e,a=i+t,o=i-t;if(null!==this.view&&this.view.enabled){let e=(this.right-this.left)/this.view.fullWidth/this.zoom,t=(this.top-this.bottom)/this.view.fullHeight/this.zoom;r+=e*this.view.offsetX,s=r+e*this.view.width,a-=t*this.view.offsetY,o=a-t*this.view.height}this.projectionMatrix.makeOrthographic(r,s,a,o,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){let t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,null!==this.view&&(t.object.view=Object.assign({},this.view)),t}},or=[.125,.215,.35,.446,.526,.582],lr=20,cr=new ar,hr=new Et,ur=null,dr=(1+Math.sqrt(5))/2,pr=1/dr,fr=[new Bt(1,1,1),new Bt(-1,1,1),new Bt(1,1,-1),new Bt(-1,1,-1),new Bt(0,dr,pr),new Bt(0,dr,-pr),new Bt(pr,0,dr),new Bt(-pr,0,dr),new Bt(dr,pr,0),new Bt(-dr,pr,0)],mr=class{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.1,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:100;ur=this._renderer.getRenderTarget(),this._setSize(256);let r=this._allocateTargets();return r.depthBuffer=!0,this._sceneToCubeUV(e,n,i,r),t>0&&this._blur(r,0,0,t),this._applyPMREM(r),this._cleanup(r),r}fromEquirectangular(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return this._fromTexture(e,t)}fromCubemap(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return this._fromTexture(e,t)}compileCubemapShader(){null===this._cubemapMaterial&&(this._cubemapMaterial=br(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){null===this._equirectMaterial&&(this._equirectMaterial=yr(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),null!==this._cubemapMaterial&&this._cubemapMaterial.dispose(),null!==this._equirectMaterial&&this._equirectMaterial.dispose()}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){null!==this._blurMaterial&&this._blurMaterial.dispose(),null!==this._pingPongRenderTarget&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}_cleanup(e){this._renderer.setRenderTarget(ur),e.scissorTest=!1,vr(e,0,0,e.width,e.height)}_fromTexture(e,t){e.mapping===ne||e.mapping===ie?this._setSize(0===e.image.length?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4),ur=this._renderer.getRenderTarget();let n=t||this._allocateTargets();return this._textureToCubeUV(e,n),this._applyPMREM(n),this._cleanup(n),n}_allocateTargets(){let e=3*Math.max(this._cubeSize,112),t=4*this._cubeSize,n={magFilter:ue,minFilter:ue,generateMipmaps:!1,type:ve,format:be,encoding:ze,depthBuffer:!1},i=gr(e,t,n);if(null===this._pingPongRenderTarget||this._pingPongRenderTarget.width!==e||this._pingPongRenderTarget.height!==t){null!==this._pingPongRenderTarget&&this._dispose(),this._pingPongRenderTarget=gr(e,t,n);let{_lodMax:i}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=function(e){let t=[],n=[],i=[],r=e,s=e-4+1+or.length;for(let a=0;a<s;a++){let s=Math.pow(2,r);n.push(s);let o=1/s;a>e-4?o=or[a-e+4-1]:0===a&&(o=0),i.push(o);let l=1/(s-2),c=-l,h=1+l,u=[c,c,h,c,h,h,c,c,h,h,c,h],d=6,p=6,f=3,m=2,g=1,v=new Float32Array(f*p*d),y=new Float32Array(m*p*d),b=new Float32Array(g*p*d);for(let e=0;e<d;e++){let t=e%3*2/3-1,n=e>2?0:-1,i=[t,n,0,t+2/3,n,0,t+2/3,n+1,0,t,n,0,t+2/3,n+1,0,t,n+1,0];v.set(i,f*p*e),y.set(u,m*p*e);let r=[e,e,e,e,e,e];b.set(r,g*p*e)}let x=new di;x.setAttribute("position",new ti(v,f)),x.setAttribute("uv",new ti(y,m)),x.setAttribute("faceIndex",new ti(b,g)),t.push(x),r>4&&r--}return{lodPlanes:t,sizeLods:n,sigmas:i}}(i)),this._blurMaterial=function(e,t,n){let i=new Float32Array(lr),r=new Bt(0,1,0);return new Ri({name:"SphericalGaussianBlur",defines:{n:lr,CUBEUV_TEXEL_WIDTH:1/t,CUBEUV_TEXEL_HEIGHT:1/n,CUBEUV_MAX_MIP:"".concat(e,".0")},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:i},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:r}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\t\t\tuniform int samples;\n\t\t\tuniform float weights[ n ];\n\t\t\tuniform bool latitudinal;\n\t\t\tuniform float dTheta;\n\t\t\tuniform float mipInt;\n\t\t\tuniform vec3 poleAxis;\n\n\t\t\t#define ENVMAP_TYPE_CUBE_UV\n\t\t\t#include <cube_uv_reflection_fragment>\n\n\t\t\tvec3 getSample( float theta, vec3 axis ) {\n\n\t\t\t\tfloat cosTheta = cos( theta );\n\t\t\t\t// Rodrigues' axis-angle rotation\n\t\t\t\tvec3 sampleDirection = vOutputDirection * cosTheta\n\t\t\t\t\t+ cross( axis, vOutputDirection ) * sin( theta )\n\t\t\t\t\t+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );\n\n\t\t\t\treturn bilinearCubeUV( envMap, sampleDirection, mipInt );\n\n\t\t\t}\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );\n\n\t\t\t\tif ( all( equal( axis, vec3( 0.0 ) ) ) ) {\n\n\t\t\t\t\taxis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );\n\n\t\t\t\t}\n\n\t\t\t\taxis = normalize( axis );\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t\t\t\tgl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );\n\n\t\t\t\tfor ( int i = 1; i < n; i++ ) {\n\n\t\t\t\t\tif ( i >= samples ) {\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tfloat theta = dTheta * float( i );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( theta, axis );\n\n\t\t\t\t}\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1})}(i,e,t)}return i}_compileMaterial(e){let t=new Ci(this._lodPlanes[0],e);this._renderer.compile(t,cr)}_sceneToCubeUV(e,t,n,i){let r=new Li(90,1,t,n),s=[1,-1,1,1,1,1],a=[1,1,1,-1,-1,-1],o=this._renderer,l=o.autoClear,c=o.toneMapping;o.getClearColor(hr),o.toneMapping=0,o.autoClear=!1;let h=new Jn({name:"PMREM.Background",side:1,depthWrite:!1,depthTest:!1}),u=new Ci(new Ti,h),d=!1,p=e.background;p?p.isColor&&(h.color.copy(p),e.background=null,d=!0):(h.color.copy(hr),d=!0);for(let f=0;f<6;f++){let t=f%3;0===t?(r.up.set(0,s[f],0),r.lookAt(a[f],0,0)):1===t?(r.up.set(0,0,s[f]),r.lookAt(0,a[f],0)):(r.up.set(0,s[f],0),r.lookAt(0,0,a[f]));let n=this._cubeSize;vr(i,t*n,f>2?n:0,n,n),o.setRenderTarget(i),d&&o.render(u,r),o.render(e,r)}u.geometry.dispose(),u.material.dispose(),o.toneMapping=c,o.autoClear=l,e.background=p}_textureToCubeUV(e,t){let n=this._renderer,i=e.mapping===ne||e.mapping===ie;i?(null===this._cubemapMaterial&&(this._cubemapMaterial=br()),this._cubemapMaterial.uniforms.flipEnvMap.value=!1===e.isRenderTargetTexture?-1:1):null===this._equirectMaterial&&(this._equirectMaterial=yr());let r=i?this._cubemapMaterial:this._equirectMaterial,s=new Ci(this._lodPlanes[0],r);r.uniforms.envMap.value=e;let a=this._cubeSize;vr(t,0,0,3*a,2*a),n.setRenderTarget(t),n.render(s,cr)}_applyPMREM(e){let t=this._renderer,n=t.autoClear;t.autoClear=!1;for(let i=1;i<this._lodPlanes.length;i++){let t=Math.sqrt(this._sigmas[i]*this._sigmas[i]-this._sigmas[i-1]*this._sigmas[i-1]),n=fr[(i-1)%fr.length];this._blur(e,i-1,i,t,n)}t.autoClear=n}_blur(e,t,n,i,r){let s=this._pingPongRenderTarget;this._halfBlur(e,s,t,n,i,"latitudinal",r),this._halfBlur(s,e,n,n,i,"longitudinal",r)}_halfBlur(e,t,n,i,r,s,a){let o=this._renderer,l=this._blurMaterial;"latitudinal"!==s&&"longitudinal"!==s&&console.error("blur direction must be either latitudinal or longitudinal!");let c=new Ci(this._lodPlanes[i],l),h=l.uniforms,u=this._sizeLods[n]-1,d=isFinite(r)?Math.PI/(2*u):2*Math.PI/39,p=r/d,f=isFinite(r)?1+Math.floor(3*p):lr;f>lr&&console.warn("sigmaRadians, ".concat(r,", is too large and will clip, as it requested ").concat(f," samples when the maximum is set to ").concat(lr));let m=[],g=0;for(let b=0;b<lr;++b){let e=b/p,t=Math.exp(-e*e/2);m.push(t),0===b?g+=t:b<f&&(g+=2*t)}for(let b=0;b<m.length;b++)m[b]=m[b]/g;h.envMap.value=e.texture,h.samples.value=f,h.weights.value=m,h.latitudinal.value="latitudinal"===s,a&&(h.poleAxis.value=a);let{_lodMax:v}=this;h.dTheta.value=d,h.mipInt.value=v-n;let y=this._sizeLods[i];vr(t,3*y*(i>v-4?i-v+4:0),4*(this._cubeSize-y),3*y,2*y),o.setRenderTarget(t),o.render(c,cr)}};function gr(e,t,n){let i=new It(e,t,n);return i.texture.mapping=re,i.texture.name="PMREM.cubeUv",i.scissorTest=!0,i}function vr(e,t,n,i,r){e.viewport.set(t,n,i,r),e.scissor.set(t,n,i,r)}function yr(){return new Ri({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\n\t\t\t#include <common>\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 outputDirection = normalize( vOutputDirection );\n\t\t\t\tvec2 uv = equirectUv( outputDirection );\n\n\t\t\t\tgl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1})}function br(){return new Ri({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tuniform float flipEnvMap;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform samplerCube envMap;\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1})}function xr(e){let t=new WeakMap,n=null;function i(e){let n=e.target;n.removeEventListener("dispose",i);let r=t.get(n);void 0!==r&&(t.delete(n),r.dispose())}return{get:function(r){if(r&&r.isTexture){let s=r.mapping,a=303===s||304===s,o=s===ne||s===ie;if(a||o){if(r.isRenderTargetTexture&&!0===r.needsPMREMUpdate){r.needsPMREMUpdate=!1;let i=t.get(r);return null===n&&(n=new mr(e)),i=a?n.fromEquirectangular(r,i):n.fromCubemap(r,i),t.set(r,i),i.texture}if(t.has(r))return t.get(r).texture;{let s=r.image;if(a&&s&&s.height>0||o&&s&&function(e){let t=0,n=6;for(let i=0;i<n;i++)void 0!==e[i]&&t++;return t===n}(s)){null===n&&(n=new mr(e));let s=a?n.fromEquirectangular(r):n.fromCubemap(r);return t.set(r,s),r.addEventListener("dispose",i),s.texture}return null}}}return r},dispose:function(){t=new WeakMap,null!==n&&(n.dispose(),n=null)}}}function wr(e){let t={};function n(n){if(void 0!==t[n])return t[n];let i;switch(n){case"WEBGL_depth_texture":i=e.getExtension("WEBGL_depth_texture")||e.getExtension("MOZ_WEBGL_depth_texture")||e.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":i=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":i=e.getExtension("WEBGL_compressed_texture_s3tc")||e.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":i=e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:i=e.getExtension(n)}return t[n]=i,i}return{has:function(e){return null!==n(e)},init:function(e){e.isWebGL2?n("EXT_color_buffer_float"):(n("WEBGL_depth_texture"),n("OES_texture_float"),n("OES_texture_half_float"),n("OES_texture_half_float_linear"),n("OES_standard_derivatives"),n("OES_element_index_uint"),n("OES_vertex_array_object"),n("ANGLE_instanced_arrays")),n("OES_texture_float_linear"),n("EXT_color_buffer_half_float"),n("WEBGL_multisampled_render_to_texture")},get:function(e){let t=n(e);return null===t&&console.warn("THREE.WebGLRenderer: "+e+" extension not supported."),t}}}function Sr(e,t,n,i){let r={},s=new WeakMap;function a(e){let o=e.target;null!==o.index&&t.remove(o.index);for(let n in o.attributes)t.remove(o.attributes[n]);o.removeEventListener("dispose",a),delete r[o.id];let l=s.get(o);l&&(t.remove(l),s.delete(o)),i.releaseStatesOfGeometry(o),!0===o.isInstancedBufferGeometry&&delete o._maxInstanceCount,n.memory.geometries--}function o(e){let n=[],i=e.index,r=e.attributes.position,a=0;if(null!==i){let e=i.array;a=i.version;for(let t=0,i=e.length;t<i;t+=3){let i=e[t+0],r=e[t+1],s=e[t+2];n.push(i,r,r,s,s,i)}}else{let e=r.array;a=r.version;for(let t=0,i=e.length/3-1;t<i;t+=3){let e=t+0,i=t+1,r=t+2;n.push(e,i,i,r,r,e)}}let o=new(ht(n)?ii:ni)(n,1);o.version=a;let l=s.get(e);l&&t.remove(l),s.set(e,o)}return{get:function(e,t){return!0===r[t.id]||(t.addEventListener("dispose",a),r[t.id]=!0,n.memory.geometries++),t},update:function(e){let n=e.attributes;for(let r in n)t.update(n[r],34962);let i=e.morphAttributes;for(let r in i){let e=i[r];for(let n=0,i=e.length;n<i;n++)t.update(e[n],34962)}},getWireframeAttribute:function(e){let t=s.get(e);if(t){let n=e.index;null!==n&&t.version<n.version&&o(e)}else o(e);return s.get(e)}}}function _r(e,t,n,i){let r,s,a,o=i.isWebGL2;this.setMode=function(e){r=e},this.setIndex=function(e){s=e.type,a=e.bytesPerElement},this.render=function(t,i){e.drawElements(r,i,s,t*a),n.update(i,r,1)},this.renderInstances=function(i,l,c){if(0===c)return;let h,u;if(o)h=e,u="drawElementsInstanced";else if(h=t.get("ANGLE_instanced_arrays"),u="drawElementsInstancedANGLE",null===h)return void console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");h[u](r,l,s,i*a,c),n.update(l,r,c)}}function Er(e){let t={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:t,programs:null,autoReset:!0,reset:function(){t.frame++,t.calls=0,t.triangles=0,t.points=0,t.lines=0},update:function(e,n,i){switch(t.calls++,n){case 4:t.triangles+=i*(e/3);break;case 1:t.lines+=i*(e/2);break;case 3:t.lines+=i*(e-1);break;case 2:t.lines+=i*e;break;case 0:t.points+=i*e;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",n)}}}}function Ar(e,t){return e[0]-t[0]}function Cr(e,t){return Math.abs(t[1])-Math.abs(e[1])}function Mr(e,t,n){let i={},r=new Float32Array(8),s=new WeakMap,a=new Ot,o=[];for(let l=0;l<8;l++)o[l]=[l,0];return{update:function(l,c,h,u){let d=l.morphTargetInfluences;if(!0===t.isWebGL2){let i=c.morphAttributes.position||c.morphAttributes.normal||c.morphAttributes.color,r=void 0!==i?i.length:0,o=s.get(c);if(void 0===o||o.count!==r){let e=function(){v.dispose(),s.delete(c),c.removeEventListener("dispose",e)};void 0!==o&&o.texture.dispose();let n=void 0!==c.morphAttributes.position,i=void 0!==c.morphAttributes.normal,l=void 0!==c.morphAttributes.color,h=c.morphAttributes.position||[],u=c.morphAttributes.normal||[],d=c.morphAttributes.color||[],p=0;!0===n&&(p=1),!0===i&&(p=2),!0===l&&(p=3);let f=c.attributes.position.count*p,m=1;f>t.maxTextureSize&&(m=Math.ceil(f/t.maxTextureSize),f=t.maxTextureSize);let g=new Float32Array(f*m*4*r),v=new Rt(g,f,m,r);v.type=ge,v.needsUpdate=!0;let y=4*p;for(let t=0;t<r;t++){let e=h[t],r=u[t],s=d[t],o=f*m*4*t;for(let t=0;t<e.count;t++){let c=t*y;!0===n&&(a.fromBufferAttribute(e,t),g[o+c+0]=a.x,g[o+c+1]=a.y,g[o+c+2]=a.z,g[o+c+3]=0),!0===i&&(a.fromBufferAttribute(r,t),g[o+c+4]=a.x,g[o+c+5]=a.y,g[o+c+6]=a.z,g[o+c+7]=0),!0===l&&(a.fromBufferAttribute(s,t),g[o+c+8]=a.x,g[o+c+9]=a.y,g[o+c+10]=a.z,g[o+c+11]=4===s.itemSize?a.w:1)}}o={count:r,texture:v,size:new ot(f,m)},s.set(c,o),c.addEventListener("dispose",e)}let l=0;for(let e=0;e<d.length;e++)l+=d[e];let h=c.morphTargetsRelative?1:1-l;u.getUniforms().setValue(e,"morphTargetBaseInfluence",h),u.getUniforms().setValue(e,"morphTargetInfluences",d),u.getUniforms().setValue(e,"morphTargetsTexture",o.texture,n),u.getUniforms().setValue(e,"morphTargetsTextureSize",o.size)}else{let t=void 0===d?0:d.length,n=i[c.id];if(void 0===n||n.length!==t){n=[];for(let e=0;e<t;e++)n[e]=[e,0];i[c.id]=n}for(let e=0;e<t;e++){let t=n[e];t[0]=e,t[1]=d[e]}n.sort(Cr);for(let e=0;e<8;e++)e<t&&n[e][1]?(o[e][0]=n[e][0],o[e][1]=n[e][1]):(o[e][0]=Number.MAX_SAFE_INTEGER,o[e][1]=0);o.sort(Ar);let s=c.morphAttributes.position,a=c.morphAttributes.normal,l=0;for(let e=0;e<8;e++){let t=o[e],n=t[0],i=t[1];n!==Number.MAX_SAFE_INTEGER&&i?(s&&c.getAttribute("morphTarget"+e)!==s[n]&&c.setAttribute("morphTarget"+e,s[n]),a&&c.getAttribute("morphNormal"+e)!==a[n]&&c.setAttribute("morphNormal"+e,a[n]),r[e]=i,l+=i):(s&&!0===c.hasAttribute("morphTarget"+e)&&c.deleteAttribute("morphTarget"+e),a&&!0===c.hasAttribute("morphNormal"+e)&&c.deleteAttribute("morphNormal"+e),r[e]=0)}let h=c.morphTargetsRelative?1:1-l;u.getUniforms().setValue(e,"morphTargetBaseInfluence",h),u.getUniforms().setValue(e,"morphTargetInfluences",r)}}}}function Tr(e,t,n,i){let r=new WeakMap;function s(e){let t=e.target;t.removeEventListener("dispose",s),n.remove(t.instanceMatrix),null!==t.instanceColor&&n.remove(t.instanceColor)}return{update:function(e){let a=i.render.frame,o=e.geometry,l=t.get(e,o);return r.get(l)!==a&&(t.update(l),r.set(l,a)),e.isInstancedMesh&&(!1===e.hasEventListener("dispose",s)&&e.addEventListener("dispose",s),n.update(e.instanceMatrix,34962),null!==e.instanceColor&&n.update(e.instanceColor,34962)),l},dispose:function(){r=new WeakMap}}}var Pr=new Dt,Dr=new Rt,Or=new class extends Dt{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;super(null),this.isData3DTexture=!0,this.image={data:e,width:t,height:n,depth:i},this.magFilter=le,this.minFilter=le,this.wrapR=ae,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}},Ir=new Ni,Rr=[],kr=[],Lr=new Float32Array(16),Br=new Float32Array(9),zr=new Float32Array(4);function Nr(e,t,n){let i=e[0];if(null==i||i<=0||i>0)return e;let r=t*n,s=Rr[r];if(void 0===s&&(s=new Float32Array(r),Rr[r]=s),0!==t){i.toArray(s,0);for(let i=1,r=0;i!==t;++i)r+=n,e[i].toArray(s,r)}return s}function Fr(e,t){if(e.length!==t.length)return!1;for(let n=0,i=e.length;n<i;n++)if(e[n]!==t[n])return!1;return!0}function Ur(e,t){for(let n=0,i=t.length;n<i;n++)e[n]=t[n]}function jr(e,t){let n=kr[t];void 0===n&&(n=new Int32Array(t),kr[t]=n);for(let i=0;i!==t;++i)n[i]=e.allocateTextureUnit();return n}function Vr(e,t){let n=this.cache;n[0]!==t&&(e.uniform1f(this.addr,t),n[0]=t)}function Gr(e,t){let n=this.cache;if(void 0!==t.x)(n[0]!==t.x||n[1]!==t.y)&&(e.uniform2f(this.addr,t.x,t.y),n[0]=t.x,n[1]=t.y);else{if(Fr(n,t))return;e.uniform2fv(this.addr,t),Ur(n,t)}}function Hr(e,t){let n=this.cache;if(void 0!==t.x)(n[0]!==t.x||n[1]!==t.y||n[2]!==t.z)&&(e.uniform3f(this.addr,t.x,t.y,t.z),n[0]=t.x,n[1]=t.y,n[2]=t.z);else if(void 0!==t.r)(n[0]!==t.r||n[1]!==t.g||n[2]!==t.b)&&(e.uniform3f(this.addr,t.r,t.g,t.b),n[0]=t.r,n[1]=t.g,n[2]=t.b);else{if(Fr(n,t))return;e.uniform3fv(this.addr,t),Ur(n,t)}}function Wr(e,t){let n=this.cache;if(void 0!==t.x)(n[0]!==t.x||n[1]!==t.y||n[2]!==t.z||n[3]!==t.w)&&(e.uniform4f(this.addr,t.x,t.y,t.z,t.w),n[0]=t.x,n[1]=t.y,n[2]=t.z,n[3]=t.w);else{if(Fr(n,t))return;e.uniform4fv(this.addr,t),Ur(n,t)}}function qr(e,t){let n=this.cache,i=t.elements;if(void 0===i){if(Fr(n,t))return;e.uniformMatrix2fv(this.addr,!1,t),Ur(n,t)}else{if(Fr(n,i))return;zr.set(i),e.uniformMatrix2fv(this.addr,!1,zr),Ur(n,i)}}function Xr(e,t){let n=this.cache,i=t.elements;if(void 0===i){if(Fr(n,t))return;e.uniformMatrix3fv(this.addr,!1,t),Ur(n,t)}else{if(Fr(n,i))return;Br.set(i),e.uniformMatrix3fv(this.addr,!1,Br),Ur(n,i)}}function Yr(e,t){let n=this.cache,i=t.elements;if(void 0===i){if(Fr(n,t))return;e.uniformMatrix4fv(this.addr,!1,t),Ur(n,t)}else{if(Fr(n,i))return;Lr.set(i),e.uniformMatrix4fv(this.addr,!1,Lr),Ur(n,i)}}function Qr(e,t){let n=this.cache;n[0]!==t&&(e.uniform1i(this.addr,t),n[0]=t)}function Kr(e,t){let n=this.cache;if(void 0!==t.x)(n[0]!==t.x||n[1]!==t.y)&&(e.uniform2i(this.addr,t.x,t.y),n[0]=t.x,n[1]=t.y);else{if(Fr(n,t))return;e.uniform2iv(this.addr,t),Ur(n,t)}}function Zr(e,t){let n=this.cache;if(void 0!==t.x)(n[0]!==t.x||n[1]!==t.y||n[2]!==t.z)&&(e.uniform3i(this.addr,t.x,t.y,t.z),n[0]=t.x,n[1]=t.y,n[2]=t.z);else{if(Fr(n,t))return;e.uniform3iv(this.addr,t),Ur(n,t)}}function Jr(e,t){let n=this.cache;if(void 0!==t.x)(n[0]!==t.x||n[1]!==t.y||n[2]!==t.z||n[3]!==t.w)&&(e.uniform4i(this.addr,t.x,t.y,t.z,t.w),n[0]=t.x,n[1]=t.y,n[2]=t.z,n[3]=t.w);else{if(Fr(n,t))return;e.uniform4iv(this.addr,t),Ur(n,t)}}function $r(e,t){let n=this.cache;n[0]!==t&&(e.uniform1ui(this.addr,t),n[0]=t)}function es(e,t){let n=this.cache;if(void 0!==t.x)(n[0]!==t.x||n[1]!==t.y)&&(e.uniform2ui(this.addr,t.x,t.y),n[0]=t.x,n[1]=t.y);else{if(Fr(n,t))return;e.uniform2uiv(this.addr,t),Ur(n,t)}}function ts(e,t){let n=this.cache;if(void 0!==t.x)(n[0]!==t.x||n[1]!==t.y||n[2]!==t.z)&&(e.uniform3ui(this.addr,t.x,t.y,t.z),n[0]=t.x,n[1]=t.y,n[2]=t.z);else{if(Fr(n,t))return;e.uniform3uiv(this.addr,t),Ur(n,t)}}function ns(e,t){let n=this.cache;if(void 0!==t.x)(n[0]!==t.x||n[1]!==t.y||n[2]!==t.z||n[3]!==t.w)&&(e.uniform4ui(this.addr,t.x,t.y,t.z,t.w),n[0]=t.x,n[1]=t.y,n[2]=t.z,n[3]=t.w);else{if(Fr(n,t))return;e.uniform4uiv(this.addr,t),Ur(n,t)}}function is(e,t,n){let i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(e.uniform1i(this.addr,r),i[0]=r),n.setTexture2D(t||Pr,r)}function rs(e,t,n){let i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(e.uniform1i(this.addr,r),i[0]=r),n.setTexture3D(t||Or,r)}function ss(e,t,n){let i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(e.uniform1i(this.addr,r),i[0]=r),n.setTextureCube(t||Ir,r)}function as(e,t,n){let i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(e.uniform1i(this.addr,r),i[0]=r),n.setTexture2DArray(t||Dr,r)}function os(e,t){e.uniform1fv(this.addr,t)}function ls(e,t){let n=Nr(t,this.size,2);e.uniform2fv(this.addr,n)}function cs(e,t){let n=Nr(t,this.size,3);e.uniform3fv(this.addr,n)}function hs(e,t){let n=Nr(t,this.size,4);e.uniform4fv(this.addr,n)}function us(e,t){let n=Nr(t,this.size,4);e.uniformMatrix2fv(this.addr,!1,n)}function ds(e,t){let n=Nr(t,this.size,9);e.uniformMatrix3fv(this.addr,!1,n)}function ps(e,t){let n=Nr(t,this.size,16);e.uniformMatrix4fv(this.addr,!1,n)}function fs(e,t){e.uniform1iv(this.addr,t)}function ms(e,t){e.uniform2iv(this.addr,t)}function gs(e,t){e.uniform3iv(this.addr,t)}function vs(e,t){e.uniform4iv(this.addr,t)}function ys(e,t){e.uniform1uiv(this.addr,t)}function bs(e,t){e.uniform2uiv(this.addr,t)}function xs(e,t){e.uniform3uiv(this.addr,t)}function ws(e,t){e.uniform4uiv(this.addr,t)}function Ss(e,t,n){let i=this.cache,r=t.length,s=jr(n,r);Fr(i,s)||(e.uniform1iv(this.addr,s),Ur(i,s));for(let a=0;a!==r;++a)n.setTexture2D(t[a]||Pr,s[a])}function _s(e,t,n){let i=this.cache,r=t.length,s=jr(n,r);Fr(i,s)||(e.uniform1iv(this.addr,s),Ur(i,s));for(let a=0;a!==r;++a)n.setTexture3D(t[a]||Or,s[a])}function Es(e,t,n){let i=this.cache,r=t.length,s=jr(n,r);Fr(i,s)||(e.uniform1iv(this.addr,s),Ur(i,s));for(let a=0;a!==r;++a)n.setTextureCube(t[a]||Ir,s[a])}function As(e,t,n){let i=this.cache,r=t.length,s=jr(n,r);Fr(i,s)||(e.uniform1iv(this.addr,s),Ur(i,s));for(let a=0;a!==r;++a)n.setTexture2DArray(t[a]||Dr,s[a])}var Cs=class{constructor(e,t,n){this.id=e,this.addr=n,this.cache=[],this.setValue=function(e){switch(e){case 5126:return Vr;case 35664:return Gr;case 35665:return Hr;case 35666:return Wr;case 35674:return qr;case 35675:return Xr;case 35676:return Yr;case 5124:case 35670:return Qr;case 35667:case 35671:return Kr;case 35668:case 35672:return Zr;case 35669:case 35673:return Jr;case 5125:return $r;case 36294:return es;case 36295:return ts;case 36296:return ns;case 35678:case 36198:case 36298:case 36306:case 35682:return is;case 35679:case 36299:case 36307:return rs;case 35680:case 36300:case 36308:case 36293:return ss;case 36289:case 36303:case 36311:case 36292:return as}}(t.type)}},Ms=class{constructor(e,t,n){this.id=e,this.addr=n,this.cache=[],this.size=t.size,this.setValue=function(e){switch(e){case 5126:return os;case 35664:return ls;case 35665:return cs;case 35666:return hs;case 35674:return us;case 35675:return ds;case 35676:return ps;case 5124:case 35670:return fs;case 35667:case 35671:return ms;case 35668:case 35672:return gs;case 35669:case 35673:return vs;case 5125:return ys;case 36294:return bs;case 36295:return xs;case 36296:return ws;case 35678:case 36198:case 36298:case 36306:case 35682:return Ss;case 35679:case 36299:case 36307:return _s;case 35680:case 36300:case 36308:case 36293:return Es;case 36289:case 36303:case 36311:case 36292:return As}}(t.type)}},Ts=class{constructor(e){this.id=e,this.seq=[],this.map={}}setValue(e,t,n){if(void 0===t)return;let i=this.seq;for(let r=0,s=i.length;r!==s;++r){let s=i[r];s.setValue(e,t[s.id],n)}}},Ps=/(\w+)(\])?(\[|\.)?/g;function Ds(e,t){e.seq.push(t),e.map[t.id]=t}function Os(e,t,n){let i=e.name,r=i.length;for(Ps.lastIndex=0;;){let s=Ps.exec(i),a=Ps.lastIndex,o=s[1],l="]"===s[2],c=s[3];if(l&&(o|=0),void 0===c||"["===c&&a+2===r){Ds(n,void 0===c?new Cs(o,e,t):new Ms(o,e,t));break}{let e=n.map[o];void 0===e&&(e=new Ts(o),Ds(n,e)),n=e}}}var Is=class{constructor(e,t){this.seq=[],this.map={};let n=e.getProgramParameter(t,35718);for(let i=0;i<n;++i){let n=e.getActiveUniform(t,i);Os(n,e.getUniformLocation(t,n.name),this)}}setValue(e,t,n,i){let r=this.map[t];void 0!==r&&r.setValue(e,n,i)}setOptional(e,t,n){let i=t[n];void 0!==i&&this.setValue(e,n,i)}static upload(e,t,n,i){for(let r=0,s=t.length;r!==s;++r){let s=t[r],a=n[s.id];!1!==a.needsUpdate&&s.setValue(e,a.value,i)}}static seqWithValue(e,t){let n=[];for(let i=0,r=e.length;i!==r;++i){let r=e[i];r.id in t&&n.push(r)}return n}};function Rs(e,t,n){let i=e.createShader(t);return e.shaderSource(i,n),e.compileShader(i),i}var ks=0;function Ls(e,t,n){let i=e.getShaderParameter(t,35713),r=e.getShaderInfoLog(t).trim();if(i&&""===r)return"";let s=/ERROR: 0:(\d+)/.exec(r);if(s){let i=parseInt(s[1]);return n.toUpperCase()+"\n\n"+r+"\n\n"+function(e,t){let n=e.split("\n"),i=[],r=Math.max(t-6,0),s=Math.min(t+6,n.length);for(let a=r;a<s;a++){let e=a+1;i.push("".concat(e===t?">":" "," ").concat(e,": ").concat(n[a]))}return i.join("\n")}(e.getShaderSource(t),i)}return r}function Bs(e,t){let n=function(e){switch(e){case ze:return["Linear","( value )"];case Ne:return["sRGB","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported encoding:",e),["Linear","( value )"]}}(t);return"vec4 "+e+"( vec4 value ) { return LinearTo"+n[0]+n[1]+"; }"}function zs(e,t){let n;switch(t){case 1:n="Linear";break;case 2:n="Reinhard";break;case 3:n="OptimizedCineon";break;case 4:n="ACESFilmic";break;case 5:n="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",t),n="Linear"}return"vec3 "+e+"( vec3 color ) { return "+n+"ToneMapping( color ); }"}function Ns(e){return""!==e}function Fs(e,t){let n=t.numSpotLightShadows+t.numSpotLightMaps-t.numSpotLightShadowsWithMaps;return e.replace(/NUM_DIR_LIGHTS/g,t.numDirLights).replace(/NUM_SPOT_LIGHTS/g,t.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,t.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,n).replace(/NUM_RECT_AREA_LIGHTS/g,t.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,t.numPointLights).replace(/NUM_HEMI_LIGHTS/g,t.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,t.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,t.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,t.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,t.numPointLightShadows)}function Us(e,t){return e.replace(/NUM_CLIPPING_PLANES/g,t.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,t.numClippingPlanes-t.numClipIntersection)}var js=/^[ \t]*#include +<([\w\d./]+)>/gm;function Vs(e){return e.replace(js,Gs)}function Gs(e,t){let n=Ki[t];if(void 0===n)throw new Error("Can not resolve #include <"+t+">");return Vs(n)}var Hs=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function Ws(e){return e.replace(Hs,qs)}function qs(e,t,n,i){let r="";for(let s=parseInt(t);s<parseInt(n);s++)r+=i.replace(/\[\s*i\s*\]/g,"[ "+s+" ]").replace(/UNROLLED_LOOP_INDEX/g,s);return r}function Xs(e){let t="precision "+e.precision+" float;\nprecision "+e.precision+" int;";return"highp"===e.precision?t+="\n#define HIGH_PRECISION":"mediump"===e.precision?t+="\n#define MEDIUM_PRECISION":"lowp"===e.precision&&(t+="\n#define LOW_PRECISION"),t}function Ys(e,t,n,i){let r,s,a=e.getContext(),o=n.defines,l=n.vertexShader,c=n.fragmentShader,h=function(e){let t="SHADOWMAP_TYPE_BASIC";return 1===e.shadowMapType?t="SHADOWMAP_TYPE_PCF":2===e.shadowMapType?t="SHADOWMAP_TYPE_PCF_SOFT":3===e.shadowMapType&&(t="SHADOWMAP_TYPE_VSM"),t}(n),u=function(e){let t="ENVMAP_TYPE_CUBE";if(e.envMap)switch(e.envMapMode){case ne:case ie:t="ENVMAP_TYPE_CUBE";break;case re:t="ENVMAP_TYPE_CUBE_UV"}return t}(n),d=function(e){let t="ENVMAP_MODE_REFLECTION";e.envMap&&e.envMapMode===ie&&(t="ENVMAP_MODE_REFRACTION");return t}(n),p=function(e){let t="ENVMAP_BLENDING_NONE";if(e.envMap)switch(e.combine){case 0:t="ENVMAP_BLENDING_MULTIPLY";break;case 1:t="ENVMAP_BLENDING_MIX";break;case 2:t="ENVMAP_BLENDING_ADD"}return t}(n),f=function(e){let t=e.envMapCubeUVHeight;if(null===t)return null;let n=Math.log2(t)-2,i=1/t;return{texelWidth:1/(3*Math.max(Math.pow(2,n),112)),texelHeight:i,maxMip:n}}(n),m=n.isWebGL2?"":function(e){return[e.extensionDerivatives||e.envMapCubeUVHeight||e.bumpMap||e.tangentSpaceNormalMap||e.clearcoatNormalMap||e.flatShading||"physical"===e.shaderID?"#extension GL_OES_standard_derivatives : enable":"",(e.extensionFragDepth||e.logarithmicDepthBuffer)&&e.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",e.extensionDrawBuffers&&e.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(e.extensionShaderTextureLOD||e.envMap||e.transmission)&&e.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(Ns).join("\n")}(n),g=function(e){let t=[];for(let n in e){let i=e[n];!1!==i&&t.push("#define "+n+" "+i)}return t.join("\n")}(o),v=a.createProgram(),y=n.glslVersion?"#version "+n.glslVersion+"\n":"";n.isRawShaderMaterial?(r=[g].filter(Ns).join("\n"),r.length>0&&(r+="\n"),s=[m,g].filter(Ns).join("\n"),s.length>0&&(s+="\n")):(r=[Xs(n),"#define SHADER_NAME "+n.shaderName,g,n.instancing?"#define USE_INSTANCING":"",n.instancingColor?"#define USE_INSTANCING_COLOR":"",n.supportsVertexTextures?"#define VERTEX_TEXTURES":"",n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+d:"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMap&&n.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",n.normalMap&&n.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",n.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",n.displacementMap&&n.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",n.specularColorMap?"#define USE_SPECULARCOLORMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.transmission?"#define USE_TRANSMISSION":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.thicknessMap?"#define USE_THICKNESSMAP":"",n.sheenColorMap?"#define USE_SHEENCOLORMAP":"",n.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",n.vertexTangents?"#define USE_TANGENT":"",n.vertexColors?"#define USE_COLOR":"",n.vertexAlphas?"#define USE_COLOR_ALPHA":"",n.vertexUvs?"#define USE_UV":"",n.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",n.flatShading?"#define FLAT_SHADED":"",n.skinning?"#define USE_SKINNING":"",n.morphTargets?"#define USE_MORPHTARGETS":"",n.morphNormals&&!1===n.flatShading?"#define USE_MORPHNORMALS":"",n.morphColors&&n.isWebGL2?"#define USE_MORPHCOLORS":"",n.morphTargetsCount>0&&n.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",n.morphTargetsCount>0&&n.isWebGL2?"#define MORPHTARGETS_TEXTURE_STRIDE "+n.morphTextureStride:"",n.morphTargetsCount>0&&n.isWebGL2?"#define MORPHTARGETS_COUNT "+n.morphTargetsCount:"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+h:"",n.sizeAttenuation?"#define USE_SIZEATTENUATION":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.logarithmicDepthBuffer&&n.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","\tattribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","\tattribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","\tattribute vec4 color;","#elif defined( USE_COLOR )","\tattribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(Ns).join("\n"),s=[m,Xs(n),"#define SHADER_NAME "+n.shaderName,g,n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.matcap?"#define USE_MATCAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+u:"",n.envMap?"#define "+d:"",n.envMap?"#define "+p:"",f?"#define CUBEUV_TEXEL_WIDTH "+f.texelWidth:"",f?"#define CUBEUV_TEXEL_HEIGHT "+f.texelHeight:"",f?"#define CUBEUV_MAX_MIP "+f.maxMip+".0":"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMap&&n.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",n.normalMap&&n.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",n.clearcoat?"#define USE_CLEARCOAT":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.iridescence?"#define USE_IRIDESCENCE":"",n.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",n.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",n.specularColorMap?"#define USE_SPECULARCOLORMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.alphaTest?"#define USE_ALPHATEST":"",n.sheen?"#define USE_SHEEN":"",n.sheenColorMap?"#define USE_SHEENCOLORMAP":"",n.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",n.transmission?"#define USE_TRANSMISSION":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.thicknessMap?"#define USE_THICKNESSMAP":"",n.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",n.vertexTangents?"#define USE_TANGENT":"",n.vertexColors||n.instancingColor?"#define USE_COLOR":"",n.vertexAlphas?"#define USE_COLOR_ALPHA":"",n.vertexUvs?"#define USE_UV":"",n.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",n.gradientMap?"#define USE_GRADIENTMAP":"",n.flatShading?"#define FLAT_SHADED":"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+h:"",n.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",n.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.logarithmicDepthBuffer&&n.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",0!==n.toneMapping?"#define TONE_MAPPING":"",0!==n.toneMapping?Ki.tonemapping_pars_fragment:"",0!==n.toneMapping?zs("toneMapping",n.toneMapping):"",n.dithering?"#define DITHERING":"",n.opaque?"#define OPAQUE":"",Ki.encodings_pars_fragment,Bs("linearToOutputTexel",n.outputEncoding),n.useDepthPacking?"#define DEPTH_PACKING "+n.depthPacking:"","\n"].filter(Ns).join("\n")),l=Vs(l),l=Fs(l,n),l=Us(l,n),c=Vs(c),c=Fs(c,n),c=Us(c,n),l=Ws(l),c=Ws(c),n.isWebGL2&&!0!==n.isRawShaderMaterial&&(y="#version 300 es\n",r=["precision mediump sampler2DArray;","#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+r,s=["#define varying in",n.glslVersion===He?"":"layout(location = 0) out highp vec4 pc_fragColor;",n.glslVersion===He?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+s);let b,x,w=y+s+c,S=Rs(a,35633,y+r+l),_=Rs(a,35632,w);if(a.attachShader(v,S),a.attachShader(v,_),void 0!==n.index0AttributeName?a.bindAttribLocation(v,0,n.index0AttributeName):!0===n.morphTargets&&a.bindAttribLocation(v,0,"position"),a.linkProgram(v),e.debug.checkShaderErrors){let e=a.getProgramInfoLog(v).trim(),t=a.getShaderInfoLog(S).trim(),n=a.getShaderInfoLog(_).trim(),i=!0,o=!0;if(!1===a.getProgramParameter(v,35714)){i=!1;let t=Ls(a,S,"vertex"),n=Ls(a,_,"fragment");console.error("THREE.WebGLProgram: Shader Error "+a.getError()+" - VALIDATE_STATUS "+a.getProgramParameter(v,35715)+"\n\nProgram Info Log: "+e+"\n"+t+"\n"+n)}else""!==e?console.warn("THREE.WebGLProgram: Program Info Log:",e):(""===t||""===n)&&(o=!1);o&&(this.diagnostics={runnable:i,programLog:e,vertexShader:{log:t,prefix:r},fragmentShader:{log:n,prefix:s}})}return a.deleteShader(S),a.deleteShader(_),this.getUniforms=function(){return void 0===b&&(b=new Is(a,v)),b},this.getAttributes=function(){return void 0===x&&(x=function(e,t){let n={},i=e.getProgramParameter(t,35721);for(let r=0;r<i;r++){let i=e.getActiveAttrib(t,r),s=i.name,a=1;35674===i.type&&(a=2),35675===i.type&&(a=3),35676===i.type&&(a=4),n[s]={type:i.type,location:e.getAttribLocation(t,s),locationSize:a}}return n}(a,v)),x},this.destroy=function(){i.releaseStatesOfProgram(this),a.deleteProgram(v),this.program=void 0},this.name=n.shaderName,this.id=ks++,this.cacheKey=t,this.usedTimes=1,this.program=v,this.vertexShader=S,this.fragmentShader=_,this}var Qs=0,Ks=class{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){let t=e.vertexShader,n=e.fragmentShader,i=this._getShaderStage(t),r=this._getShaderStage(n),s=this._getShaderCacheForMaterial(e);return!1===s.has(i)&&(s.add(i),i.usedTimes++),!1===s.has(r)&&(s.add(r),r.usedTimes++),this}remove(e){let t=this.materialCache.get(e);for(let n of t)n.usedTimes--,0===n.usedTimes&&this.shaderCache.delete(n.code);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){let t=this.materialCache,n=t.get(e);return void 0===n&&(n=new Set,t.set(e,n)),n}_getShaderStage(e){let t=this.shaderCache,n=t.get(e);return void 0===n&&(n=new Zs(e),t.set(e,n)),n}},Zs=class{constructor(e){this.id=Qs++,this.code=e,this.usedTimes=0}};function Js(e,t,n,i,r,s,a){let o=new En,l=new Ks,c=[],h=r.isWebGL2,u=r.logarithmicDepthBuffer,d=r.vertexTextures,p=r.precision,f={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};return{getParameters:function(s,o,c,m,g){let v=m.fog,y=g.geometry,b=s.isMeshStandardMaterial?m.environment:null,x=(s.isMeshStandardMaterial?n:t).get(s.envMap||b),w=x&&x.mapping===re?x.image.height:null,S=f[s.type];null!==s.precision&&(p=r.getMaxPrecision(s.precision),p!==s.precision&&console.warn("THREE.WebGLProgram.getParameters:",s.precision,"not supported, using",p,"instead."));let _,E,A,C,M=y.morphAttributes.position||y.morphAttributes.normal||y.morphAttributes.color,T=void 0!==M?M.length:0,P=0;if(void 0!==y.morphAttributes.position&&(P=1),void 0!==y.morphAttributes.normal&&(P=2),void 0!==y.morphAttributes.color&&(P=3),S){let e=Ji[S];_=e.vertexShader,E=e.fragmentShader}else _=s.vertexShader,E=s.fragmentShader,l.update(s),A=l.getVertexShaderID(s),C=l.getFragmentShaderID(s);let D=e.getRenderTarget(),O=s.alphaTest>0,I=s.clearcoat>0,R=s.iridescence>0;return{isWebGL2:h,shaderID:S,shaderName:s.type,vertexShader:_,fragmentShader:E,defines:s.defines,customVertexShaderID:A,customFragmentShaderID:C,isRawShaderMaterial:!0===s.isRawShaderMaterial,glslVersion:s.glslVersion,precision:p,instancing:!0===g.isInstancedMesh,instancingColor:!0===g.isInstancedMesh&&null!==g.instanceColor,supportsVertexTextures:d,outputEncoding:null===D?e.outputEncoding:!0===D.isXRRenderTarget?D.texture.encoding:ze,map:!!s.map,matcap:!!s.matcap,envMap:!!x,envMapMode:x&&x.mapping,envMapCubeUVHeight:w,lightMap:!!s.lightMap,aoMap:!!s.aoMap,emissiveMap:!!s.emissiveMap,bumpMap:!!s.bumpMap,normalMap:!!s.normalMap,objectSpaceNormalMap:1===s.normalMapType,tangentSpaceNormalMap:0===s.normalMapType,decodeVideoTexture:!!s.map&&!0===s.map.isVideoTexture&&s.map.encoding===Ne,clearcoat:I,clearcoatMap:I&&!!s.clearcoatMap,clearcoatRoughnessMap:I&&!!s.clearcoatRoughnessMap,clearcoatNormalMap:I&&!!s.clearcoatNormalMap,iridescence:R,iridescenceMap:R&&!!s.iridescenceMap,iridescenceThicknessMap:R&&!!s.iridescenceThicknessMap,displacementMap:!!s.displacementMap,roughnessMap:!!s.roughnessMap,metalnessMap:!!s.metalnessMap,specularMap:!!s.specularMap,specularIntensityMap:!!s.specularIntensityMap,specularColorMap:!!s.specularColorMap,opaque:!1===s.transparent&&1===s.blending,alphaMap:!!s.alphaMap,alphaTest:O,gradientMap:!!s.gradientMap,sheen:s.sheen>0,sheenColorMap:!!s.sheenColorMap,sheenRoughnessMap:!!s.sheenRoughnessMap,transmission:s.transmission>0,transmissionMap:!!s.transmissionMap,thicknessMap:!!s.thicknessMap,combine:s.combine,vertexTangents:!!s.normalMap&&!!y.attributes.tangent,vertexColors:s.vertexColors,vertexAlphas:!0===s.vertexColors&&!!y.attributes.color&&4===y.attributes.color.itemSize,vertexUvs:!!s.map||!!s.bumpMap||!!s.normalMap||!!s.specularMap||!!s.alphaMap||!!s.emissiveMap||!!s.roughnessMap||!!s.metalnessMap||!!s.clearcoatMap||!!s.clearcoatRoughnessMap||!!s.clearcoatNormalMap||!!s.iridescenceMap||!!s.iridescenceThicknessMap||!!s.displacementMap||!!s.transmissionMap||!!s.thicknessMap||!!s.specularIntensityMap||!!s.specularColorMap||!!s.sheenColorMap||!!s.sheenRoughnessMap,uvsVertexOnly:!(s.map||s.bumpMap||s.normalMap||s.specularMap||s.alphaMap||s.emissiveMap||s.roughnessMap||s.metalnessMap||s.clearcoatNormalMap||s.iridescenceMap||s.iridescenceThicknessMap||s.transmission>0||s.transmissionMap||s.thicknessMap||s.specularIntensityMap||s.specularColorMap||s.sheen>0||s.sheenColorMap||s.sheenRoughnessMap)&&!!s.displacementMap,fog:!!v,useFog:!0===s.fog,fogExp2:v&&v.isFogExp2,flatShading:!!s.flatShading,sizeAttenuation:s.sizeAttenuation,logarithmicDepthBuffer:u,skinning:!0===g.isSkinnedMesh,morphTargets:void 0!==y.morphAttributes.position,morphNormals:void 0!==y.morphAttributes.normal,morphColors:void 0!==y.morphAttributes.color,morphTargetsCount:T,morphTextureStride:P,numDirLights:o.directional.length,numPointLights:o.point.length,numSpotLights:o.spot.length,numSpotLightMaps:o.spotLightMap.length,numRectAreaLights:o.rectArea.length,numHemiLights:o.hemi.length,numDirLightShadows:o.directionalShadowMap.length,numPointLightShadows:o.pointShadowMap.length,numSpotLightShadows:o.spotShadowMap.length,numSpotLightShadowsWithMaps:o.numSpotLightShadowsWithMaps,numClippingPlanes:a.numPlanes,numClipIntersection:a.numIntersection,dithering:s.dithering,shadowMapEnabled:e.shadowMap.enabled&&c.length>0,shadowMapType:e.shadowMap.type,toneMapping:s.toneMapped?e.toneMapping:0,physicallyCorrectLights:e.physicallyCorrectLights,premultipliedAlpha:s.premultipliedAlpha,doubleSided:2===s.side,flipSided:1===s.side,useDepthPacking:!!s.depthPacking,depthPacking:s.depthPacking||0,index0AttributeName:s.index0AttributeName,extensionDerivatives:s.extensions&&s.extensions.derivatives,extensionFragDepth:s.extensions&&s.extensions.fragDepth,extensionDrawBuffers:s.extensions&&s.extensions.drawBuffers,extensionShaderTextureLOD:s.extensions&&s.extensions.shaderTextureLOD,rendererExtensionFragDepth:h||i.has("EXT_frag_depth"),rendererExtensionDrawBuffers:h||i.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:h||i.has("EXT_shader_texture_lod"),customProgramCacheKey:s.customProgramCacheKey()}},getProgramCacheKey:function(t){let n=[];if(t.shaderID?n.push(t.shaderID):(n.push(t.customVertexShaderID),n.push(t.customFragmentShaderID)),void 0!==t.defines)for(let e in t.defines)n.push(e),n.push(t.defines[e]);return!1===t.isRawShaderMaterial&&(function(e,t){e.push(t.precision),e.push(t.outputEncoding),e.push(t.envMapMode),e.push(t.envMapCubeUVHeight),e.push(t.combine),e.push(t.vertexUvs),e.push(t.fogExp2),e.push(t.sizeAttenuation),e.push(t.morphTargetsCount),e.push(t.morphAttributeCount),e.push(t.numDirLights),e.push(t.numPointLights),e.push(t.numSpotLights),e.push(t.numSpotLightMaps),e.push(t.numHemiLights),e.push(t.numRectAreaLights),e.push(t.numDirLightShadows),e.push(t.numPointLightShadows),e.push(t.numSpotLightShadows),e.push(t.numSpotLightShadowsWithMaps),e.push(t.shadowMapType),e.push(t.toneMapping),e.push(t.numClippingPlanes),e.push(t.numClipIntersection),e.push(t.depthPacking)}(n,t),function(e,t){o.disableAll(),t.isWebGL2&&o.enable(0),t.supportsVertexTextures&&o.enable(1),t.instancing&&o.enable(2),t.instancingColor&&o.enable(3),t.map&&o.enable(4),t.matcap&&o.enable(5),t.envMap&&o.enable(6),t.lightMap&&o.enable(7),t.aoMap&&o.enable(8),t.emissiveMap&&o.enable(9),t.bumpMap&&o.enable(10),t.normalMap&&o.enable(11),t.objectSpaceNormalMap&&o.enable(12),t.tangentSpaceNormalMap&&o.enable(13),t.clearcoat&&o.enable(14),t.clearcoatMap&&o.enable(15),t.clearcoatRoughnessMap&&o.enable(16),t.clearcoatNormalMap&&o.enable(17),t.iridescence&&o.enable(18),t.iridescenceMap&&o.enable(19),t.iridescenceThicknessMap&&o.enable(20),t.displacementMap&&o.enable(21),t.specularMap&&o.enable(22),t.roughnessMap&&o.enable(23),t.metalnessMap&&o.enable(24),t.gradientMap&&o.enable(25),t.alphaMap&&o.enable(26),t.alphaTest&&o.enable(27),t.vertexColors&&o.enable(28),t.vertexAlphas&&o.enable(29),t.vertexUvs&&o.enable(30),t.vertexTangents&&o.enable(31),t.uvsVertexOnly&&o.enable(32),e.push(o.mask),o.disableAll(),t.fog&&o.enable(0),t.useFog&&o.enable(1),t.flatShading&&o.enable(2),t.logarithmicDepthBuffer&&o.enable(3),t.skinning&&o.enable(4),t.morphTargets&&o.enable(5),t.morphNormals&&o.enable(6),t.morphColors&&o.enable(7),t.premultipliedAlpha&&o.enable(8),t.shadowMapEnabled&&o.enable(9),t.physicallyCorrectLights&&o.enable(10),t.doubleSided&&o.enable(11),t.flipSided&&o.enable(12),t.useDepthPacking&&o.enable(13),t.dithering&&o.enable(14),t.specularIntensityMap&&o.enable(15),t.specularColorMap&&o.enable(16),t.transmission&&o.enable(17),t.transmissionMap&&o.enable(18),t.thicknessMap&&o.enable(19),t.sheen&&o.enable(20),t.sheenColorMap&&o.enable(21),t.sheenRoughnessMap&&o.enable(22),t.decodeVideoTexture&&o.enable(23),t.opaque&&o.enable(24),e.push(o.mask)}(n,t),n.push(e.outputEncoding)),n.push(t.customProgramCacheKey),n.join()},getUniforms:function(e){let t,n=f[e.type];if(n){let e=Ji[n];t=Ii.clone(e.uniforms)}else t=e.uniforms;return t},acquireProgram:function(t,n){let i;for(let e=0,r=c.length;e<r;e++){let t=c[e];if(t.cacheKey===n){i=t,++i.usedTimes;break}}return void 0===i&&(i=new Ys(e,n,t,s),c.push(i)),i},releaseProgram:function(e){if(0===--e.usedTimes){let t=c.indexOf(e);c[t]=c[c.length-1],c.pop(),e.destroy()}},releaseShaderCache:function(e){l.remove(e)},programs:c,dispose:function(){l.dispose()}}}function $s(){let e=new WeakMap;return{get:function(t){let n=e.get(t);return void 0===n&&(n={},e.set(t,n)),n},remove:function(t){e.delete(t)},update:function(t,n,i){e.get(t)[n]=i},dispose:function(){e=new WeakMap}}}function ea(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.material.id!==t.material.id?e.material.id-t.material.id:e.z!==t.z?e.z-t.z:e.id-t.id}function ta(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.z!==t.z?t.z-e.z:e.id-t.id}function na(){let e=[],t=0,n=[],i=[],r=[];function s(n,i,r,s,a,o){let l=e[t];return void 0===l?(l={id:n.id,object:n,geometry:i,material:r,groupOrder:s,renderOrder:n.renderOrder,z:a,group:o},e[t]=l):(l.id=n.id,l.object=n,l.geometry=i,l.material=r,l.groupOrder=s,l.renderOrder=n.renderOrder,l.z=a,l.group=o),t++,l}return{opaque:n,transmissive:i,transparent:r,init:function(){t=0,n.length=0,i.length=0,r.length=0},push:function(e,t,a,o,l,c){let h=s(e,t,a,o,l,c);a.transmission>0?i.push(h):!0===a.transparent?r.push(h):n.push(h)},unshift:function(e,t,a,o,l,c){let h=s(e,t,a,o,l,c);a.transmission>0?i.unshift(h):!0===a.transparent?r.unshift(h):n.unshift(h)},finish:function(){for(let n=t,i=e.length;n<i;n++){let t=e[n];if(null===t.id)break;t.id=null,t.object=null,t.geometry=null,t.material=null,t.group=null}},sort:function(e,t){n.length>1&&n.sort(e||ea),i.length>1&&i.sort(t||ta),r.length>1&&r.sort(t||ta)}}}function ia(){let e=new WeakMap;return{get:function(t,n){let i,r=e.get(t);return void 0===r?(i=new na,e.set(t,[i])):n>=r.length?(i=new na,r.push(i)):i=r[n],i},dispose:function(){e=new WeakMap}}}function ra(){let e={};return{get:function(t){if(void 0!==e[t.id])return e[t.id];let n;switch(t.type){case"DirectionalLight":n={direction:new Bt,color:new Et};break;case"SpotLight":n={position:new Bt,direction:new Bt,color:new Et,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":n={position:new Bt,color:new Et,distance:0,decay:0};break;case"HemisphereLight":n={direction:new Bt,skyColor:new Et,groundColor:new Et};break;case"RectAreaLight":n={color:new Et,position:new Bt,halfWidth:new Bt,halfHeight:new Bt}}return e[t.id]=n,n}}}var sa=0;function aa(e,t){return(t.castShadow?2:0)-(e.castShadow?2:0)+(t.map?1:0)-(e.map?1:0)}function oa(e,t){let n=new ra,i=function(){let e={};return{get:function(t){if(void 0!==e[t.id])return e[t.id];let n;switch(t.type){case"DirectionalLight":case"SpotLight":n={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new ot};break;case"PointLight":n={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new ot,shadowCameraNear:1,shadowCameraFar:1e3}}return e[t.id]=n,n}}}(),r={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0};for(let l=0;l<9;l++)r.probe.push(new Bt);let s=new Bt,a=new pn,o=new pn;return{setup:function(s,a){let o=0,l=0,c=0;for(let e=0;e<9;e++)r.probe[e].set(0,0,0);let h=0,u=0,d=0,p=0,f=0,m=0,g=0,v=0,y=0,b=0;s.sort(aa);let x=!0!==a?Math.PI:1;for(let e=0,t=s.length;e<t;e++){let t=s[e],a=t.color,w=t.intensity,S=t.distance,_=t.shadow&&t.shadow.map?t.shadow.map.texture:null;if(t.isAmbientLight)o+=a.r*w*x,l+=a.g*w*x,c+=a.b*w*x;else if(t.isLightProbe)for(let e=0;e<9;e++)r.probe[e].addScaledVector(t.sh.coefficients[e],w);else if(t.isDirectionalLight){let e=n.get(t);if(e.color.copy(t.color).multiplyScalar(t.intensity*x),t.castShadow){let e=t.shadow,n=i.get(t);n.shadowBias=e.bias,n.shadowNormalBias=e.normalBias,n.shadowRadius=e.radius,n.shadowMapSize=e.mapSize,r.directionalShadow[h]=n,r.directionalShadowMap[h]=_,r.directionalShadowMatrix[h]=t.shadow.matrix,m++}r.directional[h]=e,h++}else if(t.isSpotLight){let e=n.get(t);e.position.setFromMatrixPosition(t.matrixWorld),e.color.copy(a).multiplyScalar(w*x),e.distance=S,e.coneCos=Math.cos(t.angle),e.penumbraCos=Math.cos(t.angle*(1-t.penumbra)),e.decay=t.decay,r.spot[d]=e;let s=t.shadow;if(t.map&&(r.spotLightMap[y]=t.map,y++,s.updateMatrices(t),t.castShadow&&b++),r.spotLightMatrix[d]=s.matrix,t.castShadow){let e=i.get(t);e.shadowBias=s.bias,e.shadowNormalBias=s.normalBias,e.shadowRadius=s.radius,e.shadowMapSize=s.mapSize,r.spotShadow[d]=e,r.spotShadowMap[d]=_,v++}d++}else if(t.isRectAreaLight){let e=n.get(t);e.color.copy(a).multiplyScalar(w),e.halfWidth.set(.5*t.width,0,0),e.halfHeight.set(0,.5*t.height,0),r.rectArea[p]=e,p++}else if(t.isPointLight){let e=n.get(t);if(e.color.copy(t.color).multiplyScalar(t.intensity*x),e.distance=t.distance,e.decay=t.decay,t.castShadow){let e=t.shadow,n=i.get(t);n.shadowBias=e.bias,n.shadowNormalBias=e.normalBias,n.shadowRadius=e.radius,n.shadowMapSize=e.mapSize,n.shadowCameraNear=e.camera.near,n.shadowCameraFar=e.camera.far,r.pointShadow[u]=n,r.pointShadowMap[u]=_,r.pointShadowMatrix[u]=t.shadow.matrix,g++}r.point[u]=e,u++}else if(t.isHemisphereLight){let e=n.get(t);e.skyColor.copy(t.color).multiplyScalar(w*x),e.groundColor.copy(t.groundColor).multiplyScalar(w*x),r.hemi[f]=e,f++}}p>0&&(t.isWebGL2||!0===e.has("OES_texture_float_linear")?(r.rectAreaLTC1=Zi.LTC_FLOAT_1,r.rectAreaLTC2=Zi.LTC_FLOAT_2):!0===e.has("OES_texture_half_float_linear")?(r.rectAreaLTC1=Zi.LTC_HALF_1,r.rectAreaLTC2=Zi.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),r.ambient[0]=o,r.ambient[1]=l,r.ambient[2]=c;let w=r.hash;(w.directionalLength!==h||w.pointLength!==u||w.spotLength!==d||w.rectAreaLength!==p||w.hemiLength!==f||w.numDirectionalShadows!==m||w.numPointShadows!==g||w.numSpotShadows!==v||w.numSpotMaps!==y)&&(r.directional.length=h,r.spot.length=d,r.rectArea.length=p,r.point.length=u,r.hemi.length=f,r.directionalShadow.length=m,r.directionalShadowMap.length=m,r.pointShadow.length=g,r.pointShadowMap.length=g,r.spotShadow.length=v,r.spotShadowMap.length=v,r.directionalShadowMatrix.length=m,r.pointShadowMatrix.length=g,r.spotLightMatrix.length=v+y-b,r.spotLightMap.length=y,r.numSpotLightShadowsWithMaps=b,w.directionalLength=h,w.pointLength=u,w.spotLength=d,w.rectAreaLength=p,w.hemiLength=f,w.numDirectionalShadows=m,w.numPointShadows=g,w.numSpotShadows=v,w.numSpotMaps=y,r.version=sa++)},setupView:function(e,t){let n=0,i=0,l=0,c=0,h=0,u=t.matrixWorldInverse;for(let d=0,p=e.length;d<p;d++){let t=e[d];if(t.isDirectionalLight){let e=r.directional[n];e.direction.setFromMatrixPosition(t.matrixWorld),s.setFromMatrixPosition(t.target.matrixWorld),e.direction.sub(s),e.direction.transformDirection(u),n++}else if(t.isSpotLight){let e=r.spot[l];e.position.setFromMatrixPosition(t.matrixWorld),e.position.applyMatrix4(u),e.direction.setFromMatrixPosition(t.matrixWorld),s.setFromMatrixPosition(t.target.matrixWorld),e.direction.sub(s),e.direction.transformDirection(u),l++}else if(t.isRectAreaLight){let e=r.rectArea[c];e.position.setFromMatrixPosition(t.matrixWorld),e.position.applyMatrix4(u),o.identity(),a.copy(t.matrixWorld),a.premultiply(u),o.extractRotation(a),e.halfWidth.set(.5*t.width,0,0),e.halfHeight.set(0,.5*t.height,0),e.halfWidth.applyMatrix4(o),e.halfHeight.applyMatrix4(o),c++}else if(t.isPointLight){let e=r.point[i];e.position.setFromMatrixPosition(t.matrixWorld),e.position.applyMatrix4(u),i++}else if(t.isHemisphereLight){let e=r.hemi[h];e.direction.setFromMatrixPosition(t.matrixWorld),e.direction.transformDirection(u),h++}}},state:r}}function la(e,t){let n=new oa(e,t),i=[],r=[];return{init:function(){i.length=0,r.length=0},state:{lightsArray:i,shadowsArray:r,lights:n},setupLights:function(e){n.setup(i,e)},setupLightsView:function(e){n.setupView(i,e)},pushLight:function(e){i.push(e)},pushShadow:function(e){r.push(e)}}}function ca(e,t){let n=new WeakMap;return{get:function(i){let r,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a=n.get(i);return void 0===a?(r=new la(e,t),n.set(i,[r])):s>=a.length?(r=new la(e,t),a.push(r)):r=a[s],r},dispose:function(){n=new WeakMap}}}var ha=class extends Zn{constructor(e){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=Fe,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}},ua=class extends Zn{constructor(e){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.referencePosition=new Bt,this.nearDistance=1,this.farDistance=1e3,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(e)}copy(e){return super.copy(e),this.referencePosition.copy(e.referencePosition),this.nearDistance=e.nearDistance,this.farDistance=e.farDistance,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}};function da(e,t,n){let i=new qi,r=new ot,s=new ot,a=new Ot,o=new ha({depthPacking:3201}),l=new ua,c={},h=n.maxTextureSize,u={[F]:1,[U]:0,[j]:2},d=new Ri({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new ot},radius:{value:4}},vertexShader:"void main() {\n\tgl_Position = vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\n#include <packing>\nvoid main() {\n\tconst float samples = float( VSM_SAMPLES );\n\tfloat mean = 0.0;\n\tfloat squared_mean = 0.0;\n\tfloat uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );\n\tfloat uvStart = samples <= 1.0 ? 0.0 : - 1.0;\n\tfor ( float i = 0.0; i < samples; i ++ ) {\n\t\tfloat uvOffset = uvStart + i * uvStride;\n\t\t#ifdef HORIZONTAL_PASS\n\t\t\tvec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );\n\t\t\tmean += distribution.x;\n\t\t\tsquared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n\t\t#else\n\t\t\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );\n\t\t\tmean += depth;\n\t\t\tsquared_mean += depth * depth;\n\t\t#endif\n\t}\n\tmean = mean / samples;\n\tsquared_mean = squared_mean / samples;\n\tfloat std_dev = sqrt( squared_mean - mean * mean );\n\tgl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\n}"}),p=d.clone();p.defines.HORIZONTAL_PASS=1;let f=new di;f.setAttribute("position",new ti(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));let m=new Ci(f,d),g=this;function v(n,i){let s=t.update(m);d.defines.VSM_SAMPLES!==n.blurSamples&&(d.defines.VSM_SAMPLES=n.blurSamples,p.defines.VSM_SAMPLES=n.blurSamples,d.needsUpdate=!0,p.needsUpdate=!0),null===n.mapPass&&(n.mapPass=new It(r.x,r.y)),d.uniforms.shadow_pass.value=n.map.texture,d.uniforms.resolution.value=n.mapSize,d.uniforms.radius.value=n.radius,e.setRenderTarget(n.mapPass),e.clear(),e.renderBufferDirect(i,null,s,d,m,null),p.uniforms.shadow_pass.value=n.mapPass.texture,p.uniforms.resolution.value=n.mapSize,p.uniforms.radius.value=n.radius,e.setRenderTarget(n.map),e.clear(),e.renderBufferDirect(i,null,s,p,m,null)}function y(t,n,i,r,s,a){let h=null,d=!0===i.isPointLight?t.customDistanceMaterial:t.customDepthMaterial;if(void 0!==d)h=d;else if(h=!0===i.isPointLight?l:o,e.localClippingEnabled&&!0===n.clipShadows&&Array.isArray(n.clippingPlanes)&&0!==n.clippingPlanes.length||n.displacementMap&&0!==n.displacementScale||n.alphaMap&&n.alphaTest>0||n.map&&n.alphaTest>0){let e=h.uuid,t=n.uuid,i=c[e];void 0===i&&(i={},c[e]=i);let r=i[t];void 0===r&&(r=h.clone(),i[t]=r),h=r}return h.visible=n.visible,h.wireframe=n.wireframe,h.side=3===a?null!==n.shadowSide?n.shadowSide:n.side:null!==n.shadowSide?n.shadowSide:u[n.side],h.alphaMap=n.alphaMap,h.alphaTest=n.alphaTest,h.map=n.map,h.clipShadows=n.clipShadows,h.clippingPlanes=n.clippingPlanes,h.clipIntersection=n.clipIntersection,h.displacementMap=n.displacementMap,h.displacementScale=n.displacementScale,h.displacementBias=n.displacementBias,h.wireframeLinewidth=n.wireframeLinewidth,h.linewidth=n.linewidth,!0===i.isPointLight&&!0===h.isMeshDistanceMaterial&&(h.referencePosition.setFromMatrixPosition(i.matrixWorld),h.nearDistance=r,h.farDistance=s),h}function b(n,r,s,a,o){if(!1===n.visible)return;if(n.layers.test(r.layers)&&(n.isMesh||n.isLine||n.isPoints)&&(n.castShadow||n.receiveShadow&&3===o)&&(!n.frustumCulled||i.intersectsObject(n))){n.modelViewMatrix.multiplyMatrices(s.matrixWorldInverse,n.matrixWorld);let i=t.update(n),r=n.material;if(Array.isArray(r)){let t=i.groups;for(let l=0,c=t.length;l<c;l++){let c=t[l],h=r[c.materialIndex];if(h&&h.visible){let t=y(n,h,a,s.near,s.far,o);e.renderBufferDirect(s,null,i,t,n,c)}}}else if(r.visible){let t=y(n,r,a,s.near,s.far,o);e.renderBufferDirect(s,null,i,t,n,null)}}let l=n.children;for(let e=0,t=l.length;e<t;e++)b(l[e],r,s,a,o)}this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=1,this.render=function(t,n,o){if(!1===g.enabled||!1===g.autoUpdate&&!1===g.needsUpdate||0===t.length)return;let l=e.getRenderTarget(),c=e.getActiveCubeFace(),u=e.getActiveMipmapLevel(),d=e.state;d.setBlending(0),d.buffers.color.setClear(1,1,1,1),d.buffers.depth.setTest(!0),d.setScissorTest(!1);for(let p=0,f=t.length;p<f;p++){let l=t[p],c=l.shadow;if(void 0===c){console.warn("THREE.WebGLShadowMap:",l,"has no shadow.");continue}if(!1===c.autoUpdate&&!1===c.needsUpdate)continue;r.copy(c.mapSize);let u=c.getFrameExtents();if(r.multiply(u),s.copy(c.mapSize),(r.x>h||r.y>h)&&(r.x>h&&(s.x=Math.floor(h/u.x),r.x=s.x*u.x,c.mapSize.x=s.x),r.y>h&&(s.y=Math.floor(h/u.y),r.y=s.y*u.y,c.mapSize.y=s.y)),null===c.map){let e=3!==this.type?{minFilter:le,magFilter:le}:{};c.map=new It(r.x,r.y,e),c.map.texture.name=l.name+".shadowMap",c.camera.updateProjectionMatrix()}e.setRenderTarget(c.map),e.clear();let f=c.getViewportCount();for(let e=0;e<f;e++){let t=c.getViewport(e);a.set(s.x*t.x,s.y*t.y,s.x*t.z,s.y*t.w),d.viewport(a),c.updateMatrices(l,e),i=c.getFrustum(),b(n,o,c.camera,l,this.type)}!0!==c.isPointLightShadow&&3===this.type&&v(c,o),c.needsUpdate=!1}g.needsUpdate=!1,e.setRenderTarget(l,c,u)}}function pa(e,t,n){let i=n.isWebGL2;let r=new function(){let t=!1,n=new Ot,i=null,r=new Ot(0,0,0,0);return{setMask:function(n){i!==n&&!t&&(e.colorMask(n,n,n,n),i=n)},setLocked:function(e){t=e},setClear:function(t,i,s,a,o){!0===o&&(t*=a,i*=a,s*=a),n.set(t,i,s,a),!1===r.equals(n)&&(e.clearColor(t,i,s,a),r.copy(n))},reset:function(){t=!1,i=null,r.set(-1,0,0,0)}}},s=new function(){let t=!1,n=null,i=null,r=null;return{setTest:function(e){e?U(2929):j(2929)},setMask:function(i){n!==i&&!t&&(e.depthMask(i),n=i)},setFunc:function(t){if(i!==t){switch(t){case 0:e.depthFunc(512);break;case 1:e.depthFunc(519);break;case 2:e.depthFunc(513);break;case 3:default:e.depthFunc(515);break;case 4:e.depthFunc(514);break;case 5:e.depthFunc(518);break;case 6:e.depthFunc(516);break;case 7:e.depthFunc(517)}i=t}},setLocked:function(e){t=e},setClear:function(t){r!==t&&(e.clearDepth(t),r=t)},reset:function(){t=!1,n=null,i=null,r=null}}},a=new function(){let t=!1,n=null,i=null,r=null,s=null,a=null,o=null,l=null,c=null;return{setTest:function(e){t||(e?U(2960):j(2960))},setMask:function(i){n!==i&&!t&&(e.stencilMask(i),n=i)},setFunc:function(t,n,a){(i!==t||r!==n||s!==a)&&(e.stencilFunc(t,n,a),i=t,r=n,s=a)},setOp:function(t,n,i){(a!==t||o!==n||l!==i)&&(e.stencilOp(t,n,i),a=t,o=n,l=i)},setLocked:function(e){t=e},setClear:function(t){c!==t&&(e.clearStencil(t),c=t)},reset:function(){t=!1,n=null,i=null,r=null,s=null,a=null,o=null,l=null,c=null}}},o=new WeakMap,l=new WeakMap,c={},h={},u=new WeakMap,d=[],p=null,f=!1,m=null,g=null,v=null,y=null,b=null,x=null,w=null,S=!1,_=null,E=null,A=null,C=null,M=null,T=e.getParameter(35661),P=!1,D=0,O=e.getParameter(7938);-1!==O.indexOf("WebGL")?(D=parseFloat(/^WebGL (\d)/.exec(O)[1]),P=D>=1):-1!==O.indexOf("OpenGL ES")&&(D=parseFloat(/^OpenGL ES (\d)/.exec(O)[1]),P=D>=2);let I=null,R={},k=e.getParameter(3088),L=e.getParameter(2978),B=(new Ot).fromArray(k),z=(new Ot).fromArray(L);function N(t,n,i){let r=new Uint8Array(4),s=e.createTexture();e.bindTexture(t,s),e.texParameteri(t,10241,9728),e.texParameteri(t,10240,9728);for(let a=0;a<i;a++)e.texImage2D(n+a,0,6408,1,1,0,6408,5121,r);return s}let F={};function U(t){!0!==c[t]&&(e.enable(t),c[t]=!0)}function j(t){!1!==c[t]&&(e.disable(t),c[t]=!1)}F[3553]=N(3553,3553,1),F[34067]=N(34067,34069,6),r.setClear(0,0,0,1),s.setClear(1),a.setClear(0),U(2929),s.setFunc(3),se(!1),ae(1),U(2884),re(0);let ne={[V]:32774,[G]:32778,[H]:32779};if(i)ne[103]=32775,ne[104]=32776;else{let e=t.get("EXT_blend_minmax");null!==e&&(ne[103]=e.MIN_EXT,ne[104]=e.MAX_EXT)}let ie={[W]:0,[q]:1,[X]:768,[Q]:770,[te]:776,[$]:774,[Z]:772,[Y]:769,[K]:771,[ee]:775,[J]:773};function re(t,n,i,r,s,a,o,l){if(0!==t){if(!1===f&&(U(3042),f=!0),5===t)s=s||n,a=a||i,o=o||r,(n!==g||s!==b)&&(e.blendEquationSeparate(ne[n],ne[s]),g=n,b=s),(i!==v||r!==y||a!==x||o!==w)&&(e.blendFuncSeparate(ie[i],ie[r],ie[a],ie[o]),v=i,y=r,x=a,w=o),m=t,S=!1;else if(t!==m||l!==S){if((g!==V||b!==V)&&(e.blendEquation(32774),g=V,b=V),l)switch(t){case 1:e.blendFuncSeparate(1,771,1,771);break;case 2:e.blendFunc(1,1);break;case 3:e.blendFuncSeparate(0,769,0,1);break;case 4:e.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}else switch(t){case 1:e.blendFuncSeparate(770,771,1,771);break;case 2:e.blendFunc(770,1);break;case 3:e.blendFuncSeparate(0,769,0,1);break;case 4:e.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}v=null,y=null,x=null,w=null,m=t,S=l}}else!0===f&&(j(3042),f=!1)}function se(t){_!==t&&(t?e.frontFace(2304):e.frontFace(2305),_=t)}function ae(t){0!==t?(U(2884),t!==E&&(1===t?e.cullFace(1029):2===t?e.cullFace(1028):e.cullFace(1032))):j(2884),E=t}function oe(t,n,i){t?(U(32823),(C!==n||M!==i)&&(e.polygonOffset(n,i),C=n,M=i)):j(32823)}return{buffers:{color:r,depth:s,stencil:a},enable:U,disable:j,bindFramebuffer:function(t,n){return h[t]!==n&&(e.bindFramebuffer(t,n),h[t]=n,i&&(36009===t&&(h[36160]=n),36160===t&&(h[36009]=n)),!0)},drawBuffers:function(i,r){let s=d,a=!1;if(i)if(s=u.get(r),void 0===s&&(s=[],u.set(r,s)),i.isWebGLMultipleRenderTargets){let e=i.texture;if(s.length!==e.length||36064!==s[0]){for(let t=0,n=e.length;t<n;t++)s[t]=36064+t;s.length=e.length,a=!0}}else 36064!==s[0]&&(s[0]=36064,a=!0);else 1029!==s[0]&&(s[0]=1029,a=!0);a&&(n.isWebGL2?e.drawBuffers(s):t.get("WEBGL_draw_buffers").drawBuffersWEBGL(s))},useProgram:function(t){return p!==t&&(e.useProgram(t),p=t,!0)},setBlending:re,setMaterial:function(e,t){2===e.side?j(2884):U(2884);let n=1===e.side;t&&(n=!n),se(n),1===e.blending&&!1===e.transparent?re(0):re(e.blending,e.blendEquation,e.blendSrc,e.blendDst,e.blendEquationAlpha,e.blendSrcAlpha,e.blendDstAlpha,e.premultipliedAlpha),s.setFunc(e.depthFunc),s.setTest(e.depthTest),s.setMask(e.depthWrite),r.setMask(e.colorWrite);let i=e.stencilWrite;a.setTest(i),i&&(a.setMask(e.stencilWriteMask),a.setFunc(e.stencilFunc,e.stencilRef,e.stencilFuncMask),a.setOp(e.stencilFail,e.stencilZFail,e.stencilZPass)),oe(e.polygonOffset,e.polygonOffsetFactor,e.polygonOffsetUnits),!0===e.alphaToCoverage?U(32926):j(32926)},setFlipSided:se,setCullFace:ae,setLineWidth:function(t){t!==A&&(P&&e.lineWidth(t),A=t)},setPolygonOffset:oe,setScissorTest:function(e){e?U(3089):j(3089)},activeTexture:function(t){void 0===t&&(t=33984+T-1),I!==t&&(e.activeTexture(t),I=t)},bindTexture:function(t,n,i){void 0===i&&(i=null===I?33984+T-1:I);let r=R[i];void 0===r&&(r={type:void 0,texture:void 0},R[i]=r),(r.type!==t||r.texture!==n)&&(I!==i&&(e.activeTexture(i),I=i),e.bindTexture(t,n||F[t]),r.type=t,r.texture=n)},unbindTexture:function(){let t=R[I];void 0!==t&&void 0!==t.type&&(e.bindTexture(t.type,null),t.type=void 0,t.texture=void 0)},compressedTexImage2D:function(){try{e.compressedTexImage2D.apply(e,arguments)}catch(cG){console.error("THREE.WebGLState:",cG)}},compressedTexImage3D:function(){try{e.compressedTexImage3D.apply(e,arguments)}catch(cG){console.error("THREE.WebGLState:",cG)}},texImage2D:function(){try{e.texImage2D.apply(e,arguments)}catch(cG){console.error("THREE.WebGLState:",cG)}},texImage3D:function(){try{e.texImage3D.apply(e,arguments)}catch(cG){console.error("THREE.WebGLState:",cG)}},updateUBOMapping:function(t,n){let i=l.get(n);void 0===i&&(i=new WeakMap,l.set(n,i));let r=i.get(t);void 0===r&&(r=e.getUniformBlockIndex(n,t.name),i.set(t,r))},uniformBlockBinding:function(t,n){let i=l.get(n).get(t);o.get(n)!==i&&(e.uniformBlockBinding(n,i,t.__bindingPointIndex),o.set(n,i))},texStorage2D:function(){try{e.texStorage2D.apply(e,arguments)}catch(cG){console.error("THREE.WebGLState:",cG)}},texStorage3D:function(){try{e.texStorage3D.apply(e,arguments)}catch(cG){console.error("THREE.WebGLState:",cG)}},texSubImage2D:function(){try{e.texSubImage2D.apply(e,arguments)}catch(cG){console.error("THREE.WebGLState:",cG)}},texSubImage3D:function(){try{e.texSubImage3D.apply(e,arguments)}catch(cG){console.error("THREE.WebGLState:",cG)}},compressedTexSubImage2D:function(){try{e.compressedTexSubImage2D.apply(e,arguments)}catch(cG){console.error("THREE.WebGLState:",cG)}},compressedTexSubImage3D:function(){try{e.compressedTexSubImage3D.apply(e,arguments)}catch(cG){console.error("THREE.WebGLState:",cG)}},scissor:function(t){!1===B.equals(t)&&(e.scissor(t.x,t.y,t.z,t.w),B.copy(t))},viewport:function(t){!1===z.equals(t)&&(e.viewport(t.x,t.y,t.z,t.w),z.copy(t))},reset:function(){e.disable(3042),e.disable(2884),e.disable(2929),e.disable(32823),e.disable(3089),e.disable(2960),e.disable(32926),e.blendEquation(32774),e.blendFunc(1,0),e.blendFuncSeparate(1,0,1,0),e.colorMask(!0,!0,!0,!0),e.clearColor(0,0,0,0),e.depthMask(!0),e.depthFunc(513),e.clearDepth(1),e.stencilMask(4294967295),e.stencilFunc(519,0,4294967295),e.stencilOp(7680,7680,7680),e.clearStencil(0),e.cullFace(1029),e.frontFace(2305),e.polygonOffset(0,0),e.activeTexture(33984),e.bindFramebuffer(36160,null),!0===i&&(e.bindFramebuffer(36009,null),e.bindFramebuffer(36008,null)),e.useProgram(null),e.lineWidth(1),e.scissor(0,0,e.canvas.width,e.canvas.height),e.viewport(0,0,e.canvas.width,e.canvas.height),c={},I=null,R={},h={},u=new WeakMap,d=[],p=null,f=!1,m=null,g=null,v=null,y=null,b=null,x=null,w=null,S=!1,_=null,E=null,A=null,C=null,M=null,B.set(0,0,e.canvas.width,e.canvas.height),z.set(0,0,e.canvas.width,e.canvas.height),r.reset(),s.reset(),a.reset()}}}function fa(e,t,n,i,r,s,a){let o,l=r.isWebGL2,c=r.maxTextures,h=r.maxCubemapSize,u=r.maxTextureSize,d=r.maxSamples,p=t.has("WEBGL_multisampled_render_to_texture")?t.get("WEBGL_multisampled_render_to_texture"):null,f=!(typeof navigator>"u")&&/OculusBrowser/g.test(navigator.userAgent),m=new WeakMap,g=new WeakMap,v=!1;try{v=typeof OffscreenCanvas<"u"&&null!==new OffscreenCanvas(1,1).getContext("2d")}catch(V){}function y(e,t){return v?new OffscreenCanvas(e,t):pt("canvas")}function b(e,t,n,i){let r=1;if((e.width>i||e.height>i)&&(r=i/Math.max(e.width,e.height)),r<1||!0===t){if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap){let i=t?it:Math.floor,s=i(r*e.width),a=i(r*e.height);void 0===o&&(o=y(s,a));let l=n?y(s,a):o;return l.width=s,l.height=a,l.getContext("2d").drawImage(e,0,0,s,a),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+e.width+"x"+e.height+") to ("+s+"x"+a+")."),l}return"data"in e&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+e.width+"x"+e.height+")."),e}return e}function x(e){return tt(e.width)&&tt(e.height)}function w(e,t){return e.generateMipmaps&&t&&e.minFilter!==le&&e.minFilter!==ue}function S(t){e.generateMipmap(t)}function _(n,i,r,s){let a=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(!1===l)return i;if(null!==n){if(void 0!==e[n])return e[n];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+n+"'")}let o=i;return 6403===i&&(5126===r&&(o=33326),5131===r&&(o=33325),5121===r&&(o=33321)),33319===i&&(5126===r&&(o=33328),5131===r&&(o=33327),5121===r&&(o=33323)),6408===i&&(5126===r&&(o=34836),5131===r&&(o=34842),5121===r&&(o=s===Ne&&!1===a?35907:32856),32819===r&&(o=32854),32820===r&&(o=32855)),(33325===o||33326===o||33327===o||33328===o||34842===o||34836===o)&&t.get("EXT_color_buffer_float"),o}function E(e,t,n){return!0===w(e,n)||e.isFramebufferTexture&&e.minFilter!==le&&e.minFilter!==ue?Math.log2(Math.max(t.width,t.height))+1:void 0!==e.mipmaps&&e.mipmaps.length>0?e.mipmaps.length:e.isCompressedTexture&&Array.isArray(e.image)?t.mipmaps.length:1}function A(e){return e===le||1004===e||e===he?9728:9729}function C(e){let t=e.target;t.removeEventListener("dispose",C),function(e){let t=i.get(e);if(void 0===t.__webglInit)return;let n=e.source,r=g.get(n);if(r){let i=r[t.__cacheKey];i.usedTimes--,0===i.usedTimes&&T(e),0===Object.keys(r).length&&g.delete(n)}i.remove(e)}(t),t.isVideoTexture&&m.delete(t)}function M(t){let n=t.target;n.removeEventListener("dispose",M),function(t){let n=t.texture,r=i.get(t),s=i.get(n);if(void 0!==s.__webglTexture&&(e.deleteTexture(s.__webglTexture),a.memory.textures--),t.depthTexture&&t.depthTexture.dispose(),t.isWebGLCubeRenderTarget)for(let i=0;i<6;i++)e.deleteFramebuffer(r.__webglFramebuffer[i]),r.__webglDepthbuffer&&e.deleteRenderbuffer(r.__webglDepthbuffer[i]);else{if(e.deleteFramebuffer(r.__webglFramebuffer),r.__webglDepthbuffer&&e.deleteRenderbuffer(r.__webglDepthbuffer),r.__webglMultisampledFramebuffer&&e.deleteFramebuffer(r.__webglMultisampledFramebuffer),r.__webglColorRenderbuffer)for(let t=0;t<r.__webglColorRenderbuffer.length;t++)r.__webglColorRenderbuffer[t]&&e.deleteRenderbuffer(r.__webglColorRenderbuffer[t]);r.__webglDepthRenderbuffer&&e.deleteRenderbuffer(r.__webglDepthRenderbuffer)}if(t.isWebGLMultipleRenderTargets)for(let o=0,l=n.length;o<l;o++){let t=i.get(n[o]);t.__webglTexture&&(e.deleteTexture(t.__webglTexture),a.memory.textures--),i.remove(n[o])}i.remove(n),i.remove(t)}(n)}function T(t){let n=i.get(t);e.deleteTexture(n.__webglTexture);let r=t.source;delete g.get(r)[n.__cacheKey],a.memory.textures--}let P=0;function D(e,t){let r=i.get(e);if(e.isVideoTexture&&function(e){let t=a.render.frame;m.get(e)!==t&&(m.set(e,t),e.update())}(e),!1===e.isRenderTargetTexture&&e.version>0&&r.__version!==e.version){let n=e.image;if(null===n)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else{if(!1!==n.complete)return void L(r,e,t);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}n.bindTexture(3553,r.__webglTexture,33984+t)}let O={[se]:10497,[ae]:33071,[oe]:33648},I={[le]:9728,[ce]:9984,[he]:9986,[ue]:9729,[de]:9985,[pe]:9987};function R(n,s,a){if(a?(e.texParameteri(n,10242,O[s.wrapS]),e.texParameteri(n,10243,O[s.wrapT]),(32879===n||35866===n)&&e.texParameteri(n,32882,O[s.wrapR]),e.texParameteri(n,10240,I[s.magFilter]),e.texParameteri(n,10241,I[s.minFilter])):(e.texParameteri(n,10242,33071),e.texParameteri(n,10243,33071),(32879===n||35866===n)&&e.texParameteri(n,32882,33071),(s.wrapS!==ae||s.wrapT!==ae)&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),e.texParameteri(n,10240,A(s.magFilter)),e.texParameteri(n,10241,A(s.minFilter)),s.minFilter!==le&&s.minFilter!==ue&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),!0===t.has("EXT_texture_filter_anisotropic")){let a=t.get("EXT_texture_filter_anisotropic");if(s.magFilter===le||s.minFilter!==he&&s.minFilter!==pe||s.type===ge&&!1===t.has("OES_texture_float_linear")||!1===l&&s.type===ve&&!1===t.has("OES_texture_half_float_linear"))return;(s.anisotropy>1||i.get(s).__currentAnisotropy)&&(e.texParameterf(n,a.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(s.anisotropy,r.getMaxAnisotropy())),i.get(s).__currentAnisotropy=s.anisotropy)}}function k(t,n){let i=!1;void 0===t.__webglInit&&(t.__webglInit=!0,n.addEventListener("dispose",C));let r=n.source,s=g.get(r);void 0===s&&(s={},g.set(r,s));let o=function(e){let t=[];return t.push(e.wrapS),t.push(e.wrapT),t.push(e.wrapR||0),t.push(e.magFilter),t.push(e.minFilter),t.push(e.anisotropy),t.push(e.internalFormat),t.push(e.format),t.push(e.type),t.push(e.generateMipmaps),t.push(e.premultiplyAlpha),t.push(e.flipY),t.push(e.unpackAlignment),t.push(e.encoding),t.join()}(n);if(o!==t.__cacheKey){void 0===s[o]&&(s[o]={texture:e.createTexture(),usedTimes:0},a.memory.textures++,i=!0),s[o].usedTimes++;let r=s[t.__cacheKey];void 0!==r&&(s[t.__cacheKey].usedTimes--,0===r.usedTimes&&T(n)),t.__cacheKey=o,t.__webglTexture=s[o].texture}return i}function L(t,r,a){let o=3553;(r.isDataArrayTexture||r.isCompressedArrayTexture)&&(o=35866),r.isData3DTexture&&(o=32879);let c=k(t,r),h=r.source;n.bindTexture(o,t.__webglTexture,33984+a);let d=i.get(h);if(h.version!==d.__version||!0===c){n.activeTexture(33984+a),e.pixelStorei(37440,r.flipY),e.pixelStorei(37441,r.premultiplyAlpha),e.pixelStorei(3317,r.unpackAlignment),e.pixelStorei(37443,0);let t=function(e){return!l&&(e.wrapS!==ae||e.wrapT!==ae||e.minFilter!==le&&e.minFilter!==ue)}(r)&&!1===x(r.image),i=b(r.image,t,!1,u);i=j(r,i);let p=x(i)||l,f=s.convert(r.format,r.encoding),m=s.convert(r.type),g=_(r.internalFormat,f,m,r.encoding,r.isVideoTexture);R(o,r,p);let v,y=r.mipmaps,A=l&&!0!==r.isVideoTexture,C=void 0===d.__version||!0===c,M=E(r,i,p);if(r.isDepthTexture)g=6402,l?g=r.type===ge?36012:r.type===me?33190:r.type===ye?35056:33189:r.type===ge&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),r.format===xe&&6402===g&&1012!==r.type&&r.type!==me&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),r.type=me,m=s.convert(r.type)),r.format===we&&6402===g&&(g=34041,r.type!==ye&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),r.type=ye,m=s.convert(r.type))),C&&(A?n.texStorage2D(3553,1,g,i.width,i.height):n.texImage2D(3553,0,g,i.width,i.height,0,f,m,null));else if(r.isDataTexture)if(y.length>0&&p){A&&C&&n.texStorage2D(3553,M,g,y[0].width,y[0].height);for(let e=0,t=y.length;e<t;e++)v=y[e],A?n.texSubImage2D(3553,e,0,0,v.width,v.height,f,m,v.data):n.texImage2D(3553,e,g,v.width,v.height,0,f,m,v.data);r.generateMipmaps=!1}else A?(C&&n.texStorage2D(3553,M,g,i.width,i.height),n.texSubImage2D(3553,0,0,0,i.width,i.height,f,m,i.data)):n.texImage2D(3553,0,g,i.width,i.height,0,f,m,i.data);else if(r.isCompressedTexture)if(r.isCompressedArrayTexture){A&&C&&n.texStorage3D(35866,M,g,y[0].width,y[0].height,i.depth);for(let e=0,t=y.length;e<t;e++)v=y[e],r.format!==be?null!==f?A?n.compressedTexSubImage3D(35866,e,0,0,0,v.width,v.height,i.depth,f,v.data,0,0):n.compressedTexImage3D(35866,e,g,v.width,v.height,i.depth,0,v.data,0,0):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):A?n.texSubImage3D(35866,e,0,0,0,v.width,v.height,i.depth,f,m,v.data):n.texImage3D(35866,e,g,v.width,v.height,i.depth,0,f,m,v.data)}else{A&&C&&n.texStorage2D(3553,M,g,y[0].width,y[0].height);for(let e=0,t=y.length;e<t;e++)v=y[e],r.format!==be?null!==f?A?n.compressedTexSubImage2D(3553,e,0,0,v.width,v.height,f,v.data):n.compressedTexImage2D(3553,e,g,v.width,v.height,0,v.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):A?n.texSubImage2D(3553,e,0,0,v.width,v.height,f,m,v.data):n.texImage2D(3553,e,g,v.width,v.height,0,f,m,v.data)}else if(r.isDataArrayTexture)A?(C&&n.texStorage3D(35866,M,g,i.width,i.height,i.depth),n.texSubImage3D(35866,0,0,0,0,i.width,i.height,i.depth,f,m,i.data)):n.texImage3D(35866,0,g,i.width,i.height,i.depth,0,f,m,i.data);else if(r.isData3DTexture)A?(C&&n.texStorage3D(32879,M,g,i.width,i.height,i.depth),n.texSubImage3D(32879,0,0,0,0,i.width,i.height,i.depth,f,m,i.data)):n.texImage3D(32879,0,g,i.width,i.height,i.depth,0,f,m,i.data);else if(r.isFramebufferTexture){if(C)if(A)n.texStorage2D(3553,M,g,i.width,i.height);else{let e=i.width,t=i.height;for(let i=0;i<M;i++)n.texImage2D(3553,i,g,e,t,0,f,m,null),e>>=1,t>>=1}}else if(y.length>0&&p){A&&C&&n.texStorage2D(3553,M,g,y[0].width,y[0].height);for(let e=0,t=y.length;e<t;e++)v=y[e],A?n.texSubImage2D(3553,e,0,0,f,m,v):n.texImage2D(3553,e,g,f,m,v);r.generateMipmaps=!1}else A?(C&&n.texStorage2D(3553,M,g,i.width,i.height),n.texSubImage2D(3553,0,0,0,f,m,i)):n.texImage2D(3553,0,g,f,m,i);w(r,p)&&S(o),d.__version=h.version,r.onUpdate&&r.onUpdate(r)}t.__version=r.version}function B(t,r,a,o,l){let c=s.convert(a.format,a.encoding),h=s.convert(a.type),u=_(a.internalFormat,c,h,a.encoding);i.get(r).__hasExternalTextures||(32879===l||35866===l?n.texImage3D(l,0,u,r.width,r.height,r.depth,0,c,h,null):n.texImage2D(l,0,u,r.width,r.height,0,c,h,null)),n.bindFramebuffer(36160,t),U(r)?p.framebufferTexture2DMultisampleEXT(36160,o,l,i.get(a).__webglTexture,0,F(r)):(3553===l||l>=34069&&l<=34074)&&e.framebufferTexture2D(36160,o,l,i.get(a).__webglTexture,0),n.bindFramebuffer(36160,null)}function z(t,n,i){if(e.bindRenderbuffer(36161,t),n.depthBuffer&&!n.stencilBuffer){let r=33189;if(i||U(n)){let t=n.depthTexture;t&&t.isDepthTexture&&(t.type===ge?r=36012:t.type===me&&(r=33190));let i=F(n);U(n)?p.renderbufferStorageMultisampleEXT(36161,i,r,n.width,n.height):e.renderbufferStorageMultisample(36161,i,r,n.width,n.height)}else e.renderbufferStorage(36161,r,n.width,n.height);e.framebufferRenderbuffer(36160,36096,36161,t)}else if(n.depthBuffer&&n.stencilBuffer){let r=F(n);i&&!1===U(n)?e.renderbufferStorageMultisample(36161,r,35056,n.width,n.height):U(n)?p.renderbufferStorageMultisampleEXT(36161,r,35056,n.width,n.height):e.renderbufferStorage(36161,34041,n.width,n.height),e.framebufferRenderbuffer(36160,33306,36161,t)}else{let t=!0===n.isWebGLMultipleRenderTargets?n.texture:[n.texture];for(let r=0;r<t.length;r++){let a=t[r],o=s.convert(a.format,a.encoding),l=s.convert(a.type),c=_(a.internalFormat,o,l,a.encoding),h=F(n);i&&!1===U(n)?e.renderbufferStorageMultisample(36161,h,c,n.width,n.height):U(n)?p.renderbufferStorageMultisampleEXT(36161,h,c,n.width,n.height):e.renderbufferStorage(36161,c,n.width,n.height)}}e.bindRenderbuffer(36161,null)}function N(t){let r=i.get(t),s=!0===t.isWebGLCubeRenderTarget;if(t.depthTexture&&!r.__autoAllocateDepthBuffer){if(s)throw new Error("target.depthTexture not supported in Cube render targets");!function(t,r){if(r&&r.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(n.bindFramebuffer(36160,t),!r.depthTexture||!r.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");(!i.get(r.depthTexture).__webglTexture||r.depthTexture.image.width!==r.width||r.depthTexture.image.height!==r.height)&&(r.depthTexture.image.width=r.width,r.depthTexture.image.height=r.height,r.depthTexture.needsUpdate=!0),D(r.depthTexture,0);let s=i.get(r.depthTexture).__webglTexture,a=F(r);if(r.depthTexture.format===xe)U(r)?p.framebufferTexture2DMultisampleEXT(36160,36096,3553,s,0,a):e.framebufferTexture2D(36160,36096,3553,s,0);else{if(r.depthTexture.format!==we)throw new Error("Unknown depthTexture format");U(r)?p.framebufferTexture2DMultisampleEXT(36160,33306,3553,s,0,a):e.framebufferTexture2D(36160,33306,3553,s,0)}}(r.__webglFramebuffer,t)}else if(s){r.__webglDepthbuffer=[];for(let i=0;i<6;i++)n.bindFramebuffer(36160,r.__webglFramebuffer[i]),r.__webglDepthbuffer[i]=e.createRenderbuffer(),z(r.__webglDepthbuffer[i],t,!1)}else n.bindFramebuffer(36160,r.__webglFramebuffer),r.__webglDepthbuffer=e.createRenderbuffer(),z(r.__webglDepthbuffer,t,!1);n.bindFramebuffer(36160,null)}function F(e){return Math.min(d,e.samples)}function U(e){let n=i.get(e);return l&&e.samples>0&&!0===t.has("WEBGL_multisampled_render_to_texture")&&!1!==n.__useRenderToTexture}function j(e,n){let i=e.encoding,r=e.format,s=e.type;return!0===e.isCompressedTexture||!0===e.isVideoTexture||e.format===We||i!==ze&&(i===Ne?!1===l?!0===t.has("EXT_sRGB")&&r===be?(e.format=We,e.minFilter=ue,e.generateMipmaps=!1):n=Ct.sRGBToLinear(n):(r!==be||s!==fe)&&console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture encoding:",i)),n}this.allocateTextureUnit=function(){let e=P;return e>=c&&console.warn("THREE.WebGLTextures: Trying to use "+e+" texture units while this GPU supports only "+c),P+=1,e},this.resetTextureUnits=function(){P=0},this.setTexture2D=D,this.setTexture2DArray=function(e,t){let r=i.get(e);e.version>0&&r.__version!==e.version?L(r,e,t):n.bindTexture(35866,r.__webglTexture,33984+t)},this.setTexture3D=function(e,t){let r=i.get(e);e.version>0&&r.__version!==e.version?L(r,e,t):n.bindTexture(32879,r.__webglTexture,33984+t)},this.setTextureCube=function(t,r){let a=i.get(t);t.version>0&&a.__version!==t.version?function(t,r,a){if(6!==r.image.length)return;let o=k(t,r),c=r.source;n.bindTexture(34067,t.__webglTexture,33984+a);let u=i.get(c);if(c.version!==u.__version||!0===o){n.activeTexture(33984+a),e.pixelStorei(37440,r.flipY),e.pixelStorei(37441,r.premultiplyAlpha),e.pixelStorei(3317,r.unpackAlignment),e.pixelStorei(37443,0);let t=r.isCompressedTexture||r.image[0].isCompressedTexture,i=r.image[0]&&r.image[0].isDataTexture,d=[];for(let e=0;e<6;e++)d[e]=t||i?i?r.image[e].image:r.image[e]:b(r.image[e],!1,!0,h),d[e]=j(r,d[e]);let p,f=d[0],m=x(f)||l,g=s.convert(r.format,r.encoding),v=s.convert(r.type),y=_(r.internalFormat,g,v,r.encoding),A=l&&!0!==r.isVideoTexture,C=void 0===u.__version||!0===o,M=E(r,f,m);if(R(34067,r,m),t){A&&C&&n.texStorage2D(34067,M,y,f.width,f.height);for(let e=0;e<6;e++){p=d[e].mipmaps;for(let t=0;t<p.length;t++){let i=p[t];r.format!==be?null!==g?A?n.compressedTexSubImage2D(34069+e,t,0,0,i.width,i.height,g,i.data):n.compressedTexImage2D(34069+e,t,y,i.width,i.height,0,i.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):A?n.texSubImage2D(34069+e,t,0,0,i.width,i.height,g,v,i.data):n.texImage2D(34069+e,t,y,i.width,i.height,0,g,v,i.data)}}}else{p=r.mipmaps,A&&C&&(p.length>0&&M++,n.texStorage2D(34067,M,y,d[0].width,d[0].height));for(let e=0;e<6;e++)if(i){A?n.texSubImage2D(34069+e,0,0,0,d[e].width,d[e].height,g,v,d[e].data):n.texImage2D(34069+e,0,y,d[e].width,d[e].height,0,g,v,d[e].data);for(let t=0;t<p.length;t++){let i=p[t].image[e].image;A?n.texSubImage2D(34069+e,t+1,0,0,i.width,i.height,g,v,i.data):n.texImage2D(34069+e,t+1,y,i.width,i.height,0,g,v,i.data)}}else{A?n.texSubImage2D(34069+e,0,0,0,g,v,d[e]):n.texImage2D(34069+e,0,y,g,v,d[e]);for(let t=0;t<p.length;t++){let i=p[t];A?n.texSubImage2D(34069+e,t+1,0,0,g,v,i.image[e]):n.texImage2D(34069+e,t+1,y,g,v,i.image[e])}}}w(r,m)&&S(34067),u.__version=c.version,r.onUpdate&&r.onUpdate(r)}t.__version=r.version}(a,t,r):n.bindTexture(34067,a.__webglTexture,33984+r)},this.rebindTextures=function(e,t,n){let r=i.get(e);void 0!==t&&B(r.__webglFramebuffer,e,e.texture,36064,3553),void 0!==n&&N(e)},this.setupRenderTarget=function(t){let o=t.texture,c=i.get(t),h=i.get(o);t.addEventListener("dispose",M),!0!==t.isWebGLMultipleRenderTargets&&(void 0===h.__webglTexture&&(h.__webglTexture=e.createTexture()),h.__version=o.version,a.memory.textures++);let u=!0===t.isWebGLCubeRenderTarget,d=!0===t.isWebGLMultipleRenderTargets,p=x(t)||l;if(u){c.__webglFramebuffer=[];for(let t=0;t<6;t++)c.__webglFramebuffer[t]=e.createFramebuffer()}else{if(c.__webglFramebuffer=e.createFramebuffer(),d)if(r.drawBuffers){let n=t.texture;for(let t=0,r=n.length;t<r;t++){let r=i.get(n[t]);void 0===r.__webglTexture&&(r.__webglTexture=e.createTexture(),a.memory.textures++)}}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");if(l&&t.samples>0&&!1===U(t)){let i=d?o:[o];c.__webglMultisampledFramebuffer=e.createFramebuffer(),c.__webglColorRenderbuffer=[],n.bindFramebuffer(36160,c.__webglMultisampledFramebuffer);for(let n=0;n<i.length;n++){let r=i[n];c.__webglColorRenderbuffer[n]=e.createRenderbuffer(),e.bindRenderbuffer(36161,c.__webglColorRenderbuffer[n]);let a=s.convert(r.format,r.encoding),o=s.convert(r.type),l=_(r.internalFormat,a,o,r.encoding,!0===t.isXRRenderTarget),h=F(t);e.renderbufferStorageMultisample(36161,h,l,t.width,t.height),e.framebufferRenderbuffer(36160,36064+n,36161,c.__webglColorRenderbuffer[n])}e.bindRenderbuffer(36161,null),t.depthBuffer&&(c.__webglDepthRenderbuffer=e.createRenderbuffer(),z(c.__webglDepthRenderbuffer,t,!0)),n.bindFramebuffer(36160,null)}}if(u){n.bindTexture(34067,h.__webglTexture),R(34067,o,p);for(let e=0;e<6;e++)B(c.__webglFramebuffer[e],t,o,36064,34069+e);w(o,p)&&S(34067),n.unbindTexture()}else if(d){let e=t.texture;for(let r=0,s=e.length;r<s;r++){let s=e[r],a=i.get(s);n.bindTexture(3553,a.__webglTexture),R(3553,s,p),B(c.__webglFramebuffer,t,s,36064+r,3553),w(s,p)&&S(3553)}n.unbindTexture()}else{let e=3553;(t.isWebGL3DRenderTarget||t.isWebGLArrayRenderTarget)&&(l?e=t.isWebGL3DRenderTarget?32879:35866:console.error("THREE.WebGLTextures: THREE.Data3DTexture and THREE.DataArrayTexture only supported with WebGL2.")),n.bindTexture(e,h.__webglTexture),R(e,o,p),B(c.__webglFramebuffer,t,o,36064,e),w(o,p)&&S(e),n.unbindTexture()}t.depthBuffer&&N(t)},this.updateRenderTargetMipmap=function(e){let t=x(e)||l,r=!0===e.isWebGLMultipleRenderTargets?e.texture:[e.texture];for(let s=0,a=r.length;s<a;s++){let a=r[s];if(w(a,t)){let t=e.isWebGLCubeRenderTarget?34067:3553,r=i.get(a).__webglTexture;n.bindTexture(t,r),S(t),n.unbindTexture()}}},this.updateMultisampleRenderTarget=function(t){if(l&&t.samples>0&&!1===U(t)){let r=t.isWebGLMultipleRenderTargets?t.texture:[t.texture],s=t.width,a=t.height,o=16384,l=[],c=t.stencilBuffer?33306:36096,h=i.get(t),u=!0===t.isWebGLMultipleRenderTargets;if(u)for(let t=0;t<r.length;t++)n.bindFramebuffer(36160,h.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(36160,36064+t,36161,null),n.bindFramebuffer(36160,h.__webglFramebuffer),e.framebufferTexture2D(36009,36064+t,3553,null,0);n.bindFramebuffer(36008,h.__webglMultisampledFramebuffer),n.bindFramebuffer(36009,h.__webglFramebuffer);for(let n=0;n<r.length;n++){l.push(36064+n),t.depthBuffer&&l.push(c);let d=void 0!==h.__ignoreDepthValues&&h.__ignoreDepthValues;if(!1===d&&(t.depthBuffer&&(o|=256),t.stencilBuffer&&(o|=1024)),u&&e.framebufferRenderbuffer(36008,36064,36161,h.__webglColorRenderbuffer[n]),!0===d&&(e.invalidateFramebuffer(36008,[c]),e.invalidateFramebuffer(36009,[c])),u){let t=i.get(r[n]).__webglTexture;e.framebufferTexture2D(36009,36064,3553,t,0)}e.blitFramebuffer(0,0,s,a,0,0,s,a,o,9728),f&&e.invalidateFramebuffer(36008,l)}if(n.bindFramebuffer(36008,null),n.bindFramebuffer(36009,null),u)for(let t=0;t<r.length;t++){n.bindFramebuffer(36160,h.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(36160,36064+t,36161,h.__webglColorRenderbuffer[t]);let s=i.get(r[t]).__webglTexture;n.bindFramebuffer(36160,h.__webglFramebuffer),e.framebufferTexture2D(36009,36064+t,3553,s,0)}n.bindFramebuffer(36009,h.__webglMultisampledFramebuffer)}},this.setupDepthRenderbuffer=N,this.setupFrameBufferTexture=B,this.useMultisampledRTT=U}function ma(e,t,n){let i=n.isWebGL2;return{convert:function(n){let r,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(n===fe)return 5121;if(1017===n)return 32819;if(1018===n)return 32820;if(1010===n)return 5120;if(1011===n)return 5122;if(1012===n)return 5123;if(1013===n)return 5124;if(n===me)return 5125;if(n===ge)return 5126;if(n===ve)return i?5131:(r=t.get("OES_texture_half_float"),null!==r?r.HALF_FLOAT_OES:null);if(1021===n)return 6406;if(n===be)return 6408;if(1024===n)return 6409;if(1025===n)return 6410;if(n===xe)return 6402;if(n===we)return 34041;if(n===We)return r=t.get("EXT_sRGB"),null!==r?r.SRGB_ALPHA_EXT:null;if(n===Se)return 6403;if(1029===n)return 36244;if(n===_e)return 33319;if(1031===n)return 33320;if(1033===n)return 36249;if(n===Ee||n===Ae||n===Ce||n===Me)if(s===Ne){if(r=t.get("WEBGL_compressed_texture_s3tc_srgb"),null===r)return null;if(n===Ee)return r.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(n===Ae)return r.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(n===Ce)return r.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(n===Me)return r.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else{if(r=t.get("WEBGL_compressed_texture_s3tc"),null===r)return null;if(n===Ee)return r.COMPRESSED_RGB_S3TC_DXT1_EXT;if(n===Ae)return r.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(n===Ce)return r.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(n===Me)return r.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(35840===n||35841===n||35842===n||35843===n){if(r=t.get("WEBGL_compressed_texture_pvrtc"),null===r)return null;if(35840===n)return r.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(35841===n)return r.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(35842===n)return r.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(35843===n)return r.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(36196===n)return r=t.get("WEBGL_compressed_texture_etc1"),null!==r?r.COMPRESSED_RGB_ETC1_WEBGL:null;if(37492===n||37496===n){if(r=t.get("WEBGL_compressed_texture_etc"),null===r)return null;if(37492===n)return s===Ne?r.COMPRESSED_SRGB8_ETC2:r.COMPRESSED_RGB8_ETC2;if(37496===n)return s===Ne?r.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:r.COMPRESSED_RGBA8_ETC2_EAC}if(37808===n||37809===n||37810===n||37811===n||37812===n||37813===n||37814===n||37815===n||37816===n||37817===n||37818===n||37819===n||37820===n||37821===n){if(r=t.get("WEBGL_compressed_texture_astc"),null===r)return null;if(37808===n)return s===Ne?r.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:r.COMPRESSED_RGBA_ASTC_4x4_KHR;if(37809===n)return s===Ne?r.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:r.COMPRESSED_RGBA_ASTC_5x4_KHR;if(37810===n)return s===Ne?r.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:r.COMPRESSED_RGBA_ASTC_5x5_KHR;if(37811===n)return s===Ne?r.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:r.COMPRESSED_RGBA_ASTC_6x5_KHR;if(37812===n)return s===Ne?r.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:r.COMPRESSED_RGBA_ASTC_6x6_KHR;if(37813===n)return s===Ne?r.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:r.COMPRESSED_RGBA_ASTC_8x5_KHR;if(37814===n)return s===Ne?r.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:r.COMPRESSED_RGBA_ASTC_8x6_KHR;if(37815===n)return s===Ne?r.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:r.COMPRESSED_RGBA_ASTC_8x8_KHR;if(37816===n)return s===Ne?r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:r.COMPRESSED_RGBA_ASTC_10x5_KHR;if(37817===n)return s===Ne?r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:r.COMPRESSED_RGBA_ASTC_10x6_KHR;if(37818===n)return s===Ne?r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:r.COMPRESSED_RGBA_ASTC_10x8_KHR;if(37819===n)return s===Ne?r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:r.COMPRESSED_RGBA_ASTC_10x10_KHR;if(37820===n)return s===Ne?r.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:r.COMPRESSED_RGBA_ASTC_12x10_KHR;if(37821===n)return s===Ne?r.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:r.COMPRESSED_RGBA_ASTC_12x12_KHR}if(n===Te){if(r=t.get("EXT_texture_compression_bptc"),null===r)return null;if(n===Te)return s===Ne?r.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:r.COMPRESSED_RGBA_BPTC_UNORM_EXT}if(36283===n||36284===n||36285===n||36286===n){if(r=t.get("EXT_texture_compression_rgtc"),null===r)return null;if(n===Te)return r.COMPRESSED_RED_RGTC1_EXT;if(36284===n)return r.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(36285===n)return r.COMPRESSED_RED_GREEN_RGTC2_EXT;if(36286===n)return r.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}return n===ye?i?34042:(r=t.get("WEBGL_depth_texture"),null!==r?r.UNSIGNED_INT_24_8_WEBGL:null):void 0!==e[n]?e[n]:null}}}var ga=class extends Li{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];super(),this.isArrayCamera=!0,this.cameras=e}},va=class extends Nn{constructor(){super(),this.isGroup=!0,this.type="Group"}},ya={type:"move"},ba=class{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return null===this._hand&&(this._hand=new va,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return null===this._targetRay&&(this._targetRay=new va,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new Bt,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new Bt),this._targetRay}getGripSpace(){return null===this._grip&&(this._grip=new va,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new Bt,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new Bt),this._grip}dispatchEvent(e){return null!==this._targetRay&&this._targetRay.dispatchEvent(e),null!==this._grip&&this._grip.dispatchEvent(e),null!==this._hand&&this._hand.dispatchEvent(e),this}connect(e){if(e&&e.hand){let t=this._hand;if(t)for(let n of e.hand.values())this._getHandJoint(t,n)}return this.dispatchEvent({type:"connected",data:e}),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),null!==this._targetRay&&(this._targetRay.visible=!1),null!==this._grip&&(this._grip.visible=!1),null!==this._hand&&(this._hand.visible=!1),this}update(e,t,n){let i=null,r=null,s=null,a=this._targetRay,o=this._grip,l=this._hand;if(e&&"visible-blurred"!==t.session.visibilityState){if(l&&e.hand){s=!0;for(let s of e.hand.values()){let e=t.getJointPose(s,n),i=this._getHandJoint(l,s);null!==e&&(i.matrix.fromArray(e.transform.matrix),i.matrix.decompose(i.position,i.rotation,i.scale),i.jointRadius=e.radius),i.visible=null!==e}let i=l.joints["index-finger-tip"],r=l.joints["thumb-tip"],a=i.position.distanceTo(r.position),o=.02,c=.005;l.inputState.pinching&&a>o+c?(l.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!l.inputState.pinching&&a<=o-c&&(l.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else null!==o&&e.gripSpace&&(r=t.getPose(e.gripSpace,n),null!==r&&(o.matrix.fromArray(r.transform.matrix),o.matrix.decompose(o.position,o.rotation,o.scale),r.linearVelocity?(o.hasLinearVelocity=!0,o.linearVelocity.copy(r.linearVelocity)):o.hasLinearVelocity=!1,r.angularVelocity?(o.hasAngularVelocity=!0,o.angularVelocity.copy(r.angularVelocity)):o.hasAngularVelocity=!1));null!==a&&(i=t.getPose(e.targetRaySpace,n),null===i&&null!==r&&(i=r),null!==i&&(a.matrix.fromArray(i.transform.matrix),a.matrix.decompose(a.position,a.rotation,a.scale),i.linearVelocity?(a.hasLinearVelocity=!0,a.linearVelocity.copy(i.linearVelocity)):a.hasLinearVelocity=!1,i.angularVelocity?(a.hasAngularVelocity=!0,a.angularVelocity.copy(i.angularVelocity)):a.hasAngularVelocity=!1,this.dispatchEvent(ya)))}return null!==a&&(a.visible=null!==i),null!==o&&(o.visible=null!==r),null!==l&&(l.visible=null!==s),this}_getHandJoint(e,t){if(void 0===e.joints[t.jointName]){let n=new va;n.matrixAutoUpdate=!1,n.visible=!1,e.joints[t.jointName]=n,e.add(n)}return e.joints[t.jointName]}},xa=class extends Dt{constructor(e,t,n,i,r,s,a,o,l,c){if((c=void 0!==c?c:xe)!==xe&&c!==we)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===n&&c===xe&&(n=me),void 0===n&&c===we&&(n=ye),super(null,i,r,s,a,o,c,n,l),this.isDepthTexture=!0,this.image={width:e,height:t},this.magFilter=void 0!==a?a:le,this.minFilter=void 0!==o?o:le,this.flipY=!1,this.generateMipmaps=!1}},wa=class extends qe{constructor(e,t){super();let n=this,i=null,r=1,s=null,a="local-floor",o=1,l=null,c=null,h=null,u=null,d=null,p=null,f=t.getContextAttributes(),m=null,g=null,v=[],y=[],b=new Set,x=new Map,w=new Li;w.layers.enable(1),w.viewport=new Ot;let S=new Li;S.layers.enable(2),S.viewport=new Ot;let _=[w,S],E=new ga;E.layers.enable(1),E.layers.enable(2);let A=null,C=null;function M(e){let t=y.indexOf(e.inputSource);if(-1===t)return;let n=v[t];void 0!==n&&n.dispatchEvent({type:e.type,data:e.inputSource})}function T(){i.removeEventListener("select",M),i.removeEventListener("selectstart",M),i.removeEventListener("selectend",M),i.removeEventListener("squeeze",M),i.removeEventListener("squeezestart",M),i.removeEventListener("squeezeend",M),i.removeEventListener("end",T),i.removeEventListener("inputsourceschange",P);for(let e=0;e<v.length;e++){let t=y[e];null!==t&&(y[e]=null,v[e].disconnect(t))}A=null,C=null,e.setRenderTarget(m),d=null,u=null,h=null,i=null,g=null,k.stop(),n.isPresenting=!1,n.dispatchEvent({type:"sessionend"})}function P(e){for(let t=0;t<e.removed.length;t++){let n=e.removed[t],i=y.indexOf(n);i>=0&&(y[i]=null,v[i].disconnect(n))}for(let t=0;t<e.added.length;t++){let n=e.added[t],i=y.indexOf(n);if(-1===i){for(let e=0;e<v.length;e++){if(e>=y.length){y.push(n),i=e;break}if(null===y[e]){y[e]=n,i=e;break}}if(-1===i)break}let r=v[i];r&&r.connect(n)}}this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(e){let t=v[e];return void 0===t&&(t=new ba,v[e]=t),t.getTargetRaySpace()},this.getControllerGrip=function(e){let t=v[e];return void 0===t&&(t=new ba,v[e]=t),t.getGripSpace()},this.getHand=function(e){let t=v[e];return void 0===t&&(t=new ba,v[e]=t),t.getHandSpace()},this.setFramebufferScaleFactor=function(e){r=e,!0===n.isPresenting&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(e){a=e,!0===n.isPresenting&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return l||s},this.setReferenceSpace=function(e){l=e},this.getBaseLayer=function(){return null!==u?u:d},this.getBinding=function(){return h},this.getFrame=function(){return p},this.getSession=function(){return i},this.setSession=async function(c){if(i=c,null!==i){if(m=e.getRenderTarget(),i.addEventListener("select",M),i.addEventListener("selectstart",M),i.addEventListener("selectend",M),i.addEventListener("squeeze",M),i.addEventListener("squeezestart",M),i.addEventListener("squeezeend",M),i.addEventListener("end",T),i.addEventListener("inputsourceschange",P),!0!==f.xrCompatible&&await t.makeXRCompatible(),void 0===i.renderState.layers||!1===e.capabilities.isWebGL2){let n={antialias:void 0!==i.renderState.layers||f.antialias,alpha:f.alpha,depth:f.depth,stencil:f.stencil,framebufferScaleFactor:r};d=new XRWebGLLayer(i,t,n),i.updateRenderState({baseLayer:d}),g=new It(d.framebufferWidth,d.framebufferHeight,{format:be,type:fe,encoding:e.outputEncoding,stencilBuffer:f.stencil})}else{let n=null,s=null,a=null;f.depth&&(a=f.stencil?35056:33190,n=f.stencil?we:xe,s=f.stencil?ye:me);let o={colorFormat:32856,depthFormat:a,scaleFactor:r};h=new XRWebGLBinding(i,t),u=h.createProjectionLayer(o),i.updateRenderState({layers:[u]}),g=new It(u.textureWidth,u.textureHeight,{format:be,type:fe,depthTexture:new xa(u.textureWidth,u.textureHeight,s,void 0,void 0,void 0,void 0,void 0,void 0,n),stencilBuffer:f.stencil,encoding:e.outputEncoding,samples:f.antialias?4:0}),e.properties.get(g).__ignoreDepthValues=u.ignoreDepthValues}g.isXRRenderTarget=!0,this.setFoveation(o),l=null,s=await i.requestReferenceSpace(a),k.setContext(i),k.start(),n.isPresenting=!0,n.dispatchEvent({type:"sessionstart"})}};let D=new Bt,O=new Bt;function I(e,t){null===t?e.matrixWorld.copy(e.matrix):e.matrixWorld.multiplyMatrices(t.matrixWorld,e.matrix),e.matrixWorldInverse.copy(e.matrixWorld).invert()}this.updateCamera=function(e){if(null===i)return;E.near=S.near=w.near=e.near,E.far=S.far=w.far=e.far,(A!==E.near||C!==E.far)&&(i.updateRenderState({depthNear:E.near,depthFar:E.far}),A=E.near,C=E.far);let t=e.parent,n=E.cameras;I(E,t);for(let i=0;i<n.length;i++)I(n[i],t);E.matrixWorld.decompose(E.position,E.quaternion,E.scale),e.matrix.copy(E.matrix),e.matrix.decompose(e.position,e.quaternion,e.scale);let r=e.children;for(let i=0,s=r.length;i<s;i++)r[i].updateMatrixWorld(!0);2===n.length?function(e,t,n){D.setFromMatrixPosition(t.matrixWorld),O.setFromMatrixPosition(n.matrixWorld);let i=D.distanceTo(O),r=t.projectionMatrix.elements,s=n.projectionMatrix.elements,a=r[14]/(r[10]-1),o=r[14]/(r[10]+1),l=(r[9]+1)/r[5],c=(r[9]-1)/r[5],h=(r[8]-1)/r[0],u=(s[8]+1)/s[0],d=a*h,p=a*u,f=i/(-h+u),m=f*-h;t.matrixWorld.decompose(e.position,e.quaternion,e.scale),e.translateX(m),e.translateZ(f),e.matrixWorld.compose(e.position,e.quaternion,e.scale),e.matrixWorldInverse.copy(e.matrixWorld).invert();let g=a+f,v=o+f,y=d-m,b=p+(i-m),x=l*o/v*g,w=c*o/v*g;e.projectionMatrix.makePerspective(y,b,x,w,g,v)}(E,w,S):E.projectionMatrix.copy(w.projectionMatrix)},this.getCamera=function(){return E},this.getFoveation=function(){if(null!==u||null!==d)return o},this.setFoveation=function(e){o=e,null!==u&&(u.fixedFoveation=e),null!==d&&void 0!==d.fixedFoveation&&(d.fixedFoveation=e)},this.getPlanes=function(){return b};let R=null;let k=new Xi;k.setAnimationLoop((function(t,i){if(c=i.getViewerPose(l||s),p=i,null!==c){let t=c.views;null!==d&&(e.setRenderTargetFramebuffer(g,d.framebuffer),e.setRenderTarget(g));let n=!1;t.length!==E.cameras.length&&(E.cameras.length=0,n=!0);for(let i=0;i<t.length;i++){let r=t[i],s=null;if(null!==d)s=d.getViewport(r);else{let t=h.getViewSubImage(u,r);s=t.viewport,0===i&&(e.setRenderTargetTextures(g,t.colorTexture,u.ignoreDepthValues?void 0:t.depthStencilTexture),e.setRenderTarget(g))}let a=_[i];void 0===a&&(a=new Li,a.layers.enable(i),a.viewport=new Ot,_[i]=a),a.matrix.fromArray(r.transform.matrix),a.projectionMatrix.fromArray(r.projectionMatrix),a.viewport.set(s.x,s.y,s.width,s.height),0===i&&E.matrix.copy(a.matrix),!0===n&&E.cameras.push(a)}}for(let e=0;e<v.length;e++){let t=y[e],n=v[e];null!==t&&void 0!==n&&n.update(t,i,l||s)}if(R&&R(t,i),i.detectedPlanes){n.dispatchEvent({type:"planesdetected",data:i.detectedPlanes});let e=null;for(let t of b)i.detectedPlanes.has(t)||(null===e&&(e=[]),e.push(t));if(null!==e)for(let t of e)b.delete(t),x.delete(t),n.dispatchEvent({type:"planeremoved",data:t});for(let t of i.detectedPlanes)if(b.has(t)){let e=x.get(t);t.lastChangedTime>e&&(x.set(t,t.lastChangedTime),n.dispatchEvent({type:"planechanged",data:t}))}else b.add(t),x.set(t,i.lastChangedTime),n.dispatchEvent({type:"planeadded",data:t})}p=null})),this.setAnimationLoop=function(e){R=e},this.dispose=function(){}}};function Sa(e,t){function n(n,i){n.opacity.value=i.opacity,i.color&&n.diffuse.value.copy(i.color),i.emissive&&n.emissive.value.copy(i.emissive).multiplyScalar(i.emissiveIntensity),i.map&&(n.map.value=i.map),i.alphaMap&&(n.alphaMap.value=i.alphaMap),i.bumpMap&&(n.bumpMap.value=i.bumpMap,n.bumpScale.value=i.bumpScale,1===i.side&&(n.bumpScale.value*=-1)),i.displacementMap&&(n.displacementMap.value=i.displacementMap,n.displacementScale.value=i.displacementScale,n.displacementBias.value=i.displacementBias),i.emissiveMap&&(n.emissiveMap.value=i.emissiveMap),i.normalMap&&(n.normalMap.value=i.normalMap,n.normalScale.value.copy(i.normalScale),1===i.side&&n.normalScale.value.negate()),i.specularMap&&(n.specularMap.value=i.specularMap),i.alphaTest>0&&(n.alphaTest.value=i.alphaTest);let r,s,a=t.get(i).envMap;if(a&&(n.envMap.value=a,n.flipEnvMap.value=a.isCubeTexture&&!1===a.isRenderTargetTexture?-1:1,n.reflectivity.value=i.reflectivity,n.ior.value=i.ior,n.refractionRatio.value=i.refractionRatio),i.lightMap){n.lightMap.value=i.lightMap;let t=!0!==e.physicallyCorrectLights?Math.PI:1;n.lightMapIntensity.value=i.lightMapIntensity*t}i.aoMap&&(n.aoMap.value=i.aoMap,n.aoMapIntensity.value=i.aoMapIntensity),i.map?r=i.map:i.specularMap?r=i.specularMap:i.displacementMap?r=i.displacementMap:i.normalMap?r=i.normalMap:i.bumpMap?r=i.bumpMap:i.roughnessMap?r=i.roughnessMap:i.metalnessMap?r=i.metalnessMap:i.alphaMap?r=i.alphaMap:i.emissiveMap?r=i.emissiveMap:i.clearcoatMap?r=i.clearcoatMap:i.clearcoatNormalMap?r=i.clearcoatNormalMap:i.clearcoatRoughnessMap?r=i.clearcoatRoughnessMap:i.iridescenceMap?r=i.iridescenceMap:i.iridescenceThicknessMap?r=i.iridescenceThicknessMap:i.specularIntensityMap?r=i.specularIntensityMap:i.specularColorMap?r=i.specularColorMap:i.transmissionMap?r=i.transmissionMap:i.thicknessMap?r=i.thicknessMap:i.sheenColorMap?r=i.sheenColorMap:i.sheenRoughnessMap&&(r=i.sheenRoughnessMap),void 0!==r&&(r.isWebGLRenderTarget&&(r=r.texture),!0===r.matrixAutoUpdate&&r.updateMatrix(),n.uvTransform.value.copy(r.matrix)),i.aoMap?s=i.aoMap:i.lightMap&&(s=i.lightMap),void 0!==s&&(s.isWebGLRenderTarget&&(s=s.texture),!0===s.matrixAutoUpdate&&s.updateMatrix(),n.uv2Transform.value.copy(s.matrix))}return{refreshFogUniforms:function(t,n){n.color.getRGB(t.fogColor.value,Oi(e)),n.isFog?(t.fogNear.value=n.near,t.fogFar.value=n.far):n.isFogExp2&&(t.fogDensity.value=n.density)},refreshMaterialUniforms:function(e,i,r,s,a){i.isMeshBasicMaterial||i.isMeshLambertMaterial?n(e,i):i.isMeshToonMaterial?(n(e,i),function(e,t){t.gradientMap&&(e.gradientMap.value=t.gradientMap)}(e,i)):i.isMeshPhongMaterial?(n(e,i),function(e,t){e.specular.value.copy(t.specular),e.shininess.value=Math.max(t.shininess,1e-4)}(e,i)):i.isMeshStandardMaterial?(n(e,i),function(e,n){e.roughness.value=n.roughness,e.metalness.value=n.metalness,n.roughnessMap&&(e.roughnessMap.value=n.roughnessMap),n.metalnessMap&&(e.metalnessMap.value=n.metalnessMap),t.get(n).envMap&&(e.envMapIntensity.value=n.envMapIntensity)}(e,i),i.isMeshPhysicalMaterial&&function(e,t,n){e.ior.value=t.ior,t.sheen>0&&(e.sheenColor.value.copy(t.sheenColor).multiplyScalar(t.sheen),e.sheenRoughness.value=t.sheenRoughness,t.sheenColorMap&&(e.sheenColorMap.value=t.sheenColorMap),t.sheenRoughnessMap&&(e.sheenRoughnessMap.value=t.sheenRoughnessMap)),t.clearcoat>0&&(e.clearcoat.value=t.clearcoat,e.clearcoatRoughness.value=t.clearcoatRoughness,t.clearcoatMap&&(e.clearcoatMap.value=t.clearcoatMap),t.clearcoatRoughnessMap&&(e.clearcoatRoughnessMap.value=t.clearcoatRoughnessMap),t.clearcoatNormalMap&&(e.clearcoatNormalScale.value.copy(t.clearcoatNormalScale),e.clearcoatNormalMap.value=t.clearcoatNormalMap,1===t.side&&e.clearcoatNormalScale.value.negate())),t.iridescence>0&&(e.iridescence.value=t.iridescence,e.iridescenceIOR.value=t.iridescenceIOR,e.iridescenceThicknessMinimum.value=t.iridescenceThicknessRange[0],e.iridescenceThicknessMaximum.value=t.iridescenceThicknessRange[1],t.iridescenceMap&&(e.iridescenceMap.value=t.iridescenceMap),t.iridescenceThicknessMap&&(e.iridescenceThicknessMap.value=t.iridescenceThicknessMap)),t.transmission>0&&(e.transmission.value=t.transmission,e.transmissionSamplerMap.value=n.texture,e.transmissionSamplerSize.value.set(n.width,n.height),t.transmissionMap&&(e.transmissionMap.value=t.transmissionMap),e.thickness.value=t.thickness,t.thicknessMap&&(e.thicknessMap.value=t.thicknessMap),e.attenuationDistance.value=t.attenuationDistance,e.attenuationColor.value.copy(t.attenuationColor)),e.specularIntensity.value=t.specularIntensity,e.specularColor.value.copy(t.specularColor),t.specularIntensityMap&&(e.specularIntensityMap.value=t.specularIntensityMap),t.specularColorMap&&(e.specularColorMap.value=t.specularColorMap)}(e,i,a)):i.isMeshMatcapMaterial?(n(e,i),function(e,t){t.matcap&&(e.matcap.value=t.matcap)}(e,i)):i.isMeshDepthMaterial?n(e,i):i.isMeshDistanceMaterial?(n(e,i),function(e,t){e.referencePosition.value.copy(t.referencePosition),e.nearDistance.value=t.nearDistance,e.farDistance.value=t.farDistance}(e,i)):i.isMeshNormalMaterial?n(e,i):i.isLineBasicMaterial?(function(e,t){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity}(e,i),i.isLineDashedMaterial&&function(e,t){e.dashSize.value=t.dashSize,e.totalSize.value=t.dashSize+t.gapSize,e.scale.value=t.scale}(e,i)):i.isPointsMaterial?function(e,t,n,i){let r;e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.size.value=t.size*n,e.scale.value=.5*i,t.map&&(e.map.value=t.map),t.alphaMap&&(e.alphaMap.value=t.alphaMap),t.alphaTest>0&&(e.alphaTest.value=t.alphaTest),t.map?r=t.map:t.alphaMap&&(r=t.alphaMap),void 0!==r&&(!0===r.matrixAutoUpdate&&r.updateMatrix(),e.uvTransform.value.copy(r.matrix))}(e,i,r,s):i.isSpriteMaterial?function(e,t){let n;e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.rotation.value=t.rotation,t.map&&(e.map.value=t.map),t.alphaMap&&(e.alphaMap.value=t.alphaMap),t.alphaTest>0&&(e.alphaTest.value=t.alphaTest),t.map?n=t.map:t.alphaMap&&(n=t.alphaMap),void 0!==n&&(!0===n.matrixAutoUpdate&&n.updateMatrix(),e.uvTransform.value.copy(n.matrix))}(e,i):i.isShadowMaterial?(e.color.value.copy(i.color),e.opacity.value=i.opacity):i.isShaderMaterial&&(i.uniformsNeedUpdate=!1)}}}function _a(e,t,n,i){let r={},s={},a=[],o=n.isWebGL2?e.getParameter(35375):0;function l(e,t,n){let i=e.value;if(void 0===n[t]){if("number"==typeof i)n[t]=i;else{let e=Array.isArray(i)?i:[i],r=[];for(let t=0;t<e.length;t++)r.push(e[t].clone());n[t]=r}return!0}if("number"==typeof i){if(n[t]!==i)return n[t]=i,!0}else{let e=Array.isArray(n[t])?n[t]:[n[t]],r=Array.isArray(i)?i:[i];for(let t=0;t<e.length;t++){let n=e[t];if(!1===n.equals(r[t]))return n.copy(r[t]),!0}}return!1}function c(e){let t={boundary:0,storage:0};return"number"==typeof e?(t.boundary=4,t.storage=4):e.isVector2?(t.boundary=8,t.storage=8):e.isVector3||e.isColor?(t.boundary=16,t.storage=12):e.isVector4?(t.boundary=16,t.storage=16):e.isMatrix3?(t.boundary=48,t.storage=48):e.isMatrix4?(t.boundary=64,t.storage=64):e.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",e),t}function h(t){let n=t.target;n.removeEventListener("dispose",h);let i=a.indexOf(n.__bindingPointIndex);a.splice(i,1),e.deleteBuffer(r[n.id]),delete r[n.id],delete s[n.id]}return{bind:function(e,t){let n=t.program;i.uniformBlockBinding(e,n)},update:function(n,u){let d=r[n.id];void 0===d&&(function(e){let t=e.uniforms,n=0,i=16,r=0;for(let s=0,a=t.length;s<a;s++){let e=t[s],a={boundary:0,storage:0},o=Array.isArray(e.value)?e.value:[e.value];for(let t=0,n=o.length;t<n;t++){let e=c(o[t]);a.boundary+=e.boundary,a.storage+=e.storage}if(e.__data=new Float32Array(a.storage/Float32Array.BYTES_PER_ELEMENT),e.__offset=n,s>0){r=n%i,0!==r&&i-r-a.boundary<0&&(n+=i-r,e.__offset=n)}n+=a.storage}r=n%i,r>0&&(n+=i-r),e.__size=n,e.__cache={}}(n),d=function(t){let n=function(){for(let e=0;e<o;e++)if(-1===a.indexOf(e))return a.push(e),e;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}();t.__bindingPointIndex=n;let i=e.createBuffer(),r=t.__size,s=t.usage;return e.bindBuffer(35345,i),e.bufferData(35345,r,s),e.bindBuffer(35345,null),e.bindBufferBase(35345,n,i),i}(n),r[n.id]=d,n.addEventListener("dispose",h));let p=u.program;i.updateUBOMapping(n,p);let f=t.render.frame;s[n.id]!==f&&(function(t){let n=r[t.id],i=t.uniforms,s=t.__cache;e.bindBuffer(35345,n);for(let r=0,a=i.length;r<a;r++){let t=i[r];if(!0===l(t,r,s)){let n=t.__offset,i=Array.isArray(t.value)?t.value:[t.value],r=0;for(let s=0;s<i.length;s++){let a=i[s],o=c(a);"number"==typeof a?(t.__data[0]=a,e.bufferSubData(35345,n+r,t.__data)):a.isMatrix3?(t.__data[0]=a.elements[0],t.__data[1]=a.elements[1],t.__data[2]=a.elements[2],t.__data[3]=a.elements[0],t.__data[4]=a.elements[3],t.__data[5]=a.elements[4],t.__data[6]=a.elements[5],t.__data[7]=a.elements[0],t.__data[8]=a.elements[6],t.__data[9]=a.elements[7],t.__data[10]=a.elements[8],t.__data[11]=a.elements[0]):(a.toArray(t.__data,r),r+=o.storage/Float32Array.BYTES_PER_ELEMENT)}e.bufferSubData(35345,n,t.__data)}}e.bindBuffer(35345,null)}(n),s[n.id]=f)},dispose:function(){for(let t in r)e.deleteBuffer(r[t]);a=[],r={},s={}}}}function Ea(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.isWebGLRenderer=!0;let t,n=void 0!==e.canvas?e.canvas:function(){let e=pt("canvas");return e.style.display="block",e}(),i=void 0!==e.context?e.context:null,r=void 0===e.depth||e.depth,s=void 0===e.stencil||e.stencil,a=void 0!==e.antialias&&e.antialias,o=void 0===e.premultipliedAlpha||e.premultipliedAlpha,l=void 0!==e.preserveDrawingBuffer&&e.preserveDrawingBuffer,c=void 0!==e.powerPreference?e.powerPreference:"default",h=void 0!==e.failIfMajorPerformanceCaveat&&e.failIfMajorPerformanceCaveat;t=null!==i?i.getContextAttributes().alpha:void 0!==e.alpha&&e.alpha;let u=null,d=null,p=[],f=[];this.domElement=n,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.outputEncoding=ze,this.physicallyCorrectLights=!1,this.toneMapping=0,this.toneMappingExposure=1;let m=this,g=!1,v=0,y=0,b=null,x=-1,w=null,S=new Ot,_=new Ot,E=null,A=n.width,C=n.height,M=1,T=null,P=null,D=new Ot(0,0,A,C),O=new Ot(0,0,A,C),I=!1,R=new qi,L=!1,B=!1,z=null,N=new pn,F=new ot,U=new Bt,j={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function V(){return null===b?M:1}let G,H,W,q,X,Y,Q,K,Z,J,$,ee,te,ne,ie,re,se,ae,oe,le,ce,he,ue,de,me=i;function ye(e,t){for(let i=0;i<e.length;i++){let r=e[i],s=n.getContext(r,t);if(null!==s)return s}return null}try{let e={alpha:!0,depth:r,stencil:s,antialias:a,premultipliedAlpha:o,preserveDrawingBuffer:l,powerPreference:c,failIfMajorPerformanceCaveat:h};if("setAttribute"in n&&n.setAttribute("data-engine","three.js r".concat(k)),n.addEventListener("webglcontextlost",Se,!1),n.addEventListener("webglcontextrestored",_e,!1),n.addEventListener("webglcontextcreationerror",Ee,!1),null===me){let t=["webgl2","webgl","experimental-webgl"];if(!0===m.isWebGL1Renderer&&t.shift(),me=ye(t,e),null===me)throw ye(t)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}void 0===me.getShaderPrecisionFormat&&(me.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(AJ){throw console.error("THREE.WebGLRenderer: "+AJ.message),AJ}function xe(){G=new wr(me),H=new ir(me,G,e),G.init(H),he=new ma(me,G,H),W=new pa(me,G,H),q=new Er,X=new $s,Y=new fa(me,G,W,X,H,he,q),Q=new sr(m),K=new xr(m),Z=new Yi(me,H),ue=new tr(me,G,Z,H),J=new Sr(me,Z,q,ue),$=new Tr(me,J,Z,q),oe=new Mr(me,H,Y),re=new rr(X),ee=new Js(m,Q,K,G,H,ue,re),te=new Sa(m,X),ne=new ia,ie=new ca(G,H),ae=new er(m,Q,K,W,$,t,o),se=new da(m,$,H),de=new _a(me,q,H,W),le=new nr(me,G,q,H),ce=new _r(me,G,q,H),q.programs=ee.programs,m.capabilities=H,m.extensions=G,m.properties=X,m.renderLists=ne,m.shadowMap=se,m.state=W,m.info=q}xe();let we=new wa(m,me);function Se(e){e.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),g=!0}function _e(){console.log("THREE.WebGLRenderer: Context Restored."),g=!1;let e=q.autoReset,t=se.enabled,n=se.autoUpdate,i=se.needsUpdate,r=se.type;xe(),q.autoReset=e,se.enabled=t,se.autoUpdate=n,se.needsUpdate=i,se.type=r}function Ee(e){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",e.statusMessage)}function Ae(e){let t=e.target;t.removeEventListener("dispose",Ae),function(e){(function(e){let t=X.get(e).programs;void 0!==t&&(t.forEach((function(e){ee.releaseProgram(e)})),e.isShaderMaterial&&ee.releaseShaderCache(e))})(e),X.remove(e)}(t)}this.xr=we,this.getContext=function(){return me},this.getContextAttributes=function(){return me.getContextAttributes()},this.forceContextLoss=function(){let e=G.get("WEBGL_lose_context");e&&e.loseContext()},this.forceContextRestore=function(){let e=G.get("WEBGL_lose_context");e&&e.restoreContext()},this.getPixelRatio=function(){return M},this.setPixelRatio=function(e){void 0!==e&&(M=e,this.setSize(A,C,!1))},this.getSize=function(e){return e.set(A,C)},this.setSize=function(e,t,i){we.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(A=e,C=t,n.width=Math.floor(e*M),n.height=Math.floor(t*M),!1!==i&&(n.style.width=e+"px",n.style.height=t+"px"),this.setViewport(0,0,e,t))},this.getDrawingBufferSize=function(e){return e.set(A*M,C*M).floor()},this.setDrawingBufferSize=function(e,t,i){A=e,C=t,M=i,n.width=Math.floor(e*i),n.height=Math.floor(t*i),this.setViewport(0,0,e,t)},this.getCurrentViewport=function(e){return e.copy(S)},this.getViewport=function(e){return e.copy(D)},this.setViewport=function(e,t,n,i){e.isVector4?D.set(e.x,e.y,e.z,e.w):D.set(e,t,n,i),W.viewport(S.copy(D).multiplyScalar(M).floor())},this.getScissor=function(e){return e.copy(O)},this.setScissor=function(e,t,n,i){e.isVector4?O.set(e.x,e.y,e.z,e.w):O.set(e,t,n,i),W.scissor(_.copy(O).multiplyScalar(M).floor())},this.getScissorTest=function(){return I},this.setScissorTest=function(e){W.setScissorTest(I=e)},this.setOpaqueSort=function(e){T=e},this.setTransparentSort=function(e){P=e},this.getClearColor=function(e){return e.copy(ae.getClearColor())},this.setClearColor=function(){ae.setClearColor.apply(ae,arguments)},this.getClearAlpha=function(){return ae.getClearAlpha()},this.setClearAlpha=function(){ae.setClearAlpha.apply(ae,arguments)},this.clear=function(){let e=0;(!(arguments.length>0&&void 0!==arguments[0])||arguments[0])&&(e|=16384),(!(arguments.length>1&&void 0!==arguments[1])||arguments[1])&&(e|=256),(!(arguments.length>2&&void 0!==arguments[2])||arguments[2])&&(e|=1024),me.clear(e)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){n.removeEventListener("webglcontextlost",Se,!1),n.removeEventListener("webglcontextrestored",_e,!1),n.removeEventListener("webglcontextcreationerror",Ee,!1),ne.dispose(),ie.dispose(),X.dispose(),Q.dispose(),K.dispose(),$.dispose(),ue.dispose(),de.dispose(),ee.dispose(),we.dispose(),we.removeEventListener("sessionstart",Me),we.removeEventListener("sessionend",Te),z&&(z.dispose(),z=null),Pe.stop()},this.renderBufferDirect=function(e,t,n,i,r,s){null===t&&(t=j);let a=r.isMesh&&r.matrixWorld.determinant()<0,o=function(e,t,n,i,r){!0!==t.isScene&&(t=j),Y.resetTextureUnits();let s=t.fog,a=i.isMeshStandardMaterial?t.environment:null,o=null===b?m.outputEncoding:!0===b.isXRRenderTarget?b.texture.encoding:ze,l=(i.isMeshStandardMaterial?K:Q).get(i.envMap||a),c=!0===i.vertexColors&&!!n.attributes.color&&4===n.attributes.color.itemSize,h=!!i.normalMap&&!!n.attributes.tangent,u=!!n.morphAttributes.position,p=!!n.morphAttributes.normal,f=!!n.morphAttributes.color,g=i.toneMapped?m.toneMapping:0,v=n.morphAttributes.position||n.morphAttributes.normal||n.morphAttributes.color,y=void 0!==v?v.length:0,S=X.get(i),_=d.state.lights;if(!0===L&&(!0===B||e!==w)){let t=e===w&&i.id===x;re.setState(i,e,t)}let E=!1;i.version===S.__version?(S.needsLights&&S.lightsStateVersion!==_.state.version||S.outputEncoding!==o||r.isInstancedMesh&&!1===S.instancing||!r.isInstancedMesh&&!0===S.instancing||r.isSkinnedMesh&&!1===S.skinning||!r.isSkinnedMesh&&!0===S.skinning||S.envMap!==l||!0===i.fog&&S.fog!==s||void 0!==S.numClippingPlanes&&(S.numClippingPlanes!==re.numPlanes||S.numIntersection!==re.numIntersection)||S.vertexAlphas!==c||S.vertexTangents!==h||S.morphTargets!==u||S.morphNormals!==p||S.morphColors!==f||S.toneMapping!==g||!0===H.isWebGL2&&S.morphTargetsCount!==y)&&(E=!0):(E=!0,S.__version=i.version);let A=S.currentProgram;!0===E&&(A=ke(i,t,r));let T=!1,P=!1,D=!1,O=A.getUniforms(),I=S.uniforms;if(W.useProgram(A.program)&&(T=!0,P=!0,D=!0),i.id!==x&&(x=i.id,P=!0),T||w!==e){if(O.setValue(me,"projectionMatrix",e.projectionMatrix),H.logarithmicDepthBuffer&&O.setValue(me,"logDepthBufFC",2/(Math.log(e.far+1)/Math.LN2)),w!==e&&(w=e,P=!0,D=!0),i.isShaderMaterial||i.isMeshPhongMaterial||i.isMeshToonMaterial||i.isMeshStandardMaterial||i.envMap){let t=O.map.cameraPosition;void 0!==t&&t.setValue(me,U.setFromMatrixPosition(e.matrixWorld))}(i.isMeshPhongMaterial||i.isMeshToonMaterial||i.isMeshLambertMaterial||i.isMeshBasicMaterial||i.isMeshStandardMaterial||i.isShaderMaterial)&&O.setValue(me,"isOrthographic",!0===e.isOrthographicCamera),(i.isMeshPhongMaterial||i.isMeshToonMaterial||i.isMeshLambertMaterial||i.isMeshBasicMaterial||i.isMeshStandardMaterial||i.isShaderMaterial||i.isShadowMaterial||r.isSkinnedMesh)&&O.setValue(me,"viewMatrix",e.matrixWorldInverse)}if(r.isSkinnedMesh){O.setOptional(me,r,"bindMatrix"),O.setOptional(me,r,"bindMatrixInverse");let e=r.skeleton;e&&(H.floatVertexTextures?(null===e.boneTexture&&e.computeBoneTexture(),O.setValue(me,"boneTexture",e.boneTexture,Y),O.setValue(me,"boneTextureSize",e.boneTextureSize)):console.warn("THREE.WebGLRenderer: SkinnedMesh can only be used with WebGL 2. With WebGL 1 OES_texture_float and vertex textures support is required."))}let R=n.morphAttributes;if((void 0!==R.position||void 0!==R.normal||void 0!==R.color&&!0===H.isWebGL2)&&oe.update(r,n,i,A),(P||S.receiveShadow!==r.receiveShadow)&&(S.receiveShadow=r.receiveShadow,O.setValue(me,"receiveShadow",r.receiveShadow)),i.isMeshGouraudMaterial&&null!==i.envMap&&(I.envMap.value=l,I.flipEnvMap.value=l.isCubeTexture&&!1===l.isRenderTargetTexture?-1:1),P&&(O.setValue(me,"toneMappingExposure",m.toneMappingExposure),S.needsLights&&function(e,t){e.ambientLightColor.needsUpdate=t,e.lightProbe.needsUpdate=t,e.directionalLights.needsUpdate=t,e.directionalLightShadows.needsUpdate=t,e.pointLights.needsUpdate=t,e.pointLightShadows.needsUpdate=t,e.spotLights.needsUpdate=t,e.spotLightShadows.needsUpdate=t,e.rectAreaLights.needsUpdate=t,e.hemisphereLights.needsUpdate=t}(I,D),s&&!0===i.fog&&te.refreshFogUniforms(I,s),te.refreshMaterialUniforms(I,i,M,C,z),Is.upload(me,S.uniformsList,I,Y)),i.isShaderMaterial&&!0===i.uniformsNeedUpdate&&(Is.upload(me,S.uniformsList,I,Y),i.uniformsNeedUpdate=!1),i.isSpriteMaterial&&O.setValue(me,"center",r.center),O.setValue(me,"modelViewMatrix",r.modelViewMatrix),O.setValue(me,"normalMatrix",r.normalMatrix),O.setValue(me,"modelMatrix",r.matrixWorld),r.previousModelViewMatrix&&O.setValue(me,"previousModelViewMatrix",r.previousModelViewMatrix),e.previousProjectionMatrix&&O.setValue(me,"previousProjectionMatrix",e.previousProjectionMatrix),i.isShaderMaterial||i.isRawShaderMaterial){let e=i.uniformsGroups;for(let t=0,n=e.length;t<n;t++)if(H.isWebGL2){let n=e[t];de.update(n,A),de.bind(n,A)}else console.warn("THREE.WebGLRenderer: Uniform Buffer Objects can only be used with WebGL 2.")}return A}(e,t,n,i,r);W.setMaterial(i,a);let l=n.index,c=1;!0===i.wireframe&&(l=J.getWireframeAttribute(n),c=2);let h=n.drawRange,u=n.attributes.position,p=h.start*c,f=(h.start+h.count)*c;null!==s&&(p=Math.max(p,s.start*c),f=Math.min(f,(s.start+s.count)*c)),null!==l?(p=Math.max(p,0),f=Math.min(f,l.count)):null!=u&&(p=Math.max(p,0),f=Math.min(f,u.count));let g=f-p;if(g<0||g===1/0)return;ue.setup(r,i,o,n,l);let v,y=le;if(null!==l&&(v=Z.get(l),y=ce,y.setIndex(v)),r.isMesh)!0===i.wireframe?(W.setLineWidth(i.wireframeLinewidth*V()),y.setMode(1)):y.setMode(4);else if(r.isLine){let e=i.linewidth;void 0===e&&(e=1),W.setLineWidth(e*V()),r.isLineSegments?y.setMode(1):r.isLineLoop?y.setMode(2):y.setMode(3)}else r.isPoints?y.setMode(0):r.isSprite&&y.setMode(4);if(r.isInstancedMesh)y.renderInstances(p,g,r.count);else if(n.isInstancedBufferGeometry){let e=void 0!==n._maxInstanceCount?n._maxInstanceCount:1/0,t=Math.min(n.instanceCount,e);y.renderInstances(p,g,t)}else y.render(p,g)},this.compile=function(e,t){function n(e,t,n){!0===e.transparent&&2===e.side&&!1===e.forceSinglePass?(e.side=1,e.needsUpdate=!0,ke(e,t,n),e.side=0,e.needsUpdate=!0,ke(e,t,n),e.side=2):ke(e,t,n)}d=ie.get(e),d.init(),f.push(d),e.traverseVisible((function(e){e.isLight&&e.layers.test(t.layers)&&(d.pushLight(e),e.castShadow&&d.pushShadow(e))})),d.setupLights(m.physicallyCorrectLights),e.traverse((function(t){let i=t.material;if(i)if(Array.isArray(i))for(let r=0;r<i.length;r++){n(i[r],e,t)}else n(i,e,t)})),f.pop(),d=null};let Ce=null;function Me(){Pe.stop()}function Te(){Pe.start()}let Pe=new Xi;function De(e,t,n,i){if(!1===e.visible)return;if(e.layers.test(t.layers))if(e.isGroup)n=e.renderOrder;else if(e.isLOD)!0===e.autoUpdate&&e.update(t);else if(e.isLight)d.pushLight(e),e.castShadow&&d.pushShadow(e);else if(e.isSprite){if(!e.frustumCulled||R.intersectsSprite(e)){i&&U.setFromMatrixPosition(e.matrixWorld).applyMatrix4(N);let t=$.update(e),r=e.material;r.visible&&u.push(e,t,r,n,U.z,null)}}else if((e.isMesh||e.isLine||e.isPoints)&&(e.isSkinnedMesh&&e.skeleton.frame!==q.render.frame&&(e.skeleton.update(),e.skeleton.frame=q.render.frame),!e.frustumCulled||R.intersectsObject(e))){i&&U.setFromMatrixPosition(e.matrixWorld).applyMatrix4(N);let t=$.update(e),r=e.material;if(Array.isArray(r)){let i=t.groups;for(let s=0,a=i.length;s<a;s++){let a=i[s],o=r[a.materialIndex];o&&o.visible&&u.push(e,t,o,n,U.z,a)}}else r.visible&&u.push(e,t,r,n,U.z,null)}let r=e.children;for(let s=0,a=r.length;s<a;s++)De(r[s],t,n,i)}function Oe(e,t,n,i){let r=e.opaque,s=e.transmissive,o=e.transparent;d.setupLightsView(n),!0===L&&re.setGlobalState(m.clippingPlanes,n),s.length>0&&function(e,t,n){let i=H.isWebGL2;null===z&&(z=new It(1,1,{generateMipmaps:!0,type:G.has("EXT_color_buffer_half_float")?ve:fe,minFilter:pe,samples:i&&!0===a?4:0})),m.getDrawingBufferSize(F),i?z.setSize(F.x,F.y):z.setSize(it(F.x),it(F.y));let r=m.getRenderTarget();m.setRenderTarget(z),m.clear();let s=m.toneMapping;m.toneMapping=0,Ie(e,t,n),m.toneMapping=s,Y.updateMultisampleRenderTarget(z),Y.updateRenderTargetMipmap(z),m.setRenderTarget(r)}(r,t,n),i&&W.viewport(S.copy(i)),r.length>0&&Ie(r,t,n),s.length>0&&Ie(s,t,n),o.length>0&&Ie(o,t,n),W.buffers.depth.setTest(!0),W.buffers.depth.setMask(!0),W.buffers.color.setMask(!0),W.setPolygonOffset(!1)}function Ie(e,t,n){let i=!0===t.isScene?t.overrideMaterial:null;for(let r=0,s=e.length;r<s;r++){let s=e[r],a=s.object,o=s.geometry,l=null===i?s.material:i,c=s.group;a.layers.test(n.layers)&&Re(a,t,n,o,l,c)}}function Re(e,t,n,i,r,s){e.onBeforeRender(m,t,n,i,r,s),e.modelViewMatrix.multiplyMatrices(n.matrixWorldInverse,e.matrixWorld),e.normalMatrix.getNormalMatrix(e.modelViewMatrix),r.onBeforeRender(m,t,n,i,e,s),!0===r.transparent&&2===r.side&&!1===r.forceSinglePass?(r.side=1,r.needsUpdate=!0,m.renderBufferDirect(n,t,i,r,e,s),r.side=0,r.needsUpdate=!0,m.renderBufferDirect(n,t,i,r,e,s),r.side=2):m.renderBufferDirect(n,t,i,r,e,s),e.onAfterRender(m,t,n,i,r,s)}function ke(e,t,n){!0!==t.isScene&&(t=j);let i=X.get(e),r=d.state.lights,s=d.state.shadowsArray,a=r.state.version,o=ee.getParameters(e,r.state,s,t,n),l=ee.getProgramCacheKey(o),c=i.programs;i.environment=e.isMeshStandardMaterial?t.environment:null,i.fog=t.fog,i.envMap=(e.isMeshStandardMaterial?K:Q).get(e.envMap||i.environment),void 0===c&&(e.addEventListener("dispose",Ae),c=new Map,i.programs=c);let h=c.get(l);if(void 0!==h){if(i.currentProgram===h&&i.lightsStateVersion===a)return Le(e,o),h}else o.uniforms=ee.getUniforms(e),e.onBuild(n,o,m),e.onBeforeCompile(o,m),h=ee.acquireProgram(o,l),c.set(l,h),i.uniforms=o.uniforms;let u=i.uniforms;(!e.isShaderMaterial&&!e.isRawShaderMaterial||!0===e.clipping)&&(u.clippingPlanes=re.uniform),Le(e,o),i.needsLights=function(e){return e.isMeshLambertMaterial||e.isMeshToonMaterial||e.isMeshPhongMaterial||e.isMeshStandardMaterial||e.isShadowMaterial||e.isShaderMaterial&&!0===e.lights}(e),i.lightsStateVersion=a,i.needsLights&&(u.ambientLightColor.value=r.state.ambient,u.lightProbe.value=r.state.probe,u.directionalLights.value=r.state.directional,u.directionalLightShadows.value=r.state.directionalShadow,u.spotLights.value=r.state.spot,u.spotLightShadows.value=r.state.spotShadow,u.rectAreaLights.value=r.state.rectArea,u.ltc_1.value=r.state.rectAreaLTC1,u.ltc_2.value=r.state.rectAreaLTC2,u.pointLights.value=r.state.point,u.pointLightShadows.value=r.state.pointShadow,u.hemisphereLights.value=r.state.hemi,u.directionalShadowMap.value=r.state.directionalShadowMap,u.directionalShadowMatrix.value=r.state.directionalShadowMatrix,u.spotShadowMap.value=r.state.spotShadowMap,u.spotLightMatrix.value=r.state.spotLightMatrix,u.spotLightMap.value=r.state.spotLightMap,u.pointShadowMap.value=r.state.pointShadowMap,u.pointShadowMatrix.value=r.state.pointShadowMatrix);let p=h.getUniforms(),f=Is.seqWithValue(p.seq,u);return i.currentProgram=h,i.uniformsList=f,h}function Le(e,t){let n=X.get(e);n.outputEncoding=t.outputEncoding,n.instancing=t.instancing,n.skinning=t.skinning,n.morphTargets=t.morphTargets,n.morphNormals=t.morphNormals,n.morphColors=t.morphColors,n.morphTargetsCount=t.morphTargetsCount,n.numClippingPlanes=t.numClippingPlanes,n.numIntersection=t.numClipIntersection,n.vertexAlphas=t.vertexAlphas,n.vertexTangents=t.vertexTangents,n.toneMapping=t.toneMapping}Pe.setAnimationLoop((function(e){Ce&&Ce(e)})),typeof self<"u"&&Pe.setContext(self),this.setAnimationLoop=function(e){Ce=e,we.setAnimationLoop(e),null===e?Pe.stop():Pe.start()},we.addEventListener("sessionstart",Me),we.addEventListener("sessionend",Te),this.render=function(e,t){if(void 0!==t&&!0!==t.isCamera)return void console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");if(!0===g)return;!0===e.matrixWorldAutoUpdate&&e.updateMatrixWorld(),null===t.parent&&!0===t.matrixWorldAutoUpdate&&t.updateMatrixWorld(),!0===we.enabled&&!0===we.isPresenting&&(!0===we.cameraAutoUpdate&&we.updateCamera(t),t=we.getCamera()),!0===e.isScene&&e.onBeforeRender(m,e,t,b),d=ie.get(e,f.length),d.init(),f.push(d),N.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),R.setFromProjectionMatrix(N),B=this.localClippingEnabled,L=re.init(this.clippingPlanes,B),u=ne.get(e,p.length),u.init(),p.push(u),De(e,t,0,m.sortObjects),u.finish(),!0===m.sortObjects&&u.sort(T,P),!0===L&&re.beginShadows();let n=d.state.shadowsArray;if(se.render(n,e,t),!0===L&&re.endShadows(),!0===this.info.autoReset&&this.info.reset(),ae.render(u,e),d.setupLights(m.physicallyCorrectLights),t.isArrayCamera){let n=t.cameras;for(let t=0,i=n.length;t<i;t++){let i=n[t];Oe(u,e,i,i.viewport)}}else Oe(u,e,t);null!==b&&(Y.updateMultisampleRenderTarget(b),Y.updateRenderTargetMipmap(b)),!0===e.isScene&&e.onAfterRender(m,e,t),ue.resetDefaultState(),x=-1,w=null,f.pop(),d=f.length>0?f[f.length-1]:null,p.pop(),u=p.length>0?p[p.length-1]:null},this.getActiveCubeFace=function(){return v},this.getActiveMipmapLevel=function(){return y},this.getRenderTarget=function(){return b},this.setRenderTargetTextures=function(e,t,n){X.get(e.texture).__webglTexture=t,X.get(e.depthTexture).__webglTexture=n;let i=X.get(e);i.__hasExternalTextures=!0,i.__hasExternalTextures&&(i.__autoAllocateDepthBuffer=void 0===n,i.__autoAllocateDepthBuffer||!0===G.has("WEBGL_multisampled_render_to_texture")&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),i.__useRenderToTexture=!1))},this.setRenderTargetFramebuffer=function(e,t){let n=X.get(e);n.__webglFramebuffer=t,n.__useDefaultFramebuffer=void 0===t},this.setRenderTarget=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;b=e,v=t,y=n;let i=!0,r=null,s=!1,a=!1;if(e){let n=X.get(e);void 0!==n.__useDefaultFramebuffer?(W.bindFramebuffer(36160,null),i=!1):void 0===n.__webglFramebuffer?Y.setupRenderTarget(e):n.__hasExternalTextures&&Y.rebindTextures(e,X.get(e.texture).__webglTexture,X.get(e.depthTexture).__webglTexture);let o=e.texture;(o.isData3DTexture||o.isDataArrayTexture||o.isCompressedArrayTexture)&&(a=!0);let l=X.get(e).__webglFramebuffer;e.isWebGLCubeRenderTarget?(r=l[t],s=!0):r=H.isWebGL2&&e.samples>0&&!1===Y.useMultisampledRTT(e)?X.get(e).__webglMultisampledFramebuffer:l,S.copy(e.viewport),_.copy(e.scissor),E=e.scissorTest}else S.copy(D).multiplyScalar(M).floor(),_.copy(O).multiplyScalar(M).floor(),E=I;if(W.bindFramebuffer(36160,r)&&H.drawBuffers&&i&&W.drawBuffers(e,r),W.viewport(S),W.scissor(_),W.setScissorTest(E),s){let i=X.get(e.texture);me.framebufferTexture2D(36160,36064,34069+t,i.__webglTexture,n)}else if(a){let i=X.get(e.texture),r=t||0;me.framebufferTextureLayer(36160,36064,i.__webglTexture,n||0,r)}x=-1},this.readRenderTargetPixels=function(e,t,n,i,r,s,a){if(!e||!e.isWebGLRenderTarget)return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let o=X.get(e).__webglFramebuffer;if(e.isWebGLCubeRenderTarget&&void 0!==a&&(o=o[a]),o){W.bindFramebuffer(36160,o);try{let a=e.texture,o=a.format,l=a.type;if(o!==be&&he.convert(o)!==me.getParameter(35739))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");let c=l===ve&&(G.has("EXT_color_buffer_half_float")||H.isWebGL2&&G.has("EXT_color_buffer_float"));if(l!==fe&&he.convert(l)!==me.getParameter(35738)&&(l!==ge||!(H.isWebGL2||G.has("OES_texture_float")||G.has("WEBGL_color_buffer_float")))&&!c)return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");t>=0&&t<=e.width-i&&n>=0&&n<=e.height-r&&me.readPixels(t,n,i,r,he.convert(o),he.convert(l),s)}finally{let e=null!==b?X.get(b).__webglFramebuffer:null;W.bindFramebuffer(36160,e)}}},this.readRenderTargetPixelsAsync=async function(e,t,n,i,r,s,a){if(!e||!e.isWebGLRenderTarget)throw new Error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let o=X.get(e).__webglFramebuffer;if(e.isWebGLCubeRenderTarget&&void 0!==a&&(o=o[a]),o){let a=e.texture,l=a.format,c=a.type;if(t>=0&&t<=e.width-i&&n>=0&&n<=e.height-r){W.bindFramebuffer(me.FRAMEBUFFER,o);let e=me.createBuffer();me.bindBuffer(me.PIXEL_PACK_BUFFER,e),me.bufferData(me.PIXEL_PACK_BUFFER,s.byteLength,me.STREAM_READ),me.readPixels(t,n,i,r,he.convert(l),he.convert(c),0);let a=null!==b?X.get(b).__webglFramebuffer:null;W.bindFramebuffer(me.FRAMEBUFFER,a);let h=me.fenceSync(me.SYNC_GPU_COMMANDS_COMPLETE,0);return me.flush(),await function(e,t,n){return new Promise((function(i,r){setTimeout((function s(){switch(e.clientWaitSync(t,e.SYNC_FLUSH_COMMANDS_BIT,0)){case e.WAIT_FAILED:r();break;case e.TIMEOUT_EXPIRED:setTimeout(s,n);break;default:i()}}),n)}))}(me,h,4),me.bindBuffer(me.PIXEL_PACK_BUFFER,e),me.getBufferSubData(me.PIXEL_PACK_BUFFER,0,s),me.deleteBuffer(e),me.deleteSync(h),s}throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: requested read bounds are out of range.")}},this.copyFramebufferToTexture=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=Math.pow(2,-n),r=Math.floor(t.image.width*i),s=Math.floor(t.image.height*i);Y.setTexture2D(t,0),me.copyTexSubImage2D(3553,n,0,0,e.x,e.y,r,s),W.unbindTexture()},this.copyTextureToTexture=function(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,r=t.image.width,s=t.image.height,a=he.convert(n.format),o=he.convert(n.type);Y.setTexture2D(n,0),me.pixelStorei(37440,n.flipY),me.pixelStorei(37441,n.premultiplyAlpha),me.pixelStorei(3317,n.unpackAlignment),t.isDataTexture?me.texSubImage2D(3553,i,e.x,e.y,r,s,a,o,t.image.data):t.isCompressedTexture?me.compressedTexSubImage2D(3553,i,e.x,e.y,t.mipmaps[0].width,t.mipmaps[0].height,a,t.mipmaps[0].data):me.texSubImage2D(3553,i,e.x,e.y,a,o,t.image),0===i&&n.generateMipmaps&&me.generateMipmap(3553),W.unbindTexture()},this.copyTextureToTexture3D=function(e,t,n,i){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;if(m.isWebGL1Renderer)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");let s,a=e.max.x-e.min.x+1,o=e.max.y-e.min.y+1,l=e.max.z-e.min.z+1,c=he.convert(i.format),h=he.convert(i.type);if(i.isData3DTexture)Y.setTexture3D(i,0),s=32879;else{if(!i.isDataArrayTexture)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");Y.setTexture2DArray(i,0),s=35866}me.pixelStorei(37440,i.flipY),me.pixelStorei(37441,i.premultiplyAlpha),me.pixelStorei(3317,i.unpackAlignment);let u=me.getParameter(3314),d=me.getParameter(32878),p=me.getParameter(3316),f=me.getParameter(3315),g=me.getParameter(32877),v=n.isCompressedTexture?n.mipmaps[0]:n.image;me.pixelStorei(3314,v.width),me.pixelStorei(32878,v.height),me.pixelStorei(3316,e.min.x),me.pixelStorei(3315,e.min.y),me.pixelStorei(32877,e.min.z),n.isDataTexture||n.isData3DTexture?me.texSubImage3D(s,r,t.x,t.y,t.z,a,o,l,c,h,v.data):n.isCompressedArrayTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),me.compressedTexSubImage3D(s,r,t.x,t.y,t.z,a,o,l,c,v.data)):me.texSubImage3D(s,r,t.x,t.y,t.z,a,o,l,c,h,v),me.pixelStorei(3314,u),me.pixelStorei(32878,d),me.pixelStorei(3316,p),me.pixelStorei(3315,f),me.pixelStorei(32877,g),0===r&&i.generateMipmaps&&me.generateMipmap(s),W.unbindTexture()},this.initRenderTarget=function(e){void 0===X.get(e).__webglFramebuffer&&Y.setupRenderTarget(e)},this.initTexture=function(e){e.isCubeTexture?Y.setTextureCube(e,0):e.isData3DTexture?Y.setTexture3D(e,0):e.isDataArrayTexture||e.isCompressedArrayTexture?Y.setTexture2DArray(e,0):Y.setTexture2D(e,0),W.unbindTexture()},this.resetState=function(){v=0,y=0,b=null,W.reset(),ue.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}(class extends Ea{}).prototype.isWebGL1Renderer=!0;var Aa=class{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e3;this.isFog=!0,this.name="",this.color=new Et(e),this.near=t,this.far=n}clone(){return new Aa(this.color,this.near,this.far)}toJSON(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}}},Ca=class extends Nn{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),null!==e.background&&(this.background=e.background.clone()),null!==e.environment&&(this.environment=e.environment.clone()),null!==e.fog&&(this.fog=e.fog.clone()),this.backgroundBlurriness=e.backgroundBlurriness,this.backgroundIntensity=e.backgroundIntensity,null!==e.overrideMaterial&&(this.overrideMaterial=e.overrideMaterial.clone()),this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){let t=super.toJSON(e);return null!==this.fog&&(t.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(t.object.backgroundBlurriness=this.backgroundBlurriness),1!==this.backgroundIntensity&&(t.object.backgroundIntensity=this.backgroundIntensity),t}get autoUpdate(){return console.warn("THREE.Scene: autoUpdate was renamed to matrixWorldAutoUpdate in r144."),this.matrixWorldAutoUpdate}set autoUpdate(e){console.warn("THREE.Scene: autoUpdate was renamed to matrixWorldAutoUpdate in r144."),this.matrixWorldAutoUpdate=e}},Ma=class{constructor(e,t){this.isInterleavedBuffer=!0,this.array=e,this.stride=t,this.count=void 0!==e?e.length/t:0,this.usage=Ge,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=Ze()}onUploadCallback(){}set needsUpdate(e){!0===e&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}copyAt(e,t,n){e*=this.stride,n*=t.stride;for(let i=0,r=this.stride;i<r;i++)this.array[e+i]=t.array[n+i];return this}set(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.array.set(e,t),this}clone(e){void 0===e.arrayBuffers&&(e.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=Ze()),void 0===e.arrayBuffers[this.array.buffer._uuid]&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);let t=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),n=new this.constructor(t,this.stride);return n.setUsage(this.usage),n}onUpload(e){return this.onUploadCallback=e,this}toJSON(e){return void 0===e.arrayBuffers&&(e.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=Ze()),void 0===e.arrayBuffers[this.array.buffer._uuid]&&(e.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}},Ta=new Bt,Pa=class{constructor(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this.isInterleavedBufferAttribute=!0,this.name="",this.data=e,this.itemSize=t,this.offset=n,this.normalized=i}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){this.data.needsUpdate=e}applyMatrix4(e){for(let t=0,n=this.data.count;t<n;t++)Ta.fromBufferAttribute(this,t),Ta.applyMatrix4(e),this.setXYZ(t,Ta.x,Ta.y,Ta.z);return this}applyNormalMatrix(e){for(let t=0,n=this.count;t<n;t++)Ta.fromBufferAttribute(this,t),Ta.applyNormalMatrix(e),this.setXYZ(t,Ta.x,Ta.y,Ta.z);return this}transformDirection(e){for(let t=0,n=this.count;t<n;t++)Ta.fromBufferAttribute(this,t),Ta.transformDirection(e),this.setXYZ(t,Ta.x,Ta.y,Ta.z);return this}setX(e,t){return this.normalized&&(t=st(t,this.array)),this.data.array[e*this.data.stride+this.offset]=t,this}setY(e,t){return this.normalized&&(t=st(t,this.array)),this.data.array[e*this.data.stride+this.offset+1]=t,this}setZ(e,t){return this.normalized&&(t=st(t,this.array)),this.data.array[e*this.data.stride+this.offset+2]=t,this}setW(e,t){return this.normalized&&(t=st(t,this.array)),this.data.array[e*this.data.stride+this.offset+3]=t,this}getX(e){let t=this.data.array[e*this.data.stride+this.offset];return this.normalized&&(t=rt(t,this.array)),t}getY(e){let t=this.data.array[e*this.data.stride+this.offset+1];return this.normalized&&(t=rt(t,this.array)),t}getZ(e){let t=this.data.array[e*this.data.stride+this.offset+2];return this.normalized&&(t=rt(t,this.array)),t}getW(e){let t=this.data.array[e*this.data.stride+this.offset+3];return this.normalized&&(t=rt(t,this.array)),t}setXY(e,t,n){return e=e*this.data.stride+this.offset,this.normalized&&(t=st(t,this.array),n=st(n,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=n,this}setXYZ(e,t,n,i){return e=e*this.data.stride+this.offset,this.normalized&&(t=st(t,this.array),n=st(n,this.array),i=st(i,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=i,this}setXYZW(e,t,n,i,r){return e=e*this.data.stride+this.offset,this.normalized&&(t=st(t,this.array),n=st(n,this.array),i=st(i,this.array),r=st(r,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=i,this.data.array[e+3]=r,this}clone(e){if(void 0===e){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");let e=[];for(let t=0;t<this.count;t++){let n=t*this.data.stride+this.offset;for(let t=0;t<this.itemSize;t++)e.push(this.data.array[n+t])}return new ti(new this.array.constructor(e),this.itemSize,this.normalized)}return void 0===e.interleavedBuffers&&(e.interleavedBuffers={}),void 0===e.interleavedBuffers[this.data.uuid]&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new Pa(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(e){if(void 0===e){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");let e=[];for(let t=0;t<this.count;t++){let n=t*this.data.stride+this.offset;for(let t=0;t<this.itemSize;t++)e.push(this.data.array[n+t])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:e,normalized:this.normalized}}return void 0===e.interleavedBuffers&&(e.interleavedBuffers={}),void 0===e.interleavedBuffers[this.data.uuid]&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}},Da=class extends Nn{constructor(){super(),this.isBone=!0,this.type="Bone"}},Oa=class extends Dt{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;super(null,arguments.length>5?arguments[5]:void 0,arguments.length>6?arguments[6]:void 0,arguments.length>7?arguments[7]:void 0,arguments.length>8&&void 0!==arguments[8]?arguments[8]:le,arguments.length>9&&void 0!==arguments[9]?arguments[9]:le,arguments.length>3?arguments[3]:void 0,arguments.length>4?arguments[4]:void 0,arguments.length>10?arguments[10]:void 0,arguments.length>11?arguments[11]:void 0),this.isDataTexture=!0,this.image={data:e,width:t,height:n},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}},Ia=new pn,Ra=new pn,ka=class{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];this.uuid=Ze(),this.bones=e.slice(0),this.boneInverses=t,this.boneMatrices=null,this.boneTexture=null,this.boneTextureSize=0,this.frame=-1,this.init()}init(){let e=this.bones,t=this.boneInverses;if(this.boneMatrices=new Float32Array(16*e.length),0===t.length)this.calculateInverses();else if(e.length!==t.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let e=0,t=this.bones.length;e<t;e++)this.boneInverses.push(new pn)}}calculateInverses(){this.boneInverses.length=0;for(let e=0,t=this.bones.length;e<t;e++){let t=new pn;this.bones[e]&&t.copy(this.bones[e].matrixWorld).invert(),this.boneInverses.push(t)}}pose(){for(let e=0,t=this.bones.length;e<t;e++){let t=this.bones[e];t&&t.matrixWorld.copy(this.boneInverses[e]).invert()}for(let e=0,t=this.bones.length;e<t;e++){let t=this.bones[e];t&&(t.parent&&t.parent.isBone?(t.matrix.copy(t.parent.matrixWorld).invert(),t.matrix.multiply(t.matrixWorld)):t.matrix.copy(t.matrixWorld),t.matrix.decompose(t.position,t.quaternion,t.scale))}}update(){let e=this.bones,t=this.boneInverses,n=this.boneMatrices,i=this.boneTexture;for(let r=0,s=e.length;r<s;r++){let i=e[r]?e[r].matrixWorld:Ra;Ia.multiplyMatrices(i,t[r]),Ia.toArray(n,16*r)}null!==i&&(i.needsUpdate=!0)}clone(){return new ka(this.bones,this.boneInverses)}computeBoneTexture(){let e=Math.sqrt(4*this.bones.length);e=nt(e),e=Math.max(e,4);let t=new Float32Array(e*e*4);t.set(this.boneMatrices);let n=new Oa(t,e,e,be,ge);return n.needsUpdate=!0,this.boneMatrices=t,this.boneTexture=n,this.boneTextureSize=e,this}getBoneByName(e){for(let t=0,n=this.bones.length;t<n;t++){let n=this.bones[t];if(n.name===e)return n}}dispose(){null!==this.boneTexture&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(e,t){this.uuid=e.uuid;for(let n=0,i=e.bones.length;n<i;n++){let i=e.bones[n],r=t[i];void 0===r&&(console.warn("THREE.Skeleton: No bone found with UUID:",i),r=new Da),this.bones.push(r),this.boneInverses.push((new pn).fromArray(e.boneInverses[n]))}return this.init(),this}toJSON(){let e={metadata:{version:4.5,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};e.uuid=this.uuid;let t=this.bones,n=this.boneInverses;for(let i=0,r=t.length;i<r;i++){let r=t[i];e.bones.push(r.uuid);let s=n[i];e.boneInverses.push(s.toArray())}return e}},La=class extends ti{constructor(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;super(e,t,n),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=i}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}toJSON(){let e=super.toJSON();return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}},Ba=new pn,za=new pn,Na=[],Fa=new pn,Ua=new Ci,ja=class extends Ci{constructor(e,t,n){super(e,t),this.isInstancedMesh=!0,this.instanceMatrix=new La(new Float32Array(16*n),16),this.instanceColor=null,this.count=n,this.frustumCulled=!1;for(let i=0;i<n;i++)this.setMatrixAt(i,Fa)}copy(e,t){return super.copy(e,t),this.instanceMatrix.copy(e.instanceMatrix),null!==e.instanceColor&&(this.instanceColor=e.instanceColor.clone()),this.count=e.count,this}getColorAt(e,t){t.fromArray(this.instanceColor.array,3*e)}getMatrixAt(e,t){t.fromArray(this.instanceMatrix.array,16*e)}raycast(e,t){let n=this.matrixWorld,i=this.count;if(Ua.geometry=this.geometry,Ua.material=this.material,void 0!==Ua.material)for(let r=0;r<i;r++){this.getMatrixAt(r,Ba),za.multiplyMatrices(n,Ba),Ua.matrixWorld=za,Ua.raycast(e,Na);for(let e=0,n=Na.length;e<n;e++){let n=Na[e];n.instanceId=r,n.object=this,t.push(n)}Na.length=0}}setColorAt(e,t){null===this.instanceColor&&(this.instanceColor=new La(new Float32Array(3*this.instanceMatrix.count),3)),t.toArray(this.instanceColor.array,3*e)}setMatrixAt(e,t){t.toArray(this.instanceMatrix.array,16*e)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"})}},Va=class extends Zn{constructor(e){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new Et(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.fog=e.fog,this}},Ga=new Bt,Ha=new Bt,Wa=new pn,qa=new dn,Xa=new rn,Ya=class extends Nn{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new di,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Va;super(),this.isLine=!0,this.type="Line",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=e.material,this.geometry=e.geometry,this}computeLineDistances(){let e=this.geometry;if(null===e.index){let t=e.attributes.position,n=[0];for(let e=1,i=t.count;e<i;e++)Ga.fromBufferAttribute(t,e-1),Ha.fromBufferAttribute(t,e),n[e]=n[e-1],n[e]+=Ga.distanceTo(Ha);e.setAttribute("lineDistance",new ri(n,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(e,t){let n=this.geometry,i=this.matrixWorld,r=e.params.Line.threshold,s=n.drawRange;if(null===n.boundingSphere&&n.computeBoundingSphere(),Xa.copy(n.boundingSphere),Xa.applyMatrix4(i),Xa.radius+=r,!1===e.ray.intersectsSphere(Xa))return;Wa.copy(i).invert(),qa.copy(e.ray).applyMatrix4(Wa);let a=r/((this.scale.x+this.scale.y+this.scale.z)/3),o=a*a,l=new Bt,c=new Bt,h=new Bt,u=new Bt,d=this.isLineSegments?2:1,p=n.index,f=n.attributes.position;if(null!==p){for(let n=Math.max(0,s.start),i=Math.min(p.count,s.start+s.count)-1;n<i;n+=d){let i=p.getX(n),r=p.getX(n+1);if(l.fromBufferAttribute(f,i),c.fromBufferAttribute(f,r),qa.distanceSqToSegment(l,c,u,h)>o)continue;u.applyMatrix4(this.matrixWorld);let s=e.ray.origin.distanceTo(u);s<e.near||s>e.far||t.push({distance:s,point:h.clone().applyMatrix4(this.matrixWorld),index:n,face:null,faceIndex:null,object:this})}}else{for(let n=Math.max(0,s.start),i=Math.min(f.count,s.start+s.count)-1;n<i;n+=d){if(l.fromBufferAttribute(f,n),c.fromBufferAttribute(f,n+1),qa.distanceSqToSegment(l,c,u,h)>o)continue;u.applyMatrix4(this.matrixWorld);let i=e.ray.origin.distanceTo(u);i<e.near||i>e.far||t.push({distance:i,point:h.clone().applyMatrix4(this.matrixWorld),index:n,face:null,faceIndex:null,object:this})}}}updateMorphTargets(){let e=this.geometry.morphAttributes,t=Object.keys(e);if(t.length>0){let n=e[t[0]];if(void 0!==n){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,t=n.length;e<t;e++){let t=n[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[t]=e}}}}},Qa=new Bt,Ka=new Bt,Za=class extends Ya{constructor(e,t){super(e,t),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){let e=this.geometry;if(null===e.index){let t=e.attributes.position,n=[];for(let e=0,i=t.count;e<i;e+=2)Qa.fromBufferAttribute(t,e),Ka.fromBufferAttribute(t,e+1),n[e]=0===e?0:n[e-1],n[e+1]=n[e]+Qa.distanceTo(Ka);e.setAttribute("lineDistance",new ri(n,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}},Ja=class extends Dt{constructor(e,t,n,i,r,s,a,o,l){super(e,t,n,i,r,s,a,o,l),this.isVideoTexture=!0,this.minFilter=void 0!==s?s:ue,this.magFilter=void 0!==r?r:ue,this.generateMipmaps=!1;let c=this;"requestVideoFrameCallback"in e&&e.requestVideoFrameCallback((function t(){c.needsUpdate=!0,e.requestVideoFrameCallback(t)}))}clone(){return new this.constructor(this.image).copy(this)}update(){let e=this.image;"requestVideoFrameCallback"in e===!1&&e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}},$a=class extends Dt{constructor(e,t,n,i,r,s,a,o,l){super(e,t,n,i,r,s,a,o,l),this.isCanvasTexture=!0,this.needsUpdate=!0}},eo=class{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(e,t){let n=this.getUtoTmapping(e);return this.getPoint(n,t)}getPoints(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:5,t=[];for(let n=0;n<=e;n++)t.push(this.getPoint(n/e));return t}getSpacedPoints(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:5,t=[];for(let n=0;n<=e;n++)t.push(this.getPointAt(n/e));return t}getLength(){let e=this.getLengths();return e[e.length-1]}getLengths(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.arcLengthDivisions;if(this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;let t,n=[],i=this.getPoint(0),r=0;n.push(0);for(let s=1;s<=e;s++)t=this.getPoint(s/e),r+=t.distanceTo(i),n.push(r),i=t;return this.cacheArcLengths=n,n}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(e,t){let n,i=this.getLengths(),r=0,s=i.length;n=t||e*i[s-1];let a,o=0,l=s-1;for(;o<=l;)if(r=Math.floor(o+(l-o)/2),a=i[r]-n,a<0)o=r+1;else{if(!(a>0)){l=r;break}l=r-1}if(r=l,i[r]===n)return r/(s-1);let c=i[r];return(r+(n-c)/(i[r+1]-c))/(s-1)}getTangent(e,t){let n=e-1e-4,i=e+1e-4;n<0&&(n=0),i>1&&(i=1);let r=this.getPoint(n),s=this.getPoint(i),a=t||(r.isVector2?new ot:new Bt);return a.copy(s).sub(r).normalize(),a}getTangentAt(e,t){let n=this.getUtoTmapping(e);return this.getTangent(n,t)}computeFrenetFrames(e,t){let n=new Bt,i=[],r=[],s=[],a=new Bt,o=new pn;for(let d=0;d<=e;d++){let t=d/e;i[d]=this.getTangentAt(t,new Bt)}r[0]=new Bt,s[0]=new Bt;let l=Number.MAX_VALUE,c=Math.abs(i[0].x),h=Math.abs(i[0].y),u=Math.abs(i[0].z);c<=l&&(l=c,n.set(1,0,0)),h<=l&&(l=h,n.set(0,1,0)),u<=l&&n.set(0,0,1),a.crossVectors(i[0],n).normalize(),r[0].crossVectors(i[0],a),s[0].crossVectors(i[0],r[0]);for(let d=1;d<=e;d++){if(r[d]=r[d-1].clone(),s[d]=s[d-1].clone(),a.crossVectors(i[d-1],i[d]),a.length()>Number.EPSILON){a.normalize();let e=Math.acos(Je(i[d-1].dot(i[d]),-1,1));r[d].applyMatrix4(o.makeRotationAxis(a,e))}s[d].crossVectors(i[d],r[d])}if(!0===t){let t=Math.acos(Je(r[0].dot(r[e]),-1,1));t/=e,i[0].dot(a.crossVectors(r[0],r[e]))>0&&(t=-t);for(let n=1;n<=e;n++)r[n].applyMatrix4(o.makeRotationAxis(i[n],t*n)),s[n].crossVectors(i[n],r[n])}return{tangents:i,normals:r,binormals:s}}clone(){return(new this.constructor).copy(this)}copy(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}toJSON(){let e={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e}fromJSON(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}},to=class extends eo{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:2*Math.PI,a=arguments.length>6&&void 0!==arguments[6]&&arguments[6],o=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0;super(),this.isEllipseCurve=!0,this.type="EllipseCurve",this.aX=e,this.aY=t,this.xRadius=n,this.yRadius=i,this.aStartAngle=r,this.aEndAngle=s,this.aClockwise=a,this.aRotation=o}getPoint(e,t){let n=t||new ot,i=2*Math.PI,r=this.aEndAngle-this.aStartAngle,s=Math.abs(r)<Number.EPSILON;for(;r<0;)r+=i;for(;r>i;)r-=i;r<Number.EPSILON&&(r=s?0:i),!0===this.aClockwise&&!s&&(r===i?r=-i:r-=i);let a=this.aStartAngle+e*r,o=this.aX+this.xRadius*Math.cos(a),l=this.aY+this.yRadius*Math.sin(a);if(0!==this.aRotation){let e=Math.cos(this.aRotation),t=Math.sin(this.aRotation),n=o-this.aX,i=l-this.aY;o=n*e-i*t+this.aX,l=n*t+i*e+this.aY}return n.set(o,l)}copy(e){return super.copy(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}toJSON(){let e=super.toJSON();return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e}fromJSON(e){return super.fromJSON(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}};function no(){let e=0,t=0,n=0,i=0;function r(r,s,a,o){e=r,t=a,n=-3*r+3*s-2*a-o,i=2*r-2*s+a+o}return{initCatmullRom:function(e,t,n,i,s){r(t,n,s*(n-e),s*(i-t))},initNonuniformCatmullRom:function(e,t,n,i,s,a,o){let l=(t-e)/s-(n-e)/(s+a)+(n-t)/a,c=(n-t)/a-(i-t)/(a+o)+(i-n)/o;l*=a,c*=a,r(t,n,l,c)},calc:function(r){let s=r*r;return e+t*r+n*s+i*(s*r)}}}var io=new Bt,ro=new no,so=new no,ao=new no;function oo(e,t,n,i,r){let s=.5*(i-t),a=.5*(r-n),o=e*e;return(2*n-2*i+s+a)*(e*o)+(-3*n+3*i-2*s-a)*o+s*e+n}function lo(e,t,n,i){return function(e,t){let n=1-e;return n*n*t}(e,t)+function(e,t){return 2*(1-e)*e*t}(e,n)+function(e,t){return e*e*t}(e,i)}function co(e,t,n,i,r){return function(e,t){let n=1-e;return n*n*n*t}(e,t)+function(e,t){let n=1-e;return 3*n*n*e*t}(e,n)+function(e,t){return 3*(1-e)*e*e*t}(e,i)+function(e,t){return e*e*e*t}(e,r)}var ho=class extends eo{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new ot,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new ot,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new ot,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new ot;super(),this.isCubicBezierCurve=!0,this.type="CubicBezierCurve",this.v0=e,this.v1=t,this.v2=n,this.v3=i}getPoint(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new ot,n=this.v0,i=this.v1,r=this.v2,s=this.v3;return t.set(co(e,n.x,i.x,r.x,s.x),co(e,n.y,i.y,r.y,s.y)),t}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){let e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}},uo=class extends eo{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Bt,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Bt,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Bt,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new Bt;super(),this.isCubicBezierCurve3=!0,this.type="CubicBezierCurve3",this.v0=e,this.v1=t,this.v2=n,this.v3=i}getPoint(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Bt,n=this.v0,i=this.v1,r=this.v2,s=this.v3;return t.set(co(e,n.x,i.x,r.x,s.x),co(e,n.y,i.y,r.y,s.y),co(e,n.z,i.z,r.z,s.z)),t}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){let e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}},po=class extends eo{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new ot,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new ot;super(),this.isLineCurve=!0,this.type="LineCurve",this.v1=e,this.v2=t}getPoint(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new ot;return 1===e?t.copy(this.v2):(t.copy(this.v2).sub(this.v1),t.multiplyScalar(e).add(this.v1)),t}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e,t){let n=t||new ot;return n.copy(this.v2).sub(this.v1).normalize(),n}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){let e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}},fo=class extends eo{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Bt,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Bt;super(),this.isLineCurve3=!0,this.type="LineCurve3",this.v1=e,this.v2=t}getPoint(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Bt;return 1===e?t.copy(this.v2):(t.copy(this.v2).sub(this.v1),t.multiplyScalar(e).add(this.v1)),t}getPointAt(e,t){return this.getPoint(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){let e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}},mo=class extends eo{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new ot,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new ot,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new ot;super(),this.isQuadraticBezierCurve=!0,this.type="QuadraticBezierCurve",this.v0=e,this.v1=t,this.v2=n}getPoint(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new ot,n=this.v0,i=this.v1,r=this.v2;return t.set(lo(e,n.x,i.x,r.x),lo(e,n.y,i.y,r.y)),t}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){let e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}},go=class extends eo{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];super(),this.isSplineCurve=!0,this.type="SplineCurve",this.points=e}getPoint(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new ot,n=this.points,i=(n.length-1)*e,r=Math.floor(i),s=i-r,a=n[0===r?r:r-1],o=n[r],l=n[r>n.length-2?n.length-1:r+1],c=n[r>n.length-3?n.length-1:r+2];return t.set(oo(s,a.x,o.x,l.x,c.x),oo(s,a.y,o.y,l.y,c.y)),t}copy(e){super.copy(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){let n=e.points[t];this.points.push(n.clone())}return this}toJSON(){let e=super.toJSON();e.points=[];for(let t=0,n=this.points.length;t<n;t++){let n=this.points[t];e.points.push(n.toArray())}return e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){let n=e.points[t];this.points.push((new ot).fromArray(n))}return this}},vo=Object.freeze({__proto__:null,ArcCurve:class extends to{constructor(e,t,n,i,r,s){super(e,t,n,n,i,r,s),this.isArcCurve=!0,this.type="ArcCurve"}},CatmullRomCurve3:class extends eo{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"centripetal",i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5;super(),this.isCatmullRomCurve3=!0,this.type="CatmullRomCurve3",this.points=e,this.closed=t,this.curveType=n,this.tension=i}getPoint(e){let t,n,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Bt,r=this.points,s=r.length,a=(s-(this.closed?0:1))*e,o=Math.floor(a),l=a-o;this.closed?o+=o>0?0:(Math.floor(Math.abs(o)/s)+1)*s:0===l&&o===s-1&&(o=s-2,l=1),this.closed||o>0?t=r[(o-1)%s]:(io.subVectors(r[0],r[1]).add(r[0]),t=io);let c=r[o%s],h=r[(o+1)%s];if(this.closed||o+2<s?n=r[(o+2)%s]:(io.subVectors(r[s-1],r[s-2]).add(r[s-1]),n=io),"centripetal"===this.curveType||"chordal"===this.curveType){let e="chordal"===this.curveType?.5:.25,i=Math.pow(t.distanceToSquared(c),e),r=Math.pow(c.distanceToSquared(h),e),s=Math.pow(h.distanceToSquared(n),e);r<1e-4&&(r=1),i<1e-4&&(i=r),s<1e-4&&(s=r),ro.initNonuniformCatmullRom(t.x,c.x,h.x,n.x,i,r,s),so.initNonuniformCatmullRom(t.y,c.y,h.y,n.y,i,r,s),ao.initNonuniformCatmullRom(t.z,c.z,h.z,n.z,i,r,s)}else"catmullrom"===this.curveType&&(ro.initCatmullRom(t.x,c.x,h.x,n.x,this.tension),so.initCatmullRom(t.y,c.y,h.y,n.y,this.tension),ao.initCatmullRom(t.z,c.z,h.z,n.z,this.tension));return i.set(ro.calc(l),so.calc(l),ao.calc(l)),i}copy(e){super.copy(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){let n=e.points[t];this.points.push(n.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}toJSON(){let e=super.toJSON();e.points=[];for(let t=0,n=this.points.length;t<n;t++){let n=this.points[t];e.points.push(n.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){let n=e.points[t];this.points.push((new Bt).fromArray(n))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}},CubicBezierCurve:ho,CubicBezierCurve3:uo,EllipseCurve:to,LineCurve:po,LineCurve3:fo,QuadraticBezierCurve:mo,QuadraticBezierCurve3:class extends eo{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Bt,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Bt,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Bt;super(),this.isQuadraticBezierCurve3=!0,this.type="QuadraticBezierCurve3",this.v0=e,this.v1=t,this.v2=n}getPoint(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Bt,n=this.v0,i=this.v1,r=this.v2;return t.set(lo(e,n.x,i.x,r.x),lo(e,n.y,i.y,r.y),lo(e,n.z,i.z,r.z)),t}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){let e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}},SplineCurve:go}),yo=class extends eo{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(e){this.curves.push(e)}closePath(){let e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);e.equals(t)||this.curves.push(new po(t,e))}getPoint(e,t){let n=e*this.getLength(),i=this.getCurveLengths(),r=0;for(;r<i.length;){if(i[r]>=n){let e=i[r]-n,s=this.curves[r],a=s.getLength(),o=0===a?0:1-e/a;return s.getPointAt(o,t)}r++}return null}getLength(){let e=this.getCurveLengths();return e[e.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;let e=[],t=0;for(let n=0,i=this.curves.length;n<i;n++)t+=this.curves[n].getLength(),e.push(t);return this.cacheLengths=e,e}getSpacedPoints(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:40,t=[];for(let n=0;n<=e;n++)t.push(this.getPoint(n/e));return this.autoClose&&t.push(t[0]),t}getPoints(){let e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:12,n=[];for(let i=0,r=this.curves;i<r.length;i++){let s=r[i],a=s.isEllipseCurve?2*t:s.isLineCurve||s.isLineCurve3?1:s.isSplineCurve?t*s.points.length:t,o=s.getPoints(a);for(let t=0;t<o.length;t++){let i=o[t];e&&e.equals(i)||(n.push(i),e=i)}}return this.autoClose&&n.length>1&&!n[n.length-1].equals(n[0])&&n.push(n[0]),n}copy(e){super.copy(e),this.curves=[];for(let t=0,n=e.curves.length;t<n;t++){let n=e.curves[t];this.curves.push(n.clone())}return this.autoClose=e.autoClose,this}toJSON(){let e=super.toJSON();e.autoClose=this.autoClose,e.curves=[];for(let t=0,n=this.curves.length;t<n;t++){let n=this.curves[t];e.curves.push(n.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.autoClose=e.autoClose,this.curves=[];for(let t=0,n=e.curves.length;t<n;t++){let n=e.curves[t];this.curves.push((new vo[n.type]).fromJSON(n))}return this}},bo=class extends yo{constructor(e){super(),this.type="Path",this.currentPoint=new ot,e&&this.setFromPoints(e)}setFromPoints(e){this.moveTo(e[0].x,e[0].y);for(let t=1,n=e.length;t<n;t++)this.lineTo(e[t].x,e[t].y);return this}moveTo(e,t){return this.currentPoint.set(e,t),this}lineTo(e,t){let n=new po(this.currentPoint.clone(),new ot(e,t));return this.curves.push(n),this.currentPoint.set(e,t),this}quadraticCurveTo(e,t,n,i){let r=new mo(this.currentPoint.clone(),new ot(e,t),new ot(n,i));return this.curves.push(r),this.currentPoint.set(n,i),this}bezierCurveTo(e,t,n,i,r,s){let a=new ho(this.currentPoint.clone(),new ot(e,t),new ot(n,i),new ot(r,s));return this.curves.push(a),this.currentPoint.set(r,s),this}splineThru(e){let t=[this.currentPoint.clone()].concat(e),n=new go(t);return this.curves.push(n),this.currentPoint.copy(e[e.length-1]),this}arc(e,t,n,i,r,s){let a=this.currentPoint.x,o=this.currentPoint.y;return this.absarc(e+a,t+o,n,i,r,s),this}absarc(e,t,n,i,r,s){return this.absellipse(e,t,n,n,i,r,s),this}ellipse(e,t,n,i,r,s,a,o){let l=this.currentPoint.x,c=this.currentPoint.y;return this.absellipse(e+l,t+c,n,i,r,s,a,o),this}absellipse(e,t,n,i,r,s,a,o){let l=new to(e,t,n,i,r,s,a,o);if(this.curves.length>0){let e=l.getPoint(0);e.equals(this.currentPoint)||this.lineTo(e.x,e.y)}this.curves.push(l);let c=l.getPoint(1);return this.currentPoint.copy(c),this}copy(e){return super.copy(e),this.currentPoint.copy(e.currentPoint),this}toJSON(){let e=super.toJSON();return e.currentPoint=this.currentPoint.toArray(),e}fromJSON(e){return super.fromJSON(e),this.currentPoint.fromArray(e.currentPoint),this}},xo=class extends di{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[new ot(0,-.5),new ot(.5,0),new ot(0,.5)],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:12,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2*Math.PI;super(),this.type="LatheGeometry",this.parameters={points:e,segments:t,phiStart:n,phiLength:i},t=Math.floor(t),i=Je(i,0,2*Math.PI);let r=[],s=[],a=[],o=[],l=[],c=1/t,h=new Bt,u=new ot,d=new Bt,p=new Bt,f=new Bt,m=0,g=0;for(let v=0;v<=e.length-1;v++)switch(v){case 0:m=e[v+1].x-e[v].x,g=e[v+1].y-e[v].y,d.x=1*g,d.y=-m,d.z=0*g,f.copy(d),d.normalize(),o.push(d.x,d.y,d.z);break;case e.length-1:o.push(f.x,f.y,f.z);break;default:m=e[v+1].x-e[v].x,g=e[v+1].y-e[v].y,d.x=1*g,d.y=-m,d.z=0*g,p.copy(d),d.x+=f.x,d.y+=f.y,d.z+=f.z,d.normalize(),o.push(d.x,d.y,d.z),f.copy(p)}for(let v=0;v<=t;v++){let r=n+v*c*i,d=Math.sin(r),p=Math.cos(r);for(let n=0;n<=e.length-1;n++){h.x=e[n].x*d,h.y=e[n].y,h.z=e[n].x*p,s.push(h.x,h.y,h.z),u.x=v/t,u.y=n/(e.length-1),a.push(u.x,u.y);let i=o[3*n+0]*d,r=o[3*n+1],c=o[3*n+0]*p;l.push(i,r,c)}}for(let v=0;v<t;v++)for(let t=0;t<e.length-1;t++){let n=t+v*e.length,i=n,s=n+e.length,a=n+e.length+1,o=n+1;r.push(i,s,o),r.push(a,o,s)}this.setIndex(r),this.setAttribute("position",new ri(s,3)),this.setAttribute("uv",new ri(a,2)),this.setAttribute("normal",new ri(l,3))}static fromJSON(e){return new xo(e.points,e.segments,e.phiStart,e.phiLength)}},wo=class extends di{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:32,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,s=arguments.length>5&&void 0!==arguments[5]&&arguments[5],a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,o=arguments.length>7&&void 0!==arguments[7]?arguments[7]:2*Math.PI;super(),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:n,radialSegments:i,heightSegments:r,openEnded:s,thetaStart:a,thetaLength:o};let l=this;i=Math.floor(i),r=Math.floor(r);let c=[],h=[],u=[],d=[],p=0,f=[],m=n/2,g=0;function v(n){let r=p,s=new ot,f=new Bt,v=0,y=!0===n?e:t,b=!0===n?1:-1;for(let e=1;e<=i;e++)h.push(0,m*b,0),u.push(0,b,0),d.push(.5,.5),p++;let x=p;for(let e=0;e<=i;e++){let t=e/i*o+a,n=Math.cos(t),r=Math.sin(t);f.x=y*r,f.y=m*b,f.z=y*n,h.push(f.x,f.y,f.z),u.push(0,b,0),s.x=.5*n+.5,s.y=.5*r*b+.5,d.push(s.x,s.y),p++}for(let e=0;e<i;e++){let t=r+e,i=x+e;!0===n?c.push(i,i+1,t):c.push(i+1,i,t),v+=3}l.addGroup(g,v,!0===n?1:2),g+=v}(function(){let s=new Bt,v=new Bt,y=0,b=(t-e)/n;for(let l=0;l<=r;l++){let c=[],g=l/r,y=g*(t-e)+e;for(let e=0;e<=i;e++){let t=e/i,r=t*o+a,l=Math.sin(r),f=Math.cos(r);v.x=y*l,v.y=-g*n+m,v.z=y*f,h.push(v.x,v.y,v.z),s.set(l,b,f).normalize(),u.push(s.x,s.y,s.z),d.push(t,1-g),c.push(p++)}f.push(c)}for(let e=0;e<i;e++)for(let t=0;t<r;t++){let n=f[t][e],i=f[t+1][e],r=f[t+1][e+1],s=f[t][e+1];c.push(n,i,s),c.push(i,r,s),y+=6}l.addGroup(g,y,0),g+=y})(),!1===s&&(e>0&&v(!0),t>0&&v(!1)),this.setIndex(c),this.setAttribute("position",new ri(h,3)),this.setAttribute("normal",new ri(u,3)),this.setAttribute("uv",new ri(d,2))}static fromJSON(e){return new wo(e.radiusTop,e.radiusBottom,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}},So=class extends wo{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:32,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,r=arguments.length>4&&void 0!==arguments[4]&&arguments[4],s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:2*Math.PI;super(0,e,t,n,i,r,s,a),this.type="ConeGeometry",this.parameters={radius:e,height:t,radialSegments:n,heightSegments:i,openEnded:r,thetaStart:s,thetaLength:a}}static fromJSON(e){return new So(e.radius,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}},_o=class extends di{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;super(),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:t,radius:n,detail:i};let r=[],s=[];function a(e,t,n,i){let r=i+1,s=[];for(let a=0;a<=r;a++){s[a]=[];let i=e.clone().lerp(n,a/r),o=t.clone().lerp(n,a/r),l=r-a;for(let e=0;e<=l;e++)s[a][e]=0===e&&a===r?i:i.clone().lerp(o,e/l)}for(let a=0;a<r;a++)for(let e=0;e<2*(r-a)-1;e++){let t=Math.floor(e/2);e%2===0?(o(s[a][t+1]),o(s[a+1][t]),o(s[a][t])):(o(s[a][t+1]),o(s[a+1][t+1]),o(s[a+1][t]))}}function o(e){r.push(e.x,e.y,e.z)}function l(t,n){let i=3*t;n.x=e[i+0],n.y=e[i+1],n.z=e[i+2]}function c(e,t,n,i){i<0&&1===e.x&&(s[t]=e.x-1),0===n.x&&0===n.z&&(s[t]=i/2/Math.PI+.5)}function h(e){return Math.atan2(e.z,-e.x)}function u(e){return Math.atan2(-e.y,Math.sqrt(e.x*e.x+e.z*e.z))}(function(e){let n=new Bt,i=new Bt,r=new Bt;for(let s=0;s<t.length;s+=3)l(t[s+0],n),l(t[s+1],i),l(t[s+2],r),a(n,i,r,e)})(i),function(e){let t=new Bt;for(let n=0;n<r.length;n+=3)t.x=r[n+0],t.y=r[n+1],t.z=r[n+2],t.normalize().multiplyScalar(e),r[n+0]=t.x,r[n+1]=t.y,r[n+2]=t.z}(n),function(){let e=new Bt;for(let t=0;t<r.length;t+=3){e.x=r[t+0],e.y=r[t+1],e.z=r[t+2];let n=h(e)/2/Math.PI+.5,i=u(e)/Math.PI+.5;s.push(n,1-i)}(function(){let e=new Bt,t=new Bt,n=new Bt,i=new Bt,a=new ot,o=new ot,l=new ot;for(let u=0,d=0;u<r.length;u+=9,d+=6){e.set(r[u+0],r[u+1],r[u+2]),t.set(r[u+3],r[u+4],r[u+5]),n.set(r[u+6],r[u+7],r[u+8]),a.set(s[d+0],s[d+1]),o.set(s[d+2],s[d+3]),l.set(s[d+4],s[d+5]),i.copy(e).add(t).add(n).divideScalar(3);let p=h(i);c(a,d+0,e,p),c(o,d+2,t,p),c(l,d+4,n,p)}})(),function(){for(let e=0;e<s.length;e+=6){let t=s[e+0],n=s[e+2],i=s[e+4],r=Math.max(t,n,i),a=Math.min(t,n,i);r>.9&&a<.1&&(t<.2&&(s[e+0]+=1),n<.2&&(s[e+2]+=1),i<.2&&(s[e+4]+=1))}}()}(),this.setAttribute("position",new ri(r,3)),this.setAttribute("normal",new ri(r.slice(),3)),this.setAttribute("uv",new ri(s,2)),0===i?this.computeVertexNormals():this.normalizeNormals()}static fromJSON(e){return new _o(e.vertices,e.indices,e.radius,e.details)}},Eo=class extends _o{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=(1+Math.sqrt(5))/2,i=1/n;super([-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-i,-n,0,-i,n,0,i,-n,0,i,n,-i,-n,0,-i,n,0,i,-n,0,i,n,0,-n,0,-i,n,0,-i,-n,0,i,n,0,i],[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],e,t),this.type="DodecahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new Eo(e.radius,e.detail)}},Ao=class extends bo{constructor(e){super(e),this.uuid=Ze(),this.type="Shape",this.holes=[]}getPointsHoles(e){let t=[];for(let n=0,i=this.holes.length;n<i;n++)t[n]=this.holes[n].getPoints(e);return t}extractPoints(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}}copy(e){super.copy(e),this.holes=[];for(let t=0,n=e.holes.length;t<n;t++){let n=e.holes[t];this.holes.push(n.clone())}return this}toJSON(){let e=super.toJSON();e.uuid=this.uuid,e.holes=[];for(let t=0,n=this.holes.length;t<n;t++){let n=this.holes[t];e.holes.push(n.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.uuid=e.uuid,this.holes=[];for(let t=0,n=e.holes.length;t<n;t++){let n=e.holes[t];this.holes.push((new bo).fromJSON(n))}return this}},Co=function(e,t){let n,i,r,s,a,o,l,c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2,h=t&&t.length,u=h?t[0]*c:e.length,d=Mo(e,0,u,c,!0),p=[];if(!d||d.next===d.prev)return p;if(h&&(d=function(e,t,n,i){let r,s,a,o,l,c=[];for(r=0,s=t.length;r<s;r++)a=t[r]*i,o=r<s-1?t[r+1]*i:e.length,l=Mo(e,a,o,i,!1),l===l.next&&(l.steiner=!0),c.push(No(l));for(c.sort(ko),r=0;r<c.length;r++)n=Lo(c[r],n);return n}(e,t,d,c)),e.length>80*c){n=r=e[0],i=s=e[1];for(let t=c;t<u;t+=c)a=e[t],o=e[t+1],a<n&&(n=a),o<i&&(i=o),a>r&&(r=a),o>s&&(s=o);l=Math.max(r-n,s-i),l=0!==l?32767/l:0}return Po(d,p,c,n,i,l,0),p};function Mo(e,t,n,i,r){let s,a;if(r===function(e,t,n,i){let r=0;for(let s=t,a=n-i;s<n;s+=i)r+=(e[a]-e[s])*(e[s+1]+e[a+1]),a=s;return r}(e,t,n,i)>0)for(s=t;s<n;s+=i)a=Yo(s,e[s],e[s+1],a);else for(s=n-i;s>=t;s-=i)a=Yo(s,e[s],e[s+1],a);return a&&Vo(a,a.next)&&(Qo(a),a=a.next),a}function To(e,t){if(!e)return e;t||(t=e);let n,i=e;do{if(n=!1,i.steiner||!Vo(i,i.next)&&0!==jo(i.prev,i,i.next))i=i.next;else{if(Qo(i),i=t=i.prev,i===i.next)break;n=!0}}while(n||i!==t);return t}function Po(e,t,n,i,r,s,a){if(!e)return;!a&&s&&function(e,t,n,i){let r=e;do{0===r.z&&(r.z=zo(r.x,r.y,t,n,i)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next}while(r!==e);r.prevZ.nextZ=null,r.prevZ=null,function(e){let t,n,i,r,s,a,o,l,c=1;do{for(n=e,e=null,s=null,a=0;n;){for(a++,i=n,o=0,t=0;t<c&&(o++,i=i.nextZ,i);t++);for(l=c;o>0||l>0&&i;)0!==o&&(0===l||!i||n.z<=i.z)?(r=n,n=n.nextZ,o--):(r=i,i=i.nextZ,l--),s?s.nextZ=r:e=r,r.prevZ=s,s=r;n=i}s.nextZ=null,c*=2}while(a>1)}(r)}(e,i,r,s);let o,l,c=e;for(;e.prev!==e.next;)if(o=e.prev,l=e.next,s?Oo(e,i,r,s):Do(e))t.push(o.i/n|0),t.push(e.i/n|0),t.push(l.i/n|0),Qo(e),e=l.next,c=l.next;else if((e=l)===c){a?1===a?Po(e=Io(To(e),t,n),t,n,i,r,s,2):2===a&&Ro(e,t,n,i,r,s):Po(To(e),t,n,i,r,s,1);break}}function Do(e){let t=e.prev,n=e,i=e.next;if(jo(t,n,i)>=0)return!1;let r=t.x,s=n.x,a=i.x,o=t.y,l=n.y,c=i.y,h=r<s?r<a?r:a:s<a?s:a,u=o<l?o<c?o:c:l<c?l:c,d=r>s?r>a?r:a:s>a?s:a,p=o>l?o>c?o:c:l>c?l:c,f=i.next;for(;f!==t;){if(f.x>=h&&f.x<=d&&f.y>=u&&f.y<=p&&Fo(r,o,s,l,a,c,f.x,f.y)&&jo(f.prev,f,f.next)>=0)return!1;f=f.next}return!0}function Oo(e,t,n,i){let r=e.prev,s=e,a=e.next;if(jo(r,s,a)>=0)return!1;let o=r.x,l=s.x,c=a.x,h=r.y,u=s.y,d=a.y,p=o<l?o<c?o:c:l<c?l:c,f=h<u?h<d?h:d:u<d?u:d,m=o>l?o>c?o:c:l>c?l:c,g=h>u?h>d?h:d:u>d?u:d,v=zo(p,f,t,n,i),y=zo(m,g,t,n,i),b=e.prevZ,x=e.nextZ;for(;b&&b.z>=v&&x&&x.z<=y;){if(b.x>=p&&b.x<=m&&b.y>=f&&b.y<=g&&b!==r&&b!==a&&Fo(o,h,l,u,c,d,b.x,b.y)&&jo(b.prev,b,b.next)>=0||(b=b.prevZ,x.x>=p&&x.x<=m&&x.y>=f&&x.y<=g&&x!==r&&x!==a&&Fo(o,h,l,u,c,d,x.x,x.y)&&jo(x.prev,x,x.next)>=0))return!1;x=x.nextZ}for(;b&&b.z>=v;){if(b.x>=p&&b.x<=m&&b.y>=f&&b.y<=g&&b!==r&&b!==a&&Fo(o,h,l,u,c,d,b.x,b.y)&&jo(b.prev,b,b.next)>=0)return!1;b=b.prevZ}for(;x&&x.z<=y;){if(x.x>=p&&x.x<=m&&x.y>=f&&x.y<=g&&x!==r&&x!==a&&Fo(o,h,l,u,c,d,x.x,x.y)&&jo(x.prev,x,x.next)>=0)return!1;x=x.nextZ}return!0}function Io(e,t,n){let i=e;do{let r=i.prev,s=i.next.next;!Vo(r,s)&&Go(r,i,i.next,s)&&qo(r,s)&&qo(s,r)&&(t.push(r.i/n|0),t.push(i.i/n|0),t.push(s.i/n|0),Qo(i),Qo(i.next),i=e=s),i=i.next}while(i!==e);return To(i)}function Ro(e,t,n,i,r,s){let a=e;do{let e=a.next.next;for(;e!==a.prev;){if(a.i!==e.i&&Uo(a,e)){let o=Xo(a,e);return a=To(a,a.next),o=To(o,o.next),Po(a,t,n,i,r,s,0),void Po(o,t,n,i,r,s,0)}e=e.next}a=a.next}while(a!==e)}function ko(e,t){return e.x-t.x}function Lo(e,t){let n=function(e,t){let n,i=t,r=-1/0,s=e.x,a=e.y;do{if(a<=i.y&&a>=i.next.y&&i.next.y!==i.y){let e=i.x+(a-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(e<=s&&e>r&&(r=e,n=i.x<i.next.x?i:i.next,e===s))return n}i=i.next}while(i!==t);if(!n)return null;let o,l=n,c=n.x,h=n.y,u=1/0;i=n;do{s>=i.x&&i.x>=c&&s!==i.x&&Fo(a<h?s:r,a,c,h,a<h?r:s,a,i.x,i.y)&&(o=Math.abs(a-i.y)/(s-i.x),qo(i,e)&&(o<u||o===u&&(i.x>n.x||i.x===n.x&&Bo(n,i)))&&(n=i,u=o)),i=i.next}while(i!==l);return n}(e,t);if(!n)return t;let i=Xo(n,e);return To(i,i.next),To(n,n.next)}function Bo(e,t){return jo(e.prev,e,t.prev)<0&&jo(t.next,e,e.next)<0}function zo(e,t,n,i,r){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-n)*r|0)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-i)*r|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function No(e){let t=e,n=e;do{(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next}while(t!==e);return n}function Fo(e,t,n,i,r,s,a,o){return(r-a)*(t-o)>=(e-a)*(s-o)&&(e-a)*(i-o)>=(n-a)*(t-o)&&(n-a)*(s-o)>=(r-a)*(i-o)}function Uo(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){let n=e;do{if(n.i!==e.i&&n.next.i!==e.i&&n.i!==t.i&&n.next.i!==t.i&&Go(n,n.next,e,t))return!0;n=n.next}while(n!==e);return!1}(e,t)&&(qo(e,t)&&qo(t,e)&&function(e,t){let n=e,i=!1,r=(e.x+t.x)/2,s=(e.y+t.y)/2;do{n.y>s!=n.next.y>s&&n.next.y!==n.y&&r<(n.next.x-n.x)*(s-n.y)/(n.next.y-n.y)+n.x&&(i=!i),n=n.next}while(n!==e);return i}(e,t)&&(jo(e.prev,e,t.prev)||jo(e,t.prev,t))||Vo(e,t)&&jo(e.prev,e,e.next)>0&&jo(t.prev,t,t.next)>0)}function jo(e,t,n){return(t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y)}function Vo(e,t){return e.x===t.x&&e.y===t.y}function Go(e,t,n,i){let r=Wo(jo(e,t,n)),s=Wo(jo(e,t,i)),a=Wo(jo(n,i,e)),o=Wo(jo(n,i,t));return!!(r!==s&&a!==o||0===r&&Ho(e,n,t)||0===s&&Ho(e,i,t)||0===a&&Ho(n,e,i)||0===o&&Ho(n,t,i))}function Ho(e,t,n){return t.x<=Math.max(e.x,n.x)&&t.x>=Math.min(e.x,n.x)&&t.y<=Math.max(e.y,n.y)&&t.y>=Math.min(e.y,n.y)}function Wo(e){return e>0?1:e<0?-1:0}function qo(e,t){return jo(e.prev,e,e.next)<0?jo(e,t,e.next)>=0&&jo(e,e.prev,t)>=0:jo(e,t,e.prev)<0||jo(e,e.next,t)<0}function Xo(e,t){let n=new Ko(e.i,e.x,e.y),i=new Ko(t.i,t.x,t.y),r=e.next,s=t.prev;return e.next=t,t.prev=e,n.next=r,r.prev=n,i.next=n,n.prev=i,s.next=i,i.prev=s,i}function Yo(e,t,n,i){let r=new Ko(e,t,n);return i?(r.next=i.next,r.prev=i,i.next.prev=r,i.next=r):(r.prev=r,r.next=r),r}function Qo(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function Ko(e,t,n){this.i=e,this.x=t,this.y=n,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}var Zo=class{static area(e){let t=e.length,n=0;for(let i=t-1,r=0;r<t;i=r++)n+=e[i].x*e[r].y-e[r].x*e[i].y;return.5*n}static isClockWise(e){return Zo.area(e)<0}static triangulateShape(e,t){let n=[],i=[],r=[];Jo(e),$o(n,e);let s=e.length;t.forEach(Jo);for(let o=0;o<t.length;o++)i.push(s),s+=t[o].length,$o(n,t[o]);let a=Co(n,i);for(let o=0;o<a.length;o+=3)r.push(a.slice(o,o+3));return r}};function Jo(e){let t=e.length;t>2&&e[t-1].equals(e[0])&&e.pop()}function $o(e,t){for(let n=0;n<t.length;n++)e.push(t[n].x),e.push(t[n].y)}var el=class extends _o{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=(1+Math.sqrt(5))/2;super([-1,n,0,1,n,0,-1,-n,0,1,-n,0,0,-1,n,0,1,n,0,-1,-n,0,1,-n,n,0,-1,n,0,1,-n,0,-1,-n,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],e,t),this.type="IcosahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new el(e.radius,e.detail)}},tl=class extends di{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:16,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:2*Math.PI,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:Math.PI;super(),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:n,phiStart:i,phiLength:r,thetaStart:s,thetaLength:a},t=Math.max(3,Math.floor(t)),n=Math.max(2,Math.floor(n));let o=Math.min(s+a,Math.PI),l=0,c=[],h=new Bt,u=new Bt,d=[],p=[],f=[],m=[];for(let g=0;g<=n;g++){let d=[],v=g/n,y=0;0==g&&0==s?y=.5/t:g==n&&o==Math.PI&&(y=-.5/t);for(let n=0;n<=t;n++){let o=n/t;h.x=-e*Math.cos(i+o*r)*Math.sin(s+v*a),h.y=e*Math.cos(s+v*a),h.z=e*Math.sin(i+o*r)*Math.sin(s+v*a),p.push(h.x,h.y,h.z),u.copy(h).normalize(),f.push(u.x,u.y,u.z),m.push(o+y,1-v),d.push(l++)}c.push(d)}for(let g=0;g<n;g++)for(let e=0;e<t;e++){let t=c[g][e+1],i=c[g][e],r=c[g+1][e],a=c[g+1][e+1];(0!==g||s>0)&&d.push(t,i,a),(g!==n-1||o<Math.PI)&&d.push(i,r,a)}this.setIndex(d),this.setAttribute("position",new ri(p,3)),this.setAttribute("normal",new ri(f,3)),this.setAttribute("uv",new ri(m,2))}static fromJSON(e){return new tl(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength)}},nl=class extends di{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.4,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:12,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:48,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:2*Math.PI;super(),this.type="TorusGeometry",this.parameters={radius:e,tube:t,radialSegments:n,tubularSegments:i,arc:r},n=Math.floor(n),i=Math.floor(i);let s=[],a=[],o=[],l=[],c=new Bt,h=new Bt,u=new Bt;for(let d=0;d<=n;d++)for(let s=0;s<=i;s++){let p=s/i*r,f=d/n*Math.PI*2;h.x=(e+t*Math.cos(f))*Math.cos(p),h.y=(e+t*Math.cos(f))*Math.sin(p),h.z=t*Math.sin(f),a.push(h.x,h.y,h.z),c.x=e*Math.cos(p),c.y=e*Math.sin(p),u.subVectors(h,c).normalize(),o.push(u.x,u.y,u.z),l.push(s/i),l.push(d/n)}for(let d=1;d<=n;d++)for(let e=1;e<=i;e++){let t=(i+1)*d+e-1,n=(i+1)*(d-1)+e-1,r=(i+1)*(d-1)+e,a=(i+1)*d+e;s.push(t,n,a),s.push(n,r,a)}this.setIndex(s),this.setAttribute("position",new ri(a,3)),this.setAttribute("normal",new ri(o,3)),this.setAttribute("uv",new ri(l,2))}static fromJSON(e){return new nl(e.radius,e.tube,e.radialSegments,e.tubularSegments,e.arc)}},il=class extends di{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.4,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:64,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:8,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:2,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:3;super(),this.type="TorusKnotGeometry",this.parameters={radius:e,tube:t,tubularSegments:n,radialSegments:i,p:r,q:s},n=Math.floor(n),i=Math.floor(i);let a=[],o=[],l=[],c=[],h=new Bt,u=new Bt,d=new Bt,p=new Bt,f=new Bt,m=new Bt,g=new Bt;for(let y=0;y<=n;++y){let a=y/n*r*Math.PI*2;v(a,r,s,e,d),v(a+.01,r,s,e,p),m.subVectors(p,d),g.addVectors(p,d),f.crossVectors(m,g),g.crossVectors(f,m),f.normalize(),g.normalize();for(let e=0;e<=i;++e){let r=e/i*Math.PI*2,s=-t*Math.cos(r),a=t*Math.sin(r);h.x=d.x+(s*g.x+a*f.x),h.y=d.y+(s*g.y+a*f.y),h.z=d.z+(s*g.z+a*f.z),o.push(h.x,h.y,h.z),u.subVectors(h,d).normalize(),l.push(u.x,u.y,u.z),c.push(y/n),c.push(e/i)}}for(let y=1;y<=n;y++)for(let e=1;e<=i;e++){let t=(i+1)*(y-1)+(e-1),n=(i+1)*y+(e-1),r=(i+1)*y+e,s=(i+1)*(y-1)+e;a.push(t,n,s),a.push(n,r,s)}function v(e,t,n,i,r){let s=Math.cos(e),a=Math.sin(e),o=n/t*e,l=Math.cos(o);r.x=i*(2+l)*.5*s,r.y=i*(2+l)*a*.5,r.z=i*Math.sin(o)*.5}this.setIndex(a),this.setAttribute("position",new ri(o,3)),this.setAttribute("normal",new ri(l,3)),this.setAttribute("uv",new ri(c,2))}static fromJSON(e){return new il(e.radius,e.tube,e.tubularSegments,e.radialSegments,e.p,e.q)}},rl=class extends Ri{constructor(e){super(e),this.isRawShaderMaterial=!0,this.type="RawShaderMaterial"}};function sl(e,t,n){return ol(e)?new e.constructor(e.subarray(t,void 0!==n?n:e.length)):e.slice(t,n)}function al(e,t,n){return!e||!n&&e.constructor===t?e:"number"==typeof t.BYTES_PER_ELEMENT?new t(e):Array.prototype.slice.call(e)}function ol(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}function ll(e){let t=e.length,n=new Array(t);for(let i=0;i!==t;++i)n[i]=i;return n.sort((function(t,n){return e[t]-e[n]})),n}function cl(e,t,n){let i=e.length,r=new e.constructor(i);for(let s=0,a=0;a!==i;++s){let i=n[s]*t;for(let n=0;n!==t;++n)r[a++]=e[i+n]}return r}function hl(e,t,n,i){let r=1,s=e[0];for(;void 0!==s&&void 0===s[i];)s=e[r++];if(void 0===s)return;let a=s[i];if(void 0!==a)if(Array.isArray(a))do{a=s[i],void 0!==a&&(t.push(s.time),n.push.apply(n,a)),s=e[r++]}while(void 0!==s);else if(void 0!==a.toArray)do{a=s[i],void 0!==a&&(t.push(s.time),a.toArray(n,n.length)),s=e[r++]}while(void 0!==s);else do{a=s[i],void 0!==a&&(t.push(s.time),n.push(a)),s=e[r++]}while(void 0!==s)}var ul=class{constructor(e,t,n,i){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=void 0!==i?i:new t.constructor(n),this.sampleValues=t,this.valueSize=n,this.settings=null,this.DefaultSettings_={}}evaluate(e){let t=this.parameterPositions,n=this._cachedIndex,i=t[n],r=t[n-1];e:{t:{let s;n:{i:if(!(e<i)){for(let s=n+2;;){if(void 0===i){if(e<r)break i;return n=t.length,this._cachedIndex=n,this.copySampleValue_(n-1)}if(n===s)break;if(r=i,i=t[++n],e<i)break t}s=t.length;break n}if(e>=r)break e;{let a=t[1];e<a&&(n=2,r=a);for(let s=n-2;;){if(void 0===r)return this._cachedIndex=0,this.copySampleValue_(0);if(n===s)break;if(i=r,r=t[--n-1],e>=r)break t}s=n,n=0}}for(;n<s;){let i=n+s>>>1;e<t[i]?s=i:n=i+1}if(i=t[n],r=t[n-1],void 0===r)return this._cachedIndex=0,this.copySampleValue_(0);if(void 0===i)return n=t.length,this._cachedIndex=n,this.copySampleValue_(n-1)}this._cachedIndex=n,this.intervalChanged_(n,r,i)}return this.interpolate_(n,r,e,i)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(e){let t=this.resultBuffer,n=this.sampleValues,i=this.valueSize,r=e*i;for(let s=0;s!==i;++s)t[s]=n[r+s];return t}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}},dl=class extends ul{constructor(e,t,n,i){super(e,t,n,i),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:Re,endingEnd:Re}}intervalChanged_(e,t,n){let i=this.parameterPositions,r=e-2,s=e+1,a=i[r],o=i[s];if(void 0===a)switch(this.getSettings_().endingStart){case ke:r=e,a=2*t-n;break;case Le:r=i.length-2,a=t+i[r]-i[r+1];break;default:r=e,a=n}if(void 0===o)switch(this.getSettings_().endingEnd){case ke:s=e,o=2*n-t;break;case Le:s=1,o=n+i[1]-i[0];break;default:s=e-1,o=t}let l=.5*(n-t),c=this.valueSize;this._weightPrev=l/(t-a),this._weightNext=l/(o-n),this._offsetPrev=r*c,this._offsetNext=s*c}interpolate_(e,t,n,i){let r=this.resultBuffer,s=this.sampleValues,a=this.valueSize,o=e*a,l=o-a,c=this._offsetPrev,h=this._offsetNext,u=this._weightPrev,d=this._weightNext,p=(n-t)/(i-t),f=p*p,m=f*p,g=-u*m+2*u*f-u*p,v=(1+u)*m+(-1.5-2*u)*f+(-.5+u)*p+1,y=(-1-d)*m+(1.5+d)*f+.5*p,b=d*m-d*f;for(let x=0;x!==a;++x)r[x]=g*s[c+x]+v*s[l+x]+y*s[o+x]+b*s[h+x];return r}},pl=class extends ul{constructor(e,t,n,i){super(e,t,n,i)}interpolate_(e,t,n,i){let r=this.resultBuffer,s=this.sampleValues,a=this.valueSize,o=e*a,l=o-a,c=(n-t)/(i-t),h=1-c;for(let u=0;u!==a;++u)r[u]=s[l+u]*h+s[o+u]*c;return r}},fl=class extends ul{constructor(e,t,n,i){super(e,t,n,i)}interpolate_(e){return this.copySampleValue_(e-1)}},ml=class{constructor(e,t,n,i){if(void 0===e)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===t||0===t.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=al(t,this.TimeBufferType),this.values=al(n,this.ValueBufferType),this.setInterpolation(i||this.DefaultInterpolation)}static toJSON(e){let t,n=e.constructor;if(n.toJSON!==this.toJSON)t=n.toJSON(e);else{t={name:e.name,times:al(e.times,Array),values:al(e.values,Array)};let n=e.getInterpolation();n!==e.DefaultInterpolation&&(t.interpolation=n)}return t.type=e.ValueTypeName,t}InterpolantFactoryMethodDiscrete(e){return new fl(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodLinear(e){return new pl(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodSmooth(e){return new dl(this.times,this.values,this.getValueSize(),e)}setInterpolation(e){let t;switch(e){case De:t=this.InterpolantFactoryMethodDiscrete;break;case Oe:t=this.InterpolantFactoryMethodLinear;break;case Ie:t=this.InterpolantFactoryMethodSmooth}if(void 0===t){let t="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(e===this.DefaultInterpolation)throw new Error(t);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",t),this}return this.createInterpolant=t,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return De;case this.InterpolantFactoryMethodLinear:return Oe;case this.InterpolantFactoryMethodSmooth:return Ie}}getValueSize(){return this.values.length/this.times.length}shift(e){if(0!==e){let t=this.times;for(let n=0,i=t.length;n!==i;++n)t[n]+=e}return this}scale(e){if(1!==e){let t=this.times;for(let n=0,i=t.length;n!==i;++n)t[n]*=e}return this}trim(e,t){let n=this.times,i=n.length,r=0,s=i-1;for(;r!==i&&n[r]<e;)++r;for(;-1!==s&&n[s]>t;)--s;if(++s,0!==r||s!==i){r>=s&&(s=Math.max(s,1),r=s-1);let e=this.getValueSize();this.times=sl(n,r,s),this.values=sl(this.values,r*e,s*e)}return this}validate(){let e=!0,t=this.getValueSize();t-Math.floor(t)!==0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);let n=this.times,i=this.values,r=n.length;0===r&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);let s=null;for(let a=0;a!==r;a++){let t=n[a];if("number"==typeof t&&isNaN(t)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,a,t),e=!1;break}if(null!==s&&s>t){console.error("THREE.KeyframeTrack: Out of order keys.",this,a,t,s),e=!1;break}s=t}if(void 0!==i&&ol(i))for(let a=0,o=i.length;a!==o;++a){let t=i[a];if(isNaN(t)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,a,t),e=!1;break}}return e}optimize(){let e=sl(this.times),t=sl(this.values),n=this.getValueSize(),i=this.getInterpolation()===Ie,r=e.length-1,s=1;for(let a=1;a<r;++a){let r=!1,o=e[a];if(o!==e[a+1]&&(1!==a||o!==e[0]))if(i)r=!0;else{let e=a*n,i=e-n,s=e+n;for(let a=0;a!==n;++a){let n=t[e+a];if(n!==t[i+a]||n!==t[s+a]){r=!0;break}}}if(r){if(a!==s){e[s]=e[a];let i=a*n,r=s*n;for(let e=0;e!==n;++e)t[r+e]=t[i+e]}++s}}if(r>0){e[s]=e[r];for(let e=r*n,i=s*n,a=0;a!==n;++a)t[i+a]=t[e+a];++s}return s!==e.length?(this.times=sl(e,0,s),this.values=sl(t,0,s*n)):(this.times=e,this.values=t),this}clone(){let e=sl(this.times,0),t=sl(this.values,0),n=new(0,this.constructor)(this.name,e,t);return n.createInterpolant=this.createInterpolant,n}};ml.prototype.TimeBufferType=Float32Array,ml.prototype.ValueBufferType=Float32Array,ml.prototype.DefaultInterpolation=Oe;var gl=class extends ml{};gl.prototype.ValueTypeName="bool",gl.prototype.ValueBufferType=Array,gl.prototype.DefaultInterpolation=De,gl.prototype.InterpolantFactoryMethodLinear=void 0,gl.prototype.InterpolantFactoryMethodSmooth=void 0;var vl=class extends ml{};vl.prototype.ValueTypeName="color";var yl=class extends ml{};yl.prototype.ValueTypeName="number";var bl=class extends ul{constructor(e,t,n,i){super(e,t,n,i)}interpolate_(e,t,n,i){let r=this.resultBuffer,s=this.sampleValues,a=this.valueSize,o=(n-t)/(i-t),l=e*a;for(let c=l+a;l!==c;l+=4)Lt.slerpFlat(r,0,s,l-a,s,l,o);return r}},xl=class extends ml{InterpolantFactoryMethodLinear(e){return new bl(this.times,this.values,this.getValueSize(),e)}};xl.prototype.ValueTypeName="quaternion",xl.prototype.DefaultInterpolation=Oe,xl.prototype.InterpolantFactoryMethodSmooth=void 0;var wl=class extends ml{};wl.prototype.ValueTypeName="string",wl.prototype.ValueBufferType=Array,wl.prototype.DefaultInterpolation=De,wl.prototype.InterpolantFactoryMethodLinear=void 0,wl.prototype.InterpolantFactoryMethodSmooth=void 0;var Sl=class extends ml{};Sl.prototype.ValueTypeName="vector";var _l=class{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,n=arguments.length>2?arguments[2]:void 0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Be;this.name=e,this.tracks=n,this.duration=t,this.blendMode=i,this.uuid=Ze(),this.duration<0&&this.resetDuration()}static parse(e){let t=[],n=e.tracks,i=1/(e.fps||1);for(let s=0,a=n.length;s!==a;++s)t.push(El(n[s]).scale(i));let r=new this(e.name,e.duration,t,e.blendMode);return r.uuid=e.uuid,r}static toJSON(e){let t=[],n=e.tracks,i={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid,blendMode:e.blendMode};for(let r=0,s=n.length;r!==s;++r)t.push(ml.toJSON(n[r]));return i}static CreateFromMorphTargetSequence(e,t,n,i){let r=t.length,s=[];for(let a=0;a<r;a++){let e=[],o=[];e.push((a+r-1)%r,a,(a+1)%r),o.push(0,1,0);let l=ll(e);e=cl(e,1,l),o=cl(o,1,l),!i&&0===e[0]&&(e.push(r),o.push(o[0])),s.push(new yl(".morphTargetInfluences["+t[a].name+"]",e,o).scale(1/n))}return new this(e,-1,s)}static findByName(e,t){let n=e;if(!Array.isArray(e)){let t=e;n=t.geometry&&t.geometry.animations||t.animations}for(let i=0;i<n.length;i++)if(n[i].name===t)return n[i];return null}static CreateClipsFromMorphTargetSequences(e,t,n){let i={},r=/^([\w-]*?)([\d]+)$/;for(let a=0,o=e.length;a<o;a++){let t=e[a],n=t.name.match(r);if(n&&n.length>1){let e=n[1],r=i[e];r||(i[e]=r=[]),r.push(t)}}let s=[];for(let a in i)s.push(this.CreateFromMorphTargetSequence(a,i[a],t,n));return s}static parseAnimation(e,t){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;let n=function(e,t,n,i,r){if(0!==n.length){let s=[],a=[];hl(n,s,a,i),0!==s.length&&r.push(new e(t,s,a))}},i=[],r=e.name||"default",s=e.fps||30,a=e.blendMode,o=e.length||-1,l=e.hierarchy||[];for(let c=0;c<l.length;c++){let e=l[c].keys;if(e&&0!==e.length)if(e[0].morphTargets){let t,n={};for(t=0;t<e.length;t++)if(e[t].morphTargets)for(let i=0;i<e[t].morphTargets.length;i++)n[e[t].morphTargets[i]]=-1;for(let r in n){let n=[],s=[];for(let i=0;i!==e[t].morphTargets.length;++i){let i=e[t];n.push(i.time),s.push(i.morphTarget===r?1:0)}i.push(new yl(".morphTargetInfluence["+r+"]",n,s))}o=n.length*s}else{let r=".bones["+t[c].name+"]";n(Sl,r+".position",e,"pos",i),n(xl,r+".quaternion",e,"rot",i),n(Sl,r+".scale",e,"scl",i)}}return 0===i.length?null:new this(r,o,i,a)}resetDuration(){let e=0;for(let t=0,n=this.tracks.length;t!==n;++t){let n=this.tracks[t];e=Math.max(e,n.times[n.times.length-1])}return this.duration=e,this}trim(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this}validate(){let e=!0;for(let t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e}optimize(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}clone(){let e=[];for(let t=0;t<this.tracks.length;t++)e.push(this.tracks[t].clone());return new this.constructor(this.name,this.duration,e,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}};function El(e){if(void 0===e.type)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");let t=function(e){switch(e.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return yl;case"vector":case"vector2":case"vector3":case"vector4":return Sl;case"color":return vl;case"quaternion":return xl;case"bool":case"boolean":return gl;case"string":return wl}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+e)}(e.type);if(void 0===e.times){let t=[],n=[];hl(e.keys,t,n,"value"),e.times=t,e.values=n}return void 0!==t.parse?t.parse(e):new t(e.name,e.times,e.values,e.interpolation)}var Al={enabled:!1,files:{},add:function(e,t){!1!==this.enabled&&(this.files[e]=t)},get:function(e){if(!1!==this.enabled)return this.files[e]},remove:function(e){delete this.files[e]},clear:function(){this.files={}}},Cl=class{constructor(e,t,n){let i,r=this,s=!1,a=0,o=0,l=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=n,this.itemStart=function(e){o++,!1===s&&void 0!==r.onStart&&r.onStart(e,a,o),s=!0},this.itemEnd=function(e){a++,void 0!==r.onProgress&&r.onProgress(e,a,o),a===o&&(s=!1,void 0!==r.onLoad&&r.onLoad())},this.itemError=function(e){void 0!==r.onError&&r.onError(e)},this.resolveURL=function(e){return i?i(e):e},this.setURLModifier=function(e){return i=e,this},this.addHandler=function(e,t){return l.push(e,t),this},this.removeHandler=function(e){let t=l.indexOf(e);return-1!==t&&l.splice(t,2),this},this.getHandler=function(e){for(let t=0,n=l.length;t<n;t+=2){let n=l[t],i=l[t+1];if(n.global&&(n.lastIndex=0),n.test(e))return i}return null}}},Ml=new Cl,Tl=class{constructor(e){this.manager=void 0!==e?e:Ml,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,t){let n=this;return new Promise((function(i,r){n.load(e,i,t,r)}))}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}},Pl={},Dl=class extends Error{constructor(e,t){super(e),this.response=t}},Ol=class extends Tl{constructor(e){super(e)}load(e,t,n,i){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);let r=Al.get(e);if(void 0!==r)return this.manager.itemStart(e),setTimeout((()=>{t&&t(r),this.manager.itemEnd(e)}),0),r;if(void 0!==Pl[e])return void Pl[e].push({onLoad:t,onProgress:n,onError:i});Pl[e]=[],Pl[e].push({onLoad:t,onProgress:n,onError:i});let s=new Request(e,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),a=this.mimeType,o=this.responseType;fetch(s).then((t=>{if(200===t.status||0===t.status){if(0===t.status&&console.warn("THREE.FileLoader: HTTP Status 0 received."),typeof ReadableStream>"u"||void 0===t.body||void 0===t.body.getReader)return t;let n=Pl[e],i=t.body.getReader(),r=t.headers.get("Content-Length")||t.headers.get("X-File-Size"),s=r?parseInt(r):0,a=0!==s,o=0,l=new ReadableStream({start(e){!function t(){i.read().then((i=>{let{done:r,value:l}=i;if(r)e.close();else{o+=l.byteLength;let i=new ProgressEvent("progress",{lengthComputable:a,loaded:o,total:s});for(let e=0,t=n.length;e<t;e++){let t=n[e];t.onProgress&&t.onProgress(i)}e.enqueue(l),t()}}))}()}});return new Response(l)}throw new Dl('fetch for "'.concat(t.url,'" responded with ').concat(t.status,": ").concat(t.statusText),t)})).then((e=>{switch(o){case"arraybuffer":return e.arrayBuffer();case"blob":return e.blob();case"document":return e.text().then((e=>(new DOMParser).parseFromString(e,a)));case"json":return e.json();default:if(void 0===a)return e.text();{let t=/charset="?([^;"\s]*)"?/i.exec(a),n=t&&t[1]?t[1].toLowerCase():void 0,i=new TextDecoder(n);return e.arrayBuffer().then((e=>i.decode(e)))}}})).then((t=>{Al.add(e,t);let n=Pl[e];delete Pl[e];for(let e=0,i=n.length;e<i;e++){let i=n[e];i.onLoad&&i.onLoad(t)}})).catch((t=>{let n=Pl[e];if(void 0===n)throw this.manager.itemError(e),t;delete Pl[e];for(let e=0,i=n.length;e<i;e++){let i=n[e];i.onError&&i.onError(t)}this.manager.itemError(e)})).finally((()=>{this.manager.itemEnd(e)})),this.manager.itemStart(e)}setResponseType(e){return this.responseType=e,this}setMimeType(e){return this.mimeType=e,this}},Il=class extends Tl{constructor(e){super(e)}load(e,t,n,i){void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);let r=this,s=Al.get(e);if(void 0!==s)return r.manager.itemStart(e),setTimeout((function(){t&&t(s),r.manager.itemEnd(e)}),0),s;let a=pt("img");function o(){c(),Al.add(e,this),t&&t(this),r.manager.itemEnd(e)}function l(t){c(),i&&i(t),r.manager.itemError(e),r.manager.itemEnd(e)}function c(){a.removeEventListener("load",o,!1),a.removeEventListener("error",l,!1)}return a.addEventListener("load",o,!1),a.addEventListener("error",l,!1),"data:"!==e.slice(0,5)&&void 0!==this.crossOrigin&&(a.crossOrigin=this.crossOrigin),r.manager.itemStart(e),a.src=e,a}},Rl=class extends Tl{constructor(e){super(e)}load(e,t,n,i){let r=new Dt,s=new Il(this.manager);return s.setCrossOrigin(this.crossOrigin),s.setPath(this.path),s.load(e,(function(e){r.image=e,r.needsUpdate=!0,void 0!==t&&t(r)}),n,i),r}},kl=class extends Nn{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;super(),this.isLight=!0,this.type="Light",this.color=new Et(e),this.intensity=t}dispose(){}copy(e,t){return super.copy(e,t),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){let t=super.toJSON(e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,void 0!==this.groundColor&&(t.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(t.object.distance=this.distance),void 0!==this.angle&&(t.object.angle=this.angle),void 0!==this.decay&&(t.object.decay=this.decay),void 0!==this.penumbra&&(t.object.penumbra=this.penumbra),void 0!==this.shadow&&(t.object.shadow=this.shadow.toJSON()),t}},Ll=class extends kl{constructor(e,t,n){super(e,n),this.isHemisphereLight=!0,this.type="HemisphereLight",this.position.copy(Nn.DEFAULT_UP),this.updateMatrix(),this.groundColor=new Et(t)}copy(e,t){return super.copy(e,t),this.groundColor.copy(e.groundColor),this}},Bl=new pn,zl=new Bt,Nl=new Bt,Fl=class{constructor(e){this.camera=e,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new ot(512,512),this.map=null,this.mapPass=null,this.matrix=new pn,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new qi,this._frameExtents=new ot(1,1),this._viewportCount=1,this._viewports=[new Ot(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){let t=this.camera,n=this.matrix;zl.setFromMatrixPosition(e.matrixWorld),t.position.copy(zl),Nl.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(Nl),t.updateMatrixWorld(),Bl.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(Bl),n.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),n.multiply(Bl)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this}clone(){return(new this.constructor).copy(this)}toJSON(){let e={};return 0!==this.bias&&(e.bias=this.bias),0!==this.normalBias&&(e.normalBias=this.normalBias),1!==this.radius&&(e.radius=this.radius),(512!==this.mapSize.x||512!==this.mapSize.y)&&(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}},Ul=class extends Fl{constructor(){super(new Li(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1}updateMatrices(e){let t=this.camera,n=2*Ke*e.angle*this.focus,i=this.mapSize.width/this.mapSize.height,r=e.distance||t.far;(n!==t.fov||i!==t.aspect||r!==t.far)&&(t.fov=n,t.aspect=i,t.far=r,t.updateProjectionMatrix()),super.updateMatrices(e)}copy(e){return super.copy(e),this.focus=e.focus,this}},jl=class extends kl{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Math.PI/3,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:2;super(e,t),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(Nn.DEFAULT_UP),this.updateMatrix(),this.target=new Nn,this.distance=n,this.angle=i,this.penumbra=r,this.decay=s,this.map=null,this.shadow=new Ul}get power(){return this.intensity*Math.PI}set power(e){this.intensity=e/Math.PI}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}},Vl=new pn,Gl=new Bt,Hl=new Bt,Wl=class extends Fl{constructor(){super(new Li(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new ot(4,2),this._viewportCount=6,this._viewports=[new Ot(2,1,1,1),new Ot(0,1,1,1),new Ot(3,1,1,1),new Ot(1,1,1,1),new Ot(3,0,1,1),new Ot(1,0,1,1)],this._cubeDirections=[new Bt(1,0,0),new Bt(-1,0,0),new Bt(0,0,1),new Bt(0,0,-1),new Bt(0,1,0),new Bt(0,-1,0)],this._cubeUps=[new Bt(0,1,0),new Bt(0,1,0),new Bt(0,1,0),new Bt(0,1,0),new Bt(0,0,1),new Bt(0,0,-1)]}updateMatrices(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=this.camera,i=this.matrix,r=e.distance||n.far;r!==n.far&&(n.far=r,n.updateProjectionMatrix()),Gl.setFromMatrixPosition(e.matrixWorld),n.position.copy(Gl),Hl.copy(n.position),Hl.add(this._cubeDirections[t]),n.up.copy(this._cubeUps[t]),n.lookAt(Hl),n.updateMatrixWorld(),i.makeTranslation(-Gl.x,-Gl.y,-Gl.z),Vl.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),this._frustum.setFromProjectionMatrix(Vl)}},ql=class extends kl{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2;super(e,t),this.isPointLight=!0,this.type="PointLight",this.distance=n,this.decay=i,this.shadow=new Wl}get power(){return 4*this.intensity*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}},Xl=class extends Fl{constructor(){super(new ar(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}},Yl=class extends kl{constructor(e,t){super(e,t),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(Nn.DEFAULT_UP),this.updateMatrix(),this.target=new Nn,this.shadow=new Xl}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}},Ql=class extends di{constructor(){super(),this.isInstancedBufferGeometry=!0,this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(e){return super.copy(e),this.instanceCount=e.instanceCount,this}toJSON(){let e=super.toJSON();return e.instanceCount=this.instanceCount,e.isInstancedBufferGeometry=!0,e}},Kl=class extends Tl{constructor(e){super(e)}load(e,t,n,i){let r=this,s=new Ol(r.manager);s.setPath(r.path),s.setRequestHeader(r.requestHeader),s.setWithCredentials(r.withCredentials),s.load(e,(function(n){try{t(r.parse(JSON.parse(n)))}catch(WZ){i?i(WZ):console.error(WZ),r.manager.itemError(e)}}),n,i)}parse(e){let t={},n={};function i(e,i){if(void 0!==t[i])return t[i];let r=e.interleavedBuffers[i],s=function(e,t){if(void 0!==n[t])return n[t];let i=e.arrayBuffers[t],r=new Uint32Array(i).buffer;return n[t]=r,r}(e,r.buffer),a=dt(r.type,s),o=new Ma(a,r.stride);return o.uuid=r.uuid,t[i]=o,o}let r=e.isInstancedBufferGeometry?new Ql:new di,s=e.data.index;if(void 0!==s){let e=dt(s.type,s.array);r.setIndex(new ti(e,1))}let a=e.data.attributes;for(let h in a){let t,n=a[h];if(n.isInterleavedBufferAttribute){let r=i(e.data,n.data);t=new Pa(r,n.itemSize,n.offset,n.normalized)}else{let e=dt(n.type,n.array);t=new(n.isInstancedBufferAttribute?La:ti)(e,n.itemSize,n.normalized)}void 0!==n.name&&(t.name=n.name),void 0!==n.usage&&t.setUsage(n.usage),void 0!==n.updateRange&&(t.updateRange.offset=n.updateRange.offset,t.updateRange.count=n.updateRange.count),r.setAttribute(h,t)}let o=e.data.morphAttributes;if(o)for(let h in o){let t=o[h],n=[];for(let r=0,s=t.length;r<s;r++){let s,a=t[r];if(a.isInterleavedBufferAttribute){let t=i(e.data,a.data);s=new Pa(t,a.itemSize,a.offset,a.normalized)}else{let e=dt(a.type,a.array);s=new ti(e,a.itemSize,a.normalized)}void 0!==a.name&&(s.name=a.name),n.push(s)}r.morphAttributes[h]=n}e.data.morphTargetsRelative&&(r.morphTargetsRelative=!0);let l=e.data.groups||e.data.drawcalls||e.data.offsets;if(void 0!==l)for(let h=0,u=l.length;h!==u;++h){let e=l[h];r.addGroup(e.start,e.count,e.materialIndex)}let c=e.data.boundingSphere;if(void 0!==c){let e=new Bt;void 0!==c.center&&e.fromArray(c.center),r.boundingSphere=new rn(e,c.radius)}return e.name&&(r.name=e.name),e.userData&&(r.userData=e.userData),r}},Zl=class{constructor(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.autoStart=e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=Jl(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){let t=Jl();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}};function Jl(){return(typeof performance>"u"?Date:performance).now()}var $l=class{constructor(e,t,n){let i,r,s;switch(this.binding=e,this.valueSize=n,t){case"quaternion":i=this._slerp,r=this._slerpAdditive,s=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(6*n),this._workIndex=5;break;case"string":case"bool":i=this._select,r=this._select,s=this._setAdditiveIdentityOther,this.buffer=new Array(5*n);break;default:i=this._lerp,r=this._lerpAdditive,s=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(5*n)}this._mixBufferRegion=i,this._mixBufferRegionAdditive=r,this._setIdentity=s,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(e,t){let n=this.buffer,i=this.valueSize,r=e*i+i,s=this.cumulativeWeight;if(0===s){for(let e=0;e!==i;++e)n[r+e]=n[e];s=t}else{s+=t;let e=t/s;this._mixBufferRegion(n,r,0,e,i)}this.cumulativeWeight=s}accumulateAdditive(e){let t=this.buffer,n=this.valueSize,i=n*this._addIndex;0===this.cumulativeWeightAdditive&&this._setIdentity(),this._mixBufferRegionAdditive(t,i,0,e,n),this.cumulativeWeightAdditive+=e}apply(e){let t=this.valueSize,n=this.buffer,i=e*t+t,r=this.cumulativeWeight,s=this.cumulativeWeightAdditive,a=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,r<1){let e=t*this._origIndex;this._mixBufferRegion(n,i,e,1-r,t)}s>0&&this._mixBufferRegionAdditive(n,i,this._addIndex*t,1,t);for(let o=t,l=t+t;o!==l;++o)if(n[o]!==n[o+t]){a.setValue(n,i);break}}saveOriginalState(){let e=this.binding,t=this.buffer,n=this.valueSize,i=n*this._origIndex;e.getValue(t,i);for(let r=n,s=i;r!==s;++r)t[r]=t[i+r%n];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){let e=3*this.valueSize;this.binding.setValue(this.buffer,e)}_setAdditiveIdentityNumeric(){let e=this._addIndex*this.valueSize,t=e+this.valueSize;for(let n=e;n<t;n++)this.buffer[n]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){let e=this._origIndex*this.valueSize,t=this._addIndex*this.valueSize;for(let n=0;n<this.valueSize;n++)this.buffer[t+n]=this.buffer[e+n]}_select(e,t,n,i,r){if(i>=.5)for(let s=0;s!==r;++s)e[t+s]=e[n+s]}_slerp(e,t,n,i){Lt.slerpFlat(e,t,e,t,e,n,i)}_slerpAdditive(e,t,n,i,r){let s=this._workIndex*r;Lt.multiplyQuaternionsFlat(e,s,e,t,e,n),Lt.slerpFlat(e,t,e,t,e,s,i)}_lerp(e,t,n,i,r){let s=1-i;for(let a=0;a!==r;++a){let r=t+a;e[r]=e[r]*s+e[n+a]*i}}_lerpAdditive(e,t,n,i,r){for(let s=0;s!==r;++s){let r=t+s;e[r]=e[r]+e[n+s]*i}}},ec="\\[\\]\\.:\\/",tc=new RegExp("["+ec+"]","g"),nc="[^"+ec+"]",ic="[^"+ec.replace("\\.","")+"]",rc=/((?:WC+[\/:])*)/.source.replace("WC",nc),sc=/(WCOD+)?/.source.replace("WCOD",ic),ac=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",nc),oc=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",nc),lc=new RegExp("^"+rc+sc+ac+oc+"$"),cc=["material","materials","bones","map"],hc=class{constructor(e,t,n){this.path=t,this.parsedPath=n||hc.parseTrackName(t),this.node=hc.findNode(e,this.parsedPath.nodeName)||e,this.rootNode=e,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(e,t,n){return e&&e.isAnimationObjectGroup?new hc.Composite(e,t,n):new hc(e,t,n)}static sanitizeNodeName(e){return e.replace(/\s/g,"_").replace(tc,"")}static parseTrackName(e){let t=lc.exec(e);if(null===t)throw new Error("PropertyBinding: Cannot parse trackName: "+e);let n={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},i=n.nodeName&&n.nodeName.lastIndexOf(".");if(void 0!==i&&-1!==i){let e=n.nodeName.substring(i+1);-1!==cc.indexOf(e)&&(n.nodeName=n.nodeName.substring(0,i),n.objectName=e)}if(null===n.propertyName||0===n.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return n}static findNode(e,t){if(void 0===t||""===t||"."===t||-1===t||t===e.name||t===e.uuid)return e;if(e.skeleton){let n=e.skeleton.getBoneByName(t);if(void 0!==n)return n}if(e.children){let n=function(e){for(let i=0;i<e.length;i++){let r=e[i];if(r.name===t||r.uuid===t)return r;let s=n(r.children);if(s)return s}return null},i=n(e.children);if(i)return i}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(e,t){e[t]=this.targetObject[this.propertyName]}_getValue_array(e,t){let n=this.resolvedProperty;for(let i=0,r=n.length;i!==r;++i)e[t++]=n[i]}_getValue_arrayElement(e,t){e[t]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(e,t){this.resolvedProperty.toArray(e,t)}_setValue_direct(e,t){this.targetObject[this.propertyName]=e[t]}_setValue_direct_setNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(e,t){let n=this.resolvedProperty;for(let i=0,r=n.length;i!==r;++i)n[i]=e[t++]}_setValue_array_setNeedsUpdate(e,t){let n=this.resolvedProperty;for(let i=0,r=n.length;i!==r;++i)n[i]=e[t++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(e,t){let n=this.resolvedProperty;for(let i=0,r=n.length;i!==r;++i)n[i]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(e,t){this.resolvedProperty[this.propertyIndex]=e[t]}_setValue_arrayElement_setNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(e,t){this.resolvedProperty.fromArray(e,t)}_setValue_fromArray_setNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(e,t){this.bind(),this.getValue(e,t)}_setValue_unbound(e,t){this.bind(),this.setValue(e,t)}bind(){let e=this.node,t=this.parsedPath,n=t.objectName,i=t.propertyName,r=t.propertyIndex;if(e||(e=hc.findNode(this.rootNode,t.nodeName)||this.rootNode,this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!e)return void console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.");if(n){let i=t.objectIndex;switch(n){case"materials":if(!e.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!e.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);e=e.material.materials;break;case"bones":if(!e.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);e=e.skeleton.bones;for(let t=0;t<e.length;t++)if(e[t].name===i){i=t;break}break;case"map":if("map"in e){e=e.map;break}if(!e.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!e.material.map)return void console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);e=e.material.map;break;default:if(void 0===e[n])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);e=e[n]}if(void 0!==i){if(void 0===e[i])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);e=e[i]}}let s=e[i];if(void 0===s){let n=t.nodeName;return void console.error("THREE.PropertyBinding: Trying to update property for track: "+n+"."+i+" but it wasn't found.",e)}let a=this.Versioning.None;this.targetObject=e,void 0!==e.needsUpdate?a=this.Versioning.NeedsUpdate:void 0!==e.matrixWorldNeedsUpdate&&(a=this.Versioning.MatrixWorldNeedsUpdate);let o=this.BindingType.Direct;if(void 0!==r){if("morphTargetInfluences"===i){if(!e.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(!e.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);void 0!==e.morphTargetDictionary[r]&&(r=e.morphTargetDictionary[r])}o=this.BindingType.ArrayElement,this.resolvedProperty=s,this.propertyIndex=r}else void 0!==s.fromArray&&void 0!==s.toArray?(o=this.BindingType.HasFromToArray,this.resolvedProperty=s):Array.isArray(s)?(o=this.BindingType.EntireArray,this.resolvedProperty=s):this.propertyName=i;this.getValue=this.GetterByBindingType[o],this.setValue=this.SetterByBindingTypeAndVersioning[o][a]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}};hc.Composite=class{constructor(e,t,n){let i=n||hc.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,i)}getValue(e,t){this.bind();let n=this._targetGroup.nCachedObjects_,i=this._bindings[n];void 0!==i&&i.getValue(e,t)}setValue(e,t){let n=this._bindings;for(let i=this._targetGroup.nCachedObjects_,r=n.length;i!==r;++i)n[i].setValue(e,t)}bind(){let e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].bind()}unbind(){let e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].unbind()}},hc.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},hc.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},hc.prototype.GetterByBindingType=[hc.prototype._getValue_direct,hc.prototype._getValue_array,hc.prototype._getValue_arrayElement,hc.prototype._getValue_toArray],hc.prototype.SetterByBindingTypeAndVersioning=[[hc.prototype._setValue_direct,hc.prototype._setValue_direct_setNeedsUpdate,hc.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[hc.prototype._setValue_array,hc.prototype._setValue_array_setNeedsUpdate,hc.prototype._setValue_array_setMatrixWorldNeedsUpdate],[hc.prototype._setValue_arrayElement,hc.prototype._setValue_arrayElement_setNeedsUpdate,hc.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[hc.prototype._setValue_fromArray,hc.prototype._setValue_fromArray_setNeedsUpdate,hc.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];var uc=class{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:t.blendMode;this._mixer=e,this._clip=t,this._localRoot=n,this.blendMode=i;let r=t.tracks,s=r.length,a=new Array(s),o={endingStart:Re,endingEnd:Re};for(let l=0;l!==s;++l){let e=r[l].createInterpolant(null);a[l]=e,e.settings=o}this._interpolantSettings=o,this._interpolants=a,this._propertyBindings=new Array(s),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=2201,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(e){return this._startTime=e,this}setLoop(e,t){return this.loop=e,this.repetitions=t,this}setEffectiveWeight(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(e){return this._scheduleFading(e,0,1)}fadeOut(e){return this._scheduleFading(e,1,0)}crossFadeFrom(e,t,n){if(e.fadeOut(t),this.fadeIn(t),n){let n=this._clip.duration,i=e._clip.duration,r=i/n,s=n/i;e.warp(1,r,t),this.warp(s,1,t)}return this}crossFadeTo(e,t,n){return e.crossFadeFrom(this,t,n)}stopFading(){let e=this._weightInterpolant;return null!==e&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}setEffectiveTimeScale(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(e){return this.timeScale=this._clip.duration/e,this.stopWarping()}syncWith(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()}halt(e){return this.warp(this._effectiveTimeScale,0,e)}warp(e,t,n){let i=this._mixer,r=i.time,s=this.timeScale,a=this._timeScaleInterpolant;null===a&&(a=i._lendControlInterpolant(),this._timeScaleInterpolant=a);let o=a.parameterPositions,l=a.sampleValues;return o[0]=r,o[1]=r+n,l[0]=e/s,l[1]=t/s,this}stopWarping(){let e=this._timeScaleInterpolant;return null!==e&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(e,t,n,i){if(!this.enabled)return void this._updateWeight(e);let r=this._startTime;if(null!==r){let i=(e-r)*n;i<0||0===n?t=0:(this._startTime=null,t=n*i)}t*=this._updateTimeScale(e);let s=this._updateTime(t),a=this._updateWeight(e);if(a>0){let e=this._interpolants,t=this._propertyBindings;if(2501===this.blendMode)for(let n=0,i=e.length;n!==i;++n)e[n].evaluate(s),t[n].accumulateAdditive(a);else for(let n=0,r=e.length;n!==r;++n)e[n].evaluate(s),t[n].accumulate(i,a)}}_updateWeight(e){let t=0;if(this.enabled){t=this.weight;let n=this._weightInterpolant;if(null!==n){let i=n.evaluate(e)[0];t*=i,e>n.parameterPositions[1]&&(this.stopFading(),0===i&&(this.enabled=!1))}}return this._effectiveWeight=t,t}_updateTimeScale(e){let t=0;if(!this.paused){t=this.timeScale;let n=this._timeScaleInterpolant;if(null!==n){t*=n.evaluate(e)[0],e>n.parameterPositions[1]&&(this.stopWarping(),0===t?this.paused=!0:this.timeScale=t)}}return this._effectiveTimeScale=t,t}_updateTime(e){let t=this._clip.duration,n=this.loop,i=this.time+e,r=this._loopCount,s=n===Pe;if(0===e)return-1===r?i:s&&1===(1&r)?t-i:i;if(2200===n){-1===r&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(i>=t)i=t;else{if(!(i<0)){this.time=i;break e}i=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=i,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(-1===r&&(e>=0?(r=0,this._setEndings(!0,0===this.repetitions,s)):this._setEndings(0===this.repetitions,!0,s)),i>=t||i<0){let n=Math.floor(i/t);i-=t*n,r+=Math.abs(n);let a=this.repetitions-r;if(a<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,i=e>0?t:0,this.time=i,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(1===a){let t=e<0;this._setEndings(t,!t,s)}else this._setEndings(!1,!1,s);this._loopCount=r,this.time=i,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:n})}}else this.time=i;if(s&&1===(1&r))return t-i}return i}_setEndings(e,t,n){let i=this._interpolantSettings;n?(i.endingStart=ke,i.endingEnd=ke):(i.endingStart=e?this.zeroSlopeAtStart?ke:Re:Le,i.endingEnd=t?this.zeroSlopeAtEnd?ke:Re:Le)}_scheduleFading(e,t,n){let i=this._mixer,r=i.time,s=this._weightInterpolant;null===s&&(s=i._lendControlInterpolant(),this._weightInterpolant=s);let a=s.parameterPositions,o=s.sampleValues;return a[0]=r,o[0]=t,a[1]=r+e,o[1]=n,this}},dc=new Float32Array(1),pc=class extends qe{constructor(e){super(),this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(e,t){let n=e._localRoot||this._root,i=e._clip.tracks,r=i.length,s=e._propertyBindings,a=e._interpolants,o=n.uuid,l=this._bindingsByRootAndName,c=l[o];void 0===c&&(c={},l[o]=c);for(let h=0;h!==r;++h){let e=i[h],r=e.name,l=c[r];if(void 0!==l)++l.referenceCount,s[h]=l;else{if(l=s[h],void 0!==l){null===l._cacheIndex&&(++l.referenceCount,this._addInactiveBinding(l,o,r));continue}let i=t&&t._propertyBindings[h].binding.parsedPath;l=new $l(hc.create(n,r,i),e.ValueTypeName,e.getValueSize()),++l.referenceCount,this._addInactiveBinding(l,o,r),s[h]=l}a[h].resultBuffer=l.buffer}}_activateAction(e){if(!this._isActiveAction(e)){if(null===e._cacheIndex){let t=(e._localRoot||this._root).uuid,n=e._clip.uuid,i=this._actionsByClip[n];this._bindAction(e,i&&i.knownActions[0]),this._addInactiveAction(e,n,t)}let t=e._propertyBindings;for(let e=0,n=t.length;e!==n;++e){let n=t[e];0===n.useCount++&&(this._lendBinding(n),n.saveOriginalState())}this._lendAction(e)}}_deactivateAction(e){if(this._isActiveAction(e)){let t=e._propertyBindings;for(let e=0,n=t.length;e!==n;++e){let n=t[e];0===--n.useCount&&(n.restoreOriginalState(),this._takeBackBinding(n))}this._takeBackAction(e)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;let e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}}_isActiveAction(e){let t=e._cacheIndex;return null!==t&&t<this._nActiveActions}_addInactiveAction(e,t,n){let i=this._actions,r=this._actionsByClip,s=r[t];if(void 0===s)s={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,r[t]=s;else{let t=s.knownActions;e._byClipCacheIndex=t.length,t.push(e)}e._cacheIndex=i.length,i.push(e),s.actionByRoot[n]=e}_removeInactiveAction(e){let t=this._actions,n=t[t.length-1],i=e._cacheIndex;n._cacheIndex=i,t[i]=n,t.pop(),e._cacheIndex=null;let r=e._clip.uuid,s=this._actionsByClip,a=s[r],o=a.knownActions,l=o[o.length-1],c=e._byClipCacheIndex;l._byClipCacheIndex=c,o[c]=l,o.pop(),e._byClipCacheIndex=null,delete a.actionByRoot[(e._localRoot||this._root).uuid],0===o.length&&delete s[r],this._removeInactiveBindingsForAction(e)}_removeInactiveBindingsForAction(e){let t=e._propertyBindings;for(let n=0,i=t.length;n!==i;++n){let e=t[n];0===--e.referenceCount&&this._removeInactiveBinding(e)}}_lendAction(e){let t=this._actions,n=e._cacheIndex,i=this._nActiveActions++,r=t[i];e._cacheIndex=i,t[i]=e,r._cacheIndex=n,t[n]=r}_takeBackAction(e){let t=this._actions,n=e._cacheIndex,i=--this._nActiveActions,r=t[i];e._cacheIndex=i,t[i]=e,r._cacheIndex=n,t[n]=r}_addInactiveBinding(e,t,n){let i=this._bindingsByRootAndName,r=this._bindings,s=i[t];void 0===s&&(s={},i[t]=s),s[n]=e,e._cacheIndex=r.length,r.push(e)}_removeInactiveBinding(e){let t=this._bindings,n=e.binding,i=n.rootNode.uuid,r=n.path,s=this._bindingsByRootAndName,a=s[i],o=t[t.length-1],l=e._cacheIndex;o._cacheIndex=l,t[l]=o,t.pop(),delete a[r],0===Object.keys(a).length&&delete s[i]}_lendBinding(e){let t=this._bindings,n=e._cacheIndex,i=this._nActiveBindings++,r=t[i];e._cacheIndex=i,t[i]=e,r._cacheIndex=n,t[n]=r}_takeBackBinding(e){let t=this._bindings,n=e._cacheIndex,i=--this._nActiveBindings,r=t[i];e._cacheIndex=i,t[i]=e,r._cacheIndex=n,t[n]=r}_lendControlInterpolant(){let e=this._controlInterpolants,t=this._nActiveControlInterpolants++,n=e[t];return void 0===n&&(n=new pl(new Float32Array(2),new Float32Array(2),1,dc),n.__cacheIndex=t,e[t]=n),n}_takeBackControlInterpolant(e){let t=this._controlInterpolants,n=e.__cacheIndex,i=--this._nActiveControlInterpolants,r=t[i];e.__cacheIndex=i,t[i]=e,r.__cacheIndex=n,t[n]=r}clipAction(e,t,n){let i=t||this._root,r=i.uuid,s="string"==typeof e?_l.findByName(i,e):e,a=null!==s?s.uuid:e,o=this._actionsByClip[a],l=null;if(void 0===n&&(n=null!==s?s.blendMode:Be),void 0!==o){let e=o.actionByRoot[r];if(void 0!==e&&e.blendMode===n)return e;l=o.knownActions[0],null===s&&(s=l._clip)}if(null===s)return null;let c=new uc(this,s,t,n);return this._bindAction(c,l),this._addInactiveAction(c,a,r),c}existingAction(e,t){let n=t||this._root,i=n.uuid,r="string"==typeof e?_l.findByName(n,e):e,s=r?r.uuid:e,a=this._actionsByClip[s];return void 0!==a&&a.actionByRoot[i]||null}stopAllAction(){let e=this._actions;for(let t=this._nActiveActions-1;t>=0;--t)e[t].stop();return this}update(e){e*=this.timeScale;let t=this._actions,n=this._nActiveActions,i=this.time+=e,r=Math.sign(e),s=this._accuIndex^=1;for(let l=0;l!==n;++l)t[l]._update(i,e,r,s);let a=this._bindings,o=this._nActiveBindings;for(let l=0;l!==o;++l)a[l].apply(s);return this}setTime(e){this.time=0;for(let t=0;t<this._actions.length;t++)this._actions[t].time=0;return this.update(e)}getRoot(){return this._root}uncacheClip(e){let t=this._actions,n=e.uuid,i=this._actionsByClip,r=i[n];if(void 0!==r){let e=r.knownActions;for(let n=0,i=e.length;n!==i;++n){let i=e[n];this._deactivateAction(i);let r=i._cacheIndex,s=t[t.length-1];i._cacheIndex=null,i._byClipCacheIndex=null,s._cacheIndex=r,t[r]=s,t.pop(),this._removeInactiveBindingsForAction(i)}delete i[n]}}uncacheRoot(e){let t=e.uuid,n=this._actionsByClip;for(let r in n){let e=n[r].actionByRoot[t];void 0!==e&&(this._deactivateAction(e),this._removeInactiveAction(e))}let i=this._bindingsByRootAndName[t];if(void 0!==i)for(let r in i){let e=i[r];e.restoreOriginalState(),this._removeInactiveBinding(e)}}uncacheAction(e,t){let n=this.existingAction(e,t);null!==n&&(this._deactivateAction(n),this._removeInactiveAction(n))}},fc=class{constructor(e){this.value=e}clone(){return new fc(void 0===this.value.clone?this.value:this.value.clone())}},mc=class{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1/0;this.ray=new dn(e,t),this.near=n,this.far=i,this.camera=null,this.layers=new En,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(e,t){this.ray.set(e,t)}setFromCamera(e,t){t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):console.error("THREE.Raycaster: Unsupported camera type: "+t.type)}intersectObject(e){let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];return vc(e,this,t,!(arguments.length>1&&void 0!==arguments[1])||arguments[1]),t.sort(gc),t}intersectObjects(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];for(let i=0,r=e.length;i<r;i++)vc(e[i],this,n,t);return n.sort(gc),n}};function gc(e,t){return e.distance-t.distance}function vc(e,t,n,i){if(e.layers.test(t.layers)&&e.raycast(t,n),!0===i){let i=e.children;for(let e=0,r=i.length;e<r;e++)vc(i[e],t,n,!0)}}var yc=class{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return this.radius=e,this.phi=t,this.theta=n,this}set(e,t,n){return this.radius=e,this.phi=t,this.theta=n,this}copy(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}makeSafe(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,n){return this.radius=Math.sqrt(e*e+t*t+n*n),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,n),this.phi=Math.acos(Je(t/this.radius,-1,1))),this}clone(){return(new this.constructor).copy(this)}},bc=new ot,xc=class{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new ot(1/0,1/0),t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new ot(-1/0,-1/0);this.isBox2=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromPoints(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){let n=bc.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}clone(){return(new this.constructor).copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(e){return this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y)}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return bc.copy(e).clamp(this.min,this.max).sub(e).length()}intersect(e){return this.min.max(e.min),this.max.min(e.max),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}},wc=new Bt,Sc=new Bt,_c=class{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Bt,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Bt;this.start=e,this.end=t}set(e,t){return this.start.copy(e),this.end.copy(t),this}copy(e){return this.start.copy(e.start),this.end.copy(e.end),this}getCenter(e){return e.addVectors(this.start,this.end).multiplyScalar(.5)}delta(e){return e.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(e,t){return this.delta(t).multiplyScalar(e).add(this.start)}closestPointToPointParameter(e,t){wc.subVectors(e,this.start),Sc.subVectors(this.end,this.start);let n=Sc.dot(Sc),i=Sc.dot(wc)/n;return t&&(i=Je(i,0,1)),i}closestPointToPoint(e,t,n){let i=this.closestPointToPointParameter(e,t);return this.delta(n).multiplyScalar(i).add(this.start)}applyMatrix4(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this}equals(e){return e.start.equals(this.start)&&e.end.equals(this.end)}clone(){return(new this.constructor).copy(this)}},Ec=new Bt,Ac=class extends Nn{constructor(e,t){super(),this.light=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=t,this.type="SpotLightHelper";let n=new di,i=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let s=0,a=1,o=32;s<o;s++,a++){let e=s/o*Math.PI*2,t=a/o*Math.PI*2;i.push(Math.cos(e),Math.sin(e),1,Math.cos(t),Math.sin(t),1)}n.setAttribute("position",new ri(i,3));let r=new Va({fog:!1,toneMapped:!1});this.cone=new Za(n,r),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1);let e=this.light.distance?this.light.distance:1e3,t=e*Math.tan(this.light.angle);this.cone.scale.set(t,t,e),Ec.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(Ec),void 0!==this.color?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}},Cc=class extends Ci{constructor(e,t,n){super(new tl(t,4,2),new Jn({wireframe:!0,fog:!1,toneMapped:!1})),this.light=e,this.color=n,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),void 0!==this.color?this.material.color.set(this.color):this.material.color.copy(this.light.color)}},Mc=new Bt,Tc=new Bt,Pc=new Bt,Dc=class extends Nn{constructor(e,t,n){super(),this.light=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=n,this.type="DirectionalLightHelper",void 0===t&&(t=1);let i=new di;i.setAttribute("position",new ri([-t,t,0,t,t,0,t,-t,0,-t,-t,0,-t,t,0],3));let r=new Va({fog:!1,toneMapped:!1});this.lightPlane=new Ya(i,r),this.add(this.lightPlane),i=new di,i.setAttribute("position",new ri([0,0,0,0,0,1],3)),this.targetLine=new Ya(i,r),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),Mc.setFromMatrixPosition(this.light.matrixWorld),Tc.setFromMatrixPosition(this.light.target.matrixWorld),Pc.subVectors(Tc,Mc),this.lightPlane.lookAt(Tc),void 0!==this.color?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(Tc),this.targetLine.scale.z=Pc.length()}},Oc=new Bt,Ic=new ki,Rc=class extends Za{constructor(e){let t=new di,n=new Va({color:16777215,vertexColors:!0,toneMapped:!1}),i=[],r=[],s={};function a(e,t){o(e),o(t)}function o(e){i.push(0,0,0),r.push(0,0,0),void 0===s[e]&&(s[e]=[]),s[e].push(i.length/3-1)}a("n1","n2"),a("n2","n4"),a("n4","n3"),a("n3","n1"),a("f1","f2"),a("f2","f4"),a("f4","f3"),a("f3","f1"),a("n1","f1"),a("n2","f2"),a("n3","f3"),a("n4","f4"),a("p","n1"),a("p","n2"),a("p","n3"),a("p","n4"),a("u1","u2"),a("u2","u3"),a("u3","u1"),a("c","t"),a("p","c"),a("cn1","cn2"),a("cn3","cn4"),a("cf1","cf2"),a("cf3","cf4"),t.setAttribute("position",new ri(i,3)),t.setAttribute("color",new ri(r,3)),super(t,n),this.type="CameraHelper",this.camera=e,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=s,this.update();let l=new Et(16755200),c=new Et(16711680),h=new Et(43775),u=new Et(16777215),d=new Et(3355443);this.setColors(l,c,h,u,d)}setColors(e,t,n,i,r){let s=this.geometry.getAttribute("color");s.setXYZ(0,e.r,e.g,e.b),s.setXYZ(1,e.r,e.g,e.b),s.setXYZ(2,e.r,e.g,e.b),s.setXYZ(3,e.r,e.g,e.b),s.setXYZ(4,e.r,e.g,e.b),s.setXYZ(5,e.r,e.g,e.b),s.setXYZ(6,e.r,e.g,e.b),s.setXYZ(7,e.r,e.g,e.b),s.setXYZ(8,e.r,e.g,e.b),s.setXYZ(9,e.r,e.g,e.b),s.setXYZ(10,e.r,e.g,e.b),s.setXYZ(11,e.r,e.g,e.b),s.setXYZ(12,e.r,e.g,e.b),s.setXYZ(13,e.r,e.g,e.b),s.setXYZ(14,e.r,e.g,e.b),s.setXYZ(15,e.r,e.g,e.b),s.setXYZ(16,e.r,e.g,e.b),s.setXYZ(17,e.r,e.g,e.b),s.setXYZ(18,e.r,e.g,e.b),s.setXYZ(19,e.r,e.g,e.b),s.setXYZ(20,e.r,e.g,e.b),s.setXYZ(21,e.r,e.g,e.b),s.setXYZ(22,e.r,e.g,e.b),s.setXYZ(23,e.r,e.g,e.b),s.setXYZ(24,t.r,t.g,t.b),s.setXYZ(25,t.r,t.g,t.b),s.setXYZ(26,t.r,t.g,t.b),s.setXYZ(27,t.r,t.g,t.b),s.setXYZ(28,t.r,t.g,t.b),s.setXYZ(29,t.r,t.g,t.b),s.setXYZ(30,t.r,t.g,t.b),s.setXYZ(31,t.r,t.g,t.b),s.setXYZ(32,n.r,n.g,n.b),s.setXYZ(33,n.r,n.g,n.b),s.setXYZ(34,n.r,n.g,n.b),s.setXYZ(35,n.r,n.g,n.b),s.setXYZ(36,n.r,n.g,n.b),s.setXYZ(37,n.r,n.g,n.b),s.setXYZ(38,i.r,i.g,i.b),s.setXYZ(39,i.r,i.g,i.b),s.setXYZ(40,r.r,r.g,r.b),s.setXYZ(41,r.r,r.g,r.b),s.setXYZ(42,r.r,r.g,r.b),s.setXYZ(43,r.r,r.g,r.b),s.setXYZ(44,r.r,r.g,r.b),s.setXYZ(45,r.r,r.g,r.b),s.setXYZ(46,r.r,r.g,r.b),s.setXYZ(47,r.r,r.g,r.b),s.setXYZ(48,r.r,r.g,r.b),s.setXYZ(49,r.r,r.g,r.b),s.needsUpdate=!0}update(){let e=this.geometry,t=this.pointMap;Ic.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),kc("c",t,e,Ic,0,0,-1),kc("t",t,e,Ic,0,0,1),kc("n1",t,e,Ic,-1,-1,-1),kc("n2",t,e,Ic,1,-1,-1),kc("n3",t,e,Ic,-1,1,-1),kc("n4",t,e,Ic,1,1,-1),kc("f1",t,e,Ic,-1,-1,1),kc("f2",t,e,Ic,1,-1,1),kc("f3",t,e,Ic,-1,1,1),kc("f4",t,e,Ic,1,1,1),kc("u1",t,e,Ic,.7,1.1,-1),kc("u2",t,e,Ic,-.7,1.1,-1),kc("u3",t,e,Ic,0,2,-1),kc("cf1",t,e,Ic,-1,0,1),kc("cf2",t,e,Ic,1,0,1),kc("cf3",t,e,Ic,0,-1,1),kc("cf4",t,e,Ic,0,1,1),kc("cn1",t,e,Ic,-1,0,-1),kc("cn2",t,e,Ic,1,0,-1),kc("cn3",t,e,Ic,0,-1,-1),kc("cn4",t,e,Ic,0,1,-1),e.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}};function kc(e,t,n,i,r,s,a){Oc.set(r,s,a).unproject(i);let o=t[e];if(void 0!==o){let e=n.getAttribute("position");for(let t=0,n=o.length;t<n;t++)e.setXYZ(o[t],Oc.x,Oc.y,Oc.z)}}var Lc=class extends Za{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:16776960,n=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),i=new di;i.setIndex(new ti(n,1)),i.setAttribute("position",new ri([1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],3)),super(i,new Va({color:t,toneMapped:!1})),this.box=e,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(e){let t=this.box;t.isEmpty()||(t.getCenter(this.position),t.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(e))}dispose(){this.geometry.dispose(),this.material.dispose()}},Bc=class extends Za{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=[0,0,0,e,0,0,0,0,0,0,e,0,0,0,0,0,0,e],n=new di;n.setAttribute("position",new ri(t,3)),n.setAttribute("color",new ri([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],3)),super(n,new Va({vertexColors:!0,toneMapped:!1})),this.type="AxesHelper"}setColors(e,t,n){let i=new Et,r=this.geometry.attributes.color.array;return i.set(e),i.toArray(r,0),i.toArray(r,3),i.set(t),i.toArray(r,6),i.toArray(r,9),i.set(n),i.toArray(r,12),i.toArray(r,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}},zc=function(){let e=new ArrayBuffer(4),t=new Float32Array(e),n=new Uint32Array(e),i=new Uint32Array(512),r=new Uint32Array(512);for(let l=0;l<256;++l){let e=l-127;e<-27?(i[l]=0,i[256|l]=32768,r[l]=24,r[256|l]=24):e<-14?(i[l]=1024>>-e-14,i[256|l]=1024>>-e-14|32768,r[l]=-e-1,r[256|l]=-e-1):e<=15?(i[l]=e+15<<10,i[256|l]=e+15<<10|32768,r[l]=13,r[256|l]=13):e<128?(i[l]=31744,i[256|l]=64512,r[l]=24,r[256|l]=24):(i[l]=31744,i[256|l]=64512,r[l]=13,r[256|l]=13)}let s=new Uint32Array(2048),a=new Uint32Array(64),o=new Uint32Array(64);for(let l=1;l<1024;++l){let e=l<<13,t=0;for(;0===(8388608&e);)e<<=1,t-=8388608;e&=-8388609,t+=947912704,s[l]=e|t}for(let l=1024;l<2048;++l)s[l]=939524096+(l-1024<<13);for(let l=1;l<31;++l)a[l]=l<<23;a[31]=1199570944,a[32]=2147483648;for(let l=33;l<63;++l)a[l]=2147483648+(l-32<<23);a[63]=3347054592;for(let l=1;l<64;++l)32!==l&&(o[l]=1024);return{floatView:t,uint32View:n,baseTable:i,shiftTable:r,mantissaTable:s,exponentTable:a,offsetTable:o}}();var Nc=Object.freeze({__proto__:null,fromHalfFloat:function(e){let t=e>>10;return zc.uint32View[0]=zc.mantissaTable[zc.offsetTable[t]+(1023&e)]+zc.exponentTable[t],zc.floatView[0]},toHalfFloat:function(e){Math.abs(e)>65504&&console.warn("THREE.DataUtils.toHalfFloat(): Value out of range."),e=Je(e,-65504,65504),zc.floatView[0]=e;let t=zc.uint32View[0],n=t>>23&511;return zc.baseTable[n]+((8388607&t)>>zc.shiftTable[n])}});typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:k}})),typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=k);var Fc=".",Uc=Symbol("target"),jc=Symbol("unsubscribe");function Vc(e){return e instanceof Date||e instanceof Set||e instanceof Map||e instanceof WeakSet||e instanceof WeakMap||ArrayBuffer.isView(e)}var Gc=Array.isArray;function Hc(e){return"symbol"==typeof e}var Wc={after:(e,t)=>Gc(e)?e.slice(t.length):""===t?e:e.slice(t.length+1),concat:(e,t)=>Gc(e)?(e=[...e],t&&e.push(t),e):t&&void 0!==t.toString?(""!==e&&(e+=Fc),Hc(t)?e+t.toString():e+t):e,initial:e=>{if(Gc(e))return e.slice(0,-1);if(""===e)return e;let t=e.lastIndexOf(Fc);return-1===t?"":e.slice(0,t)},last:e=>{if(Gc(e))return e[e.length-1]||"";if(""===e)return e;let t=e.lastIndexOf(Fc);return-1===t?e:e.slice(t+1)},walk:(e,t)=>{if(Gc(e))for(let n of e)t(n);else if(""!==e){let n=0,i=e.indexOf(Fc);if(-1===i)t(e);else for(;n<e.length;)-1===i&&(i=e.length),t(e.slice(n,i)),n=i+1,i=e.indexOf(Fc,n)}},get(e,t){return this.walk(t,(t=>{e&&(e=e[t])})),e}},qc=Wc;function Xc(e,t,n){return e.isUnsubscribed||t.ignoreSymbols&&Hc(n)||t.ignoreUnderscores&&"_"===n.charAt(0)||"ignoreKeys"in t&&t.ignoreKeys.includes(n)}var Yc=class{constructor(e){this._equals=e,this._proxyCache=new WeakMap,this._pathCache=new WeakMap,this.isUnsubscribed=!1}_getDescriptorCache(){return void 0===this._descriptorCache&&(this._descriptorCache=new WeakMap),this._descriptorCache}_getProperties(e){let t=this._getDescriptorCache(),n=t.get(e);return void 0===n&&(n={},t.set(e,n)),n}_getOwnPropertyDescriptor(e,t){if(this.isUnsubscribed)return Reflect.getOwnPropertyDescriptor(e,t);let n=this._getProperties(e),i=n[t];return void 0===i&&(i=Reflect.getOwnPropertyDescriptor(e,t),n[t]=i),i}getProxy(e,t,n,i){if(this.isUnsubscribed)return e;let r=e[i],s=r||e;this._pathCache.set(s,t);let a=this._proxyCache.get(s);return void 0===a&&(a=void 0===r?new Proxy(e,n):e,this._proxyCache.set(s,a)),a}getPath(e){return this.isUnsubscribed?void 0:this._pathCache.get(e)}isDetached(e,t){return!Object.is(e,qc.get(t,this.getPath(e)))}defineProperty(e,t,n){return!!Reflect.defineProperty(e,t,n)&&(this.isUnsubscribed||(this._getProperties(e)[t]=n),!0)}setProperty(e,t,n,i,r){if(!this._equals(r,n)||!(t in e)){let r=this._getOwnPropertyDescriptor(e,t);return void 0!==r&&"set"in r?Reflect.set(e,t,n,i):Reflect.set(e,t,n)}return!0}deleteProperty(e,t,n){if(Reflect.deleteProperty(e,t)){if(!this.isUnsubscribed){let i=this._getDescriptorCache().get(e);i&&(delete i[t],this._pathCache.delete(n))}return!0}return!1}isSameDescriptor(e,t,n){let i=this._getOwnPropertyDescriptor(t,n);return void 0!==e&&void 0!==i&&Object.is(e.value,i.value)&&(e.writable||!1)===(i.writable||!1)&&(e.enumerable||!1)===(i.enumerable||!1)&&(e.configurable||!1)===(i.configurable||!1)&&e.get===i.get&&e.set===i.set}isGetInvariant(e,t){let n=this._getOwnPropertyDescriptor(e,t);return void 0!==n&&!0!==n.configurable&&!0!==n.writable}unsubscribe(){this._descriptorCache=null,this._pathCache=null,this._proxyCache=null,this.isUnsubscribed=!0}};function Qc(e){return"[object Object]"===toString.call(e)}function Kc(){return!0}function Zc(e,t){return e.length!==t.length||e.some(((e,n)=>t[n]!==e))}var Jc=new Set(["hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]),$c=new Set(["concat","includes","indexOf","join","keys","lastIndexOf"]),eh={push:Kc,pop:Kc,shift:Kc,unshift:Kc,copyWithin:Zc,reverse:Zc,sort:Zc,splice:Zc,flat:Zc,fill:Zc},th=new Set([...Jc,...$c,...Object.keys(eh)]);function nh(e,t){if(e.size!==t.size)return!0;for(let n of e)if(!t.has(n))return!0;return!1}var ih=["keys","values","entries"],rh=new Set(["has","toString"]),sh={add:nh,clear:nh,delete:nh,forEach:nh},ah=new Set([...rh,...Object.keys(sh),...ih]);function oh(e,t){if(e.size!==t.size)return!0;let n;for(let[i,r]of e)if(n=t.get(i),n!==r||void 0===n&&!t.has(i))return!0;return!1}var lh=new Set([...rh,"get"]),ch={set:oh,clear:oh,delete:oh,forEach:oh},hh=new Set([...lh,...Object.keys(ch),...ih]),uh=class{constructor(e,t,n,i){this._path=t,this._isChanged=!1,this._clonedCache=new Set,this._hasOnValidate=i,this._changes=i?[]:null,this.clone=void 0===t?e:this._shallowClone(e)}static isHandledMethod(e){return Jc.has(e)}_shallowClone(e){let t=e;if(Qc(e))t=o({},e);else if(Gc(e))t=[...e];else if(e instanceof Date)t=new Date(e);else if(e instanceof Set)t=new Set([...e].map((e=>this._shallowClone(e))));else if(e instanceof Map){t=new Map;for(let[n,i]of e.entries())t.set(n,this._shallowClone(i))}return this._clonedCache.add(t),t}preferredThisArg(e,t,n,i){return e?(Gc(i)?this._onIsChanged=eh[t]:i instanceof Set?this._onIsChanged=sh[t]:i instanceof Map&&(this._onIsChanged=ch[t]),i):n}update(e,t,n){let i=qc.after(e,this._path);if("length"!==t){let e=this.clone;qc.walk(i,(t=>{e&&e[t]&&(this._clonedCache.has(e[t])||(e[t]=this._shallowClone(e[t])),e=e[t])})),this._hasOnValidate&&this._changes.push({path:i,property:t,previous:n}),e&&e[t]&&(e[t]=n)}this._isChanged=!0}undo(e){let t;for(let n=this._changes.length-1;-1!==n;n--)t=this._changes[n],qc.get(e,t.path)[t.property]=t.previous}isChanged(e){return void 0===this._onIsChanged?this._isChanged:this._onIsChanged(this.clone,e)}},dh=class extends uh{static isHandledMethod(e){return th.has(e)}},ph=class extends uh{undo(e){e.setTime(this.clone.getTime())}isChanged(e,t){return!t(this.clone.valueOf(),e.valueOf())}},fh=class extends uh{static isHandledMethod(e){return ah.has(e)}undo(e){for(let t of this.clone)e.add(t);for(let t of e)this.clone.has(t)||e.delete(t)}},mh=class extends uh{static isHandledMethod(e){return hh.has(e)}undo(e){for(let[t,n]of this.clone.entries())e.set(t,n);for(let t of e.keys())this.clone.has(t)||e.delete(t)}},gh=class extends uh{constructor(e,t,n,i){super(void 0,t,n,i),this._arg1=n[0],this._weakValue=e.has(this._arg1)}isChanged(e){return this._weakValue!==e.has(this._arg1)}undo(e){this._weakValue&&!e.has(this._arg1)?e.add(this._arg1):e.delete(this._arg1)}},vh=class extends uh{constructor(e,t,n,i){super(void 0,t,n,i),this._weakKey=n[0],this._weakHas=e.has(this._weakKey),this._weakValue=e.get(this._weakKey)}isChanged(e){return this._weakValue!==e.get(this._weakKey)}undo(e){let t=e.has(this._weakKey);this._weakHas&&!t?e.set(this._weakKey,this._weakValue):!this._weakHas&&t?e.delete(this._weakKey):this._weakValue!==e.get(this._weakKey)&&e.set(this._weakKey,this._weakValue)}},yh=class{constructor(e){this._stack=[],this._hasOnValidate=e}static isHandledType(e){return Qc(e)||Gc(e)||Vc(e)}static isHandledMethod(e,t){return Qc(e)?uh.isHandledMethod(t):Gc(e)?dh.isHandledMethod(t):e instanceof Set?fh.isHandledMethod(t):e instanceof Map?mh.isHandledMethod(t):Vc(e)}get isCloning(){return this._stack.length>0}start(e,t,n){let i=uh;Gc(e)?i=dh:e instanceof Date?i=ph:e instanceof Set?i=fh:e instanceof Map?i=mh:e instanceof WeakSet?i=gh:e instanceof WeakMap&&(i=vh),this._stack.push(new i(e,t,n,this._hasOnValidate))}update(e,t,n){this._stack[this._stack.length-1].update(e,t,n)}preferredThisArg(e,t,n){let{name:i}=e,r=yh.isHandledMethod(n,i);return this._stack[this._stack.length-1].preferredThisArg(r,i,t,n)}isChanged(e,t,n){return this._stack[this._stack.length-1].isChanged(e,t,n)}undo(e){void 0!==this._previousClone&&this._previousClone.undo(e)}stop(){return this._previousClone=this._stack.pop(),this._previousClone.clone}},bh={equals:Object.is,isShallow:!1,pathAsArray:!1,ignoreSymbols:!1,ignoreUnderscores:!1,ignoreDetached:!1,details:!1},xh=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};n=o(o({},bh),n);let i=Symbol("ProxyTarget"),{equals:r,isShallow:s,ignoreDetached:a,details:l}=n,c=new Yc(r),h="function"==typeof n.onValidate,u=new yh(h),d=(e,t,i,r,s)=>!h||u.isCloning||!0===n.onValidate(qc.concat(c.getPath(e),t),i,r,s),p=(t,i,r,s)=>{!Xc(c,n,i)&&(!a||!c.isDetached(t,e))&&f(c.getPath(t),i,r,s)},f=(e,n,i,r,s)=>{u.isCloning?u.update(e,n,r):t(qc.concat(e,n),i,r,s)},m=e=>e&&(e[i]||e),g=(t,r,o,l)=>function(e){return("object"==typeof e?null===e:"function"!=typeof e)||e instanceof RegExp}(t)||"constructor"===o||s&&!yh.isHandledMethod(r,o)||Xc(c,n,o)||c.isGetInvariant(r,o)||a&&c.isDetached(r,e)?t:(void 0===l&&(l=c.getPath(r)),c.getProxy(t,qc.concat(l,o),v,i)),v={get(e,t,n){if(Hc(t)){if(t===i||t===Uc)return e;if(t===jc&&!c.isUnsubscribed&&0===c.getPath(e).length)return c.unsubscribe(),e}let r=Vc(e)?Reflect.get(e,t):Reflect.get(e,t,n);return g(r,e,t)},set(e,t,n,s){n=m(n);let a=e[i]||e,o=a[t];if(r(o,n)&&t in e)return!0;let l=d(e,t,n,o);return l&&c.setProperty(a,t,n,s,o)?(p(e,t,e[t],o),!0):!l},defineProperty(e,t,n){if(!c.isSameDescriptor(n,e,t)){let i=e[t];d(e,t,n.value,i)&&c.defineProperty(e,t,n,i)&&p(e,t,n.value,i)}return!0},deleteProperty(e,t){if(!Reflect.has(e,t))return!0;let n=Reflect.get(e,t),i=d(e,t,void 0,n);return i&&c.deleteProperty(e,t,n)?(p(e,t,void 0,n),!0):!i},apply(t,n,s){let a=n[i]||n;if(c.isUnsubscribed)return Reflect.apply(t,a,s);if((!1===l||!0!==l&&!l.includes(t.name))&&yh.isHandledType(a)){let i=qc.initial(c.getPath(t)),o=yh.isHandledMethod(a,t.name);u.start(a,i,s);let l=Reflect.apply(t,u.preferredThisArg(t,n,a),o?s.map((e=>m(e))):s),h=u.isChanged(a,r),p=u.stop();if(yh.isHandledType(l)&&o&&(n instanceof Map&&"get"===t.name&&(i=qc.concat(i,s[0])),l=c.getProxy(l,i,v)),h){let n={name:t.name,args:s,result:l},r=u.isCloning?qc.initial(i):i,o=u.isCloning?qc.last(i):"";d(qc.get(e,r),o,a,p,n)?f(r,o,a,p,n):u.undo(a)}return(n instanceof Map||n instanceof Set)&&function(e){return"object"==typeof e&&"function"==typeof e.next}(l)?function(e,t,n,i,r){let s=e.next;if("entries"===t.name)e.next=function(){let e=s.call(this);return!1===e.done&&(e.value[0]=r(e.value[0],t,e.value[0],i),e.value[1]=r(e.value[1],t,e.value[0],i)),e};else if("values"===t.name){let a=n[Uc].keys();e.next=function(){let e=s.call(this);return!1===e.done&&(e.value=r(e.value,t,a.next().value,i)),e}}else e.next=function(){let e=s.call(this);return!1===e.done&&(e.value=r(e.value,t,e.value,i)),e};return e}(l,t,n,i,g):l}return Reflect.apply(t,n,s)}},y=c.getProxy(e,n.pathAsArray?[]:"",v);return t=t.bind(y),h&&(n.onValidate=n.onValidate.bind(y)),y};xh.target=e=>e&&e[Uc]||e,xh.unsubscribe=e=>e[jc]||e;var wh=xh,Sh="object"==typeof global&&global&&global.Object===Object&&global,_h="object"==typeof self&&self&&self.Object===Object&&self,Eh=Sh||_h||Function("return this")(),Ah=Eh.Symbol,Ch=Object.prototype,Mh=Ch.hasOwnProperty,Th=Ch.toString,Ph=Ah?Ah.toStringTag:void 0;var Dh=function(e){var t=Mh.call(e,Ph),n=e[Ph];try{e[Ph]=void 0;var i=!0}catch(s){}var r=Th.call(e);return i&&(t?e[Ph]=n:delete e[Ph]),r},Oh=Object.prototype.toString;var Ih=function(e){return Oh.call(e)},Rh=Ah?Ah.toStringTag:void 0;var kh=function(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":Rh&&Rh in Object(e)?Dh(e):Ih(e)};var Lh=function(e){return null!=e&&"object"==typeof e};var Bh=function(e){return"symbol"==typeof e||Lh(e)&&"[object Symbol]"==kh(e)};var zh=function(e,t){for(var n=-1,i=null==e?0:e.length,r=Array(i);++n<i;)r[n]=t(e[n],n,e);return r},Nh=Array.isArray,Fh=1/0,Uh=Ah?Ah.prototype:void 0,jh=Uh?Uh.toString:void 0;var Vh=function e(t){if("string"==typeof t)return t;if(Nh(t))return zh(t,e)+"";if(Bh(t))return jh?jh.call(t):"";var n=t+"";return"0"==n&&1/t==-Fh?"-0":n},Gh=/\s/;var Hh=function(e){for(var t=e.length;t--&&Gh.test(e.charAt(t)););return t},Wh=/^\s+/;var qh=function(e){return e&&e.slice(0,Hh(e)+1).replace(Wh,"")};var Xh=function(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)},Yh=/^[-+]0x[0-9a-f]+$/i,Qh=/^0b[01]+$/i,Kh=/^0o[0-7]+$/i,Zh=parseInt;var Jh=function(e){if("number"==typeof e)return e;if(Bh(e))return NaN;if(Xh(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=Xh(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=qh(e);var n=Qh.test(e);return n||Kh.test(e)?Zh(e.slice(2),n?2:8):Yh.test(e)?NaN:+e};var $h=function(e){return e};var eu=function(e){if(!Xh(e))return!1;var t=kh(e);return"[object Function]"==t||"[object GeneratorFunction]"==t||"[object AsyncFunction]"==t||"[object Proxy]"==t},tu=Eh["__core-js_shared__"],nu=function(){var e=/[^.]+$/.exec(tu&&tu.keys&&tu.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}();var iu=function(e){return!!nu&&nu in e},ru=Function.prototype.toString;var su=function(e){if(null!=e){try{return ru.call(e)}catch(t){}try{return e+""}catch(n){}}return""},au=/^\[object .+?Constructor\]$/,ou=Function.prototype,lu=Object.prototype,cu=ou.toString,hu=lu.hasOwnProperty,uu=RegExp("^"+cu.call(hu).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");var du=function(e){return!(!Xh(e)||iu(e))&&(eu(e)?uu:au).test(su(e))};var pu=function(e,t){return null===e||void 0===e?void 0:e[t]};var fu=function(e,t){var n=pu(e,t);return du(n)?n:void 0},mu=fu(Eh,"WeakMap"),gu=Object.create,vu=function(){function e(){}return function(t){if(!Xh(t))return{};if(gu)return gu(t);e.prototype=t;var n=new e;return e.prototype=void 0,n}}(),yu=vu;var bu=function(e,t,n){switch(n.length){case 0:return e.call(t);case 1:return e.call(t,n[0]);case 2:return e.call(t,n[0],n[1]);case 3:return e.call(t,n[0],n[1],n[2])}return e.apply(t,n)};var xu=function(e,t){var n=-1,i=e.length;for(t||(t=Array(i));++n<i;)t[n]=e[n];return t},wu=Date.now;var Su=function(e){var t=0,n=0;return function(){var i=wu(),r=16-(i-n);if(n=i,r>0){if(++t>=800)return arguments[0]}else t=0;return e.apply(void 0,arguments)}};var _u=function(e){return function(){return e}},Eu=function(){try{var e=fu(Object,"defineProperty");return e({},"",{}),e}catch(t){}}(),Au=Eu,Cu=Au?function(e,t){return Au(e,"toString",{configurable:!0,enumerable:!1,value:_u(t),writable:!0})}:$h,Mu=Su(Cu);var Tu=function(e,t){for(var n=-1,i=null==e?0:e.length;++n<i&&!1!==t(e[n],n,e););return e},Pu=/^(?:0|[1-9]\d*)$/;var Du=function(e,t){var n=typeof e;return!!(t=null!==t&&void 0!==t?t:9007199254740991)&&("number"==n||"symbol"!=n&&Pu.test(e))&&e>-1&&e%1==0&&e<t};var Ou=function(e,t,n){"__proto__"==t&&Au?Au(e,t,{configurable:!0,enumerable:!0,value:n,writable:!0}):e[t]=n};var Iu=function(e,t){return e===t||e!==e&&t!==t},Ru=Object.prototype.hasOwnProperty;var ku=function(e,t,n){var i=e[t];(!Ru.call(e,t)||!Iu(i,n)||void 0===n&&!(t in e))&&Ou(e,t,n)};var Lu=function(e,t,n,i){var r=!n;n||(n={});for(var s=-1,a=t.length;++s<a;){var o=t[s],l=i?i(n[o],e[o],o,n,e):void 0;void 0===l&&(l=e[o]),r?Ou(n,o,l):ku(n,o,l)}return n},Bu=Math.max;var zu=function(e,t,n){return t=Bu(void 0===t?e.length-1:t,0),function(){for(var i=arguments,r=-1,s=Bu(i.length-t,0),a=Array(s);++r<s;)a[r]=i[t+r];r=-1;for(var o=Array(t+1);++r<t;)o[r]=i[r];return o[t]=n(a),bu(e,this,o)}};var Nu=function(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=9007199254740991};var Fu=function(e){return null!=e&&Nu(e.length)&&!eu(e)},Uu=Object.prototype;var ju=function(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||Uu)};var Vu=function(e,t){for(var n=-1,i=Array(e);++n<e;)i[n]=t(n);return i};var Gu=function(e){return Lh(e)&&"[object Arguments]"==kh(e)},Hu=Object.prototype,Wu=Hu.hasOwnProperty,qu=Hu.propertyIsEnumerable,Xu=Gu(function(){return arguments}())?Gu:function(e){return Lh(e)&&Wu.call(e,"callee")&&!qu.call(e,"callee")},Yu=Xu;var Qu=function(){return!1},Ku="object"==typeof exports&&exports&&!exports.nodeType&&exports,Zu=Ku&&"object"==typeof module&&module&&!module.nodeType&&module,Ju=Zu&&Zu.exports===Ku?Eh.Buffer:void 0,$u=(Ju?Ju.isBuffer:void 0)||Qu,ed={};ed["[object Float32Array]"]=ed["[object Float64Array]"]=ed["[object Int8Array]"]=ed["[object Int16Array]"]=ed["[object Int32Array]"]=ed["[object Uint8Array]"]=ed["[object Uint8ClampedArray]"]=ed["[object Uint16Array]"]=ed["[object Uint32Array]"]=!0,ed["[object Arguments]"]=ed["[object Array]"]=ed["[object ArrayBuffer]"]=ed["[object Boolean]"]=ed["[object DataView]"]=ed["[object Date]"]=ed["[object Error]"]=ed["[object Function]"]=ed["[object Map]"]=ed["[object Number]"]=ed["[object Object]"]=ed["[object RegExp]"]=ed["[object Set]"]=ed["[object String]"]=ed["[object WeakMap]"]=!1;var td=function(e){return Lh(e)&&Nu(e.length)&&!!ed[kh(e)]};var nd=function(e){return function(t){return e(t)}},id="object"==typeof exports&&exports&&!exports.nodeType&&exports,rd=id&&"object"==typeof module&&module&&!module.nodeType&&module,sd=rd&&rd.exports===id&&Sh.process,ad=function(){try{return rd&&rd.require&&rd.require("util").types||sd&&sd.binding&&sd.binding("util")}catch(e){}}(),od=ad&&ad.isTypedArray,ld=od?nd(od):td,cd=Object.prototype.hasOwnProperty;var hd=function(e,t){var n=Nh(e),i=!n&&Yu(e),r=!n&&!i&&$u(e),s=!n&&!i&&!r&&ld(e),a=n||i||r||s,o=a?Vu(e.length,String):[],l=o.length;for(var c in e)(t||cd.call(e,c))&&(!a||!("length"==c||r&&("offset"==c||"parent"==c)||s&&("buffer"==c||"byteLength"==c||"byteOffset"==c)||Du(c,l)))&&o.push(c);return o};var ud=function(e,t){return function(n){return e(t(n))}},dd=ud(Object.keys,Object),pd=Object.prototype.hasOwnProperty;var fd=function(e){if(!ju(e))return dd(e);var t=[];for(var n in Object(e))pd.call(e,n)&&"constructor"!=n&&t.push(n);return t};var md=function(e){return Fu(e)?hd(e):fd(e)};var gd=function(e){var t=[];if(null!=e)for(var n in Object(e))t.push(n);return t},vd=Object.prototype.hasOwnProperty;var yd=function(e){if(!Xh(e))return gd(e);var t=ju(e),n=[];for(var i in e)"constructor"==i&&(t||!vd.call(e,i))||n.push(i);return n};var bd=function(e){return Fu(e)?hd(e,!0):yd(e)},xd=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,wd=/^\w*$/;var Sd=function(e,t){if(Nh(e))return!1;var n=typeof e;return!("number"!=n&&"symbol"!=n&&"boolean"!=n&&null!=e&&!Bh(e))||(wd.test(e)||!xd.test(e)||null!=t&&e in Object(t))},_d=fu(Object,"create");var Ed=function(){this.__data__=_d?_d(null):{},this.size=0};var Ad=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t},Cd=Object.prototype.hasOwnProperty;var Md=function(e){var t=this.__data__;if(_d){var n=t[e];return"__lodash_hash_undefined__"===n?void 0:n}return Cd.call(t,e)?t[e]:void 0},Td=Object.prototype.hasOwnProperty;var Pd=function(e){var t=this.__data__;return _d?void 0!==t[e]:Td.call(t,e)};var Dd=function(e,t){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=_d&&void 0===t?"__lodash_hash_undefined__":t,this};function Od(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var i=e[t];this.set(i[0],i[1])}}Od.prototype.clear=Ed,Od.prototype.delete=Ad,Od.prototype.get=Md,Od.prototype.has=Pd,Od.prototype.set=Dd;var Id=Od;var Rd=function(){this.__data__=[],this.size=0};var kd=function(e,t){for(var n=e.length;n--;)if(Iu(e[n][0],t))return n;return-1},Ld=Array.prototype.splice;var Bd=function(e){var t=this.__data__,n=kd(t,e);return!(n<0)&&(n==t.length-1?t.pop():Ld.call(t,n,1),--this.size,!0)};var zd=function(e){var t=this.__data__,n=kd(t,e);return n<0?void 0:t[n][1]};var Nd=function(e){return kd(this.__data__,e)>-1};var Fd=function(e,t){var n=this.__data__,i=kd(n,e);return i<0?(++this.size,n.push([e,t])):n[i][1]=t,this};function Ud(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var i=e[t];this.set(i[0],i[1])}}Ud.prototype.clear=Rd,Ud.prototype.delete=Bd,Ud.prototype.get=zd,Ud.prototype.has=Nd,Ud.prototype.set=Fd;var jd=Ud,Vd=fu(Eh,"Map");var Gd=function(){this.size=0,this.__data__={hash:new Id,map:new(Vd||jd),string:new Id}};var Hd=function(e){var t=typeof e;return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e};var Wd=function(e,t){var n=e.__data__;return Hd(t)?n["string"==typeof t?"string":"hash"]:n.map};var qd=function(e){var t=Wd(this,e).delete(e);return this.size-=t?1:0,t};var Xd=function(e){return Wd(this,e).get(e)};var Yd=function(e){return Wd(this,e).has(e)};var Qd=function(e,t){var n=Wd(this,e),i=n.size;return n.set(e,t),this.size+=n.size==i?0:1,this};function Kd(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var i=e[t];this.set(i[0],i[1])}}Kd.prototype.clear=Gd,Kd.prototype.delete=qd,Kd.prototype.get=Xd,Kd.prototype.has=Yd,Kd.prototype.set=Qd;var Zd=Kd;function Jd(e,t){if("function"!=typeof e||null!=t&&"function"!=typeof t)throw new TypeError("Expected a function");var n=function(){var i=arguments,r=t?t.apply(this,i):i[0],s=n.cache;if(s.has(r))return s.get(r);var a=e.apply(this,i);return n.cache=s.set(r,a)||s,a};return n.cache=new(Jd.Cache||Zd),n}Jd.Cache=Zd;var $d=Jd;var ep=function(e){var t=$d(e,(function(e){return 500===n.size&&n.clear(),e})),n=t.cache;return t},tp=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,np=/\\(\\)?/g,ip=ep((function(e){var t=[];return 46===e.charCodeAt(0)&&t.push(""),e.replace(tp,(function(e,n,i,r){t.push(i?r.replace(np,"$1"):n||e)})),t})),rp=ip;var sp=function(e){return null==e?"":Vh(e)};var ap=function(e,t){return Nh(e)?e:Sd(e,t)?[e]:rp(sp(e))},op=1/0;var lp=function(e){if("string"==typeof e||Bh(e))return e;var t=e+"";return"0"==t&&1/e==-op?"-0":t};var cp=function(e,t){for(var n=0,i=(t=ap(t,e)).length;null!=e&&n<i;)e=e[lp(t[n++])];return n&&n==i?e:void 0};var hp=function(e,t){for(var n=-1,i=t.length,r=e.length;++n<i;)e[r+n]=t[n];return e},up=Ah?Ah.isConcatSpreadable:void 0;var dp=function(e){return Nh(e)||Yu(e)||!!(up&&e&&e[up])};var pp=function e(t,n,i,r,s){var a=-1,o=t.length;for(i||(i=dp),s||(s=[]);++a<o;){var l=t[a];n>0&&i(l)?n>1?e(l,n-1,i,r,s):hp(s,l):r||(s[s.length]=l)}return s};var fp=function(e){return(null==e?0:e.length)?pp(e,1):[]};var mp=function(e){return Mu(zu(e,void 0,fp),e+"")},gp=ud(Object.getPrototypeOf,Object),vp=Function.prototype,yp=Object.prototype,bp=vp.toString,xp=yp.hasOwnProperty,wp=bp.call(Object);var Sp=function(e){if(!Lh(e)||"[object Object]"!=kh(e))return!1;var t=gp(e);if(null===t)return!0;var n=xp.call(t,"constructor")&&t.constructor;return"function"==typeof n&&n instanceof n&&bp.call(n)==wp};var _p=function(e,t,n){var i=-1,r=e.length;t<0&&(t=-t>r?0:r+t),(n=n>r?r:n)<0&&(n+=r),r=t>n?0:n-t>>>0,t>>>=0;for(var s=Array(r);++i<r;)s[i]=e[i+t];return s};var Ep=function(){this.__data__=new jd,this.size=0};var Ap=function(e){var t=this.__data__,n=t.delete(e);return this.size=t.size,n};var Cp=function(e){return this.__data__.get(e)};var Mp=function(e){return this.__data__.has(e)};var Tp=function(e,t){var n=this.__data__;if(n instanceof jd){var i=n.__data__;if(!Vd||i.length<199)return i.push([e,t]),this.size=++n.size,this;n=this.__data__=new Zd(i)}return n.set(e,t),this.size=n.size,this};function Pp(e){var t=this.__data__=new jd(e);this.size=t.size}Pp.prototype.clear=Ep,Pp.prototype.delete=Ap,Pp.prototype.get=Cp,Pp.prototype.has=Mp,Pp.prototype.set=Tp;var Dp=Pp;var Op=function(e,t){return e&&Lu(t,md(t),e)};var Ip=function(e,t){return e&&Lu(t,bd(t),e)},Rp="object"==typeof exports&&exports&&!exports.nodeType&&exports,kp=Rp&&"object"==typeof module&&module&&!module.nodeType&&module,Lp=kp&&kp.exports===Rp?Eh.Buffer:void 0,Bp=Lp?Lp.allocUnsafe:void 0;var zp=function(e,t){if(t)return e.slice();var n=e.length,i=Bp?Bp(n):new e.constructor(n);return e.copy(i),i};var Np=function(e,t){for(var n=-1,i=null==e?0:e.length,r=0,s=[];++n<i;){var a=e[n];t(a,n,e)&&(s[r++]=a)}return s};var Fp=function(){return[]},Up=Object.prototype.propertyIsEnumerable,jp=Object.getOwnPropertySymbols,Vp=jp?function(e){return null==e?[]:(e=Object(e),Np(jp(e),(function(t){return Up.call(e,t)})))}:Fp,Gp=Vp;var Hp=function(e,t){return Lu(e,Gp(e),t)},Wp=Object.getOwnPropertySymbols?function(e){for(var t=[];e;)hp(t,Gp(e)),e=gp(e);return t}:Fp,qp=Wp;var Xp=function(e,t){return Lu(e,qp(e),t)};var Yp=function(e,t,n){var i=t(e);return Nh(e)?i:hp(i,n(e))};var Qp=function(e){return Yp(e,md,Gp)};var Kp=function(e){return Yp(e,bd,qp)},Zp=fu(Eh,"DataView"),Jp=fu(Eh,"Promise"),$p=fu(Eh,"Set"),ef="[object Map]",tf="[object Promise]",nf="[object Set]",rf="[object WeakMap]",sf="[object DataView]",af=su(Zp),of=su(Vd),lf=su(Jp),cf=su($p),hf=su(mu),uf=kh;(Zp&&uf(new Zp(new ArrayBuffer(1)))!=sf||Vd&&uf(new Vd)!=ef||Jp&&uf(Jp.resolve())!=tf||$p&&uf(new $p)!=nf||mu&&uf(new mu)!=rf)&&(uf=function(e){var t=kh(e),n="[object Object]"==t?e.constructor:void 0,i=n?su(n):"";if(i)switch(i){case af:return sf;case of:return ef;case lf:return tf;case cf:return nf;case hf:return rf}return t});var df=uf,pf=Object.prototype.hasOwnProperty;var ff=function(e){var t=e.length,n=new e.constructor(t);return t&&"string"==typeof e[0]&&pf.call(e,"index")&&(n.index=e.index,n.input=e.input),n},mf=Eh.Uint8Array;var gf=function(e){var t=new e.constructor(e.byteLength);return new mf(t).set(new mf(e)),t};var vf=function(e,t){var n=t?gf(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.byteLength)},yf=/\w*$/;var bf=function(e){var t=new e.constructor(e.source,yf.exec(e));return t.lastIndex=e.lastIndex,t},xf=Ah?Ah.prototype:void 0,wf=xf?xf.valueOf:void 0;var Sf=function(e){return wf?Object(wf.call(e)):{}};var _f=function(e,t){var n=t?gf(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.length)};var Ef=function(e,t,n){var i=e.constructor;switch(t){case"[object ArrayBuffer]":return gf(e);case"[object Boolean]":case"[object Date]":return new i(+e);case"[object DataView]":return vf(e,n);case"[object Float32Array]":case"[object Float64Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":return _f(e,n);case"[object Map]":case"[object Set]":return new i;case"[object Number]":case"[object String]":return new i(e);case"[object RegExp]":return bf(e);case"[object Symbol]":return Sf(e)}};var Af=function(e){return"function"!=typeof e.constructor||ju(e)?{}:yu(gp(e))};var Cf=function(e){return Lh(e)&&"[object Map]"==df(e)},Mf=ad&&ad.isMap,Tf=Mf?nd(Mf):Cf;var Pf=function(e){return Lh(e)&&"[object Set]"==df(e)},Df=ad&&ad.isSet,Of=Df?nd(Df):Pf,If="[object Arguments]",Rf="[object Function]",kf="[object Object]",Lf={};Lf[If]=Lf["[object Array]"]=Lf["[object ArrayBuffer]"]=Lf["[object DataView]"]=Lf["[object Boolean]"]=Lf["[object Date]"]=Lf["[object Float32Array]"]=Lf["[object Float64Array]"]=Lf["[object Int8Array]"]=Lf["[object Int16Array]"]=Lf["[object Int32Array]"]=Lf["[object Map]"]=Lf["[object Number]"]=Lf[kf]=Lf["[object RegExp]"]=Lf["[object Set]"]=Lf["[object String]"]=Lf["[object Symbol]"]=Lf["[object Uint8Array]"]=Lf["[object Uint8ClampedArray]"]=Lf["[object Uint16Array]"]=Lf["[object Uint32Array]"]=!0,Lf["[object Error]"]=Lf[Rf]=Lf["[object WeakMap]"]=!1;var Bf=function e(t,n,i,r,s,a){var o,l=1&n,c=2&n,h=4&n;if(i&&(o=s?i(t,r,s,a):i(t)),void 0!==o)return o;if(!Xh(t))return t;var u=Nh(t);if(u){if(o=ff(t),!l)return xu(t,o)}else{var d=df(t),p=d==Rf||"[object GeneratorFunction]"==d;if($u(t))return zp(t,l);if(d==kf||d==If||p&&!s){if(o=c||p?{}:Af(t),!l)return c?Xp(t,Ip(o,t)):Hp(t,Op(o,t))}else{if(!Lf[d])return s?t:{};o=Ef(t,d,l)}}a||(a=new Dp);var f=a.get(t);if(f)return f;a.set(t,o),Of(t)?t.forEach((function(r){o.add(e(r,n,i,r,t,a))})):Tf(t)&&t.forEach((function(r,s){o.set(s,e(r,n,i,s,t,a))}));var m=u?void 0:(h?c?Kp:Qp:c?bd:md)(t);return Tu(m||t,(function(r,s){m&&(r=t[s=r]),ku(o,s,e(r,n,i,s,t,a))})),o};var zf=function(e){return Bf(e,5)};var Nf=function(e){return this.__data__.set(e,"__lodash_hash_undefined__"),this};var Ff=function(e){return this.__data__.has(e)};function Uf(e){var t=-1,n=null==e?0:e.length;for(this.__data__=new Zd;++t<n;)this.add(e[t])}Uf.prototype.add=Uf.prototype.push=Nf,Uf.prototype.has=Ff;var jf=Uf;var Vf=function(e,t){for(var n=-1,i=null==e?0:e.length;++n<i;)if(t(e[n],n,e))return!0;return!1};var Gf=function(e,t){return e.has(t)};var Hf=function(e,t,n,i,r,s){var a=1&n,o=e.length,l=t.length;if(o!=l&&!(a&&l>o))return!1;var c=s.get(e),h=s.get(t);if(c&&h)return c==t&&h==e;var u=-1,d=!0,p=2&n?new jf:void 0;for(s.set(e,t),s.set(t,e);++u<o;){var f=e[u],m=t[u];if(i)var g=a?i(m,f,u,t,e,s):i(f,m,u,e,t,s);if(void 0!==g){if(g)continue;d=!1;break}if(p){if(!Vf(t,(function(e,t){if(!Gf(p,t)&&(f===e||r(f,e,n,i,s)))return p.push(t)}))){d=!1;break}}else if(f!==m&&!r(f,m,n,i,s)){d=!1;break}}return s.delete(e),s.delete(t),d};var Wf=function(e){var t=-1,n=Array(e.size);return e.forEach((function(e,i){n[++t]=[i,e]})),n};var qf=function(e){var t=-1,n=Array(e.size);return e.forEach((function(e){n[++t]=e})),n},Xf=Ah?Ah.prototype:void 0,Yf=Xf?Xf.valueOf:void 0;var Qf=function(e,t,n,i,r,s,a){switch(n){case"[object DataView]":if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case"[object ArrayBuffer]":return!(e.byteLength!=t.byteLength||!s(new mf(e),new mf(t)));case"[object Boolean]":case"[object Date]":case"[object Number]":return Iu(+e,+t);case"[object Error]":return e.name==t.name&&e.message==t.message;case"[object RegExp]":case"[object String]":return e==t+"";case"[object Map]":var o=Wf;case"[object Set]":var l=1&i;if(o||(o=qf),e.size!=t.size&&!l)return!1;var c=a.get(e);if(c)return c==t;i|=2,a.set(e,t);var h=Hf(o(e),o(t),i,r,s,a);return a.delete(e),h;case"[object Symbol]":if(Yf)return Yf.call(e)==Yf.call(t)}return!1},Kf=Object.prototype.hasOwnProperty;var Zf=function(e,t,n,i,r,s){var a=1&n,o=Qp(e),l=o.length;if(l!=Qp(t).length&&!a)return!1;for(var c=l;c--;){var h=o[c];if(!(a?h in t:Kf.call(t,h)))return!1}var u=s.get(e),d=s.get(t);if(u&&d)return u==t&&d==e;var p=!0;s.set(e,t),s.set(t,e);for(var f=a;++c<l;){var m=e[h=o[c]],g=t[h];if(i)var v=a?i(g,m,h,t,e,s):i(m,g,h,e,t,s);if(!(void 0===v?m===g||r(m,g,n,i,s):v)){p=!1;break}f||(f="constructor"==h)}if(p&&!f){var y=e.constructor,b=t.constructor;y!=b&&"constructor"in e&&"constructor"in t&&!("function"==typeof y&&y instanceof y&&"function"==typeof b&&b instanceof b)&&(p=!1)}return s.delete(e),s.delete(t),p},Jf="[object Arguments]",$f="[object Array]",em="[object Object]",tm=Object.prototype.hasOwnProperty;var nm=function(e,t,n,i,r,s){var a=Nh(e),o=Nh(t),l=a?$f:df(e),c=o?$f:df(t),h=(l=l==Jf?em:l)==em,u=(c=c==Jf?em:c)==em,d=l==c;if(d&&$u(e)){if(!$u(t))return!1;a=!0,h=!1}if(d&&!h)return s||(s=new Dp),a||ld(e)?Hf(e,t,n,i,r,s):Qf(e,t,l,n,i,r,s);if(!(1&n)){var p=h&&tm.call(e,"__wrapped__"),f=u&&tm.call(t,"__wrapped__");if(p||f){var m=p?e.value():e,g=f?t.value():t;return s||(s=new Dp),r(m,g,n,i,s)}}return!!d&&(s||(s=new Dp),Zf(e,t,n,i,r,s))};var im=function e(t,n,i,r,s){return t===n||(null==t||null==n||!Lh(t)&&!Lh(n)?t!==t&&n!==n:nm(t,n,i,r,e,s))};var rm=function(e,t){return null!=e&&t in Object(e)};var sm=function(e,t,n){for(var i=-1,r=(t=ap(t,e)).length,s=!1;++i<r;){var a=lp(t[i]);if(!(s=null!=e&&n(e,a)))break;e=e[a]}return s||++i!=r?s:!!(r=null==e?0:e.length)&&Nu(r)&&Du(a,r)&&(Nh(e)||Yu(e))};var am=function(e,t){return null!=e&&sm(e,t,rm)},om=function(){return Eh.Date.now()},lm=Math.max,cm=Math.min;var hm=function(e,t,n){var i,r,s,a,o,l,c=0,h=!1,u=!1,d=!0;if("function"!=typeof e)throw new TypeError("Expected a function");function p(t){var n=i,s=r;return i=r=void 0,c=t,a=e.apply(s,n)}function f(e){var n=e-l;return void 0===l||n>=t||n<0||u&&e-c>=s}function m(){var e=om();if(f(e))return g(e);o=setTimeout(m,function(e){var n=t-(e-l);return u?cm(n,s-(e-c)):n}(e))}function g(e){return o=void 0,d&&i?p(e):(i=r=void 0,a)}function v(){var e=om(),n=f(e);if(i=arguments,r=this,l=e,n){if(void 0===o)return function(e){return c=e,o=setTimeout(m,t),h?p(e):a}(l);if(u)return clearTimeout(o),o=setTimeout(m,t),p(l)}return void 0===o&&(o=setTimeout(m,t)),a}return t=Jh(t)||0,Xh(n)&&(h=!!n.leading,s=(u="maxWait"in n)?lm(Jh(n.maxWait)||0,t):s,d="trailing"in n?!!n.trailing:d),v.cancel=function(){void 0!==o&&clearTimeout(o),c=0,i=l=r=o=void 0},v.flush=function(){return void 0===o?a:g(om())},v};var um=function(e){var t=null==e?0:e.length;return t?e[t-1]:void 0};var dm=function(e,t){return e>t};var pm=function(e,t){return t.length<2?e:cp(e,_p(t,0,-1))};var fm=function(e,t){return im(e,t)};var mm=function(e,t,n){for(var i=-1,r=e.length;++i<r;){var s=e[i],a=t(s);if(null!=a&&(void 0===o?a===a&&!Bh(a):n(a,o)))var o=a,l=s}return l};var gm=function(e){return e&&e.length?mm(e,$h,dm):void 0};var vm=function(e,t){return t=ap(t,e),null==(e=pm(e,t))||delete e[lp(um(t))]};var ym=function(e){return Sp(e)?void 0:e},bm=mp((function(e,t){var n={};if(null==e)return n;var i=!1;t=zh(t,(function(t){return t=ap(t,e),i||(i=t.length>1),t})),Lu(e,Kp(e),n),i&&(n=Bf(n,7,ym));for(var r=t.length;r--;)vm(n,t[r]);return n})),xm=bm;var wm=function(e,t,n,i){if(!Xh(e))return e;for(var r=-1,s=(t=ap(t,e)).length,a=s-1,o=e;null!=o&&++r<s;){var l=lp(t[r]),c=n;if("__proto__"===l||"constructor"===l||"prototype"===l)return e;if(r!=a){var h=o[l];void 0===(c=i?i(h,l,o):void 0)&&(c=Xh(h)?h:Du(t[r+1])?[]:{})}ku(o,l,c),o=o[l]}return e};var Sm=function(e,t,n){for(var i=-1,r=t.length,s={};++i<r;){var a=t[i],o=cp(e,a);n(o,a)&&wm(s,ap(a,e),o)}return s};var _m=function(e,t){return Sm(e,t,(function(t,n){return am(e,n)}))},Em=mp((function(e,t){return null==e?{}:_m(e,t)})),Am=Em;var Cm=function(e,t,n){var i=!0,r=!0;if("function"!=typeof e)throw new TypeError("Expected a function");return Xh(n)&&(i="leading"in n?!!n.leading:i,r="trailing"in n?!!n.trailing:r),hm(e,t,{leading:i,maxWait:t,trailing:r})};function Mm(e){for(let t of Object.keys(e))void 0===e[t]&&delete e[t];return e}function Tm(e,t){return Object.setPrototypeOf(e,t),e}var Pm=!(typeof window>"u")&&window.navigator.userAgent.toLowerCase().includes(" electron/"),Dm=(Pm&&(()=>{var e;if(typeof window>"u")return;let t=new URLSearchParams(window.location.search).get("desktop-app-version");t?window.localStorage.setItem("desktop-app-version",t):e=window.localStorage.getItem("desktop-app-version")})(),!(typeof window>"u")&&window.navigator.platform.toUpperCase().includes("MAC")),Om=!(typeof window>"u")&&(/iPad|iPhone|iPod/.test(window.navigator.userAgent)||Dm&&"ontouchend"in document),Im=!(typeof window>"u")&&window.navigator.userAgent.toLowerCase().indexOf("firefox")>-1,Rm=!(typeof window>"u")&&("ontouchstart"in window||navigator.maxTouchPoints>0),km=(()=>{if(typeof window>"u")return!1;let e=navigator.userAgent,t=navigator.vendor;return/Safari/i.test(e)&&/Apple Computer/.test(t)})(),Lm=Number((()=>{if(typeof window>"u")return null;let e=navigator.userAgent.match(/Version\/(\d+\.\d)/);return e&&e[1]})());function Bm(e){return Array.isArray(e)?e:[e]}function zm(e,t){let n=0;for(;n<e.length&&n<t.length;){if(e[n]<t[n])return-1;if(e[n]>t[n])return 1;n+=1}return n!==t.length?-1:n!==e.length?1:0}function Nm(e){return Dm?e.metaKey:e.ctrlKey}var Fm=[],Um={},jm={},Vm={};function Gm(e){Fm.includes(e)||Fm.push(e)}function Hm(e){delete Um[e.pointerId];for(let t=0;t<Fm.length;t++)if(Fm[t].pointerId===e.pointerId){Fm.splice(t,1);break}}function Wm(e){if("touch"!==e.pointerType)return;let t=Um[e.pointerId];void 0===t&&(t={x:0,y:0},Um[e.pointerId]=t),t.x=e.pageX,t.y=e.pageY}function qm(e){let t=e.pointerId===Fm[0].pointerId?Fm[1]:Fm[0];return Um[t.pointerId]}function Xm(e){jm[e.key]=!0,Vm[e.key]=void 0===Vm[e.key]?1:Vm[e.key]+1}function Ym(e){if(Dm&&jm.Meta)for(let t in jm)jm[t]=!1;else jm[e.key]=!1;Vm={}}var Qm,Km,Zm=new Promise((e=>{Qm=e}));function Jm(){if(Km)return Km;return Km=async function(){let e=n.e(208).then(n.bind(n,208)),[t,i]=await Promise.all([e,fetch("".concat("https://unpkg.com/@splinetool/navmesh-wasm@1.9.63/build","/navmesh.wasm")).then((e=>e.arrayBuffer()))]),r=t.default,s=await r({wasmBinary:i});Qm(s)}(),Km}var $m,eg,tg=new Promise((e=>{$m=e}));function ng(){if(eg)return eg;return eg=async function(){let e=await n.e(293).then(n.bind(n,293));await e.init(),$m(e)}(),eg}var ig=class{modifyById(e,t){let n=this;if(void 0===n[e])throw new Error("not expected");{let i=o(o({},n),{},{[e]:t});return Object.setPrototypeOf(i,ig.prototype),i}}add(e,t){var n,i;return null!==(n=null===(i=this.runOp({type:1,id:e,data:t}))||void 0===i?void 0:i.data)&&void 0!==n?n:this}runOp(e){let t=this;if(1===e.type){let n,i=t[e.id];n=void 0===i?{type:2,id:e.id}:{type:1,id:e.id,data:i};let{id:r,data:s}=e,a=o(o({},t),{},{[r]:s});return Object.setPrototypeOf(a,ig.prototype),{data:a,actual:e,reverse:n}}if(2===e.type){let{id:n}=e,i=t[n];if(void 0===i)return null;{let r=o({},t);return Object.setPrototypeOf(r,ig.prototype),delete r[n],{data:r,actual:e,reverse:{type:1,id:n,data:i}}}}return null}};function rg(e){if(void 0!==e.deepFreeze)return void e.deepFreeze(e);let t=Object.getOwnPropertyNames(e);for(let n of t){let t=e[n];t&&"object"==typeof t&&rg(t)}return Object.freeze(e)}var sg=class extends Error{};function ag(e){let t=o({},e);return Object.setPrototypeOf(t,Object.getPrototypeOf(e)),t}function og(e,t,n){if(void 0===e?void 0===t?(e=0,t=10):e=t-10:void 0===t&&(t=e+10),e>t){let n=e;e=t,t=n}let i=[],r=1/(n+1);for(let s=0;s<n;s++){let n=e+(t-e)*(s+.75+.5*Math.random())*r;i.push(n)}return i}function lg(e){return e instanceof Uint8Array||e instanceof Uint16Array||e instanceof Uint32Array||e instanceof Int8Array||e instanceof Int16Array||e instanceof Int32Array||e instanceof Float32Array||e instanceof Float64Array}function cg(e,t){for(let n of e)!0!==t(n.id,n.data)&&cg(n.children,t)}function hg(e,t){if(!0!==t(e.id,e.data))for(let n of e.children)hg(n,t)}var ug,dg=class extends Array{constructor(){super(...arguments),Object.setPrototypeOf(this,dg.prototype)}deepFreeze(){let e=0;for(;e<this.length;)rg(this[e]),e++}fillCaches0(e,t){this.objCaches.set(e.id,e),this.parentCaches.set(e.id,t);for(let n of e.children)this.fillCaches0(n,e.id)}fillCaches(){if(void 0===this.objCaches){this.objCaches=new Map,this.parentCaches=new Map;for(let e of this)this.fillCaches0(e,null)}}randomId(){this.fillCaches();let e=Array.from(this.objCaches.keys());if(0!==e.length)return e[Math.max(0,Math.floor(Math.random()*e.length)-1)]}nonExistOrDescendantOf(e,t){if(!this.has(e))return!0;for(;e;){let n=this.parent(e);if(n===t)return!0;e=n}return!1}rootAcestor(e){for(;e;){let t=this.parent(e);if(!t)return e;e=t}return e}isDescendantOf(e,t){for(;e;){let n=this.parent(e);if(n===t)return!0;e=n}return!1}data(e){var t;return null===(t=this.get(e))||void 0===t?void 0:t.data}has(e){return void 0!==this.childrenOf(e)}get(e){return this.fillCaches(),this.objCaches.get(e)}childrenOf(e){var t;return null===e?this:null===(t=this.get(e))||void 0===t?void 0:t.children}traverseFrom(e,t){if(null===e)this.traverse(t);else{let n=this.get(e);n&&hg(n,t)}}traverse(e){cg(this,e)}totalSize(){return this.fillCaches(),this.objCaches.size}parent(e){return this.fillCaches(),this.parentCaches.get(e)}childrenArray(e){return null===e?this:this.get(e).children}modifyById(e,t){if(void 0===this.get(e))throw new Error("not expected");{let n=this.parent(e),i=this.childrenArray(n),r=i.findIndex((t=>t.id===e));if(r<0)throw new Error("not expected");let s=i[r];return i=[...i],i[r]=o(o({},s),{},{data:t}),this.modifyArrayBy(n,i)}}modifyArrayBy(e,t){let n=e,i=t;for(;null!==n;){let e=i,t=n;if(n=this.parent(n),void 0===n)throw new Error;i=this.childrenArray(n);let r=i.findIndex((e=>e.id===t));if(r<0)throw new Error;i=[...i],i[r]=o(o({},i[r]),{},{children:e})}Object.setPrototypeOf(i,dg.prototype);let r=i;return r.fillCaches(),r}runOp(e){switch(e.type){case 7:return this.addOp(e);case 8:return this.deleteOp(e);case 9:return this.moveOp(e)}return null}checkDuplicatedIdRec(e){let{id:t,children:n}=e;if(void 0!==this.get(t))return!0;for(let i of n)if(this.checkDuplicatedIdRec(i))return!0;return!1}addOp(e){let{parent:t,fi:n,id:i,data:r,children:s}=e;if(null!==t&&void 0===this.get(t))return null;if(this.checkDuplicatedIdRec(e))return null;{let a=t,o=this.childrenArray(a),l={fi:n,id:i,data:r,children:s};return o=[...o,l],o.sort(((e,t)=>e.fi-t.fi)),e.localIndex=o.indexOf(l),{data:this.modifyArrayBy(a,o),actual:e,reverse:{type:8,id:i}}}}deleteOp(e){let{id:t}=e;if(null===this.get(t))return null;{let n=this.parent(t);if(void 0===n)return null;let i=this.childrenArray(n),r=i.findIndex((e=>e.id===t));e.localIndex=r,i=[...i];let s=i.splice(r,1)[0];return{data:this.modifyArrayBy(n,i),actual:e,reverse:o(o({type:7},s),{},{parent:n})}}}moveOp(e){let{parent:t,fi:n,id:i}=e;if(null!==t&&void 0===this.get(t))return this.deleteOp({type:8,id:i});if(null!==t){let e=t;for(;null!==e;){if(void 0===e)throw new Error;if(e===i)throw new sg("cyclic tree");e=this.parent(e)}}let r=this.parent(i);if(void 0===r)return null;let s=r,a=this.childrenArray(r),l=a.findIndex((e=>e.id===i));a=[...a];let c=a.splice(l,1)[0],h=this.modifyArrayBy(r,a);r=t,a=h.childrenArray(r);let u=c.fi;return c=o(o({},c),{},{fi:n}),a=[...a,c],a.sort(((e,t)=>e.fi-t.fi)),e.localIndex=a.indexOf(c),h=h.modifyArrayBy(r,a),{data:h,actual:e,reverse:{type:9,parent:s,fi:u,id:i}}}previous(e,t){if(null===t){let t=this.childrenArray(e);return 0===t.length?null:t[t.length-1].id}let n=null;for(let i of this.childrenArray(e)){if(i.id===t)return n;n=i.id}return null}traverseSortNext(e){let t=this.parent(e);if(void 0!==t){let n=this.childrenArray(t),i=n.findIndex((t=>t.id===e))+1;if(i<n.length)return n[i].id;if(t)return this.traverseSortNext(t)}}sortNext(e){let t=this.childrenArray(e);return t.length>0?t[0].id:this.traverseSortNext(e)}traverseSortPrevious(e){let t=this.childrenArray(e);return t.length>0?this.traverseSortPrevious(t[t.length-1].id):e}sortPrevious(e){let t=this.parent(e);if(void 0!==t){let n=this.childrenArray(t),i=n.findIndex((t=>t.id===e))-1;return i>=0?this.traverseSortPrevious(n[i].id):t}}getAllSorted(e){let t=[];for(let n of e){let e=this.getWithSortKey(n.id);void 0!==e&&t.push(o(o({},n),e))}t.sort(((e,t)=>function(e,t){let n=0;for(;n<e.length&&n<t.length;){if(e[n]<t[n])return-1;if(e[n]>t[n])return 1;n+=1}return n!==t.length?-1:n!==e.length?1:0}(e.sortKey,t.sortKey)));for(let n of t)delete n.sortKey;return t}getWithSortKey(e){var t=e;let n=[],i=this.get(t),r=i;if(void 0!==i){for(;t;)n.splice(0,0,i.fi),null!==(t=this.parent(t))&&(i=this.get(t));return o(o({},r),{},{sortKey:n})}}insertBeforeHelper(e,t,n){return this.insertAfterHelper(e,this.previous(e,t),n)}insertAfterHelper(e,t,n){let i=this.childrenArray(e);if(null===t){if(0===i.length)return og(0,n,n);{let e=i[0].fi;return og(e-n,e,n)}}{let r=this.get(t);if(void 0===r||this.parent(t)!==e)throw new Error("illegal args");let s=i.find((e=>e.fi>r.fi));if(void 0===s){let e=i[i.length-1].fi;return og(e,e+n,n)}return og(r.fi,s.fi,n)}}};(e=>{e.runOp=function(e,t){if(0!==t.type)return null;if(Array.isArray(e)){let n=t.props,i={},r=[...e],s=!1;if(n)for(let e of Object.keys(n)){let t=parseInt(e);if(isNaN(t))throw new Error("wrong index");i[e]=r[t],r[t]=n[e],s=!0}return s?{data:r,actual:t,reverse:{type:0,props:i}}:null}{let n=t.props,i={},r=o({},e),s=!1;if(n)for(let e of Object.keys(n)){i[e]=r[e];let t=n[e];void 0===t?delete r[e]:r[e]=t,s=!0}return s?{data:r,actual:t,reverse:{type:0,props:i}}:null}}})(ug||(ug={}));var pg=class extends Array{constructor(){super(...arguments),Object.setPrototypeOf(this,pg.prototype)}deepFreeze(){let e=0;for(;e<this.length;)rg(this[e]),e++}fillCaches0(e){this.objCaches.set(e.id,e)}fillCaches(){if(void 0===this.objCaches){this.objCaches=new Map,Object.getOwnPropertyDescriptor(this,"objCaches").enumerable=!1;for(let e of this)this.fillCaches0(e)}}randomId(){this.fillCaches();let e=Array.from(this.objCaches.keys());if(0!==e.length)return e[Math.max(0,Math.floor(Math.random()*e.length)-1)]}data(e){var t;return null===(t=this.get(e))||void 0===t?void 0:t.data}get(e){return this.fillCaches(),this.objCaches.get(e)}modifyById(e,t){if(void 0===this.get(e))throw new Error("not expected");{let n=this,i=n.findIndex((t=>t.id===e));if(i<0)throw new Error("not expected");let r=n[i];return n=[...n],n[i]=o(o({},r),{},{data:t}),this.modifyArrayBy(n)}}modifyArrayBy(e){Object.setPrototypeOf(e,pg.prototype);let t=e;return typeof process<"u"||t.fillCaches(),t}runOp(e){switch(e.type){case 4:return this.addOp(e);case 5:return this.deleteOp(e);case 6:return this.moveOp(e)}return null}addOp(e){let{fi:t,id:n,data:i}=e,r=this,s={fi:t,id:n,data:i};return r=[...r,s],r.sort(((e,t)=>e.fi-t.fi)),e.localIndex=r.indexOf(s),{data:this.modifyArrayBy(r),actual:e,reverse:{type:5,id:n}}}deleteOp(e){let{id:t}=e,n=this,i=n.findIndex((e=>e.id===t));if(-1===i)return null;e.localIndex=i,n=[...n];let r=n.splice(i,1)[0];return{data:this.modifyArrayBy(n),actual:e,reverse:o({type:4},r)}}moveOp(e){let{fi:t,id:n}=e,i=this;i=[...i];let r=i.findIndex((e=>e.id===n));if(-1===r)return null;let s=i[r].fi,a=o(o({},i[r]),{},{fi:t});return i[r]=a,i.sort(((e,t)=>e.fi-t.fi)),e.localIndex=i.indexOf(a),{data:this.modifyArrayBy(i),actual:e,reverse:{type:6,fi:s,id:n}}}previous(e){if(null===e)return 0===this.length?null:this[this.length-1].id;let t=null;for(let n of this){if(n.id===e)return t;t=n.id}return null}insertBeforeHelper(e,t){return this.insertAfterHelper(this.previous(e),t)}insertAfterHelper(e,t){let n=this;if(null===e){if(0===n.length)return og(0,t,t);{let e=n[0].fi;return og(e-t,e,t)}}{let i=this.get(e);if(void 0===i)throw new Error("illegal args");let r=n.find((e=>e.fi>i.fi));if(void 0===r){let e=n[n.length-1].fi;return og(e,e+t,t)}return og(i.fi,r.fi,t)}}};function fg(e){return e&&"object"==typeof e&&e instanceof bg}var mg,gg,vg,yg,bg=class{unusedFunOverridesTable(e){}runOp(e){let t=[],n=this,i=0,r={};for(;i<e.path.length;){if(t.push(n),n=void 0===n?void 0:n[e.path[i]],void 0!==n&&!fg(n))return null;i+=1}n=n?ag(n):new bg;for(let[s,a]of Object.entries(e.props)){let e=n[s];r[s]=e,void 0===a?delete n[s]:n[s]=a}for(;i>0;){if(0===Object.keys(n).length){let r=t[i-1];r&&(n=ag(r),delete n[e.path[i-1]])}else{let r=t[i-1];if(r){let t=ag(r);t[e.path[i-1]]=n,n=t}else{let t=new bg;t[e.path[i-1]]=n,n=t}}i-=1}return{data:Object.setPrototypeOf(n,bg.prototype),actual:e,reverse:o(o({},e),{},{props:r})}}};function xg(e,t){if(void 0===t)return;let n=!1,i=e.map((e=>{let i=e.id,r=wg(e.data,t[i]);if(n=n||void 0!==r,void 0===r&&(r=e.data),e.children){let s=xg(e.children,t);return void 0!==s?n=!0:s=e.children,o(o({},e),{},{id:i,data:r,children:s})}return o(o({},e),{},{id:i,data:r})}));return n?i:void 0}function wg(e,t){if(!fg(t))return t;if(e instanceof dg){let n=xg(e,t);return void 0!==n&&Object.setPrototypeOf(n,Object.getPrototypeOf(e)),n}if(e instanceof pg)return function(e,t){if(void 0===t)return;let n=!1,i=e.map((e=>{let i=e.id,r=wg(e.data,t[i]);return n=n||void 0!==r,void 0===r&&(r=e.data),o(o({},e),{},{id:i,data:r})}));return n?(Object.setPrototypeOf(i,Object.getPrototypeOf(e)),i):void 0}(e,t);if(Array.isArray(e)){let n=!1,i=e.map(((e,i)=>{let r=wg(e,t[i]);return n=n||void 0!==r,void 0===r&&(r=e),r}));return n?(Object.setPrototypeOf(i,Object.getPrototypeOf(e)),i):void 0}if(e instanceof bg)return Sg(e,t);if(e&&"object"==typeof e){let n={},i=!1;for(let[r,s]of Object.entries(e)){let e=wg(s,t[r]);i=i||void 0!==e,void 0===e&&(e=s),n[r]=e}return i?(Object.setPrototypeOf(n,Object.getPrototypeOf(e)),n):void 0}}function Sg(e,t){if(void 0===e)return t;if(void 0===t)return e;if(!fg(t))return t;if(!fg(e))return mg.apply(e,t);let n=new Set;for(let r of Object.keys(e))n.add(r);for(let r of Object.keys(t))n.add(r);let i=new bg;for(let r of n){let n=Sg(void 0===e?void 0:e[r],void 0===t?void 0:t[r]);i[r]=n}return i}function _g(e,t){var n;let i={cur:[],result:[],len:0};return[e=null!==(n=Mg(e,t,i))&&void 0!==n?n:e,i.result]}function Eg(e,t){return null===e?null:(e.cur[e.len]=t,e.len+=1,e)}function Ag(e){e&&(e.len-=1)}function Cg(e,t,n){let i=!1,r=e.map((e=>{let r=e.id,s=t[r];if(void 0!==s&&"string"==typeof s&&(i=!0,r=s,null!==n))throw new Error("not supported");let a=Mg(e.data,t,Eg(n,r));Ag(n),i=i||void 0!==a,void 0===a&&(a=e.data);let l=Cg(e.children,t,n);return void 0!==l?i=!0:l=e.children,o(o({},e),{},{id:r,data:a,children:l})}));if(i)return r}function Mg(e,t,n){if(e instanceof dg){let i=Cg(e,t,n);return void 0!==i&&Object.setPrototypeOf(i,Object.getPrototypeOf(e)),i}if(e instanceof pg)return function(e,t,n){let i=!1,r=e.map((e=>{let r=e.id,s=t[r];if(void 0!==s&&"string"==typeof s&&(i=!0,r=s,null!==n))throw new Error("not supported");let a=Mg(e.data,t,Eg(n,r));return Ag(n),i=i||void 0!==a,void 0===a&&(a=e.data),o(o({},e),{},{id:r,data:a})}));if(i)return Object.setPrototypeOf(r,Object.getPrototypeOf(e)),r}(e,t,n);if(Array.isArray(e)){let i=!1,r=e.map(((e,r)=>{let s=Mg(e,t,Eg(n,r));return Ag(n),i=i||void 0!==s,void 0===s&&(s=e),s}));return i?(Object.setPrototypeOf(r,Object.getPrototypeOf(e)),r):void 0}if(e&&"object"==typeof e&&!lg(e)){let i={},r=!1;for(let[s,a]of Object.entries(e))if("name"!==s&&"variableId"!==s){let e=t[s];if("string"==typeof e){if(null!==n)throw new Error("not supported");r=!0,s=e}let o=Mg(a,t,Eg(n,s));Ag(n),r=r||void 0!==o,void 0===o&&(o=a),i[s]=o}else i[s]=a;return r?(Object.setPrototypeOf(i,Object.getPrototypeOf(e)),i):void 0}if("string"==typeof e){let i=t[e];return void 0!==i&&function(e){if(null===e)return null;e.result.push(e.cur.slice(0,e.len))}(n),i}}(e=>{e.apply=function(e,t){var n;return null!==(n=wg(e,t))&&void 0!==n?n:e},e.merge=function(e,t){return Sg(e,t)},e.filterOp=function(e,t){let n=0,i=t.path,r=e;for(;n<i.length&&void 0!==r;){if(r=Ug.zoomOnce(r,i[n]),void 0===r)return t;if(!fg(r))return;n+=1}if(void 0===r)return t;if(fg(r)){if(0===t.type){let e=o({},t.props);for(let t of Object.keys(r))delete e[t];return o(o({},t),{},{props:e})}if(1===t.type||4===t.type||7===t.type){let e=xg([t],r);return e?(console.log(e),e):t}return t}}})(mg||(mg={})),(e=>{e.replaceProps=function(e,t){let n=Ug.zoom(t,e.path);if("object"==typeof n){let t={};for(let i of Object.keys(e.props))t[i]=n[i];return o(o({},e),{},{props:t})}return o(o({},e),{},{props:{}})}})(gg||(gg={})),(e=>{function t(e,t){let n=t.path;for(var i=[];;){let a;if(e instanceof bg&&0===t.type&&(a=e.runOp(o(o({},t),{},{path:n.slice(i.length)})),null===a&&(a=void 0)),void 0===a&&i.length===n.length&&(a=e instanceof dg||e instanceof pg||e instanceof ig?e.runOp(t):ug.runOp(e,t)),void 0!==a){if(null!==a){let e=a.data;for(let t=i.length-1;t>=0;t--){let r=n[t],s=i[t];if(s instanceof dg){if("number"==typeof r)throw new Error("illegal arg");e=s.modifyById(r,e)}else if(s instanceof pg){if("number"==typeof r)throw new Error("illegal arg");e=s.modifyById(r,e)}else if(s instanceof ig){if("number"==typeof r)throw new Error("illegal arg");e=s.modifyById(r,e)}else if(s instanceof bg){let t=o(o({},s),{},{[r]:e});e=Object.setPrototypeOf(t,bg.prototype)}else{if("object"!=typeof s)return null;if(Array.isArray(s)){if("string"==typeof r&&(r=parseInt(r),isNaN(r)))throw new Error("Invalid path");let t=e;e=[...s],e[r]=t}else e=o(o({},s),{},{[r]:e})}}return{data:e,actual:o(o({},a.actual),{},{path:n}),reverse:o(o({},a.reverse),{},{path:n})}}return null}let l,c=n[i.length];if(e instanceof dg){var r;if("number"==typeof c)throw new Error("");l=null===(r=e.get(c))||void 0===r?void 0:r.data}else if(e instanceof pg){var s;if("number"==typeof c)throw new Error("");l=null===(s=e.get(c))||void 0===s?void 0:s.data}else null!==e&&(l=e[c]);if(void 0===l)return null;i.push(e),e=l}}function n(e,t){for(let n=0;n<e.length&&n<t.length;n++)if(e[n]!==t[n])return!0;return!1}function i(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}e.drop=function(e,t){return o(o({},e),{},{path:e.path.slice(t)})},e.applySimple=function(e,n){var i,r;return null!==(i=null===(r=t(e,n))||void 0===r?void 0:r.data)&&void 0!==i?i:e},e.apply=t,e.pathDisjoint=n,e.pathEq=i,e.commutative=function(e,t){return n(e.path,t.path)},e.subsumed=function(e,t){return!(0!==e.type||0!==t.type||!i(e.path,t.path))&&Object.keys(e.props).every((e=>void 0!==t.props[e]))}})(vg||(vg={})),(e=>{function t(e,t){var n=e;let i=[],r=[];for(let s of t)try{if(3===s.type||5===s.type&&"variables"===s.path[s.path.length-1]){let e,t,a;if(3===s.type?(e=Ug.zoom(n,[...s.path,s.id]),a=vg.apply(n,o(o({},s),{},{type:2}))):(e=Ug.zoom(n,[...s.path,s.id,"value"]),a=vg.apply(n,s)),null!==a){n=a.data;let[l,c]=_g(n,{[s.id]:e});n=l;for(let a=0;a<c.length;a++){let l=c[a],h=l.pop();if("number"==typeof h){let i=[h];for(let e=a+1;e<c.length;e++){let t=c[e],n=t[t.length-1];if("number"!=typeof n||!Ug.equal(l,t.slice(0,t.length-1)))break;i.push(n),c.splice(e,1)}let r=Ug.zoom(n,l);t=r.map(((e,t)=>i.includes(t)?s.id:e)),e=r,h=l.pop()}else{if("alphaOverride"===h||"alpha"===h){e/=100;let t=e,i=Ug.zoom(n,l.slice(0,l.length-2)),r=i.layers.map((e=>e.id===l[l.length-1]?o(o({},e),{},{data:o(o({},e.data),{},{[h]:t})}):e));Object.setPrototypeOf(r,Object.getPrototypeOf(i.layers)),i.layers=r}t=s.id}i.push({type:0,path:l,props:{[h]:e}}),r.push({type:0,path:l,props:{[h]:t}})}r.push(a.reverse),i.push(a.actual)}}else{let e=vg.apply(n,s);null!==e&&(i.push(e.actual),n=e.data,r.push(e.reverse))}}catch(KZ){if(KZ instanceof sg)return null;throw KZ}return{data:n,actual:i,reverse:r.reverse()}}e.empty=function(){return[]},e.removePrefix=function(e,t){let n=[];for(let i of e){let[e,...r]=i.path;e===t&&n.push(o(o({},i),{},{path:r}))}return n},e.addPrefix=function(e,t){return e.map((e=>o(o({},e),{},{path:[t,...e.path]})))},e.concat=function(e,t){return[...e,...t]},e.compress=function(e,t){return[...e.filter((e=>!t.some((t=>vg.subsumed(e,t))))),...t]},e.commutative=function(e,t){return e.every((e=>t.every((t=>vg.commutative(e,t)))))},e.applyAll=function(e,n){for(let i of n){let n=t(e,i);null!==n&&(e=n.data)}return e},e.apply=t})(yg||(yg={}));var Tg=Symbol(),Pg=Symbol(),Dg=Symbol(),Og=class{reportOp(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],i=this;if(null===t)return;i._current=t.data;let r=n;for(;!(i instanceof jg);){let e=i._path,t=i._current;if(""!==e&&r.splice(0,0,e),i=i._parent,null===i)return;i.update(e,t)}i.push(r,e,t.actual,t.reverse)}deleteChildren(e){if(this._children){let t=this._children[e];if(t){let n=t[Dg];n&&n(),delete this._children[e]}}}},Ig=class extends Og{constructor(e,t,n){super(),this._parent=e,this._path=t,this._current=n}update(e,t){if(Array.isArray(this._current)){if("string"==typeof e&&(e=parseInt(e),isNaN(e)))throw new Error("Invalid path");this._current=[...this._current],this._current[e]=t}else this._current=o(o({},this._current),{},{[e]:t})}runOp(e){this.reportOp(e,ug.runOp(this._current,e),e.path)}},Rg=class extends Og{constructor(e,t,n){super(),this._parent=e,this._path=t,this._current=n}update(e,t){this._current=o(o({},this._current),{},{[e]:t}),Object.setPrototypeOf(this._current,ig.prototype)}runOp(e){this.reportOp(e,this._current.runOp(e))}},kg={get(e,t){if(t===Dg)return()=>{e._parent=null};if(t===Tg)return e._current;if(t===Pg)return e;let{_current:n,_children:i}=e;if("push"===t&&Array.isArray(n))throw new Error("not supported to expand array");let r=void 0===i?void 0:i[t];if(void 0!==r)return r;let s=n[t],a=Vg(e,t,s);return a!==s?(void 0===i&&(i={},e._children=i),i[t]=a,a):s},has:(e,t)=>t in e._current,ownKeys:e=>Reflect.ownKeys(e._current),defineProperty(){throw Error("not supported")},getPrototypeOf:e=>Object.getPrototypeOf(e._current),setPrototypeOf(){throw Error("not supported")},getOwnPropertyDescriptor(e,t){let n=e._current,i=Reflect.getOwnPropertyDescriptor(n,t);return i&&{writable:!0,configurable:!0,enumerable:i.enumerable,value:n[t]}}},Lg=o(o({},kg),{},{set(e,t,n){var i;let r={type:0,props:{[t]:null!==(i=Wg(n))&&void 0!==i?i:n}};return e.deleteChildren(t),e.runOp(r),!0},deleteProperty(e,t){let n={type:0,props:{[t]:void 0}};return e.deleteChildren(t),e.runOp(n),!0}}),Bg=o(o({},kg),{},{set(e,t,n){return void 0===n?this.deleteProperty(e,t):(e.deleteChildren(t),e.runOp({type:1,id:t,data:n})),!0},deleteProperty:(e,t)=>(e.runOp({type:2,id:t}),!0)}),zg=class extends Og{constructor(e,t,n){super(),this._children={},this._parent=e,this._path=t,this._current=n,this[Dg]=()=>{this._parent=null}}unproxy(){return this._current}update(e,t){this._current=this._current.modifyById(e,t)}runOp(e){this.reportOp(e,this._current.runOp(e))}randomId(){return this._current.randomId()}isDescendantOf(e,t){return this._current.isDescendantOf(e,t)}childrenOf(e){return this._current.childrenOf(e)}traverse(e){return this._current.traverse(e)}get(e){return this._current.get(e)}parent(e){return this._current.parent(e)}traverse(e){this._current.traverse(((t,n)=>{e(t,this.data(t))}))}data(e){var t;let{_current:n,_children:i}=this,r=void 0===i?void 0:i[e];if(void 0!==r)return r;let s=null===(t=n.get(e))||void 0===t?void 0:t.data,a=Vg(this,e,s);return a!==s?(void 0===i&&(i={},this._children=i),i[e]=a,a):s}add(e,t,n,i,r){this.runOp({type:7,parent:e,fi:t,id:n,data:i,children:r})}move(e,t,n){this.runOp({type:9,parent:e,fi:t,id:n})}insertAfter(e,t,n){let i=this._current.insertAfterHelper(e,t,n.length);for(let r=0;r<n.length;r++){let t=n[r];this.add(e,i[r],t.id,t.data,t.children)}}insertBefore(e,t,n){let i=this._current.insertBeforeHelper(e,t,n.length);for(let r=0;r<n.length;r++){let t=n[r];this.add(e,i[r],t.id,t.data,t.children)}}moveAfter(e,t,n){let i=this._current.insertAfterHelper(e,t,n.length);for(let r=0;r<n.length;r++){let t=n[r];this.move(e,i[r],t)}}moveBefore(e,t,n){let i=this._current.insertBeforeHelper(e,t,n.length);for(let r=0;r<n.length;r++){let t=n[r];this.move(e,i[r],t)}}delete(e){this.deleteChildren(e),this.runOp({type:8,id:e})}sortNext(e){return this._current.sortNext(e)}sortPrevious(e){return this._current.sortPrevious(e)}getAllSorted(e){return this._current.getAllSorted(e)}},Ng=class extends Og{constructor(e,t,n){super(),this._children={},this._parent=e,this._path=t,this._current=n,this[Dg]=()=>{this._parent=null}}unproxy(){return this._current}get length(){return this._current.length}forEach(e){let t=this.length;for(let n=0;n<t;n++){let t=this._current[n].id,i=this._current[n].fi;e(this.data(this._current[n].id),t,i)}}find(e){let t=this.length;for(let n=0;n<t;n++){let t=this._current[n].id;if(e(this.data(t),t))return this.get(t)}}update(e,t){this._current=this._current.modifyById(e,t)}randomId(){return this._current.randomId()}get(e){return o(o({},this._current.get(e)),{},{data:this.data(e)})}data(e){var t;let{_current:n,_children:i}=this,r=void 0===i?void 0:i[e];if(void 0!==r)return r;let s=null===(t=n.get(e))||void 0===t?void 0:t.data,a=Vg(this,e,s);return a!==s?(void 0===i&&(i={},this._children=i),i[e]=a,a):s}runOp(e){this.reportOp(e,this._current.runOp(e))}add(e,t,n){this.runOp({type:4,fi:e,id:t,data:n})}move(e,t){this.runOp({type:6,fi:e,id:t})}insertAfter(e,t){let n=this._current.insertAfterHelper(e,t.length);for(let i=0;i<t.length;i++){let e=t[i];this.add(n[i],e.id,e.data)}}insertBefore(e,t){let n=this._current.insertBeforeHelper(e,t.length);for(let i=0;i<t.length;i++){let e=t[i];this.add(n[i],e.id,e.data)}}moveAfter(e,t){let n=this._current.insertAfterHelper(e,t.length);for(let i=0;i<t.length;i++){let e=t[i];this.move(n[i],e)}}moveBefore(e,t){let n=this._current.insertBeforeHelper(e,t.length);for(let i=0;i<t.length;i++){let e=t[i];this.move(n[i],e)}}delete(e){this.deleteChildren(e),this.runOp({type:5,id:e})}};function Fg(e,t,n){if(e.length>0){let i=e[e.length-1];if(0===i.type&&0===t.type&&Ug.equal(i.path,n))return void Object.assign(i.props,t.props)}e.push(o(o({},t),{},{path:n}))}var Ug,jg=class extends Og{constructor(e){super(),this.ts=[],this.actual=[],this.reverse=[],this._current=e}update(e,t){if(""!==e)throw new Error("");this._current=t}push(e,t,n,i){Fg(this.ts,t,e),Fg(this.actual,n,e),Fg(this.reverse,i,e)}result(){return{data:this._current,ts:this.ts,actual:this.actual,reverse:this.reverse.reverse()}}};function Vg(e,t,n){return n instanceof dg?new zg(e,t,n):n instanceof pg?new Ng(e,t,n):n instanceof ig?new Proxy(new Rg(e,t,n),Bg):null!==n&&"object"==typeof n?lg(n)?n:new Proxy(new Ig(e,t,n),Lg):n}function Gg(e){let t=new jg(e);return[Vg(t,"",e),t]}function Hg(e,t){let[n,i]=Gg(e);return t(n),i.result()}function Wg(e){return e instanceof zg||e instanceof Ng?e._current:null!==e&&"object"==typeof e?e[Tg]:e}function qg(e,t){let n=[];if(!(t.length<=e.length))return null;for(var i=0;i<t.length;){if("*"===t[i])n.push(e[i]);else if(e[i]!==t[i])return null;i+=1}return n}(e=>{function t(e,t){return(e instanceof dg||e instanceof zg)&&"string"==typeof t||(e instanceof pg||e instanceof Ng)&&"string"==typeof t?e.data(t):"number"==typeof t&&Array.isArray(e)||"string"==typeof t&&"object"==typeof e&&null!==e?e[t]:void 0}function n(e,n){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;for(;i<n.length&&void 0!==e;)e=t(e,n[i]),i+=1;return e}e.equal=function(e,t){if(t.length!==e.length)return!1;for(var n=0;n<e.length;){if(e[n]!==t[n])return!1;n+=1}return!0},e.removeOverridden=function(e,t,i){let r=n(i,e);if(void 0!==r&&"object"==typeof r&&null!==r){let e=o({},t);return Object.keys(r).forEach((t=>{delete e[t]})),e}return t},e.zoomOnce=t,e.zoom=n})(Ug||(Ug={}));var Xg,Yg=class{},Qg=class extends Yg{constructor(e){super(),this.id=e}},Kg=class extends Yg{constructor(e){super(),this.data=e}};try{Xg=new TextDecoder}catch(bne){}var Zg,Jg,$g,ev,tv,nv,iv,rv=0,sv=[],av=sv,ov=0,lv={},cv=0,hv=0,uv=[],dv={useRecords:!1,mapsAsObjects:!0},pv=class{},fv=new pv;fv.name="MessagePack 0xC1";var mv=!1,gv=class{constructor(e){e&&(!1===e.useRecords&&void 0===e.mapsAsObjects&&(e.mapsAsObjects=!0),e.structures?e.structures.sharedLength=e.structures.length:e.getStructures&&((e.structures=[]).uninitialized=!0,e.structures.sharedLength=0)),Object.assign(this,e)}unpack(e,t){if(Zg)return jv((()=>(Vv(),this?this.unpack(e,t):gv.prototype.unpack.call(dv,e,t))));Jg=t>-1?t:e.length,rv=0,ov=0,hv=0,ev=null,av=sv,tv=null,Zg=e;try{iv=e.dataView||(e.dataView=new DataView(e.buffer,e.byteOffset,e.byteLength))}catch(zZ){throw Zg=null,e instanceof Uint8Array?zZ:new Error("Source must be a Uint8Array or Buffer but was a "+(e&&"object"==typeof e?e.constructor.name:typeof e))}if(this instanceof gv){if(lv=this,this.structures)return $g=this.structures,vv();(!$g||$g.length>0)&&($g=[])}else lv=dv,(!$g||$g.length>0)&&($g=[]);return vv()}unpackMultiple(e,t){let n,i=0;try{mv=!0;let r=e.length,s=this?this.unpack(e,r):Wv.unpack(e,r);if(!t){for(n=[s];rv<r;)i=rv,n.push(vv());return n}for(t(s);rv<r;)if(i=rv,!1===t(vv()))return}catch(FZ){throw FZ.lastPosition=i,FZ.values=n,FZ}finally{mv=!1,Vv()}}_mergeStructures(e,t){for(let n=0,i=(e=e||[]).length;n<i;n++){let t=e[n];t&&(t.isShared=!0,n>=32&&(t.highByte=n-32>>5))}e.sharedLength=e.length;for(let n in t||[])if(n>=0){let i=e[n],r=t[n];r&&(i&&((e.restoreStructures||(e.restoreStructures=[]))[n]=i),e[n]=r)}return this.structures=e}decode(e,t){return this.unpack(e,t)}};function vv(){try{if(!lv.trusted&&!mv){let e=$g.sharedLength||0;e<$g.length&&($g.length=e)}let e=bv();if(rv==Jg)$g.restoreStructures&&yv(),$g=null,Zg=null,nv&&(nv=null);else{if(rv>Jg){let e=new Error("Unexpected end of MessagePack data");throw e.incomplete=!0,e}if(!mv)throw new Error("Data read, but end of buffer not reached")}return e}catch(BZ){throw $g.restoreStructures&&yv(),Vv(),(BZ instanceof RangeError||BZ.message.startsWith("Unexpected end of buffer"))&&(BZ.incomplete=!0),BZ}}function yv(){for(let e in $g.restoreStructures)$g[e]=$g.restoreStructures[e];$g.restoreStructures=null}function bv(){let e=Zg[rv++];if(e<160){if(e<128){if(e<64)return e;{let t=$g[63&e]||lv.getStructures&&_v()[63&e];return t?(t.read||(t.read=wv(t,63&e)),t.read()):e}}if(e<144){if(e-=128,lv.mapsAsObjects){let t={};for(let n=0;n<e;n++)t[zv()]=bv();return t}{let t=new Map;for(let n=0;n<e;n++)t.set(bv(),bv());return t}}{e-=144;let t=new Array(e);for(let n=0;n<e;n++)t[n]=bv();return t}}if(e<192){let t=e-160;if(hv>=rv)return ev.slice(rv-cv,(rv+=t)-cv);if(0==hv&&Jg<140){let e=t<16?Rv(t):Iv(t);if(null!=e)return e}return Ev(t)}{let t;switch(e){case 192:return null;case 193:return tv?(t=bv(),t>0?tv[1].slice(tv.position1,tv.position1+=t):tv[0].slice(tv.position0,tv.position0-=t)):fv;case 194:return!1;case 195:return!0;case 196:return kv(Zg[rv++]);case 197:return t=iv.getUint16(rv),rv+=2,kv(t);case 198:return t=iv.getUint32(rv),rv+=4,kv(t);case 199:return Lv(Zg[rv++]);case 200:return t=iv.getUint16(rv),rv+=2,Lv(t);case 201:return t=iv.getUint32(rv),rv+=4,Lv(t);case 202:if(t=iv.getFloat32(rv),lv.useFloat32>2){let e=Gv[(127&Zg[rv])<<1|Zg[rv+1]>>7];return rv+=4,(e*t+(t>0?.5:-.5)|0)/e}return rv+=4,t;case 203:return t=iv.getFloat64(rv),rv+=8,t;case 204:return Zg[rv++];case 205:return t=iv.getUint16(rv),rv+=2,t;case 206:return t=iv.getUint32(rv),rv+=4,t;case 207:return lv.int64AsNumber?(t=4294967296*iv.getUint32(rv),t+=iv.getUint32(rv+4)):t=iv.getBigUint64(rv),rv+=8,t;case 208:return iv.getInt8(rv++);case 209:return t=iv.getInt16(rv),rv+=2,t;case 210:return t=iv.getInt32(rv),rv+=4,t;case 211:return lv.int64AsNumber?(t=4294967296*iv.getInt32(rv),t+=iv.getUint32(rv+4)):t=iv.getBigInt64(rv),rv+=8,t;case 212:if(t=Zg[rv++],114==t)return Nv(63&Zg[rv++]);{let e=uv[t];if(e)return e.read?(rv++,e.read(bv())):e.noBuffer?(rv++,e()):e(Zg.subarray(rv,++rv));throw new Error("Unknown extension "+t)}case 213:return t=Zg[rv],114==t?(rv++,Nv(63&Zg[rv++],Zg[rv++])):Lv(2);case 214:return Lv(4);case 215:return Lv(8);case 216:return Lv(16);case 217:return t=Zg[rv++],hv>=rv?ev.slice(rv-cv,(rv+=t)-cv):Av(t);case 218:return t=iv.getUint16(rv),hv>=(rv+=2)?ev.slice(rv-cv,(rv+=t)-cv):Cv(t);case 219:return t=iv.getUint32(rv),hv>=(rv+=4)?ev.slice(rv-cv,(rv+=t)-cv):Mv(t);case 220:return t=iv.getUint16(rv),rv+=2,Pv(t);case 221:return t=iv.getUint32(rv),rv+=4,Pv(t);case 222:return t=iv.getUint16(rv),rv+=2,Dv(t);case 223:return t=iv.getUint32(rv),rv+=4,Dv(t);default:if(e>=224)return e-256;if(void 0===e){let e=new Error("Unexpected end of MessagePack data");throw e.incomplete=!0,e}throw new Error("Unknown MessagePack token "+e)}}}var xv=/^[a-zA-Z_$][a-zA-Z\d_$]*$/;function wv(e,t){function n(){if(n.count++>2){let n=e.read=new Function("r","return function(){return {"+e.map((e=>xv.test(e)?e+":r()":"["+JSON.stringify(e)+"]:r()")).join(",")+"}}")(bv);return 0===e.highByte&&(e.read=Sv(t,e.read)),n()}let i={};for(let t=0,n=e.length;t<n;t++){i[e[t]]=bv()}return i}return n.count=0,0===e.highByte?Sv(t,n):n}var Sv=(e,t)=>function(){let n=Zg[rv++];if(0===n)return t();let i=e<32?-(e+(n<<5)):e+(n<<5),r=$g[i]||_v()[i];if(!r)throw new Error("Record id is not defined for "+i);return r.read||(r.read=wv(r,e)),r.read()};function _v(){let e=jv((()=>(Zg=null,lv.getStructures())));return $g=lv._mergeStructures(e,$g)}var Ev=Tv,Av=Tv,Cv=Tv,Mv=Tv;function Tv(e){let t;if(e<16&&(t=Rv(e)))return t;if(e>64&&Xg)return Xg.decode(Zg.subarray(rv,rv+=e));let n=rv+e,i=[];for(t="";rv<n;){let e=Zg[rv++];if(0===(128&e))i.push(e);else if(192===(224&e)){let t=63&Zg[rv++];i.push((31&e)<<6|t)}else if(224===(240&e)){let t=63&Zg[rv++],n=63&Zg[rv++];i.push((31&e)<<12|t<<6|n)}else if(240===(248&e)){let t=(7&e)<<18|(63&Zg[rv++])<<12|(63&Zg[rv++])<<6|63&Zg[rv++];t>65535&&(t-=65536,i.push(t>>>10&1023|55296),t=56320|1023&t),i.push(t)}else i.push(e);i.length>=4096&&(t+=Ov.apply(String,i),i.length=0)}return i.length>0&&(t+=Ov.apply(String,i)),t}function Pv(e){let t=new Array(e);for(let n=0;n<e;n++)t[n]=bv();return t}function Dv(e){if(lv.mapsAsObjects){let t={};for(let n=0;n<e;n++)t[zv()]=bv();return t}{let t=new Map;for(let n=0;n<e;n++)t.set(bv(),bv());return t}}var Ov=String.fromCharCode;function Iv(e){let t=rv,n=new Array(e);for(let i=0;i<e;i++){let e=Zg[rv++];if((128&e)>0)return void(rv=t);n[i]=e}return Ov.apply(String,n)}function Rv(e){if(e<4){if(e<2){if(0===e)return"";{let e=Zg[rv++];return(128&e)>1?void(rv-=1):Ov(e)}}{let t=Zg[rv++],n=Zg[rv++];if((128&t)>0||(128&n)>0)return void(rv-=2);if(e<3)return Ov(t,n);let i=Zg[rv++];return(128&i)>0?void(rv-=3):Ov(t,n,i)}}{let t=Zg[rv++],n=Zg[rv++],i=Zg[rv++],r=Zg[rv++];if((128&t)>0||(128&n)>0||(128&i)>0||(128&r)>0)return void(rv-=4);if(e<6){if(4===e)return Ov(t,n,i,r);{let e=Zg[rv++];return(128&e)>0?void(rv-=5):Ov(t,n,i,r,e)}}if(e<8){let s=Zg[rv++],a=Zg[rv++];if((128&s)>0||(128&a)>0)return void(rv-=6);if(e<7)return Ov(t,n,i,r,s,a);let o=Zg[rv++];return(128&o)>0?void(rv-=7):Ov(t,n,i,r,s,a,o)}{let s=Zg[rv++],a=Zg[rv++],o=Zg[rv++],l=Zg[rv++];if((128&s)>0||(128&a)>0||(128&o)>0||(128&l)>0)return void(rv-=8);if(e<10){if(8===e)return Ov(t,n,i,r,s,a,o,l);{let e=Zg[rv++];return(128&e)>0?void(rv-=9):Ov(t,n,i,r,s,a,o,l,e)}}if(e<12){let c=Zg[rv++],h=Zg[rv++];if((128&c)>0||(128&h)>0)return void(rv-=10);if(e<11)return Ov(t,n,i,r,s,a,o,l,c,h);let u=Zg[rv++];return(128&u)>0?void(rv-=11):Ov(t,n,i,r,s,a,o,l,c,h,u)}{let c=Zg[rv++],h=Zg[rv++],u=Zg[rv++],d=Zg[rv++];if((128&c)>0||(128&h)>0||(128&u)>0||(128&d)>0)return void(rv-=12);if(e<14){if(12===e)return Ov(t,n,i,r,s,a,o,l,c,h,u,d);{let e=Zg[rv++];return(128&e)>0?void(rv-=13):Ov(t,n,i,r,s,a,o,l,c,h,u,d,e)}}{let p=Zg[rv++],f=Zg[rv++];if((128&p)>0||(128&f)>0)return void(rv-=14);if(e<15)return Ov(t,n,i,r,s,a,o,l,c,h,u,d,p,f);let m=Zg[rv++];return(128&m)>0?void(rv-=15):Ov(t,n,i,r,s,a,o,l,c,h,u,d,p,f,m)}}}}}function kv(e){return lv.copyBuffers?Uint8Array.prototype.slice.call(Zg,rv,rv+=e):Zg.subarray(rv,rv+=e)}function Lv(e){let t=Zg[rv++];if(uv[t])return uv[t](Zg.subarray(rv,rv+=e));throw new Error("Unknown extension type "+t)}var Bv=new Array(4096);function zv(){let e=Zg[rv++];if(!(e>=160&&e<192))return rv--,bv();if(e-=160,hv>=rv)return ev.slice(rv-cv,(rv+=e)-cv);if(!(0==hv&&Jg<180))return Ev(e);let t,n=4095&(e<<5^(e>1?iv.getUint16(rv):e>0?Zg[rv]:0)),i=Bv[n],r=rv,s=rv+e-3,a=0;if(i&&i.bytes==e){for(;r<s;){if(t=iv.getUint32(r),t!=i[a++]){r=1879048192;break}r+=4}for(s+=3;r<s;)if(t=Zg[r++],t!=i[a++]){r=1879048192;break}if(r===s)return rv=r,i.string;s-=3,r=rv}for(i=[],Bv[n]=i,i.bytes=e;r<s;)t=iv.getUint32(r),i.push(t),r+=4;for(s+=3;r<s;)t=Zg[r++],i.push(t);let o=e<16?Rv(e):Iv(e);return i.string=null!=o?o:Ev(e)}var Nv=(e,t)=>{var n=bv();let i=e;void 0!==t&&(e=e<32?-((t<<5)+e):(t<<5)+e,n.highByte=t);let r=$g[e];return r&&r.isShared&&(($g.restoreStructures||($g.restoreStructures=[]))[e]=r),$g[e]=n,n.read=wv(n,i),n.read()},Fv="object"==typeof self?self:global;uv[0]=()=>{},uv[0].noBuffer=!0,uv[101]=()=>{let e=bv();return(Fv[e[0]]||Error)(e[1])},uv[105]=e=>{let t=iv.getUint32(rv-4);nv||(nv=new Map);let n,i=Zg[rv];n=i>=144&&i<160||220==i||221==i?[]:{};let r={target:n};nv.set(t,r);let s=bv();return r.used?Object.assign(n,s):(r.target=s,s)},uv[112]=e=>{let t=iv.getUint32(rv-4),n=nv.get(t);return n.used=!0,n.target},uv[115]=()=>new Set(bv());var Uv=["Int8","Uint8","Uint8Clamped","Int16","Uint16","Int32","Uint32","Float32","Float64","BigInt64","BigUint64"].map((e=>e+"Array"));function jv(e){let t=Jg,n=rv,i=ov,r=cv,s=hv,a=ev,o=av,l=nv,c=tv,h=new Uint8Array(Zg.slice(0,Jg)),u=$g,d=$g.slice(0,$g.length),p=lv,f=mv,m=e();return Jg=t,rv=n,ov=i,cv=r,hv=s,ev=a,av=o,nv=l,tv=c,Zg=h,mv=f,($g=u).splice(0,$g.length,...d),lv=p,iv=new DataView(Zg.buffer,Zg.byteOffset,Zg.byteLength),m}function Vv(){Zg=null,nv=null,$g=null}uv[116]=e=>{let t=e[0],n=Uv[t];if(!n)throw new Error("Could not find typed array for code "+t);return new Fv[n](Uint8Array.prototype.slice.call(e,1).buffer)},uv[120]=()=>{let e=bv();return new RegExp(e[0],e[1])},uv[98]=e=>{let t=(e[0]<<24)+(e[1]<<16)+(e[2]<<8)+e[3],n=rv;rv+=t-4,(tv=[bv(),bv()]).position0=0,tv.position1=0;let i=rv;rv=n;try{return bv()}finally{rv=i}},uv[255]=e=>4==e.length?new Date(1e3*(16777216*e[0]+(e[1]<<16)+(e[2]<<8)+e[3])):8==e.length?new Date(((e[0]<<22)+(e[1]<<14)+(e[2]<<6)+(e[3]>>2))/1e6+1e3*(4294967296*(3&e[3])+16777216*e[4]+(e[5]<<16)+(e[6]<<8)+e[7])):12==e.length?new Date(((e[0]<<24)+(e[1]<<16)+(e[2]<<8)+e[3])/1e6+1e3*((128&e[4]?-281474976710656:0)+1099511627776*e[6]+4294967296*e[7]+16777216*e[8]+(e[9]<<16)+(e[10]<<8)+e[11])):new Date("invalid");var Gv=new Array(147);for(let n=0;n<256;n++)Gv[n]=+("1e"+Math.floor(45.15-.30103*n));var Hv,Wv=new gv({useRecords:!1}),qv=(Wv.unpack,Wv.unpackMultiple,Wv.unpack,new Float32Array(1));new Uint8Array(qv.buffer,0,4);try{Hv=new TextEncoder}catch(xne){}var Xv,Yv,Qv,Kv,Zv,Jv=typeof Buffer<"u",$v=Jv?Buffer.allocUnsafeSlow:Uint8Array,ey=Jv?Buffer:Uint8Array,ty=Jv?4294967296:2144337920,ny=0,iy=null,ry=/[\u0080-\uFFFF]/,sy=Symbol("record-id"),ay=class extends gv{constructor(e){super(e),this.offset=0;let t,n,i,r,s,a=0,o=ey.prototype.utf8Write?function(e,t,n){return Qv.utf8Write(e,t,n)}:!(!Hv||!Hv.encodeInto)&&function(e,t){return Hv.encodeInto(e,Qv.subarray(t)).written},l=this;e||(e={});let c=e&&e.sequential,h=e.structures||e.saveStructures,u=e.maxSharedStructures;if(null==u&&(u=h?32:0),u>8160)throw new Error("Maximum maxSharedStructure is 8160");let d=e.maxOwnStructures;null==d&&(d=h?32:64),c&&!e.saveStructures&&(this.structures=[]);let p=u>32||d+u>64,f=u+64,m=u+d+64;if(m>8256)throw new Error("Maximum maxSharedStructure + maxOwnStructure is 8192");let g=[],v=0,y=0;this.pack=this.encode=function(e,o){if(Qv||(Qv=new $v(8192),Kv=new DataView(Qv.buffer,0,8192),ny=0),(Zv=Qv.length-10)-ny<2048?(Qv=new $v(Qv.length),Kv=new DataView(Qv.buffer,0,Qv.length),Zv=Qv.length-10,ny=0):ny=ny+7&2147483640,t=ny,s=l.structuredClone?new Map:null,l.bundleStrings?(iy=["",""],Qv[ny++]=214,Qv[ny++]=98,iy.position=ny-t,ny+=4):iy=null,n=l.structures,n){n.uninitialized&&(n=l._mergeStructures(l.getStructures()));let e=n.sharedLength||0;if(e>u)throw new Error("Shared structures is larger than maximum shared structures, try increasing maxSharedStructures to "+n.sharedLength);if(!n.transitions){n.transitions=Object.create(null);for(let t=0;t<e;t++){let e=n[t];if(!e)continue;let i,r=n.transitions;for(let t=0,n=e.length;t<n;t++){let n=e[t];i=r[n],i||(i=r[n]=Object.create(null)),r=i}r[sy]=t+64}a=e}c||(n.nextId=e+64)}i&&(i=!1),r=n||[];try{if(b(e),iy){Kv.setUint32(iy.position+t,ny-iy.position-t);let e=iy;iy=null,b(e[0]),b(e[1])}if(l.offset=ny,s&&s.idsToInsert){(ny+=6*s.idsToInsert.length)>Zv&&w(ny),l.offset=ny;let e=function(e,t){let n,i=6*t.length,r=e.length-i;for(t.sort(((e,t)=>e.offset>t.offset?1:-1));n=t.pop();){let t=n.offset,s=n.id;e.copyWithin(t+i,t,r),i-=6;let a=t+i;e[a++]=214,e[a++]=105,e[a++]=s>>24,e[a++]=s>>16&255,e[a++]=s>>8&255,e[a++]=255&s,r=t}return e}(Qv.subarray(t,ny),s.idsToInsert);return s=null,e}return o&yy?(Qv.start=t,Qv.end=ny,Qv):Qv.subarray(t,ny)}finally{if(n){if(y<10&&y++,v>1e4)n.transitions=null,y=0,v=0,g.length>0&&(g=[]);else if(g.length>0&&!c){for(let e=0,t=g.length;e<t;e++)g[e][sy]=0;g=[]}if(i&&l.saveStructures){let i=n.sharedLength||u;n.length>i&&(n=n.slice(0,i));let r=Qv.subarray(t,ny);return!1===l.saveStructures(n,a)?(l._mergeStructures(l.getStructures()),l.pack(e)):(a=i,r)}}o&by&&(ny=t)}};let b=e=>{ny>Zv&&(Qv=w(ny));var n,i=typeof e;if("string"===i){let t,i=e.length;if(iy&&i>=8&&i<4096){let t=ry.test(e);return iy[t?0:1]+=e,Qv[ny++]=193,void b(t?-i:i)}t=i<32?1:i<256?2:i<65536?3:5;let r=3*i;if(ny+r>Zv&&(Qv=w(ny+r)),i<64||!o){let r,s,a,o=ny+t;for(r=0;r<i;r++)s=e.charCodeAt(r),s<128?Qv[o++]=s:s<2048?(Qv[o++]=s>>6|192,Qv[o++]=63&s|128):55296===(64512&s)&&56320===(64512&(a=e.charCodeAt(r+1)))?(s=65536+((1023&s)<<10)+(1023&a),r++,Qv[o++]=s>>18|240,Qv[o++]=s>>12&63|128,Qv[o++]=s>>6&63|128,Qv[o++]=63&s|128):(Qv[o++]=s>>12|224,Qv[o++]=s>>6&63|128,Qv[o++]=63&s|128);n=o-ny-t}else n=o(e,ny+t,r);n<32?Qv[ny++]=160|n:n<256?(t<2&&Qv.copyWithin(ny+2,ny+1,ny+1+n),Qv[ny++]=217,Qv[ny++]=n):n<65536?(t<3&&Qv.copyWithin(ny+3,ny+2,ny+2+n),Qv[ny++]=218,Qv[ny++]=n>>8,Qv[ny++]=255&n):(t<5&&Qv.copyWithin(ny+5,ny+3,ny+3+n),Qv[ny++]=219,Kv.setUint32(ny,n),ny+=4),ny+=n}else if("number"===i)if(e>>>0===e)e<64?Qv[ny++]=e:e<256?(Qv[ny++]=204,Qv[ny++]=e):e<65536?(Qv[ny++]=205,Qv[ny++]=e>>8,Qv[ny++]=255&e):(Qv[ny++]=206,Kv.setUint32(ny,e),ny+=4);else if((e|0)===e)e>=-32?Qv[ny++]=256+e:e>=-128?(Qv[ny++]=208,Qv[ny++]=e+256):e>=-32768?(Qv[ny++]=209,Kv.setInt16(ny,e),ny+=2):(Qv[ny++]=210,Kv.setInt32(ny,e),ny+=4);else{let t;if((t=this.useFloat32)>0&&e<4294967296&&e>=-2147483648){let n;if(Qv[ny++]=202,Kv.setFloat32(ny,e),t<4||((n=e*Gv[(127&Qv[ny])<<1|Qv[ny+1]>>7])|0)===n)return void(ny+=4);ny--}Qv[ny++]=203,Kv.setFloat64(ny,e),ny+=8}else if("object"===i)if(e){if(s){let n=s.get(e);if(n){if(!n.id){let e=s.idsToInsert||(s.idsToInsert=[]);n.id=e.push(n)}return Qv[ny++]=214,Qv[ny++]=112,Kv.setUint32(ny,n.id),void(ny+=4)}s.set(e,{offset:ny-t})}let i=e.constructor;if(i===Object)x(e,!0);else if(i===Array){(n=e.length)<16?Qv[ny++]=144|n:n<65536?(Qv[ny++]=220,Qv[ny++]=n>>8,Qv[ny++]=255&n):(Qv[ny++]=221,Kv.setUint32(ny,n),ny+=4);for(let t=0;t<n;t++)b(e[t])}else if(i===Map){(n=e.size)<16?Qv[ny++]=128|n:n<65536?(Qv[ny++]=222,Qv[ny++]=n>>8,Qv[ny++]=255&n):(Qv[ny++]=223,Kv.setUint32(ny,n),ny+=4);for(let[t,n]of e)b(t),b(n)}else{for(let t=0,n=Xv.length;t<n;t++){if(e instanceof Yv[t]){let n=Xv[t];if(n.write)return n.type&&(Qv[ny++]=212,Qv[ny++]=n.type,Qv[ny++]=0),void b(n.write.call(this,e));let i,r=Qv,s=Kv,a=ny;Qv=null;try{i=n.pack.call(this,e,(e=>(Qv=r,r=null,(ny+=e)>Zv&&w(ny),{target:Qv,targetView:Kv,position:ny-e})),b)}finally{r&&(Kv=s,ny=a,Zv=(Qv=r).length-10)}return void(i&&(i.length+ny>Zv&&w(i.length+ny),ny=cy(i,Qv,ny,n.type)))}}x(e,!e.hasOwnProperty)}}else Qv[ny++]=192;else if("boolean"===i)Qv[ny++]=e?195:194;else if("bigint"===i){if(e<BigInt(1)<<BigInt(63)&&e>=-(BigInt(1)<<BigInt(63)))Qv[ny++]=211,Kv.setBigInt64(ny,e);else if(e<BigInt(1)<<BigInt(64)&&e>0)Qv[ny++]=207,Kv.setBigUint64(ny,e);else{if(!this.largeBigIntToFloat)throw new RangeError(e+" was too large to fit in MessagePack 64-bit integer format, set largeBigIntToFloat to convert to float-64");Qv[ny++]=203,Kv.setFloat64(ny,Number(e))}ny+=8}else if("undefined"===i)this.encodeUndefinedAsNil?Qv[ny++]=192:(Qv[ny++]=212,Qv[ny++]=0,Qv[ny++]=0);else{if("function"!==i)throw new Error("Unknown type: "+i);b(this.writeFunction&&this.writeFunction())}},x=!1===this.useRecords?this.variableMapSize?e=>{let t,n=Object.keys(e),i=n.length;i<16?Qv[ny++]=128|i:i<65536?(Qv[ny++]=222,Qv[ny++]=i>>8,Qv[ny++]=255&i):(Qv[ny++]=223,Kv.setUint32(ny,i),ny+=4);for(let r=0;r<i;r++)b(t=n[r]),b(e[t])}:(e,n)=>{Qv[ny++]=222;let i=ny-t;ny+=2;let r=0;for(let t in e)(n||e.hasOwnProperty(t))&&(b(t),b(e[t]),r++);Qv[i+++t]=r>>8,Qv[i+t]=255&r}:e=>{let t,n=Object.keys(e),s=r.transitions||(r.transitions=Object.create(null)),a=0;for(let i=0,r=n.length;i<r;i++){let e=n[i];t=s[e],t||(t=s[e]=Object.create(null),a++),s=t}let o=s[sy];if(o)o>=96&&p?(Qv[ny++]=96+(31&(o-=96)),Qv[ny++]=o>>5):Qv[ny++]=o;else{o=r.nextId,o||(o=64),o<f&&this.shouldShareStructure&&!this.shouldShareStructure(n)?(o=r.nextOwnId,o<m||(o=f),r.nextOwnId=o+1):(o>=m&&(o=f),r.nextId=o+1);let e=n.highByte=o>=96&&p?o-96>>5:-1;s[sy]=o,r[o-64]=n,o<f?(n.isShared=!0,r.sharedLength=o-63,i=!0,e>=0?(Qv[ny++]=96+(31&o),Qv[ny++]=e):Qv[ny++]=o):(e>=0?(Qv[ny++]=213,Qv[ny++]=114,Qv[ny++]=96+(31&o),Qv[ny++]=e):(Qv[ny++]=212,Qv[ny++]=114,Qv[ny++]=o),a&&(v+=y*a),g.length>=d&&(g.shift()[sy]=0),g.push(s),b(n))}for(let i=0,r=n.length;i<r;i++)b(e[n[i]])},w=e=>{let n;if(e>16777216){if(e-t>ty)throw new Error("Packed buffer would be larger than maximum buffer size");n=Math.min(ty,4096*Math.round(Math.max((e-t)*(e>67108864?1.25:2),4194304)/4096))}else n=1+(Math.max(e-t<<2,Qv.length-1)>>12)<<12;let i=new $v(n);return Kv=new DataView(i.buffer,0,n),Qv.copy?Qv.copy(i,0,t,e):i.set(Qv.slice(t,e)),ny-=t,t=0,Zv=i.length-10,Qv=i}}useBuffer(e){Qv=e,Kv=new DataView(Qv.buffer,Qv.byteOffset,Qv.byteLength),ny=0}};function oy(e,t,n,i){let r=e.byteLength;if(r+1<256){var{target:s,position:a}=n(4+r);s[a++]=199,s[a++]=r+1}else if(r+1<65536){var{target:s,position:a}=n(5+r);s[a++]=200,s[a++]=r+1>>8,s[a++]=r+1&255}else{var{target:s,position:a,targetView:o}=n(7+r);s[a++]=201,o.setUint32(a,r+1),a+=4}s[a++]=116,s[a++]=t,s.set(new Uint8Array(e.buffer,e.byteOffset,e.byteLength),a)}function ly(e,t){let n=e.byteLength;var i,r;if(n<256){var{target:i,position:r}=t(n+2);i[r++]=196,i[r++]=n}else if(n<65536){var{target:i,position:r}=t(n+3);i[r++]=197,i[r++]=n>>8,i[r++]=255&n}else{var{target:i,position:r,targetView:s}=t(n+5);i[r++]=198,s.setUint32(r,n),r+=4}i.set(e,r)}function cy(e,t,n,i){let r=e.length;switch(r){case 1:t[n++]=212;break;case 2:t[n++]=213;break;case 4:t[n++]=214;break;case 8:t[n++]=215;break;case 16:t[n++]=216;break;default:r<256?(t[n++]=199,t[n++]=r):r<65536?(t[n++]=200,t[n++]=r>>8,t[n++]=255&r):(t[n++]=201,t[n++]=r>>24,t[n++]=r>>16&255,t[n++]=r>>8&255,t[n++]=255&r)}return t[n++]=i,t.set(e,n),n+=r}function hy(e){if(e.Class){if(!e.pack&&!e.write)throw new Error("Extension has no pack or write function");if(e.pack&&!e.type)throw new Error("Extension has no type (numeric code to identify the extension)");Yv.unshift(e.Class),Xv.unshift(e)}!function(e){e.unpack?uv[e.type]=e.unpack:uv[e.type]=e}(e)}Yv=[Date,Set,Error,RegExp,ArrayBuffer,Object.getPrototypeOf(Uint8Array.prototype).constructor,pv],Xv=[{pack(e,t,n){let i=e.getTime()/1e3;if((this.useTimestamp32||0===e.getMilliseconds())&&i>=0&&i<4294967296){let{target:e,targetView:n,position:r}=t(6);e[r++]=214,e[r++]=255,n.setUint32(r,i)}else if(i>0&&i<17179869184){let{target:n,targetView:r,position:s}=t(10);n[s++]=215,n[s++]=255,r.setUint32(s,4e6*e.getMilliseconds()+(i/1e3/4294967296|0)),r.setUint32(s+4,i)}else if(isNaN(i)){if(this.onInvalidDate)return t(0),n(this.onInvalidDate());let{target:e,targetView:i,position:r}=t(3);e[r++]=212,e[r++]=255,e[r++]=255}else{let{target:n,targetView:r,position:s}=t(15);n[s++]=199,n[s++]=12,n[s++]=255,r.setUint32(s,1e6*e.getMilliseconds()),r.setBigInt64(s+4,BigInt(Math.floor(i)))}}},{pack(e,t,n){let i=Array.from(e),{target:r,position:s}=t(this.structuredClone?3:0);this.structuredClone&&(r[s++]=212,r[s++]=115,r[s++]=0),n(i)}},{pack(e,t,n){let{target:i,position:r}=t(this.structuredClone?3:0);this.structuredClone&&(i[r++]=212,i[r++]=101,i[r++]=0),n([e.name,e.message])}},{pack(e,t,n){let{target:i,position:r}=t(this.structuredClone?3:0);this.structuredClone&&(i[r++]=212,i[r++]=120,i[r++]=0),n([e.source,e.flags])}},{pack(e,t){this.structuredClone?oy(e,16,t):ly(Jv?Buffer.from(e):new Uint8Array(e),t)}},{pack(e,t){let n=e.constructor;n!==ey&&this.structuredClone?oy(e,Uv.indexOf(n.name),t):ly(e,t)}},{pack(e,t){let{target:n,position:i}=t(1);n[i]=193}}];var uy,dy,py=new ay({useRecords:!1}),{NEVER:fy,ALWAYS:my,DECIMAL_ROUND:gy,DECIMAL_FIT:vy}=(py.pack,py.pack,{NEVER:0,ALWAYS:1,DECIMAL_ROUND:3,DECIMAL_FIT:4}),yy=512,by=1024,xy=new ay({structuredClone:!0});function wy(e){if(lg(e))return e;if(Array.isArray(e))return e.map(wy);if("object"==typeof e&&null!==e){let t={};for(let n of Object.keys(e).sort())t[n]=wy(e[n]);return Object.setPrototypeOf(t,Object.getPrototypeOf(e)),t}return e}function Sy(e){return"MouseDown"===e||"MouseUp"===e||"KeyDown"===e||"KeyUp"===e||"Collision"===e||"Trigger"===e}hy({Class:ig.prototype.constructor,type:1,write:e=>o({},e),read:e=>(Object.setPrototypeOf(e,ig.prototype),e)}),hy({Class:pg.prototype.constructor,type:2,write:e=>[...e],read:e=>(Object.setPrototypeOf(e,pg.prototype),e)}),hy({Class:dg.prototype.constructor,type:3,write:e=>[...e],read:e=>(Object.setPrototypeOf(e,dg.prototype),e)}),hy({Class:Qg.prototype.constructor,type:4,write:e=>e.id,read:e=>new Qg(e)}),hy({Class:Kg.prototype.constructor,type:5,write:e=>e.data,read:e=>new Kg(e)}),hy({Class:bg.prototype.constructor,type:6,write:e=>o({},e),read:e=>(Object.setPrototypeOf(e,bg.prototype),e)}),(e=>{function t(e){return xy.pack(e)}e.serialize=t,e.deserialize=function(e){return xy.unpack(e)},e.checksum=function(e){return function(e){var t=0;if(0===e.length)return t;for(let n=0;n<e.length;n++)t=(t<<5)-t+e[n],t|=0;return t}(t(wy(e))).toString()}})(uy||(uy={})),(e=>{e.toEventUIType=function(e){return"Conditional"===e.type?"Distance"===e.condition.type?"Distance":"StateChange":e.type},e.fromEventUIType=function(e){return"Distance"===e||"StateChange"===e?"Conditional":e}})(dy||(dy={}));var _y,Ey,Ay,Cy,My,Ty,Py,Dy,Oy,Iy,Ry,ky,Ly,By,zy,Ny,Fy,Uy,jy,Vy={LookAt:[],Follow:["Create"],DragDrop:["Transition","Animation","Audio","Particles","Create","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],MouseHover:["Transition","Animation","Particles","Create","Destroy","SwitchCamera","SceneTransition","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],Scroll:["Transition","Animation","Create","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],Start:["Transition","Animation","Audio","Particles","Video","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],Conditional:["Transition","Animation","Audio","Particles","Video","Link","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],MouseDown:["Transition","Animation","Audio","Particles","Video","Link","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],MouseUp:["Transition","Animation","Audio","Particles","Video","Link","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],MousePress:["Transition","Animation","Audio","Particles","Video","Link","Create","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],KeyDown:["Transition","Animation","Audio","Particles","Video","Link","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],KeyUp:["Transition","Animation","Audio","Particles","Video","Link","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],KeyPress:["Transition","Animation","Audio","Particles","Video","Link","Create","SwitchCamera","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],GameControl:["Transition","Animation","Audio","Particles","Create","Conditional"],Collision:["Transition","Animation","Audio","Particles","Video","Create","Destroy","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],Trigger:["Transition","Audio","Particles","Video","Link","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],Resize:["Transition","Animation","Audio","Particles","Video","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],VariableChange:["Transition","Animation","Audio","Particles","Video","Link","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],API:["Transition","Animation","Audio","Particles","Video","Link","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],WEBHOOK:["Transition","Animation","Audio","Particles","Video","Link","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],AIAssistantListener:["SetVariable"],AIAssistantTrigger:["Transition","Animation","Audio","Particles","Video","Link","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"]};(e=>{e.is=function(e){return"MouseDown"===e.type||"MouseUp"===e.type||"MousePress"===e.type||"KeyDown"===e.type||"KeyUp"===e.type||"KeyPress"===e.type},e.defaultData=function(e){return"MouseDown"===e||"MouseUp"===e||"MousePress"===e?{type:e,mode:"Object",disabled:!1,actions:new pg}:{type:e,disabled:!1,key:void 0,actions:new pg}}})(_y||(_y={})),(e=>{e.propertyDefaultData=function(e){return{type:"Property",value:[null!==e&&void 0!==e?e:null,"position","x"]}},e.valueDefaultData={type:"Literal",value:0}})(Ey||(Ey={})),(e=>{e.comparisonDefaultData=function(e){return{type:"Comparison",operator:"==",lOperand:Ey.propertyDefaultData(e),rOperand:o({},Ey.valueDefaultData)}},e.distanceDefaultData=function(e){return{type:"Distance",toObject:null!==e&&void 0!==e?e:null,fromObject:null!==e&&void 0!==e?e:null,distance:200}},e.stateDefaultData=function(e,t){return{type:"State",object:null!==e&&void 0!==e?e:null,state:null!==t&&void 0!==t?t:null}}})(Ay||(Ay={})),(e=>{e.isConditionalSubActions=function(e){return void 0!==e.find((e=>"ifActions"===e||"elseActions"===e))}})(Cy||(Cy={})),(e=>{e.is=function(e){return"Conditional"===e.type},e.defaultData=function(e){return{type:"Conditional",disabled:!1,inActions:new pg,outActions:new pg,condition:Ay.distanceDefaultData(e)}}})(My||(My={})),(e=>{e.defaultData={type:"DragDrop",cursor:"hand",disabled:!1,dampingFactor:1,objects:[],snapTo:"center",snapSurfaceMode:"bbox",snapSurfaceOffset:0,dropOn:"all",autoOrient:!0,dropDestinations:[],plane:"adaptive",planeMode:"locked",referenceFrame:"global",limits:[-1/0,1/0,-1/0,1/0,-1/0,1/0],drop:!1,resetOnSnapFail:!1,snapSpeed:20,resetSpeed:20,dragDropActions:{drag:new pg,drop:new pg}}})(Ty||(Ty={})),(e=>{e.defaultData={type:"Follow",disabled:!1,maxDelta:0,dampingFactor:1,target:"cursor",plane:"custom",resetOnPointerLeave:!0,resetAfterDistanceLimit:!0,enabledTranslation:[!0,!0,!0],limitDistanceEnabled:!1,limitDistance:1e3,snapDelay:0,resetSpeed:5,actions:new pg}})(Py||(Py={})),(e=>{e.defaultData={type:"LookAt",disabled:!1,distance:1e3,dampingFactor:1,target:"cursor",tilt:"up",axis:"z",plane:"custom",resetOnPointerLeave:!0,resetAfterDistanceLimit:!0,enabledRotation:[!0,!0,!0],limitDistanceEnabled:!1,limitDistance:1e3,snapDelay:0,resetSpeed:5}})(Dy||(Dy={})),(e=>{e.is=function(e){return"MouseHover"===e.type},e.defaultData=function(){return{type:"MouseHover",disabled:!1,actions:new pg}}})(Oy||(Oy={})),(e=>{e.is=function(e){return"Scroll"===e.type},e.defaultData=function(){return{type:"Scroll",disabled:!1,steps:100,trigger:"load",startFrom:"enter",enterAnchor:"top",startOffset:0,endAfter:400,actions:new pg}}})(Iy||(Iy={})),(e=>{e.is=function(e){return"Start"===e.type},e.defaultData=function(){return{type:"Start",disabled:!1,actions:new pg}}})(Ry||(Ry={})),(e=>{e.is=function(e){return"Collision"===e.type},e.defaultData=function(){return{type:"Collision",disabled:!1,target:"character",actions:new pg}}})(ky||(ky={})),(e=>{e.is=function(e){return"Trigger"===e.type},e.defaultData=function(e,t){return{type:"Trigger",disabled:!1,target:"all",triggeringObjects:[],actions:new pg,triggerZone:"box",position:t.toArray(),rotation:[0,0,0],size:e.toArray(),radius:e.length()/2,helperVisible:!0}}})(Ly||(Ly={})),(e=>{e.defaultSizes={mobile:[480,480],tablet:[768,768],desktop:[1200,1200],custom:[769,1200]},e.is=function(e){return"Resize"===e.type},e.sizeToDevice=function(e){return"string"==typeof e?e:"custom"},e.deviceToSize=function(t){return"string"==typeof t?[...e.defaultSizes[t]]:[...t]},e.defaultData=function(){let t={size:"mobile",operator:"<",actions:new pg},n={size:"tablet",operator:"<",actions:new pg},i={size:[...e.defaultSizes.custom],operator:"<>",actions:new pg},r=new pg;return r.push({id:at.generateUUID(),fi:0,data:t},{id:at.generateUUID(),fi:1,data:n},{id:at.generateUUID(),fi:2,data:i}),{type:"Resize",disabled:!1,orientation:"horizontal",breakpoints:r}},e.defaultBreakpointData=function(){return{size:[...e.defaultSizes.custom],operator:"<>",actions:new pg}}})(By||(By={})),(e=>{e.propertyPaths={Position:["position"],"Position X":["position","x"],"Position Y":["position","y"],"Position Z":["position","z"],Rotation:["rotation"],"Rotation X":["rotation","x"],"Rotation Y":["rotation","y"],"Rotation Z":["rotation","z"],Scale:["scale"],"Scale X":["scale","x"],"Scale Y":["scale","y"],"Scale Z":["scale","z"],Width:["width"],Height:["height"],Depth:["depth"],"Mouse Position X":["mouse","x"],"Mouse Position Y":["mouse","y"],"Mouse Pressed":["mouse","pressed"],"Screen Width":["mouse","width"],"Screen Height":["mouse","height"],"Hit Position X":["raycast","x"],"Hit Position Y":["raycast","y"],"Hit Position Z":["raycast","z"],"Hit Object Position X":["raycast","objX"],"Hit Object Position Y":["raycast","objY"],"Hit Object Position Z":["raycast","objZ"]},e.is=function(e){return"VariableChange"===e.type},e.defaultData=function(){return{disabled:!1,type:"VariableChange",actions:new pg,variableId:"",objectId:null,property:"Position X"}}})(zy||(zy={})),(e=>{e.is=function(e){return"API"===e.type},e.defaultData=function(){return{disabled:!1,type:"API",successActions:new pg,errorActions:new pg,userAPIId:""}}})(Ny||(Ny={})),(e=>{e.is=function(e){return"WEBHOOK"===e.type},e.defaultData=function(){return{disabled:!1,type:"WEBHOOK",actions:new pg,userWebhookId:""}}})(Fy||(Fy={})),(e=>{e.is=function(e){return"AIAssistantListener"===e.type},e.defaultData=function(){return{disabled:!1,type:"AIAssistantListener",actions:new pg,analysis:"average",analysisRange:[0,71],analysisSingle:0}}})(Uy||(Uy={})),(e=>{e.is=function(e){return"AIAssistantTrigger"===e.type},e.defaultData=function(){return{disabled:!1,description:"",type:"AIAssistantTrigger",actions:new pg}}})(jy||(jy={}));var Gy,Hy,Wy,qy,Xy,Yy,Qy,Ky,Zy,Jy,$y,eb,tb,nb,ib,rb="personal camera",sb="a218fcc3-276b-49b9-b485-49037fd14f5f",ab=5526619;function ob(e){return"string"==typeof e&&36===e.length&&/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(e)}(e=>{function t(e,t){return Math.pow(t[0]-e[0],2)+Math.pow(t[1]-e[1],2)}function n(e,n){return Math.sqrt(t(e,n))}function i(t,n,i){let r=e.sub(n,t),s=e.sub(i,t),a=e.dot(r,s)/e.dot(r,r),o=e.scalarMultiply(r,a);return e.add(t,o)}e.isEqual=function(e,t){return e[0]===t[0]&&e[1]===t[1]},e.lerp=function(e,t,n){return[e[0]+(t[0]-e[0])*n,e[1]+(t[1]-e[1])*n]},e.add=function(e,t){return[e[0]+t[0],e[1]+t[1]]},e.sub=function(e,t){return[e[0]-t[0],e[1]-t[1]]},e.multiply=function(e,t){return[e[0]*t[0],e[1]*t[1]]},e.divide=function(e,t){return[e[0]/t[0],e[1]/t[1]]},e.distanceSquared=t,e.distance=n,e.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]},e.scalarMultiply=function(e,t){return[e[0]*t,e[1]*t]},e.projectionOnto=i,e.projectionOntoDistance=function(e,t,r){return n(e,i(e,t,r))},e.center=function(e,t){return[.5*(e[0]+t[0]),.5*(e[1]+t[1])]}})(Gy||(Gy={})),(e=>{e.isEqual=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]},e.add=function(e,t){return[e[0]+t[0],e[1]+t[1],e[2]+t[2]]},e.sub=function(e,t){return[e[0]-t[0],e[1]-t[1],e[2]-t[2]]},e.div=function(e,t){return[e[0]/t[0],e[1]/t[1],e[2]/t[2]]},e.mul=function(e,t){return[e[0]*t[0],e[1]*t[1],e[2]*t[2]]},e.dist=function(e,t){return Math.hypot(e[0]-t[0],e[1]-t[1],e[2]-t[2])},e.lerp=function(e,t,n){return[e[0]+(t[0]-e[0])*n,e[1]+(t[1]-e[1])*n,e[2]+(t[2]-e[2])*n]}})(Hy||(Hy={})),(e=>{e.isEqual=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]},e.lerp=function(e,t,n){return[e[0]+(t[0]-e[0])*n,e[1]+(t[1]-e[1])*n,e[2]+(t[2]-e[2])*n,e[3]+(t[3]-e[3])*n]}})(Wy||(Wy={})),(e=>{let t=180/Math.PI,n=Math.PI/180;function i(e){return"number"==typeof e?e*t:e}function r(e){return"number"==typeof e?e*n:e}e.radToDeg=function(e){return[i(e[0]),i(e[1]),i(e[2])]},e.degToRad=function(e){return[r(e[0]),r(e[1]),r(e[2])]}})(qy||(qy={})),(e=>{e.identity=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],e.isEqual=function(e,t){for(let n=0;n<16;n++)if(e[n]!==t[n])return!1;return!0},e.simplify=function(t){return null!==t&&void 0!==t?t:e.identity},e.applyMatrix4=function(e,t){let n=t.slice(0);for(var i=0,r=t.length;i<r;i+=3){let r=e[3]*t[i]+e[7]*t[i+1]+e[11]*t[i+2]+e[15];n[i]=(e[0]*t[i]+e[4]*t[i+1]+e[8]*t[i+2]+e[12])/r,n[i+1]=(e[1]*t[i]+e[5]*t[i+1]+e[9]*t[i+2]+e[13])/r,n[i+2]=(e[2]*t[i]+e[6]*t[i+1]+e[10]*t[i+2]+e[14])/r}return n}})(Xy||(Xy={})),(e=>{e.isRGB=function(e){return"object"==typeof e&&"number"==typeof e.r&&"number"==typeof e.g&&"number"==typeof e.b},e.white={r:1,g:1,b:1},e.red={r:1,g:0,b:0},e.black={r:0,g:0,b:0},e.toRgb255a1=function(e){return{r:Math.round(255*e.r),g:Math.round(255*e.g),b:Math.round(255*e.b),a:1}},e.clone=function(e){return{r:e.r,g:e.g,b:e.b}},e.fromHex=function(e){return{r:((e=Math.floor(e))>>16&255)/255,g:(e>>8&255)/255,b:(255&e)/255}},e.toHex=function(e){return 65536*Math.round(255*e.r)+256*Math.round(255*e.g)+Math.round(255*e.b)},e.equals=function(e,t){return e.r===t.r&&e.g===t.g&&e.b===t.b},e.equalsFixed=function(e,t){return e.r.toFixed(2)===t.r.toFixed(2)&&e.g.toFixed(2)===t.g.toFixed(2)&&e.b.toFixed(2)===t.b.toFixed(2)},e.lerp=function(e,t,n){return{r:e.r+(t.r-e.r)*n,g:e.g+(t.g-e.g)*n,b:e.b+(t.b-e.b)*n}}})(Yy||(Yy={})),(e=>{e.white=o(o({},Yy.white),{},{a:1}),e.transparent=o(o({},Yy.white),{},{a:0}),e.from0to1=function(e){return{r:e[0],g:e[1],b:e[2],a:e[3]}},e.fromHexAndA=function(e,t){return o(o({},Yy.fromHex(e)),{},{a:t})},e.toRgb255a1=function(e){return{r:Math.round(255*e.r),g:Math.round(255*e.g),b:Math.round(255*e.b),a:e.a}},e.equals=function(e,t){return Yy.equals(e,t)&&e.a===t.a},e.equalsFixed=function(e,t){return Yy.equalsFixed(e,t)&&e.a.toFixed(2)===t.a.toFixed(2)},e.lerp=function(e,t,n){return{r:e.r+(t.r-e.r)*n,g:e.g+(t.g-e.g)*n,b:e.b+(t.b-e.b)*n,a:e.a+(t.a-e.a)*n}},e.toStyle=function(){let{r:t,g:n,b:i,a:r}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:e.white;return"rgba(".concat(255*t,", ").concat(255*n,", ").concat(255*i,", ").concat(r,")")}})(Qy||(Qy={})),(e=>{e.identity={position:[0,0,0],rotation:[0,0,0],scale:[1,1,1]}})(Ky||(Ky={})),(e=>{e.defaultData={mass:1,stiffness:80,damping:10,velocity:0}})(Zy||(Zy={})),(e=>{e.defaultData={control1:[.5,0],control2:[.5,1]}})(Jy||(Jy={})),(e=>{e.linear=[0,0,1,1],e.ease=[.25,.1,.25,1],e.easeIn=[.42,0,1,1],e.easeOut=[0,0,.58,1],e.easeInOut=[.42,0,.58,1]})($y||($y={})),(e=>{e.all=["PerspectiveCamera","OrthographicCamera"],e.is=function(t){return e.all.includes(t)}})(eb||(eb={})),(e=>{e.DefaultUp=[0,1,0],e.DefaultTargetOffset=1e3,e.defaultData={far:1e5,type:"OrthographicCamera",perspective:{near:70,fov:45,zoom:1},orthographic:{near:-1e5,zoom:1},up:e.DefaultUp,isUpVectorFlipped:!1,targetOffset:e.DefaultTargetOffset},e.getZoom=function(e){var t,n,i,r;return"PerspectiveCamera"===e.type?null!==(t=null===(n=e.perspective)||void 0===n?void 0:n.zoom)&&void 0!==t?t:1:null!==(i=null===(r=e.orthographic)||void 0===r?void 0:r.zoom)&&void 0!==i?i:1}})(tb||(tb={})),(e=>{e.defaultData=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.1;return{disabled:!1,type:"linear",hideBase:!1,count:3,radial:{radius:2*Math.max(e[0],e[1]),start:0,end:360,alignment:!1,axis:"y",scale:[1,1,1],rotation:[0,0,0],position:[0,0,0]},toObject:{object:"",spreadType:"random",scale:[0,0,0],rotation:[0,0,0],position:[0,0,0],axis:"x",seed:0,count:99,align:"normal"},linear:{scale:[1,1,1],rotation:[0,0,0],position:[e[0]+e[0]*t,0,0]},grid:{count:[2,2,2],size:e.map((e=>e*(1+t))),useCenter:!0},randomness:!1,randomnessObject:{strength:100,scale:[0,0,0],rotation:[0,0,0],position:[0,0,0],movement:1,seed:0,freqScale:10,noiseType:"perlin"}}},e.merge=function(e,t){let n=o({},e);if(bb.forEach((i=>{var r;Object.assign(n,{[i]:null!==(r=t[i])&&void 0!==r?r:e[i]})})),n.radial=o({},e.radial),t.radial){let i=e.radial,r=t.radial;xb.forEach((e=>{var t;Object.assign(n.radial,{[e]:null!==(t=r[e])&&void 0!==t?t:i[e]})}))}if(n.linear=o({},e.linear),t.linear){let i=e.linear,r=t.linear;wb.forEach((e=>{var t;Object.assign(n.linear,{[e]:null!==(t=r[e])&&void 0!==t?t:i[e]})}))}if(n.grid=o({},e.grid),t.grid){let i=e.grid,r=t.grid;Sb.forEach((e=>{var t;Object.assign(n.grid,{[e]:null!==(t=r[e])&&void 0!==t?t:i[e]})}))}if(n.toObject=o({},e.toObject),t.toObject){let i=e.toObject,r=t.toObject;_b.forEach((e=>{var t;Object.assign(n.toObject,{[e]:null!==(t=r[e])&&void 0!==t?t:i[e]})}))}if(n.randomnessObject=o({},e.randomnessObject),t.randomnessObject){let i=e.randomnessObject,r=t.randomnessObject;Eb.forEach((e=>{var t;Object.assign(n.randomnessObject,{[e]:null!==(t=r[e])&&void 0!==t?t:i[e]})}))}return n}})(nb||(nb={})),(e=>{e.defaultData={radial:{},linear:{},grid:{},toObject:{},randomnessObject:{}};let t=["radial","linear","grid","toObject","randomnessObject"];e.toOps=function(e,n){let i=[];void 0!==e.count&&i.push({type:0,path:n,props:{count:e.count}});for(let r of t){let t=e[r];t&&Object.keys(t).length>0&&i.push({type:0,path:[...n,r],props:t})}return i}})(ib||(ib={}));var lb,cb,hb,ub,db,pb,fb,mb,gb,vb,yb,bb=["count"],xb=["radius","start","end","position","scale","rotation"],wb=["position","scale","rotation"],Sb=["count","size"],_b=["count","position","scale","rotation"],Eb=["strength","scale","rotation","position","movement","seed","freqScale"];(e=>{e.all=["PointLight","SpotLight","DirectionalLight","HemisphereLight"],e.is=function(t){return e.all.includes(t)}})(lb||(lb={})),(e=>{e.defaultData=function(e){return function(e){if("PointLight"===e)return{type:e,color:Qy.white,intensity:1,distance:2e3,decay:1,shadows:!0,shadowResolution:1024,shadowRadius:1,penumbraSize:.5,depth:1e5};if("SpotLight"===e)return{type:e,color:Qy.white,intensity:1,distance:2e3,decay:1,shadows:!0,penumbra:0,angle:30/180*Math.PI,depth:1e5,penumbraSize:.5,shadowResolution:1024,shadowRadius:1};if("DirectionalLight"===e)return{type:e,color:Qy.white,intensity:1,shadows:!0,size:2e3,depth:1e5,penumbraSize:.5,shadowResolution:1024,shadowRadius:1};throw new Error("not implemented")}(e)}})(cb||(cb={})),(e=>{e.defaultShapeData={type:"PlaneEmitterShape",size:[100,100,100]},e.defaultCollisionData={colliderEntityId:null,collisionBounce:.75},e.defaultData=o({renderMaterial:{type:"particleMaterial",color:{r:1,g:.2,b:.545,a:1},color2:{r:.945,g:.714,b:.184,a:1},coloring:"gradient",ease:"linearFadeOut",easeSize:"linearFadeOut",transparent:!0,size:[40,40],texture:"pt_default_particle",spriteRotation:[0,0]},birthRatePerSec:50,gravity:1,noiseStrength:0,noiseScale:0,noiseSeed:1,noiseType:"curl",randomRotation:0,randomScale:.2,randomMass:.5,rootObjectType:"instancedMesh",life:1,direction:[0,0,0],directionMode:"axis",speed:10,shape:e.defaultShapeData,autoPlay:!0,emitTimeDelay:0,emitTimeCycle:"infinity",emitTimeDuration:1},e.defaultCollisionData)})(hb||(hb={})),(e=>{e.defaultData={enabled:"visibility",fusedBody:!0,rigidBody:"positioned",density:1,pointMass:0,gravityScale:1,friction:.5,damping:0,restitution:.2,colliderType:"convex",enabledRotation:[!0,!0,!0],enabledTranslation:[!0,!0,!0]}})(ub||(ub={})),(e=>{e.defaultData={castShadow:!0,receiveShadow:!0},e.equals=function(e,t){return e.castShadow===t.castShadow&&e.receiveShadow===t.receiveShadow}})(db||(db={})),(e=>{e.defaultData={flatShading:!1,wireframe:!1,side:0},e.equals=function(e,t){return e.flatShading===t.flatShading&&e.side===t.side&&e.wireframe===t.wireframe}})(pb||(pb={})),(e=>{e.defaultData=o(o({},pb.defaultData),db.defaultData)})(fb||(fb={})),(e=>{e.getMaterialData=function(e,t){let n=[];if("material"in e){var i,r;let s="string"==typeof e.material?null!==(i=t.materials[e.material])&&void 0!==i?i:null===(r=t.lib.materials[e.material])||void 0===r?void 0:r.asset:e.material;s&&n.push(s)}else if("materials"in e)for(let o of e.materials){var s,a;let e="string"==typeof o?null!==(s=t.materials[o])&&void 0!==s?s:null===(a=t.lib.materials[o])||void 0===a?void 0:a.asset:o;e&&n.push(e)}return n}})(mb||(mb={})),(e=>{e.defaultVideo={data:"",thumb:"/_assets/_videos/catThumb.png",type:"video",name:"Cat video"},e.maxSize=3e7})(gb||(gb={})),(e=>{e.is=function(e){return"texture"===e||"video"===e||"color"===e||"depth"===e||"normal"===e||"gradient"===e||"noise"===e||"fresnel"===e||"rainbow"===e||"toon"===e||"outline"===e||"particle"===e||"transmission"===e||"matcap"===e||"displace"===e||"pattern"===e||"light"===e}})(vb||(vb={})),(e=>{e.is=function(e){return"phong"===e||"toon"===e||"lambert"===e||"physical"===e}})(yb||(yb={}));var Ab,Cb,Mb,Tb,Pb=["mode","gradientType","noiseType","displacementType","projection","cnormal","crop","axis","side"],Db=["wrapping","image","video","name","minFilter","magFilter"];(e=>{e.patch=function(e,t){let{texture:n}=t,i=l(t,d);if(Object.assign(e,i),n){let t=e.texture;t&&Object.assign(t,n)}},e.defaultData=function(e,t){return"light"===e&&t?function(e){let t={mode:0,isMask:!1,visible:!0,bumpMap:void 0,bumpMapIntensity:5,roughnessMap:void 0,alphaOverride:1};switch(e){case"phong":return o(o({},t),{},{category:"phong",specular:{r:.2,g:.2,b:.2},shininess:5,type:"light",visible:!0,mode:0,occlusion:!0,alpha:.6});case"toon":return o(o({},t),{},{category:"toon",specular:{r:.2,g:.2,b:.2},shininess:10,type:"light",alpha:1});case"lambert":return o(o({},t),{},{category:"lambert",emissive:{r:0,g:0,b:0},type:"light",alpha:1,visible:!0,mode:0,occlusion:!0});case"physical":return o(o({},t),{},{category:"physical",roughness:.2,metalness:.2,reflectivity:.2,type:"light",alpha:1,visible:!0,mode:0,occlusion:!0})}}(t):function(e){let t={alpha:1,mode:0,isMask:!1,visible:!0};switch(e){case"texture":return o(o({},t),{},{type:"texture",size:[128,128],blending:0,axis:"x",side:2,projection:0,texture:{image:"image_0",wrapping:1e3,repeat:[1,1],offset:[0,0],rotation:0,minFilter:1008,magFilter:1006},crop:!1});case"video":return o(o({},t),{},{type:"video",size:[128,128],blending:0,axis:"x",side:2,projection:0,texture:{video:gb.defaultVideo,wrapping:1001,repeat:[1,1],offset:[0,0],rotation:0,minFilter:1008,magFilter:1006},crop:!1});case"color":return o(o({},t),{},{type:"color",color:Yy.fromHex(ab)});case"depth":return o(o({},t),{},{type:"depth",gradientType:1,smooth:!1,isVector:!0,isWorldSpace:!1,origin:[0,0,0],direction:[1,0,0],colors:[[1,1,1,1],[0,0,0,1]],steps:[0,1],near:50,far:200});case"normal":return o(o({},t),{},{type:"normal",cnormal:[1,1,1]});case"gradient":return o(o({},t),{},{type:"gradient",gradientType:0,smooth:!1,colors:[[0,0,0,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1]],steps:[0,1,1,1,1,1,1,1,1,1],num:2,angle:0,offset:[0,0],morph:[0,0]});case"noise":return o(o({},t),{},{type:"noise",size:[100,100,100],noiseType:0,scale:1,move:1,colorA:o(o({},Yy.fromHex(6710886)),{},{a:1}),colorB:o(o({},Yy.fromHex(6710886)),{},{a:1}),colorC:o(o({},Yy.fromHex(16777215)),{},{a:1}),colorD:o(o({},Yy.fromHex(16777215)),{},{a:1}),distortion:[1,1],fA:[1.7,9.2],fB:[8.3,2.8],voronoiStyle:0,highCut:1,lowCut:0,smoothness:.3,seed:0,quality:1});case"fresnel":return o(o({},t),{},{type:"fresnel",color:Qy.fromHexAndA(16777215,1),bias:.1,scale:1,intensity:2,factor:1});case"rainbow":return o(o({},t),{},{type:"rainbow",filmThickness:30,movement:0,wavelengths:[0,0,0],noiseStrength:0,noiseScale:1,offset:[0,0,0]});case"toon":return o(o({},t),{},{type:"toon",positioning:2,colors:[[0,0,0,1],[.5,.5,.5,1],[.5,.5,.5,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1]],steps:[0,.475,.525,1,1,1,1,1,1,1],num:4,source:[0,1e3,0],isWorldSpace:!0,noiseStrength:0,noiseScale:1,shadowColor:Qy.fromHexAndA(0,0),offset:[0,0,0]});case"outline":return o(o({},t),{},{type:"outline",outlineColor:Qy.fromHexAndA(0,1),contourColor:Qy.fromHexAndA(0,1),outlineWidth:2,contourWidth:5,outlineThreshold:.4,contourThreshold:0,outlineSmoothing:0,contourFrequency:10,contourDirection:[0,1,0],positionalLines:!1,compensation:!0});case"matcap":return o(o({},t),{},{type:"matcap",texture:{image:"matcap_0",wrapping:1001,repeat:[1,1],offset:[0,0],rotation:0,minFilter:1008,magFilter:1006}});case"transmission":return o(o({},t),{},{type:"transmission",thickness:10,ior:1.5,roughness:1});case"displace":return{visible:!0,type:"displace",displacementType:"noise",noiseType:0,scale:10,movement:1,offset:[0,0,0],intensity:8,voronoiStyle:0,smoothness:.3,seed:0,highCut:1,lowCut:0,quality:1};case"pattern":return o(o({},t),{},{type:"pattern",style:0,projection:0,axis:"y",blending:0,offset:[0,0],colorA:o(o({},Yy.fromHex(0)),{},{a:1}),colorB:o(o({},Yy.fromHex(16777215)),{},{a:1}),frequency:[10,10],size:.5,variation:0,smoothness:.5,zigzag:0,rotation:0,vertical:[0,1],horizontal:[0,1],sides:6})}}(e)}})(Ab||(Ab={})),(e=>{function t(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"layer1",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"layer2",i=new pg;return i.push({fi:0,data:Ab.defaultData("light",e),id:t}),i.push({fi:1,data:Ab.defaultData("color"),id:n}),{layers:i}}e.isMergable=function(e){return!e.layers.some((e=>"texture"===e.data.type&&0!==e.data.projection||"depth"===e.data.type&&!e.data.isWorldSpace||"noise"===e.data.type||"displace"===e.data.type))},e.getHash=function(e){let t="";return e.layers.forEach((e=>{Object.entries(e.data).forEach((e=>{let[n,i]=e;t+="".concat(n).concat(i),Array.isArray(i)?i.forEach((e=>t+="".concat(e))):"object"==typeof i?Object.values(i).forEach((e=>{t+="".concat("number"==typeof e?e.toFixed(4):e)})):t+="".concat(i)}))})),t},e.defaultEmptyData=function(){return{layers:new pg}},e.defaultData=function(){return t("phong",arguments.length>0&&void 0!==arguments[0]?arguments[0]:"layer1",arguments.length>1&&void 0!==arguments[1]?arguments[1]:"layer2")},e.withName=function(e,t){return o(o({},e),{},{name:t})},e.defaultTwoLayerData=t,e.defaultUIObjectMaterial=function(e){let t=Ab.defaultData("texture");e&&Object.assign(t.texture,{image:e});let n=new pg;return n.push({fi:0,data:t,id:"layer1"}),n.push({fi:1,data:o(o({},Ab.defaultData("transmission")),{},{alpha:1}),id:"layer2"}),n.push({fi:2,data:o(o({},Ab.defaultData("light","lambert")),{},{alpha:0}),id:"layer3"}),{layers:n}},e.defaultTwoLayerTextureData=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"phong",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"layer1",i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"layer2",r=Ab.defaultData("texture");Object.assign(r.texture,{image:e});let s=new pg;return s.push({fi:0,data:r,id:n}),s.push({fi:1,data:Ab.defaultData("light",t),id:i}),{layers:s}},e.defaultTwoLayerVideoTextureData=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"phong",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"layer1",i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"layer2",r=Ab.defaultData("video");Object.assign(r.texture,{video:e});let s=new pg;return s.push({fi:0,data:r,id:n}),s.push({fi:1,data:Ab.defaultData("light",t),id:i}),{layers:s}}})(Cb||(Cb={})),(e=>{e.defaultData=function(){return{points:new pg,roundness:0,shapeHoles:[],isClosed:!1}}})(Mb||(Mb={})),(e=>{e.defaultData=function(){return{points:new pg,lastInsertionPlane:null,subdivisions:12,isClosed:!1}}})(Tb||(Tb={}));var Ob,Ib={type:"Ellipse",width:50,height:50,spikes:16,angle:360,innerRadius:0};(e=>{e.merge=function(e,t){let n=o({},e);return zb.forEach((i=>{var r;Object.assign(n,{[i]:null!==(r=t[i])&&void 0!==r?r:e[i]})})),n}})(Ob||(Ob={}));var Rb,kb,Lb,Bb={shape:Ib,depth:1,offset:0,bevel:50,bevelSides:6,angle:0,twist:0,startScale:1,endScale:1,capType:"flat"},zb=["depth","offset","angle","twist","startScale","endScale"];(e=>{e.is2DParametricMesh=function(e){return"PolygonGeometry"===e||"RectangleGeometry"===e||"StarGeometry"===e||"TriangleGeometry"===e||"EllipseGeometry"===e||"UIGeometry"===e},e.isParametricMesh=function(e){return"PolygonGeometry"===e||"PolygonGeometry"===e||"RectangleGeometry"===e||"StarGeometry"===e||"TriangleGeometry"===e||"EllipseGeometry"===e||"PathGeometry"===e||"VectorGeometry"===e||"ConeGeometry"===e||"CubeGeometry"===e||"CylinderGeometry"===e||"DodecahedronGeometry"===e||"HelixGeometry"===e||"IcosahedronGeometry"===e||"LatheGeometry"===e||"PyramidGeometry"===e||"SphereGeometry"===e||"PlaneGeometry"===e||"BackdropGeometry"===e||"TorusGeometry"===e||"TorusKnotGeometry"===e||"BooleanGeometry"===e||"TextGeometry"===e||"InputGeometry"===e}})(Rb||(Rb={})),(e=>{e.merge=function(e,t){let n=o({},e);return Object.assign(n,t),"PathGeometry"===n.type&&"extrusion"in t&&t.extrusion&&(n.extrusion=o({},e.extrusion),Object.assign(n.extrusion,Ob.merge(n.extrusion,t.extrusion))),n}})(kb||(kb={})),(e=>{e.defaultData=function(t){if("RectangleGeometry"===t)return{width:320,height:320,type:t,cornerRadius:[0,0,0,0],cornerType:0,depth:0,extrudeBevelSize:0,extrudeBevelSegments:1};if("UIGeometry"===t)return{type:t,frame:"",cornerRadius:[0,0,0,0],cornerType:0,width:1,height:1};if("PathGeometry"===t)return{type:t,width:1,height:1,depth:1,path:Tb.defaultData(),extrusion:Bb};if("VectorGeometry"===t)return{width:1,height:1,type:t,subdivisions:12,shape:Mb.defaultData(),depth:0,extrudeBevelSize:0,extrudeBevelSegments:1};if("BooleanGeometry"===t)return{type:t,operation:2,width:0,height:0,depth:0,phongAngle:35};if("ShapeBlendGeometry"===t)return{type:t,width:0,height:0,depth:0,resolutionLevel:6,blendRange:100,useChildrenColors:!1};if("TextGeometry"===t)return{type:t,width:100,height:100,depth:0,horizontalAlign:1,verticalAlign:1,fontSize:16,lineHeight:1.2,letterSpacing:0,text:{textValue:""},textTransform:1,font:"Roboto_regular",editable:!1,extrudeBevelSize:0,extrudeBevelSegments:1};if("InputGeometry"===t)return o(o({},e.defaultData("TextGeometry")),{},{type:t,editable:!0});if("SphereGeometry"===t)return{type:"SphereGeometry",width:100,height:100,depth:100,widthSegments:64,heightSegments:64,phiStart:0,phiLength:2*Math.PI,thetaStart:0,thetaLength:180};throw new Error("not implemented")}})(Lb||(Lb={}));var Nb,Fb,Ub,jb,Vb,Gb,Hb,Wb,qb,Xb,Yb,Qb,Kb,Zb,Jb,$b,ex,tx,nx,ix,rx,sx,ax,ox,lx,cx,hx,ux,dx,px,fx,mx,gx,vx,yx,bx,xx,wx,Sx,_x,Ex,Ax,Cx=["width","height","depth"];function Mx(e){e.layers.forEach((e=>{if("depth"===e.type&&void 0!==e.colorA){let t=e.colorA,n=e.colorB,i=[[t.r,t.g,t.b,t.a],[n.r,n.g,n.b,n.a]],r=[0,1];for(let e=2;e<10;e++)i.push(i[1]),r.push(1);let s=o(o({},Am(Wg(e),"type","visible","isVector","isWorldSpace","origin","alpha","mode")),{},{near:Math.max(0,e.near),far:Math.max(0,e.far),colors:i,steps:r,num:2,direction:[1,0,0],smooth:!1,gradientType:1});Object.assign(e,s)}else if("depth"===e.type&&1===e.gradientType&&(e.near<0||e.far<0)){let t=o(o({},Wg(e)),{},{near:Math.max(e.near,0),far:Math.max(e.far,0)});Object.assign(e,t)}}))}function Tx(e,t){Object.values(e.shared.materials).forEach((e=>t(e)))}function Px(e,t){e.scene.objects.traverse(((e,n)=>{"materials"in n?n.materials.forEach(((e,i)=>{void 0===e&&(n.materials[i]=Cb.defaultData(),e=n.materials[i]),"string"!=typeof e&&t(e)})):"material"in n?"string"!=typeof n.material&&(void 0===n.material&&(n.material=Cb.defaultData()),t(n.material)):"Mesh"===n.type&&(void 0===n.material&&(n.material=Cb.defaultData()),t(n.material)),"overrides"in n&&Object.values(n.overrides).forEach((e=>{e.material&&"string"!=typeof e.material&&Object.getPrototypeOf(e.material)!==bg.prototype&&t(e.material)}))}))}function Dx(e){void 0===e.layers&&Object.assign(e,Cb.defaultTwoLayerData("lambert"))}function Ox(e){!e.layers||e.layers.forEach((e=>{if("depth"===e.type&&10===e.colors.length){let t=[...e.colors];t.push(e.colors[9]);let n=[...e.steps];n.push(e.steps[9]);let i=o(o({},Wg(e)),{},{colors:t,steps:n});Object.assign(e,i)}}))}function Ix(e){e.scene.objects.traverse(((e,t)=>{"materials"in t?t.materials.forEach((e=>{"string"!=typeof e&&Ox(e)})):"material"in t&&"string"!=typeof t.material&&Ox(t.material)})),Object.values(e.shared.materials).forEach((e=>Ox(e)))}function Rx(e){e.layers&&e.layers.forEach((e=>{"depth"===e.type&&void 0!==e.num&&(e.colors=e.colors.slice(0,e.num),e.steps=e.steps.slice(0,e.num),delete e.num)}))}function kx(e){e.layers&&e.layers.forEach((e=>{(function(e){return"displace"!==e.type})(e)&&void 0===e.isMask&&(e.isMask=!1),("texture"===e.type||"video"===e.type)&&void 0===e.blending&&(e.blending=0),("noise"===e.type||"displace"===e.type&&"noise"===e.displacementType)&&(void 0===e.voronoiStyle&&(e.voronoiStyle=0),void 0===e.highCut&&(e.highCut=1),void 0===e.lowCut&&(e.lowCut=0),void 0===e.smoothness&&(e.smoothness=.3),void 0===e.seed&&(e.seed=0),void 0===e.quality&&(e.quality=1))}))}function Lx(e){var t;let n=null===(t=e.layers.find((e=>"light"===e.type)))||void 0===t?void 0:t.data;if("basic"===(null===n||void 0===n?void 0:n.category)){let e=Ab.defaultData("light","phong"),t=n;Object.assign(t,e),t.visible=!1}}function Bx(e){Tx(e,Lx),Px(e,Lx)}function zx(e){e.layers.forEach((e=>{"light"===e.type&&"toon"!==e.category&&void 0===e.occlusion&&(e.occlusion=!0)}))}function Nx(e){e.layers&&e.layers.forEach((e=>{"light"===e.type&&void 0===e.bumpMapIntensity&&(e.bumpMapIntensity=5)}))}function Fx(e,t){if(t<1&&(Px(e,Mx),Tx(e,Mx),e.schema=1),t<2&&(function(e){Object.assign(e.scene.publish,{orbitControls:o(o({},lx.defaultData),Wg(e.scene.publish.orbitControls))})}(e),e.schema=2),t<3&&(function(e){function t(e){if(e.layers)for(let t of Object.values(e.layers))if(t)for(let[e,n]of Object.entries(t))if((Pb.includes(e)||"boolean"==typeof n)&&delete t[e],"texture"===e)for(let[t,i]of Object.entries(n))(Db.includes(t)||"boolean"==typeof i)&&delete n[t]}e.scene.objects.traverse(((e,n)=>{n.states.forEach((e=>{let n=e;n.material?t(n.material):n.materials&&n.materials.forEach((e=>{t(e)}))}))}))}(e),e.schema=3),t<4&&(function(e){e.scene.publish.withBackground=!0}(e),e.schema=4),t<5&&(function(e){e.scene.publish.settings.web={compress:!0,preload:!0,preset:1,logo:!0,hint:!1}}(e),e.schema=5),t<6&&(function(e){e.scene.objects.traverse(((e,t)=>{let n=t.cloner;n&&(n.radial.scale=n.radial.scale.map((e=>e+1)),n.linear.scale=n.linear.scale.map((e=>e+1)))}))}(e),e.schema=6),t<7&&(function(e){e.scene.objects.traverse(((e,t)=>{let n=t.geometry;n&&("DodecahedronGeometry"===n.type||"IcosahedronGeometry"===n.type)&&(n.detail=Math.round(n.detail))}))}(e),e.schema=7),t<8&&(e.schema=8),t<9&&(Ix(e),e.schema=9),t<10&&(function(e){e.scene.objects.traverse(((e,t)=>{"Mesh"===t.type&&("BooleanGeometry"===t.geometry.type||"SubdivGeometry"===t.geometry.type)&&(t.geometry.phongAngle=35)}))}(e),e.schema=10),t<11&&(function(e){e.scene.environment.ambientLight.softShadows=!1,e.scene.environment.ambientLight.softShadowQuality="low",e.scene.objects.traverse(((e,t)=>{("DirectionalLight"===t.type||"SpotLight"===t.type)&&(t.shadowResolution=1024,t.shadowRadius=1,t.depth=1e5)})),e.shared.penumbraSize=new Array(5).fill(.5)}(e),e.schema=11),t<12&&(Ix(e),e.schema=12),t<13&&(function(e){e.shared.audios=Tm({},ig.prototype)}(e),e.schema=13),t<14&&(function(e){let t=e.shared.materials;Object.entries(t).forEach((e=>{let[n,i]=e;if(!i.layers){let e={name:"Untitled Material",layers:[{fi:0,data:{type:"light",category:"phong",alpha:.6,visible:!0,mode:0,specular:{r:.2,g:.2,b:.2},shininess:5},id:"layer1"},{fi:1,data:{type:"color",alpha:1,visible:!0,mode:0,color:{r:.2823529411764706,g:.2823529411764706,b:.30196078431372547}},id:"layer2"}]};Object.assign(t,{[n]:e})}}))}(e),e.schema=14),t<15&&(function(e){Object.entries(Wg(e.shared.images)).filter((e=>!1===e[1].asset)).map((e=>e[0])).forEach((t=>{delete e.shared.images[t]})),Object.entries(Wg(e.shared.audios)).filter((e=>!1===e[1].asset)).map((e=>e[0])).forEach((t=>{delete e.shared.audios[t]}))}(e),e.schema=15),t<16&&(function(e){e.scene.publish.settings.web.preload=!1}(e),e.schema=16),t<17&&(Px(e,Rx),Tx(e,Rx),e.schema=17),t<18&&(Px(e,Dx),Tx(e,Dx),e.schema=18),t<19&&(function(e){Object.assign(e.scene.publish.settings,{video:o(o({},cx.defaultData.settings.video),Wg(e.scene.publish.settings.video))})}(e),e.schema=19),t<20&&(function(e){e.shared.fonts=Tm({},ig.prototype)}(e),function(e){let t=[];e.scene.objects.traverse(((n,i)=>{let r=i;if("TextFrame"===r.type){let i=Cb.defaultTwoLayerData("phong"),s="string"==typeof r.color?e.shared.colors[r.color]:r.color;i.layers[1].data.color={r:s.r,g:s.g,b:s.b},i.layers[1].data.alpha=r.alpha;let a=function(e){return e.replace(".typeface","").replace(/optimer/gi,"open sans").replace("space_mono","space mono").replace(/alma_mono/gi,"varela round").replace(/droid_sans_mono/gi,"noto sans mono").replace(/droid_sans|gentilis|gnomon_(simple|foreground)|helvetiker/gi,"roboto").replace(/droid_serif/gi,"roboto slab").replace("_sans"," sans").replace("crimson_text","crimson text").replace("medium_medium","medium").replace("fatface_fatface","fatface").replace("100hairline","thin").replace("200thin","extralight").replace("300light","light").replace("500medium","medium").replace("600semi","semibold").replace("800heavy","extrabold").replace("900black","black").replace(/bodoni_(11|16|24|36|48|72|96)([^_])/gi,"bodoni_$1_$2").replace(/bodoni_(11|16|24|36|48|72|96)/gi,"bodoni moda").replace(/(thin|hairline)(_regular)?/gi,"100").replace(/(extra|ultra)light(_regular)?/gi,"200").replace(/light(_regular)?/gi,"300").replace(/_book|_normal|_roman/gi,"_regular").replace(/medium(_regular)?/gi,"500").replace(/(semi|demi)bold(_regular)?/gi,"600").replace(/(extra|ultra)bold(_regular)?/gi,"800").replace(/bold(_regular)?/gi,"700").replace(/(black|heavy|fatface)(_regular)?/gi,"900").replace(/([1-9]00)_italic/gi,"$1italic").replace(/regularitalic/gi,"italic").replace(/regularitalic/gi,"italic").split(" ").map((e=>e.charAt(0).toUpperCase()+e.slice(1))).join(" ")}(r.font);void 0===e.shared.fonts[a]&&(e.shared.fonts[a]={name:a});let l=o(o(o({name:r.name},Qb.defaultData),ex.defaultData),{},{flatShading:!1,wireframe:!1,geometry:o(o({},Lb.defaultData("TextGeometry")),{},{width:r.width,height:r.height,font:a,depth:0,horizontalAlign:r.horizontalAlign,verticalAlign:r.verticalAlign,fontSize:1.40625*r.fontSize,lineHeight:r.lineHeight/1.40625,letterSpacing:r.letterSpacing-1,text:r.text,textTransform:r.textTransform,extrudeBevelSize:0,extrudeBevelSegments:1}),material:i,states:Wg(r.states),events:Wg(r.events),visible:r.visible,raycastLock:r.raycastLock,position:r.position,rotation:r.rotation,scale:r.scale,hiddenMatrix:r.hiddenMatrix}),c=Wg(e.scene.objects).parent(n);e.scene.objects.insertAfter(null!==c&&void 0!==c?c:null,n,[{id:n+"new",data:l,children:[]}]),t.push(n)}})),t.forEach((t=>{e.scene.objects.delete(t)}))}(e),e.schema=20),t<21&&(function(e){let t={0:"MouseDown",1:"MouseUp",2:"MouseHover",5:"KeyDown",6:"KeyUp",7:"Start",9:"LookAt",10:"Follow",11:"Scroll",12:"Audio",13:"GameControl"};e.scene.objects.traverse(((e,n)=>{n.events.forEach((e=>{if(t[Number(e.type)])if(Object.assign(e,{type:t[Number(e.type)]}),"Audio"===e.type&&"audioEvent"in e&&(Object.assign(e,{playAudio:e.audioEvent}),delete e.audioEvent),"GameControl"===e.type)Object.assign(e,{gameActions:{idle:new pg,move:new pg,jump:new pg}});else{let t=new pg;Object.assign(e,{actions:t}),("MouseDown"===e.type||"MouseUp"===e.type||"KeyDown"===e.type||"KeyUp"===e.type)&&"url"in e&&t.push({fi:0,id:at.generateUUID(),data:{type:"Link",url:e.url,delay:0}}),"targets"in e&&(e.targets.forEach(((e,n,i)=>{let r={easing:e.easing,duration:e.duration};6===e.easing?Object.assign(r,Am(e,"mass","stiffness","damping","velocity")):5===e.easing&&Object.assign(r,{control1:o({},e.control1),control2:o({},e.control2)});let s={repeat:e.repeat?-1:0,delay:e.delay,delayDirection:e.delayDirection,direction:e.cycle&&e.rewind?"pingpong-rewind":e.cycle?"pingpong":"normal"},a=o(o({state:e.state},s),r),l={allowSlerp:!0,type:"Transition",object:e.object,repeat:0,delay:0,delayDirection:void 0,direction:"normal",tweens:new pg({fi:0,id:at.generateUUID(),data:{state:void 0,repeat:0,delay:0,delayDirection:void 0,direction:"normal",duration:0,easing:4}},{fi:1,id:at.generateUUID(),data:a})};t.push({fi:i,id:n,data:l})})),delete e.targets)}}))}))}(e),function(e){e.scene.objects.traverse(((e,t)=>{function n(e,n){let i=new pg,r=[];if(t.events.forEach(((e,t,s)=>{if("Audio"===e.type&&e.trigger===n){let n;r.push(t),"play"===e.interaction?n=o(o({},Am(e,"interaction","audio","delay","volume","loop")),{},{triggerAfter:"after"in e?e.after:void 0,toggle:"after"in e?e.toggle:void 0,type:"Audio"}):("pause"===e.interaction||"stop"===e.interaction)&&(n=o(o({},Am(e,"interaction","delay","object","playAudio")),{},{type:"Audio"})),n&&i.push({fi:s,id:t,data:n})}})),r.forEach((e=>t.events.delete(e))),i.length){var s;let n=null===(s=t.events.find((t=>t.type===e)))||void 0===s?void 0:s.data;n?"actions"in n&&n.actions.insertBefore(null,i):t.events.insertBefore(null,[{id:at.generateUUID(),data:{type:e,actions:i}}])}}n("Start","start"),n("MouseDown","mouseDown"),n("MouseUp","mouseUp"),n("KeyDown","keyDown"),n("KeyUp","keyUp")}))}(e),e.schema=21),t<22&&(Bx(e),e.schema=22),t<23&&(function(e){e.scene.objects.traverse(((e,t)=>{"Mesh"===t.type&&"SubdivGeometry"===t.geometry.type&&(t.geometry.scaleBaked||(t.geometry.scaleBaked=[1,1,1]))}))}(e),e.schema=23),t<24&&(function(e){e.scene.objects.traverse(((e,t)=>{("Empty"===t.type||"Mesh"===t.type)&&t.cloner&&!t.cloner.randomnessObject&&!t.cloner.toObject&&!t.cloner.randomness&&(t.cloner=o(o({},t.cloner),{},{toObject:{object:"",spreadType:"random",scale:[0,0,0],rotation:[0,0,0],position:[0,0,0],axis:"x",seed:0,count:99,align:"normal"},randomness:!1,randomnessObject:{strength:100,scale:[0,0,0],rotation:[0,0,0],position:[0,0,0],movement:1,seed:0,freqScale:10,noiseType:"perlin"}}))}))}(e),e.schema=24),(t<25||void 0===e.shared.videos)&&(function(e){e.shared.videos=Tm({},ig.prototype)}(e),t<25&&(e.schema=25)),t<26&&(function(e){e.scene.objects.traverse(((t,n)=>{let i=e.scene.objects.unproxy().parent(t);if(i){let t=Wg(e.scene.objects.data(i));t&&"Mesh"===t.type&&"BooleanGeometry"===t.geometry.type&&"Mesh"===n.type&&(n.visible=!0!==Wg(n).booleanExclude)}}))}(e),e.schema=26),t<27&&(function(e){e.scene.objects.traverse(((e,t)=>{if("Mesh"===t.type){let e=t;"NonParametricGeometry"===t.geometry.type?void 0!==e.material&&delete e.material:void 0!==e.materials&&delete e.materials}}))}(e),e.schema=27),t<28&&(Bx(e),e.schema=28),t<29&&(function(e){function t(e){Object.setPrototypeOf(e,bg.prototype),e.texture&&Object.setPrototypeOf(e.texture,bg.prototype)}function n(e){Object.setPrototypeOf(e,bg.prototype);for(let n in e)t(e[n])}e.scene.objects.traverse(((e,t)=>{t.states.forEach((e=>{let t=e;if(t.material){let e=Wg(t.material).layers;n(e),t.material.layers=e}if(t.materials)for(let i=0;i<t.materials.length;i++){let e=t.materials[i],r=Wg(e).layers;n(r),e.layers=r}}))}))}(e),e.schema=29),t<30&&(function(e){e.scene.objects.traverse(((e,t)=>{"Mesh"===t.type&&"NonParametricGeometry"===t.geometry.type&&!("material"in t)&&!("materials"in t)&&(t.material=Cb.defaultTwoLayerData("phong"))}))}(e),e.schema=30),t<31&&(function(e){void 0===e.scene.publish.orbitControls.autoZoom&&(e.scene.publish.orbitControls.autoZoom=!1),e.scene.objects.traverse(((e,t)=>{("OrthographicCamera"===t.type||"PerspectiveCamera"===t.type)&&(void 0===t.orthographic.autoZoom&&(t.orthographic.autoZoom=!1),void 0===t.orthographic.autoZoomFrustumSize&&(t.orthographic.autoZoomFrustumSize=790))}))}(e),e.schema=31),t<33&&(function(e){e.scene.objects.traverse(((e,t)=>{void 0===t.pathSnapping&&(t.pathSnapping={pathId:null,slide:0,offset:0,orientation:"tangential"}),void 0===t.pathSnapping.offset&&(t.pathSnapping.offset=0)}))}(e),e.schema=33),t<34&&(function(e){void 0===e.scene.publish.mouseEventTarget&&(e.scene.publish.mouseEventTarget="canvas"),void 0===e.scene.publish.settings.web.hint&&(e.scene.publish.settings.web.hint=!1)}(e),e.schema=34),t<35&&(function(e){let{video:t}=e.scene.publish.settings;"gif"===t.format&&t.fps>48&&(t.fps=15)}(e),e.schema=35),t<36&&(function(e){e.scene.objects.traverse(((e,t)=>{t.events.forEach((e=>{"GameControl"===e.type&&(e.resetYPosition=Math.abs(e.resetYPosition-t.position[1]))}))}))}(e),e.schema=36),t<37&&(function(e){let t=e.scene.environment.usePhysics;e.scene.objects.traverse(((e,n)=>{t&&null===n.physics?n.collision=!1:n.collision="visibility"}))}(e),e.schema=37),t<38&&(Px(e,kx),Tx(e,kx),e.schema=38),t<39&&(function(e){e.scene.objects.traverse(((e,t)=>{t.events.forEach((e=>{"GameControl"===e.type&&(e.navmesh=Ax.defaultDataThirdPerson.navmesh)}))}))}(e),e.schema=39),t<40&&(function(e){e.scene.styles||(e.scene.styles=dx.defaultData())}(e),e.schema=40),t<41&&(function(e){void 0===e.scene.environment.ambientLight.occlusion&&(e.scene.environment.ambientLight.occlusion=!1),void 0===e.scene.environment.ambientLight.aoFullRes&&(e.scene.environment.ambientLight.aoFullRes=!1),void 0===e.scene.environment.ambientLight.radius&&(e.scene.environment.ambientLight.radius=256),void 0===e.scene.environment.ambientLight.bias&&(e.scene.environment.ambientLight.bias=.5),void 0===e.scene.environment.ambientLight.aoColor&&(e.scene.environment.ambientLight.aoColor={r:.19607843137254902,g:.19607843137254902,b:.19607843137254902}),Px(e,zx),Tx(e,zx)}(e),e.schema=41),t<42&&(function(e){e.scene.objects.traverse(((e,t)=>{t.events.forEach((e=>{"GameControl"===e.type&&Object.assign(e.gameActions,{run:new pg})}))}))}(e),e.schema=42),t<43&&(function(e){e.scene.objects.traverse(((e,t)=>{t.events.forEach((e=>{"GameControl"===e.type&&(e.keyAssignments=[...e.keyAssignments,["run","\u21e7"],["none","Ctrl"]])}))}))}(e),e.schema=43),t<99){var n;Px(e,Nx),Tx(e,Nx),null===e.scene.publish.playCamera&&(e.scene.publish.playCamera=rb);let t=Wg(e.scene.objects),i=e.scene.objects;e.scene.publish.playPage=sb,i.insertBefore(null,null,[{id:sb,data:o(o({},sx.defaultData),{},{backgroundColor:e.scene.backgroundColor,fog:e.scene.fog,postprocessing:e.scene.postprocessing,ao:Am(e.scene.environment.ambientLight,"occlusion","aoFullRes","radius","bias","aoColor"),publish:{playCamera:e.scene.publish.playCamera,gameControlObject:e.scene.publish.gameControlObject},shadow:Am(e.scene.environment.ambientLight,"softShadowQuality"),globalPhysics:o(o({},Gb.defaultData),Am(e.scene.environment,"usePhysics","gravity")),camera:null!==(n=Wg(e.scene.ownerCamera))&&void 0!==n?n:sx.defaultData.camera,name:"Scene"}),children:[]}]);for(let e of t)e.id!==fx.TRASH_CAN_ID&&i.move(sb,e.fi,e.id);let r=0,s=0;e.shared.penumbraSize&&e.scene.objects.traverse(((t,n)=>{var i;"DirectionalLight"===n.type?(n.penumbraSize=e.shared.penumbraSize[Math.min(r,2)],r+=1):"SpotLight"===n.type&&(n.penumbraSize=e.shared.penumbraSize[3+Math.min(s,1)],s+=1),(void 0===n.physics||null===n.physics)&&"Instance"!==n.type&&(n.physics={},Object.assign(n.physics,ub.defaultData)),void 0!==n.physics&&null!==n.physics&&(n.physics.enabled=null!==(i=n.collision)&&void 0!==i?i:"visibility",delete n.collision)})),e.schema=99}}function Ux(e){e.layers&&e.layers.forEach((e=>{"light"===e.type&&void 0===e.alphaOverride&&(e.alphaOverride=1)}))}(e=>{e.defaultData={enabled:!1,useBackgroundColor:!1,color:Yy.white,near:.1,far:2e3}})(Nb||(Nb={})),(e=>{let t={opacity:1,blendFunction:13,enabled:!1};e.defaultData={enabled:!1,pixelation:o(o({},t),{},{blendFunction:16,granularity:15}),bloom:o(o({},t),{},{blendFunction:16,intensity:1,blurScale:1,luminanceThreshold:.25,luminanceSmoothing:.025,kernelSize:3}),chromaticAberration:o(o({},t),{},{offset:[2,2]}),vignette:o(o({},t),{},{darkness:1,offset:0}),hueSaturation:o(o({},t),{},{hue:3,saturation:0}),brightnessContrast:o(o({},t),{},{brightness:.25,contrast:0}),depthOfField:o(o({},t),{},{focusDistance:100,focalLength:20,bokehScale:5}),noise:o(o({},t),{},{blendFunction:16})}})(Fb||(Fb={})),(e=>{e.defaultData={softShadowQuality:"low"}})(Ub||(Ub={})),(e=>{e.defaultData={enabled:!0,color:{r:.8274509803921568,g:.8274509803921568,b:.8274509803921568},intensity:.75}})(jb||(jb={})),(e=>{e.defaultData={occlusion:!1,aoFullRes:!1,radius:256,bias:.5,aoColor:{r:.19607843137254902,g:.19607843137254902,b:.19607843137254902}}})(Vb||(Vb={})),(e=>{e.defaultData={usePhysics:!1,gravity:-10}})(Gb||(Gb={})),(e=>{e.defaultData={playCamera:rb,gameControlObject:null}})(Hb||(Hb={})),(e=>{e.defaultData={backgroundColor:Qy.fromHexAndA(2960946,1),postprocessing:Fb.defaultData,fog:Nb.defaultData,globalPhysics:Gb.defaultData,ambient:jb.defaultData,ao:Vb.defaultData,shadow:Ub.defaultData,publish:Hb.defaultData}})(Wb||(Wb={})),(e=>{e.defaultData={colliderType:"box",size:[100,100,100],colliderHelperVisible:!0,forceType:"collider",forceRange:"global",forceIntensity:.5,forceDambing:.95}})(qb||(qb={})),(e=>{e.isComponentRelated=function(e){return"Component"===e||"Instance"===e},e.isEmptyOrComponent=function(e){return"Empty"===e||"Instance"===e}})(Xb||(Xb={})),(e=>{e.identity=o(o({},Ky.identity),{},{hiddenMatrix:Xy.identity}),e.fromObject=function(e){return{position:e.position,rotation:e.rotation,scale:e.scale,hiddenMatrix:e.hiddenMatrix}},e.merge=function(e,t){return{position:(null===t||void 0===t?void 0:t.position)||e.position,rotation:(null===t||void 0===t?void 0:t.rotation)||e.rotation,scale:(null===t||void 0===t?void 0:t.scale)||e.scale,hiddenMatrix:(null===t||void 0===t?void 0:t.hiddenMatrix)||e.hiddenMatrix}},e.diff=function(e,t){return Mm({position:Hy.isEqual(e.position,t.position)?void 0:t.position,rotation:Hy.isEqual(e.rotation,t.rotation)?void 0:t.rotation,scale:Hy.isEqual(e.scale,t.scale)?null:t.scale,hiddenMatrix:Xy.isEqual(e.hiddenMatrix,t.hiddenMatrix)?void 0:t.hiddenMatrix})}})(Yb||(Yb={})),(e=>{e.defaultData=o(o({states:new pg,events:new pg,visible:!0,raycastLock:!1,physics:ub.defaultData,pathSnapping:{pathId:null,slide:0,offset:0,orientation:"tangential"}},Yb.identity),{},{cloner:null})})(Qb||(Qb={})),(e=>{e.defaultData=o({type:"Empty"},Qb.defaultData)})(Kb||(Kb={})),(e=>{e.defaultData=o(o({type:"ParticleCollider"},qb.defaultData),Qb.defaultData)})(Zb||(Zb={})),(e=>{e.defaultData=o({type:"Component"},Qb.defaultData)})(Jb||(Jb={})),(e=>{e.defaultData=o(o({type:"Particle"},Qb.defaultData),hb.defaultData)})($b||($b={})),(e=>{e.defaultData=o(o({type:"Mesh"},Qb.defaultData),fb.defaultData)})(ex||(ex={})),(e=>{e.defaultData=o(o(o({},Qb.defaultData),Yb.identity),{},{position:[0,0,tb.DefaultTargetOffset]},tb.defaultData)})(tx||(tx={})),(e=>{e.defaultData=function(e){return o(o({},Qb.defaultData),cb.defaultData(e))},e.defaultDirectionalLightData=o(o({},e.defaultData("DirectionalLight")),{},{position:[200,300,300],name:"Directional Light",intensity:.7})})(nx||(nx={})),(e=>{function t(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;for(;n<t.length;){let i=e?e[t[n]]:void 0;if(t.length===n+1)return i;if(!i)return;e=i.descendants,n+=1}}e.resolveWithDes=t,e.resolve=function(e,n){let i=t(e,n,arguments.length>2&&void 0!==arguments[2]?arguments[2]:0);if(i){let e=Object.keys(i);if(1===e.length&&"descendants"===e[0])return}return i}})(ix||(ix={})),(e=>{function t(e,t){return o(o(o({},Qb.defaultData),t),{},{component:e,overrides:new bg,physics:void 0,events:void 0,type:"Instance"})}e.rootOverrideProps=["physics","events"],e.compositeNonOptionalOverrideProps=["geometry"],e.compositeEntireOverrideOverrideProps=["material"],e.ofComponent=t,e.fromComponentData=function(e){let n=Yb.fromObject(e.data);return t(e.id,n)}})(rx||(rx={})),(e=>{e.defaultData=o(o(o({type:"Page"},Qb.defaultData),{},{physics:o(o({},ub.defaultData),{},{fusedBody:!1})},Wb.defaultData),{},{camera:tx.defaultData}),e.isUIPage=function(e){return void 0!==e.uiScene}})(sx||(sx={})),(e=>{e.defaultCamera=o({position:[0,0,1e3],scale:[1,1,1],rotation:[0,0,0],hiddenMatrix:Xy.identity,name:"Play Camera",visible:!0,raycastLock:!1,physics:ub.defaultData,states:new pg,events:new pg,cloner:null,pathSnapping:{pathId:null,orientation:"tangential",slide:0,offset:0}},tb.defaultData),e.KeysByResetCategory={States:["states"],Events:["events"],Material:["material","materials"],Geometry:["geometry"],Position:["position"],Rotation:["rotation"],Scale:["scale"],Transform:["position","scale","rotation","hiddenMatrix"],Name:["name"],Visibility:["visible","raycastLock","flatShading","wireframe","side"],Shadows:["castShadow","receiveShadow"],Cloner:["cloner"],Physics:["physics"]},e.defaultMeshObject=o(o(o({name:"Rectangle"},Qb.defaultData),ex.defaultData),{},{geometry:Lb.defaultData("RectangleGeometry"),material:Cb.defaultTwoLayerData("phong","layer1","layer2")}),e.defaultBooleanObject=o(o(o({name:"Boolean"},Qb.defaultData),ex.defaultData),{},{geometry:Lb.defaultData("BooleanGeometry"),material:Cb.defaultTwoLayerData("phong","layer1","layer2")}),e.defaultShapeBlendObject=o(o(o({name:"Shape Blend"},Qb.defaultData),ex.defaultData),{},{geometry:Lb.defaultData("ShapeBlendGeometry"),material:Cb.defaultTwoLayerData("phong","layer1","layer2")}),e.defaultTextObject=o(o(o({name:"Text"},Qb.defaultData),ex.defaultData),{},{geometry:Lb.defaultData("TextGeometry"),material:Cb.defaultTwoLayerData("phong","layer1","layer2")}),e.defaultInputObject=o(o(o({name:"Input"},Qb.defaultData),ex.defaultData),{},{geometry:Lb.defaultData("InputGeometry"),material:Cb.defaultTwoLayerData("phong","layer1","layer2")})})(ax||(ax={})),(e=>{e.newEmpty=function(e,t){let n={name:t};return"Mesh"===e.type?(n.geometry={},"material"in e&&(n.material={layers:new bg}),"materials"in e&&(n.materials=e.materials.map((e=>({layers:new bg}))))):eb.is(e.type)&&(n.perspective={},n.orthographic={}),n},e.toOps=function(e,t){let n,i=[],r={orthographic:0,perspective:0,geometry:0};function s(e,t){for(let[n,r]of Object.entries(t.layers)){let{texture:t}=r,s=l(r,p);if(void 0!==t&&Object.keys(t).length>0){let r={path:[...e,"layers",n,"texture"],props:t,type:0};i.push(r)}if(Object.keys(s).length>0){let t={path:[...e,"layers",n],props:s,type:0};i.push(t)}}}for(let[a,l]of Object.entries(t))if("name"!==a)if("cloner"===a)i.push(...ib.toOps(l,["cloner"]));else if("pathSnapping"===a)i.push({path:[a],props:{slide:l.slide,offset:l.offset},type:0});else if("material"===a)s(["material"],l);else if("materials"===a)for(let[e,t]of Object.entries(l))s(["materials",e],t);else if(0===r[a]){if("geometry"===a&&void 0!==l.extrusion){let e={path:[a,"extrusion"],props:l.extrusion,type:0};i.push(e),l=o({},l),delete l.extrusion}if(Object.keys(l).length>0){let e={path:[a],props:l,type:0};i.push(e)}}else void 0===n&&(n={path:[],props:{},type:0},i.push(n)),n.props[a]=l;return i},e.patch=function(e,t){var n,i,r,s,a,l,c,h;if(void 0===t)return e;let u=o({},e);if(Object.assign(u,Yb.merge(u,t)),Object.assign(u,{pathSnapping:Object.assign({},u.pathSnapping,{slide:null!==(n=null!==(i=null===(r=t.pathSnapping)||void 0===r?void 0:r.slide)&&void 0!==i?i:null===(s=u.pathSnapping)||void 0===s?void 0:s.slide)&&void 0!==n?n:0,offset:null!==(a=null!==(l=null===(c=t.pathSnapping)||void 0===c?void 0:c.offset)&&void 0!==l?l:null===(h=u.pathSnapping)||void 0===h?void 0:h.offset)&&void 0!==a?a:0})}),eb.is(e.type)){var d,p;u.orthographic=o({},u.orthographic),u.perspective=o({},u.perspective);let e=t;void 0!==(null===(d=e.orthographic)||void 0===d?void 0:d.zoom)&&(u.orthographic.zoom=e.orthographic.zoom),void 0!==(null===(p=e.perspective)||void 0===p?void 0:p.zoom)&&(u.perspective.zoom=e.perspective.zoom),void 0!==e.isUpVectorFlipped&&(u.isUpVectorFlipped=e.isUpVectorFlipped),void 0!==e.targetOffset&&(u.targetOffset=e.targetOffset)}else if("Mesh"===e.type)"geometry"in t&&Object.assign(u,{geometry:kb.merge(u.geometry,t.geometry)}),(t.material||t.materials)&&(u=function(e,t){if(void 0===t)return e;let n=o({},e);return"material"in n&&"material"in t&&t.material&&(n.material=Hg(n.material,(e=>{if("string"!=typeof e)for(let[n,i]of Object.entries(t.material.layers)){let t=e.layers.data(n);t&&Ab.patch(t,i)}})).data),n.materials&&t.materials&&(n.materials=Hg(n.materials,(e=>{for(let r=0;r<n.materials.length;r++){let n=t.materials[r];if("string"!=typeof n)for(let[t,s]of Object.entries(n.layers)){var i;let n=null===(i=e[r])||void 0===i||null===(i=i.layers)||void 0===i?void 0:i.data(t);n&&Ab.patch(n,s)}}})).data),n}(u,t)),u.cloner&&"cloner"in t&&Object.assign(u,{cloner:nb.merge(u.cloner,t.cloner)});else if("Empty"===e.type)u.cloner&&"cloner"in t&&Object.assign(u,{cloner:nb.merge(u.cloner,t.cloner)});else if(lb.is(e.type)){let e=t;void 0!==e.intensity&&(u.intensity=e.intensity),void 0!==e.color&&("string"==typeof e.color?u.color=e.color:u.color=Yy.clone(e.color))}return u}})(ox||(ox={})),(e=>{e.defaultData={enablePan:!0,enableZoom:!0,enableRotate:!0,enableDamping:!0,rotationLimitsMode:0,rotationVerticalOffset:{min:Math.PI/4,max:Math.PI/4},rotationHorizontalOffset:{min:Math.PI/4,max:Math.PI/4},rotationSoftLimit:2,panLimitsMode:0,panVerticalOffset:{min:250,max:250},panHorizontalOffset:{min:250,max:250},panSoftLimit:2,zoomLimitsEnabled:!1,zoomLimits:{min:.1,max:2},autoRotate:!1,autoRotateSpeed:2,autoRotateClockwise:!0,hoverRotatePanMode:0,hoverRotatePanStrength:20,hoverRotateDamping:.125,isTouchZoom:!0,orbitTouches:2,panTouches:3,resetHoverEffectOnPointerLeave:!0}})(lx||(lx={})),(e=>{e.defaultData={orbitControls:lx.defaultData,playPage:sb,withBackground:!0,preventScroll:!1,preventTouchScroll:!1,hideCursor:!1,mouseEventTarget:"canvas",joystickSizeAndXYOffset:Array(12).fill(0).map(((e,t)=>{let n=0,i=0;return t<5?i=-30:t<10&&(i=30),0===t||10===t||5===t?n=30:(4===t||11===t||9===t)&&(n=-30),[120,[n,i],"show"]})),settings:{image:{format:"jpg",ratio:1},video:{format:"mp4",imageFormat:"jpg",fps:30,mbps:80,ratio:Math.max(1,typeof window<"u"?Math.floor(window.devicePixelRatio):1),stopMode:"manual",duration:5e3},web:{logo:!0,compress:!0,preset:1,preload:!0,hint:!1,imageQuality:70}},stopRaycast:!0,hdTransmission:!1}})(cx||(cx={})),(e=>{e.defaultData={id:"basic",label:"Basic",style:"None",prompt:""}})(hx||(hx={})),(e=>{e.defaultData={weather:0,shadows:0,lightOrigin:0,temperature:0,sun:0,camera:0,environment:0,particles:0,nature:0,floor:0}})(ux||(ux={})),(e=>{e.defaultData=()=>({mode:"line-art-both",prompt:"",negativePrompt:"",style:o({},hx.defaultData),isRandomSeed:!0,seed:e.generateSeed(),guessMode:!1,advanced:!1,steps:20,guidanceScale:7.5,controlNetScale:1,modifiers:ux.defaultData}),e.generateSeed=()=>Math.round(1e5*Math.random())})(dx||(dx={})),(e=>{e.physicsEnabled=function(e){return void 0!==e.find((e=>"Page"===e.data.type&&e.data.globalPhysics.usePhysics))},e.traverseModuleInstances=function(e,t,n){e.scene.objects.traverseFrom(t,((t,i)=>{if("Instance"===i.type){var r;let s=null===(r=Hx.getComponentData(e,i.component))||void 0===r?void 0:r.data;s&&n(t,i,s.events)}else n(t,i,i.events)}))}})(px||(px={})),(e=>{function t(){let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],i=[],r=ax.defaultMeshObject;t&&(i.push(o({},e.defaultLight)),i.push({fi:1,id:"7ba78968-2a55-48f2-b14c-5191da3e075e",data:r,children:[]})),i.push(...n);let s=new dg;return s.push({fi:1,id:sb,data:o(o({},sx.defaultData),{},{name:"Scene 1"}),children:i}),s}function n(t){return o(o({},e.defaultData),{},{objects:Tm(t,dg.prototype)})}e.TRASH_CAN_ID="830a2708-8ed9-49cf-a68e-085299892222",e.defaultLight={fi:-1,data:nx.defaultDirectionalLightData,id:"830a2708-8ed9-49cf-a68e-085299899103",children:[]},e.createDefaultObjectTreeWithPage=t,e.defaultData={objects:t(),publish:cx.defaultData,styles:dx.defaultData()},e.emptyDataWithoutPage=function(){return{objects:new dg,publish:cx.defaultData,styles:dx.defaultData()}},e.emptyDataWithPage=function(){return{objects:t(!(arguments.length>0&&void 0!==arguments[0])||arguments[0]),publish:cx.defaultData,styles:dx.defaultData()}},e.emptyData=function(){return{objects:new dg,publish:o({},cx.defaultData),styles:dx.defaultData()}},e.withObjs=n,e.withObj=function(e,t){return n([{id:e,data:t,children:[],fi:0}])}})(fx||(fx={})),(e=>{e.defaultData={preset:"fullscreen",allowResponsive:!1,size:[512,512],coords:[0,0],sceneScale:1,color:{r:0,g:0,b:0,a:.5}}})(mx||(mx={})),(e=>{e.defaultData=e=>({url:e,name:"New Webhook",parametersSchemas:new pg}),e.defaultParameterValueByType=e=>"number"===e?0:"boolean"!==e&&""})(gx||(gx={})),(e=>{e.defaultData=function(e){return{url:e,method:arguments.length>1&&void 0!==arguments[1]?arguments[1]:"GET",name:"New API",headers:new pg,queries:new pg,autoStart:!0}}})(vx||(vx={})),(e=>{function t(e){return void 0!==e.textValue}function n(e){return"boolean"==typeof e}e.isTextValue=t,e.isNumber=function(e){return"number"==typeof e},e.isBoolean=n,e.typeOfVariable=function(e){return t(e)?"string":n(e)?"boolean":"number"},e.getDisplayedValue=function(t){var n;return e.isTextValue(t)?Array.isArray(t.textValue)?t.textValue.map((e=>{var n;return e.toString().padStart(null!==(n=t.padding)&&void 0!==n?n:2,"0")})).join(null!==(n=t.deliminator)&&void 0!==n?n:":")+(void 0!==t.suffix?" "+t.suffix:""):t.textValue.toString():e.isBoolean(t)?t?"True":"False":e.isNumber(t)?parseFloat(t.toFixed(3)).toString():t.toString()}})(yx||(yx={})),(e=>{e.all=["images","videos","colors","audios","particles","fonts","materials","variables"]})(bx||(bx={})),(e=>{e.all=[...bx.all,"components"]})(xx||(xx={})),(e=>{e.defaultData=function(){return{images:new ig,videos:new ig,colors:new ig,audios:new ig,particles:new ig,fonts:new ig,materials:new ig,components:new ig,variables:new ig,userAPIs:new ig,userWebhooks:new ig}}})(wx||(wx={})),(e=>{e.defaultData=function(){return{images:new ig,videos:new ig,colors:new ig,audios:new ig,particles:new ig,fonts:new ig,materials:new ig,components:new ig,variables:new ig,userAPIs:new ig,userWebhooks:new ig}}})(Sx||(Sx={})),(e=>{e.defaultColors=function(){let e={"89b10010-844c-11ec-a8a3-0242ac120002":{r:.5,g:.5,b:.5,a:1,name:"Default Color"}};return Tm(e,ig.prototype)},e.defaultImages=function(){return Tm({},ig.prototype)},e.emptyData=function(){return{catelogs:new ig,materials:new ig,images:new ig,videos:new ig,colors:new ig,audios:new ig,particles:new ig,fonts:new ig,variables:new pg,userAPIs:new ig,userWebhooks:new ig,lib:Sx.defaultData()}},e.defaultVariables=function(e){switch(e){case"number":return{value:0,name:"Number"};case"boolean":return{value:!1,name:"Boolean"};case"string":return{value:{textValue:"String value"},name:"String"};case"time":let t=[0,0,0];return{name:"Time",value:{textValue:t,deliminator:":",padding:2,suffix:"AM"},dynamicVariableType:"time",format:"HH:mm:ss",format12h24h:"12ampm",timeZone:null,hasEnd:!1,endValue:{textValue:t,deliminator:":",padding:2,suffix:"AM"},autoStart:!0,repeat:!1};case"counter":return{name:"Counter",value:0,dynamicVariableType:"counter",updateInterval:1e3,increment:1,autoStart:!0,hasEnd:!0,endValue:60,repeat:!0,randomStart:!1,range:[0,100],decimals:0};case"random":return{name:"Random",value:0,dynamicVariableType:"random",updateInterval:1e3,increment:1,autoStart:!0,isStatic:!1,hasEnd:!0,endValue:60,repeat:!0,min:0,max:100,decimals:0};default:console.error("Unknown variable type",e)}},e.getFormattedTimerTime=function(e,t){if("HH:mm:ss"===t.format){let t=Math.floor(e/3600),n=Math.floor((e-3600*t)/60);return{textValue:[t,n,Math.round(e-3600*t-60*n)]}}if("mm:ss"===t.format){let t=Math.floor(e/60);return{textValue:[t,Math.round(e-60*t)]}}return e="number"===t.format?Math.round(e):Math.round(1e3*e)/1e3}})(_x||(_x={})),(e=>{e.list=["idle","move","jump","run"]})(Ex||(Ex={})),(e=>{e.defaultColliderData={type:"capsule",height:200,radius:50,position:[0,0,0],rotation:[0,0,0]},e.defaultDataThirdPerson={moveMode:"walk",forwardDirection:"+z",speedTranslate:1e3,speedRotate:100,runMultiplier:2,rotationMode:"normal",rotBy:"keys",rotByTouch:"drag",delayPos:[.3,.3],delayRot:[.3,.3],keyAssignments:[["moveNegZ","W"],["moveNegX","A"],["movePosZ","S"],["movePosX","D"],["rotPosX","\u25b2"],["rotPosY","\u25c0"],["rotNegX","\u25bc"],["rotNegY","\u25b6"],["jump","Space"],["run","\u21e7"],["none","Ctrl"]],touchControl:!0,joystickPosLoc:5,joystickRotLoc:11,jumpTouchButtonLoc:9,collider:e.defaultColliderData,colliderHelperVisible:!0,collisionEnabled:!0,jumpPower:100,resetYPosition:3e3,alignToGround:!1,autoOrientMove:!0,orientWith:"camera",orientMode:"radial",delayPosCamera:.3,delayRotCamera:.3,camera:"",cameraXAxis:"Limit",cameraYAxis:"Free",cameraRotXLimits:[0,Math.PI/2],cameraRotYLimits:[-Math.PI/2,Math.PI/2],gameActions:{idle:new pg,move:new pg,jump:new pg,run:new pg},navmesh:{enabled:!1,ch:6,cs:6,walkableClimb:5,walkableHeight:1,walkableRadius:0,zones:"all",objects:[],helperVisible:!0,destinationHelperRadius:0,destinationHelperColor:Qy.fromHexAndA(3728051,1)}}})(Ax||(Ax={}));var jx=180/Math.PI;function Vx(e){e.rotation=e.rotation.slice(0,3).map((e=>e*jx))}function Gx(e){var t,n,i;Vx(e),"Page"===e.type&&Vx(e.camera),null===(t=e.states)||void 0===t||t.forEach((e=>{void 0===e.rotation||null===e.rotation||(e.rotation=e.rotation.slice(0,3).map((e=>e*jx)))}));let r=e.geometry;r&&"SphereGeometry"===r.type&&(r.thetaLength=(null!==(n=r.thetaLength)&&void 0!==n?n:180)*jx),r&&"TorusGeometry"===r.type&&(r.arc=r.arc*jx),r&&"PathGeometry"===r.type&&(r.extrusion.angle*=jx,r.extrusion.twist*=jx),"Mesh"===e.type&&"TextGeometry"===e.geometry.type&&(e.geometry.text={textValue:e.geometry.text}),Array.isArray(Wg(e.events))&&(null===(i=e.events)||void 0===i||i.forEach((e=>{("MouseDown"===e.type||"MouseUp"===e.type||"MousePress"===e.type||"KeyDown"===e.type||"KeyUp"===e.type||"KeyPress"===e.type||"Collision"===e.type||"Trigger"===e.type)&&(e.runMode=e.toggle?"Toggle":"Repeat")})))}var Hx,Wx,qx,Xx,Yx,Qx,Kx,Zx,Jx,$x,ew,tw,nw,iw,rw,sw,aw,ow,lw,cw,hw=115;function uw(e,t){t(e.data);for(let n of e.children)uw(n,t)}function dw(e){var t;let n=null!==(t=e.schema)&&void 0!==t?t:104;n!==hw&&n<105&&(uw(e.asset,Gx),e.schema=105)}function pw(e){var t;let n=null!==(t=e.schema)&&void 0!==t?t:0;if(n!==hw){console.warn("updating from ",n,"to ",hw),Fx(e,n),n<100&&(void 0===e.scene.publish.joystickSizeAndXYOffset&&(e.scene.publish.joystickSizeAndXYOffset=cx.defaultData.joystickSizeAndXYOffset),e.schema=100),n<101&&(Px(e,Ux),Tx(e,Ux),e.schema=101),n<102&&(function(e){e.scene.objects.traverse(((e,t)=>{let n=t.geometry;n&&"PathGeometry"===n.type&&(n.extrusion.capType="flat",n.extrusion.bevel=50,n.extrusion.bevelSides=6,"Custom"===n.extrusion.shape.type&&(n.extrusion.shape.shapeQuality="low"))}))}(e),e.schema=102),n<104&&(e.shared.catelogs=new ig,e.shared.lib=Sx.defaultData(),e.schema=104),n<105&&(function(e){e.shared.variables=Tm({},ig.prototype)}(e),e.scene.objects.traverse(((e,t)=>{Gx(t)})),e.schema=105);for(let t of Object.values(e.shared.lib.components))dw(t);n<106&&(function(e){let t=Wg(e.shared.variables);e.shared.variables=Tm(Object.entries(null!==t&&void 0!==t?t:{}).map(((e,t)=>{let[n,i]=e;return{fi:t,id:n,data:i}})),pg.prototype)}(e),e.schema=106),n<107&&(e.shared.lib.variables=Sx.defaultData().variables,e.schema=107),n<109&&(function(e){e.shared.particles=Tm({},ig.prototype),e.shared.lib&&(e.shared.lib.particles=Sx.defaultData().particles)}(e),e.schema=109),n<110&&(function(e){e.scene.objects.traverse(((e,t)=>{"Particle"===t.type&&"number"==typeof t.renderMaterial.size&&Object.assign(t.renderMaterial,{size:[t.renderMaterial.size,t.renderMaterial.size]})}))}(e),e.schema=110),n<111&&(e.scene.objects.traverse(((e,t)=>{!function(e){var t;Array.isArray(Wg(e.events))&&(null===(t=e.events)||void 0===t||t.forEach((e=>{"disabled"in e||(e.disabled=!1),("MouseDown"===e.type||"MouseUp"===e.type||"MousePress"===e.type)&&(e.mode=e.mode||"Object")})))}(t)})),e.schema=111),n<112&&(function(e){e.scene.objects.traverse(((e,t)=>{"Page"===t.type&&(t.postprocessing.depthOfField.focusDistance=100,t.postprocessing.depthOfField.focalLength=20,t.postprocessing.depthOfField.bokehScale=5)}))}(e),e.schema=112),n<113&&(function(e){e.scene.objects.traverse(((e,t)=>{var n;!1!==Array.isArray(Wg(t.events))&&(null===(n=t.events)||void 0===n||n.forEach((e=>{var t,n,i,r,s,a,o,l,c;let h=e.runMode;"MouseDown"===e.type||"MouseUp"===e.type||"KeyDown"===e.type||"KeyUp"===e.type||"Collision"===e.type||"Trigger"===e.type?null===(t=e.actions)||void 0===t||t.forEach((e=>{"Transition"===e.type&&(e.runMode=null!==h&&void 0!==h?h:"Repeat"),("Animation"===e.type||"SwitchCamera"===e.type)&&(e.runMode="Toggle"===h?"Toggle":"Normal")})):"MouseHover"===e.type||"MousePress"===e.type||"KeyPress"===e.type?null===(n=e.actions)||void 0===n||n.forEach((e=>{("Transition"===e.type||"Animation"===e.type||"SwitchCamera"===e.type)&&(e.runMode="Toggle")})):"GameControl"===e.type?(delete e.actions,Object.keys(e.gameActions).forEach((t=>{var n;null===(n=e.gameActions[t])||void 0===n||n.forEach((e=>{"Transition"===e.type&&(e.runMode="Repeat"),"Animation"===e.type&&(e.runMode="Normal")}))}))):"DragDrop"===e.type?(delete e.actions,null!==(i=e.dragDropActions)&&void 0!==i&&null!==(i=i.drag)&&void 0!==i&&i.forEach((e=>{("Transition"===e.type||"Animation"===e.type||"SwitchCamera"===e.type)&&(e.runMode="Toggle")})),null===(r=e.dragDropActions)||void 0===r||null===(r=r.drop)||void 0===r||r.forEach((e=>{("Transition"===e.type||"Animation"===e.type||"SwitchCamera"===e.type)&&(e.runMode="Toggle")}))):"Resize"===e.type?(delete e.actions,null===(s=e.breakpoints)||void 0===s||s.forEach((e=>{var t;null===(t=e.actions)||void 0===t||t.forEach((e=>{("Transition"===e.type||"Animation"===e.type||"SwitchCamera"===e.type)&&(e.runMode="Toggle")}))}))):"Start"===e.type?null===(a=e.actions)||void 0===a||a.forEach((e=>{"Transition"===e.type&&(e.runMode="Once"),("Animation"===e.type||"SwitchCamera"===e.type)&&(e.runMode="Normal")})):"VariableChange"===e.type||"Scroll"===e.type?null===(o=e.actions)||void 0===o||o.forEach((e=>{"Transition"===e.type&&(e.runMode="Repeat"),("Animation"===e.type||"SwitchCamera"===e.type)&&(e.runMode="Normal")})):"Conditional"===e.type&&(delete e.actions,null!==(l=e.inActions)&&void 0!==l&&l.forEach((e=>{"Transition"===e.type&&(e.runMode="Repeat"),("Animation"===e.type||"SwitchCamera"===e.type)&&(e.runMode="Normal")})),null===(c=e.outActions)||void 0===c||c.forEach((e=>{"Transition"===e.type&&(e.runMode="Repeat"),("Animation"===e.type||"SwitchCamera"===e.type)&&(e.runMode="Normal")})))})))}))}(e),e.schema=113),n<114&&(void 0===e.scene.publish.settings.web.imageQuality&&(e.scene.publish.settings.web.imageQuality=70),e.schema=114),n<115&&(function(e){e.shared.userAPIs=Tm({},ig.prototype),e.shared.userWebhooks=Tm({},ig.prototype),e.shared.lib&&(e.shared.lib.userAPIs=Sx.defaultData().userAPIs,e.shared.lib.userWebhooks=Sx.defaultData().userWebhooks)}(e),e.schema=115)}}function fw(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=null!==e[0].index,i=new Set(Object.keys(e[0].attributes)),r=new Set(Object.keys(e[0].morphAttributes)),s={},a={},o=e[0].morphTargetsRelative,l=new di,c=0;for(let h=0;h<e.length;++h){let u=e[h],d=0;if(n!==(null!==u.index))return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+h+". All geometries must have compatible attributes; make sure index attribute exists among all geometries, or in none of them."),null;for(let e in u.attributes){if(!i.has(e))return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+h+'. All geometries must have compatible attributes; make sure "'+e+'" attribute exists among all geometries, or in none of them.'),null;void 0===s[e]&&(s[e]=[]),s[e].push(u.attributes[e]),d++}if(d!==i.size)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+h+". Make sure all geometries have the same number of attributes."),null;if(o!==u.morphTargetsRelative)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+h+". .morphTargetsRelative must be consistent throughout all geometries."),null;for(let e in u.morphAttributes){if(!r.has(e))return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+h+".  .morphAttributes must be consistent throughout all geometries."),null;void 0===a[e]&&(a[e]=[]),a[e].push(u.morphAttributes[e])}if(t){let e;if(n)e=u.index.count;else{if(void 0===u.attributes.position)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+h+". The geometry must have either an index or a position attribute"),null;e=u.attributes.position.count}l.addGroup(c,e,h),c+=e}}if(n){let t=0,n=[];for(let i=0;i<e.length;++i){let r=e[i].index;for(let e=0;e<r.count;++e)n.push(r.getX(e)+t);t+=e[i].attributes.position.count}l.setIndex(n)}for(let h in s){let e=mw(s[h]);if(!e)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed while trying to merge the "+h+" attribute."),null;l.setAttribute(h,e)}for(let h in a){let e=a[h][0].length;if(0===e)break;l.morphAttributes=l.morphAttributes||{},l.morphAttributes[h]=[];for(let t=0;t<e;++t){let e=[];for(let i=0;i<a[h].length;++i)e.push(a[h][i][t]);let n=mw(e);if(!n)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed while trying to merge the "+h+" morphAttribute."),null;l.morphAttributes[h].push(n)}}return l}function mw(e){let t,n,i,r=0;for(let o=0;o<e.length;++o){let s=e[o];if(s.isInterleavedBufferAttribute)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. InterleavedBufferAttributes are not supported."),null;if(void 0===t&&(t=s.array.constructor),t!==s.array.constructor)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. BufferAttribute.array must be of consistent array types across matching attributes."),null;if(void 0===n&&(n=s.itemSize),n!==s.itemSize)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. BufferAttribute.itemSize must be consistent across matching attributes."),null;if(void 0===i&&(i=s.normalized),i!==s.normalized)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. BufferAttribute.normalized must be consistent across matching attributes."),null;r+=s.array.length}let s=new t(r),a=0;for(let o=0;o<e.length;++o)s.set(e[o].array,a),a+=e[o].array.length;return new ti(s,n,i)}(e=>{e.defaultData={schema:hw,scene:fx.defaultData,frames:(new ig).add("72fc2993-2da3-4b6b-96ac-2879db3a28bd",mx.defaultData),shared:o(o({},_x.emptyData()),{},{colors:_x.defaultColors()})},e.emptyDataForImports=function(){let e=fx.emptyDataWithPage();return{schema:hw,scene:e,frames:(new ig).add("72fc2993-2da3-4b6b-96ac-2879db3a28bd",mx.defaultData),shared:o(o({},_x.emptyData()),{},{colors:_x.defaultColors(),images:_x.defaultImages()})}},e.emptyData=function(){return{schema:hw,scene:fx.emptyDataWithPage(),frames:(new ig).add("72fc2993-2da3-4b6b-96ac-2879db3a28bd",mx.defaultData),shared:_x.emptyData()}},e.clipboard2dData=function(){return{schema:hw,scene:fx.emptyData(),frames:new ig,shared:_x.emptyData()}},e.collabHelper=o(o({},yg),{},{updateSchema(e){var t,n;return(null!==(t=e.schema)&&void 0!==t?t:0)<hw?Hg(e,pw):(null!==(n=e.schema)&&void 0!==n?n:0)-hw}}),e.updateSchemaDirectly=function(t){let n=e.collabHelper.updateSchema(t);return"number"==typeof n?0===n?t:null:n.data},e.withoutLib=function(e){return o(o({},e),{},{shared:o(o({},e.shared),{},{lib:Sx.defaultData()})})},e.getComponentData=function(e,t){let n=e.scene.objects.get(t);if(n&&"Component"===n.data.type)return n;{let n=e.shared.lib.components[t];if(n)return n.asset}},e.hasSensitiveData=function(e){let t=Object.values(e.shared.userAPIs);for(let n of t){let e=n.headers;for(let t of e)if("authorization"===t.data.key.toLowerCase()&&""!==t.data.value)return!0}return!1}})(Hx||(Hx={})),(e=>{e.emptyImage={data:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVQYV2NgYAAAAAMAAWgmWQ0AAAAASUVORK5CYII=",name:"empty"}})(Wx||(Wx={})),(e=>{e.is=function(e){return!0}})(qx||(qx={})),(e=>{e.defaultData={position:[0,0],scale:[1,1],rotation:0,shear:[0,0]},e.merge=function(e,t){var n,i,r,s;return{position:null!==(n=null===t||void 0===t?void 0:t.position)&&void 0!==n?n:e.position,rotation:null!==(i=null===t||void 0===t?void 0:t.rotation)&&void 0!==i?i:e.rotation,scale:null!==(r=null===t||void 0===t?void 0:t.scale)&&void 0!==r?r:e.scale,shear:null!==(s=null===t||void 0===t?void 0:t.shear)&&void 0!==s?s:e.shear}},e.diff=function(e,t){return Mm({position:Gy.isEqual(e.position,t.position)?void 0:t.position,rotation:e.rotation===t.rotation?void 0:t.rotation,scale:Gy.isEqual(e.scale,t.scale)?void 0:t.scale,shear:e.shear&&t.shear&&Gy.isEqual(e.shear,t.shear)?void 0:t.shear})}})(Xx||(Xx={})),(e=>{e.defaultData={horizontalConstraint:0,verticalConstraint:0}})(Yx||(Yx={})),(e=>{e.defaultData={direction:"row",wrap:"unwrap",align:"top-left",gap:10,rowGap:10,autoGap:!1,autoRowGap:!1,leftPadding:8,rightPadding:8,topPadding:8,bottomPadding:8}})(Qx||(Qx={})),(e=>{e.defaultData={opacity:1,fill:{color:Qy.fromHexAndA(ab,1),enabled:!0},stroke:{color:Qy.from0to1([0,0,0,1]),thickness:1,enabled:!1,mode:"inside"},layerBlur:{radius:2,enabled:!1},backgroundBlur:{radius:2,enabled:!1},dropShadow:{offset:[10,10],blurRadius:10,color:Qy.from0to1([0,0,0,1]),enabled:!1,spread:0},innerShadow:{offset:[10,10],blurRadius:10,color:Qy.from0to1([0,0,0,1]),enabled:!1,spread:0}}})(Kx||(Kx={})),(e=>{e.newEmpty=function(e,t){return{name:t}},e.patch=function(e,t){if(void 0===t)return e;let n=o({},e);return Object.assign(n,Xx.merge(n,t)),n=function(e,t){if(void 0===t)return e;let n=o({},e),i=["width","height","cornerRadius"];for(let r of i)r in n&&r in t&&void 0!==t[r]&&Object.assign(n,{[r]:t[r]});return n}(n,t),n=function(e,t){if(void 0===t)return e;let n=o({},e);return"fill"in n&&"fill"in t&&void 0!==t.fill&&Object.assign(n,{fill:o(o({},n.fill),t.fill)}),"stroke"in n&&"stroke"in t&&void 0!==t.stroke&&Object.assign(n,{stroke:o(o({},n.stroke),t.stroke)}),"layerBlur"in n&&"layerBlur"in t&&void 0!==t.layerBlur&&Object.assign(n,{layerBlur:o(o({},n.layerBlur),t.layerBlur)}),"backgroundBlur"in n&&"backgroundBlur"in t&&void 0!==t.backgroundBlur&&Object.assign(n,{backgroundBlur:o(o({},n.backgroundBlur),t.backgroundBlur)}),"dropShadow"in n&&"dropShadow"in t&&void 0!==t.dropShadow&&Object.assign(n,{dropShadow:o(o({},n.dropShadow),t.dropShadow)}),"innerShadow"in n&&"innerShadow"in t&&void 0!==t.innerShadow&&Object.assign(n,{innerShadow:o(o({},n.innerShadow),t.innerShadow)}),n}(n,t),n},e.toOps=function(e,t){let n,i=[];for(let[r,s]of Object.entries(t))"name"!==r&&(void 0===n&&(n={path:[],props:{},type:0},i.push(n)),n.props[r]=s);return i}})(Zx||(Zx={})),(e=>{e.defaultData=o(o(o({},Xx.defaultData),Yx.defaultData),{},{states:new pg,events:new pg,visible:!0,raycastLock:!1})})(Jx||(Jx={})),(e=>{e.defaultData=o(o({},Jx.defaultData),Kx.defaultData)})($x||($x={})),(e=>{e.defaultData={cornerRadius:[0,0,0,0]}})(ew||(ew={})),(e=>{e.defaultData=o(o({},$x.defaultData),{},{type:"ellipse2d",width:100,height:100,name:"Ellipse"})})(tw||(tw={})),(e=>{e.defaultData=o(o(o({},$x.defaultData),ew.defaultData),{},{type:"rectangle2d",width:100,height:100,name:"Rectangle"})})(nw||(nw={})),(e=>{e.defaultData=o(o({},$x.defaultData),{},{type:"text2d",width:100,height:100,fontSize:12,lineHeight:1.2,letterSpacing:0,text:{textValue:"Hello world"},horizontalAlign:1,verticalAlign:1,textTransform:1,font:"Roboto_regular",name:"Text"})})(iw||(iw={})),(e=>{e.defaultData=o(o({},$x.defaultData),{},{type:"path2d",path:"",name:"Path"})})(rw||(rw={})),(e=>{e.is=function(e){return"ellipse2d"===e.type||"rectangle2d"===e.type||"text2d"===e.type||"vector2d"===e.type||"path2d"===e.type}})(sw||(sw={})),(e=>{e.defaultData=o(o({},Jx.defaultData),{},{name:"Group",type:"group2d"})})(aw||(aw={})),(e=>{e.defaultData=()=>o(o(o(o({},Jx.defaultData),ew.defaultData),Kx.defaultData),{},{name:"Frame",type:"frame2d",clipped:!0,width:200,height:200,fill:{color:Qy.fromHexAndA(4737101,1),enabled:!0},stroke:{color:Qy.fromHexAndA(0,1),thickness:1,enabled:!1,mode:"inside"},backgroundBlur:{radius:2,enabled:!1},layerBlur:{radius:2,enabled:!1}})})(ow||(ow={})),(e=>{e.defaultData=function(e){switch(e){case"rectangle2d":case"vector2d":return o({},nw.defaultData);case"ellipse2d":return o({},tw.defaultData);case"text2d":return o({},iw.defaultData);case"path2d":return o({},rw.defaultData);case"frame2d":return o({},ow.defaultData());case"group2d":return o({},aw.defaultData)}},e.getPivot=function(e){return"width"in e&&"height"in e?["number"==typeof e.width?.5*e.width:0,"number"==typeof e.height?.5*e.height:0]:[0,0]},e.isResizeable=function(e){return"rectangle2d"===e.type||"ellipse2d"===e.type||"text2d"===e.type||"frame2d"===e.type},e.isAutoLayoutable=function(e){return"frame2d"===e.type&&void 0!==e.autoLayout},e.hasCorners=function(e){return"rectangle2d"===e.type||"frame2d"===e.type}})(lw||(lw={})),(e=>{e.defaultData={name:"UI",type:"scene2d",objects:new dg},e.emptyData=function(){return{type:"scene2d",objects:new dg}}})(cw||(cw={}));var gw=Math.pow(2,-24),vw=class{constructor(){}};function yw(e,t,n){return n.min.x=t[e],n.min.y=t[e+1],n.min.z=t[e+2],n.max.x=t[e+3],n.max.y=t[e+4],n.max.z=t[e+5],n}function bw(e){let t=-1,n=-1/0;for(let i=0;i<3;i++){let r=e[i+3]-e[i];r>n&&(n=r,t=i)}return t}function xw(e,t){t.set(e)}function ww(e,t,n){let i,r;for(let s=0;s<3;s++){let a=s+3;i=e[s],r=t[s],n[s]=i<r?i:r,i=e[a],r=t[a],n[a]=i>r?i:r}}function Sw(e,t,n){for(let i=0;i<3;i++){let r=t[e+2*i],s=t[e+2*i+1],a=r-s,o=r+s;a<n[i]&&(n[i]=a),o>n[i+3]&&(n[i+3]=o)}}function _w(e){let t=e[3]-e[0],n=e[4]-e[1],i=e[5]-e[2];return 2*(t*n+n*i+i*t)}function Ew(e,t,n,i){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,s=1/0,a=1/0,o=1/0,l=-1/0,c=-1/0,h=-1/0,u=1/0,d=1/0,p=1/0,f=-1/0,m=-1/0,g=-1/0,v=null!==r;for(let y=6*t,b=6*(t+n);y<b;y+=6){let t=e[y+0],n=e[y+1],i=t-n,r=t+n;i<s&&(s=i),r>l&&(l=r),v&&t<u&&(u=t),v&&t>f&&(f=t);let b=e[y+2],x=e[y+3],w=b-x,S=b+x;w<a&&(a=w),S>c&&(c=S),v&&b<d&&(d=b),v&&b>m&&(m=b);let _=e[y+4],E=e[y+5],A=_-E,C=_+E;A<o&&(o=A),C>h&&(h=C),v&&_<p&&(p=_),v&&_>g&&(g=_)}i[0]=s,i[1]=a,i[2]=o,i[3]=l,i[4]=c,i[5]=h,v&&(r[0]=u,r[1]=d,r[2]=p,r[3]=f,r[4]=m,r[5]=g)}var Aw=32,Cw=(e,t)=>e.candidate-t.candidate,Mw=new Array(Aw).fill().map((()=>({count:0,bounds:new Float32Array(6),rightCacheBounds:new Float32Array(6),leftCacheBounds:new Float32Array(6),candidate:0}))),Tw=new Float32Array(6);function Pw(e,t){function n(e){d&&d(e/p)}function i(t,r,d){let p=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,m=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;if(!f&&m>=l&&(f=!0,c&&(console.warn("MeshBVH: Max depth of ".concat(l," reached when generating BVH. Consider increasing maxDepth.")),console.warn(e))),d<=h||m>=l)return n(r+d),t.offset=r,t.count=d,t;let g=function(e,t,n,i,r,s){let a=-1,o=0;if(0===s)a=bw(t),-1!==a&&(o=(t[a]+t[a+3])/2);else if(1===s)a=bw(e),-1!==a&&(o=function(e,t,n,i){let r=0;for(let s=t,a=t+n;s<a;s++)r+=e[6*s+2*i];return r/n}(n,i,r,a));else if(2===s){let s=_w(e),l=1.25*r,c=6*i,h=6*(i+r);for(let e=0;e<3;e++){let i=t[e],u=(t[e+3]-i)/Aw;if(r<8){let t=[...Mw];t.length=r;let i=0;for(let r=c;r<h;r+=6,i++){let s=t[i];s.candidate=n[r+2*e],s.count=0;let{bounds:a,leftCacheBounds:o,rightCacheBounds:l}=s;for(let e=0;e<3;e++)l[e]=1/0,l[e+3]=-1/0,o[e]=1/0,o[e+3]=-1/0,a[e]=1/0,a[e+3]=-1/0;Sw(r,n,a)}t.sort(Cw);let u=r;for(let e=0;e<u;e++){let n=t[e];for(;e+1<u&&t[e+1].candidate===n.candidate;)t.splice(e+1,1),u--}for(let r=c;r<h;r+=6){let i=n[r+2*e];for(let e=0;e<u;e++){let s=t[e];i>=s.candidate?Sw(r,n,s.rightCacheBounds):(Sw(r,n,s.leftCacheBounds),s.count++)}}for(let n=0;n<u;n++){let i=t[n],c=i.count,h=r-i.count,u=i.leftCacheBounds,d=i.rightCacheBounds,p=0;0!==c&&(p=_w(u)/s);let f=0;0!==h&&(f=_w(d)/s);let m=1+1.25*(p*c+f*h);m<l&&(a=e,l=m,o=i.candidate)}}else{for(let e=0;e<Aw;e++){let t=Mw[e];t.count=0,t.candidate=i+u+e*u;let n=t.bounds;for(let e=0;e<3;e++)n[e]=1/0,n[e+3]=-1/0}for(let r=c;r<h;r+=6){let t=~~((n[r+2*e]-i)/u);t>=Aw&&(t=31);let s=Mw[t];s.count++,Sw(r,n,s.bounds)}let t=Mw[31];xw(t.bounds,t.rightCacheBounds);for(let e=30;e>=0;e--){let t=Mw[e],n=Mw[e+1];ww(t.bounds,n.rightCacheBounds,t.rightCacheBounds)}let d=0;for(let n=0;n<31;n++){let t=Mw[n],i=t.count,c=t.bounds,h=Mw[n+1].rightCacheBounds;0!==i&&(0===d?xw(c,Tw):ww(c,Tw,Tw)),d+=i;let u=0,p=0;0!==d&&(u=_w(Tw)/s);let f=r-d;0!==f&&(p=_w(h)/s);let m=1+1.25*(u*d+p*f);m<l&&(a=e,l=m,o=t.candidate)}}}}else console.warn("MeshBVH: Invalid build strategy value ".concat(s," used."));return{axis:a,pos:o}}(t.boundingData,p,a,r,d,u);if(-1===g.axis)return n(r+d),t.offset=r,t.count=d,t;let v=function(e,t,n,i,r){let s=n,a=n+i-1,o=r.pos,l=2*r.axis;for(;;){for(;s<=a&&t[6*s+l]<o;)s++;for(;s<=a&&t[6*a+l]>=o;)a--;if(!(s<a))return s;for(let n=0;n<3;n++){let i=e[3*s+n];e[3*s+n]=e[3*a+n],e[3*a+n]=i;let r=t[6*s+2*n+0];t[6*s+2*n+0]=t[6*a+2*n+0],t[6*a+2*n+0]=r;let o=t[6*s+2*n+1];t[6*s+2*n+1]=t[6*a+2*n+1],t[6*a+2*n+1]=o}s++,a--}}(o,a,r,d,g);if(v===r||v===r+d)n(r+d),t.offset=r,t.count=d;else{t.splitAxis=g.axis;let e=new vw,n=r,o=v-r;t.left=e,e.boundingData=new Float32Array(6),Ew(a,n,o,e.boundingData,s),i(e,n,o,s,m+1);let l=new vw,c=v,h=d-o;t.right=l,l.boundingData=new Float32Array(6),Ew(a,c,h,l.boundingData,s),i(l,c,h,s,m+1)}return t}!function(e,t){if(!e.index){let n,i=e.attributes.position.count,r=t.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer;n=i>65535?new Uint32Array(new r(4*i)):new Uint16Array(new r(2*i)),e.setIndex(new ti(n,1));for(let e=0;e<i;e++)n[e]=e}}(e,t);let r=new Float32Array(6),s=new Float32Array(6),a=function(e,t){let n=e.attributes.position,i=e.index.array,r=i.length/3,s=new Float32Array(6*r),a=n.normalized,o=n.array,l=n.offset||0,c=3;n.isInterleavedBufferAttribute&&(c=n.data.stride);let h=["getX","getY","getZ"];for(let u=0;u<r;u++){let e,r,d,p=3*u,f=6*u;a?(e=i[p+0],r=i[p+1],d=i[p+2]):(e=i[p+0]*c+l,r=i[p+1]*c+l,d=i[p+2]*c+l);for(let i=0;i<3;i++){let l,c,u;a?(l=n[h[i]](e),c=n[h[i]](r),u=n[h[i]](d)):(l=o[e+i],c=o[r+i],u=o[d+i]);let p=l;c<p&&(p=c),u<p&&(p=u);let m=l;c>m&&(m=c),u>m&&(m=u);let g=(m-p)/2,v=2*i;s[f+v+0]=p+g,s[f+v+1]=g+(Math.abs(p)+g)*gw,p<t[i]&&(t[i]=p),m>t[i+3]&&(t[i+3]=m)}}return s}(e,r),o=e.index.array,l=t.maxDepth,c=t.verbose,h=t.maxLeafTris,u=t.strategy,d=t.onProgress,p=e.index.count/3,f=!1,m=[],g=function(e){if(!e.groups||!e.groups.length)return[{offset:0,count:e.index.count/3}];let t=[],n=new Set;for(let r of e.groups)n.add(r.start),n.add(r.start+r.count);let i=Array.from(n.values()).sort(((e,t)=>e-t));for(let r=0;r<i.length-1;r++){let e=i[r],n=i[r+1];t.push({offset:e/3,count:(n-e)/3})}return t}(e);if(1===g.length){let e=g[0],t=new vw;t.boundingData=r,function(e,t,n,i){let r=1/0,s=1/0,a=1/0,o=-1/0,l=-1/0,c=-1/0;for(let h=6*t,u=6*(t+n);h<u;h+=6){let t=e[h+0];t<r&&(r=t),t>o&&(o=t);let n=e[h+2];n<s&&(s=n),n>l&&(l=n);let i=e[h+4];i<a&&(a=i),i>c&&(c=i)}i[0]=r,i[1]=s,i[2]=a,i[3]=o,i[4]=l,i[5]=c}(a,e.offset,e.count,s),i(t,e.offset,e.count,s),m.push(t)}else for(let v of g){let e=new vw;e.boundingData=new Float32Array(6),Ew(a,v.offset,v.count,e.boundingData,s),i(e,v.offset,v.count,s),m.push(e)}return m}var Dw=class{constructor(){this.min=1/0,this.max=-1/0}setFromPointsField(e,t){let n=1/0,i=-1/0;for(let r=0,s=e.length;r<s;r++){let s=e[r][t];n=s<n?s:n,i=s>i?s:i}this.min=n,this.max=i}setFromPoints(e,t){let n=1/0,i=-1/0;for(let r=0,s=t.length;r<s;r++){let s=t[r],a=e.dot(s);n=a<n?a:n,i=a>i?a:i}this.min=n,this.max=i}isSeparated(e){return this.min>e.max||e.min>this.max}};Dw.prototype.setFromBox=function(){let e=new Bt;return function(t,n){let i=n.min,r=n.max,s=1/0,a=-1/0;for(let o=0;o<=1;o++)for(let n=0;n<=1;n++)for(let l=0;l<=1;l++){e.x=i.x*o+r.x*(1-o),e.y=i.y*n+r.y*(1-n),e.z=i.z*l+r.z*(1-l);let c=t.dot(e);s=Math.min(c,s),a=Math.max(c,a)}this.min=s,this.max=a}}();!function(){let e=new Dw}();var Ow=function(){let e=new Bt,t=new Bt,n=new Bt;return function(i,r,s){let a=i.start,o=e,l=r.start,c=t;n.subVectors(a,l),e.subVectors(i.end,i.start),t.subVectors(r.end,r.start);let h,u,d=n.dot(c),p=c.dot(o),f=c.dot(c),m=n.dot(o),g=o.dot(o)*f-p*p;h=0!==g?(d*p-m*f)/g:0,u=(d+h*p)/f,s.x=h,s.y=u}}(),Iw=function(){let e=new ot,t=new Bt,n=new Bt;return function(i,r,s,a){Ow(i,r,e);let o=e.x,l=e.y;if(o>=0&&o<=1&&l>=0&&l<=1)return i.at(o,s),void r.at(l,a);if(o>=0&&o<=1)return l<0?r.at(0,a):r.at(1,a),void i.closestPointToPoint(a,!0,s);if(l>=0&&l<=1)return o<0?i.at(0,s):i.at(1,s),void r.closestPointToPoint(s,!0,a);{let e,c;e=o<0?i.start:i.end,c=l<0?r.start:r.end;let h=t,u=n;return i.closestPointToPoint(c,!0,t),r.closestPointToPoint(e,!0,n),h.distanceToSquared(c)<=u.distanceToSquared(e)?(s.copy(h),void a.copy(c)):(s.copy(e),void a.copy(u))}}}(),Rw=function(){let e=new Bt,t=new Bt,n=new Gi,i=new _c;return function(r,s){let{radius:a,center:o}=r,{a:l,b:c,c:h}=s;if(i.start=l,i.end=c,i.closestPointToPoint(o,!0,e).distanceTo(o)<=a||(i.start=l,i.end=h,i.closestPointToPoint(o,!0,e).distanceTo(o)<=a)||(i.start=c,i.end=h,i.closestPointToPoint(o,!0,e).distanceTo(o)<=a))return!0;let u=s.getPlane(n);if(Math.abs(u.distanceToPoint(o))<=a){let e=u.projectPoint(o,t);if(s.containsPoint(e))return!0}return!1}}();function kw(e){return Math.abs(e)<1e-15}var Lw=class extends Qn{constructor(){super(...arguments),this.isExtendedTriangle=!0,this.satAxes=new Array(4).fill().map((()=>new Bt)),this.satBounds=new Array(4).fill().map((()=>new Dw)),this.points=[this.a,this.b,this.c],this.sphere=new rn,this.plane=new Gi,this.needsUpdate=!0}intersectsSphere(e){return Rw(e,this)}update(){let e=this.a,t=this.b,n=this.c,i=this.points,r=this.satAxes,s=this.satBounds,a=r[0],o=s[0];this.getNormal(a),o.setFromPoints(a,i);let l=r[1],c=s[1];l.subVectors(e,t),c.setFromPoints(l,i);let h=r[2],u=s[2];h.subVectors(t,n),u.setFromPoints(h,i);let d=r[3],p=s[3];d.subVectors(n,e),p.setFromPoints(d,i),this.sphere.setFromPoints(this.points),this.plane.setFromNormalAndCoplanarPoint(a,e),this.needsUpdate=!1}};Lw.prototype.closestPointToSegment=function(){let e=new Bt,t=new Bt,n=new _c;return function(i){let r,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,{start:o,end:l}=i,c=this.points,h=1/0;for(let u=0;u<3;u++){let o=(u+1)%3;n.start.copy(c[u]),n.end.copy(c[o]),Iw(n,i,e,t),r=e.distanceToSquared(t),r<h&&(h=r,s&&s.copy(e),a&&a.copy(t))}return this.closestPointToPoint(o,e),r=o.distanceToSquared(e),r<h&&(h=r,s&&s.copy(e),a&&a.copy(o)),this.closestPointToPoint(l,e),r=l.distanceToSquared(e),r<h&&(h=r,s&&s.copy(e),a&&a.copy(l)),Math.sqrt(h)}}(),Lw.prototype.intersectsTriangle=function(){let e=new Lw,t=new Array(3),n=new Array(3),i=new Dw,r=new Dw,s=new Bt,a=new Bt,o=new Bt,l=new Bt,c=new _c,h=new _c,u=new _c;return function(d){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,f=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this.needsUpdate&&this.update(),d.isExtendedTriangle?d.needsUpdate&&d.update():(e.copy(d),e.update(),d=e);let m=this.plane,g=d.plane;if(Math.abs(m.normal.dot(g.normal))>1-1e-10){let e=this.satBounds,a=this.satAxes;n[0]=d.a,n[1]=d.b,n[2]=d.c;for(let t=0;t<4;t++){let r=e[t],s=a[t];if(i.setFromPoints(s,n),r.isSeparated(i))return!1}let o=d.satBounds,l=d.satAxes;t[0]=this.a,t[1]=this.b,t[2]=this.c;for(let n=0;n<4;n++){let e=o[n],r=l[n];if(i.setFromPoints(r,t),e.isSeparated(i))return!1}for(let c=0;c<4;c++){let e=a[c];for(let a=0;a<4;a++){let o=l[a];if(s.crossVectors(e,o),i.setFromPoints(s,t),r.setFromPoints(s,n),i.isSeparated(r))return!1}}return p&&(f||console.warn("ExtendedTriangle.intersectsTriangle: Triangles are coplanar which does not support an output edge. Setting edge to 0, 0, 0."),p.start.set(0,0,0),p.end.set(0,0,0)),!0}{let e=this.points,t=!1,n=0;for(let o=0;o<3;o++){let i=e[o],r=e[(o+1)%3];c.start.copy(i),c.end.copy(r),c.delta(a);let s=t?h.start:h.end,l=kw(g.distanceToPoint(i));if(kw(g.normal.dot(a))&&l){h.copy(c),n=2;break}if((g.intersectLine(c,s)||l)&&!kw(s.distanceTo(r))){if(n++,t)break;t=!0}}if(1===n&&d.containsPoint(h.end))return p&&(p.start.copy(h.end),p.end.copy(h.end)),!0;if(2!==n)return!1;let i=d.points,r=!1,s=0;for(let a=0;a<3;a++){let e=i[a],t=i[(a+1)%3];c.start.copy(e),c.end.copy(t),c.delta(o);let n=r?u.start:u.end,l=kw(m.distanceToPoint(e));if(kw(m.normal.dot(o))&&l){u.copy(c),s=2;break}if((m.intersectLine(c,n)||l)&&!kw(n.distanceTo(t))){if(s++,r)break;r=!0}}if(1===s&&this.containsPoint(u.end))return p&&(p.start.copy(u.end),p.end.copy(u.end)),!0;if(2!==s)return!1;if(h.delta(a),u.delta(o),a.dot(o)<0){let e=u.start;u.start=u.end,u.end=e}let f=h.start.dot(a),v=h.end.dot(a),y=u.start.dot(a),b=u.end.dot(a);return(f===b||y===v||v<y!==f<b)&&(p&&(l.subVectors(h.start,u.start),l.dot(a)>0?p.start.copy(h.start):p.start.copy(u.start),l.subVectors(h.end,u.end),l.dot(a)<0?p.end.copy(h.end):p.end.copy(u.end)),!0)}}}(),Lw.prototype.distanceToPoint=function(){let e=new Bt;return function(t){return this.closestPointToPoint(t,e),t.distanceTo(e)}}(),Lw.prototype.distanceToTriangle=function(){let e=new Bt,t=new Bt,n=["a","b","c"],i=new _c,r=new _c;return function(s){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,l=a||o?i:null;if(this.intersectsTriangle(s,l))return(a||o)&&(a&&l.getCenter(a),o&&l.getCenter(o)),0;let c=1/0;for(let t=0;t<3;t++){let i,r=n[t],l=s[r];this.closestPointToPoint(l,e),i=l.distanceToSquared(e),i<c&&(c=i,a&&a.copy(e),o&&o.copy(l));let h=this[r];s.closestPointToPoint(h,e),i=h.distanceToSquared(e),i<c&&(c=i,a&&a.copy(h),o&&o.copy(e))}for(let h=0;h<3;h++){let l=n[h],u=n[(h+1)%3];i.set(this[l],this[u]);for(let h=0;h<3;h++){let l=n[h],u=n[(h+1)%3];r.set(s[l],s[u]),Iw(i,r,e,t);let d=e.distanceToSquared(t);d<c&&(c=d,a&&a.copy(e),o&&o.copy(t))}}return Math.sqrt(c)}}();var Bw=class{constructor(e,t,n){this.isOrientedBox=!0,this.min=new Bt,this.max=new Bt,this.matrix=new pn,this.invMatrix=new pn,this.points=new Array(8).fill().map((()=>new Bt)),this.satAxes=new Array(3).fill().map((()=>new Bt)),this.satBounds=new Array(3).fill().map((()=>new Dw)),this.alignedSatBounds=new Array(3).fill().map((()=>new Dw)),this.needsUpdate=!1,e&&this.min.copy(e),t&&this.max.copy(t),n&&this.matrix.copy(n)}set(e,t,n){this.min.copy(e),this.max.copy(t),this.matrix.copy(n),this.needsUpdate=!0}copy(e){this.min.copy(e.min),this.max.copy(e.max),this.matrix.copy(e.matrix),this.needsUpdate=!0}};Bw.prototype.update=function(){let e=this.matrix,t=this.min,n=this.max,i=this.points;for(let l=0;l<=1;l++)for(let r=0;r<=1;r++)for(let s=0;s<=1;s++){let a=i[1*l|2*r|4*s];a.x=l?n.x:t.x,a.y=r?n.y:t.y,a.z=s?n.z:t.z,a.applyMatrix4(e)}let r=this.satBounds,s=this.satAxes,a=i[0];for(let l=0;l<3;l++){let e=s[l],t=r[l],n=i[1<<l];e.subVectors(a,n),t.setFromPoints(e,i)}let o=this.alignedSatBounds;o[0].setFromPointsField(i,"x"),o[1].setFromPointsField(i,"y"),o[2].setFromPointsField(i,"z"),this.invMatrix.copy(this.matrix).invert(),this.needsUpdate=!1},Bw.prototype.intersectsBox=function(){let e=new Dw;return function(t){this.needsUpdate&&this.update();let n=t.min,i=t.max,r=this.satBounds,s=this.satAxes,a=this.alignedSatBounds;if(e.min=n.x,e.max=i.x,a[0].isSeparated(e)||(e.min=n.y,e.max=i.y,a[1].isSeparated(e))||(e.min=n.z,e.max=i.z,a[2].isSeparated(e)))return!1;for(let o=0;o<3;o++){let n=s[o],i=r[o];if(e.setFromBox(n,t),i.isSeparated(e))return!1}return!0}}(),Bw.prototype.intersectsTriangle=function(){let e=new Lw,t=new Array(3),n=new Dw,i=new Dw,r=new Bt;return function(s){this.needsUpdate&&this.update(),s.isExtendedTriangle?s.needsUpdate&&s.update():(e.copy(s),e.update(),s=e);let a=this.satBounds,o=this.satAxes;t[0]=s.a,t[1]=s.b,t[2]=s.c;for(let e=0;e<3;e++){let i=a[e],r=o[e];if(n.setFromPoints(r,t),i.isSeparated(n))return!1}let l=s.satBounds,c=s.satAxes,h=this.points;for(let e=0;e<3;e++){let t=l[e],i=c[e];if(n.setFromPoints(i,h),t.isSeparated(n))return!1}for(let e=0;e<3;e++){let s=o[e];for(let e=0;e<4;e++){let a=c[e];if(r.crossVectors(s,a),n.setFromPoints(r,t),i.setFromPoints(r,h),n.isSeparated(i))return!1}}return!0}}(),Bw.prototype.closestPointToPoint=function(e,t){return this.needsUpdate&&this.update(),t.copy(e).applyMatrix4(this.invMatrix).clamp(this.min,this.max).applyMatrix4(this.matrix),t},Bw.prototype.distanceToPoint=function(){let e=new Bt;return function(t){return this.closestPointToPoint(t,e),t.distanceTo(e)}}(),Bw.prototype.distanceToBox=function(){let e=["x","y","z"],t=new Array(12).fill().map((()=>new _c)),n=new Array(12).fill().map((()=>new _c)),i=new Bt,r=new Bt;return function(s){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(this.needsUpdate&&this.update(),this.intersectsBox(s))return(o||l)&&(s.getCenter(r),this.closestPointToPoint(r,i),s.closestPointToPoint(i,r),o&&o.copy(i),l&&l.copy(r)),0;let c=a*a,h=s.min,u=s.max,d=this.points,p=1/0;for(let e=0;e<8;e++){let t=d[e];r.copy(t).clamp(h,u);let n=t.distanceToSquared(r);if(n<p&&(p=n,o&&o.copy(t),l&&l.copy(r),n<c))return Math.sqrt(n)}let f=0;for(let i=0;i<3;i++)for(let r=0;r<=1;r++)for(let s=0;s<=1;s++){let a=(i+1)%3,o=(i+2)%3,l=1<<i|r<<a|s<<o,c=d[r<<a|s<<o],p=d[l];t[f].set(c,p);let m=e[i],g=e[a],v=e[o],y=n[f],b=y.start,x=y.end;b[m]=h[m],b[g]=r?h[g]:u[g],b[v]=s?h[v]:u[g],x[m]=u[m],x[g]=r?h[g]:u[g],x[v]=s?h[v]:u[g],f++}for(let e=0;e<=1;e++)for(let t=0;t<=1;t++)for(let n=0;n<=1;n++){r.x=e?u.x:h.x,r.y=t?u.y:h.y,r.z=n?u.z:h.z,this.closestPointToPoint(r,i);let s=r.distanceToSquared(i);if(s<p&&(p=s,o&&o.copy(i),l&&l.copy(r),s<c))return Math.sqrt(s)}for(let e=0;e<12;e++){let s=t[e];for(let e=0;e<12;e++){let t=n[e];Iw(s,t,i,r);let a=i.distanceToSquared(r);if(a<p&&(p=a,o&&o.copy(i),l&&l.copy(r),a<c))return Math.sqrt(a)}}return Math.sqrt(p)}}();var zw=new Bt,Nw=new Bt,Fw=new Bt,Uw=new ot,jw=new ot,Vw=new ot,Gw=new Bt,Hw=new Bt,Ww=new Bt,qw=new Bt;function Xw(e,t,n,i,r){let s=3*i,a=e.index.getX(s),o=e.index.getX(s+1),l=e.index.getX(s+2),{position:c,normal:h,uv:u,uv1:d}=e.attributes,p=function(e,t,n,i,r,s,a,o,l){zw.fromBufferAttribute(t,s),Nw.fromBufferAttribute(t,a),Fw.fromBufferAttribute(t,o);let c=function(e,t,n,i,r,s){let a;return a=1===s?e.intersectTriangle(i,n,t,!0,r):e.intersectTriangle(t,n,i,2!==s,r),null===a?null:{distance:e.origin.distanceTo(r),point:r.clone()}}(e,zw,Nw,Fw,qw,l);if(c){i&&(Uw.fromBufferAttribute(i,s),jw.fromBufferAttribute(i,a),Vw.fromBufferAttribute(i,o),c.uv=Qn.getInterpolation(qw,zw,Nw,Fw,Uw,jw,Vw,new ot)),r&&(Uw.fromBufferAttribute(r,s),jw.fromBufferAttribute(r,a),Vw.fromBufferAttribute(r,o),c.uv1=Qn.getInterpolation(qw,zw,Nw,Fw,Uw,jw,Vw,new ot)),n&&(Gw.fromBufferAttribute(n,s),Hw.fromBufferAttribute(n,a),Ww.fromBufferAttribute(n,o),c.normal=Qn.getInterpolation(qw,zw,Nw,Fw,Gw,Hw,Ww,new Bt),c.normal.dot(e.direction)>0&&c.normal.multiplyScalar(-1));let t={a:s,b:a,c:o,normal:new Bt,materialIndex:0};Qn.getNormal(zw,Nw,Fw,t.normal),c.face=t,c.faceIndex=s}return c}(n,c,h,u,d,a,o,l,t);return p?(p.faceIndex=i,r&&r.push(p),p):null}function Yw(e,t,n,i){let r=e.a,s=e.b,a=e.c,o=t,l=t+1,c=t+2;n&&(o=n.getX(t),l=n.getX(t+1),c=n.getX(t+2)),r.x=i.getX(o),r.y=i.getY(o),r.z=i.getZ(o),s.x=i.getX(l),s.y=i.getY(l),s.z=i.getZ(l),a.x=i.getX(c),a.y=i.getY(c),a.z=i.getZ(c)}function Qw(e,t,n,i,r,s,a){let o=n.index,l=n.attributes.position;for(let c=e,h=t+e;c<h;c++)if(Yw(a,3*c,o,l),a.needsUpdate=!0,i(a,c,r,s))return!0;return!1}var Kw=class{constructor(e){this._getNewPrimitive=e,this._primitives=[]}getPrimitive(){let e=this._primitives;return 0===e.length?this._getNewPrimitive():e.pop()}releasePrimitive(e){this._primitives.push(e)}};function Zw(e,t){return 65535===t[e+15]}function Jw(e,t){return t[e+6]}function $w(e,t){return t[e+14]}function eS(e){return e+8}function tS(e,t){return t[e+6]}var nS=new Ft,iS=new Bt,rS=["x","y","z"];function sS(e,t,n,i,r){let s=2*e,a=uS,o=dS,l=pS;if(Zw(s,o)){!function(e,t,n,i,r,s){for(let a=i,o=i+r;a<o;a++)Xw(e,t,n,a,s)}(t,n,i,Jw(e,l),$w(s,o),r)}else{let s=eS(e);cS(s,a,i,iS)&&sS(s,t,n,i,r);let o=tS(e,l);cS(o,a,i,iS)&&sS(o,t,n,i,r)}}function aS(e,t,n,i){let r=2*e,s=uS,a=dS,o=pS;if(Zw(r,a)){return function(e,t,n,i,r){let s=1/0,a=null;for(let o=i,l=i+r;o<l;o++){let i=Xw(e,t,n,o);i&&i.distance<s&&(a=i,s=i.distance)}return a}(t,n,i,Jw(e,o),$w(r,a))}{let r,a,l=function(e,t){return t[e+7]}(e,o),c=rS[l],h=i.direction[c]>=0;h?(r=eS(e),a=tS(e,o)):(r=tS(e,o),a=eS(e));let u=cS(r,s,i,iS)?aS(r,t,n,i):null;if(u){let e=u.point[c];if(h?e<=s[a+l]:e>=s[a+l+3])return u}let d=cS(a,s,i,iS)?aS(a,t,n,i):null;return u&&d?u.distance<=d.distance?u:d:u||d||null}}var oS=function(){let e,t,n=[],i=new Kw((()=>new Ft));return function(){e=i.getPrimitive(),t=i.getPrimitive(),n.push(e,t);let s=r(...arguments);i.releasePrimitive(e),i.releasePrimitive(t),n.pop(),n.pop();let a=n.length;return a>0&&(t=n[a-1],e=n[a-2]),s};function r(n,i,s,a){let o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,c=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;function h(e){let t=2*e,n=dS,i=pS;for(;!Zw(t,n);)t=2*(e=eS(e));return Jw(e,i)}function u(e){let t=2*e,n=dS,i=pS;for(;!Zw(t,n);)t=2*(e=tS(e,i));return Jw(e,i)+$w(t,n)}let d=2*n,p=uS,f=dS,m=pS;if(Zw(d,f)){let t=Jw(n,m),i=$w(d,f);return yw(n,p,e),a(t,i,!1,c,l+n,e)}{let d,g,v,y,b=eS(n),x=tS(n,m),w=b,S=x;if(o&&(v=e,y=t,yw(w,p,v),yw(S,p,y),d=o(v),g=o(y),g<d)){w=x,S=b;let e=d;d=g,g=e,v=y}v||(v=e,yw(w,p,v));let _,E=s(v,Zw(2*w,f),d,c+1,l+w);if(2===E){let e=h(w);_=a(e,u(w)-e,!0,c+1,l+w,v)}else _=E&&r(w,i,s,a,o,l,c+1);if(_)return!0;y=t,yw(S,p,y);let A,C=s(y,Zw(2*S,f),g,c+1,l+S);if(2===C){let e=h(S);A=a(e,u(S)-e,!0,c+1,l+S,y)}else A=C&&r(S,i,s,a,o,l,c+1);return!!A}}}(),lS=function(){let e=new Lw,t=new Lw,n=new pn,i=new Bw,r=new Bw;return function s(a,o,l,c){let h=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,u=2*a,d=uS,p=dS,f=pS;if(null===h&&(l.boundingBox||l.computeBoundingBox(),i.set(l.boundingBox.min,l.boundingBox.max,c),h=i),!Zw(u,p)){let e=a+8,t=f[a+6];return yw(e,d,nS),!!(h.intersectsBox(nS)&&s(e,o,l,c,h)||(yw(t,d,nS),h.intersectsBox(nS)&&s(t,o,l,c,h)))}{let i=o,s=i.index,h=i.attributes.position,m=l.index,g=l.attributes.position,v=Jw(a,f),y=$w(u,p);if(n.copy(c).invert(),l.boundsTree)return yw(a,d,r),r.matrix.copy(n),r.needsUpdate=!0,l.boundsTree.shapecast({intersectsBounds:e=>r.intersectsBox(e),intersectsTriangle:e=>{e.a.applyMatrix4(c),e.b.applyMatrix4(c),e.c.applyMatrix4(c),e.needsUpdate=!0;for(let n=3*v,i=3*(y+v);n<i;n+=3)if(Yw(t,n,s,h),t.needsUpdate=!0,e.intersectsTriangle(t))return!0;return!1}});for(let r=3*v,a=y+3*v;r<a;r+=3){Yw(e,r,s,h),e.a.applyMatrix4(n),e.b.applyMatrix4(n),e.c.applyMatrix4(n),e.needsUpdate=!0;for(let n=0,i=m.count;n<i;n+=3)if(Yw(t,n,m,g),t.needsUpdate=!0,e.intersectsTriangle(t))return!0}}}}();function cS(e,t,n,i){return yw(e,t,nS),n.intersectBox(nS,i)}var hS,uS,dS,pS,fS=[];function mS(e){hS&&fS.push(hS),hS=e,uS=new Float32Array(e),dS=new Uint16Array(e),pS=new Uint32Array(e)}function gS(){hS=null,uS=null,dS=null,pS=null,fS.length&&mS(fS.pop())}var vS=Symbol("skip tree generation"),yS=new Ft,bS=new Ft,xS=new pn,wS=new Bw,SS=new Bw,_S=new Bt,ES=new Bt,AS=new Bt,CS=new Bt,MS=new Bt,TS=new Ft,PS=new Kw((()=>new Lw)),DS=class{static serialize(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(t.isBufferGeometry)return console.warn("MeshBVH.serialize: The arguments for the function have changed. See documentation for new signature."),DS.serialize(arguments[0],{cloneBuffers:void 0===arguments[2]||arguments[2]});t=o({cloneBuffers:!0},t);let n,i=e.geometry,r=e._roots,s=i.getIndex();return n=t.cloneBuffers?{roots:r.map((e=>e.slice())),index:s.array.slice()}:{roots:r,index:s.array},n}static deserialize(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if("boolean"==typeof n)return console.warn("MeshBVH.deserialize: The arguments for the function have changed. See documentation for new signature."),DS.deserialize(arguments[0],arguments[1],{setIndex:void 0===arguments[2]||arguments[2]});n=o({setIndex:!0},n);let{index:i,roots:r}=e,s=new DS(t,o(o({},n),{},{[vS]:!0}));if(s._roots=r,n.setIndex){let n=t.getIndex();if(null===n){let n=new ti(e.index,1,!1);t.setIndex(n)}else n.array!==i&&(n.array.set(i),n.needsUpdate=!0)}return s}constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!e.isBufferGeometry)throw new Error("MeshBVH: Only BufferGeometries are supported.");if(e.index&&e.index.isInterleavedBufferAttribute)throw new Error("MeshBVH: InterleavedBufferAttribute is not supported for the index attribute.");if(t=Object.assign({strategy:0,maxDepth:40,maxLeafTris:10,verbose:!0,useSharedArrayBuffer:!1,setBoundingBox:!0,onProgress:null,[vS]:!1},t),t.useSharedArrayBuffer&&typeof SharedArrayBuffer>"u")throw new Error("MeshBVH: SharedArrayBuffer is not available.");this._roots=null,t[vS]||(this._roots=function(e,t){let n,i,r,s=Pw(e,t),a=[],o=t.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer;for(let h=0;h<s.length;h++){let e=s[h],t=new o(32*l(e));n=new Float32Array(t),i=new Uint32Array(t),r=new Uint16Array(t),c(0,e),a.push(t)}return a;function l(e){return e.count?1:1+l(e.left)+l(e.right)}function c(e,t){let s=e/4,a=e/2,o=!!t.count,l=t.boundingData;for(let i=0;i<6;i++)n[s+i]=l[i];if(o){let n=t.offset,o=t.count;return i[s+6]=n,r[a+14]=o,r[a+15]=65535,e+32}{let n,r=t.left,a=t.right,o=t.splitAxis;if(n=c(e+32,r),n/4>Math.pow(2,32))throw new Error("MeshBVH: Cannot store child pointer greater than 32 bits.");return i[s+6]=n/4,n=c(n,a),i[s+7]=o,n}}}(e,t),!e.boundingBox&&t.setBoundingBox&&(e.boundingBox=this.getBoundingBox(new Ft))),this.geometry=e}refit(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;e&&Array.isArray(e)&&(e=new Set(e));let t,n,i,r,s=this.geometry,a=s.index.array,o=s.attributes.position,l=0,c=this._roots;for(let u=0,d=c.length;u<d;u++)t=c[u],n=new Uint32Array(t),i=new Uint16Array(t),r=new Float32Array(t),h(0,l),l+=t.byteLength;function h(t,s){let l=arguments.length>2&&void 0!==arguments[2]&&arguments[2],c=2*t;if(65535===i[c+15]){let e=n[t+6],s=1/0,l=1/0,h=1/0,u=-1/0,d=-1/0,p=-1/0;for(let t=3*e,n=3*(e+i[c+14]);t<n;t++){let e=a[t],n=o.getX(e),i=o.getY(e),r=o.getZ(e);n<s&&(s=n),n>u&&(u=n),i<l&&(l=i),i>d&&(d=i),r<h&&(h=r),r>p&&(p=r)}return(r[t+0]!==s||r[t+1]!==l||r[t+2]!==h||r[t+3]!==u||r[t+4]!==d||r[t+5]!==p)&&(r[t+0]=s,r[t+1]=l,r[t+2]=h,r[t+3]=u,r[t+4]=d,r[t+5]=p,!0)}{let i=t+8,a=n[t+6],o=i+s,c=a+s,u=l,d=!1,p=!1;e?u||(d=e.has(o),p=e.has(c),u=!d&&!p):(d=!0,p=!0);let f=u||p,m=!1;(u||d)&&(m=h(i,s,u));let g=!1;f&&(g=h(a,s,u));let v=m||g;if(v)for(let e=0;e<3;e++){let n=i+e,s=a+e,o=r[n],l=r[n+3],c=r[s],h=r[s+3];r[t+e]=o<c?o:c,r[t+e+3]=l>h?l:h}return v}}}traverse(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=this._roots[t],i=new Uint32Array(n),r=new Uint16Array(n);!function t(s){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,o=2*s,l=65535===r[o+15];if(l){let t=i[s+6],c=r[o+14];e(a,l,new Float32Array(n,4*s,6),t,c)}else{let r=s+8,o=i[s+6],c=i[s+7];e(a,l,new Float32Array(n,4*s,6),c)||(t(r,a+1),t(o,a+1))}}(0)}raycast(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=this._roots,i=this.geometry,r=[],s=t.isMaterial,a=Array.isArray(t),o=i.groups,l=s?t.side:t;for(let c=0,h=n.length;c<h;c++){let s=a?t[o[c].materialIndex].side:l,h=r.length;if(mS(n[c]),sS(0,i,s,e,r),gS(),a){let e=o[c].materialIndex;for(let t=h,n=r.length;t<n;t++)r[t].face.materialIndex=e}}return r}raycastFirst(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=this._roots,i=this.geometry,r=t.isMaterial,s=Array.isArray(t),a=null,o=i.groups,l=r?t.side:t;for(let c=0,h=n.length;c<h;c++){let r=s?t[o[c].materialIndex].side:l;mS(n[c]);let h=aS(0,i,r,e);gS(),null!=h&&(null==a||h.distance<a.distance)&&(a=h,s&&(h.face.materialIndex=o[c].materialIndex))}return a}intersectsGeometry(e,t){let n=this.geometry,i=!1;for(let r of this._roots)if(mS(r),i=lS(0,n,e,t),gS(),i)break;return i}shapecast(e,t,n){let i=this.geometry;if(e instanceof Function){if(t){let e=t;t=(t,n,i,r)=>{let s=3*n;return e(t,s,s+1,s+2,i,r)}}e={boundsTraverseOrder:n,intersectsBounds:e,intersectsTriangle:t,intersectsRange:null},console.warn("MeshBVH: Shapecast function signature has changed and now takes an object of callbacks as a second argument. See docs for new signature.")}let r=PS.getPrimitive(),{boundsTraverseOrder:s,intersectsBounds:a,intersectsRange:o,intersectsTriangle:l}=e;if(o&&l){let e=o;o=(t,n,s,a,o)=>!!e(t,n,s,a,o)||Qw(t,n,i,l,s,a,r)}else o||(o=l?(e,t,n,s)=>Qw(e,t,i,l,n,s,r):(e,t,n)=>n);let c=!1,h=0;for(let u of this._roots){if(mS(u),c=oS(0,i,a,o,s,h),gS(),c)break;h+=u.byteLength}return PS.releasePrimitive(r),c}bvhcast(e,t,n){let{intersectsRanges:i,intersectsTriangles:r}=n,s=this.geometry.index,a=this.geometry.attributes.position,o=e.geometry.index,l=e.geometry.attributes.position;xS.copy(t).invert();let c=PS.getPrimitive(),h=PS.getPrimitive();if(r){let e=function(e,n,i,u,d,p,f,m){for(let g=i,v=i+u;g<v;g++){Yw(h,3*g,o,l),h.a.applyMatrix4(t),h.b.applyMatrix4(t),h.c.applyMatrix4(t),h.needsUpdate=!0;for(let t=e,i=e+n;t<i;t++)if(Yw(c,3*t,s,a),c.needsUpdate=!0,r(c,h,t,g,d,p,f,m))return!0}return!1};if(i){let t=i;i=function(n,i,r,s,a,o,l,c){return!!t(n,i,r,s,a,o,l,c)||e(n,i,r,s,a,o,l,c)}}else i=e}e.getBoundingBox(bS),bS.applyMatrix4(t);let u=this.shapecast({intersectsBounds:e=>bS.intersectsBox(e),intersectsRange:(t,n,r,s,a,o)=>(yS.copy(o),yS.applyMatrix4(xS),e.shapecast({intersectsBounds:e=>yS.intersectsBox(e),intersectsRange:(e,r,o,l,c)=>i(t,n,e,r,s,a,l,c)}))});return PS.releasePrimitive(c),PS.releasePrimitive(h),u}intersectsBox(e,t){return wS.set(e.min,e.max,t),wS.needsUpdate=!0,this.shapecast({intersectsBounds:e=>wS.intersectsBox(e),intersectsTriangle:e=>wS.intersectsTriangle(e)})}intersectsSphere(e){return this.shapecast({intersectsBounds:t=>e.intersectsBox(t),intersectsTriangle:t=>t.intersectsSphere(e)})}closestPointToGeometry(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1/0;e.boundingBox||e.computeBoundingBox(),wS.set(e.boundingBox.min,e.boundingBox.max,t),wS.needsUpdate=!0;let a=this.geometry,o=a.attributes.position,l=a.index,c=e.attributes.position,h=e.index,u=PS.getPrimitive(),d=PS.getPrimitive(),p=ES,f=AS,m=null,g=null;i&&(m=CS,g=MS);let v=1/0,y=null,b=null;return xS.copy(t).invert(),SS.matrix.copy(xS),this.shapecast({boundsTraverseOrder:e=>wS.distanceToBox(e),intersectsBounds:(e,t,n)=>n<v&&n<s&&(t&&(SS.min.copy(e.min),SS.max.copy(e.max),SS.needsUpdate=!0),!0),intersectsRange:(n,i)=>{if(e.boundsTree)return e.boundsTree.shapecast({boundsTraverseOrder:e=>SS.distanceToBox(e),intersectsBounds:(e,t,n)=>n<v&&n<s,intersectsRange:(e,s)=>{for(let a=3*e,x=3*(e+s);a<x;a+=3){Yw(d,a,h,c),d.a.applyMatrix4(t),d.b.applyMatrix4(t),d.c.applyMatrix4(t),d.needsUpdate=!0;for(let e=3*n,t=3*(n+i);e<t;e+=3){Yw(u,e,l,o),u.needsUpdate=!0;let t=u.distanceToTriangle(d,p,m);if(t<v&&(f.copy(p),g&&g.copy(m),v=t,y=e/3,b=a/3),t<r)return!0}}}});for(let e=0,s=h?h.count:c.count;e<s;e+=3){Yw(d,e,h,c),d.a.applyMatrix4(t),d.b.applyMatrix4(t),d.c.applyMatrix4(t),d.needsUpdate=!0;for(let t=3*n,s=3*(n+i);t<s;t+=3){Yw(u,t,l,o),u.needsUpdate=!0;let n=u.distanceToTriangle(d,p,m);if(n<v&&(f.copy(p),g&&g.copy(m),v=n,y=t/3,b=e/3),n<r)return!0}}}}),PS.releasePrimitive(u),PS.releasePrimitive(d),v===1/0?null:(n.point?n.point.copy(f):n.point=f.clone(),n.distance=v,n.faceIndex=y,i&&(i.point?i.point.copy(g):i.point=g.clone(),i.point.applyMatrix4(xS),f.applyMatrix4(xS),i.distance=f.sub(i.point).length(),i.faceIndex=b),n)}closestPointToPoint(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1/0,r=n*n,s=i*i,a=1/0,o=null;if(this.shapecast({boundsTraverseOrder:t=>(_S.copy(e).clamp(t.min,t.max),_S.distanceToSquared(e)),intersectsBounds:(e,t,n)=>n<a&&n<s,intersectsTriangle:(t,n)=>{t.closestPointToPoint(e,_S);let i=e.distanceToSquared(_S);return i<a&&(ES.copy(_S),a=i,o=n),i<r}}),a===1/0)return null;let l=Math.sqrt(a);return t.point?t.point.copy(ES):t.point=ES.clone(),t.distance=l,t.faceIndex=o,t}getBoundingBox(e){return e.makeEmpty(),this._roots.forEach((t=>{yw(0,new Float32Array(t),TS),e.union(TS)})),e}},OS=A(M()),IS=.5*(Math.sqrt(3)-1),RS=(3-Math.sqrt(3))/6,kS=1/3,LS=1/6,BS=(Math.sqrt(5),Math.sqrt(5),e=>0|Math.floor(e)),zS=new Float64Array([1,1,-1,1,1,-1,-1,-1,1,0,-1,0,1,0,-1,0,0,1,0,-1,0,1,0,-1]),NS=new Float64Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]);function FS(e){let t=new Uint8Array(512);for(let n=0;n<256;n++)t[n]=n;for(let n=0;n<255;n++){let i=n+~~(e()*(256-n)),r=t[n];t[n]=t[i],t[i]=r}for(let n=256;n<512;n++)t[n]=t[n-256];return t}var US,jS=new Qn,VS=class{constructor(e){this.weightAttribute=null;let t=e.geometry;if(!t.isBufferGeometry||3!==t.attributes.position.itemSize)throw new Error("THREE.MeshSurfaceSampler: Requires BufferGeometry triangle mesh.");t.index&&(t=t.toNonIndexed()),this.geometry=t,this.randomFunction=Math.random,this.positionAttribute=this.geometry.getAttribute("position"),this.distribution=null}build(){let e=this.positionAttribute,t=new Float32Array(e.count/3);for(let i=0;i<e.count;i+=3){let n=1;jS.a.fromBufferAttribute(e,i),jS.b.fromBufferAttribute(e,i+1),jS.c.fromBufferAttribute(e,i+2),n*=jS.getArea(),t[i/3]=n}this.distribution=new Float32Array(e.count/3);let n=0;for(let i=0;i<t.length;i++)n+=t[i],this.distribution[i]=n;return this}setRandomGenerator(e){return this.randomFunction=e,this}sample(e,t){if(this.distribution){let n=this.distribution[this.distribution.length-1],i=this.binarySearch(this.randomFunction()*n);return this.sampleFace(i,e,t)}}binarySearch(e){if(!this.distribution)return 0;let t=this.distribution,n=0,i=t.length-1,r=-1;for(;n<=i;){let s=Math.ceil((n+i)/2);if(0===s||t[s-1]<=e&&t[s]>e){r=s;break}e<t[s]?i=s-1:n=s+1}return r}sampleFace(e,t,n){let i=this.randomFunction(),r=this.randomFunction();return i+r>1&&(i=1-i,r=1-r),jS.a.fromBufferAttribute(this.positionAttribute,3*e),jS.b.fromBufferAttribute(this.positionAttribute,3*e+1),jS.c.fromBufferAttribute(this.positionAttribute,3*e+2),t.set(0,0,0).addScaledVector(jS.a,i).addScaledVector(jS.b,r).addScaledVector(jS.c,1-(i+r)),jS.getNormal(n),this}},GS=A(T()),HS=new pn,WS=new pn,qS=new pn;(e=>{e.is=function(e){return e&&e.__isSPEObject}})(US||(US={}));var XS,YS=e=>class extends e{constructor(){super(...arguments),this.previousModelViewMatrix=new pn,this.copyPreviousMatrix=!0,this.hiddenMatrix=new pn,this.matrixWorldRigid=new pn,this.shearScale=new pn,this.shearScaleInv=new pn}get __isSPEObject(){return!0}isDescendantOf(e){e instanceof Nn&&(e=e.uuid);let t=this;for(;t.parent;){if(t.parent.uuid===e)return!0;t=t.parent}return!1}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(null===this.parent?this.matrixWorld.multiplyMatrices(this.hiddenMatrix,this.matrix):(this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.hiddenMatrix),this.matrixWorld.multiplyMatrices(this.matrixWorld,this.matrix)),this.matrixWorldNeedsUpdate=!1,e=!0);for(let t of this.children)t.updateMatrixWorld(e)}updateWorldMatrix(e,t){let n=this.parent;if(e&&null!==n&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.multiplyMatrices(this.hiddenMatrix,this.matrix):(this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.hiddenMatrix),this.matrixWorld.multiplyMatrices(this.matrixWorld,this.matrix)),t)for(let i of this.children)i.updateWorldMatrix(!1,!0)}traverseChildren(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;for(let n of this.children)US.is(n)&&n.traverseObject(e,t+1)}traverseObject(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!0!==e(this,t))for(let n of this.children)US.is(n)&&n.traverseObject(e,t+1)}updateMatrixWorldSVD(){let e=this.matrixWorld.elements,t=[[e[0],e[4],e[8]],[e[1],e[5],e[9]],[e[2],e[6],e[10]]],{u:n,v:i,q:r}=(0,GS.SVD)(t),s=HS.set(n[0][0],n[0][1],n[0][2],0,n[1][0],n[1][1],n[1][2],0,n[2][0],n[2][1],n[2][2],0,0,0,0,1),a=WS.set(i[0][0],i[0][1],i[0][2],0,i[1][0],i[1][1],i[1][2],0,i[2][0],i[2][1],i[2][2],0,0,0,0,1),o=qS.copy(a).transpose();this.shearScale.makeScale(r[0],r[1],r[2]).multiply(o).premultiply(a),this.shearScaleInv.copy(this.shearScale).invert(),this.matrixWorldRigid.multiplyMatrices(s,o).copyPosition(this.matrixWorld),r.every((e=>Math.abs(r[0]-e)<.01))?this.hasNonUniformScale=!1:this.hasNonUniformScale=!0}attach(e,t){this.updateWorldMatrix(!0,!1);let n=(new pn).copy(this.matrixWorld).invert();return null!==e.parent&&(e.parent.updateWorldMatrix(!0,!1),n.multiply(e.parent.matrixWorld)),"hiddenMatrix"in e&&e.hiddenMatrix instanceof pn?e.hiddenMatrix.premultiply(n):e.applyMatrix4(n),e.updateWorldMatrix(!1,!1),this.add(e),void 0!==t&&(this.children.pop(),this.children.splice(t,0,e)),this}copy(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return super.copy(e,t),this.hasNonUniformScale=e.hasNonUniformScale,this}onAfterRender(e,t,n,i,r,s){this.copyPreviousMatrix&&this.previousModelViewMatrix.copy(this.modelViewMatrix)}},QS=class extends(YS(Nn)){},KS=class extends QS{constructor(e){super(),this.object=e,this.matrixAutoUpdate=!1,this.hasNonUniformScale=e.hasNonUniformScale}raycast(e,t){}expand(){let e=0,t=this.object.entityChildren(e);for(;t;){var n;let i=this.children[e];(null===(n=i)||void 0===n?void 0:n.object)!==t&&(i&&this.remove(i),i=new KS(t),this.add(i),this.children.splice(e,0,this.children.pop()),i.matrixWorldNeedsUpdate=!0,i.matrixAutoUpdate=!1,i.matrix=t.matrix,i.hiddenMatrix=t.hiddenMatrix),i.expand(),e+=1,t=this.object.entityChildren(e)}for(;this.children.length>e;)this.remove(this.children[e])}get visible(){var e;return void 0!==this.playModeVisible?this.playModeVisible:this.object.visible||this.object.dataPatched.visible&&!0===(null===(e=this.object.dataPatched.cloner)||void 0===e?void 0:e.hideBase)}set visible(e){}get castShadow(){return this.object.castShadow}set castShadow(e){}get receiveShadow(){return this.object.receiveShadow}set receiveShadow(e){}get isMesh(){return(e=>"Mesh"===e.type)(this.object)}get isLight(){return this.object.isLight}get layers(){return this.object.layers}set layers(e){}get isCamera(){return!1}get geometry(){if(this.object.geometry)return this.object.geometry}get material(){if(this.object.material)return this.object.material}},ZS=new Bt,JS=new Bt,$S=new pn,e_=[new Bt(-1,1,1),new Bt(-1,-1,1),new Bt(1,-1,1),new Bt(1,1,1),new Bt(-1,1,-1),new Bt(-1,-1,-1),new Bt(1,-1,-1),new Bt(1,1,-1)],t_=[[0,3],[1,2],[5,6],[4,7],[0,1],[3,2],[7,6],[4,5],[0,4],[1,5],[2,6],[3,7]],n_=[[0,2],[7,5],[4,1],[3,6],[4,3],[1,6]],i_=(e,t,n)=>{e.updateEntityBoxSize(ZS,JS),$S.copy(t).multiply(e.matrixWorld),0===JS.x&&0===JS.y&&0===JS.z?n.push(new Bt(ZS.x,ZS.y,ZS.z).applyMatrix4($S)):e_.forEach((e=>{n.push(e.clone().multiply(JS).add(ZS).applyMatrix4($S))}))},r_=class extends Ft{constructor(){super(...arguments),this.matrix=new pn,this.vertices=[],this.faces=[],this.edges=[],this.centerEdges=[]}copy(e){return super.copy(e),this.matrix.copy(e.matrix),this.vertices=e.vertices.map((e=>e.clone())),this.faces=e.faces.map((e=>e.clone())),this.edges=e.edges.map((e=>e.clone())),this.centerEdges=e.centerEdges.map((e=>e.clone())),this}setFromObjectSize(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];e.updateWorldMatrix(!1,t),this.makeEmpty(),this.matrix.copy(e.matrixWorld);let n=(new pn).copy(e.matrixWorld).invert();return this.expandByObjectSize(e,n,t)}expandByObjectSize(e,t){let n=[];return!0===(arguments.length>2&&void 0!==arguments[2]&&arguments[2])?e.traverseEntity((e=>{if(e.visible||e.cloner&&e.data.visible){if(!("geometry"in e))return void n.push(new Bt);i_(e,t,n)}})):i_(e,t,n),this.setFromPoints(n)}getCenter(e){return(e=super.getCenter(e)).applyMatrix4(this.matrix),e}getPositionToCenter(e){return(e=super.getCenter(e)).applyMatrix4($S.copy(this.matrix).setPosition(0,0,0)),e}computeVertices(){this.getSize(JS).multiplyScalar(.5),this.getCenter(ZS),$S.copy(this.matrix).setPosition(ZS),this.vertices=e_.map((e=>e.clone().multiply(JS).applyMatrix4($S)))}computeEdges(){this.vertices.length>0&&this.computeVertices(),this.edges=t_.map((e=>{let[t,n]=e;return new _c(this.vertices[t],this.vertices[n])})),this.centerEdges=this.edges.map((e=>e.getCenter(new Bt)))}computeFaces(){this.vertices.length>0&&this.computeVertices(),this.faces=n_.map((e=>{let[t,n]=e;return this.vertices[t].clone().add(this.vertices[n]).multiplyScalar(.5)}))}},s_={Cloner:()=>{},changeEntityProptotype:()=>{},createEntity:()=>{}},a_=class extends yo{constructor(){super()}getPoints(){let e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:12,n=[],i=this.getCurveLengths(),r=i[i.length-1]/i.length;for(let s=0,a=this.curves;s<a.length;s++){let o=a[s],l=0===s?i[s]:i[s]-i[s-1],c=Math.ceil(t*l/r),h=o.getPoints(c);for(let t=0;t<h.length;t++){let i=h[t];e&&e.equals(i)||(n.push(i),e=i)}}return this.autoClose&&n.length>1&&!n[n.length-1].equals(n[0])&&n.push(n[0]),n}},o_=.001;function l_(e,t,n){return t.clone().sub(e).cross(t.clone().sub(n)).length()<=o_}function c_(e,t){let n=new Bt(...e.position),i=new Bt(...e.controlNext.position),r=new Bt(...t.controlPrevious.position),s=new Bt(...t.position);return l_(n,i,s)&&l_(n,r,s)}function h_(e){let t=e.points.map((e=>new Bt(...e.data.position))),n=[e.points[0]],i=new Bt(...n[0].data.position);for(let o=0;o<e.points.length-1;o++)l_(i,t[o],t[o+1])||(n.push(e.points[o]),i=t[o]);n.push(e.points[e.points.length-1]);let r=e.isClosed,s=n.length-(r?0:1),a=n.length,l=[];for(let u=0;u<a;u++){let t=n[u].data,i=new Bt(...t.position),s=new Bt(...t.controlPrevious.position),c=new Bt(...t.controlNext.position),h={position:i,baseRoundness:t.roundness,controlPrevious:s,controlNext:c};if(0===t.roundness||!e.isClosed&&(0===u||u===a-1)){l[u]=o(o({},h),{},{removedLength:0});continue}let d=r&&u==a-1?0:u+1,p=n[r&&0==u?a-1:u-1].data,f=n[d].data,m=new Bt(...p.position),g=new Bt(...f.position),v=m.clone().sub(i).normalize(),y=g.clone().sub(i).normalize();Object.assign(h,{prevDir:v,nextDir:y});let b=c_(p,t),x=c_(t,f);if(b&&x){let e=v.clone().add(y).normalize(),n=e.clone().cross(v).length()/v.dot(e);l[u]=o(o({},h),{},{tan:n,removedLength:t.roundness/n})}else l[u]=o(o({},h),{},{removedLength:0})}for(let o=0;o<s;o++){let e=r&&o===a-1?0:o+1,t=l[o],n=l[e];if(0!==t.removedLength||0!==n.removedLength){let e=t.position.distanceTo(n.position);t.removedLength=Math.min(t.removedLength,e/2),n.removedLength=Math.min(n.removedLength,e/2)}}let c=[];for(let o=0;o<s;o++){let e=o,t=r&&o===a-1?0:o+1,i=l[e],s=l[t],h=null;if(c_(n[e].data,n[t].data)){let e=i.position.clone(),t=s.position.clone();(0!==i.removedLength||0!==s.removedLength)&&(i.nextDir&&e.add(i.nextDir.clone().setLength(i.removedLength)),s.prevDir&&t.add(s.prevDir.clone().setLength(s.removedLength))),e.distanceTo(t)>o_&&(h=new uo(e,e.clone().lerp(t,.3),t.clone().lerp(e,.3),t))}else i.position.distanceTo(s.position)>o_&&(h=new uo(i.position,i.controlNext,s.controlPrevious,s.position));c[2*o+1]=h}for(let o=0;o<a;o++){let e=l[o];if(0===e.removedLength){c[2*o]=null;continue}let t=e.position,n=e.prevDir.clone().multiplyScalar(e.removedLength).add(t),i=e.nextDir.clone().multiplyScalar(e.removedLength).add(t),r=e.tan*e.removedLength,s=e.prevDir.clone().add(e.nextDir).normalize(),a=n.clone().lerp(i,.5),h=n.distanceTo(i)/2,u=s.clone().multiplyScalar(Math.sqrt(Math.pow(r,2)-Math.pow(h,2))).add(a),d=s.clone().multiplyScalar(-r).add(u),p=t.distanceTo(d)/t.distanceTo(a),f=e.prevDir.clone().multiplyScalar(p*t.distanceTo(n)).add(t),m=f.clone().lerp(d,2),g=n.clone().lerp(f,4/3),v=i.clone().lerp(m,4/3);c[2*o]=new uo(n,g,v,i)}let h=new a_;return c.forEach((e=>{e&&h.add(e)})),h}(e=>{e.is=function(e){return e&&e.__isEntity}})(XS||(XS={}));var u_=e=>XS.is(e),d_={type:"completeState",isfromEntity:!0},p_=["x","y","z"],f_=new Bt,m_=(new Bt).set(0,1,0),g_=e=>class extends(YS(e)){constructor(){super(...arguments),this.raycastLock=!1,this.scaleLock=!1,this.disposed=!1,this.stateSelection=null,this.destroyedInAction=!1,this.instances=[],this.prevState=null,this.currentState=null,this.reversibleToState=null,this.currentTransitionEvent=null,this.previousAction=null,this._singleBBox=new r_,this._recursiveBBox=new r_,this.singleBBoxNeedsUpdate=!0,this.recursiveBBoxNeedsUpdate=!0,this._needApplyPathSnapping=!0,this.attachedPaths=new Set}get __isEntity(){return!0}entityChildren(e){let t=this.children[e];if(XS.is(t))return t}entityChildrenCount(){let e=this.children.length;for(;e--;)if(XS.is(this.children[e]))return e+1;return 0}get isConcreteEntity(){return"string"==typeof this.identity}get isVirtualEntity(){return"string"!=typeof this.identity}get isInstanceRoot(){return this.isConcreteEntity&&"Instance"===this.data.type}nearestInstanceSelfOrParent(){let e=this;for(;"Instance"!==e.data.type;){let t=e.parent;if(!XS.is(t))return;e=t}return e}forInstancesRec(e){this.instances.forEach((t=>{t.disposed||e(t),t.forInstancesRec(e)}))}super_Entity(e,t){"string"==typeof e&&(this.uuid=e),this.identity=e,this.data=t,this.matrixAutoUpdate=!1,this.dataPatched=this.data}changeSelectedState(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(0!==this.data.states.length||n){for(let e of this.data.states)ox.toOps(this.data,e.data).forEach((e=>{let n=gg.replaceProps(e,this.data);this.dataPatched=this.data,this.updateByPatchedOp(n,this.data,t)}));if(null!==e){let n=this.data.states.data(e);n&&(this.dataPatched=ox.patch(this.data,n),ox.toOps(this.data,n).forEach((e=>{this.updateByPatchedOp(e,this.dataPatched,t)})))}n&&this.updateTransformState(this.dataPatched,t),this.stateSelection=e,this.updatePathSnapping(this.dataPatched.pathSnapping)}}get singleBBox(){return this.singleBBoxNeedsUpdate&&(this.singleBBoxNeedsUpdate=!1,this._singleBBox.setFromObjectSize(this,!1),this._singleBBox.computeVertices(),this._singleBBox.computeEdges(),this._singleBBox.computeFaces()),this._singleBBox}get recursiveBBox(){return this.recursiveBBoxNeedsUpdate&&(this.recursiveBBoxNeedsUpdate=!1,this._recursiveBBox.setFromObjectSize(this,!0),this._recursiveBBox.computeVertices(),this._recursiveBBox.computeEdges(),this._recursiveBBox.computeFaces()),this._recursiveBBox}updateEntityBoxSize(e,t){e.setScalar(0),t.setScalar(0)}resetBBoxNeedsUpdateSelf(){this.singleBBoxNeedsUpdate=!0,this.recursiveBBoxNeedsUpdate=!0}resetBBoxNeedsUpdate(){this.resetBBoxNeedsUpdateSelf(),this.traverseAncestors((e=>{u_(e)&&e.resetBBoxNeedsUpdateSelf()})),this.traverseEntity((e=>{e.resetBBoxNeedsUpdateSelf()}))}find(e){let t;return this.traverseEntity((n=>{n.uuid===e&&(t=n)})),t}traverseSortNextHelper(){let e=this.parent;if(e){let t=e.children,n=t.indexOf(this)+1;if(XS.is(t[n]))return t[n];if(XS.is(e))return e.traverseSortNextHelper()}}sortNext(){let e=this.children;return this.children.length>0&&XS.is(this.children[0])?e[0]:this.traverseSortNextHelper()}goUp(e){let t=this;for(;e>0&&null!==t;)t=t.parent,e-=1;return t}hasAnccestorOrSelf(e){return this===e||this.hasAnccestor(e)}hasAnccestor(e){let t=this.parent;for(;t;){if(e===t)return!0;t=t.parent}return!1}countToAccestor(e){let t=0,n=this;for(;n!==e;){if(null===n)return-1;n=n.parent,t+=1}return t}forEachEntity(e){for(let t of this.children)u_(t)&&e(t)}traverseEntityAncestors(e){this.traverseAncestors((t=>{XS.is(t)&&e(t)}))}traverseConcreteEntity(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!0!==e(this,t))for(let n of this.children)u_(n)&&n.isConcreteEntity&&n.traverseEntity(e,t+1)}traverseEntity(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!0!==e(this,t))for(let n of this.children)u_(n)&&n.traverseEntity(e,t+1)}traverseVisibleEntity(e){e(this);for(let t of this.children)u_(t)&&t.visible&&t.traverseVisibleEntity(e)}updateMatrix(){super.updateMatrix(),this.cloner&&this.cloner.onObjUpdateMatrix(),this.dispatchEvent({type:"updateMatrix"})}updateMatrixWorld(e){super.updateMatrixWorld(e),this.dispatchEvent({type:"updateMatrixWorld"})}copy(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return super.copy(e,t),this.dataPatched=e.dataPatched,this.raycastLock=e.raycastLock,this.scaleLock=e.scaleLock,this.hiddenMatrix.copy(e.hiddenMatrix),this}hasEntityChild(){return this.children.some((e=>u_(e)))}isAncestorOf(e){if(this.uuid===e)return!1;let t=!1;return this.traverseEntity((n=>{n.uuid===e&&(t=!0)})),t}toObjectTransformState(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];this.updateWorldMatrix(!0,!1);let t={position:this.position.toArray(),rotation:[this.rotation.x*at.RAD2DEG,this.rotation.y*at.RAD2DEG,this.rotation.z*at.RAD2DEG],scale:this.scale.toArray(),hiddenMatrix:this.hiddenMatrix.toArray()};return xm(t,e)}getTransformValues(e,t,n){return t[e].map(((t,i)=>{var r;return null!==(r=null===n||void 0===n?void 0:n.shared.getVariable(t,[this.uuid,e,p_[i]]))&&void 0!==r?r:t}))}updateTransformState(e,t){var n;let i=!1;return e.position&&(this.position.fromArray(this.getTransformValues("position",e,t)),i=!0),e.rotation&&(f_.fromArray(this.getTransformValues("rotation",e,t)).multiplyScalar(at.DEG2RAD),this.rotation.setFromVector3(f_),i=!0),e.scale&&(this.scale.fromArray(this.getTransformValues("scale",e,t)),i=!0),void 0!==e.hiddenMatrix&&(i=!0,this.hiddenMatrix.fromArray(null!==(n=e.hiddenMatrix)&&void 0!==n?n:Xy.identity)),i&&(this.updateMatrix(),this.resetBBoxNeedsUpdate(),this.invalidateClonerTransform(this),this.traverseEntityAncestors((e=>{e.invalidateClonerTransform(this)}))),e.position&&e.rotation&&e.scale&&void 0!==e.hiddenMatrix&&this.updateWorldMatrix(!1,!0),i}onVariableUpdate(){arguments.length>0&&void 0!==arguments[0]&&arguments[0]?this.resetBBoxNeedsUpdate():(this.updateMatrix(),this.resetBBoxNeedsUpdate(),this.invalidateClonerTransform(this),this.traverseEntityAncestors((e=>{e.invalidateClonerTransform(this)})))}dispose(){this.disposed=!0,this.cloner&&(this.cloner.removeFromParent(),this.cloner=void 0)}disposeChildrenRecursively(){for(let e of this.children)XS.is(e)&&e.disposeRecursively()}disposeRecursively(){this.dispose(),this.children.forEach((e=>{XS.is(e)&&e.disposeRecursively()}))}toState(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=o({name:this.name,visible:this.visible,raycastLock:this.raycastLock},this.toObjectTransformState(e));return xm(t,e)}updateByObjUpdateOp(e,t){void 0!==e&&this.updateByOp({type:0,props:e,path:[]},o(o({},this.data),e),t,!1)}updateByOp(e,t,n,i){let r=this.data;this.data=t;let s=e,a=qg(e.path,["states","*"]);if(null!==a){if(0===e.type){let[t]=a;if((null===this||void 0===this?void 0:this.stateSelection)===t){let t=o({},e.props);if(delete t.name,Object.values(e.props).some((e=>void 0===e))){let n=this.data;if(void 0!==n){let i=Ug.zoom(n,e.path.slice(2));if(i)for(let n in e.props)void 0===e.props[n]&&n in i&&(t[n]=i[n])}}s=o(o({},e),{},{props:t,path:e.path.slice(2)})}}}else if(0===e.type){let t=this.stateSelection?this.data.states.data(this.stateSelection):void 0;if(void 0!==t){if(void 0!==e.props.name&&t.name){let{name:e}=t;t=l(t,f)}if(void 0!==e.props.material&&"material"in t){let{material:e}=t;t=l(t,m)}let n=Ug.removeOverridden(e.path,e.props,t);s=o(o({},e),{},{props:n})}}if(this.updateByPatchedOpBase(s,ox.patch(this.data,this.stateSelection?this.data.states.data(this.stateSelection):void 0),n),qg(e.path,["overrides"])){let i=[],r=[...e.path];for(i.push(r[1]),r.splice(0,2);r.length>0&&"descendants"===r[0];)i.push(r[1]),r.splice(0,2);if(void 0===i[i.length-1]){if(0===e.type)for(let t of Object.keys(e.props)){i[i.length-1]=t;let r=n.scene.findInstance([this.uuid,...i]);r&&(r.overrideData=e.props[t],r.updateState(mg.apply(r.component.data,r.overrideData),n))}}else{let s=n.scene.findInstance([this.uuid,...i]);if(s){let a=Ug.zoom(s.component.data,r);if(0===(e=o(o({},e),{},{path:r})).type){let t=e.props;if(a)for(let[n,i]of Object.entries(e.props))void 0===i&&(t===e.props&&(t=o({},e.props)),t[n]=a[n]);e=o(o({},e),{},{props:t})}s.overrideData=ix.resolve(t.overrides,i),s.updateByOp(e,vg.applySimple(s.data,e),n,!1)}}}else if(this.instances.length>0){let i;if(0===e.path.length&&0===e.type){let t;for(let n of rx.rootOverrideProps)n in e.props&&(void 0===t&&(t={}),t[n]=e.props[n]);t&&(i=o(o({},e),{},{props:t}))}else for(let t of rx.rootOverrideProps)if(qg(e.path,[t])){i=e;break}void 0!==i&&this.instances.forEach((e=>{if(e.isInstanceRoot){let t=mg.filterOp(e.overrideData,i);t&&e.updateByOp(t,vg.applySimple(e.data,t),n,!0)}})),this.instances.forEach((i=>{if(!i.isInstanceRoot){let s=mg.filterOp(i.overrideData,e);if(s){let a;a=r===i.data&&e===s?t:vg.applySimple(i.data,s),i.updateByOp(s,a,n,!0)}}}))}}updateByPatchedOpBase(e,t,n){if(this.dataPatched=t,0===e.path.length&&0===e.type)void 0!==e.props.type&&!eb.is(e.props.type)&&s_.changeEntityProptotype(this,t,n);else if(1===e.path.length&&"geometry"===e.path[0]&&0===e.type&&"type"in e.props){s_.changeEntityProptotype(this,t,n);for(let e of this.children)XS.is(e)&&e.updateVisible(n.scene)}this.updateByPatchedOp(e,t,n)}updateByPatchedOp(e,t,n){if(0===e.path.length&&0===e.type?this.updateState(e.props,n):0===e.type&&("resolutionLevel"in e.props||"useChildrenColors"in e.props)&&this.updateState(t,n),"morphTargetInfluences"===e.path[0]&&0===e.type){var i;let r=null===(i=t.morphTargetInfluences.get(e.path[1]))||void 0===i?void 0:i.data.name;r&&this.updateMorphInfluences(r,n.shared.getVariable(e.props.value,[this.uuid,"morphTargetInfluences",r]))}if(null!==qg(e.path,["pathSnapping"])&&this.updatePathSnapping(t.pathSnapping),null!==qg(e.path,["cloner"])){let i=vg.drop(e,1);0===i.path.length&&0===i.type&&!0===i.props.disabled?this.setFromClonerState(null,n):this.cloner?this.cloner.updateState(t.cloner,n.scene):(this.setFromClonerState(t.cloner,n),this.expandCloner(n.scene)),this.updateVisible(n.scene)}}updatePathSnapping(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.dataPatched.pathSnapping;this._updatedPathSnapping=e,this._needApplyPathSnapping=!0}get updatedPathSnapping(){return this._updatedPathSnapping}applyPathSnapping(e){var t,n,i,r,s,a,l,c,h,u,d;let p=null!==(t=null===(n=this._updatedPathSnapping)||void 0===n?void 0:n.pathId)&&void 0!==t?t:this.dataPatched.pathSnapping.pathId,f=null!==(i=null!==(r=null===(s=this._updatedPathSnapping)||void 0===s?void 0:s.slide)&&void 0!==r?r:this.dataPatched.pathSnapping.slide)&&void 0!==i?i:0,m=null!==(a=null!==(l=null===(c=this._updatedPathSnapping)||void 0===c?void 0:c.offset)&&void 0!==l?l:this.dataPatched.pathSnapping.offset)&&void 0!==a?a:0,g=null!==(h=null===(u=this._updatedPathSnapping)||void 0===u?void 0:u.orientation)&&void 0!==h?h:this.dataPatched.pathSnapping.orientation;if(null===p)return;let v=e.find(p);if(!v||!1===this._needApplyPathSnapping)return;this._needApplyPathSnapping=!1;let y=v.data;if(y.geometry.path.points.length<=1)return;let b=h_(y.geometry.path),x=(f+m)%1;f+m===1&&0===x&&(x=1);let w=null;try{w=b.curves.length?b.getPointAt(x):null}catch(QZ){}if(null===w)return;let S=this.parent?null===(d=this.parent)||void 0===d?void 0:d.matrixWorld:new pn;v.updateMatrixWorld();let _=(new pn).multiplyMatrices(S.clone().invert(),v.matrixWorld);w.applyMatrix4(_);let E={position:w.toArray(),rotation:y.rotation};if("tangential"===g){let e=(new pn).extractRotation(v.matrixWorld),t=b.getTangentAt(x).applyMatrix4(e).add(w),n=(new pn).lookAt(w,t,m_),i=f_.setFromEuler((new _n).setFromRotationMatrix(n)).multiplyScalar(at.RAD2DEG);E=o(o({},E),{},{rotation:i.toArray()})}this.updateTransformState(E),this.traverseEntity((e=>{e._cameraType&&e.dispatchEvent(d_)}))}updateVisible(e){var t,n;if(this.visible=this.dataPatched.visible&&(!this.dataPatched.cloner||null!==(t=this.dataPatched.cloner.disabled)&&void 0!==t&&t||!0!==(null===(n=this.dataPatched.cloner)||void 0===n?void 0:n.hideBase)),!e)return;let i=!1;this.traverseEntity((e=>{if("Splat"===e.data.type)return i=!0,!0})),i&&e.reloadSplats()}updateState_Entity(e,t){void 0!==e.name&&(this.name=e.name),void 0!==e.raycastLock&&(this.raycastLock=e.raycastLock),void 0!==e.visible&&(this.updateVisible(null===t||void 0===t?void 0:t.scene),this.resetBBoxNeedsUpdate()),t&&"cloner"in e&&void 0!==e.cloner&&(this.setFromClonerState(e.cloner,t),this.updateVisible(t.scene)),this.updateTransformState(e,t)}get attachedSurfaceCloners(){return this.children.filter((e=>e instanceof s_.Cloner&&"toObject"===e.parameters.type))}setFromClonerState(e,t){this.disposed||(null===e||e.disabled?(this.cloner&&this.cloner.removeFromParent(),this.cloner=void 0):void 0===this.cloner?(this.cloner=new s_.Cloner(this,e),t.scene.addPendingExpandCloner(this)):this.cloner.updateState(e,t.scene))}expandCloner(e){!this.disposed&&this.cloner&&this.cloner.expandClones(e)}invalidateClonerTransform(e){this.cloner&&this.cloner.invalidateTransform(e)}requestRender(){this.dispatchEvent({type:"requestRender"})}},v_=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){var n,i,r,s,a,o,l;let c=null===(n=e.parameters)||void 0===n?void 0:n.radiusTop,h=null===(i=e.parameters)||void 0===i?void 0:i.radiusBottom,u=Object.assign({},null!==(r=null===t||void 0===t?void 0:t.parameters)&&void 0!==r?r:{width:100,radialSegments:64,heightSegments:1,openEnded:!1,thetaStart:0,thetaLength:360,cornerRadius:8,cornerSegments:8,hollow:0},e.parameters);u.thetaLength=at.clamp(u.thetaLength,0,360);let d=u.width/2,p=null!==(s=u.radiusTop)&&void 0!==s?s:d,f=null!==(a=u.radiusBottom)&&void 0!==a?a:d;if(p===f?(p=d,f=d):p>f?(p=d,f=f*d/p):(p=p*d/f,f=d),u.shapeBlendNode){p=null!==c&&void 0!==c?c:d,f=null!==h&&void 0!==h?h:d;let e=2*Math.max(p,f);u.width=e,u.depth=e}return{parameters:Object.assign(u,{width:Math.abs(u.width),height:Math.abs(null!==(o=u.height)&&void 0!==o?o:u.width),depth:Math.abs(null!==(l=u.depth)&&void 0!==l?l:u.width),radiusTop:p,radiusBottom:f})}}static build(e){let t,{width:n,depth:i,height:r,radialSegments:s,heightSegments:a,openEnded:l,thetaStart:c,thetaLength:h,radiusTop:u,radiusBottom:d,cornerRadius:p,cornerSegments:f,hollow:m}=e.parameters;return 0===h?(t=new di,t.setAttribute("position",new ri([],3))):t=p||m?new x_(u,d,r,s,a,l,c,h*Math.PI/180,p,p,f,m):new wo(u,d,r,s,a,l,c,h*Math.PI/180),t.scale(1,1,i/n),Object.assign(t,{userData:o(o({},e),{},{type:"CylinderGeometry"})})}};function y_(e,t,n){n.x=e.x*t.x,n.y=e.y,n.z=e.x*t.y}function b_(e){return new ot(e.y,-e.x)}var x_=class extends di{constructor(e,t,n,i,r,s,a,o,l,c,h,u){let d=arguments.length>12&&void 0!==arguments[12]&&arguments[12];super(),this.type="RoundedCylinderBufferGeometry",e=void 0!==e?e:1,t=void 0!==t?t:1,n=n||1,i=Math.floor(i)||8,r=Math.floor(r)||1,s=void 0!==s&&s,a=void 0!==a?a:0,o=void 0!==o?o:2*Math.PI,s&&(l=0,c=0);let p=[],f=[],m=[],g=[],v=0,y=n/2,b=new Bt,x=new Bt;d&&0==e&&(e=l),d&&0==t&&(t=c);let w=new ot(e,y),S=new ot(t,-y),_=null,E=null,A=null,C=null,M=w.clone().sub(S),T=0,P=0,D=0;u>0&&(T=Math.min(e,t)*(1-u),P=e-T,D=t-T);let O=w.clone();O.x-=T;let I=Math.PI-M.angle(),R=M.angle(),k=Math.tan(R/2),L=Math.tan(I/2),B=k+L,z=u?B:L,N=u?B:k;if(l=Math.min(l,(e-P)/z,M.length()/B),c=Math.min(c,(t-D)/N,M.length()/B),l>0){let e=l/k;_=w.clone().sub(new ot(e,l)),u&&(A=_.clone(),A.x-=T-B*l),w.sub(M.clone().setLength(e))}if(c>0){let e=c/L;E=S.clone().sub(new ot(e,-c)),S.add(M.clone().setLength(e)),u&&(C=E.clone(),C.x-=T-B*c,O.sub(M.clone().setLength(e)))}M=w.clone().sub(S);let F=M.length()<.5,U=[];for(let H=0;H<=i;H++){let h=[],d=H/i,p=d*o+a,y=new ot(Math.sin(p),Math.cos(p));if(C&&E?(j(h,d,y,I,c,C,-1,!0),j(h,d,y,R,c,E,-1,!1)):E?(V(h,y,E.x,0,-1),j(h,d,y,R,c,E,-1,!1)):s||V(h,y,t,D,-1),y_(b_(M).normalize(),y,b),!F)for(let e=0;e<=r;e++){let t=e/r;y_(M.clone().multiplyScalar(t).add(S),y,x),f.push(x.x,x.y,x.z),m.push(b.x,b.y,b.z),g.push(d,.5+x.y/n),h.push(v++)}if(A&&_?(j(h,d,y,I,l,_,1,!1),j(h,d,y,R,l,A,1,!0)):_?(j(h,d,y,I,l,_,1,!1),V(h,y,_.x,0,1)):s||V(h,y,e,P,1),u&&!F){y_(b_(M).multiplyScalar(-1).normalize(),y,b);for(let e=0;e<=r;e++){let t=e/r;y_(M.clone().multiplyScalar(-t).add(O),y,x),f.push(x.x,x.y,x.z),m.push(b.x,b.y,b.z),g.push(d,.5+x.y/n),h.push(v++)}}u&&!s&&h.push(h[0]),U.push(h)}for(let H=0;H<U.length-1;H++)for(let e=0;e<U[0].length-1;e++){if(s&&u&&e==r)continue;let t=U[H][e],n=U[H+1][e],i=U[H+1][e+1],a=U[H][e+1],o=f[3*i+0],l=f[3*i+2];p.push(t,n,a),(0!=o||0!=l)&&p.push(n,i,a)}function j(e,t,i,r,s,a,o,l){for(let c=0;c<h+1;c++){let u=c/h,d=o<0?u:1-u;l&&(d-=1),d*=r;let p=new ot(Math.sin(d),Math.cos(d)*o);y_(p.clone().multiplyScalar(s).add(a),i,x),f.push(x.x,x.y,x.z),y_(p,i,b),m.push(b.x,b.y,b.z),g.push(t,.5+x.y/n),e.push(v++)}}function V(e,t,n,i,r){let s=new Bt,a=new ot,o=[n,i];r<0&&o.reverse();for(let l of o)a.set(l,y*r),y_(a,t,s),f.push(s.x,s.y,s.z),m.push(0,r,0),g.push(.5,.5),e.push(v++)}function G(n,i,r){let s=new ot(Math.sin(r),Math.cos(r)),a=new ot(-Math.cos(r),Math.sin(r)),o=new Bt,l=n<0?(e,t,n)=>p.push(e,t,n):(e,t,n)=>p.push(e,n,t);y_(new ot((e+t+P+D)/4,0),s,o),f.push(o.x,o.y,o.z),m.push(a.x,0,a.y),g.push(.5,.5);let c=v++;for(let e of i){let t=f.slice(3*e,3*e+3);f.push(...t),m.push(a.x,0,a.y);let n=g.slice(2*e,2*e+2);g.push(...n),v++}for(let e=c+1;e<v-1;e++)l(c,e,e+1);l(c,v-1,c+1)}o<2*Math.PI&&(G(-1,U[0],a),G(1,U[U.length-1],a+o)),this.setIndex(p),this.setAttribute("position",new ri(f,3)),this.setAttribute("normal",new ri(m,3)),this.setAttribute("uv",new ri(g,2))}},w_=Math.PI/2,S_=class extends di{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,o=arguments.length>7&&void 0!==arguments[7]?arguments[7]:4;super(),this.type="BoxGeometry",i=Math.floor(i),r=Math.floor(r),s=Math.floor(s),o=Math.floor(o),a=Math.min(a,e/2,t/2,n/2);let l=[],c=[],h=[],u=[],d=0;function p(e,t,n,i,r,s,o,p,f,m){let g=(s-2*a)/f,v=(o-2*a)/m,y=s/2-a,b=o/2-a,x=p/2,w=f+1,S=m+1,_=0,E=new Bt;for(let a=0;a<S;a++){let s=a*v-b;for(let o=0;o<w;o++){let l=o*g-y;E[e]=l*i,E[t]=s*r,E[n]=x,c.push(E.x,E.y,E.z),E[e]=0,E[t]=0,E[n]=p>0?1:-1,h.push(E.x,E.y,E.z),u.push(o/f),u.push(1-a/m),_+=1}}for(let a=0;a<m;a++)for(let e=0;e<f;e++){let t=d+e+w*a,n=d+e+w*(a+1),i=d+(e+1)+w*(a+1),r=d+(e+1)+w*a;l.push(t,n,r),l.push(n,i,r)}d+=_}function f(e,t,n,i,r,s,p,f,m,g){let v=(p-2*a)/g,y=p/2-a,b=f/2-a,x=m/2,w=g+1,S=0,_=new Bt,E=new Bt;for(let l=0;l<o+1;l++){let d=l/o*w_,p=Math.sin(d)*a,f=(1-Math.cos(d))*a,m=Math.sin(d),A=Math.cos(d);_[t]=(b+p)*r,_[n]=(x-f)*s,E[e]=0,E[t]=m*Math.sign(_[t]),E[n]=A*Math.sign(_[n]);for(let t=0;t<w;t++){let n=t*v-y;_[e]=n*i,c.push(_.x,_.y,_.z),h.push(E.x,E.y,E.z),u.push(t/g),u.push(0),S+=1}}for(let a=0;a<o;a++)for(let e=0;e<g;e++){let t=d+e+w*a,n=d+e+w*(a+1),i=d+(e+1)+w*(a+1),r=d+(e+1)+w*a;l.push(t,n,r),l.push(n,i,r)}d+=S}function m(i,r,s){let p=new Bt,f=new Bt(e/2,t/2,n/2);f.subScalar(a);let m=[],g=i*r*s>0?(e,t,n)=>l.push(e,t,n):(e,t,n)=>l.push(e,n,t);for(let e=0;e<=o;e++){let t=[],n=w_*(1-e/o),l=Math.cos(n),g=Math.sin(n),v=0;for(let o=0;o<=e;o++){let n=Math.cos(v),o=Math.sin(v);p.x=l*n,p.y=g,p.z=l*o;let m=f.clone().addScaledVector(p,a);c.push(i*m.x,r*m.y,s*m.z),h.push(i*p.x,r*p.y,s*p.z),u.push(0,0),t.push(d++),v+=w_/e}m.push(t)}let v=m.length-1;for(let e=0;e<v;e++){let t=m[e],n=m[e+1],i=t.length-1;g(t[0],n[1],n[0]);for(let e=1;e<=i;e++)g(t[e-1],t[e],n[e]),g(t[e],n[e+1],n[e])}}p("z","y","x",-1,-1,n,t,e,s,r),p("z","y","x",1,-1,n,t,-e,s,r),p("x","z","y",1,1,e,n,t,i,s),p("x","z","y",1,-1,e,n,-t,i,s),p("x","y","z",1,-1,e,t,n,i,r),p("x","y","z",-1,-1,e,t,-n,i,r),a>0&&(f("z","y","x",-1,-1,1,n,t,e,s),f("z","y","x",1,-1,-1,n,t,e,s),f("z","y","x",-1,1,-1,n,t,e,s),f("z","y","x",1,1,1,n,t,e,s),f("x","y","z",-1,-1,-1,e,t,n,i),f("x","y","z",1,-1,1,e,t,n,i),f("x","y","z",-1,1,1,e,t,n,i),f("x","y","z",1,1,-1,e,t,n,i),f("y","x","z",-1,-1,1,t,e,n,r),f("y","x","z",1,-1,-1,t,e,n,r),f("y","x","z",1,1,1,t,e,n,r),f("y","x","z",-1,1,-1,t,e,n,r),m(1,1,1),m(-1,1,1),m(1,-1,1),m(-1,-1,1),m(1,1,-1),m(-1,1,-1),m(1,-1,-1),m(-1,-1,-1)),this.setIndex(l),this.setAttribute("position",new ri(c,3)),this.setAttribute("normal",new ri(h,3)),this.setAttribute("uv",new ri(u,2))}},__=class extends di{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.2,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:4;super(),this.type="PolyhedronGeometryRound";let a=[],o=[],l=[];return function(){r=Math.min(.99999,r),0==r&&(s=0);let o={IcosahedronGeometry:5,DodecahedronGeometry:3,HexahedronGeometry:3,OctahedronGeometry:4,TetrahedronGeometry:3}[n],c=new Bt,h=c.clone(),u=new Qn,d=r*i,p=i-d,f=s+1,m=new Bt,g=(e,t)=>m.subVectors(e,t).normalize(),v=(e,t)=>Array(e).fill(void 0).map(t),y=v(e.length/3,((t,n)=>(new Bt).fromArray(e,3*n).setLength(i))),b=[],x=1e6;for(let e=0;e<y.length;e++){let n,i,r,s=y[e],a=[],o=1e10,l=-1;for(;-1!=(l=t.indexOf(e,l+1));){let e=l-l%3;n=t[e+(l+1)%3],i=t[e+(l+2)%3],r=s.distanceToSquared(y[n]),o=Math.min(o,r),a.push([n,i,r])}o+=1e-6;let c=[],h=0,u=a.length;for(let t=0;t<u;t++){var w;[n,i,r]=a[h];let t=1==(null===(w=b[n])||void 0===w?void 0:w.includes(e));r<=o&&c.push(n+ +t*x),h=a.findIndex((e=>e[0]==i))}b.push(c)}let S=[];{let e,t,n=0,i=0,r=3==o;for(let a=0;a<=s;a++){e=a*(a+1)/2,t=(a+1)*(a+2)/2;for(let o=0;o<s-a;o++)[n,i]=[e+o+a+2,t+o+a+3],S.push(e,t,...r?[i,e]:[n,t],i,n),[e,t]=[n,i];S.push(e,t,e+s+2)}}let _=c.clone(),E=c.clone(),A=c.clone(),C=c.clone(),M=c.clone(),T=[],P=v(y.length,(()=>v(o,(()=>c.clone()))));for(let e=0;e<y.length;e++){c.copy(y[e]).normalize(),_.copy(c).multiplyScalar(p);let t=b[e];for(let s=0;s<t.length;s++){let n=t[s],i=t[(s+1)%o];u.setFromPointsAndIndices(y,e,n%x,i%x),u.b.sub(u.a).setLength(1e10).add(u.a),u.c.sub(u.a).setLength(1e10).add(u.a),u.closestPointToPoint(_,P[e][s])}let n=[],i=[],r=[],v=new Bt;0==s&&[...P[e]].reduce(((e,t)=>e.add(t)),v).multiplyScalar(1/o);for(let a=0;a<o;a++){let t=[],l=(a-1+o)%o,u=P[e][l],y=P[e][a];c.copy(u).sub(_),h.copy(y).sub(_);let b=_.angleTo(c),x=c.angleTo(h),w=Math.cos(b)*d;0==s?E.copy(v):E.copy(_).setLength(p+w),i.push(w);let S=[E,u,y];for(let e=0;e<2;e++){let i=S[e],r=S[e+1];C.subVectors(i,_),M.subVectors(r,_),A.crossVectors(C,M).normalize();for(let s=0;s<f;s++){let r=[b,x][e]*s/f;c.copy(C).applyAxisAngle(A,r).add(_),n.push(c.clone()),e&&(g(c,_),t.push([0==s?i:c.clone(),m.clone()]))}e&&(g(r,_),t.push([r,m.clone()]))}r.push(t)}T.push(r);let w=2*f,D=2;for(let e=0;e<o;e++){let t=w*e,r=w*((e+1)%o),s=[n[t]];for(let a=1;a<f;a++){C=n[t+a],M=n[r+a],s.push(C);for(let t=1,n=a-D+1;t<=n;t++)c.lerpVectors(C,M,t/(n+1)),c.sub(_).setLength(i[e]).add(_),s.push(c.clone());s.push(M)}for(let e=0;e<f;e++)s.push(n[e+f+t]);s.push(n[r+f]);let h=S.map((e=>s[e]));a.push(...h.map((e=>[e.x,e.y,e.z])).flat()),l.push(...h.map((e=>(g(e,_),[m.x,m.y,m.z]))).flat())}}let D=[];for(let e=0;e<b.length;e++)for(let t=0;t<o;t++){let n=b[e][t];if(n<x){let i=b[n].findIndex((t=>t%x==e)),r=T[e][t],s=T[n][i];for(let e=0;e<f;e++){let t=r[e],n=s[f-e],i=r[e+1];[t,n,i,i,n,s[f-(e+1)]].forEach((e=>{a.push(e[0].x,e[0].y,e[0].z),l.push(e[1].x,e[1].y,e[1].z)}))}D.push(r[0][0],s[f][0],r[f][0],s[0][0])}}for(;D.length;){let e,t,n,i;[e,t]=D.splice(0,2);let r=[e];for(;e!=t;)r.push(t),n=D.indexOf(t),i=n%2,t=D.splice(n-i,2)[1-i];m.subVectors(r[0],r[1]).cross(c.subVectors(r[0],r[2])).normalize();let s=m.dot(r[0])<0;s&&m.negate();for(let o=1;o<=r.length-2;o++)[r[o+ +s],r[o+1-+s],r[0]].forEach((e=>{a.push(e.x,e.y,e.z),l.push(m.x,m.y,m.z)}))}}(),function(){let e=new Bt;for(let p=0;p<a.length;p+=3){e.x=a[p+0],e.y=a[p+1],e.z=a[p+2];let t=u(e)/2/Math.PI+.5,n=d(e)/Math.PI+.5;o.push(t,1-n)}let t=new Bt,n=new Bt,i=new Bt,r=new Bt,s=new ot,l=new ot,c=new ot,h=(e,t,n,i)=>{i<0&&1===e.x&&(o[t]=e.x-1),0===n.x&&0===n.z&&(o[t]=i/2/Math.PI+.5)};for(let p=0,f=0;p<a.length;p+=9,f+=6){t.set(a[p+0],a[p+1],a[p+2]),n.set(a[p+3],a[p+4],a[p+5]),i.set(a[p+6],a[p+7],a[p+8]),s.set(o[f+0],o[f+1]),l.set(o[f+2],o[f+3]),c.set(o[f+4],o[f+5]),r.copy(t).add(n).add(i).divideScalar(3);let e=u(r);h(s,f+0,t,e),h(l,f+2,n,e),h(c,f+4,i,e)}for(let a=0;a<o.length;a+=6){let e=o[a+0],t=o[a+2],n=o[a+4],i=Math.max(e,t,n),r=Math.min(e,t,n);i>.9&&r<.1&&(e<.2&&(o[a+0]+=1),t<.2&&(o[a+2]+=1),n<.2&&(o[a+4]+=1))}function u(e){return Math.atan2(e.z,-e.x)}function d(e){return Math.atan2(-e.y,Math.sqrt(e.x*e.x+e.z*e.z))}}(),this.setAttribute("position",new ri(a,3)),this.setAttribute("normal",new ri(l,3)),void this.setAttribute("uv",new ri(o,2))}static fromJSON(e){return new __(e.vertices,e.indices,e.radius,e.corner,e.cornerSides)}},E_=class extends __{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.2,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4,i=(1+Math.sqrt(5))/2,r=1/i,s="DodecahedronGeometry";super([-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-r,-i,0,-r,i,0,r,-i,0,r,i,-r,-i,0,-r,i,0,r,-i,0,r,i,0,-i,0,-r,i,0,-r,-i,0,r,i,0,r],[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],s,e,t,n),this.type=s}static fromJSON(e){return new E_(e.radius,e.corner,e.cornerSides)}},A_=1e-12,C_=class{constructor(e){this.position=new ot,this.startPosition=new ot,this.uuid=at.generateUUID(),this.position=e.clone()}start(){this.reset()}reset(){this.startPosition.copy(this.position)}applyOffset(e){this.position.copy(this.startPosition).add(e)}copy(e){return this.position.copy(e.position),this.startPosition.copy(e.startPosition),this}clone(){return new C_(this.position).copy(this)}toJSON(){return[this.position.x,this.position.y]}},M_=class extends C_{constructor(e){super(e.position),this.parent=e}copy(e){return super.copy(e),this}clone(){return new M_(this.parent).copy(this)}},T_=class extends C_{constructor(e,t){super(t),this.controls=[],this.roundness=0,this.areControlsDirectionsMirrored=!0,this.uuid=e,this.controls.push(new M_(this),new M_(this))}static create(e,t){let n=new T_(e,new ot(...t.position));return n.controls[0].position.set(...t.controlPrevious.position),n.controls[1].position.set(...t.controlNext.position),n.roundness=t.roundness,n.areControlsDirectionsMirrored=t.areControlsDirectionsMirrored,n}getOppositeControl(e){let t=this.controls.indexOf(e);return 0===t?this.controls[1]:1===t?this.controls[0]:null}applyOffsetToControls(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;for(let n=0,i=this.controls.length;n<i;n++){let i=this.controls[n];this.position.distanceTo(i.position)<=t?i.position.copy(this.position):i.applyOffset(e)}}controlsMoved(){return!(this.position.equals(this.controls[0].position)&&this.position.equals(this.controls[1].position))}copy(e){return super.copy(e),this.controls[0].copy(e.controls[0]),this.controls[1].copy(e.controls[1]),this.roundness=e.roundness,this.uuid=e.uuid,this}clone(){return new T_(this.uuid,this.position).copy(this)}toJSON(){return super.toJSON().concat(this.controls[0].toJSON(),this.controls[1].toJSON(),[this.roundness])}computeTangents(){var e,t;return[null===(e=this.curveBefore)||void 0===e?void 0:e.getTangentAt(1),null===(t=this.curveAfter)||void 0===t?void 0:t.getTangentAt(0)]}computeNormals(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new ot,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new ot,[n,i]=this.computeTangents();return n&&i&&(P_(n,e),P_(i,t)),[e,t]}computeTangent(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new ot,[t,n]=this.computeTangents();return t&&n&&e.copy(t).add(n).normalize(),e}computeNormal(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new ot,[t,n]=this.computeNormals();return e.copy(t).add(n).normalize(),e}};function P_(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new ot,n=e.length();return t.set(-e.y/n,e.x/n)}var D_=new ot,O_=new ot,I_=new ot,R_=new ot,k_=new ot,L_=new ot,B_=new Bt,z_=new Bt;function N_(e){let t=new ot;t.addVectors(e.v0,D_.subVectors(e.v1,e.v0).multiplyScalar(2/3));let n=new ot;return n.addVectors(e.v2,O_.subVectors(e.v1,e.v2).multiplyScalar(2/3)),new ho(e.v0,t,n,e.v2)}function F_(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Number.EPSILON;return Math.abs(e-t)<n}function U_(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Number.EPSILON;return e.distanceTo(t)<n}function j_(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Number.EPSILON;return e.distanceTo(t)<n}function V_(e,t,n){let i=Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2)),r=Math.sqrt(Math.pow(t.x-n.x,2)+Math.pow(t.y-n.y,2)),s=Math.sqrt(Math.pow(n.x-e.x,2)+Math.pow(n.y-e.y,2));return Math.acos((r*r+i*i-s*s)/(2*r*i))}function G_(e,t,n){return Q_(e,t)&&Q_(t,n)&&H_(e.position,t.position,n.position)}function H_(e,t,n){return 0===D_.copy(t).sub(e).cross(O_.copy(n).sub(e))}function W_(e,t,n,i,r){let s=Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2)),a=(e.y+t.y)/2,o=(e.x+t.x)/2,l=Math.sqrt(Math.pow(n,2)-Math.pow(s/2,2))*(e.y-t.y)/s,c=Math.sqrt(Math.pow(n,2)-Math.pow(s/2,2))*(t.x-e.x)/s;return i.set(o+l,a+c),r.set(o-l,a-c),[i,r]}function q_(e,t,n){return e.distanceTo(n)<t.distanceTo(n)?t:e}function X_(e,t,n,i,r,s){let a,o=t.x-e.x,l=t.y-e.y,c=n.x-e.x,h=n.y-e.y,u=Math.sqrt((o+c)*(o+c)+(l+h)*(l+h));return V_(t,e,n)>Math.PI&&(u*=-1),a=F_(h,l)?(l+h)*(i/u-.5)*8/3/(o-c):(o+c)*(i/u-.5)*8/3/(h-l),r.set(t.x-a*l,t.y+a*o),s.set(n.x+a*h,n.y-a*c),[r,s]}function Y_(e,t){return e.position.equals(e.controls[1].position)&&t.position.equals(t.controls[0].position)}function Q_(e,t){return H_(e.position,e.controls[1].position,t.position)&&H_(e.position,t.controls[0].position,t.position)}function K_(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:12,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=[];for(let r=0,s=e.length;r<s;r++){let s=e[r],a=0;if(n&&void 0!==s.roundedCurveCorner){let e=.5*Z_(s.roundedCurveCorner,t);r>0&&(i[r-1]+=e),a+=e}void 0!==s.curveAfter&&(a+=Z_(s.curveAfter,t)),i.push(a)}return e.length>0&&n&&void 0!==e[0].roundedCurveCorner&&(i[e.length-1]+=.5*Z_(e[0].roundedCurveCorner,t)),i}function Z_(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:12;return e&&e instanceof to?2*t:e&&(e instanceof po||e instanceof fo)?1:e&&e instanceof go?t*e.points.length:t}var J_,$_,eE=new ot,tE=new ot,nE=new ot,iE=new ot,rE=new ot,sE=new ot,aE=class extends Ao{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100;super(),this.points=[],this.shapeHoles=[],this.plane=new Gi(new Bt(0,0,-1)),this.subdivision=0,this.controlSnapDistance=4,this.pointIDs=0,this.isMesh2D=!1,this.isText=!1,this._roundness=0,this.isClosed=!1,this.useCubicForRoundedCorners=!0,this.uuid=at.generateUUID(),this.needsUpdate=!1,this.roundedCurves=[],this._width=e,this._height=t}static createFromState(e,t,n){let i=new aE;return i.isClosed=e.isClosed,i.points=e.points.map((e=>T_.create(e.id,e.data))),"number"==typeof e.roundness&&(i.roundness=e.roundness),i.shapeHoles=e.shapeHoles.map((e=>aE.createFromState(e))),void 0!==t&&void 0!==n&&i.applySize(t,n),i.update(),i}get width(){return this._width}get height(){return this._height}get roundness(){return this._roundness}set roundness(e){if(this._roundness!==e){this._roundness=e;for(let t=0,n=this.points.length;t<n;t++)this.points[t].roundness=e;this.needsUpdate=!0}}getPointsIndexesByIds(e){return e.map((e=>this.getPointIndexById(e))).filter((e=>e>=0))}getPointIndexById(e){let t=this.points.length,n=this.points.findIndex((t=>t.uuid===e));if(n<0){let n=t;for(let t=0,i=this.shapeHoles.length;t<i;t++){let i=this.shapeHoles[t],r=i.points.length,s=i.getPointIndexById(e);if(!(s<0))return s+n;n+=r}}return n}getLineIndexById(e){return this.getPointIndexById(e)}getBezierPoint(e){if(e<=this.points.length-1)return this.points[e];if(this.shapeHoles.length>0){let t=this.points.length;for(let n=0,i=this.shapeHoles.length;n<i;n++){let i=this.shapeHoles[n],r=e-t;if(r<=i.points.length-1)return i.points[r];t+=i.points.length}}throw new Error("This shape does not have a point for this index: "+e)}getBezierPointIndex(e){let t=this.points.indexOf(e);if(t>=0)return t;if(t=this.points.length,this.shapeHoles.length>0)for(let n=0,i=this.shapeHoles.length;n<i;n++){let i=this.shapeHoles[n],r=i.points.indexOf(e);if(r>=0)return t+r;t+=i.points.length}return-1}getAllPoints(){let e=[].concat(...this.shapeHoles.map((e=>e.points)));return[...this.points,...e]}applySize(e,t){0===e&&(e=.001),0===t&&(t=.001),this._width=e,this._height=t}applyScale(e,t){let n=eE.set(e,t);for(let i=0,r=this.points.length;i<r;i++){let e=this.points[i];e.position.multiply(n),e.controls[0].position.multiply(n),e.controls[1].position.multiply(n)}for(let i=0,r=this.shapeHoles.length;i<r;i++)this.shapeHoles[i].applyScale(e,t);this._update()}createPoint(e){let t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:at.generateUUID();t=e instanceof ot?e:new ot(e,n);let r=new T_(i,t);return r.roundness=this.roundness,r}addPoint(e){this.points.push(e),this.needsUpdate=!0}addPointAt(e,t){this.points.splice(t,0,e),this.needsUpdate=!0}getPointByUuid(e){for(let t=0,n=this.points.length;t<n;t++){let n=this.points[t];if(n.uuid===e)return n}for(let t=0,n=this.shapeHoles.length;t<n;t++){let n=this.shapeHoles[t].getPointByUuid(e);if(n)return n}}getFirstPoint(){return this.points[0]}getLastPoint(){return this.points[this.points.length-1]}removePoint(e){let t=this.points.indexOf(e);t>=0&&this.points.splice(t,1),this.needsUpdate=!0}removePointById(e){let t=this.points.find((t=>t.uuid===e));t&&this.removePoint(t)}update(){for(let e=0,t=this.shapeHoles.length;e<t;e++)this.shapeHoles[e].update();this._update()}extractShapePointsToBuffer(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:12,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this.subdivision=t,void 0===this.curveDivisions&&this.computeCurveDivisions(t);let i=n?this.roundedCurveDivisions:this.curveDivisions;return function(e,t){let n,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:12,r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],s=z_.set(0,0,0),a=0,o=[];for(let l=0;l<t.length;l++){let r=t[l],c=D_,h=Z_(r,i);o.push(h);for(let t=0;t<=h;t++)if(r instanceof ho||r instanceof mo||r instanceof po){if(r.getPoint(t/h,c),s.set(c.x,c.y,0),void 0!==n&&j_(n,s))continue;void 0===n&&(n=B_),n.copy(s),e.setXYZ(a,s.x,s.y,s.z),a++}}r&&a>1&&!(e.getX(a-1)===e.getX(0)&&e.getY(a-1)===e.getY(0)&&e.getZ(a-1)===e.getZ(0))&&(e.setXYZ(a,e.getX(0),e.getY(0),e.getZ(0)),a++)}(e,n?this.roundedCurves:this.curves,t,this.autoClose),i.reduce(((e,t)=>e+t),0)+1}computeCurveDivisions(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:12;return this.curveDivisions=K_(this.points,e,!1),this.roundedCurveDivisions=K_(this.points,e,!0),this.curveDivisions}extractFilteredShapePointsToBuffer(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:12;return 2*function(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:12,r=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],s=z_.set(0,0,0),a=0,o=[];for(let c=0;c<t.length;c++){if(!1===n[c])continue;let r,h=t[c],u=D_,d=Z_(h,i);o.push(d);for(let t=0;t<=d;t++)if(h instanceof ho||h instanceof mo||h instanceof po){var l;if(h.getPoint(t/d,u),s.set(u.x,u.y,0),null!==(l=r)&&void 0!==l&&l.equals(s))continue;void 0===r?r=B_:(e.setXYZ(a,r.x,r.y,r.z),a++,e.setXYZ(a,s.x,s.y,s.z),a++),r.copy(s)}}return r&&a>1&&!(e.getX(a-1)===e.getX(0)&&e.getY(a-1)===e.getY(0)&&e.getZ(a-1)===e.getZ(0))&&(e.setXYZ(a,e.getX(0),e.getY(0),e.getZ(0)),a++),o}(e,this.curves,t,n,this.autoClose).reduce(((e,t)=>e+t),0)}extractShapePointsToFlatArray(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:12;return this.subdivision=t,void 0===this.curveDivisions&&this.computeCurveDivisions(t),function(e,t){let n,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:12,r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],s=0;for(let a=0;a<t.length;a++){let r=t[a],o=Z_(r,i),l=D_;for(let t=0;t<=o;t++)if(r instanceof ho||r instanceof mo||r instanceof po){if(r.getPoint(t/o,l),void 0!==n&&U_(n,l,A_))continue;void 0===n&&(n=O_),n.copy(l),e.push(l.x,l.y),s++}}return F_(e[0],e[e.length-2],A_)&&F_(e[1],e[e.length-1],A_)&&(e.pop(),e.pop()),r&&s>1&&!(F_(e[s-1],e[1],A_)&&F_(e[s-2],e[0],A_))&&(e.push(e[0],e[1]),s++),e}(e,this.roundedCurves,t,this.autoClose)}getCurveIndexFromVertexId(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=0;void 0===this.curveDivisions&&this.computeCurveDivisions(this.subdivision);let i=t?this.roundedCurveDivisions:this.curveDivisions,r=0;t&&void 0!==this.points[0].roundedCurveCorner&&(r=.5*Z_(this.points[0].roundedCurveCorner,this.subdivision));let s=e-r;s<0&&(s+=i.reduce(((e,t)=>e+t),0));for(let a=0,o=i.length;a<o;a++){let e=i[a];if(s<n+e)return[a,(s-n+1)/e];n+=e}return[0,1]}getCurveT(e,t,n){let i=this.points[e],r=this.points[e>=this.points.length-1?0:e+1],s=this.curveDivisions,a=s[e];if(Y_(i,r)){let e=i.position.distanceTo(r.position);return i.position.distanceTo(eE.set(n.x,n.y))/e}let o=0;for(let l=0;l<e;l++)o+=s[l];return(t-o)/a}dispose(){}_applyCurveForPoint(e,t){Y_(t,e)?this.lineTo(e.position.x,e.position.y):this.bezierCurveTo(t.controls[1].position.x,t.controls[1].position.y,e.controls[0].position.x,e.controls[0].position.y,e.position.x,e.position.y);let n=this.curves[this.curves.length-1];e.curveBefore=n,t.curveAfter=n;let i=n.clone();e.roundedCurveBefore=i,t.roundedCurveAfter=i,e.roundedCurveCorner=void 0,this.roundedCurves.push(i)}_update(){if(this.curves=[],this.roundedCurves=[],!this.points.length)return;for(let i=0,r=this.points.length;i<r;i++){let e=this.points[i];if(0===i)this.moveTo(e.position.x,e.position.y);else{let t=this.points[i-1];this._applyCurveForPoint(e,t)}}let e=this.getLastPoint();if(null!==e&&void 0!==e&&e.curveAfter&&(e.curveAfter=void 0),this.isClosed){let e=this.points[0],t=this.points[this.points.length-1];this._applyCurveForPoint(e,t)}if(this.points.length>2){let e=0;for(let i=0,r=this.points.length;i<r;i++){var t,n;let r=this.points[i],s=null!==(t=this.points[i-1])&&void 0!==t?t:this.points[this.points.length-1],a=null!==(n=this.points[i+1])&&void 0!==n?n:this.points[0],o=r.roundness,l=s&&a&&G_(s,r,a);if(!r.controlsMoved()&&o>0&&!l){let t=r.curveBefore,n=r.curveAfter;if(void 0===t||void 0===n)continue;let s,a=r.roundedCurveBefore,l=r.roundedCurveAfter,c=t.getLength(),h=n.getLength(),u=Math.min(o,.499*c),d=Math.min(o,.499*h),p=Math.min(u,d),f=1-p/c,m=p/h,g=t.getPointAt(f,eE),v=n.getPointAt(m,tE);if(this._subSplitCurve(t,a,f,g,void 0),this._subSplitCurve(n,l,m,void 0,v),this.useCubicForRoundedCorners){let e=V_(g,r.position,v)/2,t=Math.tan(e)*g.distanceTo(r.position),[n,i]=W_(g,v,t,nE,iE),a=q_(n,i,r.position),[o,l]=X_(a,g,v,t,rE,sE);s=new ho(g.clone(),o.clone(),l.clone(),v.clone())}else s=new mo(g.clone(),r.position.clone(),v.clone());r.roundedCurveCorner=s,this.roundedCurves.splice(i+e,0,s),e++}}}}_subSplitCurve(e,t,n,i,r){if(!(e instanceof po)){let s=e,a=t,o=s.getUtoTmapping(n,0),l=function(e,t,n,i){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.5,s=D_.subVectors(t,e).multiplyScalar(r).add(e),a=O_.subVectors(n,t).multiplyScalar(r).add(t),o=I_.subVectors(i,n).multiplyScalar(r).add(n),l=s,c=R_.subVectors(a,s).multiplyScalar(r).add(s),h=k_.subVectors(o,a).multiplyScalar(r).add(a),u=o,d=L_.subVectors(h,c).multiplyScalar(r).add(c);return[e.x,e.y,l.x,l.y,c.x,c.y,d.x,d.y,h.x,h.y,u.x,u.y,i.x,i.y]}(s.v0,s.v1,s.v2,s.v3,o);return void 0!==i&&(a.v0.set(l[0],l[1]),a.v1.set(l[2],l[3]),a.v2.set(l[4],l[5]),a.v3.set(l[6],l[7])),void 0!==r&&(a.v0.set(l[6],l[7]),a.v1.set(l[8],l[9]),a.v2.set(l[10],l[11]),a.v3.set(l[12],l[13])),a}return void 0!==i&&t.v2.copy(i),void 0!==r&&t.v1.copy(r),t}clone(){let e=new aE(this._width,this._height);return e.points=this.points.map((e=>e.clone())),e.isClosed=this.isClosed,e.roundness=this.roundness,e.isMesh2D=this.isMesh2D,e.shapeHoles=this.shapeHoles.map((e=>e.clone())),e}toJSON(){return{points:this.points.reduce(((e,t)=>e.concat(t.toJSON())),[]),shapeHoles:this.shapeHoles.map((e=>e.toJSON())),isClosed:this.isClosed,roundness:this.roundness}}fromJSON(e){var t;this.points=[],this.pointIDs=0;let n=e.points.length/7;for(let i=0;i<n;i++){let t=7*i,n=e.points[t+0],r=e.points[t+1],s=e.points[t+2],a=e.points[t+3],o=e.points[t+4],l=e.points[t+5],c=e.points[t+6],h=new T_(at.generateUUID(),new ot(n,r));h.controls[0].position.set(s,a),h.controls[1].position.set(o,l),h.roundness=c,this.points.push(h)}return this.shapeHoles=null!==(t=e.shapeHoles)&&void 0!==t&&t.length?e.shapeHoles.map((e=>{let t=new aE;return t.fromJSON(e),t})):[],this.isClosed=e.isClosed,this._roundness=e.roundness,this._update(),this}fromShape(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.isText=t;let n=(e,t)=>{t instanceof ho&&t.v3.equals(e.position)&&e.controls[0].position.copy(t.v2)};return this.points=(e=>{let t,i,r=[];for(t=0,i=e.length;t<i;t++)e[t]instanceof mo&&(e[t]=N_(e[t]));for(t=0,i=e.length;t<i;t++){let i,s=e[t],a=t>0?e[t-1]:null;s instanceof ho?(i=this.createPoint(s.v0),i.controls[1].position.copy(s.v1)):s instanceof po&&(i=this.createPoint(s.v1)),void 0!==i&&(null!==a&&n(i,a),r.push(i))}let s=e[e.length-1],a=!1;return s instanceof ho?s.v3.equals(r[0].position)&&(r[0].controls[0].position.copy(s.v2),a=!0):s instanceof po&&s.v2.equals(r[0].position)&&(a=!0),this.isClosed=a,r})(e.curves),e instanceof Ao&&(this.shapeHoles=e.holes.map((e=>{let t=new aE;return t.fromShape(e),t}))),this.update(),this}updatePoint(e,t){let n=this.getPointByUuid(e);n&&(void 0!==t.position&&n.position.fromArray(t.position),void 0!==t.roundness&&(n.roundness=t.roundness),void 0!==t.areControlsDirectionsMirrored&&(n.areControlsDirectionsMirrored=t.areControlsDirectionsMirrored),this.needsUpdate=!0)}updatePreviousControl(e,t){var n;let i=null===(n=this.getPointByUuid(e))||void 0===n?void 0:n.controls[0];i&&(t.position&&i.position.fromArray(t.position),this.needsUpdate=!0)}updateNextControl(e,t){var n;let i=null===(n=this.getPointByUuid(e))||void 0===n?void 0:n.controls[1];i&&(t.position&&i.position.fromArray(t.position),this.needsUpdate=!0)}},oE=2*Math.PI;function lE(e,t,n,i,r){let{x:s,y:a}=e;return{x:s*t+i,y:a*n+r}}function cE(e,t){let n=1.5707963267948966===t?.551915024494:-1.5707963267948966===t?-.551915024494:1.3333333333333333*Math.tan(t/4),i=Math.cos(e),r=Math.sin(e),s=Math.cos(e+t),a=Math.sin(e+t);return[{x:i-r*n,y:r+i*n},{x:s+a*n,y:a-s*n},{x:s,y:a}]}function hE(e,t,n,i){let r=e*i-t*n<0?-1:1,s=Math.min(1,Math.max(-1,e*n+t*i));return r*Math.acos(s)}function uE(e){let{px:t,py:n,cx:i,cy:r,rx:s,ry:a,largeArcFlag:o,sweepFlag:l}=e,c=[];if(0===s||0===a)return[];let h=(t-i)/2,u=(n-r)/2;if(0===h&&0===u)return[];s=Math.abs(s),a=Math.abs(a);let d=Math.pow(h,2)/Math.pow(s,2)+Math.pow(u,2)/Math.pow(a,2);d>1&&(s*=Math.sqrt(d),a*=Math.sqrt(d));let p=function(e,t,n,i,r,s,a,o,l,c){let h=Math.pow(r,2),u=Math.pow(s,2),d=Math.pow(a,2),p=Math.pow(o,2),f=h*u-h*p-u*d;f<0&&(f=0),f/=h*p+u*d,f=Math.sqrt(f)*(l===c?-1:1);let m=f*r/s*o,g=f*-s/r*a,v=m+(e+n)/2,y=g+(t+i)/2,b=(a-m)/r,x=(o-g)/s,w=(-a-m)/r,S=(-o-g)/s,_=hE(1,0,b,x),E=hE(b,x,w,S);return!c&&E>0&&(E-=oE),c&&E<0&&(E+=oE),{centerx:v,centery:y,ang1:_,ang2:E}}(t,n,i,r,s,a,h,u,o,l),{ang1:f,ang2:m}=p,{centerx:g,centery:v}=p,y=Math.abs(m)/(oE/4);Math.abs(1-y)<1e-7&&(y=1);let b=Math.max(Math.ceil(y),1);m/=b;for(let x=0;x<b;x++)c.push(cE(f,m)),f+=m;return c.map((e=>{let{x:t,y:n}=lE(e[0],s,a,g,v),{x:i,y:r}=lE(e[1],s,a,g,v),{x:o,y:l}=lE(e[2],s,a,g,v);return{x1:t,y1:n,x2:i,y2:r,x:o,y:l}}))}function dE(e,t){if(!e)throw t||"Assertion Failed!"}!function(e){e[e.ODD=0]="ODD",e[e.NONZERO=1]="NONZERO",e[e.POSITIVE=2]="POSITIVE",e[e.NEGATIVE=3]="NEGATIVE",e[e.ABS_GEQ_TWO=4]="ABS_GEQ_TWO"}(J_||(J_={})),function(e){e[e.POLYGONS=0]="POLYGONS",e[e.CONNECTED_POLYGONS=1]="CONNECTED_POLYGONS",e[e.BOUNDARY_CONTOURS=2]="BOUNDARY_CONTOURS"}($_||($_={}));var pE=function(){function e(){}return e.vertEq=function(e,t){return e.s===t.s&&e.t===t.t},e.vertLeq=function(e,t){return e.s<t.s||e.s===t.s&&e.t<=t.t},e.transLeq=function(e,t){return e.t<t.t||e.t===t.t&&e.s<=t.s},e.edgeGoesLeft=function(t){return e.vertLeq(t.Dst,t.Org)},e.edgeGoesRight=function(t){return e.vertLeq(t.Org,t.Dst)},e.vertL1dist=function(e,t){return Math.abs(e.s-t.s)+Math.abs(e.t-t.t)},e.edgeEval=function(t,n,i){dE(e.vertLeq(t,n)&&e.vertLeq(n,i));var r=n.s-t.s,s=i.s-n.s;return r+s>0?r<s?n.t-t.t+(t.t-i.t)*(r/(r+s)):n.t-i.t+(i.t-t.t)*(s/(r+s)):0},e.edgeSign=function(t,n,i){dE(e.vertLeq(t,n)&&e.vertLeq(n,i));var r=n.s-t.s,s=i.s-n.s;return r+s>0?(n.t-i.t)*r+(n.t-t.t)*s:0},e.transEval=function(t,n,i){dE(e.transLeq(t,n)&&e.transLeq(n,i));var r=n.t-t.t,s=i.t-n.t;return r+s>0?r<s?n.s-t.s+(t.s-i.s)*(r/(r+s)):n.s-i.s+(i.s-t.s)*(s/(r+s)):0},e.transSign=function(t,n,i){dE(e.transLeq(t,n)&&e.transLeq(n,i));var r=n.t-t.t,s=i.t-n.t;return r+s>0?(n.s-i.s)*r+(n.s-t.s)*s:0},e.vertCCW=function(e,t,n){return e.s*(t.t-n.t)+t.s*(n.t-e.t)+n.s*(e.t-t.t)>=0},e.interpolate=function(e,t,n,i){return(e=e<0?0:e)<=(n=n<0?0:n)?0===n?(t+i)/2:t+e/(e+n)*(i-t):i+n/(e+n)*(t-i)},e.intersect=function(t,n,i,r,s){var a,o,l;e.vertLeq(t,n)||(l=t,t=n,n=l),e.vertLeq(i,r)||(l=i,i=r,r=l),e.vertLeq(t,i)||(l=t,t=i,i=l,l=n,n=r,r=l),e.vertLeq(i,n)?e.vertLeq(n,r)?((a=e.edgeEval(t,i,n))+(o=e.edgeEval(i,n,r))<0&&(a=-a,o=-o),s.s=e.interpolate(a,i.s,o,n.s)):((a=e.edgeSign(t,i,n))+(o=-e.edgeSign(t,r,n))<0&&(a=-a,o=-o),s.s=e.interpolate(a,i.s,o,r.s)):s.s=(i.s+n.s)/2,e.transLeq(t,n)||(l=t,t=n,n=l),e.transLeq(i,r)||(l=i,i=r,r=l),e.transLeq(t,i)||(l=t,t=i,i=l,l=n,n=r,r=l),e.transLeq(i,n)?e.transLeq(n,r)?((a=e.transEval(t,i,n))+(o=e.transEval(i,n,r))<0&&(a=-a,o=-o),s.t=e.interpolate(a,i.t,o,n.t)):((a=e.transSign(t,i,n))+(o=-e.transSign(t,r,n))<0&&(a=-a,o=-o),s.t=e.interpolate(a,i.t,o,r.t)):s.t=(i.t+n.t)/2},e}(),fE=function(){this.next=null,this.prev=null,this.anEdge=null,this.trail=null,this.n=0,this.marked=!1,this.inside=!1},mE=function(){function e(e){this.side=e,this.next=null,this.Org=null,this.Sym=null,this.Onext=null,this.Lnext=null,this.Lface=null,this.activeRegion=null,this.winding=0}return Object.defineProperty(e.prototype,"Rface",{get:function(){return this.Sym.Lface},set:function(e){this.Sym.Lface=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Dst",{get:function(){return this.Sym.Org},set:function(e){this.Sym.Org=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Oprev",{get:function(){return this.Sym.Lnext},set:function(e){this.Sym.Lnext=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Lprev",{get:function(){return this.Onext.Sym},set:function(e){this.Onext.Sym=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Dprev",{get:function(){return this.Lnext.Sym},set:function(e){this.Lnext.Sym=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Rprev",{get:function(){return this.Sym.Onext},set:function(e){this.Sym.Onext=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Dnext",{get:function(){return this.Sym.Onext.Sym},set:function(e){this.Sym.Onext.Sym=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Rnext",{get:function(){return this.Sym.Lnext.Sym},set:function(e){this.Sym.Lnext.Sym=e},enumerable:!0,configurable:!0}),e}(),gE=function(){this.next=null,this.prev=null,this.anEdge=null,this.coords=[0,0,0],this.s=0,this.t=0,this.pqHandle=0,this.n=0,this.idx=0},vE=function(){function e(){var e=new gE,t=new fE,n=new mE(0),i=new mE(1);e.next=e.prev=e,e.anEdge=null,t.next=t.prev=t,n.next=n,n.Sym=i,i.next=i,i.Sym=n,this.vHead=e,this.fHead=t,this.eHead=n,this.eHeadSym=i}return e.prototype.makeEdge_=function(e){var t=new mE(0),n=new mE(1);e.Sym.side<e.side&&(e=e.Sym);var i=e.Sym.next;return n.next=i,i.Sym.next=t,t.next=e,e.Sym.next=n,t.Sym=n,t.Onext=t,t.Lnext=n,t.Org=null,t.Lface=null,t.winding=0,t.activeRegion=null,n.Sym=t,n.Onext=n,n.Lnext=t,n.Org=null,n.Lface=null,n.winding=0,n.activeRegion=null,t},e.prototype.splice_=function(e,t){var n=e.Onext,i=t.Onext;n.Sym.Lnext=t,i.Sym.Lnext=e,e.Onext=i,t.Onext=n},e.prototype.makeVertex_=function(e,t,n){var i=e;dE(i,"Vertex can't be null!");var r=n.prev;i.prev=r,r.next=i,i.next=n,n.prev=i,i.anEdge=t;var s=t;do{s.Org=i,s=s.Onext}while(s!==t)},e.prototype.makeFace_=function(e,t,n){var i=e;dE(i,"Face can't be null");var r=n.prev;i.prev=r,r.next=i,i.next=n,n.prev=i,i.anEdge=t,i.trail=null,i.marked=!1,i.inside=n.inside;var s=t;do{s.Lface=i,s=s.Lnext}while(s!==t)},e.prototype.killEdge_=function(e){e.Sym.side<e.side&&(e=e.Sym);var t=e.next,n=e.Sym.next;t.Sym.next=n,n.Sym.next=t},e.prototype.killVertex_=function(e,t){var n=e.anEdge,i=n;do{i.Org=t,i=i.Onext}while(i!==n);var r=e.prev,s=e.next;s.prev=r,r.next=s},e.prototype.killFace_=function(e,t){var n=e.anEdge,i=n;do{i.Lface=t,i=i.Lnext}while(i!==n);var r=e.prev,s=e.next;s.prev=r,r.next=s},e.prototype.makeEdge=function(){var e=new gE,t=new gE,n=new fE,i=this.makeEdge_(this.eHead);return this.makeVertex_(e,i,this.vHead),this.makeVertex_(t,i.Sym,this.vHead),this.makeFace_(n,i,this.fHead),i},e.prototype.splice=function(e,t){var n=!1,i=!1;if(e!==t){if(t.Org!==e.Org&&(i=!0,this.killVertex_(t.Org,e.Org)),t.Lface!==e.Lface&&(n=!0,this.killFace_(t.Lface,e.Lface)),this.splice_(t,e),!i){var r=new gE;this.makeVertex_(r,t,e.Org),e.Org.anEdge=e}if(!n){var s=new fE;this.makeFace_(s,t,e.Lface),e.Lface.anEdge=e}}},e.prototype.delete=function(e){var t=e.Sym,n=!1;if(e.Lface!==e.Rface&&(n=!0,this.killFace_(e.Lface,e.Rface)),e.Onext===e)this.killVertex_(e.Org,null);else if(e.Rface.anEdge=e.Oprev,e.Org.anEdge=e.Onext,this.splice_(e,e.Oprev),!n){var i=new fE;this.makeFace_(i,e,e.Lface)}t.Onext===t?(this.killVertex_(t.Org,null),this.killFace_(t.Lface,null)):(e.Lface.anEdge=t.Oprev,t.Org.anEdge=t.Onext,this.splice_(t,t.Oprev)),this.killEdge_(e)},e.prototype.addEdgeVertex=function(e){var t=this.makeEdge_(e),n=t.Sym;this.splice_(t,e.Lnext),t.Org=e.Dst;var i=new gE;return this.makeVertex_(i,n,t.Org),t.Lface=n.Lface=e.Lface,t},e.prototype.splitEdge=function(e){var t=this.addEdgeVertex(e).Sym;return this.splice_(e.Sym,e.Sym.Oprev),this.splice_(e.Sym,t),e.Dst=t.Org,t.Dst.anEdge=t.Sym,t.Rface=e.Rface,t.winding=e.winding,t.Sym.winding=e.Sym.winding,t.idx=e.idx,t.Sym.idx=e.Sym.idx,t},e.prototype.connect=function(e,t){var n=!1,i=this.makeEdge_(e),r=i.Sym;if(t.Lface!==e.Lface&&(n=!0,this.killFace_(t.Lface,e.Lface)),this.splice_(i,e.Lnext),this.splice_(r,t),i.Org=e.Dst,r.Org=t.Org,i.Lface=r.Lface=e.Lface,e.Lface.anEdge=r,!n){var s=new fE;this.makeFace_(s,i,e.Lface)}return i},e.prototype.zapFace=function(e){var t,n,i,r,s,a=e.anEdge;n=a.Lnext;do{n=(t=n).Lnext,t.Lface=null,null===t.Rface&&(t.Onext===t?this.killVertex_(t.Org,null):(t.Org.anEdge=t.Onext,this.splice_(t,t.Oprev)),(i=t.Sym).Onext===i?this.killVertex_(i.Org,null):(i.Org.anEdge=i.Onext,this.splice_(i,i.Oprev)),this.killEdge_(t))}while(t!=a);r=e.prev,(s=e.next).prev=r,r.next=s},e.prototype.countFaceVerts_=function(e){var t=e.anEdge,n=0;do{n++,t=t.Lnext}while(t!==e.anEdge);return n},e.prototype.mergeConvexFaces=function(e){var t,n,i,r,s;for(t=this.fHead.next;t!==this.fHead;t=t.next)if(t.inside)for(s=(n=t.anEdge).Org;i=n.Lnext,(r=n.Sym)&&r.Lface&&r.Lface.inside&&(this.countFaceVerts_(t)+this.countFaceVerts_(r.Lface)-2<=e&&pE.vertCCW(n.Lprev.Org,n.Org,r.Lnext.Lnext.Org)&&pE.vertCCW(r.Lprev.Org,r.Org,n.Lnext.Lnext.Org)&&(i=r.Lnext,this.delete(r),n=null,r=null)),!n||n.Lnext.Org!==s;)n=i;return!0},e.prototype.check=function(){var e,t,n,i,r,s,a=this.fHead,o=this.vHead,l=this.eHead;for(t=a,t=a;(e=t.next)!==a;t=e){dE(e.prev===t),r=e.anEdge;do{dE(r.Sym!==r),dE(r.Sym.Sym===r),dE(r.Lnext.Onext.Sym===r),dE(r.Onext.Sym.Lnext===r),dE(r.Lface===e),r=r.Lnext}while(r!==e.anEdge)}for(dE(e.prev===t&&null===e.anEdge),i=o,i=o;(n=i.next)!==o;i=n){dE(n.prev===i),r=n.anEdge;do{dE(r.Sym!==r),dE(r.Sym.Sym===r),dE(r.Lnext.Onext.Sym===r),dE(r.Onext.Sym.Lnext===r),dE(r.Org===n),r=r.Onext}while(r!==n.anEdge)}for(dE(n.prev===i&&null===n.anEdge),s=l,s=l;(r=s.next)!==l;s=r)dE(r.Sym.next===s.Sym),dE(r.Sym!==r),dE(r.Sym.Sym===r),dE(null!==r.Org),dE(null!==r.Dst),dE(r.Lnext.Onext.Sym===r),dE(r.Onext.Sym.Lnext===r);dE(r.Sym.next===s.Sym&&r.Sym===this.eHeadSym&&r.Sym.Sym===r&&null===r.Org&&null===r.Dst&&null===r.Lface&&null===r.Rface)},e}(),yE=function(){this.handle=null},bE=function(){this.key=null,this.node=0},xE=function(){function e(e,t){this.leq=t,this.max=0,this.nodes=[],this.handles=[],this.initialized=!1,this.freeList=0,this.size=0,this.max=e,this.nodes=[],this.handles=[];for(var n=0;n<e+1;n++)this.nodes[n]=new yE,this.handles[n]=new bE;this.initialized=!1,this.nodes[1].handle=1,this.handles[1].key=null}return e.prototype.floatDown_=function(e){var t,n,i,r=this.nodes,s=this.handles;for(t=r[e].handle;;){if((i=e<<1)<this.size&&this.leq(s[r[i+1].handle].key,s[r[i].handle].key)&&++i,dE(i<=this.max),n=r[i].handle,i>this.size||this.leq(s[t].key,s[n].key)){r[e].handle=t,s[t].node=e;break}r[e].handle=n,s[n].node=e,e=i}},e.prototype.floatUp_=function(e){var t,n,i,r=this.nodes,s=this.handles;for(t=r[e].handle;;){if(n=r[i=e>>1].handle,0===i||this.leq(s[n].key,s[t].key)){r[e].handle=t,s[t].node=e;break}r[e].handle=n,s[n].node=e,e=i}},e.prototype.init=function(){for(var e=this.size;e>=1;--e)this.floatDown_(e);this.initialized=!0},e.prototype.min=function(){return this.handles[this.nodes[1].handle].key},e.prototype.insert=function(e){var t,n;if(2*(t=++this.size)>this.max){var i,r;for(this.max*=2,r=this.nodes.length,this.nodes.length=this.max+1,i=r;i<this.nodes.length;i++)this.nodes[i]=new yE;for(r=this.handles.length,this.handles.length=this.max+1,i=r;i<this.handles.length;i++)this.handles[i]=new bE}return 0===this.freeList?n=t:(n=this.freeList,this.freeList=this.handles[n].node),this.nodes[t].handle=n,this.handles[n].node=t,this.handles[n].key=e,this.initialized&&this.floatUp_(t),n},e.prototype.extractMin=function(){var e=this.nodes,t=this.handles,n=e[1].handle,i=t[n].key;return this.size>0&&(e[1].handle=e[this.size].handle,t[e[1].handle].node=1,t[n].key=null,t[n].node=this.freeList,this.freeList=n,--this.size,this.size>0&&this.floatDown_(1)),i},e.prototype.delete=function(e){var t,n=this.nodes,i=this.handles;dE(e>=1&&e<=this.max&&null!==i[e].key),n[t=i[e].node].handle=n[this.size].handle,i[n[t].handle].node=t,--this.size,t<=this.size&&(t<=1||this.leq(i[n[t>>1].handle].key,i[n[t].handle].key)?this.floatDown_(t):this.floatUp_(t)),i[e].key=null,i[e].node=this.freeList,this.freeList=e},e}(),wE=function(){this.eUp=null,this.nodeUp=null,this.windingNumber=0,this.inside=!1,this.sentinel=!1,this.dirty=!1,this.fixUpperEdge=!1},SE=function(){this.key=null,this.next=null,this.prev=null},_E=function(){function e(e,t){this.frame=e,this.leq=t,this.head=new SE,this.head.next=this.head,this.head.prev=this.head}return e.prototype.min=function(){return this.head.next},e.prototype.max=function(){return this.head.prev},e.prototype.insert=function(e){return this.insertBefore(this.head,e)},e.prototype.search=function(e){var t=this.head;do{t=t.next}while(null!==t.key&&!this.leq(this.frame,e,t.key));return t},e.prototype.insertBefore=function(e,t){do{e=e.prev}while(null!==e.key&&!this.leq(this.frame,e.key,t));var n=new SE;return n.key=t,n.next=e.next,e.next.prev=n,n.prev=e,e.next=n,n},e.prototype.delete=function(e){e.next.prev=e.prev,e.prev.next=e.next},e}(),EE=function(){function e(){}return e.regionBelow=function(e){return e.nodeUp.prev.key},e.regionAbove=function(e){return e.nodeUp.next.key},e.debugEvent=function(e){},e.addWinding=function(e,t){e.winding+=t.winding,e.Sym.winding+=t.Sym.winding},e.edgeLeq=function(e,t,n){var i=e.event,r=t.eUp,s=n.eUp;return r.Dst===i?s.Dst===i?pE.vertLeq(r.Org,s.Org)?pE.edgeSign(s.Dst,r.Org,s.Org)<=0:pE.edgeSign(r.Dst,s.Org,r.Org)>=0:pE.edgeSign(s.Dst,i,s.Org)<=0:s.Dst===i?pE.edgeSign(r.Dst,i,r.Org)>=0:pE.edgeEval(r.Dst,i,r.Org)>=pE.edgeEval(s.Dst,i,s.Org)},e.deleteRegion=function(e,t){t.fixUpperEdge&&dE(0===t.eUp.winding),t.eUp.activeRegion=null,e.dict.delete(t.nodeUp)},e.fixUpperEdge=function(e,t,n){dE(t.fixUpperEdge),e.mesh.delete(t.eUp),t.fixUpperEdge=!1,t.eUp=n,n.activeRegion=t},e.topLeftRegion=function(t,n){var i,r=n.eUp.Org;do{n=e.regionAbove(n)}while(n.eUp.Org===r);if(n.fixUpperEdge){if(null===(i=t.mesh.connect(e.regionBelow(n).eUp.Sym,n.eUp.Lnext)))return null;e.fixUpperEdge(t,n,i),n=e.regionAbove(n)}return n},e.topRightRegion=function(t){var n=t.eUp.Dst;do{t=e.regionAbove(t)}while(t.eUp.Dst===n);return t},e.addRegionBelow=function(e,t,n){var i=new wE;return i.eUp=n,i.nodeUp=e.dict.insertBefore(t.nodeUp,i),i.fixUpperEdge=!1,i.sentinel=!1,i.dirty=!1,n.activeRegion=i,i},e.isWindingInside=function(e,t){switch(e.windingRule){case J_.ODD:return 0!==(1&t);case J_.NONZERO:return 0!==t;case J_.POSITIVE:return t>0;case J_.NEGATIVE:return t<0;case J_.ABS_GEQ_TWO:return t>=2||t<=-2}throw new Error("Invalid winding rulle")},e.computeWinding=function(t,n){n.windingNumber=e.regionAbove(n).windingNumber+n.eUp.winding,n.inside=e.isWindingInside(t,n.windingNumber)},e.finishRegion=function(t,n){var i=n.eUp,r=i.Lface;r.inside=n.inside,r.anEdge=i,e.deleteRegion(t,n)},e.finishLeftRegions=function(t,n,i){for(var r,s=null,a=n,o=n.eUp;a!==i;){if(a.fixUpperEdge=!1,(r=(s=e.regionBelow(a)).eUp).Org!=o.Org){if(!s.fixUpperEdge){e.finishRegion(t,a);break}r=t.mesh.connect(o.Lprev,r.Sym),e.fixUpperEdge(t,s,r)}o.Onext!==r&&(t.mesh.splice(r.Oprev,r),t.mesh.splice(o,r)),e.finishRegion(t,a),o=s.eUp,a=s}return o},e.addRightEdges=function(t,n,i,r,s,a){var o,l,c,h,u=!0;c=i;do{dE(pE.vertLeq(c.Org,c.Dst)),e.addRegionBelow(t,n,c.Sym),c=c.Onext}while(c!==r);for(null===s&&(s=e.regionBelow(n).eUp.Rprev),l=n,h=s;(c=(o=e.regionBelow(l)).eUp.Sym).Org===h.Org;)c.Onext!==h&&(t.mesh.splice(c.Oprev,c),t.mesh.splice(h.Oprev,c)),o.windingNumber=l.windingNumber-c.winding,o.inside=e.isWindingInside(t,o.windingNumber),l.dirty=!0,!u&&e.checkForRightSplice(t,l)&&(e.addWinding(c,h),e.deleteRegion(t,l),t.mesh.delete(h)),u=!1,l=o,h=c;l.dirty=!0,dE(l.windingNumber-c.winding===o.windingNumber),a&&e.walkDirtyRegions(t,l)},e.spliceMergeVertices=function(e,t,n){e.mesh.splice(t,n)},e.vertexWeights=function(e,t,n){var i=pE.vertL1dist(t,e),r=pE.vertL1dist(n,e),s=.5*r/(i+r),a=.5*i/(i+r);e.coords[0]+=s*t.coords[0]+a*n.coords[0],e.coords[1]+=s*t.coords[1]+a*n.coords[1],e.coords[2]+=s*t.coords[2]+a*n.coords[2]},e.getIntersectData=function(t,n,i,r,s,a){n.coords[0]=n.coords[1]=n.coords[2]=0,n.idx=-1,e.vertexWeights(n,i,r),e.vertexWeights(n,s,a)},e.checkForRightSplice=function(t,n){var i=e.regionBelow(n),r=n.eUp,s=i.eUp;if(pE.vertLeq(r.Org,s.Org)){if(pE.edgeSign(s.Dst,r.Org,s.Org)>0)return!1;pE.vertEq(r.Org,s.Org)?r.Org!==s.Org&&(t.pq.delete(r.Org.pqHandle),e.spliceMergeVertices(t,s.Oprev,r)):(t.mesh.splitEdge(s.Sym),t.mesh.splice(r,s.Oprev),n.dirty=i.dirty=!0)}else{if(pE.edgeSign(r.Dst,s.Org,r.Org)<0)return!1;e.regionAbove(n).dirty=n.dirty=!0,t.mesh.splitEdge(r.Sym),t.mesh.splice(s.Oprev,r)}return!0},e.checkForLeftSplice=function(t,n){var i,r=e.regionBelow(n),s=n.eUp,a=r.eUp;if(dE(!pE.vertEq(s.Dst,a.Dst)),pE.vertLeq(s.Dst,a.Dst)){if(pE.edgeSign(s.Dst,a.Dst,s.Org)<0)return!1;e.regionAbove(n).dirty=n.dirty=!0,i=t.mesh.splitEdge(s),t.mesh.splice(a.Sym,i),i.Lface.inside=n.inside}else{if(pE.edgeSign(a.Dst,s.Dst,a.Org)>0)return!1;n.dirty=r.dirty=!0,i=t.mesh.splitEdge(a),t.mesh.splice(s.Lnext,a.Sym),i.Rface.inside=n.inside}return!0},e.checkForIntersect=function(t,n){var i,r,s=e.regionBelow(n),a=n.eUp,o=s.eUp,l=a.Org,c=o.Org,h=a.Dst,u=o.Dst,d=new gE;if(dE(!pE.vertEq(u,h)),dE(pE.edgeSign(h,t.event,l)<=0),dE(pE.edgeSign(u,t.event,c)>=0),dE(l!==t.event&&c!==t.event),dE(!n.fixUpperEdge&&!s.fixUpperEdge),l===c||Math.min(l.t,h.t)>Math.max(c.t,u.t))return!1;if(pE.vertLeq(l,c)){if(pE.edgeSign(u,l,c)>0)return!1}else if(pE.edgeSign(h,c,l)<0)return!1;return e.debugEvent(t),pE.intersect(h,l,u,c,d),dE(Math.min(l.t,h.t)<=d.t),dE(d.t<=Math.max(c.t,u.t)),dE(Math.min(u.s,h.s)<=d.s),dE(d.s<=Math.max(c.s,l.s)),pE.vertLeq(d,t.event)&&(d.s=t.event.s,d.t=t.event.t),i=pE.vertLeq(l,c)?l:c,pE.vertLeq(i,d)&&(d.s=i.s,d.t=i.t),pE.vertEq(d,l)||pE.vertEq(d,c)?(e.checkForRightSplice(t,n),!1):!pE.vertEq(h,t.event)&&pE.edgeSign(h,t.event,d)>=0||!pE.vertEq(u,t.event)&&pE.edgeSign(u,t.event,d)<=0?u===t.event?(t.mesh.splitEdge(a.Sym),t.mesh.splice(o.Sym,a),n=e.topLeftRegion(t,n),a=e.regionBelow(n).eUp,e.finishLeftRegions(t,e.regionBelow(n),s),e.addRightEdges(t,n,a.Oprev,a,a,!0),!0):h===t.event?(t.mesh.splitEdge(o.Sym),t.mesh.splice(a.Lnext,o.Oprev),s=n,n=e.topRightRegion(n),r=e.regionBelow(n).eUp.Rprev,s.eUp=o.Oprev,o=e.finishLeftRegions(t,s,null),e.addRightEdges(t,n,o.Onext,a.Rprev,r,!0),!0):(pE.edgeSign(h,t.event,d)>=0&&(e.regionAbove(n).dirty=n.dirty=!0,t.mesh.splitEdge(a.Sym),a.Org.s=t.event.s,a.Org.t=t.event.t),pE.edgeSign(u,t.event,d)<=0&&(n.dirty=s.dirty=!0,t.mesh.splitEdge(o.Sym),o.Org.s=t.event.s,o.Org.t=t.event.t),!1):(t.mesh.splitEdge(a.Sym),t.mesh.splitEdge(o.Sym),t.mesh.splice(o.Oprev,a),a.Org.s=d.s,a.Org.t=d.t,a.Org.pqHandle=t.pq.insert(a.Org),e.getIntersectData(t,a.Org,l,h,c,u),e.regionAbove(n).dirty=n.dirty=s.dirty=!0,!1)},e.walkDirtyRegions=function(t,n){for(var i,r,s=e.regionBelow(n);;){for(;s.dirty;)n=s,s=e.regionBelow(s);if(!n.dirty&&(s=n,null===(n=e.regionAbove(n))||!n.dirty))return;if(n.dirty=!1,i=n.eUp,r=s.eUp,i.Dst!==r.Dst&&e.checkForLeftSplice(t,n)&&(s.fixUpperEdge?(e.deleteRegion(t,s),t.mesh.delete(r),r=(s=e.regionBelow(n)).eUp):n.fixUpperEdge&&(e.deleteRegion(t,n),t.mesh.delete(i),i=(n=e.regionAbove(s)).eUp)),i.Org!==r.Org)if(i.Dst===r.Dst||n.fixUpperEdge||s.fixUpperEdge||i.Dst!==t.event&&r.Dst!==t.event)e.checkForRightSplice(t,n);else if(e.checkForIntersect(t,n))return;i.Org===r.Org&&i.Dst===r.Dst&&(e.addWinding(r,i),e.deleteRegion(t,n),t.mesh.delete(i),n=e.regionAbove(s))}},e.connectRightVertex=function(t,n,i){var r,s=i.Onext,a=e.regionBelow(n),o=n.eUp,l=a.eUp,c=!1;o.Dst!==l.Dst&&e.checkForIntersect(t,n),pE.vertEq(o.Org,t.event)&&(t.mesh.splice(s.Oprev,o),n=e.topLeftRegion(t,n),s=e.regionBelow(n).eUp,e.finishLeftRegions(t,e.regionBelow(n),a),c=!0),pE.vertEq(l.Org,t.event)&&(t.mesh.splice(i,l.Oprev),i=e.finishLeftRegions(t,a,null),c=!0),c?e.addRightEdges(t,n,i.Onext,s,s,!0):(r=pE.vertLeq(l.Org,o.Org)?l.Oprev:o,r=t.mesh.connect(i.Lprev,r),e.addRightEdges(t,n,r,r.Onext,r.Onext,!1),r.Sym.activeRegion.fixUpperEdge=!0,e.walkDirtyRegions(t,n))},e.connectLeftDegenerate=function(t,n,i){var r,s,a,o,l;return r=n.eUp,pE.vertEq(r.Org,i)?(dE(!1),void e.spliceMergeVertices(t,r,i.anEdge)):pE.vertEq(r.Dst,i)?(dE(!1),n=e.topRightRegion(n),s=o=(a=(l=e.regionBelow(n)).eUp.Sym).Onext,l.fixUpperEdge&&(dE(s!==a),e.deleteRegion(t,l),t.mesh.delete(a),a=s.Oprev),t.mesh.splice(i.anEdge,a),pE.edgeGoesLeft(s)||(s=null),void e.addRightEdges(t,n,a.Onext,o,s,!0)):(t.mesh.splitEdge(r.Sym),n.fixUpperEdge&&(t.mesh.delete(r.Onext),n.fixUpperEdge=!1),t.mesh.splice(i.anEdge,r),void e.sweepEvent(t,i))},e.connectLeftVertex=function(t,n){var i,r,s,a,o,l,c=new wE;if(c.eUp=n.anEdge.Sym,i=t.dict.search(c).key,r=e.regionBelow(i)){if(a=i.eUp,o=r.eUp,0===pE.edgeSign(a.Dst,n,a.Org))return void e.connectLeftDegenerate(t,i,n);if(s=pE.vertLeq(o.Dst,a.Dst)?i:r,i.inside||s.fixUpperEdge){if(s===i)l=t.mesh.connect(n.anEdge.Sym,a.Lnext);else l=t.mesh.connect(o.Dnext,n.anEdge).Sym;s.fixUpperEdge?e.fixUpperEdge(t,s,l):e.computeWinding(t,e.addRegionBelow(t,i,l)),e.sweepEvent(t,n)}else e.addRightEdges(t,i,n.anEdge,n.anEdge,null,!0)}},e.sweepEvent=function(t,n){t.event=n,e.debugEvent(t);for(var i=n.anEdge;null===i.activeRegion;)if((i=i.Onext)===n.anEdge)return void e.connectLeftVertex(t,n);var r=e.topLeftRegion(t,i.activeRegion);dE(null!==r);var s=e.regionBelow(r),a=s.eUp,o=e.finishLeftRegions(t,s,null);o.Onext===a?e.connectRightVertex(t,r,o):e.addRightEdges(t,r,o.Onext,a,a,!0)},e.addSentinel=function(e,t,n,i){var r=new wE,s=e.mesh.makeEdge();s.Org.s=n,s.Org.t=i,s.Dst.s=t,s.Dst.t=i,e.event=s.Dst,r.eUp=s,r.windingNumber=0,r.inside=!1,r.fixUpperEdge=!1,r.sentinel=!0,r.dirty=!1,r.nodeUp=e.dict.insert(r)},e.initEdgeDict=function(t){t.dict=new _E(t,e.edgeLeq);var n=t.bmax[0]-t.bmin[0],i=t.bmax[1]-t.bmin[1],r=t.bmin[0]-n,s=t.bmax[0]+n,a=t.bmin[1]-i,o=t.bmax[1]+i;e.addSentinel(t,r,s,a),e.addSentinel(t,r,s,o)},e.doneEdgeDict=function(t){for(var n,i=0;null!==(n=t.dict.min().key);)n.sentinel||(dE(n.fixUpperEdge),dE(1===++i)),dE(0===n.windingNumber),e.deleteRegion(t,n)},e.removeDegenerateEdges=function(t){var n,i,r,s=t.mesh.eHead;for(n=s.next;n!==s;n=i)i=n.next,r=n.Lnext,pE.vertEq(n.Org,n.Dst)&&n.Lnext.Lnext!==n&&(e.spliceMergeVertices(t,r,n),t.mesh.delete(n),r=(n=r).Lnext),r.Lnext===n&&(r!==n&&((r===i||r===i.Sym)&&(i=i.next),t.mesh.delete(r)),(n===i||n===i.Sym)&&(i=i.next),t.mesh.delete(n))},e.initPriorityQ=function(e){var t,n,i,r=0;for(n=(i=e.mesh.vHead).next;n!==i;n=n.next)r++;for(r+=8,t=e.pq=new xE(r,pE.vertLeq),n=(i=e.mesh.vHead).next;n!==i;n=n.next)n.pqHandle=t.insert(n);return n===i&&(t.init(),!0)},e.donePriorityQ=function(e){e.pq=null},e.removeDegenerateFaces=function(t,n){var i,r,s;for(i=n.fHead.next;i!==n.fHead;i=r)r=i.next,dE((s=i.anEdge).Lnext!==s),s.Lnext.Lnext===s&&(e.addWinding(s.Onext,s),t.mesh.delete(s));return!0},e.computeInterior=function(t,n){var i,r;if(void 0===n&&(n=!0),e.removeDegenerateEdges(t),!e.initPriorityQ(t))return!1;for(e.initEdgeDict(t);null!==(i=t.pq.extractMin());){for(;null!==(r=t.pq.min())&&pE.vertEq(r,i);)r=t.pq.extractMin(),e.spliceMergeVertices(t,i.anEdge,r.anEdge);e.sweepEvent(t,i)}return t.event=t.dict.min().key.eUp.Org,e.debugEvent(t),e.doneEdgeDict(t),e.donePriorityQ(t),!!e.removeDegenerateFaces(t,t.mesh)&&(n&&t.mesh.check(),!0)},e}(),AE=function(){function e(){this.mesh=new vE,this.normal=[0,0,0],this.sUnit=[0,0,0],this.tUnit=[0,0,0],this.bmin=[0,0],this.bmax=[0,0],this.windingRule=J_.ODD,this.dict=null,this.pq=null,this.event=null,this.vertexIndexCounter=0,this.vertices=[],this.vertexIndices=[],this.vertexCount=0,this.elements=[],this.elementCount=0}return e.prototype.dot_=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]},e.prototype.normalize_=function(e){var t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2];if(!t)throw"Zero-size vector!";t=Math.sqrt(t),e[0]/=t,e[1]/=t,e[2]/=t},e.prototype.longAxis_=function(e){var t=0;return Math.abs(e[1])>Math.abs(e[0])&&(t=1),Math.abs(e[2])>Math.abs(e[t])&&(t=2),t},e.prototype.computeNormal_=function(e){var t,n,i,r,s,a,o=[0,0,0],l=[0,0,0],c=[0,0,0],h=[0,0,0],u=[0,0,0],d=[null,null,null],p=[null,null,null],f=this.mesh.vHead;t=f.next;for(var m=0;m<3;++m)r=t.coords[m],l[m]=r,p[m]=t,o[m]=r,d[m]=t;for(t=f.next;t!==f;t=t.next)for(var g=0;g<3;++g)(r=t.coords[g])<l[g]&&(l[g]=r,p[g]=t),r>o[g]&&(o[g]=r,d[g]=t);var v=0;if(o[1]-l[1]>o[0]-l[0]&&(v=1),o[2]-l[2]>o[v]-l[v]&&(v=2),l[v]>=o[v])return e[0]=0,e[1]=0,void(e[2]=1);for(a=0,n=p[v],i=d[v],c[0]=n.coords[0]-i.coords[0],c[1]=n.coords[1]-i.coords[1],c[2]=n.coords[2]-i.coords[2],t=f.next;t!==f;t=t.next)h[0]=t.coords[0]-i.coords[0],h[1]=t.coords[1]-i.coords[1],h[2]=t.coords[2]-i.coords[2],u[0]=c[1]*h[2]-c[2]*h[1],u[1]=c[2]*h[0]-c[0]*h[2],u[2]=c[0]*h[1]-c[1]*h[0],(s=u[0]*u[0]+u[1]*u[1]+u[2]*u[2])>a&&(a=s,e[0]=u[0],e[1]=u[1],e[2]=u[2]);a<=0&&(e[0]=e[1]=e[2]=0,e[this.longAxis_(c)]=1)},e.prototype.checkOrientation_=function(){for(var e,t,n=this.mesh.fHead,i=this.mesh.vHead,r=0,s=n.next;s!==n;s=s.next)if(!((t=s.anEdge).winding<=0))do{r+=(t.Org.s-t.Dst.s)*(t.Org.t+t.Dst.t),t=t.Lnext}while(t!==s.anEdge);if(r<0){for(e=i.next;e!==i;e=e.next)e.t=-e.t;this.tUnit[0]=-this.tUnit[0],this.tUnit[1]=-this.tUnit[1],this.tUnit[2]=-this.tUnit[2]}},e.prototype.projectPolygon_=function(){var e,t,n=this.mesh.vHead,i=[0,0,0],r=!1;i[0]=this.normal[0],i[1]=this.normal[1],i[2]=this.normal[2],!i[0]&&!i[1]&&!i[2]&&(this.computeNormal_(i),r=!0),e=this.sUnit,t=this.tUnit;var s=this.longAxis_(i);e[s]=0,e[(s+1)%3]=1,e[(s+2)%3]=0,t[s]=0,t[(s+1)%3]=0,t[(s+2)%3]=i[s]>0?1:-1;for(var a=n.next;a!==n;a=a.next)a.s=this.dot_(a.coords,e),a.t=this.dot_(a.coords,t);r&&this.checkOrientation_();for(var o=!0,l=n.next;l!==n;l=l.next)o?(this.bmin[0]=this.bmax[0]=l.s,this.bmin[1]=this.bmax[1]=l.t,o=!1):(l.s<this.bmin[0]&&(this.bmin[0]=l.s),l.s>this.bmax[0]&&(this.bmax[0]=l.s),l.t<this.bmin[1]&&(this.bmin[1]=l.t),l.t>this.bmax[1]&&(this.bmax[1]=l.t))},e.prototype.addWinding_=function(e,t){e.winding+=t.winding,e.Sym.winding+=t.Sym.winding},e.prototype.tessellateMonoRegion_=function(e,t){var n,i;if((n=t.anEdge).Lnext===n||n.Lnext.Lnext===n)throw"Mono region invalid";for(;pE.vertLeq(n.Dst,n.Org);n=n.Lprev);for(;pE.vertLeq(n.Org,n.Dst);n=n.Lnext);i=n.Lprev;for(;n.Lnext!==i;)if(pE.vertLeq(n.Dst,i.Org)){for(;i.Lnext!==n&&(pE.edgeGoesLeft(i.Lnext)||pE.edgeSign(i.Org,i.Dst,i.Lnext.Dst)<=0);)i=e.connect(i.Lnext,i).Sym;i=i.Lprev}else{for(;i.Lnext!==n&&(pE.edgeGoesRight(n.Lprev)||pE.edgeSign(n.Dst,n.Org,n.Lprev.Org)>=0);)n=e.connect(n,n.Lprev).Sym;n=n.Lnext}if(i.Lnext===n)throw"Mono region invalid";for(;i.Lnext.Lnext!==n;)i=e.connect(i.Lnext,i).Sym;return!0},e.prototype.tessellateInterior_=function(e){for(var t,n=e.fHead.next;n!==e.fHead;n=t)if(t=n.next,n.inside&&!this.tessellateMonoRegion_(e,n))return!1;return!0},e.prototype.discardExterior_=function(e){for(var t,n=e.fHead.next;n!==e.fHead;n=t)t=n.next,n.inside||e.zapFace(n)},e.prototype.setWindingNumber_=function(e,t,n){for(var i,r=e.eHead.next;r!==e.eHead;r=i)i=r.next,r.Rface.inside!==r.Lface.inside?r.winding=r.Lface.inside?t:-t:n?e.delete(r):r.winding=0},e.prototype.getNeighbourFace_=function(e){return e.Rface&&e.Rface.inside?e.Rface.n:-1},e.prototype.outputPolymesh_=function(e,t,n,i){var r,s,a=0,o=0;n>3&&e.mergeConvexFaces(n);for(var l=e.vHead.next;l!==e.vHead;l=l.next)l.n=-1;for(var c=e.fHead.next;c!==e.fHead;c=c.next)if(c.n=-1,c.inside){r=c.anEdge,s=0;do{-1===(l=r.Org).n&&(l.n=o,o++),s++,r=r.Lnext}while(r!==c.anEdge);if(s>n)throw"Face vertex greater that support polygon";c.n=a,++a}this.elementCount=a,t===$_.CONNECTED_POLYGONS&&(a*=2),this.elements=[],this.elements.length=a*n,this.vertexCount=o,this.vertices=[],this.vertices.length=o*i,this.vertexIndices=[],this.vertexIndices.length=o;for(l=e.vHead.next;l!==e.vHead;l=l.next)if(-1!==l.n){var h=l.n*i;this.vertices[h+0]=l.coords[0],this.vertices[h+1]=l.coords[1],i>2&&(this.vertices[h+2]=l.coords[2]),this.vertexIndices[l.n]=l.idx}var u=0;for(c=e.fHead.next;c!==e.fHead;c=c.next)if(c.inside){r=c.anEdge,s=0;do{l=r.Org;this.elements[u++]=l.n,s++,r=r.Lnext}while(r!==c.anEdge);for(var d=s;d<n;++d)this.elements[u++]=-1;if(t===$_.CONNECTED_POLYGONS){r=c.anEdge;do{this.elements[u++]=this.getNeighbourFace_(r),r=r.Lnext}while(r!==c.anEdge);for(var p=s;p<n;++p)this.elements[u++]=-1}}},e.prototype.outputContours_=function(e,t){var n,i,r=0,s=0;this.vertexCount=0,this.elementCount=0;for(var a=e.fHead.next;a!==e.fHead;a=a.next)if(a.inside){i=n=a.anEdge;do{this.vertexCount++,n=n.Lnext}while(n!==i);this.elementCount++}this.elements=[],this.elements.length=2*this.elementCount,this.vertices=[],this.vertices.length=this.vertexCount*t,this.vertexIndices=[],this.vertexIndices.length=this.vertexCount;var o=0,l=0,c=0;r=0;for(a=e.fHead.next;a!==e.fHead;a=a.next)if(a.inside){s=0,i=n=a.anEdge;do{this.vertices[o++]=n.Org.coords[0],this.vertices[o++]=n.Org.coords[1],t>2&&(this.vertices[o++]=n.Org.coords[2]),this.vertexIndices[l++]=this.vertexIdCallback?this.vertexIdCallback(n):n.Org.idx,s++,n=n.Lnext}while(n!==i);this.elements[c++]=r,this.elements[c++]=s,r+=s}},e.prototype.addContour=function(e,t){null===this.mesh&&(this.mesh=new vE),e<2&&(e=2),e>3&&(e=3);for(var n=null,i=0;i<t.length;i+=e)null===n?(n=this.mesh.makeEdge(),this.mesh.splice(n,n.Sym)):(this.mesh.splitEdge(n),n=n.Lnext),n.Org.coords[0]=t[i+0],n.Org.coords[1]=t[i+1],n.Org.coords[2]=e>2?t[i+2]:0,n.Org.idx=this.vertexIndexCounter++,this.edgeCreateCallback&&this.edgeCreateCallback(n),n.winding=1,n.Sym.winding=-1},e.prototype.tesselate=function(e,t,n,i,r,s){if(void 0===e&&(e=J_.ODD),void 0===t&&(t=$_.POLYGONS),void 0===s&&(s=!0),this.vertices=[],this.elements=[],this.vertexIndices=[],this.vertexIndexCounter=0,r&&(this.normal[0]=r[0],this.normal[1]=r[1],this.normal[2]=r[2]),this.windingRule=e,i<2&&(i=2),i>3&&(i=3),!this.mesh)return!1;this.projectPolygon_(),EE.computeInterior(this,s);var a=this.mesh;return t===$_.BOUNDARY_CONTOURS?this.setWindingNumber_(a,1,!0):this.tessellateInterior_(a),s&&a.check(),t===$_.BOUNDARY_CONTOURS?this.outputContours_(a,i):this.outputPolymesh_(a,t,n,i),!0},e}();function CE(e){var t=e.windingRule,n=void 0===t?J_.ODD:t,i=e.elementType,r=void 0===i?$_.POLYGONS:i,s=e.polySize,a=void 0===s?3:s,o=e.vertexSize,l=void 0===o?2:o,c=e.normal,h=void 0===c?[0,0,1]:c,u=e.contours,d=void 0===u?[]:u,p=e.strict,f=void 0===p||p,m=e.debug,g=void 0!==m&&m;if(!d&&f)throw new Error("Contours can't be empty");if(d){var v=new AE;e.edgeCreateCallback&&(v.edgeCreateCallback=e.edgeCreateCallback),e.vertexIdCallback&&(v.vertexIdCallback=e.vertexIdCallback);for(var y=0;y<d.length;y++)v.addContour(l||2,d[y]);return v.tesselate(n,r,a,l,h,f),{vertices:v.vertices,vertexIndices:v.vertexIndices,vertexCount:v.vertexCount,elements:v.elements,elementCount:v.elementCount,mesh:g?v.mesh:void 0}}}J_.ODD,J_.NONZERO,J_.POSITIVE,J_.NEGATIVE,J_.ABS_GEQ_TWO,$_.POLYGONS,$_.CONNECTED_POLYGONS,$_.BOUNDARY_CONTOURS;var ME=class{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:256,t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.capacity=e,this.size=0,this.debug=t,this.debug&&console.log("allocating with cap ".concat(e));let n=e*ME.eSize;this.buffer=new ArrayBuffer(n);let i=Float32Array.BYTES_PER_ELEMENT,r=0;this.positions=new Float32Array(this.buffer,r*i,3*e),r+=3*e,this.normals=new Float32Array(this.buffer,r*i,3*e),r+=3*e,this.uvs=new Float32Array(this.buffer,r*i,2*e)}realloc(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(e<this.size)throw Error("cannot shrink buffer");if(e<=this.capacity&&!t)return;this.debug&&console.log("resizing from ".concat(this.capacity," \u2192 ").concat(e));let n=e*ME.eSize,i=new ArrayBuffer(n),r=Float32Array.BYTES_PER_ELEMENT,s=0,a=new Float32Array(i,s*r,3*e);s+=3*e;let o=new Float32Array(i,s*r,3*e);s+=3*e;let l=new Float32Array(i,s*r,2*e);t?(a.set(this.positions.subarray(0,3*this.size)),o.set(this.normals.subarray(0,3*this.size)),l.set(this.uvs.subarray(0,2*this.size))):(a.set(this.positions),o.set(this.normals),l.set(this.uvs)),this.buffer=i,this.positions=a,this.normals=o,this.uvs=l,this.capacity=e}get(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=this.size+e;if(t>this.capacity){let e=this.capacity;for(;t>e;)e*=2;this.realloc(e)}let n=this.size;return this.size=t,n}reserve(e){let t=this.size+e;t>this.capacity&&this.realloc(t)}shrink(){this.debug&&console.log("shrinking ".concat(this.capacity," \u2192 ").concat(this.size)),this.realloc(this.size,!0)}},TE=ME;TE.eSize=8*Float32Array.BYTES_PER_ELEMENT;var PE=class{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(e,t)=>e<t?-1:e>t?1:0;if(this.data=e,this.length=this.data.length,this.compare=t,this.length>0)for(let n=(this.length>>1)-1;n>=0;n--)this._down(n)}push(e){this.data.push(e),this._up(this.length++)}pop(){if(0===this.length)return;let e=this.data[0],t=this.data.pop();return--this.length>0&&(this.data[0]=t,this._down(0)),e}peek(){return this.data[0]}_up(e){let{data:t,compare:n}=this,i=t[e];for(;e>0;){let r=e-1>>1,s=t[r];if(n(i,s)>=0)break;t[e]=s,e=r}t[e]=i}_down(e){let{data:t,compare:n}=this,i=this.length>>1,r=t[e];for(;e<i;){let i=1+(e<<1),s=i+1;if(s<this.length&&n(t[s],t[i])<0&&(i=s),n(t[i],r)>=0)break;t[e]=t[i],e=i}t[e]=r}};function DE(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r=1/0,s=1/0,a=-1/0,o=-1/0;for(let[y,b]of e[0])y<r&&(r=y),b<s&&(s=b),y>a&&(a=y),b>o&&(o=b);let l=a-r,c=o-s,h=Math.max(n,Math.min(l,c));if(h===n){let e=[r,s];return e.distance=0,e.distance}let u=new PE([],((e,t)=>t.max-e.max)),d=function(e){let t=0,n=0,i=0,r=e[0];for(let a=0,o=r.length,l=o-1;a<o;l=a++){let e=r[a],s=r[l],o=e[0]*s[1]-s[0]*e[1];n+=(e[0]+s[0])*o,i+=(e[1]+s[1])*o,t+=3*o}let s=new OE(n/t,i/t,0,e);return 0===t||s.d<0?new OE(r[0][0],r[0][1],0,e):s}(e),p=new OE(r+l/2,s+c/2,0,e);p.d>d.d&&(d=p);let f=2;function m(r,s,a){let o=new OE(r,s,a,e);if(f++,o.max>d.d+n&&u.push(o),o.d>d.d&&(d=o,i&&console.log("found best ".concat(Math.round(1e4*o.d)/1e4," after ").concat(f," probes")),d.d>t))return t}let g=h/2;for(let y=r;y<a;y+=h)for(let e=s;e<o;e+=h)m(y+g,e+g,g);for(;u.length;){let{max:e,x:t,y:i,h:r}=u.pop();if(e-d.d<=n)break;g=r/2,m(t-g,i-g,g),m(t+g,i-g,g),m(t-g,i+g,g),m(t+g,i+g,g)}i&&console.log("num probes: ".concat(f,"\nbest distance: ").concat(d.d));let v=[d.x,d.y];return v.distance=d.d,v.distance}function OE(e,t,n,i){this.x=e,this.y=t,this.h=n,this.d=function(e,t,n){let i=!1,r=1/0;for(let s of n)for(let n=0,a=s.length,o=a-1;n<a;o=n++){let a=s[n],l=s[o];a[1]>t!=l[1]>t&&e<(l[0]-a[0])*(t-a[1])/(l[1]-a[1])+a[0]&&(i=!i),r=Math.min(r,IE(e,t,a,l))}return 0===r?0:(i?1:-1)*Math.sqrt(r)}(e,t,i),this.max=this.d+this.h*Math.SQRT2}function IE(e,t,n,i){let r=n[0],s=n[1],a=i[0]-r,o=i[1]-s;if(0!==a||0!==o){let n=((e-r)*a+(t-s)*o)/(a*a+o*o);n>1?(r=i[0],s=i[1]):n>0&&(r+=a*n,s+=o*n)}return a=e-r,o=t-s,a*a+o*o}var RE={vertices:[160,160,-160,160,-160,-160,160,-160],vertexIndices:[1,0,3,2],vertexCount:4,elements:[0,4],elementCount:1,mesh:void 0},kE={vertices:[],vertexIndices:[],vertexCount:0,elements:[],elementCount:0,mesh:void 0},LE={vertices:[-160,160,160,-160,160,160,-160,-160],vertexIndices:[1,3,0,2],vertexCount:4,elements:[0,1,2,1,0,3],elementCount:2,mesh:void 0},BE=(e,t)=>n=>{let[i,r]=n;return r<i&&(r+=t),(e>=i?e:e+t)<=r},zE=class extends di{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:12,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:J_.ODD,a=arguments.length>6&&void 0!==arguments[6]&&arguments[6];super(),this.forPathBevel=a,this.type="ShapeGeometry",this.vertexCache={},this._shape=e,this._depth=t,this._curveSegments=i,this._bevelSegmentsInput=r;let o,l,c,h=this._shape.extractShapePointsToFlatArray([],i),u=this._shape.shapeHoles.map((e=>{let t=e.extractShapePointsToFlatArray([],i),n=[];for(let i=t.length-1;i>=1;i-=2){let e=t[i-1],r=t[i-0];n.push(e,r)}return n})),d=[],p=[];for(let T=0;T<h.length;T+=2)p.push([h[T],h[T+1]]);d.push(p);for(let T=0;T<u.length;T++){let e=u[T],t=[];for(let n=0;n<e.length;n+=2)t.push([e[n],e[n+1]]);d.push(t)}o=e.isText?.1*(new xc).setFromPoints(e.points.map((e=>e.position))).getSize(new ot).length():0===d[0].length?n:n>0?DE(d,n):1e-5,n<=0?(this._bevel=0,this._bevelSegments=0):(this._bevel=Math.min(n,o,t/2),this._bevelSegments=Math.floor(r));try{l=CE({windingRule:s,elementType:$_.BOUNDARY_CONTOURS,vertexSize:2,strict:!0,contours:[h]})}catch(A){l=RE}try{c=CE({windingRule:J_.ODD,elementType:$_.BOUNDARY_CONTOURS,vertexSize:2,strict:!0,contours:[...u]})}catch(C){c=kE}if(!l)throw new Error("error generating geometry");let f=l.elementCount;if(c){l.elementCount+=c.elementCount;for(let e=0;e<c.elements.length;e++){let t=c.elements[e],n=e%2===0?l.vertexCount:0;l.elements.push(t+n)}for(let e=0;e<c.vertexIndices.length;e++){let t=c.vertexIndices[e],n=l.vertexCount;l.vertexIndices.push(t+n)}for(let e=0;e<c.vertices.length;e++){let t=c.vertices[e];l.vertices.push(t)}}let m=1/0,g=-1/0,v=1/0,y=-1/0;for(let T=0,P=l.vertexCount;T<P;T++){let e=2*T,t=l.vertices[e+0],n=l.vertices[e+1];t<m&&(m=t),t>g&&(g=t),n<v&&(v=n),n>y&&(y=n)}this._minX=m,this._minY=v,this._width=g-m,this._height=y-v,this._buffer=new TE(this._computeBufferEstimatedSize(l));let b=[],x=[];for(let T=l.elementCount-1;T>=0;T--){let e=T>=f,t=2*T,n=l.elements[t+0],r=l.elements[t+1],s=n+r,c={start:n,count:r,normals:[],continuous:[],concave:[]},h=n,d=s-1,p=n+1,m=this._shape.roundedCurves.length;do{let t=h-n,i=l.vertices[2*d+0],a=l.vertices[2*d+1],o=l.vertices[2*h+0],u=l.vertices[2*h+1],f=l.vertices[2*p+0],g=l.vertices[2*p+1],v=o-i,y=u-a,b=Math.sqrt(v*v+y*y);v/=b,y/=b;let x=o-f,w=u-g,S=Math.sqrt(x*x+w*w);x/=S,w/=S,c.normals[2*t+0]=-w,c.normals[2*t+1]=x,c.concave[t]=v*w-y*x>0;let _=l.vertexIndices[h];if(Array.isArray(_))c.continuous[t]=!1;else{let[e,n]=this._shape.getCurveIndexFromVertexId(_-1,!0);if(n>0&&n<1)c.continuous[t]=!0;else{let i=1===n?e+1:e-1;i=(i+m)%m;let r=1===n?0:1,s=this._shape.roundedCurves[e].getTangent(n),a=this._shape.roundedCurves[i].getTangent(r);c.continuous[t]=s.dot(a)>.95}}e&&(c.normals[2*t+0]*=-1,c.normals[2*t+1]*=-1),[d,h,p]=[h,p,p+1],p>=s&&(p-=r)}while(p!==n+1);let g=[];g.push({bevelI:0,angle:0,size:0,boundary:{vertices:l.vertices.slice(2*n,2*s),vertexCount:r,vertexIndices:new Array(r).fill(!0).map(((e,t)=>[t,t])),elements:[0,r],elementCount:1,mesh:null},reverseMap:[],insetPoints:l.vertices.slice(2*n,2*s)});let v=0;for(let a=1;a<=this._bevelSegments;a++){let t=a/this._bevelSegments*Math.PI/2,n=(1-Math.cos(t))*this._bevel,s=[],o=[],h=[],u=[],d=0;for(let a=0;a<r;a++){let t=2*a,p=(a-1+r)%r*2,f=l.vertices[2*c.start+t+0],m=l.vertices[2*c.start+t+1],g=-c.normals[p+0]*n,v=-c.normals[p+1]*n,y=-c.normals[t+0]*n,b=-c.normals[t+1]*n;if(c.concave[a]||!c.concave[a]&&e){let t=Math.atan2(v,g),r=Math.atan2(b,y);r>t&&(r-=2*Math.PI);let o=r-t;if(c.continuous[a]||e){let i=t+o/2,r=Math.cos(i)*n,l=Math.sin(i)*n;s[2*d+0]=f+r*(e?-1:1),s[2*d+1]=m+l*(e?-1:1),u[d]=a,d++}else{let e=Math.max(1,Math.floor(i/4*Math.abs(o)/Math.PI));for(let i=0;i<=e;i++){let r=t+o*(i/e),l=Math.cos(r)*n,c=Math.sin(r)*n;s[2*d+0]=f+l,s[2*d+1]=m+c,u[d]=a,d++}}}else s[2*d+0]=f+g,s[2*d+1]=m+v,u[d]=a,o[a]=d,d++,s[2*d+0]=f,s[2*d+1]=m,u[d]=a,d++,s[2*d+0]=f+y,s[2*d+1]=m+b,u[d]=a,h[a]=d,d++}let p=CE({windingRule:J_.POSITIVE,elementType:$_.BOUNDARY_CONTOURS,vertexSize:2,strict:!0,contours:[s],edgeCreateCallback:e=>{let t=e.Org.idx,n=u[t],i=u[(t+1)%u.length];e.idx=[n,i],e.Sym.idx=[i,n]},vertexIdCallback:e=>{let t=e.Lprev.idx;return[t?t[1]:0,e.idx?e.idx[0]:0]}});if(!p)throw console.log("Error"),new Error("error generating bevel geometry for ".concat(a,"'th loop"));if(!p.vertexCount){let e=(a-1)/this._bevelSegments*Math.PI/2;v=(1-Math.sin(e))*this._bevel;break}for(let e=0;e<p.vertexIndices.length;e++){let[t,n]=p.vertexIndices[e];if(t===n)continue;let i=n;n<t&&(i+=r);for(let s=t;s<i;s++){let i=s%r,a=(s+1)%r;if(!c.continuous[i]||!c.continuous[a]){p.vertexIndices[e]=[t,i],p.vertexIndices.splice(e+1,0,[a,n]),p.vertices.splice(2*(e+1),0,p.vertices[2*e],p.vertices[2*e+1]);break}}}g.push({bevelI:a,angle:t,size:n,boundary:p,reverseMap:u,insetPoints:s})}let y=(e,t,n)=>{let i=0,r=e.boundary.vertexIndices.length;for(;i<r&&n(e.boundary.vertexIndices[t]);)t=(t+1)%r,i++;return i},w=b.length;for(let i=1;i<g.length;i++){let e=g[i-1],t=g[i],n=e.boundary.vertexIndices.length,s=t.boundary.vertexIndices.length;if(!n||!s)break;let o=c.concave.length,l=0,h=BE(l,r);for(;!e.boundary.vertexIndices.filter(h).length||!t.boundary.vertexIndices.filter(h).length;)l++,h=BE(l,r);let u=e.boundary.vertexIndices.findIndex(h),d=t.boundary.vertexIndices.findIndex(h);do{u=(u+1)%n}while(h(e.boundary.vertexIndices[u]));do{d=(d+1)%s}while(h(t.boundary.vertexIndices[d]));l=(l+1)%r;let p,f,m=l,v=0,x=this._buildBevelVert(c,e,(u-1+n)%n,void 0,v),w=this._buildBevelVert(c,t,(d-1+s)%s,void 0,v),S=!1;do{v=(l||o)/o,h=BE(l,r);let i=y(e,u,h),m=y(t,d,h),g=S;if(S=!1,i&&!m){for(let t=0;t<i;t++)p=this._buildBevelVert(c,e,(u+t)%n,t/(i-1),v),b.push(x.topN,p.topP,w.topN),!1===a&&b.push(p.bottomP,x.bottomN,w.bottomN),x=p;S=!0}else if(!i&&m)for(let e=0;e<m;e++)f=this._buildBevelVert(c,t,(d+e)%s,e/(m-1),v),b.push(w.topN,x.topP,f.topP),!1===a&&b.push(x.bottomP,w.bottomN,f.bottomP),w=f;else if(i&&m)if(p=this._buildBevelVert(c,e,u,0,v),f=this._buildBevelVert(c,t,d,0,v),g?(b.push(x.topN,f.topP,w.topN),b.push(x.topN,p.topP,f.topP),!1===a&&(b.push(f.bottomP,x.bottomN,w.bottomN),b.push(f.bottomP,p.bottomP,x.bottomN))):(b.push(w.topN,x.topN,p.topP),b.push(w.topN,p.topP,f.topP),!1===a&&(b.push(p.bottomP,x.bottomN,w.bottomN),b.push(p.bottomP,w.bottomN,f.bottomP))),x=p,w=f,i===m)for(let r=1;r<i;r++)p=this._buildBevelVert(c,e,(u+r)%n,r/(i-1),v),f=this._buildBevelVert(c,t,(d+r)%s,r/(m-1),v),b.push(x.topN,p.topP,w.topN),b.push(w.topN,p.topP,f.topP),!1===a&&(b.push(p.bottomP,x.bottomN,w.bottomN),b.push(p.bottomP,w.bottomN,f.bottomP)),x=p,w=f;else if(i>m){let r=i/m,o=0;for(let l=1;l<i;l++)p=this._buildBevelVert(c,e,(u+l)%n,l/(i-1),v),b.push(x.topN,p.topP,w.topN),!1===a&&b.push(p.bottomP,x.bottomN,w.bottomN),x=p,l>(o+1)*r&&(o++,f=this._buildBevelVert(c,t,(d+o)%s,o/(m-1),v),b.push(w.topN,p.topP,f.topP),!1===a&&b.push(p.bottomP,w.bottomN,f.bottomP),w=f)}else{let r=m/i,o=0;for(let l=1;l<m;l++)f=this._buildBevelVert(c,t,(d+l)%s,l/(m-1),v),b.push(w.topN,p.topP,f.topP),!1===a&&b.push(p.bottomP,w.bottomN,f.bottomP),w=f,l>(o+1)*r&&(o++,p=this._buildBevelVert(c,e,(u+o)%n,o/(i-1),v),b.push(x.topN,p.topP,w.topN),!1===a&&b.push(p.bottomP,x.bottomN,w.bottomN),x=p)}u=(u+i)%n,d=(d+m)%s,l=(l+1)%o}while(l!==m)}if(!1===a&&this._depth>2*this._bevel&&this._buildWall(g,c,b),e){let e=[];for(let t=b.length-1;t>=w+2;t-=3){let n=b[t-2],i=b[t-1],r=b[t-0];e.push(r,i,n)}b.splice(w,b.length-w,...e)}if(e){let e=[];for(let t=g[g.length-1].boundary.vertices.length-1;t>=1;t-=2){let n=g[g.length-1].boundary.vertices[t-1],i=g[g.length-1].boundary.vertices[t-0];e.push(n,i)}x.push(e)}if(!e){let e,t=g[g.length-1];try{e=CE({windingRule:g.length>1?J_.POSITIVE:J_.ODD,elementType:$_.POLYGONS,vertexSize:2,strict:!0,contours:[t.insetPoints,...x]})}catch(M){e=LE}if(!e)throw new Error("Error generating geometry for surface");0===u.length&&this._bevel<o&&Object.assign(this,{useNgonForTopBottomFaceDuringBake:!0});for(let n=0;n<3*e.elementCount;n+=3){let t=this._buildSurfaceVert(e,e.elements[n+0],v),i=this._buildSurfaceVert(e,e.elements[n+1],v),r=this._buildSurfaceVert(e,e.elements[n+2],v);b.push(t.top,i.top,r.top),!1===a&&b.push(r.bottom,i.bottom,t.bottom)}}this.vertexCache={}}this._buffer.shrink();let w=new ti(Uint32Array.from(b),1),S=new ti(this._buffer.positions,3),_=new ti(this._buffer.normals,3),E=new ti(this._buffer.uvs,2);S.needsUpdate=!0,_.needsUpdate=!0,E.needsUpdate=!0,w.needsUpdate=!0,this.setAttribute("position",S),this.setAttribute("normal",_),this.setAttribute("uv",E),this.setIndex(w)}_computeBufferEstimatedSize(e){return 2*e.vertexCount*(2+this._bevelSegments)}_buildWall(e,t,n){let i=e[0];for(let r=0,s=i.boundary.vertexCount;r<s;r++){let e=this._buildBevelVert(t,i,r),a=this._buildBevelVert(t,i,(r+1)%s);n.push(a.topP,e.topN,e.bottomN),n.push(a.topP,e.bottomN,a.bottomP)}}_buildSurfaceVert(e,t,n){let i=t.toString();if(i in this.vertexCache)return this.vertexCache[i];let r=e.vertices[2*t+0],s=e.vertices[2*t+1],a=(r-this._minX)/this._width,o=(s-this._minY)/this._height;this.forPathBevel&&(o=1);let l=this._buffer.get(this.forPathBevel?1:2),c=3*l,h=2*l,u={top:l+0,bottom:l+1};return this._buffer.positions[c+0]=r,this._buffer.positions[c+1]=s,this._buffer.positions[c+2]=this.forPathBevel?this._bevel:this._depth-n,this._buffer.normals[c+0]=0,this._buffer.normals[c+1]=0,this._buffer.normals[c+2]=1,this._buffer.uvs[h+0]=a,this._buffer.uvs[h+1]=o,!1===this.forPathBevel&&(this._buffer.positions[c+3]=r,this._buffer.positions[c+4]=s,this._buffer.positions[c+5]=n,this._buffer.normals[c+3]=0,this._buffer.normals[c+4]=0,this._buffer.normals[c+5]=-1,this._buffer.uvs[h+2]=a,this._buffer.uvs[h+3]=o),this.vertexCache[i]=u,u}_buildBevelVert(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,r=arguments.length>4?arguments[4]:void 0,s="".concat(t.bevelI,":").concat(n);if(s in this.vertexCache&&0!==r&&1!==r&&(!r||r===this.vertexCache[s].pathBevelUCoord))return this.vertexCache[s];let a,o,l,c,[h,u]=t.boundary.vertexIndices[n];h!==u?(o=h,a=u,c=!1,l=e.continuous[o]&&e.continuous[a]):(a=h,o=(a-1+e.count)%e.count,c=e.concave[a]&&t.bevelI>0,l=e.continuous[a]||c);let d=Math.cos(t.angle),p=Math.sin(t.angle),f=2*n,m=2*a,g=2*o,v=t.boundary.vertices[f+0],y=t.boundary.vertices[f+1],b=(1-p)*this._bevel,x=(v-this._minX)/this._width,w=(y-this._minY)/this._height;this.forPathBevel&&(void 0!==r&&(x=r),w=1);let S=e.normals[m+0],_=e.normals[m+1],E=e.normals[g+0],A=e.normals[g+1];if(c){S+=(E-S)*(1-i),_+=(A-_)*(1-i);let e=Math.sqrt(S*S+_*_);S/=e,_/=e}let C=this.forPathBevel?this._buffer.get(l?1:2):this._buffer.get(l?2:4),M=3*C,T=2*C,P={i:n,fi:a,topP:C+0,topN:C+0,bottomP:C+1,bottomN:C+1,pathBevelUCoord:r};return this._buffer.positions[M+0]=v,this._buffer.positions[M+1]=y,this._buffer.positions[M+2]=(this.forPathBevel?this._bevel:this._depth)-b,this._buffer.normals[M+0]=S*d,this._buffer.normals[M+1]=_*d,this._buffer.normals[M+2]=p,this._buffer.uvs[T+0]=x,this._buffer.uvs[T+1]=w,!1===this.forPathBevel&&(this._buffer.positions[M+3]=v,this._buffer.positions[M+4]=y,this._buffer.positions[M+5]=b,this._buffer.normals[M+3]=S*d,this._buffer.normals[M+4]=_*d,this._buffer.normals[M+5]=-p,this._buffer.uvs[T+2]=w,this._buffer.uvs[T+3]=x),l||(this.forPathBevel?(C+=1,M+=3,T+=2):(C+=2,M+=6,T+=4),P.topP=C+0,P.bottomP=C+1,this._buffer.positions[M+0]=v,this._buffer.positions[M+1]=y,this._buffer.positions[M+2]=(this.forPathBevel?this._bevel:this._depth)-b,this._buffer.normals[M+0]=E*d,this._buffer.normals[M+1]=A*d,this._buffer.normals[M+2]=p,this._buffer.uvs[T+0]=x,this._buffer.uvs[T+1]=w,!1===this.forPathBevel&&(this._buffer.positions[M+3]=v,this._buffer.positions[M+4]=y,this._buffer.positions[M+5]=b,this._buffer.normals[M+3]=E*d,this._buffer.normals[M+4]=A*d,this._buffer.normals[M+5]=-p,this._buffer.uvs[T+2]=w,this._buffer.uvs[T+3]=x)),this.vertexCache[s]=P,P}clone(){let e=new zE(this._shape,this._depth,this._bevel,this._curveSegments,this._bevelSegmentsInput);return e.userData=zf(this.userData),e}},NE=class extends di{constructor(e){var t,n,i,r,s,a;let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:12,l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};super(),this.type="ShapeGeometry",this.windingRule=J_.ODD,this.elementType=$_.POLYGONS,this.polySize=3,this.vertexSize=2,this.strict=!0,this._shape=e,this._curveSegments=o,this._triangulationOptions=Object.assign({windingRule:J_.ODD,elementType:$_.POLYGONS,polySize:3,vertexSize:2,strict:!0},l);let c,h,u,d=this._shape.extractShapePointsToFlatArray([],this._curveSegments),p=this._shape.shapeHoles.map((e=>e.extractShapePointsToFlatArray([],this._curveSegments))),f=!0,m=!0;for(let b=0,x=d.length/2;b<x;b++){let e=2*b,t=d[e+0],n=d[e+1];if(void 0!==h&&t!==h&&(f=!1),void 0!==u&&n!==u&&(m=!1),h=t,u=n,!f&&!m)break}if(!f&&!m)try{c=CE({contours:[d,...p],windingRule:this._triangulationOptions.windingRule,elementType:this._triangulationOptions.elementType,polySize:this._triangulationOptions.polySize,vertexSize:this._triangulationOptions.vertexSize,strict:this._triangulationOptions.strict})}catch(y){c=RE}let g=null!==(t=null===(n=c)||void 0===n?void 0:n.vertexCount)&&void 0!==t?t:1,v=null!==(i=null===(r=c)||void 0===r?void 0:r.elementCount)&&void 0!==i?i:1;if(this._positionAttribute=new ti(new Float32Array(3*g),3),this._normalAttribute=new ti(new Float32Array(3*g),3),this._uvAttribute=new ti(new Float32Array(2*g),2),this._indexAttribute=new ti(new Uint32Array(3*v),1),c){let e=1/0,t=-1/0,n=1/0,i=-1/0;for(let a=0,o=g;a<o;a++){let r=2*a,s=c.vertices[r+0],o=c.vertices[r+1];s<e&&(e=s),s>t&&(t=s),o<n&&(n=o),o>i&&(i=o)}let r=t-e,s=i-n;for(let a=0,o=g;a<o;a++){let t=2*a,i=c.vertices[t+0],o=c.vertices[t+1],l=(i-e)/r,h=(o-n)/s;this._positionAttribute.setXYZ(a,i,o,0),this._normalAttribute.setXYZ(a,0,0,1),this._uvAttribute.setXY(a,l,h)}for(let a=0,o=v;a<o;a++){let e=3*a,t=c.elements[e+0],n=c.elements[e+1],i=c.elements[e+2];this._indexAttribute.setX(e+0,t),this._indexAttribute.setX(e+1,n),this._indexAttribute.setX(e+2,i)}}this.setAttribute("position",this._positionAttribute),this.setAttribute("normal",this._normalAttribute),this.setAttribute("uv",this._uvAttribute),this.setIndex(this._indexAttribute),this.setDrawRange(0,3*(null!==(s=null===(a=c)||void 0===a?void 0:a.elementCount)&&void 0!==s?s:1))}clone(){let e=new NE(this._shape,this._curveSegments);return e.userData=zf(this.userData),e}},FE=class extends zE{constructor(e,t){super(e,t,arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,arguments.length>3&&void 0!==arguments[3]?arguments[3]:12,arguments.length>4&&void 0!==arguments[4]?arguments[4]:3,arguments.length>5&&void 0!==arguments[5]?arguments[5]:J_.ODD),this.type="ShapeGeometry"}_computeBufferEstimatedSize(e){return 2*e.vertexCount*(2+this._bevelSegments)}_buildWall(e,t,n){let i=e[0];for(let r=0,s=i.boundary.vertexCount;r<s;r++){let e=this._buildBevelVert(t,i,r),a=this._buildBevelVert(t,i,(r+1)%s);n.push(a.topP,e.topN,e.bottomN),n.push(a.topP,e.bottomN,a.bottomP)}}clone(){let e=new FE(this._shape,this._depth,this._bevel,this._curveSegments,this._bevelSegmentsInput);return e.userData=zf(this.userData),e}},UE=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){var n,i,r,s,a,o,l,c;let h=Object.assign({},null!==(n=null===t||void 0===t?void 0:t.parameters)&&void 0!==n?n:{width:100,subdivisions:40,roundness:0,extrudeBevelSize:0,extrudeBevelSegments:3,windingRule:J_.ODD},e.parameters),u=Math.abs(h.width),d=Math.abs(null!==(i=h.height)&&void 0!==i?i:h.width),p=Math.abs(null!==(r=h.depth)&&void 0!==r?r:0),f=null!==(s=e.shape)&&void 0!==s?s:null===t||void 0===t?void 0:t.shape,m=null!==(a=null===(o=f)||void 0===o?void 0:o.roundness)&&void 0!==a?a:h.roundness;void 0!==f&&(f instanceof aE?(f.width!==u||f.height!==d)&&f.applySize(u,d):f=new aE(u,d).fromJSON(f),void 0!==(null===(l=e.parameters)||void 0===l?void 0:l.roundness)&&(null===(c=e.parameters)||void 0===c?void 0:c.roundness)>0&&f.update());let g=null!==f&&void 0!==f?f:new aE(u,d);return{parameters:Object.assign(h,{width:u,height:d,depth:p,roundness:m}),shape:g}}static build(e){let t,{depth:n,extrudeBevelSize:i,extrudeBevelSegments:r,subdivisions:s,roundness:a,windingRule:l}=e.parameters;return e.shape.roundness=a,t=n<=0?new NE(e.shape,s,{windingRule:l}):new FE(e.shape,n,i,s,r,l),Object.assign(t,{userData:o(o({},e),{},{type:"VectorGeometry"})})}},jE=2*Math.PI,VE=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){var n,i,r;let s=Object.assign({},null!==(n=null===t||void 0===t?void 0:t.parameters)&&void 0!==n?n:{width:100,depth:0,spikes:64,angle:360,innerRadius:0,extrudeBevelSize:0,extrudeBevelSegments:1},e.parameters);return s.angle=at.clamp(s.angle,0,360),{shape:e.shape&&e.shape instanceof aE?e.shape:new aE,parameters:Object.assign(s,{width:Math.abs(s.width),height:Math.abs(null!==(i=s.height)&&void 0!==i?i:s.width),depth:Math.abs(null!==(r=s.depth)&&void 0!==r?r:0)})}}static build(e){let t,{width:n,height:i,spikes:r,angle:s,innerRadius:a,depth:l,extrudeBevelSize:c,extrudeBevelSegments:h}=e.parameters,u=e.shape,d=function(e,t,n,i,r,s){if(i>=jE)return r>30||r%4===0?(function(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,a=.5522847498,o=t*a,l=n*a;e.addPoint(WE(r-t,s,r-t,s-l,r-t,s+l)),e.addPoint(WE(r,s+n,r-o,s+n,r+o,s+n)),e.addPoint(WE(r+t,s,r+t,s+l,r+t,s-l)),e.addPoint(WE(r,s-n,r+o,s-n,r-o,s-n)),i>0&&XE(e,t,n,i)}(e,t,n,s),Math.round(r/4)):GE(e,i,r,t,n,s);i=Math.max(i,.001);let a={x:0,y:n},o=i+.5*Math.PI,l={x:Math.cos(o)*t,y:Math.sin(o)*n},c=uE({px:a.x,py:a.y,cx:l.x,cy:l.y,rx:t,ry:n,largeArcFlag:i>Math.PI,sweepFlag:!0});return r>30||r%c.length===0?function(e,t,n,i,r,s,a,o){let l=Math.round(r/i.length);e.addPoint(HE(t,n));for(let c=0,h=i.length;c<h;c++){let t=i[c],n=e.points[c],r=HE(t.x,t.y);n.controls[1].position.set(t.x1,t.y1),r.controls[0].position.set(t.x2,t.y2),e.addPoint(r)}return o>0?qE(e,s,a,o):e.addPoint(HE(0,0)),l}(e,a.x,a.y,c,r,t,n,s):GE(e,i,r,t,n,s)}(u,.5*n,.5*i,s*Math.PI/180,r,a);return u.isClosed=!0,u.update(),0===s?(t=new di,t.setAttribute("position",new ri([],3))):t=UE.create({shape:u,parameters:{subdivisions:d,depth:l,extrudeBevelSize:c,extrudeBevelSegments:h}}),Object.assign(t,{userData:o(o({},e),{},{type:"EllipseGeometry"})})}};function GE(e,t,n,i,r,s){let a=-t/n;for(let o=0;o<=n;o++){let t=a*o,n=Math.sin(t)*i,s=Math.cos(t)*r;e.addPoint(HE(n,s))}return t<jE?s>0?qE(e,i,r,s):e.addPoint(HE(0,0)):(e.removePoint(e.points[e.points.length-1]),s>0&&XE(e,i,r,s)),1}function HE(e,t){return new T_(at.generateUUID(),new ot(e,t))}function WE(e,t,n,i,r,s){let a=HE(e,t);return a.controls[0].position.set(n,i),a.controls[1].position.set(r,s),a}function qE(e,t,n,i){YE(e,t,n,i).forEach((t=>e.addPoint(t)))}function XE(e,t,n,i){let r=YE(e,t,n,i),s=new aE;r.forEach((e=>s.addPoint(e))),s.isClosed=!0,e.shapeHoles.push(s)}function YE(e,t,n,i){let r=i*t/100,s=r*(Math.abs(n)/Math.abs(t)),a=new ot(r/t,s/n),o=e.points.map((e=>{let t=e.clone();return t.uuid=at.generateUUID(),t})).reverse();return o.forEach((e=>{e.position.multiply(a);let t=e.controls[0].position.clone().multiply(a),n=e.controls[1].position.clone().multiply(a);e.controls[0].position.copy(n),e.controls[1].position.copy(t)})),o}var QE=new ii([0,0,0],1),KE=class extends di{constructor(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,r=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1,s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:1,a=arguments.length>9&&void 0!==arguments[9]?arguments[9]:1,o=arguments.length>10&&void 0!==arguments[10]?arguments[10]:1,l=arguments.length>11&&void 0!==arguments[11]?arguments[11]:1;if(super(),0===i)return;let c=e&&1===i;c&&(l=0),o>100&&(o=100),0===o&&(l=0);let h,u,d,p,f,m,g,v,y=()=>new Bt,b=new Bt,x=y(),w=y(),S=y(),_=y(),E=y(),A=y(),C=y(),M=y(),T=y(),P=y(),D=y(),O=t-2*s+.001,I=O/i,R=Math.ceil(r*i),k=R+1,L=O/R,B=-O/2,z=a+1,N=2*Math.PI/a,F=Math.PI/2/l,U=Math.min((1-o/100)*s,s-.01),j=s-U,V=0,G=2*l+2,H=z*G/2,W=H+z*k,q=Math.max(0,z*(k+G)),[X,Y,Q]=[3,3,2].map((e=>Array(q*e).fill(0))),K=[],Z=n-s;function J(t,n){let i=Math.PI/2;m=n*L,v=2*Math.PI*(m%I)/I+i,m+=B,g=Math.sin(v)*Z,f=Math.cos(v)*Z,e?t.set(f,g,m):t.set(f,m,g)}J(b,-1e-10),J(x,0),_.copy(b),J(b,1);let $=b.distanceTo(x),ee=c?0:j+U,te=$*R+2*ee,ne=U,ie=te-ee;for(let oe=0;oe<=R;oe++){J(w,oe),D.subVectors(w,_).normalize(),_.copy(w),T.copy(w).setComponent(+e+1,0).normalize(),P.crossVectors(D,T).normalize();let t=0===oe,n=oe===R,i=t?3*Math.PI/2:F,r=t?ne:ie,o=t?z:W,h=t?0:q-z,u=D.clone().multiplyScalar(t?-j:j).add(w),d=D.clone().multiplyScalar(t?-1:1).normalize();for(let e=0;e<z;e++){let p=e*N;if(E.addVectors(b.copy(T).multiplyScalar(s*Math.cos(p)),x.copy(P).multiplyScalar(s*Math.sin(p))),A.copy(E).normalize(),t||n){c||(V=h+e,[0,1,2].forEach((e=>{X[3*V+e]=u.getComponent(e),Y[3*V+e]=d.getComponent(e)})),Q[2*V]=+n,Q[2*V+1]=e/a),x.copy(A).multiplyScalar(U),S.addVectors(w,x);for(let n=0;n<l;n++){let s=n*F+i;C.addVectors(b.copy(D).multiplyScalar(j*Math.sin(s)),x.copy(A).multiplyScalar(j*Math.cos(s))),M.copy(C).normalize(),x.addVectors(S,C),C.normalize(),V=o+n*z+e,[0,1,2].forEach((e=>{X[3*V+e]=x.getComponent(e),Y[3*V+e]=M.getComponent(e)}));let l=+t+Math.sin(s);Q[2*V]=(r+j*l)/te,Q[2*V+1]=e/a}}x.addVectors(w,E),V=H+oe*z+e,[0,1,2].forEach((e=>{X[3*V+e]=x.getComponent(e),Y[3*V+e]=A.getComponent(e)})),Q[2*V]=(ee+oe*$)/te,Q[2*V+1]=e/a}}let re=k+2*l+2,[se,ae]=[+c,re-1];for(let oe=se;oe<=ae-1;oe++){let e=c&&oe===ae-1;for(let t=0;t<z-1;t++)h=oe*z+t,u=h+1,d=(e?t:h)+z,p=(e?t+1:u)+z,0===oe?K.push(u,p,d):oe===re-2?K.push(h,u,d):K.push(h,u,d,u,p,d)}this.setIndex(K),this.setAttribute("position",new ri(X,3)),this.setAttribute("normal",new ri(Y,3)),this.setAttribute("uv",new ri(Q,2))}getClosedTorusIndicesForBooleanOrSubdiv(){let e,t,n,i,r=this.userData.parameters,s=Math.ceil(r.tubularSegments),a=r.radialSegments+1,o=Array.from(this.getIndex().array),l=6*(s-1)*r.radialSegments,c=s,h=c===s;for(let u=0;u<r.radialSegments;u++)e=c*a+u,t=e+1,n=(h?u:e)+a,i=(h?u+1:t)+a,o[l++]=e,o[l++]=t,o[l++]=n,o[l++]=t,o[l++]=i,o[l++]=n;return o.length=l,QE.array=o,QE.count=o.length,QE}},ZE=class extends __{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.2,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4,i=(1+Math.sqrt(5))/2,r="IcosahedronGeometry";super([-1,i,0,1,i,0,-1,-i,0,1,-i,0,0,-1,i,0,1,i,0,-1,-i,0,1,-i,i,0,-1,i,0,1,-i,0,-1,-i,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],r,e,t,n),this.type=r}static fromJSON(e){return new ZE(e.radius,e.corner,e.cornerSides)}},JE=new pn,$E=new Nn,eA=new Bt,tA=class extends qe{constructor(){super(),this.uuid=at.generateUUID(),this.name="",this.type="Geometry",this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.elementsNeedUpdate=!1,this.verticesNeedUpdate=!1,this.uvsNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.lineDistancesNeedUpdate=!1,this.groupsNeedUpdate=!1}applyMatrix4(e){let t=(new lt).getNormalMatrix(e);for(let n=0,i=this.vertices.length;n<i;n++)this.vertices[n].applyMatrix4(e);for(let n=0,i=this.faces.length;n<i;n++){let e=this.faces[n];e.normal.applyMatrix3(t).normalize();for(let n=0,i=e.vertexNormals.length;n<i;n++)e.vertexNormals[n].applyMatrix3(t).normalize()}return null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this.verticesNeedUpdate=!0,this.normalsNeedUpdate=!0,this}rotateX(e){return JE.makeRotationX(e),this.applyMatrix4(JE),this}rotateY(e){return JE.makeRotationY(e),this.applyMatrix4(JE),this}rotateZ(e){return JE.makeRotationZ(e),this.applyMatrix4(JE),this}translate(e,t,n){return JE.makeTranslation(e,t,n),this.applyMatrix4(JE),this}scale(e,t,n){return JE.makeScale(e,t,n),this.applyMatrix4(JE),this}lookAt(e){return $E.lookAt(e),$E.updateMatrix(),this.applyMatrix4($E.matrix),this}fromBufferGeometry(e){let t=this,n=null!==e.index?e.index:void 0,i=e.attributes;if(void 0===i.position)return console.error("THREE.Geometry.fromBufferGeometry(): Position attribute required for conversion."),this;let r=i.position,s=i.normal,a=i.color,o=i.uv,l=i.uv2;void 0!==l&&(this.faceVertexUvs[1]=[]);for(let u=0;u<r.count;u++)t.vertices.push((new Bt).fromBufferAttribute(r,u)),void 0!==a&&t.colors.push((new Et).fromBufferAttribute(a,u));function c(e,n,i,r){let c=void 0===a?[]:[t.colors[e].clone(),t.colors[n].clone(),t.colors[i].clone()],h=void 0===s?[]:[(new Bt).fromBufferAttribute(s,e),(new Bt).fromBufferAttribute(s,n),(new Bt).fromBufferAttribute(s,i)],u=new iA(e,n,i,h,c,r);t.faces.push(u),void 0!==o&&t.faceVertexUvs[0].push([(new ot).fromBufferAttribute(o,e),(new ot).fromBufferAttribute(o,n),(new ot).fromBufferAttribute(o,i)]),void 0!==l&&t.faceVertexUvs[1].push([(new ot).fromBufferAttribute(l,e),(new ot).fromBufferAttribute(l,n),(new ot).fromBufferAttribute(l,i)])}let h=e.groups;if(h.length>0)for(let u=0;u<h.length;u++){let e=h[u],t=e.start;for(let i=t,r=t+e.count;i<r;i+=3)void 0!==n?c(n.getX(i),n.getX(i+1),n.getX(i+2),e.materialIndex):c(i,i+1,i+2,e.materialIndex)}else if(void 0!==n)for(let u=0;u<n.count;u+=3)c(n.getX(u),n.getX(u+1),n.getX(u+2));else for(let u=0;u<r.count;u+=3)c(u,u+1,u+2);return this.computeFaceNormals(),null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(eA).negate(),this.translate(eA.x,eA.y,eA.z),this}normalize(){this.computeBoundingSphere();let e=this.boundingSphere.center,t=this.boundingSphere.radius,n=0===t?1:1/t,i=new pn;return i.set(n,0,0,-n*e.x,0,n,0,-n*e.y,0,0,n,-n*e.z,0,0,0,1),this.applyMatrix4(i),this}computeFaceNormals(){let e=new Bt,t=new Bt;for(let n=0,i=this.faces.length;n<i;n++){let i=this.faces[n],r=this.vertices[i.a],s=this.vertices[i.b],a=this.vertices[i.c];e.subVectors(a,s),t.subVectors(r,s),e.cross(t),e.normalize(),i.normal.copy(e)}}computeVertexNormals(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=new Array(this.vertices.length);for(let n=0,i=this.vertices.length;n<i;n++)t[n]=new Bt;if(e){let e=new Bt,n=new Bt;for(let i=0,r=this.faces.length;i<r;i++){let r=this.faces[i],s=this.vertices[r.a],a=this.vertices[r.b],o=this.vertices[r.c];e.subVectors(o,a),n.subVectors(s,a),e.cross(n),t[r.a].add(e),t[r.b].add(e),t[r.c].add(e)}}else{this.computeFaceNormals();for(let e=0,n=this.faces.length;e<n;e++){let n=this.faces[e];t[n.a].add(n.normal),t[n.b].add(n.normal),t[n.c].add(n.normal)}}for(let n=0,i=this.vertices.length;n<i;n++)t[n].normalize();for(let n=0,i=this.faces.length;n<i;n++){let e=this.faces[n],i=e.vertexNormals;3===i.length?(i[0].copy(t[e.a]),i[1].copy(t[e.b]),i[2].copy(t[e.c])):(i[0]=t[e.a].clone(),i[1]=t[e.b].clone(),i[2]=t[e.c].clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)}computeFlatVertexNormals(){this.computeFaceNormals();for(let e=0,t=this.faces.length;e<t;e++){let t=this.faces[e],n=t.vertexNormals;3===n.length?(n[0].copy(t.normal),n[1].copy(t.normal),n[2].copy(t.normal)):(n[0]=t.normal.clone(),n[1]=t.normal.clone(),n[2]=t.normal.clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)}computeMorphNormals(){for(let t=0,n=this.faces.length;t<n;t++){let e=this.faces[t];e.__originalFaceNormal?e.__originalFaceNormal.copy(e.normal):e.__originalFaceNormal=e.normal.clone(),e.__originalVertexNormals||(e.__originalVertexNormals=[]);for(let t=0,n=e.vertexNormals.length;t<n;t++)e.__originalVertexNormals[t]?e.__originalVertexNormals[t].copy(e.vertexNormals[t]):e.__originalVertexNormals[t]=e.vertexNormals[t].clone()}let e=new tA;e.faces=this.faces;for(let t=0,n=this.morphTargets.length;t<n;t++){if(!this.morphNormals[t]){this.morphNormals[t]={},this.morphNormals[t].faceNormals=[],this.morphNormals[t].vertexNormals=[];let e=this.morphNormals[t].faceNormals,n=this.morphNormals[t].vertexNormals;for(let t=0,i=this.faces.length;t<i;t++){let t=new Bt,i={a:new Bt,b:new Bt,c:new Bt};e.push(t),n.push(i)}}let n=this.morphNormals[t];e.vertices=this.morphTargets[t].vertices,e.computeFaceNormals(),e.computeVertexNormals();for(let e=0,t=this.faces.length;e<t;e++){let t=this.faces[e],i=n.faceNormals[e],r=n.vertexNormals[e];i.copy(t.normal),r.a.copy(t.vertexNormals[0]),r.b.copy(t.vertexNormals[1]),r.c.copy(t.vertexNormals[2])}}for(let t=0,n=this.faces.length;t<n;t++){let e=this.faces[t];e.normal=e.__originalFaceNormal,e.vertexNormals=e.__originalVertexNormals}}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new Ft),this.boundingBox.setFromPoints(this.vertices)}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new rn),this.boundingSphere.setFromPoints(this.vertices)}merge(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(!e||!e.isGeometry)return void console.error("THREE.Geometry.merge(): geometry not an instance of THREE.Geometry.",e);let i,r=this.vertices.length,s=this.vertices,a=e.vertices,o=this.faces,l=e.faces,c=this.colors,h=e.colors;void 0!==t&&(i=(new lt).getNormalMatrix(t));for(let u=0,d=a.length;u<d;u++){let e=a[u].clone();void 0!==t&&e.applyMatrix4(t),s.push(e)}for(let u=0,d=h.length;u<d;u++)c.push(h[u].clone());for(let u=0,d=l.length;u<d;u++){let e,t,s=l[u],a=s.vertexNormals,c=s.vertexColors,h=new iA(s.a+r,s.b+r,s.c+r);h.normal.copy(s.normal),void 0!==i&&h.normal.applyMatrix3(i).normalize();for(let n=0,r=a.length;n<r;n++)e=a[n].clone(),void 0!==i&&e.applyMatrix3(i).normalize(),h.vertexNormals.push(e);h.color.copy(s.color);for(let n=0,i=c.length;n<i;n++)t=c[n],h.vertexColors.push(t.clone());h.materialIndex=s.materialIndex+n,o.push(h)}for(let u=0,d=e.faceVertexUvs.length;u<d;u++){let t=e.faceVertexUvs[u];void 0===this.faceVertexUvs[u]&&(this.faceVertexUvs[u]=[]);for(let e=0,n=t.length;e<n;e++){let n=t[e],i=[];for(let e=0,t=n.length;e<t;e++)i.push(n[e].clone());this.faceVertexUvs[u].push(i)}}}mergeMesh(e){e&&e.isMesh?(e.matrixAutoUpdate&&e.updateMatrix(),this.merge(e.geometry,e.matrix)):console.error("THREE.Geometry.mergeMesh(): mesh not an instance of THREE.Mesh.",e)}mergeVertices(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:4,t={},n=[],i=[],r=Math.pow(10,e);for(let o=0,l=this.vertices.length;o<l;o++){let e=this.vertices[o],s=Math.round(e.x*r)+"_"+Math.round(e.y*r)+"_"+Math.round(e.z*r);void 0===t[s]?(t[s]=o,n.push(this.vertices[o]),i[o]=n.length-1):i[o]=i[t[s]]}let s=[];for(let o=0,l=this.faces.length;o<l;o++){let e=this.faces[o];e.a=i[e.a],e.b=i[e.b],e.c=i[e.c];let t=[e.a,e.b,e.c];for(let n=0;n<3;n++)if(t[n]===t[(n+1)%3]){s.push(o);break}}for(let o=s.length-1;o>=0;o--){let e=s[o];this.faces.splice(e,1);for(let t=0,n=this.faceVertexUvs.length;t<n;t++)this.faceVertexUvs[t].splice(e,1)}let a=this.vertices.length-n.length;return this.vertices=n,a}setFromPoints(e){this.vertices=[];for(let t=0,n=e.length;t<n;t++){let n=e[t];this.vertices.push(new Bt(n.x,n.y,n.z||0))}return this}sortFacesByMaterialIndex(){let e=this.faces,t=e.length;for(let a=0;a<t;a++)e[a]._id=a;e.sort((function(e,t){return e.materialIndex-t.materialIndex}));let n,i,r=this.faceVertexUvs[0],s=this.faceVertexUvs[1];r&&r.length===t&&(n=[]),s&&s.length===t&&(i=[]);for(let a=0;a<t;a++){let t=e[a]._id;n&&n.push(r[t]),i&&i.push(s[t])}n&&(this.faceVertexUvs[0]=n),i&&(this.faceVertexUvs[1]=i)}toJSON(){let e={metadata:{version:4.5,type:"Geometry",generator:"Geometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),void 0!==this.parameters){let t=this.parameters;for(let n in t)void 0!==t[n]&&(e[n]=t[n]);return e}let t=[];for(let p=0;p<this.vertices.length;p++){let e=this.vertices[p];t.push(e.x,e.y,e.z)}let n=[],i=[],r={},s=[],a={},o=[],l={};for(let p=0;p<this.faces.length;p++){let e=this.faces[p],t=!0,i=!1,r=void 0!==this.faceVertexUvs[0][p],s=e.normal.length()>0,a=e.vertexNormals.length>0,o=1!==e.color.r||1!==e.color.g||1!==e.color.b,l=e.vertexColors.length>0,f=0;if(f=c(f,0,0),f=c(f,1,t),f=c(f,2,i),f=c(f,3,r),f=c(f,4,s),f=c(f,5,a),f=c(f,6,o),f=c(f,7,l),n.push(f),n.push(e.a,e.b,e.c),n.push(e.materialIndex),r){let e=this.faceVertexUvs[0][p];n.push(d(e[0]),d(e[1]),d(e[2]))}if(s&&n.push(h(e.normal)),a){let t=e.vertexNormals;n.push(h(t[0]),h(t[1]),h(t[2]))}if(o&&n.push(u(e.color)),l){let t=e.vertexColors;n.push(u(t[0]),u(t[1]),u(t[2]))}}function c(e,t,n){return n?e|1<<t:e&~(1<<t)}function h(e){let t=e.x.toString()+e.y.toString()+e.z.toString();return void 0!==r[t]||(r[t]=i.length/3,i.push(e.x,e.y,e.z)),r[t]}function u(e){let t=e.r.toString()+e.g.toString()+e.b.toString();return void 0!==a[t]||(a[t]=s.length,s.push(e.getHex())),a[t]}function d(e){let t=e.x.toString()+e.y.toString();return void 0!==l[t]||(l[t]=o.length/2,o.push(e.x,e.y)),l[t]}return e.data={},e.data.vertices=t,e.data.normals=i,s.length>0&&(e.data.colors=s),o.length>0&&(e.data.uvs=[o]),e.data.faces=n,e}clone(){return(new tA).copy(this)}copy(e){this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.name=e.name;let t=e.vertices;for(let u=0,d=t.length;u<d;u++)this.vertices.push(t[u].clone());let n=e.colors;for(let u=0,d=n.length;u<d;u++)this.colors.push(n[u].clone());let i=e.faces;for(let u=0,d=i.length;u<d;u++)this.faces.push(i[u].clone());for(let u=0,d=e.faceVertexUvs.length;u<d;u++){let t=e.faceVertexUvs[u];void 0===this.faceVertexUvs[u]&&(this.faceVertexUvs[u]=[]);for(let e=0,n=t.length;e<n;e++){let n=t[e],i=[];for(let e=0,t=n.length;e<t;e++){let t=n[e];i.push(t.clone())}this.faceVertexUvs[u].push(i)}}let r=e.morphTargets;for(let u=0,d=r.length;u<d;u++){let e={};if(e.name=r[u].name,void 0!==r[u].vertices){e.vertices=[];for(let t=0,n=r[u].vertices.length;t<n;t++)e.vertices.push(r[u].vertices[t].clone())}if(void 0!==r[u].normals){e.normals=[];for(let t=0,n=r[u].normals.length;t<n;t++)e.normals.push(r[u].normals[t].clone())}this.morphTargets.push(e)}let s=e.morphNormals;for(let u=0,d=s.length;u<d;u++){let e={};if(void 0!==s[u].vertexNormals){e.vertexNormals=[];for(let t=0,n=s[u].vertexNormals.length;t<n;t++){let n=s[u].vertexNormals[t],i={};i.a=n.a.clone(),i.b=n.b.clone(),i.c=n.c.clone(),e.vertexNormals.push(i)}}if(void 0!==s[u].faceNormals){e.faceNormals=[];for(let t=0,n=s[u].faceNormals.length;t<n;t++)e.faceNormals.push(s[u].faceNormals[t].clone())}this.morphNormals.push(e)}let a=e.skinWeights;for(let u=0,d=a.length;u<d;u++)this.skinWeights.push(a[u].clone());let o=e.skinIndices;for(let u=0,d=o.length;u<d;u++)this.skinIndices.push(o[u].clone());let l=e.lineDistances;for(let u=0,d=l.length;u<d;u++)this.lineDistances.push(l[u]);let c=e.boundingBox;null!==c&&(this.boundingBox=c.clone());let h=e.boundingSphere;return null!==h&&(this.boundingSphere=h.clone()),this.elementsNeedUpdate=e.elementsNeedUpdate,this.verticesNeedUpdate=e.verticesNeedUpdate,this.uvsNeedUpdate=e.uvsNeedUpdate,this.normalsNeedUpdate=e.normalsNeedUpdate,this.colorsNeedUpdate=e.colorsNeedUpdate,this.lineDistancesNeedUpdate=e.lineDistancesNeedUpdate,this.groupsNeedUpdate=e.groupsNeedUpdate,this}toBufferGeometry(){let e=(new nA).fromGeometry(this),t=new di,n=new Float32Array(3*e.vertices.length);if(t.setAttribute("position",oA.call(new ti(n,3),e.vertices)),e.normals.length>0){let n=new Float32Array(3*e.normals.length);t.setAttribute("normal",oA.call(new ti(n,3),e.normals))}if(e.colors.length>0){let n=new Float32Array(3*e.colors.length);t.setAttribute("color",sA.call(new ti(n,3),e.colors))}if(e.uvs.length>0){let n=new Float32Array(2*e.uvs.length);t.setAttribute("uv",aA.call(new ti(n,2),e.uvs))}if(e.uvs2.length>0){let n=new Float32Array(2*e.uvs2.length);t.setAttribute("uv2",aA.call(new ti(n,2),e.uvs2))}t.groups=e.groups;for(let i in e.morphTargets){let n=[],r=e.morphTargets[i];for(let e=0,t=r.length;e<t;e++){let t=r[e],i=new ri(3*t.data.length,3);i.name=t.name,n.push(oA.call(i,t.data))}t.morphAttributes[i]=n}if(e.skinIndices.length>0){let n=new ri(4*e.skinIndices.length,4);t.setAttribute("skinIndex",lA.call(n,e.skinIndices))}if(e.skinWeights.length>0){let n=new ri(4*e.skinWeights.length,4);t.setAttribute("skinWeight",lA.call(n,e.skinWeights))}return null!==e.boundingSphere&&(t.boundingSphere=e.boundingSphere.clone()),null!==e.boundingBox&&(t.boundingBox=e.boundingBox.clone()),t}computeTangents(){console.error("THREE.Geometry: .computeTangents() has been removed.")}computeLineDistances(){console.error("THREE.Geometry: .computeLineDistances() has been removed. Use THREE.Line.computeLineDistances() instead.")}applyMatrix(e){return console.warn("THREE.Geometry: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(e)}dispose(){this.dispatchEvent({type:"dispose"})}static createBufferGeometryFromObject(e){let t=new di,n=e.geometry;if(e.isPoints||e.isLine){let e=new ri(3*n.vertices.length,3),i=new ri(3*n.colors.length,3);if(t.setAttribute("position",oA.call(e,n.vertices)),t.setAttribute("color",sA.call(i,n.colors)),n.lineDistances&&n.lineDistances.length===n.vertices.length){let e=new ri(n.lineDistances.length,1);t.setAttribute("lineDistance",rA.call(e,n.lineDistances))}null!==n.boundingSphere&&(t.boundingSphere=n.boundingSphere.clone()),null!==n.boundingBox&&(t.boundingBox=n.boundingBox.clone())}else e.isMesh&&(t=n.toBufferGeometry());return t}};tA.prototype.isGeometry=!0;var nA=class{constructor(){this.vertices=[],this.normals=[],this.colors=[],this.uvs=[],this.uvs2=[],this.groups=[],this.morphTargets={},this.skinWeights=[],this.skinIndices=[],this.boundingBox=null,this.boundingSphere=null,this.verticesNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.uvsNeedUpdate=!1,this.groupsNeedUpdate=!1}computeGroups(e){let t,n,i,r=[],s=e.faces;for(n=0;n<s.length;n++){let e=s[n];e.materialIndex!==i&&(i=e.materialIndex,void 0!==t&&(t.count=3*n-t.start,r.push(t)),t={start:3*n,materialIndex:i})}void 0!==t&&(t.count=3*n-t.start,r.push(t)),this.groups=r}fromGeometry(e){let t,n=e.faces,i=e.vertices,r=e.faceVertexUvs,s=r[0]&&r[0].length>0,a=r[1]&&r[1].length>0,o=e.morphTargets,l=o.length;if(l>0){t=[];for(let e=0;e<l;e++)t[e]={name:o[e].name,data:[]};this.morphTargets.position=t}let c,h=e.morphNormals,u=h.length;if(u>0){c=[];for(let e=0;e<u;e++)c[e]={name:h[e].name,data:[]};this.morphTargets.normal=c}let d=e.skinIndices,p=e.skinWeights,f=d.length===i.length,m=p.length===i.length;i.length>0&&0===n.length&&console.error("THREE.DirectGeometry: Faceless geometries are not supported.");for(let g=0;g<n.length;g++){let e=n[g];this.vertices.push(i[e.a],i[e.b],i[e.c]);let v=e.vertexNormals;if(3===v.length)this.normals.push(v[0],v[1],v[2]);else{let t=e.normal;this.normals.push(t,t,t)}let y=e.vertexColors;if(3===y.length)this.colors.push(y[0],y[1],y[2]);else{let t=e.color;this.colors.push(t,t,t)}if(!0===s){let e=r[0][g];void 0!==e?this.uvs.push(e[0],e[1],e[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv ",g),this.uvs.push(new ot,new ot,new ot))}if(!0===a){let e=r[1][g];void 0!==e?this.uvs2.push(e[0],e[1],e[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv2 ",g),this.uvs2.push(new ot,new ot,new ot))}for(let n=0;n<l;n++){let i=o[n].vertices;t[n].data.push(i[e.a],i[e.b],i[e.c])}for(let t=0;t<u;t++){let e=h[t].vertexNormals[g];c[t].data.push(e.a,e.b,e.c)}f&&this.skinIndices.push(d[e.a],d[e.b],d[e.c]),m&&this.skinWeights.push(p[e.a],p[e.b],p[e.c])}return this.computeGroups(e),this.verticesNeedUpdate=e.verticesNeedUpdate,this.normalsNeedUpdate=e.normalsNeedUpdate,this.colorsNeedUpdate=e.colorsNeedUpdate,this.uvsNeedUpdate=e.uvsNeedUpdate,this.groupsNeedUpdate=e.groupsNeedUpdate,null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),this}},iA=class{constructor(e,t,n,i,r){let s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;this.a=e,this.b=t,this.c=n,this.normal=i&&i.isVector3?i:new Bt,this.vertexNormals=Array.isArray(i)?i:[],this.color=r&&r.isColor?r:new Et,this.vertexColors=Array.isArray(r)?r:[],this.materialIndex=s}clone(){return(new this.constructor).copy(this)}copy(e){this.a=e.a,this.b=e.b,this.c=e.c,this.normal.copy(e.normal),this.color.copy(e.color),this.materialIndex=e.materialIndex;for(let t=0,n=e.vertexNormals.length;t<n;t++)this.vertexNormals[t]=e.vertexNormals[t].clone();for(let t=0,n=e.vertexColors.length;t<n;t++)this.vertexColors[t]=e.vertexColors[t].clone();return this}};function rA(e){return this.array.set(e),this}function sA(e){let t=this.array,n=0;for(let i=0,r=e.length;i<r;i++){let r=e[i];void 0===r&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",i),r=new Et),t[n++]=r.r,t[n++]=r.g,t[n++]=r.b}return this}function aA(e){let t=this.array,n=0;for(let i=0,r=e.length;i<r;i++){let r=e[i];void 0===r&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",i),r=new ot),t[n++]=r.x,t[n++]=r.y}return this}function oA(e){let t=this.array,n=0;for(let i=0,r=e.length;i<r;i++){let r=e[i];void 0===r&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",i),r=new Bt),t[n++]=r.x,t[n++]=r.y,t[n++]=r.z}return this}function lA(e){let t=this.array,n=0;for(let i=0,r=e.length;i<r;i++){let r=e[i];void 0===r&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",i),r=new Ot),t[n++]=r.x,t[n++]=r.y,t[n++]=r.z,t[n++]=r.w}return this}var cA=["a","b","c"];function hA(e,t){switch(t){case"c":return e.c;case"b":return e.b;default:return e.a}}function uA(e,t,n){let i=Math.min(e,t)+"_"+Math.max(e,t);return n.get(i)}function dA(e,t,n,i,r,s){let a,o=Math.min(e,t),l=Math.max(e,t),c=o+"_"+l;if(i.has(c))a=i.get(c);else{a={a:n[o],b:n[l],newEdge:null,faces:[]},i.set(c,a)}a.faces.push(r),s[e].edges.push(a),s[t].edges.push(a)}function pA(e,t,n,i,r){e.push(new iA(t,n,i,void 0,void 0,r))}function fA(e,t){return Math.abs(t-e)/2+Math.min(e,t)}function mA(e,t,n,i){e.push([t.clone(),n.clone(),i.clone()])}var gA=class{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;this.subdivisions=e}modify(e){(e=e instanceof di?(new tA).fromBufferGeometry(e):e.clone()).mergeVertices();let t=this.subdivisions;for(;t-- >0;)this._smooth(e);return e.computeFaceNormals(),e.computeVertexNormals(),e}_smooth(e){let t,n,i,r,s,a=new Bt,o=e.vertices,l=e.faces,c=e.faceVertexUvs[0],h=void 0!==c&&c.length>0,u=[],d=new Map;!function(e,t,n,i){let r,s,a;for(r=0,s=e.length;r<s;r++)n[r]={edges:[]};for(r=0,s=t.length;r<s;r++)a=t[r],dA(a.a,a.b,e,i,a,n),dA(a.b,a.c,e,i,a,n),dA(a.c,a.a,e,i,a,n)}(o,l,u,d);let p,f,m,g,v,y,b,x=[];for(let G of Array.from(d.keys())){for(f=d.get(G),m=new Bt,v=3/8,y=1/8,b=f.faces.length,2!=b&&(v=.5,y=0),m.addVectors(f.a,f.b).multiplyScalar(v),a.set(0,0,0),r=0;r<b;r++){for(g=f.faces[r],s=0;s<3&&(p=o[hA(g,cA[s])],p===f.a||p===f.b);s++);p&&a.add(p)}a.multiplyScalar(y),m.add(a),f.newEdge=x.length,x.push(m)}let w,S,_,E,A,C,M,T=[];for(n=0,i=o.length;n<i;n++){for(C=o[n],A=u[n].edges,t=A.length,3==t?w=3/16:t>3&&(w=3/(8*t)),S=1-t*Number(w),_=w,t<=2&&(2==t&&(S=3/4,_=1/8)),M=C.clone().multiplyScalar(S),a.set(0,0,0),r=0;r<t;r++)E=A[r],p=E.a!==C?E.a:E.b,a.add(p);a.multiplyScalar(Number(_)),M.add(a),T.push(M)}let P,D,O,I,R,k,L,B=T.concat(x),z=T.length,N=[],F=[],U=new ot,j=new ot,V=new ot;for(n=0,i=l.length;n<i;n++)g=l[n],P=Number(uA(g.a,g.b,d).newEdge)+z,D=Number(uA(g.b,g.c,d).newEdge)+z,O=Number(uA(g.c,g.a,d).newEdge)+z,pA(N,P,D,O,g.materialIndex),pA(N,g.a,P,O,g.materialIndex),pA(N,g.b,D,P,g.materialIndex),pA(N,g.c,O,D,g.materialIndex),h&&(I=c[n],R=I[0],k=I[1],L=I[2],U.set(fA(R.x,k.x),fA(R.y,k.y)),j.set(fA(k.x,L.x),fA(k.y,L.y)),V.set(fA(R.x,L.x),fA(R.y,L.y)),mA(F,U,j,V),mA(F,R,U,V),mA(F,k,j,U),mA(F,L,V,j));e.vertices=B,e.faces=N,h&&(e.faceVertexUvs[0]=F)}},vA=new Bt,yA=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){var n,i,r;let s=Object.assign({},null!==(n=null===t||void 0===t?void 0:t.parameters)&&void 0!==n?n:{width:100,depth:0,spikes:5,cornerRadius:0,extrudeBevelSize:0,extrudeBevelSegments:3},e.parameters);return{shape:e.shape&&e.shape instanceof aE?e.shape:new aE,parameters:Object.assign(s,{width:Math.abs(s.width),height:Math.abs(null!==(i=s.height)&&void 0!==i?i:s.width),depth:Math.abs(null!==(r=s.depth)&&void 0!==r?r:0)})}}static build(e){let{width:t,height:n,spikes:i,cornerRadius:r,depth:s,extrudeBevelSize:a,extrudeBevelSegments:l}=e.parameters,c=e.shape,h=.5*t,u=.5*n,d=2*Math.PI/i;for(let o=0;o<i;o++){let e=d*o,t=0+Math.sin(e)*h,n=0+Math.cos(e)*u;c.addPoint(c.createPoint(t,n))}c.isClosed=!0;for(let o=0,f=c.points.length;o<f;o++)c.points[o].roundness=r;c.roundness=r,c.update();let p=UE.create({shape:c,parameters:{roundness:r,depth:s,extrudeBevelSize:a,extrudeBevelSegments:l}});return Object.assign(p,{userData:o(o({},e),{},{type:"PolygonGeometry"})})}};function bA(e,t,n){n.x=e.x*t.x,n.y=e.y,n.z=e.x*t.y}function xA(e,t,n,i,r,s){let a=t.clone().sub(e),o=n.clone().sub(e),l=a.angleTo(o);if(a.normalize(),o.normalize(),i===r){let t=a.add(o).normalize();s.copy(e).addScaledVector(t,i/Math.sin(l/2))}else{let t=a.angleTo(o);s.copy(e),s.addScaledVector(a,r/Math.sin(t)),s.addScaledVector(o,i/Math.sin(t))}}function wA(e,t,n){let i=e.clone().sub(t),r=n.clone().sub(t);return i.projectOnVector(r),i.add(t)}var SA=class extends di{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.5,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,r=arguments.length>4&&void 0!==arguments[4]&&arguments[4],s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:4;super(),n=Math.floor(Math.max(3,n)),i=Math.floor(i),a=Math.floor(a);let o,l=[],c=[],h=[],u=[],d=0,p=t/2,f=Math.PI/n,m=e*Math.cos(Math.PI/n),g=2*Math.PI/n,v=(n-2)*Math.PI/n,y=Math.PI-v,b=new Bt(0,-p,0),x=new Bt(0,p,0),w=new ot(e,-p),S=new ot(m,-p),_=new ot(0,x.y).sub(S),E=new ot(0,x.y).sub(w),A=new ot(_.y,-_.x).normalize(),C=new ot(E.y,-E.x).normalize(),M=e*Math.cos(Math.PI/n)*Math.tan((Math.PI-_.angle())/2)-1e-8;s=Math.min(s,M);{let e=new Bt(A.x,A.y,0),t=new Bt(Math.cos(g)*e.x,e.y,Math.sin(g)*e.x);o=e.angleTo(t)}let T=s/Math.tan((Math.PI-_.angle())/2),P=s/Math.tan((Math.PI-o)/2),D=new Bt;if(!r){c.push(b.x,b.y,b.z),h.push(0,-1,0),u.push(0,0);let e=d++,t=[],i=w.clone(),r=T/Math.cos(Math.PI/n);i.x-=r;for(let s=0;s<n;s++){let e=s/n*Math.PI*2+f;bA(i,new ot(Math.sin(e),Math.cos(e)),D),c.push(D.x,D.y,D.z),h.push(0,-1,0),u.push(0,0),t.push(d++)}for(let n=0;n<t.length;n++)l.push(t[n],e,t[(n+1)%t.length])}let O=[];{let e=new Bt,t=new Bt,i=new Bt,r=new Bt,p=new Bt,m=new Bt;for(let g=0;g<n;g++){let v=g/n*Math.PI*2+f,y=(g+.5)/n*Math.PI*2+f,S=(g+1)/n*Math.PI*2+f,E=new ot(Math.sin(v),Math.cos(v)),M=new ot(Math.sin(y),Math.cos(y)),D=new ot(Math.sin(S),Math.cos(S));bA(w,E,t),bA(w,D,i),bA(A,M,e),xA(x,t,i,P,P,r),c.push(r.x,r.y,r.z),xA(t,x,i,P,T,p),c.push(p.x,p.y,p.z),xA(i,t,x,T,P,m),c.push(m.x,m.y,m.z),h.push(e.x,e.y,e.z),h.push(e.x,e.y,e.z),h.push(e.x,e.y,e.z),u.push(0,0),u.push(0,0),u.push(0,0);let k=d++,L=d++,B=d++;if(l.push(k,L,B),s>0){{let e=t.clone().add(i).multiplyScalar(.5),n=x.clone().sub(e).normalize(),r=b.clone().sub(e).normalize().add(n).normalize().multiplyScalar(-1);I(e,m.clone().sub(p),r,_.angle())}let f,g;{let e=new Bt;bA(C,D,e);let t=m.clone().add(r).multiplyScalar(.5);t=wA(t,i,x);let n=m.clone().sub(r);[f,g]=I(t,n,e,o,r.y)}{let e=f,t=e.clone().setY(0).normalize(),n=new Bt(0,-1,0),i=t.clone().cross(n);R(e,t,n,i)}O.concat(g);{let t=_.angle(),i=Math.PI-t,r=x.clone();r.y-=s/Math.sin(t-Math.PI/2);let o=new Bt,p=[];for(let l=0;l<a;l++){let t=[],f=Math.PI/2-i*l/a,m=Math.cos(f),g=Math.sin(f),v=y;for(let i=0;i<=l;i++){let i=Math.cos(v),a=Math.sin(v);e.x=m*a,e.y=g,e.z=m*i,o.copy(r).addScaledVector(e,s),c.push(o.x,o.y,o.z),h.push(e.x,e.y,e.z),u.push(0,0),t.push(d++),v+=2*Math.PI/l/n}p.push(t)}g.reverse(),p.push(g);let f=p.length-1;for(let e=0;e<f;e++){let t=p[e],n=p[e+1],i=t.length-1;l.push(n[1],t[0],n[0]);for(let e=1;e<=i;e++)l.push(t[e],t[e-1],n[e]),l.push(n[e+1],t[e],n[e])}}}}}function I(e,t,n,i,r){let o=-i/2,p=(Math.PI-i)/2,f=t.clone().normalize().cross(n);e.addScaledVector(n,-s/Math.sin(p));let m=new Bt,g=new Bt,v=d,y=[];for(let l=0;l<=a;l++){let p=o+l/a*i;g.set(0,0,0),g.addScaledVector(f,Math.sin(p)),g.addScaledVector(n,Math.cos(p));for(let n=0;n<=1;n++){let i=n/1-.5;if(m.copy(e),m.addScaledVector(t,i),m.addScaledVector(g,s),null!=r){let e=Math.max(0,m.y-r);m.addScaledVector(t,-e/t.y)}c.push(m.x,m.y,m.z),h.push(g.x,g.y,g.z),u.push(0,0),0===n&&y.push(d),d++}}for(let s=0;s<a;s++)for(let e=0;e<1;e++){let t=v+e+2*s,n=t+2,i=n+1,r=t+1;l.push(t,n,r),l.push(n,i,r)}return[e.clone().addScaledVector(t,.5),y]}function R(e,t,n,i){let r=Math.PI/2,o=E.angle()-r,p=[],f=new Bt,m=new Bt;for(let l=0;l<=a;l++){let g=[],v=l/a;for(let a=0;a<=l;a++){let p=((l?a/l:0)-.5)*y,b=Math.cos(p),x=Math.sin(p),w=(r+Math.atan(Math.tan(o)*b))*v,S=Math.cos(w),_=Math.sin(w);f.set(0,0,0),f.addScaledVector(t,_*b),f.addScaledVector(n,S),f.addScaledVector(i,_*x),m.copy(e).addScaledVector(f,s),c.push(m.x,m.y,m.z),h.push(f.x,f.y,f.z),u.push(0,0),g.push(d++)}p.push(g)}let g=p.length-1;for(let s=0;s<g;s++){let e=p[s],t=p[s+1],n=e.length-1;l.push(e[0],t[1],t[0]);for(let i=1;i<=n;i++)l.push(e[i-1],e[i],t[i]),l.push(e[i],t[i+1],t[i])}}this.setIndex(l),this.setAttribute("position",new ri(c,3)),this.setAttribute("normal",new ri(h,3)),this.setAttribute("uv",new ri(u,2))}},_A=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){var n,i,r,s;let a=Object.assign({},null!==(n=null===t||void 0===t?void 0:t.parameters)&&void 0!==n?n:{width:100,depth:0,cornerRadius:[0,0,0,0],cornerType:1,extrudeBevelSize:0,extrudeBevelSegments:1},e.parameters),o=Object.assign(null!==(i=null===t||void 0===t?void 0:t.ui)&&void 0!==i?i:{enabledIndieCorners:!1},e.ui);return{shape:e.shape&&e.shape instanceof aE?e.shape:new aE,parameters:Object.assign(a,{width:Math.abs(a.width),height:Math.abs(null!==(r=a.height)&&void 0!==r?r:a.width),depth:Math.abs(null!==(s=a.depth)&&void 0!==s?s:0)}),ui:o}}static build(e){let t=e.shape,{width:n,height:i,cornerRadius:r,cornerType:s,depth:a,extrudeBevelSize:l,extrudeBevelSegments:c}=e.parameters,h={x:.5*n,y:.5*i},u={x:-h.x,y:-h.y},d={x:h.x,y:h.y};function p(e,t,r){return t>n&&r>i?Math.min(e*n/t,e*i/r):t>n?e*n/t:r>i?e*i/r:e}let f=[];f[0]=0===r[0]?0:p(r[0],r[0]+r[3],r[0]+r[1]),f[1]=0===r[1]?0:p(r[1],r[1]+r[2],r[1]+r[0]),f[2]=0===r[2]?0:p(r[2],r[2]+r[1],r[2]+r[3]),f[3]=0===r[3]?0:p(r[3],r[3]+r[0],r[3]+r[2]);let m=u.x,g=d.x,v=d.y,y=u.y;t.addPoint(t.createPoint(m,v)),t.addPoint(t.createPoint(g,v)),t.addPoint(t.createPoint(g,y)),t.addPoint(t.createPoint(m,y)),t.isClosed=!0;let b=!0;for(let o=0,w=t.points.length;o<w;o++)t.points[o].roundness=f[o],o>0&&f[o]!==f[o-1]&&(b=!1);b&&(t.roundness=f[0]),t.useCubicForRoundedCorners=1!==s,t.update();let x=UE.create({shape:t,parameters:{depth:a,extrudeBevelSize:l,extrudeBevelSegments:c}});return Object.assign(x,{userData:o(o({},e),{},{type:"RectangleGeometry"})})}},EA=class extends di{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:90,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:10,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:24;super(),this.type="BackdropGeometry";let a=[],o=[],l=[],c=.001;0==r&&(s=1),s=Math.max(1,Math.floor(s)),r=Math.min(r,100),i=Math.min(180-c,i),i*=Math.PI/180;let h=[],u=Math.PI/2,d=function(){return new Bt(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,arguments.length>2&&void 0!==arguments[2]?arguments[2]:0)},p=d(),f=d(),[m,g,v]=[t/2,e/2,n/2],y=-g,b=+g,[x,w,S]=[d(y,-m,+v),d(y,-m,-v),d(y,+m,-v)],_=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return Math.sin(e-Math.PI/(+t+1))},E=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return Math.cos(e-Math.PI/(+t+1))};S.y=Math.sin(i)*t-m;let A=Math.cos(i)*t-v,C=x.z-c;i<=u?(S.z=Math.min(A,C),S.z==C&&(S.y-=(A-C)/Math.tan(u-i))):w.z=Math.min(w.z-A-v,x.z-c),p.subVectors(x,w),f.subVectors(S,w);let M=Math.min(p.length(),f.length())*r/100,T=M*Math.tan(i/2),P=M/Math.cos(i/2),D=p.clone().normalize().add(f.normalize()).setLength(P).add(w);p.set(0,_(i,!0),E(i,!0)),h.push([S,p.clone()]);let O=(Math.PI-i)/s;for(let V=0;V<=s;V++){let e=u+i+V*O;p.set(0,Math.sin(e)*T,Math.cos(e)*T),p.add(D),f.set(0,_(e),E(e)),h.push([p.clone(),f.clone()])}h.push([x,d(0,1,0)]);let I=Math.sin(O/2)*T*2,R=h.length-1,k=h[0][0].distanceTo(h[1][0]),L=k+I*s+h[R-1][0].distanceTo(h[R][0]);h[0].push(1);for(let V=0;V<=s;V++)h[V+1].push(1-(k+V*I)/L);h[R].push(0);let B,z,N,[F,U,j]=h[0];for(let V=1;V<h.length;V++)[B,z,N]=h[V],a.push(y,F.y,F.z,y,B.y,B.z,b,F.y,F.z,b,F.y,F.z,y,B.y,B.z,b,B.y,B.z),o.push(0,U.y,U.z,0,z.y,z.z,0,U.y,U.z,0,U.y,U.z,0,z.y,z.z,0,z.y,z.z),l.push(0,j,0,N,1,j,1,j,0,N,1,N),[F,U,j]=[B,z,N];this.setAttribute("position",new ri(a,3)),this.setAttribute("normal",new ri(o,3)),this.setAttribute("uv",new ri(l,2))}},AA=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){var n,i,r;let s=Object.assign({},null!==(n=null===t||void 0===t?void 0:t.parameters)&&void 0!==n?n:{width:100,depth:0,innerRadiusPercent:38.19,spikes:5,cornerRadius:0,angle:360,extrudeBevelSize:0,extrudeBevelSegments:1},e.parameters);return{shape:e.shape&&e.shape instanceof aE?e.shape:new aE,parameters:Object.assign(s,{width:Math.abs(s.width),height:Math.abs(null!==(i=s.height)&&void 0!==i?i:s.width),depth:Math.abs(null!==(r=s.depth)&&void 0!==r?r:0)})}}static build(e){let{width:t,height:n,innerRadiusPercent:i,spikes:r,cornerRadius:s,angle:a,depth:l,extrudeBevelSize:c,extrudeBevelSegments:h}=e.parameters,u=e.shape,d=.5*t,p=.5*n,f=a*Math.PI/360/r,m=Math.PI/2*3*-1,g=d*i/100,v=p*i/100;if(3===r&&50===i){f=2*Math.PI/r;for(let e=0;e<r;e++){let t=f*e,n=0+Math.sin(t)*d,i=0+Math.cos(t)*p;u.addPoint(u.createPoint(n,i))}}else for(let o=0;o<r;o++){let e=0+Math.cos(m)*d,t=0+Math.sin(m)*p;u.addPoint(u.createPoint(e,t)),m+=f,e=0+Math.cos(m)*g,t=0+Math.sin(m)*v,u.addPoint(u.createPoint(e,t)),m+=f}u.isClosed=!0;for(let o=0,b=u.points.length;o<b;o++)u.points[o].roundness=s;u.roundness=s,u.update();let y=UE.create({shape:u,parameters:{roundness:s,depth:l,extrudeBevelSize:c,extrudeBevelSegments:h}});return Object.assign(y,{userData:o(o({},e),{},{type:"StarGeometry"})})}};var CA={parseRgba:function(e){return/^(rgba)?\(\s*(\d+),\s*(\d+),\s*(\d+)(?:,\s*(\d+(?:\.\d+)?))?\s*\)$/.exec(e.toLowerCase())},hsvToRgb:function(e,t,n){let i,r,s,a=Math.floor(6*e),o=6*e-a,l=n*(1-t),c=n*(1-o*t),h=n*(1-(1-o)*t);switch(a%6){case 0:i=n,r=h,s=l;break;case 1:i=c,r=n,s=l;break;case 2:i=l,r=n,s=h;break;case 3:i=l,r=c,s=n;break;case 4:i=h,r=l,s=n;break;default:i=n,r=l,s=c}return{r:255*i,g:255*r,b:255*s}},rgbToHsv:function(e,t,n){e/=255,t/=255,n/=255;let i,r=Math.max(e,t,n),s=Math.min(e,t,n),a=r,o=r-s,l=0==r?0:o/r;if(r==s)i=0;else{switch(r){case e:i=(t-n)/o+(t<n?6:0);break;case t:i=(n-e)/o+2;break;default:i=(e-t)/o+4}i/=6}return{h:i,s:l,v:a}},hexToRgb:function(e){return{r:(e=Math.floor(e))>>16&255,g:e>>8&255,b:255&e}},rgbToHex:function(e,t,n){return(e<<16)+(t<<8)+n},rgbToHexString:function(e,t,n){return"#"+[e=Math.round(e),t=Math.round(t),n=Math.round(n)].map((e=>e.toString(16).padStart(2,"0"))).join("").toUpperCase()},hexStringToRgb:function(e){e=e.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,((e,t,n,i)=>String(t+t+n+n+i+i)));let t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return t?{r:parseInt(t[1],16),g:parseInt(t[2],16),b:parseInt(t[3],16)}:null}},MA=class{static get version(){return"1.3.8"}static toString(){return"JavaScript Expression Parser (JSEP) v"+MA.version}static addUnaryOp(e){return MA.max_unop_len=Math.max(e.length,MA.max_unop_len),MA.unary_ops[e]=1,MA}static addBinaryOp(e,t,n){return MA.max_binop_len=Math.max(e.length,MA.max_binop_len),MA.binary_ops[e]=t,n?MA.right_associative.add(e):MA.right_associative.delete(e),MA}static addIdentifierChar(e){return MA.additional_identifier_chars.add(e),MA}static addLiteral(e,t){return MA.literals[e]=t,MA}static removeUnaryOp(e){return delete MA.unary_ops[e],e.length===MA.max_unop_len&&(MA.max_unop_len=MA.getMaxKeyLen(MA.unary_ops)),MA}static removeAllUnaryOps(){return MA.unary_ops={},MA.max_unop_len=0,MA}static removeIdentifierChar(e){return MA.additional_identifier_chars.delete(e),MA}static removeBinaryOp(e){return delete MA.binary_ops[e],e.length===MA.max_binop_len&&(MA.max_binop_len=MA.getMaxKeyLen(MA.binary_ops)),MA.right_associative.delete(e),MA}static removeAllBinaryOps(){return MA.binary_ops={},MA.max_binop_len=0,MA}static removeLiteral(e){return delete MA.literals[e],MA}static removeAllLiterals(){return MA.literals={},MA}get char(){return this.expr.charAt(this.index)}get code(){return this.expr.charCodeAt(this.index)}constructor(e){this.expr=e,this.index=0}static parse(e){return new MA(e).parse()}static getMaxKeyLen(e){return Math.max(0,...Object.keys(e).map((e=>e.length)))}static isDecimalDigit(e){return e>=48&&e<=57}static binaryPrecedence(e){return MA.binary_ops[e]||0}static isIdentifierStart(e){return e>=65&&e<=90||e>=97&&e<=122||e>=128&&!MA.binary_ops[String.fromCharCode(e)]||MA.additional_identifier_chars.has(String.fromCharCode(e))}static isIdentifierPart(e){return MA.isIdentifierStart(e)||MA.isDecimalDigit(e)}throwError(e){let t=new Error(e+" at character "+this.index);throw t.index=this.index,t.description=e,t}runHook(e,t){if(MA.hooks[e]){let n={context:this,node:t};return MA.hooks.run(e,n),n.node}return t}searchHook(e){if(MA.hooks[e]){let t={context:this};return MA.hooks[e].find((function(e){return e.call(t.context,t),t.node})),t.node}}gobbleSpaces(){let e=this.code;for(;e===MA.SPACE_CODE||e===MA.TAB_CODE||e===MA.LF_CODE||e===MA.CR_CODE;)e=this.expr.charCodeAt(++this.index);this.runHook("gobble-spaces")}parse(){this.runHook("before-all");let e=this.gobbleExpressions(),t=1===e.length?e[0]:{type:MA.COMPOUND,body:e};return this.runHook("after-all",t)}gobbleExpressions(e){let t,n,i=[];for(;this.index<this.expr.length;)if(t=this.code,t===MA.SEMCOL_CODE||t===MA.COMMA_CODE)this.index++;else if(n=this.gobbleExpression())i.push(n);else if(this.index<this.expr.length){if(t===e)break;this.throwError('Unexpected "'+this.char+'"')}return i}gobbleExpression(){let e=this.searchHook("gobble-expression")||this.gobbleBinaryExpression();return this.gobbleSpaces(),this.runHook("after-expression",e)}gobbleBinaryOp(){this.gobbleSpaces();let e=this.expr.substr(this.index,MA.max_binop_len),t=e.length;for(;t>0;){if(MA.binary_ops.hasOwnProperty(e)&&(!MA.isIdentifierStart(this.code)||this.index+e.length<this.expr.length&&!MA.isIdentifierPart(this.expr.charCodeAt(this.index+e.length))))return this.index+=t,e;e=e.substr(0,--t)}return!1}gobbleBinaryExpression(){let e,t,n,i,r,s,a,o,l;if(s=this.gobbleToken(),!s||(t=this.gobbleBinaryOp(),!t))return s;for(r={value:t,prec:MA.binaryPrecedence(t),right_a:MA.right_associative.has(t)},a=this.gobbleToken(),a||this.throwError("Expected expression after "+t),i=[s,r,a];t=this.gobbleBinaryOp();){if(n=MA.binaryPrecedence(t),0===n){this.index-=t.length;break}r={value:t,prec:n,right_a:MA.right_associative.has(t)},l=t;let o=e=>r.right_a&&e.right_a?n>e.prec:n<=e.prec;for(;i.length>2&&o(i[i.length-2]);)a=i.pop(),t=i.pop().value,s=i.pop(),e={type:MA.BINARY_EXP,operator:t,left:s,right:a},i.push(e);e=this.gobbleToken(),e||this.throwError("Expected expression after "+l),i.push(r,e)}for(o=i.length-1,e=i[o];o>1;)e={type:MA.BINARY_EXP,operator:i[o-1].value,left:i[o-2],right:e},o-=2;return e}gobbleToken(){let e,t,n,i;if(this.gobbleSpaces(),i=this.searchHook("gobble-token"),i)return this.runHook("after-token",i);if(e=this.code,MA.isDecimalDigit(e)||e===MA.PERIOD_CODE)return this.gobbleNumericLiteral();if(e===MA.SQUOTE_CODE||e===MA.DQUOTE_CODE)i=this.gobbleStringLiteral();else if(e===MA.OBRACK_CODE)i=this.gobbleArray();else{for(t=this.expr.substr(this.index,MA.max_unop_len),n=t.length;n>0;){if(MA.unary_ops.hasOwnProperty(t)&&(!MA.isIdentifierStart(this.code)||this.index+t.length<this.expr.length&&!MA.isIdentifierPart(this.expr.charCodeAt(this.index+t.length)))){this.index+=n;let e=this.gobbleToken();return e||this.throwError("missing unaryOp argument"),this.runHook("after-token",{type:MA.UNARY_EXP,operator:t,argument:e,prefix:!0})}t=t.substr(0,--n)}MA.isIdentifierStart(e)?(i=this.gobbleIdentifier(),MA.literals.hasOwnProperty(i.name)?i={type:MA.LITERAL,value:MA.literals[i.name],raw:i.name}:i.name===MA.this_str&&(i={type:MA.THIS_EXP})):e===MA.OPAREN_CODE&&(i=this.gobbleGroup())}return i?(i=this.gobbleTokenProperty(i),this.runHook("after-token",i)):this.runHook("after-token",!1)}gobbleTokenProperty(e){this.gobbleSpaces();let t=this.code;for(;t===MA.PERIOD_CODE||t===MA.OBRACK_CODE||t===MA.OPAREN_CODE||t===MA.QUMARK_CODE;){let n;if(t===MA.QUMARK_CODE){if(this.expr.charCodeAt(this.index+1)!==MA.PERIOD_CODE)break;n=!0,this.index+=2,this.gobbleSpaces(),t=this.code}this.index++,t===MA.OBRACK_CODE?(e={type:MA.MEMBER_EXP,computed:!0,object:e,property:this.gobbleExpression()},this.gobbleSpaces(),t=this.code,t!==MA.CBRACK_CODE&&this.throwError("Unclosed ["),this.index++):t===MA.OPAREN_CODE?e={type:MA.CALL_EXP,arguments:this.gobbleArguments(MA.CPAREN_CODE),callee:e}:(t===MA.PERIOD_CODE||n)&&(n&&this.index--,this.gobbleSpaces(),e={type:MA.MEMBER_EXP,computed:!1,object:e,property:this.gobbleIdentifier()}),n&&(e.optional=!0),this.gobbleSpaces(),t=this.code}return e}gobbleNumericLiteral(){let e,t,n="";for(;MA.isDecimalDigit(this.code);)n+=this.expr.charAt(this.index++);if(this.code===MA.PERIOD_CODE)for(n+=this.expr.charAt(this.index++);MA.isDecimalDigit(this.code);)n+=this.expr.charAt(this.index++);if(e=this.char,"e"===e||"E"===e){for(n+=this.expr.charAt(this.index++),e=this.char,("+"===e||"-"===e)&&(n+=this.expr.charAt(this.index++));MA.isDecimalDigit(this.code);)n+=this.expr.charAt(this.index++);MA.isDecimalDigit(this.expr.charCodeAt(this.index-1))||this.throwError("Expected exponent ("+n+this.char+")")}return t=this.code,MA.isIdentifierStart(t)?this.throwError("Variable names cannot start with a number ("+n+this.char+")"):(t===MA.PERIOD_CODE||1===n.length&&n.charCodeAt(0)===MA.PERIOD_CODE)&&this.throwError("Unexpected period"),{type:MA.LITERAL,value:parseFloat(n),raw:n}}gobbleStringLiteral(){let e="",t=this.index,n=this.expr.charAt(this.index++),i=!1;for(;this.index<this.expr.length;){let t=this.expr.charAt(this.index++);if(t===n){i=!0;break}if("\\"===t)switch(t=this.expr.charAt(this.index++),t){case"n":e+="\n";break;case"r":e+="\r";break;case"t":e+="\t";break;case"b":e+="\b";break;case"f":e+="\f";break;case"v":e+="\v";break;default:e+=t}else e+=t}return i||this.throwError('Unclosed quote after "'+e+'"'),{type:MA.LITERAL,value:e,raw:this.expr.substring(t,this.index)}}gobbleIdentifier(){let e=this.code,t=this.index;for(MA.isIdentifierStart(e)?this.index++:this.throwError("Unexpected "+this.char);this.index<this.expr.length&&(e=this.code,MA.isIdentifierPart(e));)this.index++;return{type:MA.IDENTIFIER,name:this.expr.slice(t,this.index)}}gobbleArguments(e){let t=[],n=!1,i=0;for(;this.index<this.expr.length;){this.gobbleSpaces();let r=this.code;if(r===e){n=!0,this.index++,e===MA.CPAREN_CODE&&i&&i>=t.length&&this.throwError("Unexpected token "+String.fromCharCode(e));break}if(r===MA.COMMA_CODE){if(this.index++,i++,i!==t.length)if(e===MA.CPAREN_CODE)this.throwError("Unexpected token ,");else if(e===MA.CBRACK_CODE)for(let e=t.length;e<i;e++)t.push(null)}else if(t.length!==i&&0!==i)this.throwError("Expected comma");else{let e=this.gobbleExpression();(!e||e.type===MA.COMPOUND)&&this.throwError("Expected comma"),t.push(e)}}return n||this.throwError("Expected "+String.fromCharCode(e)),t}gobbleGroup(){this.index++;let e=this.gobbleExpressions(MA.CPAREN_CODE);if(this.code===MA.CPAREN_CODE)return this.index++,1===e.length?e[0]:!!e.length&&{type:MA.SEQUENCE_EXP,expressions:e};this.throwError("Unclosed (")}gobbleArray(){return this.index++,{type:MA.ARRAY_EXP,elements:this.gobbleArguments(MA.CBRACK_CODE)}}},TA=new class{add(e,t,n){if("string"!=typeof arguments[0])for(let i in arguments[0])this.add(i,arguments[0][i],arguments[1]);else(Array.isArray(e)?e:[e]).forEach((function(e){this[e]=this[e]||[],t&&this[e][n?"unshift":"push"](t)}),this)}run(e,t){this[e]=this[e]||[],this[e].forEach((function(e){e.call(t&&t.context?t.context:t,t)}))}};Object.assign(MA,{hooks:TA,plugins:new class{constructor(e){this.jsep=e,this.registered={}}register(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];t.forEach((e=>{if("object"!=typeof e||!e.name||!e.init)throw new Error("Invalid JSEP plugin format");this.registered[e.name]||(e.init(this.jsep),this.registered[e.name]=e)}))}}(MA),COMPOUND:"Compound",SEQUENCE_EXP:"SequenceExpression",IDENTIFIER:"Identifier",MEMBER_EXP:"MemberExpression",LITERAL:"Literal",THIS_EXP:"ThisExpression",CALL_EXP:"CallExpression",UNARY_EXP:"UnaryExpression",BINARY_EXP:"BinaryExpression",ARRAY_EXP:"ArrayExpression",TAB_CODE:9,LF_CODE:10,CR_CODE:13,SPACE_CODE:32,PERIOD_CODE:46,COMMA_CODE:44,SQUOTE_CODE:39,DQUOTE_CODE:34,OPAREN_CODE:40,CPAREN_CODE:41,OBRACK_CODE:91,CBRACK_CODE:93,QUMARK_CODE:63,SEMCOL_CODE:59,COLON_CODE:58,unary_ops:{"-":1,"!":1,"~":1,"+":1},binary_ops:{"||":1,"&&":2,"|":3,"^":4,"&":5,"==":6,"!=":6,"===":6,"!==":6,"<":7,">":7,"<=":7,">=":7,"<<":8,">>":8,">>>":8,"+":9,"-":9,"*":10,"/":10,"%":10},right_associative:new Set,additional_identifier_chars:new Set(["$","_"]),literals:{true:!0,false:!1,null:null},this_str:"this"}),MA.max_unop_len=MA.getMaxKeyLen(MA.unary_ops),MA.max_binop_len=MA.getMaxKeyLen(MA.binary_ops);var PA=e=>new MA(e).parse();Object.getOwnPropertyNames(MA).forEach((e=>{void 0===PA[e]&&"prototype"!==e&&(PA[e]=MA[e])})),PA.Jsep=MA;var DA={name:"ternary",init(e){e.hooks.add("after-expression",(function(t){if(t.node&&this.code===e.QUMARK_CODE){this.index++;let n=t.node,i=this.gobbleExpression();if(i||this.throwError("Expected expression"),this.gobbleSpaces(),this.code===e.COLON_CODE){this.index++;let r=this.gobbleExpression();if(r||this.throwError("Expected expression"),t.node={type:"ConditionalExpression",test:n,consequent:i,alternate:r},n.operator&&e.binary_ops[n.operator]<=.9){let i=n;for(;i.right.operator&&e.binary_ops[i.right.operator]<=.9;)i=i.right;t.node.test=i.right,i.right=t.node,t.node=n}}else this.throwError("Expected :")}}))}};function OA(e){return{all:e=e||new Map,on:function(t,n){var i=e.get(t);i?i.push(n):e.set(t,[n])},off:function(t,n){var i=e.get(t);i&&(n?i.splice(i.indexOf(n)>>>0,1):e.set(t,[]))},emit:function(t,n){var i=e.get(t);i&&i.slice().map((function(e){e(n)})),(i=e.get("*"))&&i.slice().map((function(e){e(t,n)}))}}}PA.plugins.register(DA);var IA=class{constructor(e,t,n){var i;this.id=e,this.userAPI=t,this.result=void 0,this.error="null",this.isPrefetched=!1,this.isLoading=!1,this.isLoaded=!1,this.prefetchPromise=new Promise((e=>e())),this.emitter=OA(),this._innerCallUserAPI=async e=>{this.emitter.emit("start",{userAPIId:this.id}),this.isLoading=!0,this.isLoading=!1;try{this.result=await async function(e,t){var n,i,r,s,a;let o,l,c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new AbortController,h=e.url,u=null!==(n=null===(i=e.proxy)||void 0===i?void 0:i.enabled)&&void 0!==n&&n;if("OpenAI"===(null===(r=e.integration)||void 0===r?void 0:r.type)){let n=LA(""===e.integration.prompt?[]:JSON.parse(e.integration.prompt),t),i=""===e.integration.behavior?[]:LA(JSON.parse(e.integration.behavior),t);l='{\n\t\t"model": "'.concat(e.integration.model,'",\n\t\t"messages": [').concat(e.integration.useBehavior?'\n\t\t{\n\t\t\t"role": "system",\n\t\t\t"content": "'.concat(i,'"\n\t\t},'):"",'\n\t\t{\n\t\t\t"role": "user",\n\t\t\t"content": "').concat(n,'"\n\t\t}\n\t\t]\n\t}')}if(u){let n;h="".concat("https://apis.spline.design/","file/").concat(e.proxy.fileId,"/external-api/request?uuidexternalapi=").concat(e.proxy.proxyId),void 0!==l?n=l:"POST"===e.method&&e.body&&(n=LA(JSON.parse(e.body),t)),void 0!==n&&(h+="&data=".concat(encodeURIComponent(n.replace(/(\r\n|\n|\r|\t)/gm,""))))}else"OpenAI"===(null===(s=e.integration)||void 0===s?void 0:s.type)?o=l:"POST"===e.method&&e.body&&(o=LA(JSON.parse(e.body),t));let d=await fetch(h,{method:u?"GET":e.method,headers:u?void 0:RA(e),signal:c.signal,body:o});if(!d.ok)throw new Error("status:"+d.status+"_:_"+d.statusText);if("OpenAI"===(null===(a=e.integration)||void 0===a?void 0:a.type)){let e=await d.json();return u&&(e=e.response),{content:e.choices[0].message.content}}{let e=await d.json();return u&&(e=e.response),e}}(this.userAPI,e),this.error="null",this.emitter.emit("success",{userAPIId:this.id})}catch(t){var n,i;let r=null!==(n=null===(i=t.message)||void 0===i||null===(i=i.split("_:_"))||void 0===i||null===(i=i[0])||void 0===i?void 0:i.replace("status:",""))&&void 0!==n?n:"null";this.error=r,this.result=null,this.emitter.emit("error",{userAPIId:this.id})}this.isLoading=!1,this.isPrefetched=!0,this.isLoaded=!0},"OpenAI"===(null===t||void 0===t||null===(i=t.integration)||void 0===i?void 0:i.type)?this.result={content:""}:"GET"===t.method&&""!==t.url&&(this.prefetchPromise=this.prefetch(n)),this._debouncedCallUserAPI=this._innerCallUserAPI,this._updateDebouncedCallUserAPI(),this._debouncedPrefetch=hm(this.prefetch,1e3,{trailing:!0})}_updateDebouncedCallUserAPI(){this._debouncedCallUserAPI=void 0!==this.userAPI.debounce&&this.userAPI.debounce>0?hm(this._innerCallUserAPI,this.userAPI.debounce,{leading:!0,trailing:!0}):this._innerCallUserAPI}async prefetch(e){await this.callUserAPI(e)}async callUserAPI(e){await this._debouncedCallUserAPI(e)}update(e,t){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this.userAPI=e,this._updateDebouncedCallUserAPI(),""!==this.userAPI.url&&"GET"===this.userAPI.method&&n&&this._debouncedPrefetch(t)}retrieveValue(e){if(this.result)try{return Ug.zoom(this.result,e)}catch(LZ){console.error(LZ)}}retrieveZoomedKeyValues(e){if(this.result){let t=e&&e.length?Ug.zoom(this.result,e):this.result;if(function(e){return"object"==typeof e&&null!==e}(t))return Object.entries(t);if(function(e){return Array.isArray(e)}(t))return t.map(((e,t)=>[t.toString(),e]));throw function(e){return"string"==typeof e||"number"==typeof e||"boolean"==typeof e||null===e}(t)?new Error("This path points to a value, use retrieveValue() instead. "+(null===e||void 0===e?void 0:e.join("."))):new Error("Path error"+(null===e||void 0===e?void 0:e.join(".")))}}dispose(){}on(e,t){this.emitter.on(e,t)}off(e,t){this.emitter.off(e,t)}get autostart(){return this.userAPI.autoStart}};function RA(e){let t=new Headers;return e.headers.forEach((e=>{""!==e.data.key&&t.append(e.data.key,e.data.value)})),t}var kA=(e,t)=>{if("string"==typeof e){let n=t.getVariable(e);if(n)return kA(n,t)}return yx.isBoolean(e)?yx.getDisplayedValue(e).toLowerCase():yx.getDisplayedValue(e)},LA=(e,t)=>e.map(((e,n)=>{if("text"in e)return e.text;if("type"in e){if("paragraph"===e.type)return(n>0?"\n":"")+LA(e.children,t);if("variable"===e.type){let n=t.getVariable(e.variableId);if(void 0!==n)return kA(n,t)}}return""})).join(""),BA=["+","-","*","/","(",")","==","!=",">","<",">=","<=","and","or","!","%","^",","],zA=["0","1","2","3","4","5","6","7","8","9","."],NA=["sin","cos","tan","asin","acos","atan","atan2","sqrt","abs","log","exp","floor","ceil","round","min","max","random"];function FA(e){return"string"==typeof e&&(!isNaN(e)&&!isNaN(parseFloat(e)))}function UA(e,t){let n,i,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"number",s="";for(let o=0;o<e.length;o++){let n=e[o];if("objType"in n&&"api"===n.objType){let e=JSON.parse(n.id),i=e[0],r=t.getUserAPI(i);if(void 0!==r&&r instanceof IA){let t=r.retrieveValue(e.slice(1));void 0!==t&&(s+=t)}}else if("objType"in n&&"webhook"===n.objType){let e=JSON.parse(n.id),[i,r]=e,a=t.getUserWebhook(i);if(void 0!==a){let e=a.getParameterValue(r);void 0!==e&&(s+=e)}}else if("objType"in n&&"aiAssistant"===n.objType){var a;let e=t.openAIRealtime;if("objId"in n&&void 0!==n.objId){let i;if(t.scene.data.objects.traverse(((e,t)=>{var r;let s=null===(r=t.events)||void 0===r?void 0:r.find((e=>e.id===n.objId));s&&(i=s)})),void 0!==i&&"AIAssistantListener"===i.data.type){let t=null===e||void 0===e?void 0:e.computeAnalysisForListenerEvent(i.data);if(void 0!==t){s+=t;continue}}}s+=null!==(a=null===e||void 0===e?void 0:e.voice)&&void 0!==a?a:0}else if("id"in n){let i=e[o-1];if(o>0&&"id"in i)return void console.error("Two variables in a row",e);let a=t.getVariable(n.id),l=yx.getDisplayedValue(a);"number"===r&&yx.isTextValue(a)&&Array.isArray(a.textValue)&&1===a.textValue.length?l=parseFloat(l).toString():"boolean"===r&&yx.isBoolean(a)?l=a?"true":"false":"boolean"===r&&yx.isTextValue(a)&&!Array.isArray(a.textValue)&&(l='"'+l+'"'),s+=l}else"string"!==r?"and"!==n.name?"or"!==n.name?"True"!==n.name?"False"!==n.name?"boolean"!==r||FA(n.name)||zA.includes(n.name)||BA.includes(n.name)||NA.includes(n.name.replace(/\($/g,""))?s+=n.name:s+='"'+n.name+'"':s+="false":s+="true":s+="||":s+="&&":('"'!==n.name&&("+"!==n.name||n.escaped)&&(s+=n.name),"+"===n.name&&!n.escaped&&"\\"===s[s.length-1]&&(s=s.slice(0,-1)+n.name))}if("string"===r)return s;if(0===e.length){if("number"===r)return 0;if("boolean"===r)return!1}try{n=PA(s)}catch(UZ){return void console.error(s,UZ)}try{i=jA(n)}catch(UZ){console.error(s,n,UZ)}return i}function jA(e){switch(e.type){case"BinaryExpression":switch(e.operator){case"==":return Number(jA(e.left)===jA(e.right));case"!=":return Number(jA(e.left)!==jA(e.right));case">":return Number(jA(e.left)>jA(e.right));case">=":return Number(jA(e.left)>=jA(e.right));case"<":return Number(jA(e.left)<jA(e.right));case"<=":return Number(jA(e.left)<=jA(e.right));case"+":return jA(e.left)+jA(e.right);case"-":return jA(e.left)-jA(e.right);case"*":return jA(e.left)*jA(e.right);case"/":return jA(e.left)/jA(e.right);case"%":return jA(e.left)%jA(e.right);case"&&":return jA(e.left)&&jA(e.right);case"||":return jA(e.left)||jA(e.right);case"^":return Math.pow(jA(e.left),jA(e.right));default:throw new Error("Unknown operator: "+e.operator)}case"UnaryExpression":switch(e.operator){case"-":return-jA(e.argument);case"!":return Number(!jA(e.argument));default:throw new Error("Unknown operator: "+e.operator)}case"Identifier":throw new Error("Unknown identifier: "+e.name);case"Literal":return e.value;case"CallExpression":if("Identifier"===e.callee.type){if("random"===e.callee.name){let t=0,n=1;if(e.arguments.length>=1)try{t=jA(e.arguments[0])}catch(zZ){console.warn(zZ)}if(e.arguments.length>=2)try{n=jA(e.arguments[1])}catch(zZ){console.warn(zZ)}return t=Math.min(n,t),n=Math.max(n,t),t+Math.random()*(n-t)}return Math[e.callee.name].apply(null,e.arguments.map(jA))}throw new Error("Unknown node");default:throw new Error("Unknown node type: "+e.type)}}PA.addBinaryOp("^",11,!0);var VA=new pn,GA=new pn;var HA=class extends di{constructor(e){super(),this.type="PathExtrusionGeometry",this.inputs=e,this.build()}_isGeometryClosed(){return this.inputs.path.isClosed&&1===this.inputs.parameters.extrusion.depth}_isOpenEnded(){let e=this.inputs.parameters.extrusion;return!(this.inputs.path.isClosed&&1===e.depth)||!function(e,t){let n=2*Math.PI;return(e%n+n)%n===(t%n+n)%n}(e.twist,0)||e.startScale!==e.endScale}build(){let e=this._extractPathPoints();if(e.length<2)return;let t=this._computeBasisMatrices(e),{depth:n,offset:i}=this.inputs.parameters.extrusion;n=Math.max(0,Math.min(n,1)),i=Math.max(0,Math.min(i,1));let r=this.inputs.path.isClosed?e.length:e.length-1,s=Math.floor(i*r),a=this.inputs.path.isClosed?Math.ceil((n+i)*r):Math.ceil(Math.min(1,n+i)*r),o=Math.min(Math.max(2,a-s+1),r+2),l=[],c=[];for(let k=0;k<o;k++){let n=this.inputs.path.isClosed?(k+s)%e.length:Math.min(k+s,e.length-1);l.push(e[n].clone()),c.push(t[n].clone())}let h=(e,t,n)=>{l[e]=l[e].clone().lerp(l[t],n),c[e]=function(e,t,n){let i=[new Bt,new Bt,new Bt],r=[new Bt,new Bt,new Bt];return e.extractBasis(i[0],i[1],i[2]),t.extractBasis(r[0],r[1],r[2]),i.forEach(((e,t)=>{let i=r[t],s=at.lerp(e.length(),i.length(),n);e.lerp(i,n).setLength(s)})),(new pn).makeBasis(i[0],i[1],i[2])}(c[e],c[t],n)},u=0,d=i*r%1;(!this.inputs.path.isClosed||n<=1)&&(d||0===i)&&(u=d,h(0,1,u));let p=0,f=(i+n)*r%1;if((this.inputs.path.isClosed&&n<=1||!this.inputs.path.isClosed&&i+n<1)&&f&&(p=f,h(l.length-1,l.length-2,1-p)),0===n){let e=l.length-1;l[e].copy(l[0]),c[e].copy(c[0])}this._applyPathModifiers(c,u,p);let{bevel:m,bevelSides:g}=this.inputs.parameters.extrusion,v=m>0?this.inputs.parameters.extrusion.capType:"flat",y=5;"Custom"===this.inputs.parameters.extrusion.shape.type&&(y="low"===this.inputs.parameters.extrusion.shape.shapeQuality?5:12);let b,{regions:x,infos:w,vertices:S}=this._computeShapePoints(y),_=0;"round"===v&&(b=new zE(this.inputs.shapeData,2*m,m,y,g,void 0,!0),_=b.getAttribute("position").count);let E=0,A=0;w.sort(((e,t)=>e.start-t.start)),w.forEach((e=>{e.verticesStart=E,e.verticesCount=e.continuous.reduce(((e,t,n)=>e+(0!==n&&t?1:2)),0),A+=e.verticesCount,E=A}));let C,M=A*o,T=0;if(this._isOpenEnded()&&"flat"===v){try{C=CE({windingRule:J_.ODD,elementType:$_.POLYGONS,polySize:3,vertexSize:2,strict:!0,contours:x})}catch(R){C=LE}T=C.vertexCount}let P=M+2*T+2*_,D=M+2*T,O={positions:new Float32Array(3*P),normals:new Float32Array(3*P),uvs:new Float32Array(2*P)},I=[];if(w.forEach((e=>{this._extrudeRegion(e,S,c,l,O,I,this._isGeometryClosed()&&!this._isOpenEnded())})),C&&(this._closeEnd(C,M,I,O,c[0],l[0],!1),this._closeEnd(C,M+T,I,O,c[c.length-1],l[l.length-1],!0)),b){O.positions.set(b.getAttribute("position").array,3*D),O.normals.set(b.getAttribute("normal").array,3*D),O.uvs.set(b.getAttribute("uv").array,2*D);for(let i=D;i<D+_;i++)O.uvs[2*i+1]=1e-4;let e=I.length;I.push(...b.getIndex().array.map((e=>e+D))),D+=_,O.positions.set(b.getAttribute("position").array,3*D),O.normals.set(b.getAttribute("normal").array,3*D),O.uvs.set(b.getAttribute("uv").array,2*D);let t=I.length;I.push(...b.getIndex().array.map((e=>e+D))),this.setAttribute("position",new ti(O.positions,3)),this.setAttribute("normal",new ti(O.normals,3)),this.setAttribute("uv",new ti(O.uvs,2)),this.setIndex(I);let n=VA;n.copy(c[c.length-1]).setPosition(l[l.length-1]),this.applyMatrix4OnRange(n,D,P),n.copy(c[0]).setPosition(l[0]).multiply(GA.makeScale(1,1,-1)),this.applyMatrix4OnRange(n,D-_,D),this.reverseIndicesOnRange(e,t)}else this.setAttribute("position",new ti(O.positions,3)),this.setAttribute("normal",new ti(O.normals,3)),this.setAttribute("uv",new ti(O.uvs,2)),this.setIndex(I)}_extractPathPoints(){let e=h_(this.inputs.path).getPoints(this.inputs.path.subdivisions);if(e.length<2)return[];let t=[e[0]];return e.forEach((e=>{t[t.length-1].distanceToSquared(e)>.001&&t.push(e)})),this.inputs.path.isClosed&&t[t.length-1].distanceTo(t[0])<.001&&t.pop(),t}_computeBasisMatrices(e){let t=[],n=e.length,i=this.inputs.path.isClosed,r=new Bt,s=new Bt,a=new Bt,o=new Bt,l=new Bt(0,1,0);for(let f=0;f<n;f++){let c,h,u=e[f];c=0===f?i?e[e.length-2]:u.clone().multiplyScalar(2).sub(e[1]):e[f-1],h=f===n-1?i?e[1]:u.clone().multiplyScalar(2).sub(e[f-1]):e[f+1];let d=u.clone().sub(c).normalize(),p=h.clone().sub(u).normalize(),m=d.clone().add(p).normalize();a.copy(m),0===f&&(m.equals(l)||m.clone().negate().equals(l))&&l.set(0,0,1);let g=l.clone().cross(m).normalize(),v=m.clone().cross(g).normalize();l.copy(v),o.copy(g),0===f&&(r.copy(v),s.copy(m));let y=(new pn).makeBasis(g,v,m);t.push(y)}let c=i?s:a,h=i?r:new Bt(0,1,0),u=c.clone().cross(o).normalize(),d=Math.acos(h.dot(u));if(isNaN(d))return t;let p=h.clone().cross(u);c.dot(p)>0&&(d*=-1);for(let f=1;f<t.length;f++){let e=(new pn).makeRotationZ(d*f/t.length);t[f].multiply(e)}return t}_applyPathModifiers(e,t,n){let i=e.length,{angle:r,twist:s,startScale:a,endScale:o}=this.inputs.parameters.extrusion,l=new pn,c=new pn;return e.forEach(((e,h)=>{let u=0===h?0:h===i-1?1:(h-t)/(i-(0===n?0:1)-(t+(1-n)));l.makeRotationZ(at.lerp(r,r+s,u)*at.DEG2RAD);let d=at.lerp(a,o,u);c.makeScale(d,d,d),e.multiply(l).multiply(c)})),e}_computeShapePoints(){let e,t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:12,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:J_.ODD,r=this.inputs.shapeData,s=r.extractShapePointsToFlatArray([],n),a=r.shapeHoles.map((e=>{let t=e.extractShapePointsToFlatArray([],n),i=[];for(let n=t.length-1;n>=1;n-=2){let e=t[n-1],r=t[n-0];i.push(e,r)}return i}));try{e=CE({windingRule:i,elementType:$_.BOUNDARY_CONTOURS,vertexSize:2,strict:!0,contours:[s]})}catch(p){e=RE}try{t=CE({windingRule:J_.ODD,elementType:$_.BOUNDARY_CONTOURS,vertexSize:2,strict:!0,contours:[...a]})}catch(f){t=kE}if(!e)throw new Error("error generating geometry");let o=e.elementCount;if(t){e.elementCount+=t.elementCount;for(let n=0;n<t.elements.length;n++){let i=t.elements[n],r=n%2===0?e.vertexCount:0;e.elements.push(i+r)}for(let n=0;n<t.vertexIndices.length;n++){let i=t.vertexIndices[n],r=e.vertexCount;e.vertexIndices.push(i+r)}for(let n=0;n<t.vertices.length;n++){let i=t.vertices[n];e.vertices.push(i)}}let l=1/0,c=-1/0,h=1/0,u=-1/0;for(let m=0,g=e.vertexCount;m<g;m++){let t=2*m,n=e.vertices[t+0],i=e.vertices[t+1];n<l&&(l=n),n>c&&(c=n),i<h&&(h=i),i>u&&(u=i)}let d=[];for(let m=e.elementCount-1;m>=0;m--){let t=m>=o,n=2*m,i=e.elements[n+0],s=e.elements[n+1],a=i+s,l={start:i,count:s,normals:[],isHole:t,continuous:[],verticesStart:0,verticesCount:0};d.push(l);let c=i,h=a-1,u=i+1,p=r.roundedCurves.length;do{let n=c-i,o=e.vertices[2*h+0],d=e.vertices[2*h+1],f=e.vertices[2*c+0],m=e.vertices[2*c+1],g=e.vertices[2*u+0],v=e.vertices[2*u+1],y=f-o,b=m-d,x=Math.sqrt(y*y+b*b);y/=x,b/=x;let w=f-g,S=m-v,_=Math.sqrt(w*w+S*S);w/=_,S/=_,l.normals[2*n+0]=-S,l.normals[2*n+1]=w;let E=e.vertexIndices[c];if(Array.isArray(E))l.continuous[n]=!1;else{let[e,t]=r.getCurveIndexFromVertexId(E-1,!0);if(t>0&&t<1)l.continuous[n]=!0;else{let i=1===t?e+1:e-1;i=(i+p)%p;let s=1===t?0:1,a=r.roundedCurves[e].getTangent(t),o=r.roundedCurves[i].getTangent(s);l.continuous[n]=a.dot(o)>.95}}t&&(l.normals[2*n+0]*=-1,l.normals[2*n+1]*=-1),[h,c,u]=[c,u,u+1],u>=a&&(u-=s)}while(u!==i+1)}return{regions:[s,...a],infos:d,vertices:e.vertices}}_insertVertex(e,t,n,i,r){let s=2*t,a=3*t;e.positions[a+0]=n.x,e.positions[a+1]=n.y,e.positions[a+2]=n.z,e.normals[a+0]=i.x,e.normals[a+1]=i.y,e.normals[a+2]=i.z,e.uvs[s+0]=r.x,e.uvs[s+1]=r.y}_extrudeRegion(e,t,n,i,r,s,a){let o=new Bt,l=new Bt,c=new Bt,h=new Bt,u=new ot;n.forEach(((s,a)=>{let d=i[a],p=e.verticesStart*n.length+e.verticesCount*a;for(let i=0;i<e.count;i++){let f=2*(e.start+i);if(o.set(t[f+0],t[f+1],0),c.copy(o).applyMatrix4(s).add(d),e.continuous[i])h.set(e.normals[2*i+0],e.normals[2*i+1],0);else{let n=0===i?2*(e.start+e.count-1):f-2;l.set(t[n+0],t[n+1],0),h.copy(o).sub(l),h.set(-h.y,h.x,0),e.isHole||h.negate()}if(h.applyMatrix4(s).normalize(),u.set(0===i?1:i/e.count,a/(n.length-1)),this._insertVertex(r,p,c,h,u),p++,!e.continuous[i]||0===i){if(0===i)h.set(e.normals[2*i+0],e.normals[2*i+1],0),u.set(0,a/(n.length-1));else{let n=i===e.count-1?2*e.start:f+2;l.set(t[n+0],t[n+1],0),h.copy(l).sub(o),h.set(-h.y,h.x,0),e.isHole||h.negate()}h.applyMatrix4(s).normalize(),this._insertVertex(r,p,c,h,u),p++}}}));let d=n.length-1;for(let p=0;p<d;p++){let t=e.verticesStart*n.length+e.verticesCount*p,i=e.verticesStart*n.length+e.verticesCount*(p+1),r=0;for(let n=0;n<e.count;n++){(!e.continuous[n]||0===n)&&r++;let a=n===e.count-1?0:r+1,o=t+r,l=t+a,c=i+a,h=i+r;e.isHole?s.push(o,c,l,o,h,c):s.push(o,l,c,o,c,h),r++}}}_closeEnd(e,t,n,i,r,s,a){let o=e.vertexCount,l=new Bt(0,0,a?-1:1).applyMatrix4(r),c=new Bt,h=new ot;for(let d=0;d<o;d++){let n=2*d;c.set(e.vertices[n+0],e.vertices[n+1],0).applyMatrix4(r).add(s),this._insertVertex(i,t+d,c,l,h)}let u=e.elements;for(let d=0;d<e.elementCount;d++){let e=3*d,i=u[e+0]+t,r=u[e+(a?1:2)]+t,s=u[e+(a?2:1)]+t;n.push(i,r,s)}}applyMatrix4OnRange(e,t,n){let i,r,s,a,o=e.elements,l=(new lt).getNormalMatrix(e).elements,c=this.attributes.position,h=this.attributes.normal;if(!c||!h)return;let u=c.array,d=h.array,p=c.itemSize;for(let f=t*p,m=n*p;f<m;f+=p)i=u[f+0],r=u[f+1],s=u[f+2],a=1/(o[3]*i+o[7]*r+o[11]*s+o[15]),u[f+0]=(o[0]*i+o[4]*r+o[8]*s+o[12])*a,u[f+1]=(o[1]*i+o[5]*r+o[9]*s+o[13])*a,u[f+2]=(o[2]*i+o[6]*r+o[10]*s+o[14])*a,i=d[f+0],r=d[f+1],s=d[f+2],d[f+0]=l[0]*i+l[3]*r+l[6]*s,d[f+1]=l[1]*i+l[4]*r+l[7]*s,d[f+2]=l[2]*i+l[5]*r+l[8]*s;c.needsUpdate=!0,h.needsUpdate=!0}reverseIndicesOnRange(e,t){let n=this.index;if(n){for(let i=e;i<t;i+=3){let e=n.getX(i),t=n.getX(i+1),r=n.getX(i+2);n.setXYZ(i,r,t,e)}n.needsUpdate=!0}}};function WA(){let e=new di;return e.setAttribute("position",new ti(new Float32Array([]),3)),e.setIndex(new ti(new Uint16Array([]),1)),e}var qA=WA().attributes,XA=class extends di{constructor(e,t){super(),this.charWidths=[],this.charCoords=[],this.wrappedText=[],this.isLowResolution=!1,this.vectorShapes=[],Object.assign(this.attributes,qA),this.userData={parameters:e,type:"TextGeometry"};let n=t.getFont(e.font);null!==n&&void 0!==n&&n.isLoaded?(this.font=n,this.update(e)):this.updateFont(e.font,t).then((()=>{this.update(e),null===t||void 0===t||t.requestRender()}))}async updateFont(e,t){let n=t.getFont(e);n&&(this.font=n,await n.loadingPromise)}update(e){let t=this.font;if(this.userData={parameters:e,type:"TextGeometry"},null===t||void 0===t||!t.isLoaded)return void console.warn("Cannot update text because its font is not loaded");let{width:n,height:i,depth:r,extrudeBevelSize:s,extrudeBevelSegments:a,text:o,textTransform:l}=e,c=yx.getDisplayedValue(o),h=function(e,t,n){let i=[""],r="";for(let s of n)r+=s," "===s||"\n"===s?(i[i.length-1]+=r,r="","\n"===s&&i.push("")):t.getTextWidth(i[i.length-1]+r,e)>e.width&&(i[i.length-1].length&&i.push(""),t.getTextWidth(i[i.length-1]+r,e)>e.width&&(1===r.length?(i[i.length-1]+=r,r=""):(i[i.length-1]+=r.slice(0,-1),r=r[r.length-1],i.push(""))));return i[i.length-1]+=r,i}(e,t,2===l?c.toUpperCase():3===l?c.toLowerCase():c),{shapes:u,charWidths:d,charCoords:p}=t.generateShapes(h,e),f=.5*("number"==typeof n?n:1),m=.5*("number"==typeof i?i:1),g=u.map((e=>(new aE).fromShape(e,!0)));this.vectorShapes=g;let v=g.map((e=>UE.create({shape:e,parameters:{depth:r,extrudeBevelSegments:a,extrudeBevelSize:s,windingRule:r<=0?J_.NONZERO:J_.ODD,subdivisions:this.isLowResolution&&r>0?1:12}}))),y=v.length?fw(v):WA();y.translate(-f,m,0),this.dispose(),this.wrappedText=h,this.charCoords=p,this.charWidths=d,this.deleteAttribute("extrudeNormal"),Object.entries(y.attributes).forEach((e=>{let[t,n]=e;this.setAttribute(t,n)})),this.setIndex(y.index),this.computeBoundingSphere()}clone(){let e=Tm(new di,XA.prototype);return e.copy(this),console.log("CloneGeometry",this,e),e}copy(e){return Object.entries(e.attributes).forEach((e=>{let[t,n]=e;this.setAttribute(t,n)})),this.setIndex(e.index),this.userData={parameters:o({},e.userData.parameters),type:"TextGeometry"},this}async setText(e){this.font&&await this.font.loadingPromise,await this.update(o(o({},this.userData.parameters),{},{text:{textValue:e}}))}get text(){var e;return null!==(e=this.userData.parameters.text)&&void 0!==e?e:""}};var YA,QA,KA=new Promise((e=>{YA=e})),ZA=!1;function JA(){if(!ZA)return QA||(QA=async function(){let e=n.e(917).then(n.bind(n,917)),[t,i]=await Promise.all([e,fetch("".concat("https://unpkg.com/@splinetool/modelling-wasm@1.9.63/build","/process.wasm")).then((e=>e.arrayBuffer()))]),r=t.default,s=await r({wasmBinary:i});YA(s),ZA=!0}(),QA)}var $A=["font"];function eC(e,t,n,i){let r,s,a;"PathGeometry"===e.type?(s=JSON.parse(JSON.stringify(e)),a=[[],["extrusion"]]):(s=o({},e),a=[[]]);for(let o of a){let e=s;for(let t of o)e=e[t];for(r in e){let n=e[r];ob(n)&&!$A.includes(r)&&(e[r]=t.getVariable(n,[i.uuid,"geometry",...o,r]),ob(e[r])&&(e[r]=1))}}let l,c={parameters:s,type:s.type};if("PathGeometry"===s.type)c.path=s.path;else if("VectorGeometry"===s.type){let e=aE.createFromState(s.shape,s.width,s.height);c.shape=e}else if("NonParametricGeometry"===s.type){var h;if(s.data.groups&&null!==(h=s.data.groups)&&void 0!==h&&h.forEach((e=>{var t;return e.materialIndex=Math.max(null!==(t=e.materialIndex)&&void 0!==t?t:0,0)})),c.geometry=(new Kl).parse(s),0===c.geometry.groups.length){var u,d;let e=c.geometry;e.addGroup(0,Math.max(null!==(u=null===(d=e.getIndex())||void 0===d?void 0:d.count)&&void 0!==u?u:0,e.getAttribute("position").count),0)}}else{if("SubdivGeometry"===s.type){let t=new cC(s,n);return t.data=e,t}if("TextGeometry"===s.type)return new XA(s,t);if("InputGeometry"===s.type)return new XA(s,t);if("UIGeometry"===s.type)return _A.create({parameters:{width:s.width,height:s.height,cornerRadius:s.cornerRadius,cornerType:s.cornerType}})}try{l=RC(c)}catch(VZ){console.error(VZ)}if(!l){let e=aE.createFromState(Mb.defaultData(),100,100);c.shape=e,l=RC(c)}return l}var tC=new pn;function nC(e,t,n,i){let r,s,a,o=e.position.array,l=e.normal.array,c=tC.makeScale(t,n,i).invert().elements;for(var h=0,u=o.length;h<u;h+=3)o[h]*=t,o[h+1]*=n,o[h+2]*=i,r=l[h],s=l[h+1],a=l[h+2],l[h]=c[0]*r+c[4]*s+c[8]*a,l[h+1]=c[1]*r+c[5]*s+c[9]*a,l[h+2]=c[2]*r+c[6]*s+c[10]*a;e.position.needsUpdate=!0,e.normal.needsUpdate=!0}var iC,rC=new Ft,sC=new Bt;KA.then((e=>{iC=e}));var aC=new Float32Array([10,10,0,-10,10,0,-10,-10,0,10,-10,0]),oC=new Uint32Array([0,1,2,3]),lC=new Uint8Array([4]),cC=class extends di{constructor(e,t){super(),this.data=e,this.flatShading=t,this.subdivPointer=0,this.rebuild(),this.freeSubdivPointer()}mutateDirectlyScaleBaked(e,t){this.freeSubdivPointer();let n=this.data.scaleBaked,i=Hy.div(t,n);this.subdividedGeometry&&nC(this.subdividedGeometry.attributes,...i),this.originalGeometry&&nC(this.originalGeometry.attributes,...i),this.data=e;let r=this.userData.parameters;this.userData.parameters={width:r.width*i[0],height:r.height*i[1],depth:r.depth*i[2]},this.originalGeometry.boundingSphere.center.multiply(sC.fromArray(i));let s=sC.set(r.width,r.height,r.depth).length();this.originalGeometry.boundingSphere.radius=s/2}ensureSubdivPointer(){return 0===this.subdivPointer&&this.rebuild(),this.subdivPointer}rebuild(){var e;let t,n,i;try{({originalGeometry:t,subdividedGeometry:n,subdivPointer:i}=cC.build(this.data,void 0,!this.flatShading,void 0))}catch(s){t=new Ti(100,100,100),i=0}this.subdivPointer=i,this.originalGeometry=t,this.subdividedGeometry=null!==n&&void 0!==n?n:void 0;let r=null!==(e=this.subdividedGeometry)&&void 0!==e?e:this.originalGeometry;Object.assign(this,r),this.calcBoundingBox()}freeSubdivPointer(){this.subdivPointer&&(cC.freeSubdivPointer(this.subdivPointer),this.subdivPointer=0)}dispose(){super.dispose(),this.freeSubdivPointer()}calcBoundingBox(){let e=this.originalGeometry;null===e.boundingSphere&&(e.boundingSphere=new rn,this.subdividedGeometry&&(this.subdividedGeometry.boundingSphere=e.boundingSphere));let t=e.attributes.position,n=e.boundingSphere.center;rC.setFromBufferAttribute(t),rC.getCenter(n),e.boundingSphere.radius=n.distanceTo(rC.max),isNaN(e.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this),rC.getSize(sC);let i={width:sC.x,height:sC.y,depth:sC.z};return this.userData.parameters=i,i}static build(e,t,n,i){var r;let s,a,o,l=null!==(r=null===e||void 0===e?void 0:e.phongAngle)&&void 0!==r?r:35;!1===n&&(l=-1),t&&(iC.free_bvh(t),iC.free_subdivision_surface(t));try{s=cC.allocate(e,i)}catch(HZ){console.error(HZ,e),s=cC.allocate({positionWASM:aC,indexWASM:oC,verticesPerFaceWASM:lC},i)}if(iC.set_destination_refinement_level(s,0),a=cC.buildLevel(s,!0,l),e.subdivisions>0)try{iC.set_destination_refinement_level(s,e.subdivisions),o=cC.buildLevel(s,!1,l)}catch(c){try{iC.set_destination_refinement_level(s,e.subdivisions-1),o=cC.buildLevel(s,!1,l)}catch(h){o=null}}else o=null;return{subdivPointer:s,originalGeometry:a,subdividedGeometry:o}}static primitiveToQuads(e,t,n){e.widthSegments>16&&(e.widthSegments=16),e.heightSegments>16&&(e.heightSegments=16),e.depthSegments>16&&(e.depthSegments=16),e.radialSegments>16&&(e.radialSegments=16),"DodecahedronGeometry"===e.type&&(e.detail=0);let i,r,s,a,o,l,c=void 0!==e.shape||void 0!==e.path?t.geometry:eC(e,n,!1);if(i="TorusGeometry"===e.type&&e.arc===2*Math.PI?c.getClosedTorusIndicesForBooleanOrSubdiv():c.getIndex(),({positions:r,triIndices:o}=uC(c.getAttribute("position"),i)),"CylinderGeometry"===e.type&&0===e.cornerRadius&&0===e.hollow&&!1===e.openEnded){let t=e.radialSegments*e.heightSegments*3*2;l=[t,t+3*e.radialSegments]}return({indices:s,verticesPerFace:a}=gC(r,o,c,l)),{positions:r,indices:s,verticesPerFace:a}}static allocate(e,t){var n;let i,r,s,a=[],o=[];e.positionWASM&&e.positionWASM.length>0?(i=e.positionWASM,r=e.indexWASM,s=e.verticesPerFaceWASM):(i=aC,r=oC,s=lC);let l,c=i.length,h=r.length,u=s.length,d=i.length+a.length+o.length,p=r.length+s.length,f=d*Float32Array.BYTES_PER_ELEMENT+p*Uint32Array.BYTES_PER_ELEMENT,m=d*Float32Array.BYTES_PER_ELEMENT,g=(Uint32Array.BYTES_PER_ELEMENT,iC._malloc(f)),v=new Float32Array(iC.HEAPF32.buffer,g,d),y=new Uint32Array(iC.HEAPU32.buffer,g+m,p);v.set(i,0),v.set(a,i.length),v.set(o,i.length+a.length),y.set(r,0),y.set(s,r.length),null!==e&&void 0!==e&&null!==(n=e.scaleBaked)&&void 0!==n&&n.some((e=>1!==e))&&(l=(new pn).makeScale(...e.scaleBaked)),t&&(l?l.premultiply(t):l=t);let b=l?iC.alloc_subdivision_surface2(g,c,g+m,h,g+m+r.length*Uint32Array.BYTES_PER_ELEMENT,u,l.elements):iC.alloc_subdivision_surface(g,c,g+m,h,g+m+r.length*Uint32Array.BYTES_PER_ELEMENT,u);return iC._free(g),b}static buildLevel(e,t,n,i,r){let s=r?iC.get_mesh_data2(e,t?iC.Level.CONTROL:iC.Level.REFINED,n,r.elements):iC.get_mesh_data(e,t?iC.Level.CONTROL:iC.Level.REFINED,n),a=iC.HEAPU32.subarray(s>>2,8+(s>>2)),o=a.subarray(4,8),l=0,c=iC.HEAPU32[a[l]>>2],h=iC.HEAPF32.subarray(c>>2,(c>>2)+o[l]);l++;let u=iC.HEAPU32[a[l]>>2],d=iC.HEAPF32.subarray(u>>2,(u>>2)+o[l]);l++;let p=iC.HEAPU32[a[l]>>2],f=iC.HEAPU32.subarray(p>>2,(p>>2)+o[l]);l++;let m=iC.HEAPU32[a[l]>>2],g=iC.HEAPU32.subarray(m>>2,(m>>2)+o[l]);if(l++,void 0===i){let e=new di;if(e.setIndex(new ii(g,1)),e.setAttribute("position",new ri(h,3)),e.setAttribute("normal",new ri(d,3)),t){e.setAttribute("faceMap",new ii(f,1));let t=new Float32Array(d.length/3*4).fill(0);e.setAttribute("color",new ti(t,4))}return iC.free_mesh_data(s),e.userData.type="SubdivGeometry",e}i.getAttribute("position").copyArray(h),i.getAttribute("normal").copyArray(d),i.attributes.position.needsUpdate=!0,i.attributes.normal.needsUpdate=!0,iC.free_mesh_data(s)}static freeSubdivPointer(e){iC.free_bvh(e),iC.free_subdivision_surface(e)}static buildControlCageWireframe(e,t,n){let i=iC.get_wireframe_data_for_base_level(e),r=iC.HEAPU32.subarray(i>>2,4+(i>>2)),s=r.subarray(2,4),a=0,o=iC.HEAPU32[r[a]>>2],l=iC.HEAPF32.subarray(o>>2,(o>>2)+s[a]);a++;let c=iC.HEAPU32[r[a]>>2],h=iC.HEAPU32.subarray(c>>2,(c>>2)+s[a]);if(void 0===t){let e=new di;e.setAttribute("position",new ri(l,3));let t=new Float32Array(l.length);for(let i=0,r=l.length;i<r;)t[i++]=n.r,t[i++]=n.g,t[i++]=n.b;return e.setAttribute("color",new ti(t,3)),e.setIndex(new ii(h,1)),iC.free_wireframe_data_for_base_level(i),e}t.getAttribute("position").copyArray(l),t.attributes.position.needsUpdate=!0,iC.free_wireframe_data_for_base_level(i)}static updateCollabMesh(e,t,n){let i=0===t;i||iC.set_destination_refinement_level(e,t);let r=n?iC.get_topological_data2(e,i?iC.Level.CONTROL:iC.Level.REFINED,n.elements):iC.get_topological_data(e,i?iC.Level.CONTROL:iC.Level.REFINED),s=iC.HEAPU32.subarray(r>>2,6+(r>>2)),a=s.subarray(3,6),o=0,l=iC.HEAPU32[s[o]>>2],c=new Float32Array(iC.HEAPF32.subarray(l>>2,(l>>2)+a[o]));o++;let h=iC.HEAPU32[s[o]>>2],u=new Uint32Array(iC.HEAPU32.subarray(h>>2,(h>>2)+a[o]));o++;let d=iC.HEAPU32[s[o]>>2],p=new Uint8Array(iC.HEAPU32.subarray(d>>2,(d>>2)+a[o]));return iC.free_topological_data(r),{positions:c,indices:u,verticesPerFace:p}}},hC=["getX","getY","getZ"];function uC(e,t){let n={},i=t?t.count:e.count,r=0,s=[],a=[];for(let l=0;l<i;l++){let i=t?t.getX(l):l,o="";for(let t=0;t<3;t++)o+="".concat(~~(1e4*e[hC[t]](i)),",");if(o in n)s.push(n[o]);else{for(let t=0;t<3;t++)a.push(e[hC[t]](i));n[o]=r,s.push(r),r++}}let o=[];for(let l=0;l<s.length;l+=3)s[l]===s[l+1]||s[l]===s[l+2]||s[l+1]===s[l+2]||o.push(s[l],s[l+1],s[l+2]);return{positions:a,triIndices:o}}var dC=new Bt,pC=new Bt,fC=new Bt,mC=new Bt;function gC(e,t,n,i){let r=[],s=[];if(void 0!==n.userData.shape&&0===n.userData.parameters.depth&&0===n.userData.shape.shapeHoles.length){let t=n.userData.shape.extractShapePointsToFlatArray([]),i=n.userData.parameters.spikes;if("EllipseGeometry"===n.userData.type&&i<=24&&i%4===0&&n.userData.parameters.angle>=360){let e=t.length/2/i;t=t.filter(((t,n)=>Math.floor(n/2)%e===0))}let a=0;for(let e=0;e<t.length;e+=2)a+=(t[e]-t[(0===e?t.length:e)-2])*(t[e+1]+t[(0===e?t.length:e)-1]);e.length=0;let o=0;if(a<0)for(let n=0;n<t.length;n+=2)e.push(t[n],t[n+1],0),r.push(o++);else for(let n=t.length-2;n>=0;n-=2)e.push(t[n],t[n+1],0),r.push(o++);return s.push(o),{indices:r,verticesPerFace:s}}let a=new Float32Array([n.userData.parameters.depth])[0],o=0;for(;o<t.length;){if(n.useNgonForTopBottomFaceDuringBake){let n=0;if((e[3*t[o]+2]===a||0===e[3*t[o]+2])&&n++,(e[3*t[o+1]+2]===a||0===e[3*t[o+1]+2])&&n++,(e[3*t[o+2]+2]===a||0===e[3*t[o+2]+2])&&n++,3===n)break}if(t[o+1]===t[o+3]&&t[o+2]===t[o+5]||t[o+0]===t[o+3]&&t[o+2]===t[o+4]){dC.set(e[3*t[o]],e[3*t[o]+1],e[3*t[o]+2]),pC.set(e[3*t[o+1]],e[3*t[o+1]+1],e[3*t[o+1]+2]),fC.set(e[3*t[o+4]],e[3*t[o+4]+1],e[3*t[o+4]+2]),mC.set(e[3*t[o+5]],e[3*t[o+5]+1],e[3*t[o+5]+2]),pC.sub(dC).normalize(),fC.sub(dC).normalize(),mC.sub(dC).normalize();let n=pC.cross(fC).dot(mC);Math.abs(n)>.005||i&&i.some(((e,t)=>t%2!==1&&(o>=i[t]&&o<i[t+1])))?(r.push(t[o],t[o+1],t[o+2]),s.push(3),o+=3):(r.push(t[o],t[o+1],t[o+4],t[o+5]),s.push(4),o+=6)}else r.push(t[o],t[o+1],t[o+2]),s.push(3),o+=3}if(n.useNgonForTopBottomFaceDuringBake){let t=[],i=[],o=0;for(let n=0,r=0;n<e.length;n+=3,r++)0===e[n+2]&&(t.push(r),o++),e[n+2]===a&&i.push(r);if(0===n.userData.parameters.extrudeBevelSize){let e=i[0];i[0]=i[1],i[1]=e}t.reverse(),r.push(...t,...i),s.push(o,o)}return{indices:r,verticesPerFace:s}}var vC={};((e,t)=>{for(var n in t)b(e,n,{get:t[n],enumerable:!0})})(vC,{calcBoolean:()=>MC,calcBooleanTopological:()=>CC,freeMeshSet:()=>OC,getMeshSet:()=>TC,hasOpenEdges:()=>PC,transformMeshSet:()=>DC});var yC,bC,xC,wC,SC=new Promise((e=>{yC=e}));function _C(){if(bC)return bC;return bC=async function(){let e=n.e(516).then(n.bind(n,516)),[t,i]=await Promise.all([e,fetch("".concat("https://unpkg.com/@splinetool/boolean-wasm@1.9.63/build","/boolean.wasm")).then((e=>e.arrayBuffer()))]),r=t.default,s=await r({wasmBinary:i});yC(s)}(),bC}function EC(e){let t=e.length,n=t*Uint32Array.BYTES_PER_ELEMENT,i=t*Float32Array.BYTES_PER_ELEMENT,r=Number.isInteger(e[0])?n:i,s=xC._malloc(r);return(Number.isInteger(e[0])?new Uint32Array(xC.HEAPU32.buffer,s,t):new Float32Array(xC.HEAPF32.buffer,s,t)).set(e,0),s}function AC(e){switch(e){case 0:return xC.OP.UNION;case 1:return xC.OP.INTERSECTION;case 2:return xC.OP.A_MINUS_B;default:throw new Error("Unknown boolean operation "+e)}}function CC(e,t){void 0===wC&&(wC=xC.init_csg());let n=EC(e),i=xC.csg_calc_topological(wC,n,e.length,AC(t));xC._free(n);let r=xC.HEAPU32.subarray(i>>2,6+(i>>2)),s=r.subarray(3,6),a=0,o=xC.HEAPU32[r[a]>>2],l=new Float32Array(xC.HEAPF32.subarray(o>>2,(o>>2)+s[a]));a++;let c=xC.HEAPU32[r[a]>>2],h=new Uint32Array(xC.HEAPU32.subarray(c>>2,(c>>2)+s[a]));a++;let u=xC.HEAPU32[r[a]>>2],d=new Uint8Array(xC.HEAPU32.subarray(u>>2,(u>>2)+s[a]));return xC.free_mesh_data(i),{positions:l,indices:h,verticesPerFace:d}}function MC(e,t,n,i){void 0===wC&&(wC=xC.init_csg());let r=EC(e),s=xC.csg_calc(wC,r,e.length,i,AC(t));xC._free(r);let a=xC.HEAPU32.subarray(s>>2,5+(s>>2)),o=a.subarray(2,5),l=0,c=xC.HEAPU32[a[l]>>2],h=xC.HEAPF32.subarray(c>>2,(c>>2)+o[l]);l++;let u=xC.HEAPU32[a[l]>>2],d=xC.HEAPF32.subarray(u>>2,(u>>2)+o[l]);l++;let p=o[l];n.setAttribute("position",new ri(h,3)),n.setAttribute("normal",new ri(d,3));let f=xC.HEAPF32.subarray(5+(s>>2),5+(s>>2)+6);return null===n.boundingSphere&&(n.boundingSphere=new rn),n.boundingSphere.center.set(f[0],f[1],f[2]),n.boundingSphere.radius=(f[3]**2+f[4]**2+f[5]**2)**.5,n.userData.parameters={width:2*f[3],height:2*f[4],depth:2*f[5]},xC.free_mesh_data(s),p}function TC(e,t,n){if(void 0===xC)return-1;let i,r,s;if(t&&void 0!==e.userData.positions){let t=e.userData;s=t.verticesPerFace.length,i=t.positions,r=Array(t.verticesPerFace.reduce(((e,t)=>e+t),0)+s);for(let e=0,n=0,i=0;e<t.verticesPerFace.length;e++){r[i++]=t.verticesPerFace[e];for(let s=0;s<t.verticesPerFace[e];s++)r[i++]=t.indices[n++]}}else({positions:i,faceIndices:r,nFaces:s}=function(e,t,n){let i,r;r="TorusGeometry"===e.userData.parameters.type&&e.userData.parameters.arc===2*Math.PI?e.getClosedTorusIndicesForBooleanOrSubdiv():e.getIndex();let s,{positions:a,triIndices:o}=uC(e.getAttribute("position"),r);if(t&&n){let{indices:t,verticesPerFace:n}=gC(a,o,e);s=n.length,i=[];for(let e=0,r=0;e<s;e++){i.push(n[e]);for(let s=0;s<n[e];s++)i.push(t[r++])}}else{let e=o.length;i=Array(e+e/3),s=0;for(let t=0,n=0;n<i.length;)i[n++]=3,s++,i[n++]=o[t++],i[n++]=o[t++],i[n++]=o[t++]}return{positions:a,faceIndices:i,nFaces:s}}(e,t,n));let a=i.length,o=r.length,l=i.length,c=r.length,h=l*Float32Array.BYTES_PER_ELEMENT+c*Uint32Array.BYTES_PER_ELEMENT,u=l*Float32Array.BYTES_PER_ELEMENT,d=(Uint32Array.BYTES_PER_ELEMENT,xC._malloc(h)),p=new Float32Array(xC.HEAPF32.buffer,d,l),f=new Uint32Array(xC.HEAPU32.buffer,d+u,c);p.set(i,0),f.set(r,0);let m=xC.get_csg_mesh(d,a,d+u,o,s);return xC._free(d),m}function PC(e){return xC.has_open_edges(e)}function DC(e,t){xC.transform_csg_mesh(e,t.elements)}function OC(e){xC.free_csg_mesh(e)}SC.then((e=>xC=e));var IC={ConeGeometry:class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){var n,i,r;let s=Object.assign({},null!==(n=null===t||void 0===t?void 0:t.parameters)&&void 0!==n?n:{width:100,radialSegments:32,heightSegments:8,openEnded:!1,thetaStart:0,thetaLength:360,cornerRadiusTop:8,cornerRadiusBottom:8,cornerSegments:8},e.parameters);return s.thetaLength=at.clamp(s.thetaLength,0,360),{parameters:Object.assign(s,{width:Math.abs(s.width),height:Math.abs(null!==(i=s.height)&&void 0!==i?i:s.width),depth:Math.abs(null!==(r=s.depth)&&void 0!==r?r:s.width)})}}static build(e){let t,{width:n,depth:i,height:r,radialSegments:s,heightSegments:a,openEnded:l,thetaStart:c,thetaLength:h,cornerRadiusTop:u,cornerRadiusBottom:d,cornerSegments:p}=e.parameters;return 0===h?(t=new di,t.setAttribute("position",new ri([],3))):t=u>0||d>0||h<360?new x_(0,n/2,r,s,a,l,c,h*Math.PI/180,u,d,p,0,!0):new So(n/2,r,s,a,l),t.scale(1,1,i/n),Object.assign(t,{userData:o(o({},e),{},{type:"ConeGeometry"})})}},CubeGeometry:class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){var n,i,r;let s=Object.assign({},null!==(n=null===t||void 0===t?void 0:t.parameters)&&void 0!==n?n:{width:100,widthSegments:1,heightSegments:1,depthSegments:1,cornerRadius:8,cornerSegments:8},e.parameters);return{parameters:Object.assign(s,{width:Math.abs(s.width),height:Math.abs(null!==(i=s.height)&&void 0!==i?i:s.width),depth:Math.abs(null!==(r=s.depth)&&void 0!==r?r:s.width)})}}static build(e){let t,{width:n,height:i,depth:r,widthSegments:s,heightSegments:a,depthSegments:l,cornerRadius:c,cornerSegments:h}=e.parameters;return t=0===c?new Ti(n,i,r,s,a,l):new S_(n,i,r,s,a,l,c,h),Object.assign(t,{userData:o(o({},e),{},{type:"CubeGeometry"})})}},CylinderGeometry:v_,DodecahedronGeometry:class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){var n,i,r;let s=Object.assign({},null!==(n=null===t||void 0===t?void 0:t.parameters)&&void 0!==n?n:{width:100,detail:0,corner:0,cornerSides:4},e.parameters);return{parameters:Object.assign(s,{width:Math.abs(s.width),height:Math.abs(null!==(i=s.height)&&void 0!==i?i:s.width),depth:Math.abs(null!==(r=s.depth)&&void 0!==r?r:s.width)})}}static build(e){let{width:t,height:n,depth:i,detail:r,corner:s,cornerSides:a}=e.parameters,l=0===r&&0!==s?new E_(.5*t,s,a):new Eo(.5*t,r);return l.scale(1,n/t,i/t),Object.assign(l,{userData:o(o({},e),{},{type:"DodecahedronGeometry"})})}},EllipseGeometry:VE,HelixGeometry:class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){var n,i,r;let s=Object.assign({},null!==(n=null===t||void 0===t?void 0:t.parameters)&&void 0!==n?n:{width:100,revolutions:2,segments:40,pathRadius:10,pathType:0,pathSegments:30,cornerRadius:30,cornerSegments:4},e.parameters),a=Math.abs(s.width),o=Math.abs(null!==(i=s.height)&&void 0!==i?i:a),l=Math.abs(null!==(r=s.depth)&&void 0!==r?r:a),c=Math.abs(Math.min(a,l))/2;return{parameters:Object.assign(s,{width:a,height:o,depth:l,radius:c,segments:Math.round(s.segments),pathSegments:Math.round(s.pathSegments),cornerSegments:Math.round(s.cornerSegments)})}}static build(e){let{width:t,height:n,depth:i,radius:r,revolutions:s,segments:a,pathRadius:l,pathType:c,pathSegments:h,cornerRadius:u,cornerSegments:d}=e.parameters,p=new KE(!1,t,n,i,r,s,a,l,c,h,u,d);return Object.assign(p,{userData:o(o({},e),{},{type:"HelixGeometry"})})}},IcosahedronGeometry:class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){var n,i,r;let s=Object.assign({},null!==(n=null===t||void 0===t?void 0:t.parameters)&&void 0!==n?n:{width:100,detail:0,corner:0,cornerSides:4},e.parameters);return{parameters:Object.assign(s,{width:Math.abs(s.width),height:Math.abs(null!==(i=s.height)&&void 0!==i?i:s.width),depth:Math.abs(null!==(r=s.depth)&&void 0!==r?r:s.width)})}}static build(e){let{width:t,height:n,depth:i,detail:r,corner:s,cornerSides:a}=e.parameters,l=0===r&&0!==s?new ZE(.5*t,s,a):new el(.5*t,r);return l.scale(1,n/t,i/t),Object.assign(l,{userData:o(o({},e),{},{type:"IcosahedronGeometry"})})}},LatheGeometry:class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){var n,i,r,s,a;(null!==(n=null===(i=e.parameters)||void 0===i?void 0:i.points)&&void 0!==n?n:[]).forEach((e=>{Array.isArray(e)&&(e.x=e[0],e.y=e[1])}));let o=Object.assign({},null!==(r=null===t||void 0===t?void 0:t.parameters)&&void 0!==r?r:{width:100,segments:64,verticalSegments:64,points:[{x:0,y:-50,id:0},{x:50,y:-50,id:1},{x:50,y:50,id:2},{x:0,y:50,id:3}]},e.parameters);return{parameters:Object.assign(o,{width:Math.abs(o.width),height:Math.abs(null!==(s=o.height)&&void 0!==s?s:o.width),depth:Math.abs(null!==(a=o.depth)&&void 0!==a?a:o.width)})}}static build(e){let{points:t,segments:n,verticalSegments:i}=e.parameters,r=new Ao;r.moveTo(t[0].x,t[0].y),r.bezierCurveTo(t[1].x,t[1].y,t[2].x,t[2].y,t[3].x,t[3].y);let s=new xo(r.extractPoints(i).shape,n);return s.rotateZ(Math.PI),Object.assign(s,{userData:o(o({},e),{},{type:"LatheGeometry"})})}},NonParametricGeometry:class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){var n,i;let r,s=null!==(n=null!==(i=e.geometry)&&void 0!==i?i:null===t||void 0===t?void 0:t.geometry)&&void 0!==n?n:(new di).copy(new Ti(100,100,100));void 0===t?(s.computeBoundingBox(),s.boundingBox.getSize(vA),r={width:vA.x,height:vA.y,depth:vA.z,subdivisions:0}):r=t.parameters;let a=o(o({},r),e.parameters);return{parameters:{width:Math.abs(a.width),height:Math.abs(a.height),depth:Math.abs(a.depth),subdivisions:Math.abs(a.subdivisions)},geometry:s}}static build(e){var t;let{width:n,height:i,depth:r,subdivisions:s}=e.parameters,a=null!==(t=e.geometry)&&void 0!==t?t:(new di).copy(new Ti(100,100,100)),l=a.userData.parameters;void 0===l?(a.computeBoundingBox(),a.boundingBox.getSize(vA)):vA.set(l.width,l.height,l.depth),(n!==vA.x||i!==vA.y||r!==vA.z)&&a.scale(0===vA.x?1:n/vA.x,0===vA.y?1:i/vA.y,0===vA.z?1:r/vA.z);let c=a.originalGeometry;try{s>0?(void 0===c||(null===l||void 0===l?void 0:l.subdivisions)!==s)&&(void 0===c&&(c=a),a=new gA(s).modify(c).toBufferGeometry()):(void 0!==c&&(a=c),c=void 0,void 0===a.getAttribute("normal")&&a.computeVertexNormals())}catch(h){void 0!==c&&(a=c),c=void 0,void 0===a.getAttribute("normal")&&a.computeVertexNormals()}return void 0!==c&&Object.assign(a,{originalGeometry:c}),delete e.geometry,Object.assign(a,{userData:o(o({},e),{},{type:"NonParametricGeometry"})})}static loadFromUrl(e,t,n){new Kl(n).load(e,(e=>{let n=this.normalizeInputs({geometry:e});e.boundingBox.getSize(vA);let i=100/vA.x;Object.assign(n.parameters,{width:100,height:vA.y*i,depth:vA.z*i}),t(this.build(n))}))}},PolygonGeometry:yA,PyramidGeometry:class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){var n,i,r;let s=Object.assign({},null!==(n=null===t||void 0===t?void 0:t.parameters)&&void 0!==n?n:{width:100,radialSegments:4,heightSegments:1,cornerRadius:0,cornerSegments:8,openEnded:!1},e.parameters);return{parameters:Object.assign(s,{width:Math.abs(s.width),height:Math.abs(null!==(i=s.height)&&void 0!==i?i:s.width),depth:Math.abs(null!==(r=s.depth)&&void 0!==r?r:s.width)})}}static build(e){let{width:t,height:n,depth:i,radialSegments:r,heightSegments:s,openEnded:a,cornerRadius:l,cornerSegments:c}=e.parameters,h=new SA(.5*t,n,r,s,a,l,c);return h.scale(1,1,i/t),Object.assign(h,{userData:o(o({},e),{},{type:"PyramidGeometry"})})}},RectangleGeometry:_A,SphereGeometry:class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){var n,i,r;let s=Object.assign({},null!==(n=null===t||void 0===t?void 0:t.parameters)&&void 0!==n?n:{width:100,widthSegments:64,heightSegments:64,phiStart:0,phiLength:2*Math.PI,thetaStart:0,thetaLength:180},e.parameters);return s.thetaLength=at.clamp(s.thetaLength,0,180),{parameters:Object.assign(s,{width:Math.abs(s.width),height:Math.abs(null!==(i=s.height)&&void 0!==i?i:s.width),depth:Math.abs(null!==(r=s.depth)&&void 0!==r?r:s.width)})}}static build(e){let t,{width:n=100,height:i=n,depth:r=n,widthSegments:s=64,heightSegments:a=64,phiStart:l,phiLength:c,thetaStart:h,thetaLength:u}=e.parameters;return 0===u?(t=new di,t.setAttribute("position",new ri([],3))):t=new tl(.5*n,s,a,l,c,h,u*at.DEG2RAD),t.scale(1,i/n,r/n),Object.assign(t,{userData:o(o({},e),{},{type:"SphereGeometry"})})}},PlaneGeometry:class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){var n,i;let r=Object.assign({},null!==(n=null===t||void 0===t?void 0:t.parameters)&&void 0!==n?n:{width:100,depth:0,widthSegments:8,heightSegments:8},e.parameters);return{parameters:Object.assign(r,{width:Math.abs(r.width),height:Math.abs(null!==(i=r.height)&&void 0!==i?i:r.width),depth:0})}}static build(e){let{width:t=100,height:n=t,widthSegments:i=8,heightSegments:r=8}=e.parameters,s=new Qi(t,n,i,r);return s.scale(1,1,1),Object.assign(s,{userData:o(o({},e),{},{type:"PlaneGeometry"})})}},BackdropGeometry:class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){var n,i,r;let s=Object.assign({},null!==(n=null===t||void 0===t?void 0:t.parameters)&&void 0!==n?n:{width:100,angle:90,cornerRadius:24,cornerSegments:8},e.parameters);return{parameters:Object.assign(s,{width:Math.abs(s.width),height:Math.abs(null!==(i=s.height)&&void 0!==i?i:s.width),depth:Math.abs(null!==(r=s.depth)&&void 0!==r?r:s.width)})}}static build(e){let{width:t,height:n,depth:i,angle:r,cornerRadius:s,cornerSegments:a}=e.parameters,l=new EA(t,n,i,r,s,a);return Object.assign(l,{userData:o(o({},e),{},{type:"BackdropGeometry"})})}},StarGeometry:AA,TextFrameGeometry:class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){var n,i,r;let s=Object.assign({},null!==(n=null===t||void 0===t?void 0:t.parameters)&&void 0!==n?n:{width:100,depth:0},e.parameters);return{parameters:Object.assign(s,{width:Math.abs(s.width),height:Math.abs(null!==(i=s.height)&&void 0!==i?i:s.width),depth:Math.abs(null!==(r=s.depth)&&void 0!==r?r:0)})}}static build(e){let{width:t,height:n}=e.parameters,i=new Qi(t,n);return Object.assign(i,{userData:o(o({},e),{},{type:"TextFrameGeometry"})})}},TorusGeometry:class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){var n,i,r;let s=Object.assign({},null!==(n=null===t||void 0===t?void 0:t.parameters)&&void 0!==n?n:{width:100,radialSegments:32,tubularSegments:64,arc:360,cornerRadius:30,cornerSegments:8},e.parameters),a=Math.abs(s.width),o=Math.abs(null!==(i=s.height)&&void 0!==i?i:s.width);s.shapeBlendNode&&(o=a);let l=Math.round(Math.abs(null!==(r=s.depth)&&void 0!==r?r:.25*s.width));return{parameters:Object.assign(s,{width:a,height:o,depth:l})}}static build(e){let{width:t,height:n,depth:i,radialSegments:r,tubularSegments:s,arc:a,cornerRadius:l,cornerSegments:c}=e.parameters,h=function(e,t,n,i,r,s,a,o,l,c,h){[t,n]=[n,t],a=t/2;let u=at.clamp(r/360,0,1);if(0===u){let e=new di;return e.setAttribute("position",new ri([],3)),e}return 1===u&&(c=0),new KE(!0,e,t,n,i,u,s,a,o,l,c,h)}(t,n,i,.5*t,a,s,0,0,r,l,c);return h.scale(1,n/t,1),Object.assign(h,{userData:o(o({},e),{},{type:"TorusGeometry"})})}},TorusKnotGeometry:class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){var n,i,r,s;let a=Object.assign({},null!==(n=null===t||void 0===t?void 0:t.parameters)&&void 0!==n?n:{width:100,tubularSegments:64,radialSegments:32,p:2,q:3},e.parameters);return{parameters:Object.assign(a,{width:Math.abs(a.width),height:Math.abs(null!==(i=a.height)&&void 0!==i?i:a.width),depth:Math.abs(null!==(r=a.depth)&&void 0!==r?r:a.width),tube:null!==(s=a.tube)&&void 0!==s?s:.125*a.width})}}static build(e){let{width:t,tube:n,tubularSegments:i,radialSegments:r,p:s,q:a}=e.parameters,l=.5*t;l!==n&&(l-=n);let c=new il(l,n,i,r,s,a);return Object.assign(c,{userData:o(o({},e),{},{type:"TorusKnotGeometry"})})}},TriangleGeometry:class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){var n,i,r;let s=Object.assign({},null!==(n=null===t||void 0===t?void 0:t.parameters)&&void 0!==n?n:{width:100,depth:0,spikes:5,cornerRadius:0,extrudeBevelSize:0,extrudeBevelSegments:1,isRect:!1},e.parameters);return{shape:e.shape&&e.shape instanceof aE?e.shape:new aE,parameters:Object.assign(s,{width:Math.abs(s.width),height:Math.abs(null!==(i=s.height)&&void 0!==i?i:s.width*(s.isRect?1:Math.sqrt(3)/2)),depth:Math.abs(null!==(r=s.depth)&&void 0!==r?r:0)})}}static build(e){let{width:t=100,height:n,cornerRadius:i,depth:r,extrudeBevelSize:s,extrudeBevelSegments:a,isRect:l}=e.parameters,c=e.shape,h=.5*t,u=.5*n;l?(c.addPoint(c.createPoint(-h,u)),c.addPoint(c.createPoint(h,-u)),c.addPoint(c.createPoint(-h,-u))):(c.addPoint(c.createPoint(0,u)),c.addPoint(c.createPoint(h,-u)),c.addPoint(c.createPoint(-h,-u))),c.isClosed=!0;for(let o=0,p=c.points.length;o<p;o++)c.points[o].roundness=i;c.roundness=i,c.update();let d=UE.create({shape:c,parameters:{roundness:i,depth:r,extrudeBevelSize:s,extrudeBevelSegments:a}});return Object.assign(d,{userData:o(o({},e),{},{type:"TriangleGeometry"})})}},PathGeometry:class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){var n,i,r,s,a;let l=Object.assign({},null!==(n=null===t||void 0===t?void 0:t.parameters)&&void 0!==n?n:{width:100,height:100,depth:1,subdivisions:12,roundness:0,extrudeBevelSize:0,extrudeBevelSegments:3},e.parameters),c=Math.abs(l.width),h=Math.abs(null!==(i=l.height)&&void 0!==i?i:l.width),u=Math.abs(null!==(r=l.depth)&&void 0!==r?r:0),d=null!==(s=null===t||void 0===t?void 0:t.shapeData)&&void 0!==s?s:VE.create({parameters:Ib}).userData.shape;return{path:null!==(a=e.path)&&void 0!==a?a:Tb.defaultData(),parameters:Object.assign(l,{width:c,height:h,depth:u,extrusion:o(o({},Bb),l.extrusion)}),shapeData:d}}static build(e){if(e.path.points.length>=2){let t=new HA(e);return Object.assign(t,{userData:o(o({},e),{},{type:"PathGeometry"})})}return Object.assign(new di,{userData:o(o({},e),{},{type:"PathGeometry"})})}},VectorGeometry:UE},RC=e=>IC[e.type].create(e);function kC(e){return null!==e&&"booleanOp"in e}var LC=class extends(g_(Ci)){constructor(){super(...arguments),this.booleanMeshSetAddress=-1,this.booleanWasTransformed=!1,this.booleanMatrixInvOld=new pn}updateVisible(e){super.updateVisible(e),this.visible=!kC(this.parent)&&this.visible,kC(this.parent)&&this.parent.invalidateDownstreamBooleanData()}freeBooleanPointer(){-1!==this.booleanMeshSetAddress&&(vC.freeMeshSet(this.booleanMeshSetAddress),this.booleanMeshSetAddress=-1)}invalidateDownstreamBooleanData(){return arguments.length>0&&void 0!==arguments[0]&&arguments[0]?this.booleanWasTransformed=!0:this.freeBooleanPointer(),kC(this.parent)?this.parent.invalidateDownstreamBooleanData():this}invalidateUpstreamBooleanData(){this.freeBooleanPointer();for(let e of this.children)e instanceof LC&&(e.freeBooleanPointer(),kC(e)&&e.invalidateUpstreamBooleanData())}updateTransformState(e,t){let n=super.updateTransformState(e,t);return n&&kC(this.parent)&&this.invalidateDownstreamBooleanData(!0),n}onVariableUpdate(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];super.onVariableUpdate(e),kC(this.parent)&&this.invalidateDownstreamBooleanData(!0)}},BC=new Ft;function zC(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e.count,i=arguments.length>3?arguments[3]:void 0,r=arguments.length>4?arguments[4]:void 0,s=1/0,a=1/0,o=1/0,l=-1/0,c=-1/0,h=-1/0;for(let u=t;u<n;u++){let t=e.getX(u),n=e.getY(u),i=e.getZ(u);t<s&&(s=t),n<a&&(a=n),i<o&&(o=i),t>l&&(l=t),n>c&&(c=n),i>h&&(h=i)}BC.min.set(s,a,o),BC.max.set(l,c,h),BC.getCenter(i),BC.getSize(r).multiplyScalar(.5)}var NC=new di,FC=new Jn,UC=class extends LC{constructor(e,t){super(NC,FC),this.super_Entity(e,t)}updateState(e,t){this.updateState_Entity(e,t)}updateEntityBoxSize(e,t){let n=this.geometry.getAttribute("position");void 0!==n?zC(n,this.geometry.drawRange.start,this.geometry.drawRange.count<1/0?this.geometry.drawRange.count:n.count,e,t):super.updateEntityBoxSize(e,t)}},jC=class{constructor(e){if(this.hashProperties=void 0,this.isNode=!0,this.shortcuts={},null===jC.uuidContext)throw new Error("plz startContext");jC.uuidContext===jC.globalContext?this.uuid="_gid"+jC.uuidContext.nodeContextUuid++:this.uuid="_uid"+jC.uuidContext.nodeContextUuid++,this.type=e,this.name=""}static startContext(e){null===this.uuidContext||this.uuidContext===jC.globalContext?this.uuidContext=e:console.error("Can't start context twice")}static endContext(e){this.uuidContext!==e&&console.error("Can't end context twice"),this.uuidContext=null}analyze(e,t){t=null!==t&&void 0!==t?t:{},e.analyzing=!0,this.build(e.addFlow(t.slot,t.cache,t.context),"v4"),e.clearVertexNodeCode(),e.clearFragmentNodeCode(),e.removeFlow(),e.analyzing=!1}analyzeAndFlow(e,t,n){return n=null!==n&&void 0!==n?n:{},this.analyze(e,n),this.flow(e,t,n)}flow(e,t,n){n=null!==n&&void 0!==n?n:{},e.addFlow(n.slot,n.cache,n.context);let i={result:this.build(e,t),code:e.clearNodeCode(),extra:e.context.extra};return e.removeFlow(),i}build(e,t,n){t=null!==t&&void 0!==t?t:this.getType(e,t);let i=e.getNodeData(null!==n&&void 0!==n?n:this);return e.analyzing&&this.appendDepsNode(e,i,t),-1===e.nodes.indexOf(this)&&e.nodes.push(this),void 0!==this.updateFrame&&-1===e.updaters.indexOf(this)&&e.updaters.push(this),this.generate(e,t,n)}updateFrame(e){}generateReadonly(e,t,n,i,r,s){return""}generate(e,t,n,i,r){return""}parse(e,t,n,i){}appendDepsNode(e,t,n){t.deps=(t.deps||0)+1;let i=e.getTypeLength(n);(i>(t.outputMax||0)||this.getType(e,n))&&(t.outputMax=i,t.output=n)}setName(e){this.name=e}getName(){return this.name}getType(e,t){return"sampler2D"===t||"samplerCube"===t?t:this.type}},VC=jC;VC.globalContext={nodeContextUuid:0},VC.uuidContext=jC.globalContext;var GC=class{constructor(e){e=null!==e&&void 0!==e?e:{},this.name=e.name,this.type=e.type,this.node=e.node,this.size=e.size,this.needsUpdate=e.needsUpdate}get value(){return this.node.value}set value(e){this.node.value=e}},HC=new class{constructor(){this.nodes={},this.keywords={}}add(e){this.nodes[e.name]=e}addKeyword(e,t,n){n=void 0===n||n,this.keywords[e]={callback:t,cache:n}}remove(e){delete this.nodes[e.name]}removeKeyword(e){delete this.keywords[e]}get(e){return this.nodes[e]}getKeyword(e,t){return this.keywords[e].callback(t)}getKeywordData(e){return this.keywords[e]}contains(e){return void 0!==this.nodes[e]}containsKeyword(e){return void 0!==this.keywords[e]}},WC=class extends VC{constructor(e,t){super(e),this.scope="",t=null!==t&&void 0!==t?t:{},this.shared=void 0===t.shared||t.shared,this.unique=void 0!==t.unique&&t.unique}build(e,t,n,i){if(t=null!==t&&void 0!==t?t:this.getType(e),this.getShared(e,t)){let r=this.getUnique(e,t);r&&void 0===this.uuid&&(this.uuid=at.generateUUID()),n=e.getUUID(null!==n&&void 0!==n?n:this.getUUID(),!r);let s=e.getNodeData(n),a=s.output||this.getType(e);if(e.analyzing)return(s.deps||0)>0||this.getLabel()?(this.appendDepsNode(e,s,t),this.generate(e,t,n)):super.build(e,t,n);if(r)return s.name=s.name||super.build(e,t,n),s.name;if(!this.getLabel()&&(!this.getShared(e,a)||e.context.ignoreCache||1===s.deps))return super.build(e,t,n);n=this.getUUID(!1);let o=this.getTemp(e,n);if(o)return e.format(o,a,t);{o=super.generate(e,t,n,s.output,i);let r=this.generate(e,a,n);return e.addNodeCode(o+" = "+r+";"),e.format(o,a,t)}}return super.build(e,t,n)}getShared(e,t){return"sampler2D"!==t&&"samplerCube"!==t&&this.shared}getUnique(e,t){return this.unique}setLabel(e){return this.label=e,this}getLabel(){return this.label}getUUID(e){let t=this.uuid;return"string"==typeof this.scope&&(t=this.scope+"-"+t),t}getTemp(e,t){t=t||this.uuid;let n=e.getVars()[t];return n?n.name:void 0}generate(e,t,n,i,r){return this.getShared(e,t)||console.error("TempNode is not shared"),n=null!==n&&void 0!==n?n:this.uuid,e.getTempVar(n,null!==i&&void 0!==i?i:this.getType(e),r,this.getLabel()).name}},qC=class extends WC{constructor(e,t){(t=null!==t&&void 0!==t?t:{}).shared=void 0!==t.shared&&t.shared,super(e,t),this.readonly=!1}setReadonly(e){return this.readonly=e,this.hashProperties=this.readonly?["value"]:void 0,this}getReadonly(){return this.readonly}generate(e,t,n,i,r,s){n=e.getUUID(null!==n&&void 0!==n?n:this.getUUID()),i=null!==i&&void 0!==i?i:this.getType(e);let a=e.getNodeData(n);return this.getReadonly()&&void 0!==this.generateReadonly?this.generateReadonly(e,t,n,i,r,s):e.isShader("vertex")?(a.vertex||(a.vertex=e.createVertexUniform(i,this,r,s,this.getLabel())),e.format(a.vertex.name,i,t)):(a.fragment||(a.fragment=e.createFragmentUniform(i,this,r,s,this.getLabel())),e.format(a.fragment.name,i,t))}},XC=class extends qC{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1?arguments[1]:void 0;super("v2"),this.nodeType="Vector2",this.value=e instanceof ot?e:new ot(e,t)}get x(){return this.value.x}set x(e){this.value.x=e}get y(){return this.value.y}set y(e){this.value.y=e}generateReadonly(e,t,n,i,r,s){return e.format("vec2("+this.value.x+", "+this.value.y+")",i,t)}},YC=class extends qC{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0;super("v3"),this.nodeType="Vector3",this.value=e instanceof Bt?e:new Bt(e,t,n)}get x(){return this.value.x}set x(e){this.value.x=e}get y(){return this.value.y}set y(e){this.value.y=e}get z(){return this.value.z}set z(e){this.value.z=e}generateReadonly(e,t,n,i,r,s){return e.format("vec3("+this.value.x+", "+this.value.y+", "+this.value.z+")",i,t)}},QC=class extends Et{constructor(e,t,n,i){super(e,t,n),this.isColorA=!0,this.a=i}setRGBA(e,t,n,i){super.setRGB(e,t,n),this.a=i}copy(e){return super.copy(e),this.a="a"in e?e.a:1,this}clone(){return new this.constructor(this.r,this.g,this.b,this.a)}equals(e){return super.equals(e)&&this.a===e.a}setStyle(e){let t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"srgb";if("transparent"===e)return this.setRGBA(0,0,0,0),this;if(t=/^((?:rgb|hsl)a?)\(([^)]*)\)/.exec(e)){let i,r=t[1],s=t[2];switch(r){case"rgb":case"rgba":if(i=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(s))return this.a="rgba"===r?parseFloat(i[4]):1,super.setStyle(e,n);break;case"hsl":case"hsla":if(i=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)%\s*,\s*(\d*\.?\d+)%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(s))return this.a="hsla"===r?parseFloat(i[4]):1,super.setStyle(e,n)}}return super.setStyle(e,n)}get x(){return this.r}get y(){return this.g}get z(){return this.b}get w(){return this.a}set x(e){this.r=e}set y(e){this.g=e}set z(e){this.b=e}set w(e){this.a=e}},KC=class extends qC{constructor(e){super("v4"),this.nodeType="Vector4",this.value=e instanceof QC?e:new QC(e.r,e.g,e.b,e.a)}generateReadonly(e,t,n,i,r,s){return e.format("vec4("+this.value.r+", "+this.value.g+", "+this.value.b+", "+this.value.a+")",i,t)}},ZC=/^\s*([a-z_0-9]+)\s([a-z_0-9]+)\s*\((.*?)\)/i,JC=/[a-z_0-9]+/gi,$C=class extends WC{constructor(e,t,n,i,r){super(r),this.src="",this.nodeType="Function",this.useKeywords=!0,this.includes=[],this.extensions={},this.keywords={},this.isMethod=void 0===r,this.isInterface=!1,this.parse(e,t,n,i)}getShared(e,t){return!this.isMethod}getType(e){return e.getTypeByFormat(this.type)}getInputByName(e){if(this.inputs){let t=this.inputs.length;for(;t--;)if(this.inputs[t].name===e)return this.inputs[t]}}getIncludeByName(e){if(this.includes){let t=this.includes.length;for(;t--;)if(this.includes[t].name===e)return this.includes[t]}}generate(e,t,n,i,r){let s,a=0,o=this.src;if(this.includes)for(let c=0;c<this.includes.length;c++)e.include(this.includes[c],this);for(let c in this.extensions)e.extensions[c]=!0;let l=[];for(;s=JC.exec(this.src);)l.push(s);for(let c=0;c<l.length;c++){let t=l[c],n=t[0],i=!this.isMethod||!this.getInputByName(n),r=n;if(this.keywords[n]||this.useKeywords&&i&&HC.containsKeyword(n)){let t=this.keywords[n];if(!t){let i=HC.getKeywordData(n);i.cache&&(t=e.keywords[n]),t=t||HC.getKeyword(n,e),i.cache&&(e.keywords[n]=t)}r=t.build(e)}n!==r&&"."!==o[t.index+a-1]&&(o=o.substring(0,t.index+a)+r+o.substring(t.index+n.length+a),a+=r.length-n.length),void 0===this.getIncludeByName(r)&&HC.contains(r)&&e.include(HC.get(r))}return"source"===t?o:this.isMethod?(this.isInterface||e.include(this,void 0,o),this.name):e.format("( "+o+" )",this.getType(e),t)}parse(e,t,n,i){if(this.src=e||"",this.includes=null!==t&&void 0!==t?t:[],this.extensions=null!==n&&void 0!==n?n:{},this.keywords=null!==i&&void 0!==i?i:{},this.isMethod){let e=ZC.exec(this.src);if(this.inputs=[],e&&4==e.length){this.type=e[1],this.name=e[2];let t=e[3].match(JC);if(t){let e=0;for(;e<t.length;){let n,i=t[e++];"in"===i||"out"===i||"inout"===i?n=t[e++]:(n=i,i="");let r=t[e++];this.inputs.push({name:r,type:n,qualifier:i})}}this.isInterface=-1===this.src.indexOf("{")}else this.type="",this.name=""}}},eM=/^([a-z_0-9]+)\s([a-z_0-9]+)\s?\=?\s?(.*?)(\;|$)/i,tM=class extends WC{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1?arguments[1]:void 0;super(),this.src="",this.useDefine=!1,this.nodeType="Const",this.parse(e||tM.PI,void 0,void 0,void 0,t)}getType(e){return e.getTypeByFormat(this.type)}parse(e,t,n,i,r){this.src=e||"";let s,a,o="",l=eM.exec(e);this.useDefine=null!==r&&void 0!==r?r:"#"===this.src.charAt(0),l&&l.length>1?(a=l[1],s=l[2],o=l[3]):(s=this.src,a="f"),this.name=s,this.type=a,this.value=o}build(e,t){if("source"===t){if(this.value)return this.useDefine?"#define "+this.name+" "+this.value:"const "+this.type+" "+this.name+" = "+this.value+";";if(this.useDefine)return this.src}return e.include(this),e.format(this.name,this.getType(e),t)}generate(e,t,n,i,r){return e.format(this.name,this.getType(e),t)}},nM=tM;nM.PI="PI",nM.PI2="PI2",nM.RECIPROCAL_PI="RECIPROCAL_PI",nM.RECIPROCAL_PI2="RECIPROCAL_PI2",nM.LOG2="LOG2",nM.EPSILON="EPSILON";var iM=new RegExp("^structs*([a-z_0-9]+)s*{s*((.|\n)*?)}","gim"),rM=new RegExp("s*(w*?)s*(w*?)(=|;)","gim"),sM=class extends WC{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";super(),this.inputs=[],this.src="",this.nodeType="Struct",this.parse(e)}getType(e){return e.getTypeByFormat(this.name)}getInputByName(e){let t=this.inputs.length;for(;t--;)if(this.inputs[t].name===e)return this.inputs[t]}generate(e,t,n,i,r){return"source"===t?this.src+";":e.format("( "+this.src+" )",this.getType(e),t)}parse(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";this.src=e,this.inputs=[];let t=iM.exec(e);if(t){let e,n=t[2];for(;e=rM.exec(n);)this.inputs.push({type:e[1],name:e[2]});this.name=t[1]}else this.name="";this.type=this.name}},aM=class extends WC{constructor(e){super("v2",{shared:!1}),this.nodeType="UV",this.index=null!==e&&void 0!==e?e:0}generate(e,t){e.requires.uv[this.index]=!0;let n=this.index>0?this.index+1:"",i=e.isShader("vertex")?"uv"+n:"vUv"+n;return e.format(i,this.getType(e),t)}};HC.addKeyword("uv",(function(){return new aM})),HC.addKeyword("uv2",(function(){return new aM(1)}));var oM=class extends WC{constructor(e,t){super("v4"),this.nodeType="ColorSpace",this.input=e,this.method=null!==t&&void 0!==t?t:oM.LINEAR_TO_LINEAR,this.hashProperties=["method"]}static getEncodingComponents(e){switch(e){case ze:return["Linear"];case Ne:return["sRGB"];default:return[]}}generate(e,t){var n;let i=this.input.build(e,"v4"),r=this.getType(e),s=oM.Nodes[this.method],a=e.include(s);if(a===oM.LINEAR_TO_LINEAR)return e.format(i,r,t);if(2===(null===(n=s.inputs)||void 0===n?void 0:n.length)){let n=this.factor.build(e,"f");return e.format(a+"( "+i+", "+n+" )",r,t)}return e.format(a+"( "+i+" )",r,t)}fromEncoding(e){let t=oM.getEncodingComponents(e);this.method="LinearTo"+t[0],this.factor=t[1]}fromDecoding(e){let t=oM.getEncodingComponents(e);this.method=t[0]+"ToLinear",this.factor=t[1]}},lM=oM;lM.Nodes={LinearToLinear:new $C(["vec4 LinearToLinear( in vec4 value ) {","\treturn value;","}"].join("\n")),sRGBToLinear:new $C(["vec4 sRGBToLinear( in vec4 value ) {","\treturn vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.w );","}"].join("\n")),LinearTosRGB:new $C(["vec4 LinearTosRGB( in vec4 value ) {","\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.w );","}"].join("\n"))},lM.LINEAR_TO_LINEAR="LinearToLinear",lM.SRGB_TO_LINEAR="sRGBToLinear",lM.LINEAR_TO_SRGB="LinearTosRGB";var cM=class extends $C{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",arguments.length>4?arguments[4]:void 0,arguments.length>3?arguments[3]:void 0,arguments.length>2?arguments[2]:void 0,arguments.length>1?arguments[1]:void 0),this.nodeType="Expression"}},hM=class extends qC{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Dt,t=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0,i=arguments.length>3?arguments[3]:void 0;super("v4",{shared:!0}),this.nodeType="Texture",this.value=e,this.uv=null!==t&&void 0!==t?t:new aM,this.bias=n,this.project=void 0!==i&&i}getTexture(e,t){return super.generate(e,t,this.value.uuid,"t")}generate(e,t){var n;if("sampler2D"===t)return this.getTexture(e,t);let i,r,s=this.getTexture(e,t),a=this.uv.build(e,this.project?"v4":"v2"),o=this.bias?this.bias.build(e,"f"):void 0;void 0===o&&e.context.bias&&(o=e.context.bias.setTexture(this).build(e,"f")),i=this.project?"texture2DProj":o?"tex2DBias":"tex2D",r=o?i+"( "+s+", "+a+", "+o+" )":i+"( "+s+", "+a+" )";let l={include:e.isShader("vertex"),ignoreCache:!0},c=this.getType(e);return e.addContext(l),this.colorSpace=null!==(n=this.colorSpace)&&void 0!==n?n:new lM(new cM("",c)),this.colorSpace.fromDecoding(e.getTextureEncodingFromMap(this.value)),this.colorSpace.input.parse(r),r=this.colorSpace.build(e,c),e.removeContext(),e.format(r,c,t)}},uM=class extends qC{constructor(e){super("f"),this.nodeType="Float",this.value=null!==e&&void 0!==e?e:0}generateReadonly(e,t,n,i,r,s){return e.format(this.value+(this.value%1?"":".0"),i,t)}},dM=class extends WC{constructor(e,t){super(),this.inputs=[],this.nodeType="FunctionCall",this.value=e,this.inputs=null!==t&&void 0!==t?t:[]}getFunction(){return this.value}getType(e){return this.value.getType(e)}generate(e,t,n,i,r){i=this.getType(e);let s=this.value,a=s.build(e,t)+"( ",o=[];if(s.inputs){for(let t=0;t<s.inputs.length;t++){let n=s.inputs[t],i=this.inputs[t]||this.inputs[n.name];o.push(i.build(e,e.getTypeByFormat(n.type)))}a+=o.join(", ")+" )"}return e.format(a,i,t)}},pM=class extends WC{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:pM.ADD;super(),this.nodeType="Operator",this.type=e.type,this.a=e,this.b=t,this.op=n}getType(e){let t=this.a.getType(e),n=this.b.getType(e);return e.isTypeMatrix(t)?"v4":e.getTypeLength(n)>e.getTypeLength(t)?n:t}generate(e,t){let n=this.getType(e);this.type=n;let i=this.a.build(e,n),r=this.b.build(e,n);return e.format("( "+i+" "+this.op+" "+r+" )",n,t)}},fM=pM;fM.ADD="+",fM.SUB="-",fM.MUL="*",fM.DIV="/";var mM=class extends WC{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:mM.ABS,n=arguments.length>2?arguments[2]:void 0,i=arguments.length>3?arguments[3]:void 0;super(),this.nodeType="Math",this.a=e,"string"!=typeof t?this.b=t:i=t,"string"!=typeof n?this.c=n:i=n,this.method=i,this.hashProperties=["method"]}getNumInputs(e){switch(this.method){case mM.MIX:case mM.CLAMP:case mM.REFRACT:case mM.SMOOTHSTEP:case mM.FACEFORWARD:return 3;case mM.MIN:case mM.MAX:case mM.MOD:case mM.STEP:case mM.REFLECT:case mM.DISTANCE:case mM.DOT:case mM.CROSS:case mM.POW:return 2;default:return 1}}getInputType(e){let t=e.getTypeLength(this.a.getType(e)),n=this.b?e.getTypeLength(this.b.getType(e)):0,i=this.c?e.getTypeLength(this.c.getType(e)):0;return t>n&&t>i?this.a.getType(e):n>i?this.b.getType(e):this.c.getType(e)}getType(e){switch(this.method){case mM.LENGTH:case mM.DISTANCE:case mM.DOT:return"f";case mM.CROSS:return"v3"}return this.getInputType(e)}generate(e,t){let n,i,r,s=this.a?e.getTypeLength(this.a.getType(e)):0,a=this.b?e.getTypeLength(this.b.getType(e)):0,o=this.c?e.getTypeLength(this.c.getType(e)):0,l=this.getInputType(e),c=this.getType(e);switch(this.type=c,this.method){case mM.NEGATE:return e.format("( -"+this.a.build(e,l)+" )",l,t);case mM.INVERT:return e.format("( 1.0 - "+this.a.build(e,l)+" )",l,t);case mM.CROSS:n=this.a.build(e,"v3"),i=this.b.build(e,"v3");break;case mM.STEP:n=this.a.build(e,1===s?"f":l),i=this.b.build(e,l);break;case mM.MIN:case mM.MAX:case mM.MOD:n=this.a.build(e,l),i=this.b.build(e,1===a?"f":l);break;case mM.REFRACT:n=this.a.build(e,l),i=this.b.build(e,l),r=this.c.build(e,"f");break;case mM.MIX:n=this.a.build(e,l),i=this.b.build(e,l),r=this.c.build(e,1===o?"f":l);break;default:n=this.a.build(e,l),this.b&&(i=this.b.build(e,l)),this.c&&(r=this.c.build(e,l))}let h=[];h.push(n),i&&h.push(i),r&&h.push(r);let u=this.getNumInputs(e);if(h.length!==u)throw Error('Arguments not match used in "'.concat(this.method,'". Require ').concat(u,", currently ").concat(h.length,"."));return e.format(this.method+"( "+h.join(", ")+" )",c,t)}},gM=mM;gM.RAD="radians",gM.DEG="degrees",gM.EXP="exp",gM.EXP2="exp2",gM.LOG="log",gM.LOG2="log2",gM.SQRT="sqrt",gM.INV_SQRT="inversesqrt",gM.FLOOR="floor",gM.CEIL="ceil",gM.NORMALIZE="normalize",gM.FRACT="fract",gM.SATURATE="saturate",gM.SIN="sin",gM.COS="cos",gM.TAN="tan",gM.ASIN="asin",gM.ACOS="acos",gM.ARCTAN="atan",gM.ABS="abs",gM.SIGN="sign",gM.LENGTH="length",gM.NEGATE="negate",gM.INVERT="invert",gM.MIN="min",gM.MAX="max",gM.MOD="mod",gM.STEP="step",gM.REFLECT="reflect",gM.DISTANCE="distance",gM.DOT="dot",gM.CROSS="cross",gM.POW="pow",gM.MIX="mix",gM.CLAMP="clamp",gM.REFRACT="refract",gM.SMOOTHSTEP="smoothstep",gM.FACEFORWARD="faceforward";var vM=class extends WC{constructor(e,t,n){super("v4"),this.nodeType="TextureCubeUV",this.value=e,this.uv=t,this.bias=n}bilinearCubeUV(e,t,n,i){var r,s,a,o;let l=new dM(vM.Nodes.bilinearCubeUV,[t,n,i]);this.colorSpaceTL=null!==(r=this.colorSpaceTL)&&void 0!==r?r:new lM(new cM("","v4")),this.colorSpaceTL.fromDecoding(e.getTextureEncodingFromMap(this.value.value)),this.colorSpaceTL.input.parse(l.build(e)+".tl"),this.colorSpaceTR=null!==(s=this.colorSpaceTR)&&void 0!==s?s:new lM(new cM("","v4")),this.colorSpaceTR.fromDecoding(e.getTextureEncodingFromMap(this.value.value)),this.colorSpaceTR.input.parse(l.build(e)+".tr"),this.colorSpaceBL=null!==(a=this.colorSpaceBL)&&void 0!==a?a:new lM(new cM("","v4")),this.colorSpaceBL.fromDecoding(e.getTextureEncodingFromMap(this.value.value)),this.colorSpaceBL.input.parse(l.build(e)+".bl"),this.colorSpaceBR=null!==(o=this.colorSpaceBR)&&void 0!==o?o:new lM(new cM("","v4")),this.colorSpaceBR.fromDecoding(e.getTextureEncodingFromMap(this.value.value)),this.colorSpaceBR.input.parse(l.build(e)+".br");let c={include:e.isShader("vertex"),ignoreCache:!0};e.addContext(c),this.colorSpaceTLExp=new cM(this.colorSpaceTL.build(e,"v4"),"v4"),this.colorSpaceTRExp=new cM(this.colorSpaceTR.build(e,"v4"),"v4"),this.colorSpaceBLExp=new cM(this.colorSpaceBL.build(e,"v4"),"v4"),this.colorSpaceBRExp=new cM(this.colorSpaceBR.build(e,"v4"),"v4"),e.removeContext();let h=new cM("mix( mix( cubeUV_TL, cubeUV_TR, cubeUV.f.x ), mix( cubeUV_BL, cubeUV_BR, cubeUV.f.x ), cubeUV.f.y )","v4");return h.keywords.cubeUV_TL=this.colorSpaceTLExp,h.keywords.cubeUV_TR=this.colorSpaceTRExp,h.keywords.cubeUV_BL=this.colorSpaceBLExp,h.keywords.cubeUV_BR=this.colorSpaceBRExp,h.keywords.cubeUV=l,h}generate(e,t){if(e.isShader("fragment")){let n=this.uv,i=this.bias||e.context.roughness,r=new dM(vM.Nodes.roughnessToMip,[i]),s=new gM(r,vM.Nodes.m0,vM.Nodes.cubeUV_maxMipLevel,gM.CLAMP),a=new gM(s,gM.FLOOR),o=new gM(s,gM.FRACT),l=this.bilinearCubeUV(e,this.value,n,a),c=this.bilinearCubeUV(e,this.value,n,new fM(a,new uM(1).setReadonly(!0),fM.ADD)),h=new gM(l,c,o,gM.MIX);return e.format(h.build(e),"v4",t)}return console.warn("TextureCubeUVNode is not compatible with "+e.shader+" shader."),e.format("vec4( 0.0 )",this.getType(e),t)}},yM=vM;yM.Nodes=function(){let e=new sM("struct TextureCubeUVData {\n\t\t\tvec4 tl;\n\t\t\tvec4 tr;\n\t\t\tvec4 br;\n\t\t\tvec4 bl;\n\t\t\tvec2 f;\n\t\t}"),t=new nM("float cubeUV_maxMipLevel 8.0",!0),n=new nM("float cubeUV_minMipLevel 4.0",!0),i=new nM("float cubeUV_maxTileSize 256.0",!0),r=new nM("float cubeUV_minTileSize 16.0",!0),s=new $C("float getFace(vec3 direction) {\n\t\t\t\tvec3 absDirection = abs(direction);\n\t\t\t\tfloat face = -1.0;\n\t\t\t\tif (absDirection.x > absDirection.z) {\n\t\t\t\t\tif (absDirection.x > absDirection.y)\n\t\t\t\t\t\tface = direction.x > 0.0 ? 0.0 : 3.0;\n\t\t\t\t\telse\n\t\t\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t\t\t} else {\n\t\t\t\t\tif (absDirection.z > absDirection.y)\n\t\t\t\t\t\tface = direction.z > 0.0 ? 2.0 : 5.0;\n\t\t\t\t\telse\n\t\t\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t\t\t}\n\t\t\t\treturn face;\n\t\t}");s.useKeywords=!1;let a=new $C("vec2 getUV(vec3 direction, float face) {\n\t\t\t\tvec2 uv;\n\t\t\t\tif (face == 0.0) {\n\t\t\t\t\tuv = vec2(direction.z, direction.y) / abs(direction.x); // pos x\n\t\t\t\t} else if (face == 1.0) {\n\t\t\t\t\tuv = vec2(-direction.x, -direction.z) / abs(direction.y); // pos y\n\t\t\t\t} else if (face == 2.0) {\n\t\t\t\t\tuv = vec2(-direction.x, direction.y) / abs(direction.z); // pos z\n\t\t\t\t} else if (face == 3.0) {\n\t\t\t\t\tuv = vec2(-direction.z, direction.y) / abs(direction.x); // neg x\n\t\t\t\t} else if (face == 4.0) {\n\t\t\t\t\tuv = vec2(-direction.x, direction.z) / abs(direction.y); // neg y\n\t\t\t\t} else {\n\t\t\t\t\tuv = vec2(direction.x, direction.y) / abs(direction.z); // neg z\n\t\t\t\t}\n\t\t\t\treturn 0.5 * (uv + 1.0);\n\t\t}");a.useKeywords=!1;let o=new $C("TextureCubeUVData bilinearCubeUV(sampler2D envMap, vec3 direction, float mipInt) {\n\t\t\tfloat face = getFace(direction);\n\t\t\tfloat filterInt = max(cubeUV_minMipLevel - mipInt, 0.0);\n\t\t\tmipInt = max(mipInt, cubeUV_minMipLevel);\n\t\t\tfloat faceSize = exp2(mipInt);\n\t\t\tfloat texelSize = 1.0 / (3.0 * cubeUV_maxTileSize);\n\t\t\tvec2 uv = getUV(direction, face) * (faceSize - 1.0);\n\t\t\tvec2 f = fract(uv);\n\t\t\tuv += 0.5 - f;\n\t\t\tif (face > 2.0) {\n\t\t\t\tuv.y += faceSize;\n\t\t\t\tface -= 3.0;\n\t\t\t}\n\t\t\tuv.x += face * faceSize;\n\t\t\tif(mipInt < cubeUV_maxMipLevel){\n\t\t\t\tuv.y += 2.0 * cubeUV_maxTileSize;\n\t\t\t}\n\t\t\tuv.y += filterInt * 2.0 * cubeUV_minTileSize;\n\t\t\tuv.x += 3.0 * max(0.0, cubeUV_maxTileSize - 2.0 * faceSize);\n\t\t\tuv *= texelSize;\n\t\t\tvec4 tl = texture2D(envMap, uv);\n\t\t\tuv.x += texelSize;\n\t\t\tvec4 tr = texture2D(envMap, uv);\n\t\t\tuv.y += texelSize;\n\t\t\tvec4 br = texture2D(envMap, uv);\n\t\t\tuv.x -= texelSize;\n\t\t\tvec4 bl = texture2D(envMap, uv);\n\t\t\treturn TextureCubeUVData( tl, tr, br, bl, f );\n\t\t}",[e,s,a,t,n,i,r]);o.useKeywords=!1;let l=new nM("float r0 1.0",!0),c=new nM("float v0 0.339",!0),h=new nM("float m0 -2.0",!0),u=new nM("float r1 0.8",!0),d=new nM("float v1 0.276",!0),p=new nM("float m1 -1.0",!0),f=new nM("float r4 0.4",!0),m=new nM("float v4 0.046",!0),g=new nM("float m4 2.0",!0),v=new nM("float r5 0.305",!0),y=new nM("float v5 0.016",!0),b=new nM("float m5 3.0",!0),x=new nM("float r6 0.21",!0),w=new nM("float v6 0.0038",!0),S=new nM("float m6 4.0",!0);return{bilinearCubeUV:o,roughnessToMip:new $C("float roughnessToMip(float roughness) {\n\t\t\tfloat mip = 0.0;\n\t\t\tif (roughness >= r1) {\n\t\t\t\tmip = (r0 - roughness) * (m1 - m0) / (r0 - r1) + m0;\n\t\t\t} else if (roughness >= r4) {\n\t\t\t\tmip = (r1 - roughness) * (m4 - m1) / (r1 - r4) + m1;\n\t\t\t} else if (roughness >= r5) {\n\t\t\t\tmip = (r4 - roughness) * (m5 - m4) / (r4 - r5) + m4;\n\t\t\t} else if (roughness >= r6) {\n\t\t\t\tmip = (r5 - roughness) * (m6 - m5) / (r5 - r6) + m5;\n\t\t\t} else {\n\t\t\t\tmip = -2.0 * log2(1.16 * roughness);// 1.16 = 1.79^0.25\n\t\t\t}\n\t\t\treturn mip;\n\t\t}",[l,c,h,u,d,p,f,m,g,v,y,b,x,w,S]),m0:h,cubeUV_maxMipLevel:t}}();var bM=class extends WC{constructor(e){super("v3"),this.nodeType="Normal",this.scope=null!==e&&void 0!==e?e:bM.VIEW}getShared(){return this.scope===bM.WORLD}build(e,t,n,i){let r=e.context[this.scope+"Normal"];return r?r.build(e,t,n,i):super.build(e,t,n)}generate(e,t,n,i,r){let s;switch(this.scope){case bM.VIEW:s=e.isShader("vertex")?"transformedNormal":"geometryNormal";break;case bM.LOCAL:e.isShader("vertex")?s="objectNormal":(e.requires.normal=!0,s="vObjectNormal");break;case bM.WORLD:e.isShader("vertex")?s="inverseTransformDirection( transformedNormal, viewMatrix ).xyz":(e.requires.worldNormal=!0,s="vWNormal")}return e.format(s,this.getType(e),t)}},xM=bM;xM.LOCAL="local",xM.WORLD="world",xM.VIEW="view",xM.NORMAL="normal",HC.addKeyword("viewNormal",(function(){return new xM(xM.VIEW)})),HC.addKeyword("localNormal",(function(){return new xM(xM.NORMAL)})),HC.addKeyword("worldNormal",(function(){return new xM(xM.WORLD)}));var wM=class extends WC{constructor(e){super("v3"),this.nodeType="Position",this.scope=null!==e&&void 0!==e?e:wM.LOCAL}getType(){return this.scope===wM.PROJECTION?"v4":this.type}getShader(){switch(this.scope){case wM.LOCAL:case wM.WORLD:return!1}return!0}generate(e,t,n,i,r){let s;switch(this.scope){case wM.LOCAL:e.isShader("vertex")?s="transformed":(e.requires.position=!0,s="vPosition");break;case wM.WORLD:if(e.isShader("vertex"))return"( modelMatrix * vec4( transformed, 1.0 ) ).xyz";e.requires.worldPosition=!0,s="vWPosition";break;case wM.VIEW:s=e.isShader("vertex")?"-mvPosition.xyz":"vViewPosition";break;case wM.PROJECTION:s=e.isShader("vertex")?"( projectionMatrix * modelViewMatrix * vec4( position, 1.0 ) )":"vec4( 0.0 )"}return e.format(s,this.getType(),t)}},SM=wM;SM.LOCAL="local",SM.WORLD="world",SM.VIEW="view",SM.PROJECTION="projection",HC.addKeyword("position",(function(){return new SM})),HC.addKeyword("worldPosition",(function(){return new SM(SM.WORLD)})),HC.addKeyword("viewPosition",(function(){return new SM(SM.VIEW)}));var _M=class extends WC{constructor(e){super("v3"),this.nodeType="Reflect",this.scope=null!==e&&void 0!==e?e:_M.CUBE}getUnique(e){return!e.context.viewNormal}getType(){return this.scope===_M.SPHERE?"v2":this.type}generate(e,t){let n=this.getUnique(e);if(e.isShader("fragment")){let i;switch(this.scope){case _M.VECTOR:{let t=new xM(xM.VIEW),r=e.context.roughness,s=t.build(e,"v3"),a=new SM(SM.VIEW).build(e,"v3"),o=r?r.build(e,"f"):void 0,l="reflect( -normalize( ".concat(a," ), ").concat(s," )");o&&(l="normalize( mix( ".concat(l,", ").concat(s,", ").concat(o," * ").concat(o," ) )"));let c="inverseTransformDirection( ".concat(l,", viewMatrix )");n?(e.addNodeCode("vec3 reflectVec = ".concat(c,";")),i="reflectVec"):i=c;break}case _M.CUBE:{let t=new _M(_M.VECTOR).build(e,"v3"),r="vec3( -"+t+".x, "+t+".yz )";n?(e.addNodeCode("vec3 reflectCubeVec = ".concat(r,";")),i="reflectCubeVec"):i=r;break}case _M.SPHERE:{let t="normalize( ( viewMatrix * vec4( "+new _M(_M.VECTOR).build(e,"v3")+", 0.0 ) ).xyz + vec3( 0.0, 0.0, 1.0 ) ).xy * 0.5 + 0.5";n?(e.addNodeCode("vec2 reflectSphereVec = ".concat(t,";")),i="reflectSphereVec"):i=t;break}}return e.format(i,this.getType(),t)}return console.warn("ReflectNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.type,t)}},EM=_M;EM.CUBE="cube",EM.SPHERE="sphere",EM.VECTOR="vector";var AM=class extends WC{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new hM,t=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0;super("v4"),this.nodeType="TextureCube",this.value=e,this.radianceNode=new yM(this.value,null!==t&&void 0!==t?t:new EM(EM.VECTOR),n),this.irradianceNode=new yM(this.value,new xM(xM.WORLD),new uM(1).setReadonly(!0))}generate(e,t){return e.isShader("fragment")?(e.require("irradiance"),e.context.bias&&e.context.bias.setTexture(this.value),("irradiance"===e.slot?this.irradianceNode:this.radianceNode).build(e,t)):(console.warn("TextureCubeNode is not compatible with "+e.shader+" shader."),e.format("vec4( 0.0 )",this.getType(e),t))}},CM=class extends qC{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Ni,t=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0;super("v4",{shared:!0}),this.nodeType="CubeTexture",this.value=e,this.uv=null!==t&&void 0!==t?t:new EM,this.bias=n}getTexture(e,t){return super.generate(e,t,this.value.uuid,"tc")}generate(e,t){var n,i;if("samplerCube"===t)return this.getTexture(e,t);let r,s=this.getTexture(e,t),a=null===(n=this.uv)||void 0===n?void 0:n.build(e,"v3"),o=this.bias?this.bias.build(e,"f"):void 0;void 0===o&&e.context.bias&&(o=e.context.bias.setTexture(this).build(e,"f")),r=o?"texCubeBias( "+s+", "+a+", "+o+" )":"texCube( "+s+", "+a+" )";let l={include:e.isShader("vertex"),ignoreCache:!0},c=this.getType(e);return e.addContext(l),this.colorSpace=null!==(i=this.colorSpace)&&void 0!==i?i:new lM(new cM("",c)),this.colorSpace.fromDecoding(e.getTextureEncodingFromMap(this.value)),this.colorSpace.input.parse(r),r=this.colorSpace.build(e,c),e.removeContext(),e.format(r,c,t)}},MM=["x","y","z","w"],TM=["float","vec2","vec3","vec4"],PM={float:"f",vec2:"v2",vec3:"v3",vec4:"v4",mat4:"v4",int:"i",bool:"b","float[]":"f[]","vec4[]":"v4[]"},DM={t:"sampler2D",tc:"samplerCube",b:"bool",i:"int",f:"float",c:"vec3",v2:"vec2",v3:"vec3",v4:"vec4",m3:"mat3",m4:"mat4","f[]":"float[]","v4[]":"vec4[]"},OM=class{constructor(){this.includes={consts:{},functions:{},structs:{}},this.cache="",this.slot="",this.shader="",this.context={},this.needsJitter=!0,this.getIncludesCode=function(){function e(e,t){return e.deps.length-t.deps.length}return function(t,n){let i=this.getIncludes(t,n);if(!i)return"";let r="";i=i.sort(e);for(let e=0;e<i.length;e++)i[e].src&&(r+=i[e].src+"\n");return r}}(),this.slots=[],this.caches=[],this.contexts=[],this.keywords={},this.nodeData={},this.fragmentVariables={},this.fragmentParsVariables={},this.vertexParsVariables={},this.requires={uv:[],color:[],transparent:!1,irradiance:!1,position:!1,worldPosition:!1,normal:!1,worldNormal:!1,vWorldViewDir:!1,modelMatrix:!1,viewMatrix:!1,projectionMatrix:!1},this.includes={consts:[],functions:[],structs:[]},this.attributes={},this.prefixCode=["#ifdef TEXTURE_LOD_EXT","\t#define texCube(a, b) textureCube(a, b)","\t#define texCubeBias(a, b, c) textureCubeLodEXT(a, b, c)","\t#define tex2D(a, b) texture2D(a, b)","\t#define tex2DBias(a, b, c) texture2DLodEXT(a, b, c)","#else","\t#define texCube(a, b) textureCube(a, b)","\t#define texCubeBias(a, b, c) textureCube(a, b, c)","\t#define tex2D(a, b) texture2D(a, b)","\t#define tex2DBias(a, b, c) texture2D(a, b, c)","#endif","\n\t\t\t// NOTE: Include Spline's blending modes. This could be part of BlendNode\n\t\t\t#define SPE_BLENDING_NORMAL 0\n\t\t\t#define SPE_BLENDING_MULTIPLY 1\n\t\t\t#define SPE_BLENDING_SCREEN 2\n\t\t\t#define SPE_BLENDING_OVERLAY 3\n\n\t\t\tvec3 spe_normalBlend( vec3 a, vec3 b, float alpha ) {\n\t\t\t\treturn mix( a, b, alpha );\n\t\t\t}\n\n\t\t\tvec3 spe_multiplyBlend( vec3 a, vec3 b, float alpha ) {\n\t\t\t\treturn mix( a, a * b, alpha );\n\t\t\t}\n\n\t\t\tvec3 spe_screenBlend( vec3 a, vec3 b, float alpha ) {\n\t\t\t\tvec3 tmp = 1.0 - ( 1.0 - a ) * ( 1.0 - b );\n\t\t\t\treturn mix( a, tmp, alpha );\n\t\t\t}\n\n\t\t\tvec3 spe_overlayBlend( vec3 a, vec3 b, float alpha ) {\n\t\t\t\tvec3 tmp = mix( 1. - 2. * (1. - a) * (1. - b), 2. * a * b, step( a, vec3(.5) ) );\n\t\t\t\treturn clamp( mix( a, tmp, alpha ), 0.0, 1.0 );\n\t\t\t}\n\n\t\t\tvec3 spe_blend( vec3 a, vec3 b, float alpha, int mode ) {\n\t\t\t\tif ( mode == SPE_BLENDING_NORMAL ) return spe_normalBlend( a, b, alpha );\n\t\t\t\telse if ( mode == SPE_BLENDING_MULTIPLY ) return spe_multiplyBlend( a, b, alpha );\n\t\t\t\telse if ( mode == SPE_BLENDING_SCREEN ) return spe_screenBlend( a, b, alpha );\n\t\t\t\telse if ( mode == SPE_BLENDING_OVERLAY ) return spe_overlayBlend( a, b, alpha );\n\t\t\t\treturn vec3( 1.0 );\n\t\t\t}\n\t\t\t","#include <packing>","#include <common>"].join("\n"),this.parsCode={vertex:["float neighbor_offset = 0.0001;",""].join("\n"),fragment:["float accumAlpha = 0.0;","void accumulateAlpha(float alpha) {\n\t\t\t\t\taccumAlpha += (1.0 - accumAlpha) * alpha;\n\t\t\t\t}",""].join("\n")},this.code={vertex:"",fragment:""},this.nodeCode={vertex:"",fragment:""},this.resultCode={vertex:"",fragment:""},this.finalCode={vertex:"",fragment:""},this.inputs={uniforms:{list:[],vertex:[],fragment:[]},arrayUniforms:{list:[],vertex:[],fragment:[]},vars:{varying:[],vertex:[],fragment:[]}},this.defines={},this.uniforms={},this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.updaters=[],this.nodes=[],this.analyzing=!1}build(e,t){this.addVertexParsCode("\nuniform int frameIndex;\nuniform vec2 resolution;\nuniform mat4 previousModelViewMatrix;\nuniform mat4 previousProjectionMatrix;\n\nvarying vec4 vCurrentPosition;\nvarying vec4 vPreviousPosition;\n"),this.addFragmentParsCode("\nlayout(location = 1) out vec4 gVelocity;\n\nuniform int frameIndex;\nuniform vec2 resolution;\n\nvarying vec4 vCurrentPosition;\nvarying vec4 vPreviousPosition;\n\nconst vec2 haltonSequence[16] = vec2[16](\nvec2( 0.000000,-0.333334),\nvec2(-0.500000, 0.333334),\nvec2( 0.500000,-0.777778),\nvec2(-0.750000,-0.111112),\nvec2( 0.250000, 0.555556),\nvec2(-0.250000,-0.555556),\nvec2( 0.750000, 0.111112),\nvec2(-0.875000, 0.777778),\nvec2(0.125000, -0.925926),\nvec2(-0.375000, -0.259260),\nvec2(0.625000, 0.407408),\nvec2(-0.625000, -0.703704),\nvec2(0.375000, -0.037038),\nvec2(-0.125000, 0.629630),\nvec2(0.875000, -0.481482),\nvec2(-0.937500, 0.185186));\n\nvec2 vogelDiskSample(int sampleIndex, int sampleCount, float angle) {\n  const float goldenAngle = 2.399963f; // radians\n  float r = sqrt(float(sampleIndex) + 0.5f) / sqrt(float(sampleCount));\n  float theta = float(sampleIndex) * goldenAngle + angle;\n  float sine = sin(theta);\n  float cosine = cos(theta);\n  return vec2(cosine, sine) * r;\n}\n\n// Derived from the interleaved gradient function from Jimenez 2014 http:goo.gl/eomGso\nfloat getNoiseInterleavedGradient(vec2 screenPos) {\n    vec3 magic = vec3(0.06711056f, 0.00583715f, 52.9829189f);\n    return fract(magic.z * fract(dot(screenPos, magic.xy)));\n}\n\n"),this.buildShader("vertex",e),this.buildShader("fragment",t);for(let n=0;n<this.requires.uv.length;n++)if(this.requires.uv[n]){let e=n>0?n+1:"";this.addVaryCode("varying vec2 vUv"+e+";"),n>0&&this.addVertexParsCode("attribute vec2 uv"+e+";"),this.addVertexFinalCode("vUv"+e+" = uv"+e+";")}return this.requires.color[0]&&(this.addVaryCode("varying vec4 vColor;"),this.addVertexParsCode("attribute vec4 color;"),this.addVertexFinalCode("vColor = color;")),this.requires.color[1]&&(this.addVaryCode("varying vec4 vColor2;"),this.addVertexParsCode("attribute vec4 color2;"),this.addVertexFinalCode("vColor2 = color2;")),this.requires.position&&(this.addVaryCode("varying vec3 vPosition;"),this.addVertexFinalCode("vPosition = transformed;")),this.requires.worldPosition,this.requires.normal&&(this.addVaryCode("varying vec3 vObjectNormal;"),this.addVertexFinalCode("\n\t\t\t\t#ifndef SHAPEBLEND \n\t\t\t\t\tvObjectNormal = normal;\n\t\t\t\t#else\n\t\t\t\t\tvObjectNormal = objectNormal;\n\t\t\t\t#endif\n\t\t\t")),this.requires.modelMatrix&&this.addFragmentParsCode("uniform mat4 modelMatrix;"),this.requires.viewMatrix&&this.addFragmentParsCode("uniform mat4 viewMatrix;"),this.requires.projectionMatrix&&this.addFragmentParsCode("uniform mat4 projectionMatrix;"),this.requires.worldNormal&&(this.addVaryCode("varying vec3 vWNormal;"),this.addVertexFinalCode("vWNormal = inverseTransformDirection( transformedNormal, viewMatrix ).xyz;")),this.requires.vWorldViewDir&&(this.addVaryCode("varying vec3 vWorldViewDir;"),this.addVertexFinalCode("vWorldViewDir = isPerspectiveMatrix( projectionMatrix ) ?  ( (modelMatrix * vec4(position, 1.0)).xyz - cameraPosition ) : vec3( -viewMatrix[0][2], -viewMatrix[1][2], -viewMatrix[2][2] );")),this.needsJitter&&(this.addVertexFinalCode("\n// TODO: This could be generated CPU side and passed to the shader every frame\nconst vec2 haltonSequence[16] = vec2[16](\nvec2( 0.000000,-0.333334),\nvec2(-0.500000, 0.333334),\nvec2( 0.500000,-0.777778),\nvec2(-0.750000,-0.111112),\nvec2( 0.250000, 0.555556),\nvec2(-0.250000,-0.555556),\nvec2( 0.750000, 0.111112),\nvec2(-0.875000, 0.777778),\nvec2(0.125000, -0.925926),\nvec2(-0.375000, -0.259260),\nvec2(0.625000, 0.407408),\nvec2(-0.625000, -0.703704),\nvec2(0.375000, -0.037038),\nvec2(-0.125000, 0.629630),\nvec2(0.875000, -0.481482),\nvec2(-0.937500, 0.185186));\n\n// TODO: Pass correct view size\nvec2 offset = haltonSequence[frameIndex];\noffset.x /= resolution.x;\noffset.y /= resolution.y;\n\nvec4 currentPosition = gl_Position;\nvec4 currentPositionJittered = currentPosition + (vec4(offset.x, offset.y, 0.0, 0.0) * currentPosition.w);\n\n// We want to calculate the velocity with unjittered positions\n// so that things that are not moving get a velocity = 0\nvCurrentPosition = currentPosition;\nvPreviousPosition = previousProjectionMatrix * previousModelViewMatrix * vec4(transformed, 1.0);\n#ifdef OUTLINE_COMPENSATION\nvPreviousPosition.xy += OUTLINE_COMPENSATION;\n#endif\ngl_Position = currentPositionJittered;\n\n"),this.addFragmentFinalCode("\nvec2 oldPos = vPreviousPosition.xy;\n    oldPos /= vPreviousPosition.w;\n    oldPos.xy = (oldPos.xy+1.)/2.0;\n\nvec2 newPos = vCurrentPosition.xy;\n    newPos /= vCurrentPosition.w;\n    newPos.xy = (newPos.xy+1.)/2.0;\n\nvec2 velocity = (newPos - oldPos);\n\n// Discard fully transparent pixels \nif (gl_FragColor.a <= 0.0) discard;\n\ngVelocity = vec4(velocity, 0.0, 1.0);\n")),this}buildShader(e,t){this.resultCode[e]=t.build(this.setShader(e),"v4")}setMaterial(e,t){return this.defines={},this}addFlow(e,t,n){return this.addSlot(e).addCache(t).addContext(n)}removeFlow(){return this.removeSlot().removeCache().removeContext()}addCache(e){return this.cache=null!==e&&void 0!==e?e:"",this.caches.push(this.cache),this}removeCache(){return this.caches.pop(),this.cache=this.caches[this.caches.length-1]||"",this}addContext(e){return this.context=Object.assign({},this.context,e),this.context.extra=this.context.extra||{},this.contexts.push(this.context),this}removeContext(){return this.contexts.pop(),this.context=this.contexts[this.contexts.length-1]||{},this}addSlot(e){return this.slot=e||"",this.slots.push(this.slot),this}removeSlot(){return this.slots.pop(),this.slot=this.slots[this.slots.length-1]||"",this}addFragmentVariable(e,t){void 0===this.fragmentVariables[e]&&(this.addFragmentCode("".concat(t," ").concat(e,";")),this.fragmentVariables[e]="")}addFragmentParsVariable(e,t){void 0===this.fragmentParsVariables[e]&&(this.addFragmentParsCode("".concat(t," ").concat(e,";")),this.fragmentParsVariables[e]="")}addVertexParsVariable(e,t){void 0===this.vertexParsVariables[e]&&(this.addVertexParsCode("".concat(t," ").concat(e,";")),this.vertexParsVariables[e]="")}addVertexCode(e){this.addCode(e,"vertex")}addFragmentCode(e){this.addCode(e,"fragment")}addCode(e,t){this.code[null!==t&&void 0!==t?t:this.shader]+=e+"\n"}addVertexNodeCode(e){this.addNodeCode(e,"vertex")}addFragmentNodeCode(e){this.addNodeCode(e,"fragment")}addNodeCode(e,t){this.nodeCode[null!==t&&void 0!==t?t:this.shader]+=e+"\n"}clearNodeCode(e){e=null!==e&&void 0!==e?e:this.shader;let t=this.nodeCode[e];return this.nodeCode[e]="",t}clearVertexNodeCode(){return this.clearNodeCode("vertex")}clearFragmentNodeCode(){return this.clearNodeCode("fragment")}addVertexFinalCode(e){this.addFinalCode(e,"vertex")}addFragmentFinalCode(e){this.addFinalCode(e,"fragment")}addFinalCode(e,t){this.finalCode[null!==t&&void 0!==t?t:this.shader]+=e+"\n"}addVertexParsCode(e){this.addParsCode(e,"vertex")}addFragmentParsCode(e){this.addParsCode(e,"fragment")}addParsCode(e,t){this.parsCode[null!==t&&void 0!==t?t:this.shader]+=e+"\n"}addVaryCode(e){this.addVertexParsCode(e),this.addFragmentParsCode(e)}isCache(e){return-1!==this.caches.indexOf(e)}isSlot(e){return-1!==this.slots.indexOf(e)}define(e,t){this.defines[e]=void 0===t?1:t}require(e){this.requires[e]=!0}isDefined(e){return void 0!==this.defines[e]}getVar(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"varying",r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"V",s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"",a=this.getVars(i),o=a[e];if(!o){let i=a.length;o={name:n||"node"+r+i+(s?"_"+s:""),type:t},a.push(o),a[e]=o}return o}getTempVar(e,t,n,i){return this.getVar(e,t,n,this.shader,"T",i)}getAttribute(e,t){if(!this.attributes[e]){let n=this.getVar(e,t);this.addVertexParsCode("attribute "+t+" "+e+";"),this.addVertexFinalCode(n.name+" = "+e+";"),this.attributes[e]={varying:n,name:e,type:t}}return this.attributes[e]}getCode(e){return[this.prefixCode,this.parsCode[e],this.getVarListCode(this.getVars("varying"),"varying"),this.getVarListCode(this.inputs.uniforms[e],"uniform"),this.getVarListCode(this.inputs.arrayUniforms[e],"uniform"),this.getIncludesCode("consts",e),this.getIncludesCode("structs",e),this.getIncludesCode("functions",e),"void main() {",this.getVarListCode(this.getVars(e)),this.code[e],this.resultCode[e],this.finalCode[e],"}"].join("\n")}getVarListCode(e,t){t=null!==t&&void 0!==t?t:"";let n="";for(let i=0,r=e.length;i<r;++i){let r=e[i],s=r.type,a=r.name,o=r.size,l=this.getFormatByType(s);if(void 0===l)throw new Error("Node pars "+l+" not found.");l.includes("[]")?n+=t+" "+l.substring(0,l.length-2)+" "+a+"[".concat(o,"];\n"):n+=t+" "+l+" "+a+";\n"}return n}getVars(e){return this.inputs.vars[null!==e&&void 0!==e?e:this.shader]}getNodeData(e){let t=e instanceof VC?e.uuid:e;return this.nodeData[t]=this.nodeData[t]||{}}createUniform(e,t,n,i,r,s){if(t.includes("[]")){let a=this.inputs.arrayUniforms,o=a.list.length,l=new GC({type:t,size:n.size,name:i||"nodeUA"+o+(s?"_"+s:""),node:n,needsUpdate:r});return a.list.push(l),a[e].push(l),a[e][l.name]=l,this.uniforms[l.name]=l,l}{let a=this.inputs.uniforms,o=a.list.length,l=new GC({type:t,name:i||"nodeU"+o+(s?"_"+s:""),node:n,needsUpdate:r});return a.list.push(l),a[e].push(l),a[e][l.name]=l,this.uniforms[l.name]=l,l}}createVertexUniform(e,t,n,i,r){return this.createUniform("vertex",e,t,n,i,r)}createFragmentUniform(e,t,n,i,r){return this.createUniform("fragment",e,t,n,i,r)}include(e,t,n){let i;if(e="string"==typeof e?HC.get(e):e,!1===this.context.include)return e.name;e instanceof $C?i=this.includes.functions:e instanceof nM?i=this.includes.consts:e instanceof sM&&(i=this.includes.structs);let r=i[this.shader]=i[this.shader]||[];if(e){var s;let i=r[e.name];if(i||(i=r[e.name]={node:e,deps:[]},r.push(i),i.src=e.build(this,"source")),e instanceof $C&&t&&r[t.name]&&-1===r[t.name].deps.indexOf(e)&&(r[t.name].deps.push(e),null!==(s=e.includes)&&void 0!==s&&s.length)){let n=0;do{this.include(e.includes[n++],t)}while(n<e.includes.length)}return n&&(i.src=n),e.name}throw new Error("Include not found.")}colorToVectorProperties(e){return e.replace("r","x").replace("g","y").replace("b","z").replace("a","w")}colorToVector(e){return e.replace(/c/g,"v3")}getIncludes(e,t){return this.includes[e][t||this.shader]}getConstructorFromLength(e){return TM[e-1]}isTypeMatrix(e){return/^m/.test(e)}getTypeLength(e){return"f"===e?1:parseInt(this.colorToVector(e).substr(1))}getTypeFromLength(e){return 1===e?"f":"v"+e}findNode(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];for(let i=0;i<arguments.length;i++){let e=t[i];if(null!==e&&void 0!==e&&e.isNode)return e}}resolve(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];for(let i=0;i<arguments.length;i++){let e=t[i];if(void 0!==e){if(e.isNode)return e;if(e.isTexture)switch(e.mapping){case ne:case ie:return new CM(e);case re:return new AM(new hM(e));default:return new hM(e)}else{if(e.isVector2)return new XC(e);if(e.isVector3)return new YC(e);if(e.isVector4)return new KC(e)}}}}format(e,t,n){switch(this.colorToVector(n+" <- "+t)){case"f <- v2":case"f <- v3":case"f <- v4":return e+".x";case"f <- i":case"f <- b":return"float( "+e+" )";case"v2 <- f":return"vec2( "+e+" )";case"v2 <- v3":case"v2 <- v4":return e+".xy";case"v2 <- i":case"v2 <- b":case"v3 <- i":case"v3 <- b":return"vec2( float( "+e+" ) )";case"v3 <- f":return"vec3( "+e+" )";case"v3 <- v2":return"vec3( "+e+", 0.0 )";case"v3 <- v4":return e+".xyz";case"v4 <- f":return"vec4( "+e+" )";case"v4 <- v2":return"vec4( "+e+", 0.0, 1.0 )";case"v4 <- v3":return"vec4( "+e+", 1.0 )";case"v4 <- i":case"v4 <- b":return"vec4( float( "+e+" ) )";case"i <- f":case"i <- b":return"int( "+e+" )";case"i <- v2":case"i <- v3":case"i <- v4":return"int( "+e+".x )";case"b <- f":return"( "+e+" != 0.0 )";case"b <- v2":return"( "+e+" != vec2( 0.0 ) )";case"b <- v3":return"( "+e+" != vec3( 0.0 ) )";case"b <- v4":return"( "+e+" != vec4( 0.0 ) )";case"b <- i":return"( "+e+" != 0 )"}return e}getTypeByFormat(e){return PM[e]||e}getFormatByType(e){return DM[e]||e}getUUID(e,t){return(t=void 0===t||t)&&this.cache&&(e=this.cache+"-"+e),e}getElementByIndex(e){return MM[e]}getIndexByElement(e){return MM.indexOf(e)}isShader(e){return this.shader===e}setShader(e){return this.shader=e,this}mergeDefines(e){for(let t in e)this.defines[t]=e[t];return this.defines}mergeUniform(e){for(let t in e)this.uniforms[t]=e[t];return this.uniforms}getTextureEncodingFromMap(e){let t;return e?e.isTexture&&(t=e.encoding):t=ze,t===ze&&this.context.gamma&&(t=Ne),t}},IM=class extends qC{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0,i=arguments.length>3?arguments[3]:void 0;super("c"),this.nodeType="Color",this.value=e instanceof QC?e:new QC(e||0,t,n,i)}setRGBA(e){this.value.setRGBA(e.r,e.g,e.b,e.a)}generate(e,t,n,i,r,s){n=e.getUUID(null!==n&&void 0!==n?n:this.getUUID()),i=null!==i&&void 0!==i?i:this.getType(e);let a=e.getNodeData(n),o=this.getReadonly()&&void 0!==this.generateReadonly;if(this.alpha){let t=this.alpha.build(e,"f");e.addFragmentNodeCode("accumAlpha += ( 1.0 - accumAlpha ) * ".concat(t,";"))}return o?this.generateReadonly(e,t,n,i,r,s):e.isShader("vertex")?(a.vertex||(a.vertex=e.createVertexUniform(i,this,r,s,this.getLabel())),e.format(a.vertex.name,i,t)):(a.fragment||(a.fragment=e.createFragmentUniform(i,this,r,s,this.getLabel())),e.format(a.fragment.name,i,t))}generateReadonly(e,t,n,i,r,s){return e.format("vec3("+this.value.r+", "+this.value.g+", "+this.value.b+")",i,t)}},RM=class extends qC{constructor(e){super("i"),this.nodeType="Int",this.value=Math.floor(null!==e&&void 0!==e?e:0)}generateReadonly(e,t,n,i,r,s){return e.format(this.value.toString(),i,t)}},kM=class extends qC{constructor(e){super("b"),this.nodeType="Bool",this.value=null!==e&&void 0!==e&&e}generateReadonly(e,t,n,i){return e.format(this.value?"true":"false",i,t)}},LM=class extends qC{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1?arguments[1]:void 0;super("f[]"),this.nodeType="FloatArray",this.size=e,this.value=Array.isArray(t)?t:"number"==typeof t?new Array(e).fill(t):new Array(e).fill(0)}},BM=class extends qC{},zM=class extends BM{constructor(e){super("v3"),this.image=e,this._value=new Bt}get value(){var e,t;return this._value.x=this.image.isVideo?null!==(e=this.image.img.videoWidth)&&void 0!==e?e:0:this.image.img.width,this._value.y=this.image.isVideo?null!==(t=this.image.img.videoHeight)&&void 0!==t?t:0:this.image.img.height,this._value}},NM=class extends BM{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1008,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1006;super("t"),this.image=e,this.wrap=t,this.minFilter=n,this.magFilter=i}get value(){return this.image.getTexture(this.wrap,this.minFilter,this.magFilter)}},FM=class extends qC{constructor(e){super("m3"),this.nodeType="Matrix3",this.value=null!==e&&void 0!==e?e:new lt}generateReadonly(e,t,n,i,r,s){return e.format("mat3("+this.value.elements.join(", ")+")",i,t)}get elements(){return this.value.elements}set elements(e){this.value.fromArray(e)}},UM=class extends qC{constructor(e){super("m4"),this.nodeType="Matrix4",this.value=null!==e&&void 0!==e?e:new pn}generateReadonly(e,t,n,i,r,s){return e.format("mat4("+this.value.elements.join(", ")+")",i,t)}get elements(){return this.value.elements}set elements(e){this.value.fromArray(e)}};function jM(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;e.setUvTransform(n[0],n[1],t[0],t[1],0,0,0).premultiply((new lt).makeRotation(i*at.DEG2RAD))}var VM=class extends FM{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;super(new lt),this.repeat=e,this.offset=t,this.rotation=n,jM(this.value,e,t,n)}updateMatrix(){jM(this.value,this.repeat,this.offset,this.rotation)}},GM=class extends qC{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1?arguments[1]:void 0;super("v4[]"),this.nodeType="Vector4Array",this.size=e,this.value=Array.isArray(t)?t:t instanceof Ot?new Array(e).fill(t):new Array(e).fill(new Ot(0))}},HM=class extends WC{constructor(e,t,n,i){super("v3"),this.nodeType="Blend",this.a=e,this.b=t,this.alpha=n,this.mode=i}generate(e,t){if(e.isShader("fragment")){let n=[];return n.push(this.a.build(e,"c")),n.push(this.b.build(e,"c")),n.push(this.alpha.build(e,"f")),n.push(this.mode.build(e,"i")),e.format("spe_blend("+n.join(",")+")",this.getType(e),t)}return console.warn("BlendNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},WM=class extends WC{constructor(e,t){super("v3"),this.nodeType="CustomColor",this.color=e,this.alpha=t,this.calpha="g".concat(this.uuid.toString().replace(/-/g,""),"_calpha")}generate(e,t){if(e.isShader("fragment")){let n=e.include(WM.Nodes.customColor);e.addFragmentVariable(this.calpha,"float");let i=[];return i.push(this.color.build(e,"v3")),i.push(this.mask?"luminance(".concat(this.mask.build(e,"v3"),")"):"1.0"),i.push(this.alpha.build(e,"f")),i.push(this.calpha),e.format(n+"("+i.join(",")+")",this.getType(e),t)}return console.warn("CustomColorNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},qM=WM;qM.Nodes={customColor:new $C("vec3 customColor(vec3 color, float mask, float alpha, out float calpha) {\n\t\t\t\tfloat lalpha = alpha * mask;\n\t\t\t\tcalpha =  lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0);\n\t\t\t\taccumAlpha += (1.0 - accumAlpha) * lalpha;\n\n\t\t\t\treturn color;\n\t\t\t}")};var XM=class extends WC{constructor(e,t){super("v3"),this.nodeType="CustomNormal",this.cnormal=e,this.alpha=t,this.calpha="g".concat(this.uuid.toString().replace(/-/g,""),"_calpha")}generate(e,t){if(e.isShader("fragment")){let n=e.include(XM.Nodes.customNormal);e.addFragmentVariable(this.calpha,"float");let i=[];return i.push(this.cnormal.build(e,"v3")),i.push("normal"),i.push(this.mask?"luminance(".concat(this.mask.flow(e,"v3").result,")"):"1.0"),i.push(this.alpha.build(e,"f")),i.push(this.calpha),e.format(n+"("+i.join(",")+")",this.getType(e),t)}return console.warn("CustomNormalNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},YM=XM;YM.Nodes={customNormal:new $C("vec3 customNormal(vec3 cnormal, vec3 norm, float mask, float alpha, out float calpha) {\n\t\t\t\tvec3 normal = packNormalToRGB( norm ).rgb;\n\t\t\t\tnormal *= step( vec3(0.5), cnormal );\n\n\t\t\t\tfloat lalpha = alpha * mask;\n\t\t\t\tcalpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );\n\t\t\t\taccumAlpha += ( 1.0 - accumAlpha ) * lalpha;\n\n\t\t\t\treturn normal;\n\t\t\t}")};var QM=class extends WC{constructor(e,t,n,i,r,s,a,o,l,c,h,u){super("v3"),this.nodeType="CustomTexture",this.texture=e,this.textureSize=t,this.crop=n,this.projection=i,this.axis=r,this.side=s,this.size=a,this.blending=o,this.mat=l,this.isMask=u,this.alpha=c,this.mode=h,this.calpha="g".concat(this.uuid.toString().replace(/-/g,""),"_calpha")}generate(e,t){e.require("position"),e.require("normal"),e.require("uv"),e.requires.uv=[!0],e.extensions.shaderTextureLOD=!0,e.extensions.derivatives=!0;let n,i="g".concat(this.uuid.toString().replace(/-/g,""));switch(this.projection.value){case 3:n=e.include(QM.Nodes.cylindrical);break;case 2:n=e.include(QM.Nodes.spherical);break;case 1:let t=["vec3(1.0, 0.0, 0.0)","vec3(0.0, 1.0, 0.0)","vec3(0.0, 0.0, 1.0)"][this.axis.value],r=["zy","xz","xy"][this.axis.value],s=new $C("\n\t\tvec3 ".concat(i,"_planarTexture(vec3 normal, sampler2D tex, vec2 textureSize, float crop, mat3 mat, vec2 size, float blending, bool isMask, float mask, float alpha, int mode, out float calpha, out vec2 writeUv) {\n\t\t\t\tvec2 projected = (1. + (position.").concat(r,")) / 2.;\n\t\t\t\tvec2 uvs = ( mat * vec3( (projected * 2. - 1.) / (size * .5), 1. ) / 2. + 0.5 ).xy;\n\t\t\t\twriteUv = uvs;\n\n\t\t\t\tvec4 tmp = texture2D( tex, uvs );\n\n\t\t\t\tvec3 col = tmp.rgb;\n\t\t\t\tfloat lalpha = alpha * tmp.a;\n\t\t\t\t").concat(2===this.side.value?"":"lalpha *= step(0.0, ".concat(1===this.side.value?"-1.0 * ":"","dot(vObjectNormal, ").concat(t,"));"),"\n\n\t\t\t\tif ( crop > 0.5 ) {\n\t\t\t\t\tif ( uvs.x < 0.0 || uvs.x > 1.0 || uvs.y < 0.0 || uvs.y > 1.0 )  {\n\t\t\t\t\t\tlalpha = 0.0;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tlalpha *= mask;\n\n\t\t\t\tcalpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );\n\t\t\t\taccumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));\n\n\t\t\t\treturn col;\n\t\t\t}"));n=e.include(s);break;case 4:n=e.include(QM.Nodes.triplanar);break;default:n=e.include(QM.Nodes.uv)}e.addFragmentVariable(this.calpha,"float");let r=[];if(r.push("normal"),r.push(this.texture.generate(e,"t")),r.push(this.textureSize.build(e,"v2")),r.push(this.crop.build(e,"f")),r.push(this.mat.build(e,"mat3")),r.push(this.size.build(e,"v2")),r.push(this.blending.build(e,"f")),r.push(this.isMask.build(e,"b")),r.push(this.mask?"luminance(".concat(this.mask.flow(e,"v3").result,")"):"1.0"),r.push(this.alpha.build(e,"f")),r.push(this.mode.build(e,"i")),r.push(this.calpha),4===this.projection.value){let t="".concat(i,"_writeUvs"),n=t+"0",s=t+"1",a=t+"2",o="".concat(i,"_triplanarWeights");e.addFragmentVariable(n,"vec2"),e.addFragmentVariable(s,"vec2"),e.addFragmentVariable(a,"vec2"),e.addFragmentVariable(o,"vec3"),r.push(n),r.push(s),r.push(a),r.push(o)}else{let t="".concat(i,"_writeUvs");e.addFragmentVariable(t,"vec2"),r.push(t)}return e.format(n+"("+r.join(",")+")",this.getType(e),t)}},KM=QM;KM.Nodes={cylindrical:new $C("\nvec3 cylindricalTexture(vec3 normal, sampler2D tex, vec2 textureSize, float crop, mat3 mat, vec2 size, float blending, bool isMask, float mask, float alpha, int mode, out float calpha, out vec2 writeUv) {\n                vec3 posN = normalize(position);\n                float u = 0.5 + atan(posN.z, posN.x) / (2.*3.1415);\n                float scaledHeight = position.y / (size.y * 0.5);\n                float v =  (scaledHeight / 2.) + .5;\n\n                vec2 calculatedUv = vec2(u,v);\n\t\t\t\tvec2 uvs = ( mat * vec3( calculatedUv * 2. - 1., 1. ) / 2. + 0.5 ).xy;\n\t\t\t\twriteUv = uvs;\n\n                vec2 df = fwidth(uvs);\n               \tif(df.x > 0.5) df.x = 0.;\n\n\t\t\t\t#ifdef GL_EXT_shader_texture_lod\n                vec4 tmp = texture2DLodEXT(tex, uvs, log2(max(df.x, df.y)*min(textureSize.x, textureSize.y)));\n\t\t\t\t#else\n                vec4 tmp = textureLod(tex, uvs, log2(max(df.x, df.y)*min(textureSize.x, textureSize.y)));\n\t\t\t\t#endif\n\n\t\t\t\tvec3 col = tmp.rgb;\n\t\t\t\tfloat lalpha = alpha * tmp.a;\n\t\t\t\tif ( crop > 0.5 ) {\n\t\t\t\t\tif ( uvs.x < 0.0 || uvs.x > 1.0 || uvs.y < 0.0 || uvs.y > 1.0 )  {\n\t\t\t\t\t\tlalpha = 0.0;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tlalpha *= mask;\n\t\t\t\t\n\t\t\t\tcalpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );\n\t\t\t\taccumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));\n\n\t\t\t\treturn col;\n\t\t\t}\n"),spherical:new $C("\nvec3 sphericalTexture(vec3 normal, sampler2D tex, vec2 textureSize, float crop, mat3 mat, vec2 size, float blending, bool isMask, float mask, float alpha, int mode, out float calpha, out vec2 writeUv) {\n                vec3 posN = normalize(vPosition);\n                float u = 0.5 + atan(posN.z, posN.x) / (2.*3.1415);\n                float v = 0.5 + asin(posN.y) / 3.1415;\n\n                vec2 calculatedUv = vec2(u,v);\n\t\t\t\tvec2 uvs = ( mat * vec3( calculatedUv * 2. - 1., 1. ) / 2. + 0.5 ).xy;\n\t\t\t\twriteUv = uvs;\n\n                vec2 df = fwidth(uvs);\n               \tif(df.x > 0.5) df.x = 0.;\n\t\t\t\t#ifdef GL_EXT_shader_texture_lod\n                vec4 tmp = texture2DLodEXT(tex, uvs, log2(max(df.x, df.y)*min(textureSize.x, textureSize.y)));\n\t\t\t\t#else\n                vec4 tmp = textureLod(tex, uvs, log2(max(df.x, df.y)*min(textureSize.x, textureSize.y)));\n\t\t\t\t#endif\n\n\t\t\t\tvec3 col = tmp.rgb;\n\t\t\t\tfloat lalpha = alpha * tmp.a;\n\t\t\t\tif ( crop > 0.5 ) {\n\t\t\t\t\tif ( uvs.x < 0.0 || uvs.x > 1.0 || uvs.y < 0.0 || uvs.y > 1.0 )  {\n\t\t\t\t\t\tlalpha = 0.0;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tlalpha *= mask;\n\n\t\t\t\tcalpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );\n\t\t\t\taccumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));\n\n\t\t\t\treturn col;\n\t\t\t}\n"),uv:new $C("vec3 uvTexture(vec3 normal, sampler2D tex, vec2 textureSize, float crop, mat3 mat, vec2 size, float blending, bool isMask, float mask, float alpha, int mode, out float calpha, out vec2 writeUv) {\n\t\t\t\tvec2 uvs = ( mat * vec3( vUv * 2. - 1., 1. ) / 2. + 0.5 ).xy;\n\t\t\t\twriteUv = uvs;\n\n\t\t\t\tvec4 tmp = texture2D( tex, uvs );\n\n\t\t\t\tvec3 col = tmp.rgb;\n\n\t\t\t\tfloat lalpha = alpha * tmp.a;\n\t\t\t\tif ( crop > 0.5 ) {\n\t\t\t\t\tif ( uvs.x < 0.0 || uvs.x > 1.0 || uvs.y < 0.0 || uvs.y > 1.0 )  {\n\t\t\t\t\t\tlalpha = 0.0;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tlalpha *= mask;\n\n\t\t\t\tcalpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );\n\t\t\t\taccumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));\n\n\t\t\t\treturn col;\n\t\t\t}"),triplanar:new $C("vec3 triplanarTexture(vec3 normal, sampler2D tex, vec2 textureSize, float crop, mat3 mat, vec2 size, float blending, bool isMask, float mask, float alpha, int mode, out float calpha, out vec2 writeUvs0, out vec2 writeUvs1, out vec2 writeUvs2, out vec3 writeWeights) {\n\t\t\t\tvec3 p = position;\n\t\t\t\tvec2 uv0 = (1.0 + p.xy) / 2.0;     \n\t\t\t\tvec2 uv1 = (1.0 + p.zy) / 2.0;\t\t\n\t\t\t\tvec2 uv2 = (1.0 + p.xz) / 2.0;\t\t\n\t\n\t\t\t\tuv0 = (mat * vec3((uv0 * 2.0 - 1.0) / (size * 0.5), 1.0) / 2.0 + 0.5).xy;\n\t\t\t\tuv1 = (mat * vec3((uv1 * 2.0 - 1.0) / (size * 0.5), 1.0) / 2.0 + 0.5).xy;\n\t\t\t\tuv2 = (mat * vec3((uv2 * 2.0 - 1.0) / (size * 0.5), 1.0) / 2.0 + 0.5).xy;\n\n\t\t\t\t// Range from 3 to 128 seems to be good\n\t\t\t\tfloat exponent = (1.0 - blending) * 125.0 + 3.0;\n\n\t\t\t\tvec3 n = vObjectNormal;\n\t\t\t\tvec3 weights = abs(normalize(n));\n\t\t\t\tweights = pow(weights, vec3(exponent));\n\t\t\t\tweights /= dot(weights, vec3(1.0));\n\n\t\t\t\t// Write out all sets of UVs that we generated\n\t\t\t\twriteUvs0 = uv0;\n\t\t\t\twriteUvs1 = uv1;\n\t\t\t\twriteUvs2 = uv2;\n\t\t\t\twriteWeights = weights;\n\n\t\t\t\t// Derivatives for LOD\n\t\t\t\tvec2 df0 = fwidth(uv0);\n\t\t\t\tvec2 df1 = fwidth(uv1);\n\t\t\t\tvec2 df2 = fwidth(uv2);\n\t\t\t\tif (df0.x > 0.5) df0.x = 0.0;\n\t\t\t\tif (df1.x > 0.5) df1.x = 0.0;\n\t\t\t\tif (df2.x > 0.5) df2.x = 0.0;\n\n\t\t\t\t#ifdef GL_EXT_shader_texture_lod\n                \tvec4 tmp = \n\t\t\t\t\t\ttexture2DLodEXT(tex, uv0, log2(max(df0.x, df0.y)*min(textureSize.x, textureSize.y))) * weights.z + \n\t\t\t\t\t\ttexture2DLodEXT(tex, uv1, log2(max(df1.x, df1.y)*min(textureSize.x, textureSize.y))) * weights.x + \n\t\t\t\t\t\ttexture2DLodEXT(tex, uv2, log2(max(df2.x, df2.y)*min(textureSize.x, textureSize.y))) * weights.y;\n\t\t\t\t#else\n                \tvec4 tmp = \n\t\t\t\t\t\ttextureLod(tex, uv0, log2(max(df0.x, df0.y)*min(textureSize.x, textureSize.y))) * weights.z + \n\t\t\t\t\t\ttextureLod(tex, uv1, log2(max(df1.x, df1.y)*min(textureSize.x, textureSize.y))) * weights.x + \n\t\t\t\t\t\ttextureLod(tex, uv2, log2(max(df2.x, df2.y)*min(textureSize.x, textureSize.y))) * weights.y;\n\t\t\t\t#endif\n\n\t\t\t\tvec3 col = tmp.rgb;\n\t\t\t\tfloat lalpha = alpha * tmp.a;\n\n\t\t\t\t// Apply cropping across all 3 planes\n\t\t\t\tif ( crop > 0.5 ) {\n\t\t\t\t\tif ( uv0.x < 0.0 || uv0.x > 1.0 || uv0.y < 0.0 || uv0.y > 1.0 )  {\n\t\t\t\t\t\tlalpha = 0.0;\n\t\t\t\t\t}\n\t\t\t\t\tif ( uv1.x < 0.0 || uv1.x > 1.0 || uv1.y < 0.0 || uv1.y > 1.0 )  {\n\t\t\t\t\t\tlalpha = 0.0;\n\t\t\t\t\t}\n\t\t\t\t\tif ( uv2.x < 0.0 || uv2.x > 1.0 || uv2.y < 0.0 || uv2.y > 1.0 )  {\n\t\t\t\t\t\tlalpha = 0.0;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tlalpha *= mask;\n\t\t\t\tcalpha =  lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0);\n\t\t\t\taccumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));\n\n\t\t\t\treturn col;//n * 0.5 + 0.5;\n\t\t\t}\t\t\t\n\t\t\t")};var ZM=class extends WC{constructor(e,t,n,i,r,s,a,o,l,c,h,u){super("v3"),this.nodeType="Depth",this.gradientType=e,this.smooth=t,this.near=n,this.far=i,this.isVector=r,this.isWorldSpace=s,this.origin=a,this.direction=o,this.colors=l,this.steps=c,this.isMask=u,this.alpha=h,this.calpha="g".concat(this.uuid.toString().replace(/-/g,""),"_calpha")}generate(e,t){let n="g".concat(this.uuid.toString().replace(/-/g,"")),i=new $C("vec3 ".concat(n,"_sdepth(float near, float far, vec3 origin, vec3 direction, vec4 colors[").concat(n,"_MAX_COLORS], float steps[").concat(n,"_MAX_COLORS], bool isMask, float mask, float alpha, out float calpha) {\n               vec4 color = colors[0];\n               #ifdef ").concat(n,"_IS_VECTOR\n                   #ifdef ").concat(n,"_LINEAR\n                       #ifdef ").concat(n,"_WORLDSPACE\n                       float depth = vectorLinearWorldSpaceDepth(direction, origin, near, far);\n                       #else\n                       float depth = vectorLinearObjectSpaceDepth(direction, origin, near, far);\n                       #endif\n                   #else\n                       #ifdef ").concat(n,"_WORLDSPACE\n                           float depth = vectorSphericalWorldSpaceDepth(origin, near, far);\n                       #else\n                           float depth = vectorSphericalObjectSpaceDepth(origin, near, far);\n                       #endif\n                   #endif\n               #else\n                   float dist = length(vWPosition - cameraPosition);\n\t\t\t       float depth = ( dist - near ) / ( far - near );\n               #endif\n\n\n              float p;\n              #ifdef ").concat(n,"_SMOOTH\n\t\t\t\tfor ( int i = 1; i < ").concat(n,"_MAX_COLORS; i++ ) {\n\t\t\t\t\t\tp = clamp( ( depth - steps[i-1] ) / ( steps[i] - steps[i-1] ), 0.0, 1.0 );\n\t\t\t\t\t\tcolor = mix(color, colors[i], smoothstep(0.0, 1.0, p));\n\t\t\t\t\t}\n              #else\n                for ( int i = 1; i < ").concat(n,"_MAX_COLORS; i++ ) {\n                   p = clamp(( depth - steps[i - 1] ) / ( steps[i] - steps[i - 1] ), 0.0, 1.0);\n                   color = mix(color, colors[i], p);\n                 }\n              #endif\n\n               float lalpha = alpha * color.a * mask;\n               calpha = mix(lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0), lalpha, float(isMask));\n\t\t\t   accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));\n\t\t\t   \n               return color.rgb;\n\t\t\t}"),[ZM.Nodes.vectorLinearWorldSpaceDepth,ZM.Nodes.vectorLinearObjectSpaceDepth,ZM.Nodes.vectorSphericalObjectSpaceDepth,ZM.Nodes.vectorSphericalWorldSpaceDepth]);if(e.isShader("fragment")){e.define("".concat(n,"_MAX_COLORS"),this.colors.value.length),this.smooth.value&&e.define("".concat(n,"_SMOOTH")),this.isVector.value>.5&&e.define("".concat(n,"_IS_VECTOR")),0===this.gradientType.value&&e.define("".concat(n,"_LINEAR")),this.isWorldSpace.value>.5&&e.define("".concat(n,"_WORLDSPACE")),e.require("worldPosition"),e.addFragmentVariable(this.calpha,"float");let r=e.include(i),s=[];return s.push(this.near.build(e,"f")),s.push(this.far.build(e,"f")),s.push(this.origin.build(e,"v3")),s.push(this.direction.build(e,"v3")),s.push(this.colors.build(e,"v4[]")),s.push(this.steps.build(e,"f[]")),s.push(this.isMask.build(e,"b")),s.push(this.mask?"luminance(".concat(this.mask.flow(e,"v3").result,")"):"1.0"),s.push(this.alpha.build(e,"f")),s.push(this.calpha),e.format(r+"("+s.join(",")+")",this.getType(e),t)}return console.warn("DepthNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},JM=ZM;JM.Nodes={vectorLinearWorldSpaceDepth:new $C("float vectorLinearWorldSpaceDepth(vec3 direction, vec3 origin, float near, float far) {\n               vec3 n = normalize(direction);\n               float dist = (n.x*(vWPosition.x - origin.x) + n.y*(vWPosition.y - origin.y) + n.z*(vWPosition.z - origin.z));\n               return ( dist - near ) / ( far - near );\n            }"),vectorLinearObjectSpaceDepth:new $C("float vectorLinearObjectSpaceDepth(vec3 direction, vec3 origin, float near, float far) {\n               vec3 n = normalize(direction);\n               float dist = (n.x*(position.x - origin.x) + n.y*(position.y - origin.y) + n.z*(position.z - origin.z));\n               return ( dist - near ) / ( far - near );\n            }"),vectorSphericalWorldSpaceDepth:new $C("float vectorSphericalWorldSpaceDepth(vec3 origin, float near, float far) {\n               float dist = length(vWPosition - origin);\n               return ( dist - near ) / ( far - near );\n            }"),vectorSphericalObjectSpaceDepth:new $C("float vectorSphericalObjectSpaceDepth(vec3 origin, float near, float far) {\n               float dist = length(position - origin);\n               return ( dist - near ) / ( far - near );\n            }")};var $M=class extends WC{constructor(e,t,n,i,r,s,a,o){super("v3"),this.nodeType="Fresnel",this.color=e,this.bias=t,this.scale=n,this.intensity=i,this.factor=r,this.isMask=o,this.alpha=s,this.mode=a,this.calpha="g".concat(this.uuid.toString().replace(/-/g,""),"_calpha")}generate(e,t){if(e.require("vWorldViewDir"),e.require("worldNormal"),e.isShader("fragment")){e.addFragmentVariable(this.calpha,"float");let n=new $C("vec3 fresnel(vec3 color, float bias, float scale, float intensity, float factor, bool isMask, float mask, float alpha, int mode, out float calpha) {\n\t\t\t\t\tfloat fresnel = bias + scale * pow( abs( factor + dot( normalize( vWorldViewDir ), normalize( vWNormal ) ) ), intensity );\n\n\t\t\t\t\tfloat lalpha = clamp(fresnel, 0.0, 1.0) * alpha * mask;\n\t\t\t\t\tcalpha = mix(lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0), lalpha, float(isMask));\n\t\t\t\t\taccumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));\n\n\t\t\t\t\treturn color;\n\t\t\t\t}"),i=e.include(n),r=[];return r.push(this.color.build(e,"c")),r.push(this.bias.build(e,"f")),r.push(this.scale.build(e,"f")),r.push(this.intensity.build(e,"f")),r.push(this.factor.build(e,"f")),r.push(this.isMask.build(e,"b")),r.push(this.mask?"luminance(".concat(this.mask.flow(e,"v3").result,")"):"1.0"),r.push(this.alpha.build(e,"f")),r.push(this.mode.build(e,"i")),r.push(this.calpha),e.format(i+"("+r.join(",")+")",this.getType(e),t)}return console.warn("FresnelNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},eT=class extends WC{constructor(e,t,n,i,r,s,a,o,l){super("v3"),this.nodeType="Gradient",this.gradientType=e,this.smooth=t,this.colors=n,this.steps=i,this.offset=r,this.morph=s,this.angle=a,this.isMask=l,this.alpha=o,this.calpha="g".concat(this.uuid.toString().replace(/-/g,""),"_calpha")}generate(e,t){if(e.isShader("fragment")){e.define("GRAD_MAX",10),e.require("uv"),e.requires.uv=[!0],e.addFragmentVariable(this.calpha,"float");let n=e.include(eT.Nodes.gradient),i=[];return i.push(this.gradientType.build(e,"i")),i.push(this.smooth.build(e,"b")),i.push(this.colors.build(e,"v4[]")),i.push(this.steps.build(e,"f[]")),i.push(this.offset.build(e,"v2")),i.push(this.morph.build(e,"v2")),i.push(this.angle.build(e,"f")),i.push(this.isMask.build(e,"b")),i.push(this.mask?"luminance(".concat(this.mask.flow(e,"v3").result,")"):"1.0"),i.push(this.alpha.build(e,"f")),i.push(this.calpha),e.format(n+"("+i.join(",")+")",this.getType(e),t)}return console.warn("GradientNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},tT=eT;tT.Nodes={gradient:new $C("vec3 gradient(int gradientType, bool smoothed, vec4 colors[GRAD_MAX], float steps[GRAD_MAX], vec2 offset, vec2 morph, float angle, bool isMask, float mask, float alpha, out float calpha) {\n\t\t\t\tvec4 color = colors[0];\n\t\t\t\tvec2 m = morph / vUv.xy;\n\t\t\t\tvec2 rot = vec2( 0.5 + m.x, m.y );\n\t\t\t\tvec2 dt = vec2(\n\t\t\t\t\tcos( angle ) * rot.x - sin( angle ) * rot.y,\n\t\t\t\t\tsin( angle ) * rot.x + cos( angle ) * rot.y\n\t\t\t\t);\n\t\t\t\tvec2 pt = ( vUv - 0.5 + offset ) / 2.0 + dt / 2.0;\n\t\t\t\tfloat t = dot( pt, dt ) / dot( dt, dt );\n\t\t\t\tif ( gradientType == 1 ) {\n\t\t\t\t\tt = distance (\n\t\t\t\t\t\t( vUv + morph ) * 3.0,\n\t\t\t\t\t\t( vUv + offset ) + 1.0\n\t\t\t\t\t) + angle;\n\t\t\t\t} else if ( gradientType == 2 ) {\n\t\t\t\t\tfloat polar = atan(\n\t\t\t\t\t\tvUv.x + morph.x - 0.5 + offset.x,\n\t\t\t\t\t\tvUv.y + morph.y - 0.5 + offset.y\n\t\t\t\t\t) * -1.0;\n\t\t\t\t\tt = fract( ( angle / PI / -2.0 ) + 0.5 * ( polar / PI ) );\n\t\t\t\t}\n\n\t\t\t\tfloat p;\n\t\t\t\tif (smoothed) {\n\t\t\t\t\tfor ( int i = 1; i < GRAD_MAX; i++ ) {\n\t\t\t\t\t\tp = clamp( ( t - steps[i-1] ) / ( steps[i] - steps[i-1] ), 0.0, 1.0 );\n\t\t\t\t\t\tcolor = mix(color, colors[i], smoothstep(0.0, 1.0, p));\n\t\t\t\t\t}\n\n\t\t\t\t} else {\n\t\t\t\t\tfor ( int i = 1; i < GRAD_MAX; i++ ) {\n\t\t\t\t\t\tp = clamp( ( t - steps[i-1] ) / ( steps[i] - steps[i-1] ), 0.0, 1.0 );\n\t\t\t\t\t\tcolor = mix(color, colors[i], p);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tfloat lalpha = alpha * color.a * mask;\n\t\t\t\tcalpha = mix(lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0), lalpha, float(isMask));\n\t\t\t\taccumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));\n\t\t\t\t\n\t\t\t\treturn color.xyz;\n\t\t\t}")};var nT=class extends WC{constructor(e,t,n,i,r){super("v3"),this.nodeType="Matcap",this.texture=e,this.isMask=i,this.alpha=t,this.mode=n,this.calpha="g".concat(this.uuid.toString().replace(/-/g,""),"_calpha"),this.rotation=r}generate(e,t){if(e.isShader("fragment")){e.addFragmentVariable(this.calpha,"float");let n=e.include(nT.Nodes.matcap);e.require("normal"),e.requires.normal=!0;let i=[];return i.push(this.texture.generate(e,"t")),i.push("normal"),i.push(this.isMask.build(e,"b")),i.push(this.mask?"luminance(".concat(this.mask.flow(e,"v3").result,")"):"1.0"),i.push(this.alpha.build(e,"f")),i.push(this.mode.build(e,"i")),i.push(this.calpha),i.push(this.rotation.build(e,"f")),e.format(n+"("+i.join(",")+")",this.getType(e),t)}return console.warn("MatcapNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},iT=nT;iT.Nodes={matcap:new $C("vec3 matcap(sampler2D matcapTex, vec3 normal, bool isMask, float mask, float alpha, int mode, out float calpha, float rotation) {\n\t\t\t\t\tvec3 viewDir = normalize( vViewPosition );\n\t\t\t\t\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\t\t\t\t\tvec3 y = cross( viewDir, x );\n\t\t\t\t\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) );\n\t\t\t\t\tuv = mat2( cos(rotation), sin(rotation), -sin(rotation), cos(rotation) ) * uv;\n\t\t\t\t\tuv = uv * 0.495 + 0.5;\n\t\t\t\t\tvec4 matcapColor = texture2D( matcapTex, uv );\n\n\t\t\t\t\tfloat lalpha = alpha * mask;\n\t\t\t\t\tcalpha = mix(lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0), lalpha, float(isMask));\n\t\t\t\t\taccumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));\n\t\t\t\t\t\n\t\t\t\t\treturn matcapColor.rgb;\n            \t}")};var rT=function(){let e=new $C("vec3 random3(vec3 c) {\n\t\t\tfloat j = 4096.0*sin(dot(c,vec3(17.0, 59.4, 15.0)));\n\t\t\tvec3 r;\n\t\t\tr.z = fract(512.0*j);\n\t\t\tj *= .125;\n\t\t\tr.x = fract(512.0*j);\n\t\t\tj *= .125;\n\t\t\tr.y = fract(512.0*j);\n\t\t\treturn r-0.5;\n\t\t}"),t=new $C("float simplexFast(vec3 p) {\n\t\t\t vec3 s = floor(p + dot(p, vec3(F3)));\n\t\t\t mediump vec3 x = p - s + dot(s, vec3(G3));\n\t\t\t mediump vec3 hs = s;\n\t\t\t \n\t\t\t mediump vec3 e = step(vec3(0.0), x - x.yzx);\n\t\t\t mediump vec3 i1 = e*(1.0 - e.zxy);\n\t\t\t mediump vec3 i2 = 1.0 - e.zxy*(1.0 - e);\n\t\t\t\t\n\t\t\t mediump vec3 x1 = x - i1 + G3;\n\t\t\t mediump vec3 x2 = x - i2 + 2.0*G3;\n\t\t\t mediump vec3 x3 = x - 1.0 + 3.0*G3;\n\t\t\t \n\t\t\t mediump vec4 w, d;\n\t\t\t \n\t\t\t w.x = dot(x, x);\n\t\t\t w.y = dot(x1, x1);\n\t\t\t w.z = dot(x2, x2);\n\t\t\t w.w = dot(x3, x3);\n\t\t\t \n\t\t\t w = max(0.6 - w, 0.0);\n\t\t\t \n\t\t\t d.x = dot(random3(hs), x);\n\t\t\t d.y = dot(random3(hs + i1), x1);\n\t\t\t d.z = dot(random3(hs + i2), x2);\n\t\t\t d.w = dot(random3(hs + 1.0), x3);\n\t\t\t \n\t\t\t w *= w;\n\t\t\t w *= w;\n\t\t\t d *= w;\n\t\t\t \n\t\t\t return dot(d, vec4(52.0));\n\t\t}",[e]);t.keywords.F3=new nM("float F3 0.3333333"),t.keywords.G3=new nM("float G3 0.1666667");let n=new $C("float simplexPrecise(vec3 p) {\n\t\t\t vec3 s = floor(p + dot(p, vec3(F3)));\n\t\t\t vec3 x = p - s + dot(s, vec3(G3));\n\t\t\t \n\t\t\t vec3 e = step(vec3(0.0), x - x.yzx);\n\t\t\t vec3 i1 = e*(1.0 - e.zxy);\n\t\t\t vec3 i2 = 1.0 - e.zxy*(1.0 - e);\n\t\t\t\t\n\t\t\t vec3 x1 = x - i1 + G3;\n\t\t\t vec3 x2 = x - i2 + 2.0*G3;\n\t\t\t vec3 x3 = x - 1.0 + 3.0*G3;\n\t\t\t \n\t\t\t vec4 w, d;\n\t\t\t \n\t\t\t w.x = dot(x, x);\n\t\t\t w.y = dot(x1, x1);\n\t\t\t w.z = dot(x2, x2);\n\t\t\t w.w = dot(x3, x3);\n\t\t\t \n\t\t\t w = max(0.6 - w, 0.0);\n\t\t\t \n\t\t\t d.x = dot(random3(s), x);\n\t\t\t d.y = dot(random3(s + i1), x1);\n\t\t\t d.z = dot(random3(s + i2), x2);\n\t\t\t d.w = dot(random3(s + 1.0), x3);\n\t\t\t \n\t\t\t w *= w;\n\t\t\t w *= w;\n\t\t\t d *= w;\n\t\t\t \n\t\t\t return dot(d, vec4(52.0));\n\t\t}",[e]);n.keywords.F3=new nM("float F3 0.3333333"),n.keywords.G3=new nM("float G3 0.1666667");let i=new $C("float simplexFractal(vec3 m) {\n\t\t\tmat3 rot1 = mat3(-0.37, 0.36, 0.85,-0.14,-0.93, 0.34,0.92, 0.01,0.4);\n\t\t\tmat3 rot2 = mat3(-0.55,-0.39, 0.74, 0.33,-0.91,-0.24,0.77, 0.12,0.63);\n\t\t\tmat3 rot3 = mat3(-0.71, 0.52,-0.47,-0.08,-0.72,-0.68,-0.7,-0.45,0.56);\n\t\t\treturn 0.5333333 * simplexFast(m * rot1)\n\t\t\t\t + 0.2666667 * simplexFast(2.0 * m * rot2)\n\t\t\t\t + 0.1333333 * simplexFast(4.0 * m * rot3)\n\t\t\t\t + 0.0666667 * simplexFast(8.0 * m);\n\t\t}",[t]),r=new $C("vec4 permute(vec4 x){return mod(((x*34.0)+1.0)*x, 289.0);}"),s=new $C("vec4 taylorInvSqrt(vec4 r){return 1.79284291400159 - 0.85373472095314 * r;}"),a=new $C("float simplexAshima(vec3 v) {\n\t\t  const vec2  C = vec2(1.0/6.0, 1.0/3.0) ;\n\t\t  const vec4  D = vec4(0.0, 0.5, 1.0, 2.0);\n\t\t  vec3 i  = floor(v + dot(v, C.yyy) );\n\t\t  vec3 x0 =   v - i + dot(i, C.xxx) ;\n\t\t  vec3 g = step(x0.yzx, x0.xyz);\n\t\t  vec3 l = 1.0 - g;\n\t\t  vec3 i1 = min( g.xyz, l.zxy );\n\t\t  vec3 i2 = max( g.xyz, l.zxy );\n\t\t  vec3 x1 = x0 - i1 + 1.0 * C.xxx;\n\t\t  vec3 x2 = x0 - i2 + 2.0 * C.xxx;\n\t\t  vec3 x3 = x0 - 1. + 3.0 * C.xxx;\n\t\t  i = mod(i, 289.0 ); \n\t\t  vec4 p = permute( permute( permute( \n\t\t\t\t\t i.z + vec4(0.0, i1.z, i2.z, 1.0 ))\n\t\t\t\t   + i.y + vec4(0.0, i1.y, i2.y, 1.0 )) \n\t\t\t\t   + i.x + vec4(0.0, i1.x, i2.x, 1.0 ));\n\t\t  float n_ = 1.0/7.0; // N=7\n\t\t  vec3  ns = n_ * D.wyz - D.xzx;\n\t\t  vec4 j = p - 49.0 * floor(p * ns.z *ns.z);  //  mod(p,N*N)\n\t\t  vec4 x_ = floor(j * ns.z);\n\t\t  vec4 y_ = floor(j - 7.0 * x_ );    // mod(j,N)\n\t\t  vec4 x = x_ *ns.x + ns.yyyy;\n\t\t  vec4 y = y_ *ns.x + ns.yyyy;\n\t\t  vec4 h = 1.0 - abs(x) - abs(y);\n\t\t  vec4 b0 = vec4( x.xy, y.xy );\n\t\t  vec4 b1 = vec4( x.zw, y.zw );\n\t\t  vec4 s0 = floor(b0)*2.0 + 1.0;\n\t\t  vec4 s1 = floor(b1)*2.0 + 1.0;\n\t\t  vec4 sh = -step(h, vec4(0.0));\n\t\t  vec4 a0 = b0.xzyw + s0.xzyw*sh.xxyy ;\n\t\t  vec4 a1 = b1.xzyw + s1.xzyw*sh.zzww ;\n\t\t  vec3 p0 = vec3(a0.xy,h.x);\n\t\t  vec3 p1 = vec3(a0.zw,h.y);\n\t\t  vec3 p2 = vec3(a1.xy,h.z);\n\t\t  vec3 p3 = vec3(a1.zw,h.w);\n\t\t  vec4 norm = taylorInvSqrt(vec4(dot(p0,p0), dot(p1,p1), dot(p2, p2), dot(p3,p3)));\n\t\t  p0 *= norm.x;\n\t\t  p1 *= norm.y;\n\t\t  p2 *= norm.z;\n\t\t  p3 *= norm.w;\n\t\t  vec4 m = max(0.6 - vec4(dot(x0,x0), dot(x1,x1), dot(x2,x2), dot(x3,x3)), 0.0);\n\t\t  m = m * m;\n\t\t  return 42.0 * dot( m*m, vec4( dot(p0,x0), dot(p1,x1), \n\t\t\t\t\t\t\t\t\t\tdot(p2,x2), dot(p3,x3) ) );\n\t\t}",[r,s]),o=new $C("vec4 mod289(vec4 x){return x - floor(x * (1.0 / 289.0)) * 289.0;}"),l=new $C("vec4 perm(vec4 x){return mod289(((x * 34.0) + 1.0) * x);}",[o]),c=new $C("float noise(vec3 p){\n\t\t\tvec3 a = floor(p);\n\t\t\tvec3 d = p - a;\n\t\t\td = d * d * (3.0 - 2.0 * d);\n\t\t\tvec4 b = a.xxyy + vec4(0.0, 1.0, 0.0, 1.0);\n\t\t\tvec4 k1 = perm(b.xyxy);\n\t\t\tvec4 k2 = perm(k1.xyxy + b.zzww);\n\t\t\tvec4 c = k2 + a.zzzz;\n\t\t\tvec4 k3 = perm(c);\n\t\t\tvec4 k4 = perm(c + 1.0);\n\t\t\tvec4 o1 = fract(k3 * (1.0 / 41.0));\n\t\t\tvec4 o2 = fract(k4 * (1.0 / 41.0));\n\t\t\tvec4 o3 = o2 * d.z + o1 * (1.0 - d.z);\n\t\t\tvec2 o4 = o3.yw * d.x + o3.xz * (1.0 - d.x);\n\t\t\treturn o4.y * d.y + o4.x * (1.0 - d.y);\n\t\t}",[l]),h=new $C("float fbm(vec3 x) {\n\t\t\tfloat v = 0.0;\n\t\t\tfloat a = 0.5;\n\t\t\tvec3 shift = vec3(100);\n\t\t\tfor (int i = 0; i < NUM_OCTAVES; ++i) {\n\t\t\t\tv += a * noise(x);\n\t\t\t\tx = x * 2.0 + shift;\n\t\t\t\ta *= 0.5;\n\t\t\t}\n\t\t\treturn v;\n\t\t}",[c]);h.keywords.NUM_OCTAVES=new nM("int NUM_OCTAVES ".concat(5));let u=new $C("vec3 fade(vec3 t) {return t*t*t*(t*(t*6.0-15.0)+10.0);}"),d=new $C("float perlin(vec3 P){\n\t\t  vec3 Pi0 = floor(P);\n\t\t  vec3 Pi1 = Pi0 + vec3(1.0);\n\t\t  Pi0 = mod(Pi0, 289.0);\n\t\t  Pi1 = mod(Pi1, 289.0);\n\t\t  vec3 Pf0 = fract(P);\n\t\t  vec3 Pf1 = Pf0 - vec3(1.0);\n\t\t  vec4 ix = vec4(Pi0.x, Pi1.x, Pi0.x, Pi1.x);\n\t\t  vec4 iy = vec4(Pi0.yy, Pi1.yy);\n\t\t  vec4 iz0 = Pi0.zzzz;\n\t\t  vec4 iz1 = Pi1.zzzz;\n\t\t  vec4 ixy = permute(permute(ix) + iy);\n\t\t  vec4 ixy0 = permute(ixy + iz0);\n\t\t  vec4 ixy1 = permute(ixy + iz1);\n\t\t  vec4 gx0 = ixy0 / 7.0;\n\t\t  vec4 gy0 = fract(floor(gx0) / 7.0) - 0.5;\n\t\t  gx0 = fract(gx0);\n\t\t  vec4 gz0 = vec4(0.5) - abs(gx0) - abs(gy0);\n\t\t  vec4 sz0 = step(gz0, vec4(0.0));\n\t\t  gx0 -= sz0 * (step(0.0, gx0) - 0.5);\n\t\t  gy0 -= sz0 * (step(0.0, gy0) - 0.5);\n\t\t  vec4 gx1 = ixy1 / 7.0;\n\t\t  vec4 gy1 = fract(floor(gx1) / 7.0) - 0.5;\n\t\t  gx1 = fract(gx1);\n\t\t  vec4 gz1 = vec4(0.5) - abs(gx1) - abs(gy1);\n\t\t  vec4 sz1 = step(gz1, vec4(0.0));\n\t\t  gx1 -= sz1 * (step(0.0, gx1) - 0.5);\n\t\t  gy1 -= sz1 * (step(0.0, gy1) - 0.5);\n\t\t  vec3 g000 = vec3(gx0.x,gy0.x,gz0.x);\n\t\t  vec3 g100 = vec3(gx0.y,gy0.y,gz0.y);\n\t\t  vec3 g010 = vec3(gx0.z,gy0.z,gz0.z);\n\t\t  vec3 g110 = vec3(gx0.w,gy0.w,gz0.w);\n\t\t  vec3 g001 = vec3(gx1.x,gy1.x,gz1.x);\n\t\t  vec3 g101 = vec3(gx1.y,gy1.y,gz1.y);\n\t\t  vec3 g011 = vec3(gx1.z,gy1.z,gz1.z);\n\t\t  vec3 g111 = vec3(gx1.w,gy1.w,gz1.w);\n\t\t  vec4 norm0 = taylorInvSqrt(vec4(dot(g000, g000), dot(g010, g010), dot(g100, g100), dot(g110, g110)));\n\t\t  g000 *= norm0.x;\n\t\t  g010 *= norm0.y;\n\t\t  g100 *= norm0.z;\n\t\t  g110 *= norm0.w;\n\t\t  vec4 norm1 = taylorInvSqrt(vec4(dot(g001, g001), dot(g011, g011), dot(g101, g101), dot(g111, g111)));\n\t\t  g001 *= norm1.x;\n\t\t  g011 *= norm1.y;\n\t\t  g101 *= norm1.z;\n\t\t  g111 *= norm1.w;\n\t\t  float n000 = dot(g000, Pf0);\n\t\t  float n100 = dot(g100, vec3(Pf1.x, Pf0.yz));\n\t\t  float n010 = dot(g010, vec3(Pf0.x, Pf1.y, Pf0.z));\n\t\t  float n110 = dot(g110, vec3(Pf1.xy, Pf0.z));\n\t\t  float n001 = dot(g001, vec3(Pf0.xy, Pf1.z));\n\t\t  float n101 = dot(g101, vec3(Pf1.x, Pf0.y, Pf1.z));\n\t\t  float n011 = dot(g011, vec3(Pf0.x, Pf1.yz));\n\t\t  float n111 = dot(g111, Pf1);\n\t\t  vec3 fade_xyz = fade(Pf0);\n\t\t  vec4 n_z = mix(vec4(n000, n100, n010, n110), vec4(n001, n101, n011, n111), fade_xyz.z);\n\t\t  vec2 n_yz = mix(n_z.xy, n_z.zw, fade_xyz.y);\n\t\t  float n_xyz = mix(n_yz.x, n_yz.y, fade_xyz.x); \n\t\t  return 2.2 * n_xyz;\n\t\t}",[r,s,u]),p=new $C("float hashwithoutsine13(vec3 p3)\n\t\t{\n\t\t\tp3  = fract(p3 * .1031);\n\t\t\tp3 += dot(p3, p3.yzx + 33.33);\n\t\t\treturn fract((p3.x + p3.y) * p3.z);\n\t\t}"),f=new $C("vec3 hashwithoutsine33(vec3 p3)\n\t\t{\n\t\t\tp3 = fract(p3 * vec3(.1031, .1030, .0973));\n\t\t\tp3 += dot(p3, p3.yxz+33.33);\n\t\t\treturn fract((p3.xxy + p3.yxx)*p3.zyx);\n\t\t}"),m=new $C("float metric(in vec3 p)\n\t\t{\n\t\t\t// L2 \n\t\t\treturn length(p);\n\n\t\t\t// Chebyshev \n\t\t\t// vec3 a = abs(p);\n\t\t\t// return max(a.x, max(a.y, a.z));\n\t\t}"),g=new $C("float smin( float a, float b, float k )\n\t\t{\n\t\t\tfloat h = smoothstep(0.0, 1.0, 0.5 + 0.5 * (b - a) / k);\n\t\t\tfloat correction = k * h * (1.0 - h);\n\t\t\treturn mix(b, a, h) - correction;\n\t\t}"),v=new $C("float smax( float a, float b, float k )\n\t\t{\n\t\t\tfloat h = smoothstep(1.0, 0.0, 0.5 + 0.5 * (a - b) / k);\n\t\t\tfloat correction = k * h * (1.0 - h);\n\t\t\treturn mix(a, b, h) + correction;\n\t\t}"),y=new $C("float remap(float value, float input_min, float input_max, float output_min, float output_max) {\n\t\t\t// Compute width of each interval\n\t\t\tfloat input_width = input_max - input_min;\n\t\t\tfloat output_width = output_max - output_min;\n\t\t\n\t\t\t// Convert input range into a 0-1 range \n\t\t\tfloat scaled = (value - input_min) / input_width;\n\t\t\n\t\t\t// Convert the 0-1 range into a value in output range\n\t\t\treturn output_min + (scaled * output_width);\n\t\t}");return{simplexFast:t,simplexPrecise:n,simplexFractal:i,simplexAshima:a,fbm:h,perlin:d,voronoi:new $C('float voronoi(in vec3 x, in int style, in float smoothness, in float seed, in int quality) \n\t\t{\n\t\t\t// Integer and fractional parts of this point\'s coordinates\n\t\t\tivec3 p = ivec3(floor(x));\n\t\t\tvec3 f = fract(x);\n\n\t\t\t// Different variables that we will use to construct noise:\n\t\t\t//\n\t\t\t// f1: distance to the closest feature point\n\t\t\t// f2: distance to the second closest feature point\n\t\t\t// e: distance to the closest edge (cell boundary)\n\t\t\t//\n\t\t\t// We also compute "smooth" versions of all of the above quantites, essentially\n\t\t\t// replacing "hard" minimums with "smooth" minimums (described by IQ)\n\t\t\tfloat f1_smooth = 8.0;\n\t\t\tfloat f1 = 8.0;\n\t\t\tfloat f2_smooth = 8.0;\n\t\t\tfloat f2 = 8.0;\n\t\t\tfloat e_smooth = 8.0;\n\t\t\tfloat e = 8.0;\n\n\t\t\t// Variables stored from closest cell\n\t\t\tivec3 mb;\n\t\t\tvec3 mr; \n\n\t\t\tint steps = quality;\n\t\t\t\n\t\t\tfor (int x = -steps; x <= steps; x++) \n\t\t\tfor (int y = -steps; y <= steps; y++)\n\t\t\tfor (int z = -steps; z <= steps; z++)\n\t\t\t{\n\t\t\t\tivec3 b = ivec3(x, y, z);\n\t\t\t\tvec3 r = vec3(b) + hashwithoutsine33(vec3(p + b) + seed) - f;\n\t\t\t\tfloat d = length(r);\n\t\t\t\t\n\t\t\t\tf1_smooth = smin(d, f1_smooth, smoothness);\n\n\t\t\t\t// Store un-smoothed distances too \n\t\t\t\tif (d < f1) \n\t\t\t\t{\n\t\t\t\t\tf2 = f1;\n\t\t\t\t\tf1 = d;\n\n\t\t\t\t\tmb = ivec3(x, y, z);\n\t\t\t\t\tmr = r;\n\t\t\t\t} \n\t\t\t\telse if (d < f2) \n\t\t\t\t{\n\t\t\t\t\tf2 = d;\n\t\t\t\t}\n\t\t\t}\t\n\t\t\t\n\t\t\t// Second pass for edge distance  \n\t\t\t// skip for styles don\'t need\n\t\t\tif (style != 0 &&  style != 5 && style != 7)\n\t\t\tfor (int x = -steps; x <= steps; x++) \n\t\t\tfor (int y = -steps; y <= steps; y++)\n\t\t\tfor (int z = -steps; z <= steps; z++)\n\t\t\t{\n\t\t\t\t// Start search at the cell that contains the closest point to "x" (found in 1st pass)\n\t\t\t\tivec3 b = mb + ivec3(x, y, z);\n\t\t\t\tvec3 r = vec3(b) + hashwithoutsine33(vec3(p + b) + seed) - f;\n\t\t\t\tfloat d1 = dot(0.5 * (mr + r), (r - mr)); \t\t\t\t// IQ normalizes "r - mr" but that breaks things for the smooth version?\n\t\t\t\tfloat d2 = dot(0.5 * (mr + r), normalize(r - mr));\n\n\t\t\t\te_smooth = smin(d1, e_smooth, smoothness);\n\n\t\t\t\te = min(e, d2);\n\n\t\t\t\t// Also compute a smooth version of F2 in this pass\n\t\t\t\t{\n\t\t\t\t\tivec3 b = ivec3(x, y, z);\n\t\t\t\t\tif (b != mb) \n\t\t\t\t\t{\n\t\t\t\t\t\tvec3 r = vec3(b) + hashwithoutsine33(vec3(p + b) + seed) - f;\n\t\t\t\t\t\tfloat d = length(r);\n\n\t\t\t\t\t\tf2_smooth = smin(d, f2_smooth, smoothness);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Different visualization modes \n\t\t\tif (style == 0) \n\t\t\t{\n\t\t\t\treturn f1_smooth;\n\t\t\t}\n\t\t\tif (style == 1) \n\t\t\t{\n\t\t\t\treturn f2_smooth;\n\t\t\t}\n\t\t\tif (style == 2) \n\t\t\t{\n\t\t\t\treturn f2_smooth - f1_smooth;\n\t\t\t\t\n\t\t\t\t// "Pebbles" also cool\n\t\t\t\t//return step(0.2, f2_smooth - f1_smooth);\n\t\t\t}\n\t\t\tif (style == 3) \n\t\t\t{\n\t\t\t\t// This one is really good for rock / stone effects\n\t\t\t\tfloat a = f1; \n\t\t\t\tfloat b = f2;\n\t\t\t\tfloat k = 3.0;\n\t\t\t\tfloat h = max(k - abs(a - b), 0.0) / k;\n\t\t\t\tfloat final = min(a, b) - h * h * k * (1.0 / 4.0);\n\t\t\t\treturn final;\n\t\t\t}\n\t\t\tif (style == 4) \n\t\t\t{\n\t\t\t\t// Some random adjustments to make this style stand out more \n\t\t\t\treturn exp(5.0 * e_smooth);\n\t\t\t}\n\t\t\tif (style == 5) \n\t\t\t{\n\t\t\t\treturn pow(f1_smooth, 3.0);\n\t\t\t}\n\t\t\tif (style == 6) \n\t\t\t{\t\t\t\t\n\t\t\t\tconst float eps = 0.0125;\n\n\t\t\t\t// Thicker lines as the user increases the smoothness slider\n\t\t\t\tfloat thickness = smoothness * 0.25 + eps;\n\n\t\t\t\t// Blurrier lines as the user increases the smoothness slider\n\t\t\t\tfloat blur = pow(smoothness, 3.0) * 0.25 + eps;\n\n\t\t\t\treturn smoothstep(\n\t\t\t\t\tthickness - thickness * blur, \n\t\t\t\t\tthickness + thickness * blur, \n\t\t\t\t\te\n\t\t\t\t);\n\t\t\t}\n\t\t\tif (style == 7) \n\t\t\t{\n\t\t\t\treturn hashwithoutsine13(vec3(p + mb) + seed);\n\t\t\t}\n\t\t}\n\t',[p,f,m,g,v,y])}}(),sT=class extends WC{constructor(e,t,n,i,r,s,a,o,l,c,h,u,d,p,f,m,g,v,y){super("v3"),this.nodeType="Noise",this.scale=e,this.size=t,this.move=n,this.fA=i,this.fB=r,this.distortion=s,this.colorA=a,this.colorB=o,this.colorC=l,this.colorD=c,this.noiseType=u,this.voronoiStyle=p,this.highCut=f,this.lowCut=m,this.smoothness=g,this.seed=v,this.quality=y,this.isMask=d,this.alpha=h,this.calpha="g".concat(this.uuid.toString().replace(/-/g,""),"_calpha")}generate(e,t,n,i,r){e.require("uv"),e.requires.uv=[!0],e.addFragmentVariable(this.calpha,"float");let s=["simplexFast","simplexFractal","simplexAshima","fbm","perlin","voronoi"][this.noiseType.value],a="voronoi"==s?"\n\t\tfloat v = ".concat(s,'(st + move, voronoiStyle, smoothness, seed, quality);\n\n\t\t// Apply clipping to colors\n\t\tv = remap(v, lowCut, highCut, 0.0, 1.0);\n\t\tv = smax(v, 0.0, smoothness * 0.25);\n\t\tv = smin(v, 1.0, smoothness * 0.25);\n\n\t\t// Note that the voronoi mode only uses colors "A" and "C" from the UI \n\t\tvec4 color = mix(colorA, colorC, v); \n\t\t'):"\n\t\tvec3 q = vec3(".concat(s,"(st),\n\t\t\t\t\t   ").concat(s,"(st + vec3(1.0)),\n\t\t\t\t\t   ").concat(s,"(st + vec3(1.0)));\n\t\tvec3 r = vec3(").concat(s,"(st + vec3(distortion, 1.0) * q + vec3(fA, 1.0) + move),\n\t\t\t\t\t  ").concat(s,"(st + vec3(distortion, 1.0) * q + vec3(fB, 1.0) + move), \n\t\t\t\t\t  ").concat(s,"(st * q));\n\t\tfloat f = ").concat(s,"(st + r);\n\t\tvec4 color;\n\t\tcolor = mix(colorA, colorB, clamp((f * f) * 4.0, 0.0, 1.0));\n\t\tcolor = mix(color, colorC, clamp(length(q), 0.0, 1.0));\n\t\tcolor = mix(color, colorD, clamp(length(r.x), 0.0, 1.0));\n\t\t"),o=new $C("vec3 ".concat(s,"customNoise(float scale, vec3 size, float move, vec2 fA, vec2 fB, vec2 distortion, vec4 colorA, vec4 colorB, vec4 colorC, vec4 colorD, int voronoiStyle, float highCut, float lowCut, float smoothness, float seed, int quality, bool isMask, float mask, float alpha, out float calpha) \n\t\t\t{\n                // Prevent scale of zero \n\t\t\t\tscale = max(abs(scale), 0.001);\n\n\t\t\t\tvec3 st = position / size;\n\t\t\t\tst /= scale;\n\n\t\t\t\t").concat(a,"\n\n\t\t\t\tfloat lalpha = alpha * color.a * mask;\n\t\t\t\tcalpha = mix(lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0), lalpha, float(isMask));\n\t\t\t\taccumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));\n\n\t\t\t\treturn clamp(color, 0.0, 1.0).rgb;\n\t\t\t}"),[rT.simplexFast,rT.simplexFractal,rT.simplexAshima,rT.fbm,rT.perlin,rT.voronoi]),l=e.include(o),c=[];return c.push(this.scale.build(e,"f")),c.push(this.size.build(e,"v3")),c.push(this.move.build(e,"f")),c.push(this.fA.build(e,"v2")),c.push(this.fB.build(e,"v2")),c.push(this.distortion.build(e,"v2")),c.push(this.colorA.build(e,"v4")),c.push(this.colorB.build(e,"v4")),c.push(this.colorC.build(e,"v4")),c.push(this.colorD.build(e,"v4")),c.push(this.voronoiStyle.build(e,"i")),c.push(this.highCut.build(e,"f")),c.push(this.lowCut.build(e,"f")),c.push(this.smoothness.build(e,"f")),c.push(this.seed.build(e,"f")),c.push(this.quality.build(e,"i")),c.push(this.isMask.build(e,"b")),c.push(this.mask?"luminance(".concat(this.mask.flow(e,"v3").result,")"):"1.0"),c.push(this.alpha.build(e,"f")),c.push(this.calpha),e.format(l+"("+c.join(",")+")",this.getType(e),t)}};sT.numOctaves=5;var aT=class extends WC{constructor(e,t,n,i,r,s,a,o,l,c,h,u,d,p,f,m){super("v3"),this.nodeType="Outline",this.firstTime=!0,this.outlineColor=e,this.contourColor=t,this.outlineWidth=n,this.contourWidth=i,this.contourThreshold=r,this.outlineThreshold=s,this.contourFrequency=a,this.outlineSmoothing=o,this.contourDirection=l,this.positionalLines=c,this.compensation=h,this.resolution=u,this.normalMap=d,this.depthMap=p,this.pixelRatio=f,this.alpha=m,this.calpha="g".concat(this.uuid.toString().replace(/-/g,""),"_calpha")}generate(e,t){let n="g".concat(this.uuid.toString().replace(/-/g,""));if(e.require("vWorldViewDir"),e.require("worldNormal"),e.extensions.derivatives=!0,this.compensation.value&&e.define("OUTLINE_COMPENSATION","".concat(n,"_offset")),this.firstTime){let t=this.outlineWidth.build(e,"f"),i=this.resolution.build(e,"v2"),r=this.compensation.build(e,"b"),s=this.pixelRatio.build(e,"f");e.addVertexParsVariable("randomColor","attribute vec3"),e.addVertexParsVariable("extrudeNormal","attribute vec3"),e.addVertexParsVariable(t,"uniform float"),e.addVertexParsVariable(i,"uniform vec2"),e.addVertexParsVariable(r,"uniform bool"),e.addVertexParsVariable(s,"uniform float"),e.addVertexParsVariable("vID","flat out float"),e.addFragmentParsVariable("vID","flat in float"),e.addVertexFinalCode("\n                vID = randomColor.r;\n                vec2 ".concat(n,"_offset = vec2(0.0);\n                if (").concat(r,") {\n                    vec4 ").concat(n,"_clipPosition = projectionMatrix * (modelViewMatrix * vec4(transformed, 1.0));\n                    // NOTE: For certain shapes, like spheres, we get incorrect extrusion when the\n                    // normals face the camera directly. So we hackily fix this by offsetting the normal\n                    // by a tiny amount.\n                    vec3 ").concat(n,"_clipNormal = mat3(projectionMatrix) * (mat3(modelViewMatrix) * extrudeNormal) + 0.0000001;\n                    ").concat(n,"_offset = normalize(").concat(n,"_clipNormal.xy) / ").concat(i," * (").concat(t," / 2.0) * ").concat(n,"_clipPosition.w * 2.0 * ").concat(s,";\n                    ").concat(n,"_clipPosition.xy += ").concat(n,"_offset;\n                    // TODO(MAX): To handle multiple outline layers, we only want to extrude\n                    // if this offset is the biggest of all the potential offsets\n                    gl_Position = ").concat(n,"_clipPosition;\n                }\n            "))}if(e.isShader("fragment")){e.require("uv"),e.requires.uv=[!0],e.addFragmentVariable(this.calpha,"float");let n=e.include(aT.Nodes.outline),i=[];return i.push(this.outlineColor.build(e,"c")),i.push(this.contourColor.build(e,"c")),i.push(this.outlineWidth.build(e,"f")),i.push(this.contourWidth.build(e,"f")),i.push(this.contourThreshold.build(e,"f")),i.push(this.outlineThreshold.build(e,"f")),i.push(this.contourFrequency.build(e,"f")),i.push(this.outlineSmoothing.build(e,"f")),i.push(this.contourDirection.build(e,"v3")),i.push(this.positionalLines.build(e,"b")),i.push(this.resolution.build(e,"v2")),i.push(this.normalMap.getTexture(e,"t")),i.push(this.depthMap.getTexture(e,"t")),i.push(this.pixelRatio.build(e,"f")),i.push(this.compensation.build(e,"b")),i.push(this.mask?"luminance(".concat(this.mask.flow(e,"v3").result,")"):"1.0"),i.push(this.alpha.build(e,"f")),i.push(this.calpha),this.firstTime=!this.firstTime,e.format(n+"("+i.join(",")+")",this.getType(e),t)}return console.warn("OutlineNode is not compatible with "+e.shader+" shader."),""}},oT=aT;oT.Nodes=function(){let e=new $C("\nfloat sobelSample(sampler2D t, sampler2D d, vec2 uv, vec2 resolution, float outlineWidth, float pixelRatio)\n{\n    vec2 halton = haltonSequence[frameIndex];\n    float temporalOffset = getNoiseInterleavedGradient(gl_FragCoord.xy + halton);\n    float temporalAngle  = temporalOffset * PI2;\n\n    vec2 texelSize = (vec2(1.0) / resolution);\n    vec2 offsetSize = texelSize * outlineWidth * pixelRatio;\n\n    vec2 uvSamples[9];\n    vec4 normalSamples[9];\n\n\tuvSamples[0] = uv + vec2( -offsetSize.x, -offsetSize.y) + (vogelDiskSample(0, 9, temporalAngle) * texelSize);\n\tuvSamples[1] = uv + vec2(0.0, -offsetSize.y) + (vogelDiskSample(1, 9, temporalAngle) * texelSize);\n\tuvSamples[2] = uv + vec2(  offsetSize.x, -offsetSize.y) + (vogelDiskSample(2, 9, temporalAngle) * texelSize);\n\tuvSamples[3] = uv + vec2( -offsetSize.x, 0.0) + (vogelDiskSample(3, 9, temporalAngle) * texelSize);\n\tuvSamples[4] = uv;\n\tuvSamples[5] = uv + vec2(  offsetSize.x, 0.0) + (vogelDiskSample(5, 9, temporalAngle) * texelSize);\n\tuvSamples[6] = uv + vec2( -offsetSize.x, offsetSize.y) + (vogelDiskSample(6, 9, temporalAngle) * texelSize);\n\tuvSamples[7] = uv + vec2(0.0, offsetSize.y) + (vogelDiskSample(7, 9, temporalAngle) * texelSize);\n\tuvSamples[8] = uv + vec2(  offsetSize.x, offsetSize.y) + (vogelDiskSample(8, 9, temporalAngle) * texelSize);\n\n\n    normalSamples[0] = texture2D(t, uvSamples[0]);\n    normalSamples[1] = texture2D(t, uvSamples[1]);\n    normalSamples[2] = texture2D(t, uvSamples[2]);\n    normalSamples[3] = texture2D(t, uvSamples[3]);\n    normalSamples[4] = texture2D(t, uvSamples[4]);\n    normalSamples[5] = texture2D(t, uvSamples[5]);\n    normalSamples[6] = texture2D(t, uvSamples[6]);\n    normalSamples[7] = texture2D(t, uvSamples[7]);\n    normalSamples[8] = texture2D(t, uvSamples[8]);\n\n    float depthBias = 0.0001;\n    // TODO(MAX): Can we somehow reduce the number of conditionals here with MATH?!\n    if (normalSamples[0].a != vID && normalSamples[0].a != 0.0) {\n        float depthAtSample = texture2D(d, uvSamples[0]).r + depthBias;\n        if (gl_FragCoord.z > depthAtSample) {\n           return 0.0;\n        }\n    }\n\n    if (normalSamples[1].a != vID && normalSamples[1].a != 0.0) {\n        float depthAtSample = texture2D(d, uvSamples[1]).r + depthBias;\n        if (gl_FragCoord.z > depthAtSample) {\n           return 0.0;\n        }\n    }\n\n    if (normalSamples[2].a != vID && normalSamples[2].a != 0.0) {\n        float depthAtSample = texture2D(d, uvSamples[2]).r + depthBias;\n        if (gl_FragCoord.z > depthAtSample) {\n           return 0.0;\n        }\n    }\n\n    if (normalSamples[3].a != vID && normalSamples[3].a != 0.0) {\n        float depthAtSample = texture2D(d, uvSamples[3]).r + depthBias;\n        if (gl_FragCoord.z > depthAtSample) {\n           return 0.0;\n        }\n    }\n\n\n    if (normalSamples[4].a != vID && normalSamples[4].a != 0.0) {\n        float depthAtSample = texture2D(d, uvSamples[4]).r + depthBias;\n        if (gl_FragCoord.z > depthAtSample) {\n           return 0.0;\n        }\n    }\n\n    if (normalSamples[5].a != vID && normalSamples[5].a != 0.0) {\n        float depthAtSample = texture2D(d, uvSamples[5]).r + depthBias;\n        if (gl_FragCoord.z > depthAtSample) {\n           return 0.0;\n        }\n    }\n\n    if (normalSamples[6].a != vID && normalSamples[6].a != 0.0) {\n        float depthAtSample = texture2D(d, uvSamples[6]).r + depthBias;\n        if (gl_FragCoord.z > depthAtSample) {\n           return 0.0;\n        }\n    }\n\n    if (normalSamples[7].a != vID && normalSamples[7].a != 0.0) {\n        float depthAtSample = texture2D(d, uvSamples[7]).r + depthBias;\n        if (gl_FragCoord.z > depthAtSample) {\n           return 0.0;\n        }\n    }\n\n    if (normalSamples[8].a != vID && normalSamples[8].a != 0.0) {\n        float depthAtSample = texture2D(d, uvSamples[8]).r + depthBias;\n        if (gl_FragCoord.z > depthAtSample) {\n           return 0.0;\n        }\n    }\n\n    vec3 sobel_edge_h = normalSamples[2].rgb + (2.0*normalSamples[5].rgb) + normalSamples[8].rgb - (normalSamples[0].rgb + (2.0*normalSamples[3].rgb) + normalSamples[6].rgb);\n  \tvec3 sobel_edge_v = normalSamples[0].rgb + (2.0*normalSamples[1].rgb) + normalSamples[2].rgb - (normalSamples[6].rgb + (2.0*normalSamples[7].rgb) + normalSamples[8].rgb);\n\n    float edgeNormal = sqrt(dot(sobel_edge_h, sobel_edge_h) + dot(sobel_edge_v, sobel_edge_v));\n    return edgeNormal;\n}\n");return{outline:new $C("vec3 outline(vec3 outlineColor, vec3 contourColor, float outlineWidth, float contourWidth, float outlineThreshold, float contourThreshold, float outlineSmoothing, float contourFrequency, vec3 contourDirection, bool positionalLines, vec2 resolution, sampler2D normalMap, sampler2D depthMap, float pixelRatio, bool compensation, float mask, float alpha, out float calpha) {\n                vec3 result = outlineColor;\n                float resultAlpha = 0.0;\n\n                vec3 N = normalize(vWNormal);\n                vec2 nuv = (gl_FragCoord.xy / resolution);\n                float sobelSample = compensation ? sobelSample(normalMap, depthMap, nuv, resolution, outlineWidth / 2., pixelRatio) : sobelSample(normalMap, depthMap, nuv, resolution, outlineWidth, pixelRatio);\n                resultAlpha = smoothstep(outlineThreshold - outlineSmoothing, outlineThreshold + outlineSmoothing, sobelSample);\n\n                //resultAlpha = 1.0;\n                //result = vec3(sobelSample);\n\n                float t = 1.0 - contourThreshold;\n                if(positionalLines) {\n                    vec3 NDir = position * contourDirection;\n                    float NT = NDir.x + NDir.y + NDir.z;\n                    float f  = fract(NT * contourFrequency * 0.01);\n                    float df = fwidth(NT * contourFrequency);\n\n                    float g = smoothstep(df * (contourWidth * 0.01), df * (contourWidth * 0.01 * 2.0), f);\n                    if (g < 1.0 && resultAlpha == 0.0) {\n                        result = contourColor;\n                        resultAlpha = 1.0;\n                    }\n                 }\n                 else {\n                    vec3 NDir = N * contourDirection;\n                    float NT = NDir.x + NDir.y + NDir.z;\n                    float df = fwidth(NT * contourThreshold);\n                    float f = sin(NT * 1.0 * contourFrequency);\n                    float g = smoothstep(0.0, df * contourWidth, 1.0 - f);\n\n                    if (df > (t * 0.5) && g < 1.0 && resultAlpha == 0.0) {\n                        result = contourColor;\n                        resultAlpha = 1.0 - g;\n                    }\n                 }\n\n                 float lalpha = alpha * resultAlpha * mask;\n                 calpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );\n                 accumAlpha += ( 1.0 - accumAlpha ) * lalpha;\n\t\t\t\t \n                 return result;\n             }",[e])}}();var lT=class extends WC{constructor(e,t,n,i,r,s,a,o,l,c,h,u,d,p,f,m,g,v){super("v3"),this.nodeType="Pattern",this.style=e,this.projection=t,this.axis=n,this.blending=i,this.offset=r,this.colorA=s,this.colorB=a,this.frequency=o,this.size=l,this.variation=c,this.smoothness=h,this.zigzag=u,this.rotation=d,this.vertical=p,this.horizontal=f,this.sides=m,this.isMask=v,this.alpha=g,this.calpha="g".concat(this.uuid.toString().replace(/-/g,""),"_calpha")}generate(e,t){if(e.isShader("fragment")){let n;switch(e.require("position"),e.require("uv"),e.requires.uv=[!0],e.require("normal"),e.requires.normal=!0,e.addFragmentVariable(this.calpha,"float"),this.style.value){case 0:default:n="circle";break;case 1:n="ring";break;case 2:n="polygon";break;case 3:n="xcross";break;case 4:n="diamond";break;case 5:n="checkerboard";break;case 6:n="line";break;case 7:n="wave"}let i="g".concat(this.uuid.toString().replace(/-/g,"")),r=new $C("float hashwithoutsine12(vec2 p)\n\t\t\t\t{\n\t\t\t\t\tvec3 p3 = fract(vec3(p.xyx) * .1031);\n\t\t\t\t\tp3 += dot(p3, p3.yzx + 33.33);\n\t\t\t\t\treturn fract((p3.x + p3.y) * p3.z);\n\t\t\t\t}"),s=new $C("vec2 rotate_uv(in vec2 uv, float a, bool repeat) \n\t\t\t\t{\n\t\t\t\t\tconst float mid = 0.5;\n\t\t\t\t\tfloat radians = a * (PI / 180.0);\n\t\t\t\t\tvec2 rotated = vec2(\n\t\t\t\t\t\tcos(radians) * (uv.x - mid) + sin(radians) * (uv.y - mid) + mid,\n\t\t\t\t\t\tcos(radians) * (uv.y - mid) - sin(radians) * (uv.x - mid) + mid\n\t\t\t\t\t);\n\t\t\t\t\treturn repeat ? fract(rotated): rotated;\n\t\t\t\t}"),a="";if(4===this.projection.value){let e=2===this.style.value?"".concat(n,"(uv0, frequency, size, variation, smoothness_remapped, zigzag, rotation, sides)"):"".concat(n,"(uv0, frequency, size, variation, smoothness_remapped, zigzag, rotation)"),t=2===this.style.value?"".concat(n,"(uv1, frequency, size, variation, smoothness_remapped, zigzag, rotation, sides)"):"".concat(n,"(uv1, frequency, size, variation, smoothness_remapped, zigzag, rotation)"),i=2===this.style.value?"".concat(n,"(uv2, frequency, size, variation, smoothness_remapped, zigzag, rotation, sides)"):"".concat(n,"(uv2, frequency, size, variation, smoothness_remapped, zigzag, rotation)");a="\n\t\t\t\tvec3 p = position;\n\t\t\t\tfloat factor = 0.0125;\n\t\t\t\tvec2 uv0 = fract(p.xy * factor);\n\t\t\t\tvec2 uv1 = fract(p.zy * factor);\n\t\t\t\tvec2 uv2 = fract(p.xz * factor);\n\t\t\t\t\n\t\t\t\tuv0 = rotate_uv(uv0 + offset, rotation, true);\n\t\t\t\tuv1 = rotate_uv(uv1 + offset, rotation, true);\n\t\t\t\tuv2 = rotate_uv(uv2 + offset, rotation, true);\n\t\n\t\t\t\tfloat d0 = ".concat(e,";\n\t\t\t\tfloat d1 = ").concat(t,";\n\t\t\t\tfloat d2 = ").concat(i,";\n\t\t\t\t\n\t\t\t\t// Range from 3 to 128 seems to be good\n\t\t\t\tfloat exponent = (1.0 - blending) * 125.0 + 3.0;\n\n\t\t\t\tvec3 n = vObjectNormal;\n\t\t\t\tvec3 weights = abs(normalize(n));\n\t\t\t\tweights = pow(weights, vec3(exponent));\n\t\t\t\tweights /= dot(weights, vec3(1.0));\n\t\t\t\td0 *= weights.z;\n\t\t\t\td1 *= weights.x;\n\t\t\t\td2 *= weights.y;\n\t\t\t\tfloat draw = d0 + d1 + d2;\n\t\n\t\t\t\tvec2 custom_uv = uv0 * weights.z + uv1 * weights.x + uv2 * weights.y;\n\t\t\t\t")}else{let e=2===this.style.value?"".concat(n,"(custom_uv, frequency, size, variation, smoothness_remapped, zigzag, rotation, sides)"):"".concat(n,"(custom_uv, frequency, size, variation, smoothness_remapped, zigzag, rotation)"),t="";0===this.axis.value?t="float radius = length(p);\n\t\t\t\t\tfloat theta = atan(p.y, p.z);\n\t\t\t\t\tfloat phi = acos(p.x / radius);":1===this.axis.value?t="float radius = length(p);\n\t\t\t\t\tfloat theta = atan(p.x, p.z);\n\t\t\t\t\tfloat phi = acos(p.y / radius);":(this.axis.value,t="float radius = length(p);\n\t\t\t\t\tfloat theta = atan(p.y, p.x);\n\t\t\t\t\tfloat phi = acos(p.z / radius);");let i="";switch(this.projection.value){case 0:i="custom_uv = vUv.st;";break;case 1:case 3:default:break;case 2:i="\n\t\t\t\t\t\t\tvec3 p = position;\n\t\t\t\t\t\t\t".concat(t,"\n\t\t\t\t\t\t\tcustom_uv = vec2(theta, phi);\n\t\t\t\t\t\t\tcustom_uv /= PI;\n\t\t\t\t\t\t\t")}a="\n\t\t\t\tvec2 custom_uv;\n\t\t\t\t".concat(i,"\n\t\n\t\t\t\tcustom_uv += offset;\n\t\t\t\tcustom_uv = fract(custom_uv);\n\t\t\t\tcustom_uv = rotate_uv(custom_uv, rotation, true);\n\t\n\t\t\t\tfloat draw = ").concat(e,";\n\t\t\t\t")}let o=new $C("vec3 ".concat(i,"_pattern(vec3 normal, float blending, int style, vec2 offset, vec4 colorA, vec4 colorB, vec2 frequency, float size, float variation, float smoothness, float zigzag, float rotation, vec2 vertical, vec2 horizontal, int sides, bool isMask, float mask, float alpha, out float calpha) {\n\t\t\t\t\tconst float TWO_PI = PI * 2.0;\n\t\t\t\t\tfloat smoothness_remapped = pow(smoothness, 5.0);\t\n\n\t\t\t\t\t").concat(a,"\n\n\t\t\t\t\t// Construct final output color\n\t\t\t\t\tvec4 color = mix(colorA, colorB, draw);\n\t\t\t\t\tcolor.a = clamp(color.a, 0.0, 1.0);\n\n\t\t\t\t\t// Apply cuts\n\t\t\t\t\tcolor.a *= \n\t\t\t\t\t\tstep(vertical.x, custom_uv.y) * \n\t\t\t\t\t\tstep(custom_uv.y, vertical.y);\n\t\t\t\t\tcolor.a *= \n\t\t\t\t\t\tstep(horizontal.x, abs(custom_uv.x)) * \n\t\t\t\t\t\tstep(abs(custom_uv.x), horizontal.y);\n\n\t\t\t\t\t// Accumulate alpha \n\t\t\t\t\tfloat lalpha = alpha * clamp(color.a, 0.0, 1.0) * mask;\n\t\t\t\t\tcalpha = mix(lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0), lalpha, float(isMask));\n\t\t\t\t\taccumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));\n\n\t\t\t\t\treturn clamp(color, 0.0, 1.0).rgb;\n\t\t\t\t}"),[s,r,lT.DrawFunctions.circle,lT.DrawFunctions.ring,lT.DrawFunctions.polygon,lT.DrawFunctions.cross,lT.DrawFunctions.diamond,lT.DrawFunctions.checkerboard,lT.DrawFunctions.line,lT.DrawFunctions.wave]),l=e.include(o),c=[];return c.push("normal"),c.push(this.blending.build(e,"f")),c.push(this.style.build(e,"i")),c.push(this.offset.build(e,"v2")),c.push(this.colorA.build(e,"v4")),c.push(this.colorB.build(e,"v4")),c.push(this.frequency.build(e,"v2")),c.push(this.size.build(e,"f")),c.push(this.variation.build(e,"f")),c.push(this.smoothness.build(e,"f")),c.push(this.zigzag.build(e,"f")),c.push(this.rotation.build(e,"f")),c.push(this.vertical.build(e,"v2")),c.push(this.horizontal.build(e,"v2")),c.push(this.sides.build(e,"i")),c.push(this.isMask.build(e,"b")),c.push(this.mask?"luminance(".concat(this.mask.flow(e,"v3").result,")"):"1.0"),c.push(this.alpha.build(e,"f")),c.push(this.calpha),e.format(l+"("+c.join(",")+")",this.getType(e),t)}return console.warn("PatterNode is not compatible with "+e.shader+" shader."),e.format("vec3(0.0)",this.getType(e),t)}},cT=lT;cT.DrawFunctions=function(){let e=new $C("float hashwithoutsine12(vec2 p) {\n\t\t\t\tvec3 p3 = fract(vec3(p.xyx) * 0.1031);\n\t\t\t\tp3 += dot(p3, p3.yzx + 33.33);\n\t\t\t\treturn fract((p3.x + p3.y) * p3.z);\n\t\t\t}"),t=new $C("vec2 tile_and_center(in vec2 uv, in vec2 frequency, in float variation, in float zigzag, in float rotation) {\n                // Create tiles in UV-space\n                uv *= frequency;\n\n                // Integer coords\n                vec2 i = floor(uv);\n\n                // Offset every other row based on zigzag param, then compute fractional coords\n                float row_offset = mod(i.y, 2.0);\n                uv.x += row_offset * zigzag;\n                vec2 f = fract(uv);\n\n\t\t\t\t// Rotate the tile itself:\n\t\t\t\t// const float mid = 0.5;\n\t\t\t\t// f = vec2(\n\t\t\t\t// \tcos(rotation) * (f.x - mid) + sin(rotation) * (f.y - mid) + mid,\n\t\t\t\t// \tcos(rotation) * (f.y - mid) - sin(rotation) * (f.x - mid) + mid\n\t\t\t\t// );\n\t\t\t\t// f = fract(f);\n\n                f = f * 2.0 - 1.0;\n\n\t\t\t\t// Recompute integer coords after shifting - then, random value per tile \n\t\t\t\ti = floor(uv);\n\t\t\t\tfloat rand = (hashwithoutsine12(i) * 5.0 + 1.0);\n\t\t\t\tfloat jitter = mix(1.0, rand, variation);\n\t\t\t\tf *= jitter;\n\n                return f;\n            }",[e]);return{tileAndCenter:t,circle:new $C("float circle(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation) {\n                vec2 f = tile_and_center(uv, frequency, variation, zigzag, rotation);\n                return smoothstep(\n                    -smoothness, \n                     smoothness, \n                     length(f) - size\n                );\n            }",[t]),ring:new $C("float ring(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation) {\n                vec2 f = tile_and_center(uv, frequency, variation, zigzag, rotation);\n\n\t\t\t\tfloat d = length(f);\n                const float inner_width = 0.5;\n\n                float outer = smoothstep(-smoothness, smoothness, d - size);\n                float inner = smoothstep(-smoothness, smoothness, d - size * inner_width);\n\t\t\t\treturn outer + (1.0 - inner);   \n            }",[t]),polygon:new $C("float sdf_ngon(in vec2 p, in float r, in int n) {\n                float an = (PI * 2.0) / float(n);\n                float he = r * tan(0.5 * an);\n                \n                // Rotate to first sector\n                p = -p.yx; \n                float bn = an * floor((atan(p.y, p.x) + 0.5 * an) / an);\n                vec2  cs = vec2(cos(bn), sin(bn));\n                p = mat2(cs.x, -cs.y, cs.y, cs.x)*p;\n            \n                // Side of polygon\n                return length(p - vec2(r, clamp(p.y, -he, he))) * sign(p.x - r);\n            }\n            \n            float polygon(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation, in int sides) {\n                vec2 f = tile_and_center(uv, frequency, variation, zigzag, rotation);\n                return smoothstep(-smoothness, smoothness, sdf_ngon(f, size, sides));\n            }",[t]),cross:new $C("float sdf_cross(in vec2 p, in vec2 b, float r ) {\n                p = abs(p); \n\t\t\t\tp = (p.y > p.x) ? p.yx : p.xy;\n                vec2  q = p - b;\n                float k = max(q.y, q.x);\n                vec2  w = (k > 0.0) ? q : vec2(b.y - p.x, -k);\n                return sign(k) * length(max(w, 0.0)) + r;\n            }\n            \n            // Avoid namespace conflicts \n            float xcross(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation) {\n                vec2 f = tile_and_center(uv, frequency, variation, zigzag, rotation);\n                return smoothstep(-smoothness, smoothness, sdf_cross(f, vec2(size, size * 0.25), smoothness));\n            }",[t]),diamond:new $C("float ndot(vec2 a, vec2 b) { \n                return a.x*b.x - a.y*b.y; \n            }\n            \n            float sdf_diamond(in vec2 p, in vec2 b) {\n                p = abs(p);\n                float h = clamp(ndot(b - 2.0 * p, b) / dot(b, b), -1.0, 1.0);\n                float d = length(p - 0.5 * b * vec2(1.0 - h, 1.0 + h));\n                return d * sign(p.x * b.y + p.y * b.x - b.x * b.y);\n            }\n\n            float diamond(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation) {\n                vec2 f = tile_and_center(uv, frequency, variation, zigzag, rotation);\n\t            return smoothstep(-smoothness, smoothness, sdf_diamond(f, vec2(size)));\n            }",[t]),checkerboard:new $C("float checkerboard(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation) {\n                uv *= frequency;\n                vec2 i = floor(uv);\n\n                float offset = mod(i.y, 2.0);\n\n                uv.x += offset + zigzag * offset;\n                float x = floor(uv.x);\n                \n                return mod(x, 2.0);\n            }"),line:new $C("float line(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation) {\n                vec2 f = tile_and_center(uv, frequency, 0.0, zigzag, rotation);\n\t\t\t\t\n\t\t\t\t// Different approach for variation param here\n\t\t\t\tfloat row = floor(uv * frequency).y;\n\t\t\t\tfloat rand = hashwithoutsine12(vec2(row));\n\t\t\t\tfloat s = mix(size, size * rand, variation);\n\n\t\t\t\treturn smoothstep(\n\t\t\t\t\ts - smoothness, \n\t\t\t\t\ts + smoothness, \n\t\t\t\t\tabs(f.y)\n\t\t\t\t);\n            }",[t]),wave:new $C("// Uses bisection \n            float udf_cos(in vec2 p, in float a, in float b, in float c, in float d) {\n                // Convert all data to a primitive cosine wave\n                p = c * (p - vec2(d, a));\n                \n                const float TWO_PI = PI * 2.0;\n\n                // Reduce to principal half cycle\n                p.x = mod(p.x, TWO_PI); \n                if (p.x > PI) {\n                    p.x = TWO_PI - p.x;\n                }\n            \n                // Find zero of derivative (minimize distance)\n                float xa = 0.0;\n                float xb = TWO_PI;\n\n                // 24 bit precision\n                for (int i = 0; i < 24; i++) {\n                    float x = 0.5 * (xa + xb);\n                    float y = x - p.x + b * c * sin(x) * (p.y - b * c * cos(x));\n                    if (y < 0.0) xa = x; \n                    else xb = x;\n                }\n                float x = 0.5 * (xa + xb);\n                \n                // Compute distance    \n                vec2 q = vec2(x, b * c * cos(x));\n                return length(p - q) / c;\n            }\n\n            float wave(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation) {\n                float repeat = frequency.x;\n                uv *= repeat;\n                vec2 i = floor(uv);\n                float row_offset = mod(i.y, 2.0);\n                uv.x += row_offset * zigzag;\n                vec2 f = vec2(uv.x, fract(uv.y));\n\n                // Generalized cosine: y(x) = a + b * cos(cx + d)\n                const float amplitude = 0.125;\n                float wave_frequency = frequency.y * 0.1;\n                float distance_estimate = udf_cos(f, 0.50, amplitude, wave_frequency * (2.0 * PI), 0.0);\n\n\t\t\t\t// Different approach for variation param here\n\t\t\t\tfloat rand = hashwithoutsine12(vec2(i.y));\n\t\t\t\tfloat s = mix(size, size * rand, variation);\n\n                return smoothstep(-smoothness, smoothness, distance_estimate - s * 0.5);\n            }")}}();var hT=class extends WC{constructor(e,t,n,i,r,s,a,o){super("v3"),this.nodeType="Rainbow",this.filmThickness=e,this.movement=t,this.wavelengths=n,this.noiseStrength=i,this.noiseScale=r,this.offset=s,this.isMask=o,this.alpha=a,this.calpha="g".concat(this.uuid.toString().replace(/-/g,""),"_calpha")}generate(e,t){if(e.require("vWorldViewDir"),e.require("worldNormal"),e.isShader("fragment")){e.require("uv"),e.requires.uv=[!0],e.addFragmentVariable(this.calpha,"float");let n=e.include(hT.Nodes.rainbow),i=[];return i.push(this.filmThickness.build(e,"f")),i.push(this.movement.build(e,"f")),i.push(this.wavelengths.build(e,"v3")),i.push(this.noiseStrength.build(e,"f")),i.push(this.noiseScale.build(e,"f")),i.push(this.offset.build(e,"v3")),i.push(this.isMask.build(e,"b")),i.push(this.mask?"luminance(".concat(this.mask.flow(e,"v3").result,")"):"1.0"),i.push(this.alpha.build(e,"f")),i.push(this.calpha),e.format(n+"("+i.join(",")+")",this.getType(e),t)}return console.warn("RainbowNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},uT=hT;uT.Nodes=function(){let e=new $C("vec3 attenuation(vec3 wavelengths, float filmThickness, float movement, float noiseStrength, float noiseScale, vec3 offset) {\n\t\t\t\tfloat f = 0.0;\n\t\t\t\t\n\t\t\t\tif (noiseStrength != 0.0) {\n\t\t\t\t\tvec3 st = position / noiseScale;\n\t\t\t\t\tfloat noise = simplexFast(1.6 * st + vec3(1.8, 1.5, 1.9) * simplexFast(st) + vec3(1.7, 9.2, 1.0));\n\t\t\t\t\tf = noise * noiseStrength;\n\t\t\t\t}\n\n\t\t\t\tvec3 waves = wavelengths * vec3(1.0, 0.8, 0.6) + 1.0;\n\t\t\t\tfloat angle = dot(normalize(vWorldViewDir + (offset * -0.001)), normalize(vWNormal));\n\n\t\t\t\tmediump vec3 color = cos((((filmThickness + f) / waves) * angle) + movement);\n\t\t\t\treturn .5 + .5 * color;\n\t\t\t }",[rT.simplexFast]);return{rainbow:new $C("vec3 rainbow(float filmThickness, float movement, vec3 wavelengths, float noiseStrength, float noiseScale, vec3 offset, bool isMask, float mask, float alpha, out float calpha) {\n\t\t\t\tmediump vec3 res = clamp(attenuation(wavelengths, filmThickness, movement, noiseStrength, noiseScale, offset), 0.0, 2.0);\n\n\t\t\t\tfloat rainbowContribution = clamp(res.r + res.g + res.b, 0.0, 1.0);\n\n\t\t\t\tfloat lalpha = alpha * rainbowContribution * mask;\n\t\t\t\tcalpha = mix(lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0), lalpha, float(isMask));\n\t\t\t\taccumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));\n\n\t\t\t\treturn res;\n\t\t\t }",[e])}}();var dT=class extends WC{constructor(e,t,n,i,r,s,a,o,l,c){super("v3"),this.nodeType="Toon",this.positioning=e,this.colors=t,this.steps=n,this.source=i,this.isWorldSpace=r,this.noiseStrength=s,this.noiseScale=a,this.shadowColor=o,this.offset=l,this.alpha=c,this.calpha="g".concat(this.uuid.toString().replace(/-/g,""),"_calpha")}generate(e,t){if(e.require("worldNormal"),e.require("worldPosition"),e.isShader("fragment")){e.define("COLORS_MAX",10),e.addFragmentVariable(this.calpha,"float");let n=e.include(dT.Nodes.toon),i=[];return i.push(this.positioning.build(e,"i")),i.push(this.colors.build(e,"v4[]")),i.push(this.steps.build(e,"f[]")),i.push(this.source.build(e,"v3")),i.push(this.isWorldSpace.build(e,"b")),i.push(this.noiseStrength.build(e,"f")),i.push(this.noiseScale.build(e,"f")),i.push(this.shadowColor.build(e,"v4")),i.push(this.offset.build(e,"v3")),i.push(this.mask?"luminance(".concat(this.mask.flow(e,"v3").result,")"):"1.0"),i.push(this.alpha.build(e,"f")),i.push(this.calpha),e.format(n+"("+i.join(",")+")",this.getType(e),t)}return console.warn("ToonNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},pT=dT;pT.Nodes=function(){let e=new $C("float rand(float n) {\n\t\t\t\treturn fract(sin(n) * 43758.5453123);\n\t\t\t}"),t=new $C("float hash1(float p) { \n\t\t\t\tp = fract(p * 0.011); \n\t\t\t\tp *= p + 7.5; \n\t\t\t\tp *= p + p; \n\t\t\t\treturn fract(p); \n\t\t\t}"),n=new $C("float valueNoise(vec3 x) {\n\t\t\t\tconst vec3 step = vec3(110, 241, 171);\n\t\t\t\n\t\t\t\tvec3 i = floor(x);\n\t\t\t\tvec3 f = fract(x);\n\t\t\t \n\t\t\t\t// For performance, compute the base input to a 1D hash from the integer part of the argument and the \n\t\t\t\t// incremental change to the 1D based on the 3D -> 1D wrapping\n\t\t\t\tfloat n = dot(i, step);\n\t\t\t\n\t\t\t\tvec3 u = f * f * (3.0 - 2.0 * f);\n\t\t\t\treturn mix(mix(mix( hash1(n + dot(step, vec3(0, 0, 0))), hash1(n + dot(step, vec3(1, 0, 0))), u.x),\n\t\t\t\t\t\t\t   mix( hash1(n + dot(step, vec3(0, 1, 0))), hash1(n + dot(step, vec3(1, 1, 0))), u.x), u.y),\n\t\t\t\t\t\t   mix(mix( hash1(n + dot(step, vec3(0, 0, 1))), hash1(n + dot(step, vec3(1, 0, 1))), u.x),\n\t\t\t\t\t\t\t   mix( hash1(n + dot(step, vec3(0, 1, 1))), hash1(n + dot(step, vec3(1, 1, 1))), u.x), u.y), u.z);\n\t\t\t}",[t]),i=new $C("vec3 hash3(vec3 x) {\n\t\t\t\tx = vec3(dot(x,vec3(127.1, 311.7, 74.7)),\n\t\t\t\t\t\t dot(x,vec3(269.5, 183.3, 246.1)),\n\t\t\t\t\t\t dot(x,vec3(113.5, 271.9, 124.6)));\n\t\t\t\n\t\t\t\treturn fract(sin(x)*43758.5453123);\n\t\t\t}"),r=new $C('vec3 voronoiNoise(in vec3 x)\n\t\t\t{\n\t\t\t\tvec3 p = floor(x);\n\t\t\t\tvec3 f = fract(x);\n\n\t\t\t\tfloat id = 0.0;\n\t\t\t\tvec2 res = vec2(100.0);\n\n\t\t\t\tfor(int k=-1; k<=1; k++)\n\t\t\t\tfor(int j=-1; j<=1; j++)\n\t\t\t\tfor(int i=-1; i<=1; i++)\n\t\t\t\t{\n\t\t\t\t\tvec3 b = vec3(float(i), float(j), float(k));\n\n\t\t\t\t\t// Comment out the "+ hash(p + b);" part below to get "square" cells\n\t\t\t\t\tvec3 r = vec3(b) - f + hash3(p + b);\n\t\t\t\t\tfloat d = dot(r, r);\n\n\t\t\t\t\tif (d < res.x)\n\t\t\t\t\t{\n\t\t\t\t\t\tid = dot(p + b, vec3(1.0, 57.0, 113.0));\n\t\t\t\t\t\tres = vec2(d, res.x);\t\t\t\n\t\t\t\t\t}\n\t\t\t\t\telse if (d < res.y)\n\t\t\t\t\t{\n\t\t\t\t\t\tres.y = d;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn vec3(sqrt(res), abs(id));\n\t\t\t}\n\t\t\t',[i]);return{toon:new $C('vec3 toon(int positioning, vec4 colors[COLORS_MAX], float steps[COLORS_MAX], vec3 source, bool isWorldSpace, float noiseStrength, float noiseScale, vec4 shadowColor, vec3 offset, float mask, float alpha, out float calpha) {\n\t\t\t\tfloat t = 0.0;\n\t\t\t\tfloat shadow = 1.0;\n\n\t\t\t\tif (positioning == 0) {\n\n\t\t\t\t\t// Can\'t do this mode if lighting is "none"\n\t\t\t\t\t#if (defined(PHONG) || defined(LAMBERT) || defined(STANDARD))\n\n\t\t\t\t\t\t// Algorithm from Chapter 10 of Graphics Shaders\n\t\t\t\t\t\tconst vec3 weights = vec3(0.2125, 0.7154, 0.0721);\n\t\t\t\t\t\tvec3 lpos;\n\t\t\t\t\t\tvec3 l;\n\t\t\t\t\t\tfloat dproduct;\n\n\t\t\t\t\t\t#if (NUM_POINT_LIGHTS > 0)\n\n\t\t\t\t\t\t\t#if defined(USE_SHADOWMAP) && (NUM_POINT_LIGHT_SHADOWS > 0)\n\t\t\t\t\t\t\t\tPointLightShadow pointLightShadow;\n\t\t\t\t\t\t\t#endif \n\n\t\t\t\t\t\t\t#pragma unroll_loop_start\n\t\t\t\t\t\t\tfor (int i = 0; i < NUM_POINT_LIGHTS; i++) {\n\t\t\t\t\t\t\t\t// Light positions are in view-space for some reason?\n\t\t\t\t\t\t\t\tlpos = (inverse(viewMatrix) * vec4(pointLights[UNROLLED_LOOP_INDEX].position, 1.0)).xyz;\n\t\t\t\t\t\t\t\tl = normalize(lpos - worldPosition);\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\tdproduct = dot(l, normalize(worldNormal)) * 0.5 + 0.5;\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t// TODO: we want to use "intensity" but it isn\'t available in the shader code\n\t\t\t\t\t\t\t\t//dproduct += dot(pointLights[UNROLLED_LOOP_INDEX].color, weights);\n\n\t\t\t\t\t\t\t\tt = max(t, dproduct);\n\n\t\t\t\t\t\t\t\t// Accumulate shadow contribution\n\t\t\t\t\t\t\t\t#if defined(USE_SHADOWMAP) && (UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS)\n\t\t\t\t\t\t\t\t\tpointLightShadow = pointLightShadows[UNROLLED_LOOP_INDEX];\n\t\t\t\t\t\t\t\t\tshadow *= getPointShadow( \n\t\t\t\t\t\t\t\t\t\t\tpointShadowMap[UNROLLED_LOOP_INDEX], \n\t\t\t\t\t\t\t\t\t\t\tpointLightShadow.shadowMapSize, \n\t\t\t\t\t\t\t\t\t\t\tpointLightShadow.shadowBias, \n\t\t\t\t\t\t\t\t\t\t\tpointLightShadow.shadowRadius,\n\t\t\t\t\t\t\t\t\t\t\tvPointShadowCoord[UNROLLED_LOOP_INDEX], \n\t\t\t\t\t\t\t\t\t\t\tpointLightShadow.shadowCameraNear, \n\t\t\t\t\t\t\t\t\t\t\tpointLightShadow.shadowCameraFar);\n\t\t\t\t\t\t\t\t#endif\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t#pragma unroll_loop_end\n\n\t\t\t\t\t\t#endif\n\n\t\t\t\t\t\t#if NUM_DIR_LIGHTS > 0 \n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t#if defined(USE_SHADOWMAP) && (NUM_DIR_LIGHT_SHADOWS > 0)\n\t\t\t\t\t\t\t\tDirectionalLightShadow directionalLightShadow;\n\t\t\t\t\t\t\t#endif \n\n\t\t\t\t\t\t\t#pragma unroll_loop_start\n\t\t\t\t\t\t\tfor (int i = 0; i < NUM_DIR_LIGHTS; i++) {\n\t\t\t\t\t\t\t\t// Use the direction vector for directional lights instead\n\t\t\t\t\t\t\t\tl = (inverse(viewMatrix) * vec4(directionalLights[UNROLLED_LOOP_INDEX].direction, 0.0)).xyz;\n\t\t\n\t\t\t\t\t\t\t\tdproduct = dot(l, normalize(worldNormal)) * 0.5 + 0.5;\n\t\t\t\t\t\t\t\tt = max(t, dproduct);\n\n\t\t\t\t\t\t\t\t// Accumulate shadow contribution\n\t\t\t\t\t\t\t\t#if defined(USE_SHADOWMAP) && (UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS)\n\t\t\t\t\t\t\t\t\tdirectionalLightShadow = directionalLightShadows[UNROLLED_LOOP_INDEX];\n\t\t\t\t\t\t\t\t\tshadow *= getShadow( \n\t\t\t\t\t\t\t\t\t\tUNROLLED_LOOP_INDEX,\n\t\t\t\t\t\t\t\t\t\tdirectionalShadowMap[UNROLLED_LOOP_INDEX], \n\t\t\t\t\t\t\t\t\t\tdirectionalLightShadow.shadowMapSize, \n\t\t\t\t\t\t\t\t\t\tdirectionalLightShadow.shadowBias, \n\t\t\t\t\t\t\t\t\t\tdirectionalLightShadow.shadowRadius, \n\t\t\t\t\t\t\t\t\t\tvDirectionalShadowCoord[UNROLLED_LOOP_INDEX]);\n\t\t\t\t\t\t\t\t#endif\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t#pragma unroll_loop_end\n\n\t\t\t\t\t\t#endif\n\n\t\t\t\t\t\t#if NUM_SPOT_LIGHTS > 0 \n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t#if defined(USE_SHADOWMAP) && (NUM_SPOT_LIGHT_SHADOWS > 0)\n\t\t\t\t\t\t\t\tSpotLightShadow spotLightShadow;\n\t\t\t\t\t\t\t#endif \n\n\t\t\t\t\t\t\t#pragma unroll_loop_start\n\t\t\t\t\t\t\tfor (int i = 0; i < NUM_SPOT_LIGHTS; i++) {\n\t\t\t\t\t\t\t\tlpos = (inverse(viewMatrix) * vec4(spotLights[UNROLLED_LOOP_INDEX].position, 1.0)).xyz;\n\t\t\t\t\t\t\t\tl = normalize(lpos - worldPosition);\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\tdproduct = dot(l, normalize(worldNormal)) * 0.5 + 0.5;\n\t\t\t\t\t\t\t\tt = max(t, dproduct);\n\n\t\t\t\t\t\t\t\t// Accumulate shadow contribution\n\t\t\t\t\t\t\t\t#if defined(USE_SHADOWMAP) && (UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS)\n\t\t\t\t\t\t\t\t\tspotLightShadow = spotLightShadows[UNROLLED_LOOP_INDEX];\n\t\t\t\t\t\t\t\t\tshadow *= getShadow(\n\t\t\t\t\t\t\t\t\t\tUNROLLED_LOOP_INDEX,\n\t\t\t\t\t\t\t\t\t\tspotShadowMap[UNROLLED_LOOP_INDEX], \n\t\t\t\t\t\t\t\t\t\tspotLightShadow.shadowMapSize, \n\t\t\t\t\t\t\t\t\t\tspotLightShadow.shadowBias, \n\t\t\t\t\t\t\t\t\t\tspotLightShadow.shadowRadius, \n\t\t\t\t\t\t\t\t\t\tvSpotLightCoord[UNROLLED_LOOP_INDEX]);\n\t\t\t\t\t\t\t\t#endif\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t#pragma unroll_loop_end\n\n\t\t\t\t\t\t#endif\n\n\t\t\t\t\t\tt = clamp(t, 0.0, 1.0);\n\t\t\t\t\n\t\t\t\t\t#endif\n\n\t\t\t\t} else if (positioning == 1) {\n\t\t\t\t\t\n\t\t\t\t\tvec3 origin = mix(position, worldPosition, float(isWorldSpace));\n\t\t\t\t\tvec3 direction = normalize(source - origin);\n\t\t\t\t\tt = dot(direction, normalize(worldNormal)) * 0.5 + 0.5;\t\n\n\t\t\t\t} else {\n\n\t\t\t\t\tvec3 origin = worldPosition;\n\t\t\t\t\tvec3 source = cameraPosition - offset;\n\t\t\t\t\tvec3 direction = normalize(source - origin);\n\t\t\t\t\tt = dot(direction, normalize(worldNormal)) * 0.5 + 0.5;\t\n\t\t\t\t\t\n\t\t\t\t}\n\n\t\t\t\tif (noiseStrength > 0.0) {\n\t\t\t\t\t// Distort with noise\n\t\t\t\t\tvec3 st = position / noiseScale;\n\t\t\t\t\t\n\t\t\t\t\t// Voronoi "smooth" noise\n\t\t\t\t\tfloat noise = 1.0 - voronoiNoise(st).x;\n\n\t\t\t\t\t// Voronoi cellular noise\n\t\t\t\t\t//float noise = 1.0 - rand(voronoiNoise(st).z);\n\n\t\t\t\t\t// Position warp noise\n\t\t\t\t\t// vec3 offset = vec3(\n\t\t\t\t\t// \tsimplexFast(st),\n\t\t\t\t\t// \tsimplexFast(st + vec3(111.1, 143.89, 217.19)),\n\t\t\t\t\t// \tsimplexFast(st + vec3(171.1, 247.89, 117.23))\n\t\t\t\t\t// );\n\t\t\t\t\t// st += offset;\n\t\t\t\t\t// float noise = valueNoise(st);\n\n\t\t\t\t\tt += noise * noiseStrength;\n\t\t\t\t}\n\n\t\t\t\tt = clamp(t, 0.0, 1.0);\n\n\t\t\t\t// Compute ramp color\n\t\t\t\tfloat p;\n\t\t\t\tvec4 color = colors[0];\n\t\t\t\tfor (int i = 1; i < COLORS_MAX; i++) {\n\t\t\t\t\tp = clamp((t - steps[i-1]) / (steps[i] - steps[i-1]), 0.0, 1.0);\n\t\t\t\t\tcolor = mix(color, colors[i], smoothstep(0.0, 1.0, p));\n\t\t\t\t}\n\n\t\t\t\t// Incorporate custom shadow color\n\t\t\t\tif (positioning == 0) {\n\n\t\t\t\t\tvec3 blendedShadow = mix(color.rgb, shadowColor.rgb, shadowColor.a);\n\t\t\t\t\tcolor.rgb = mix(blendedShadow, color.rgb, shadow);\n\t\t\t\t\n\t\t\t\t}\n\n\t\t\t\t// Accumulate alpha as usual\n\t\t\t\tfloat lalpha = alpha * color.a * mask;\n\t\t\t\tcalpha =  lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0);\n\t\t\t\taccumAlpha += (1.0 - accumAlpha) * lalpha;\n\n\t\t\t\treturn color.xyz;\n\n            }',[rT.simplexFast,e,n,r])}}();var fT={textureBicubic:new $C("float w0( float a ) {\n            return ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );\n        }\n    \n        float w1( float a ) {\n            return ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );\n        }\n    \n        float w2( float a ){\n            return ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );\n        }\n    \n        float w3( float a ) {\n            return ( 1.0 / 6.0 ) * ( a * a * a );\n        }\n    \n        // g0 and g1 are the two amplitude functions\n        float g0( float a ) {\n            return w0( a ) + w1( a );\n        }\n    \n        float g1( float a ) {\n            return w2( a ) + w3( a );\n        }\n    \n        // h0 and h1 are the two offset functions\n        float h0( float a ) {\n            return - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );\n        }\n    \n        float h1( float a ) {\n            return 1.0 + w3( a ) / ( w2( a ) + w3( a ) );\n        }\n    \n        vec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {\n            uv = uv * texelSize.zw + 0.5;\n    \n            vec2 iuv = floor( uv );\n            vec2 fuv = fract( uv );\n    \n            float g0x = g0( fuv.x );\n            float g1x = g1( fuv.x );\n            float h0x = h0( fuv.x );\n            float h1x = h1( fuv.x );\n            float h0y = h0( fuv.y );\n            float h1y = h1( fuv.y );\n    \n            vec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;\n            vec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;\n            vec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;\n            vec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;\n    \n            return g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) + \n                   g1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );\n        }\n\n        vec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {\n            vec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );\n            vec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );\n            vec2 fLodSizeInv = 1.0 / fLodSize;\n            vec2 cLodSizeInv = 1.0 / cLodSize;\n            vec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );\n            vec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );\n            return mix( fSample, cSample, fract( lod ) );\n        }")};var mT=class extends WC{constructor(e,t,n,i,r,s,a,o){super("v3"),this.nodeType="Transmission",this.thickness=e,this.ior=t,this.roughness=n,this.transmissionSamplerSize=i,this.transmissionSamplerMap=r,this.transmissionDepthMap=s,this.aspectRatio=a,this.alpha=o,this.calpha="g".concat(this.uuid.toString().replace(/-/g,""),"_calpha")}generate(e,t){if(e.extensions.shaderTextureLOD=!0,e.extensions.derivatives=!0,e.isShader("fragment")){e.define("NUM_SAMPLES",6),e.define("BLUR_SLOD",Math.pow(2,xT.transmissionLod.value)),e.require("worldPosition"),e.requires.worldNormal=!0,e.requires.modelMatrix=!0,e.requires.projectionMatrix=!0,e.addFragmentVariable(this.calpha,"float");let n=e.include(mT.Nodes.transmission),i=[];return i.push(this.thickness.build(e,"f")),i.push(this.ior.build(e,"f")),i.push(this.roughness.build(e,"f")),i.push(this.transmissionSamplerSize.build(e,"v2")),i.push(this.transmissionSamplerMap.getTexture(e,"t")),i.push(this.transmissionDepthMap.getTexture(e,"t")),i.push(this.aspectRatio.build(e,"v2")),i.push("normal"),i.push(this.mask?"luminance(".concat(this.mask.flow(e,"v3").result,")"):"1.0"),i.push(this.alpha.build(e,"f")),i.push(this.calpha),e.format(n+"("+i.join(",")+")",this.getType(e),t)}return console.warn("TransmissionNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},gT=mT;gT.Nodes=function(){let e=new $C("vec3 blur(sampler2D sp, vec2 U, vec2 scale, float lod, sampler2D dm, vec2 unrefractedU, vec2 aspectRatio) {\n                // Slightly modified version of this:\n                // https://www.shadertoy.com/view/ltScRG\n\n\t\t\t\t// Special case for blur == 0.0\n\t\t\t\tif (lod == 0.0) {\n\t\t\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\t\treturn texture2DLodEXT( sp, U, 0.0).rgb;\n\t\t\t\t\t#else\n\t\t\t\t\treturn textureLod( sp, U, 0.0).rgb;\n\t\t\t\t\t#endif\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tvec2 texelSize = vec2(1.0) / resolution;\n                vec2 halton = haltonSequence[frameIndex];\n                float temporalOffset = getNoiseInterleavedGradient(gl_FragCoord.xy + halton);\n                float temporalAngle  = temporalOffset * PI2;\n\t\t\t\tvec3 res = vec3(0.0);\n                vec2 uv = vec2(0.0);\n                vec2 offset = vec2(0.0);\n                vec2 vogelSample = vec2(0.0);\n                for (int i = 0; i < NUM_SAMPLES; i++) {\n                    vogelSample =  vogelDiskSample(i, NUM_SAMPLES, temporalAngle) * texelSize;\n                    offset = vogelSample * scale * (lod * 10.0); // TODO: used to be hardcoded to 20\n                    uv = U + offset;\n                    float opaqueDepth = unpackRGBAToDepth(textureLod(dm, uv, lod));\n                    if (opaqueDepth != 0.0 && opaqueDepth < gl_FragCoord.z) {\n                        uv = unrefractedU;\n                        lod = lod > 4.0 ? lod : lod / 2.0;\n                    }\n                    res += textureLod(sp, uv, lod).rgb;\n                }\n                return res / float(NUM_SAMPLES);\n            }"),t=new $C("vec3 getVolumeTransmissionRay( vec3 n, vec3 v, float thickness, float ior, mat4 modelMatrix ) {\n\t\t        // Direction of refracted light.\n\t\t        vec3 refractionVector = refract( -v,  n, 1.0 / ior );\n\t\t        \n\t\t\t\t// Compute rotation-independant scaling of the model matrix.\n\t\t        vec3 modelScale;\n\t\t        modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );\n\t\t        modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );\n\t\t        modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );\n\n\t\t        // The thickness is specified in local space\n\t\t        return normalize( refractionVector ) * thickness * modelScale;\n\t        }"),n=new $C("float applyIorToRoughness( float roughness, float ior ) {\n\t\t\t\t// Scale roughness with IOR so that an IOR of 1.0 results in no microfacet refraction and\n\t\t\t\t// an IOR of 1.5 results in the default amount of microfacet refraction.\n\t\t\t\treturn roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );\n\t\t\t}"),i=new $C('vec3 getTransmissionSample( vec2 fragCoord, float roughness, float ior, vec2 transmissionSamplerSize, sampler2D transmissionSamplerMap, sampler2D transmissionDepthMap, vec2 unrefractedCoords, vec2 aspectRatio) {\n\t\t\t\t// Threejs exports do not pass a depth map to this shader, so we have to fallback to the "Threejs method of blurring" - see\n\t\t\t\t// also the code in convertTransmission.ts, which runs during export\n\t\t\t\t#ifdef IS_THREEJS_EXPORT\n\t\t\t\t\tfloat lod = log2(transmissionSamplerSize.x) * applyIorToRoughness(roughness / 5.0, ior);\n\t\t\t\t\treturn textureBicubic(transmissionSamplerMap, fragCoord.xy, lod).rgb;\n\t\t\t\t#else\n\t\t\t\t\tfloat framebufferLod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );\n\t\t\t\t\tfloat lod = applyIorToRoughness(roughness, ior);\n\t\t\t\t\treturn blur(transmissionSamplerMap, fragCoord, vec2(lod), min(framebufferLod / 5.5, 8.5), transmissionDepthMap, unrefractedCoords, aspectRatio);\n\t\t\t\t#endif\n\t\t\t}',[fT.textureBicubic,n,e]),r=new $C("vec3 getIBLVolumeRefraction( vec3 n, vec3 v, float roughness, vec3 position, mat4 modelMatrix, mat4 viewMatrix, mat4 projMatrix, float ior, float thickness, vec2 transmissionSamplerSize, sampler2D transmissionSamplerMap, sampler2D transmissionDepthMap, vec2 aspectRatio ) {\n\t\t\t\tvec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );\n\t\t\t\tvec3 refractedRayExit = position + transmissionRay;\n\n\t\t\t\t// Project refracted vector on the framebuffer, while mapping to normalized device coordinates.\n\t\t\t\tvec4 ndcPos = projMatrix * viewMatrix *  vec4( refractedRayExit, 1.0 );\n\t\t\t\tvec2 refractionCoords = ndcPos.xy / ndcPos.w;\n\t\t\t\trefractionCoords += 1.0;\n\t\t\t\trefractionCoords /= 2.0;\n\n\t\t\t\tvec4 ndcPosUnrefracted = projMatrix * viewMatrix * vec4(position, 1.0 );\n\t\t\t\tvec2 unrefractedCoords = ndcPosUnrefracted.xy / ndcPosUnrefracted.w;\n\t\t\t\tunrefractedCoords += 1.0;\n\t\t\t\tunrefractedCoords /= 2.0;\n\n\t\t\t\t// Sample framebuffer to get pixel the refracted ray hits.\n\t\t\t\treturn getTransmissionSample( refractionCoords, roughness, ior, transmissionSamplerSize, transmissionSamplerMap, transmissionDepthMap, unrefractedCoords, aspectRatio );\n    \t\t}",[i,t]);return{transmission:new $C("vec3 transmission(float thickness, float ior, float roughness, vec2 transmissionSamplerSize, sampler2D transmissionSamplerMap, sampler2D transmissionDepthMap, vec2 aspectRatio, vec3 normal, float mask, float alpha, out float calpha) {\n                vec3 v = vec3(0.);\n                if (isOrthographic) {\n                    v = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n                } else {\n                    v = normalize(vWPosition - cameraPosition);\n                }\n                vec3 transmission = getIBLVolumeRefraction(vWNormal, -v, roughness,  vWPosition, modelMatrix, viewMatrix, projectionMatrix, ior, thickness, transmissionSamplerSize, transmissionSamplerMap, transmissionDepthMap, aspectRatio );\n                \n\t\t\t\tfloat lalpha = alpha * mask;\n\t\t\t\tcalpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );\n\t\t\t\taccumAlpha += ( 1.0 - accumAlpha ) * alpha;\n\n\t\t\t\treturn transmission;\n            }",[r])}}();var vT=(e=>(e.NOISE="noise",e.MAP="map",e))(vT||{}),yT=class extends WC{constructor(e,t,n,i,r,s,a,o,l,c,h){super("v3"),this.displacementTypeIndex=new RM(0),this.nodeType="VertexDisplacement",this.intensity=e,this.movementOrTexture=t,"map"===Object.values(vT)[this.displacementTypeIndex.value]&&(this.mat=new FM(this.movementOrTexture.value.matrix)),this.cropOrOffset=n,this.scale=c,this.noiseFunctionIndex=h,this.voronoiStyle=i,this.smoothness=r,this.seed=s,this.highCut=a,this.lowCut=o,this.quality=l}generate(e,t){if(e.isShader("vertex")){e.define("USE_LAYER_DISPLACE");let n,i=[];switch(i.push("displaced_position"),i.push("displaced_normal"),Object.values(vT)[this.displacementTypeIndex.value]){case"map":n=e.include(yT.Nodes.map),i.push(this.movementOrTexture.getTexture(e,"t")),i.push("uv"),i.push(this.cropOrOffset.build(e,"f")),this.mat&&i.push(this.mat.build(e,"mat3"));break;case"noise":{let t=["simplexPrecise","simplexFractal","simplexAshima","fbm","perlin","voronoi"][this.noiseFunctionIndex.value],r=new $C("vec3 orthogonal(vec3 v) {\n\t\t\t\t\t\t\treturn normalize(abs(v.x) > abs(v.z) ? vec3(-v.y, v.x, 0.0) : vec3(0.0, -v.z, v.y));\n\t\t\t\t\t\t}"),s="voronoi"==t?"\n\t\t\t\t\tfloat v = ".concat(t,"((p + offset) * scale * 0.001 + neighbour_offset + (movement * 0.1), voronoiStyle, smoothness, seed, quality);\n\t\t\t\t\tv = remap(v, lowCut, highCut, 0.0, 1.0);\n\t\t\t\t\tv = smax(v, 0.0, smoothness * 0.25);\n\t\t\t\t\tv = smin(v, 1.0, smoothness * 0.25);\n\n\t\t\t\t\treturn p + n * v * intensity;\n\t\t\t\t\t"):"\n\t\t\t\t\treturn p + n * ".concat(t,"((p + offset) * scale * 0.001 + neighbour_offset + (movement * 0.1)) * intensity;\n\t\t\t\t\t"),a=new $C("vec3 distorted(vec3 p, vec3 n, float scale, float intensity, vec3 offset, float neighbour_offset, float movement, int voronoiStyle, float smoothness, float seed, float highCut, float lowCut, int quality) {\n\t\t\t\t\t\t\t".concat(s,"\n\t\t\t\t\t\t}"),[rT.simplexPrecise,rT.simplexFractal,rT.simplexAshima,rT.fbm,rT.perlin,rT.voronoi]),o=new $C("vec3 vertexDisplacementNoise(vec3 position, vec3 normal, float scale, vec3 offset, float movement, int voronoiStyle, float smoothness, float seed, float highCut, float lowCut, int quality, float intensity, out vec3 displaced_normal) {\n\t\t\t\t\t\t\tvec3 displaced_position = distorted(position, normal, scale, intensity, offset, neighbor_offset, movement, voronoiStyle, smoothness, seed, highCut, lowCut, quality);\n\t\t\t\t\t\t\tvec3 tangent1 = orthogonal(normal);\n\t\t\t\t\t\t\tvec3 tangent2 = normalize(cross(normal, tangent1));\n\n                            // TODO(Max): The distance to the neighbors was originally scaled by 0.1.\n                            // This caused some small oval/circular visual artifacts in the lighting.\n                            // For now, simply using neighbors further away betters the problem,\n                            // but we should figure out the underlying cause when we have some time.\n                            // Maybe its related to how we calculate the tangent and bitangent?\n\t\t\t\t\t\t\tvec3 nearby1 = position + tangent1;\n\t\t\t\t\t\t\tvec3 nearby2 = position + tangent2;\n\t\t\t\t\t\t\tvec3 distorted1 = distorted(nearby1, normal, scale, intensity, offset, neighbor_offset, movement, voronoiStyle, smoothness, seed, highCut, lowCut, quality);\n\t\t\t\t\t\t\tvec3 distorted2 = distorted(nearby2, normal, scale, intensity, offset, neighbor_offset, movement, voronoiStyle, smoothness, seed, highCut, lowCut, quality);\n\t\t\t\t\t\t\tdisplaced_normal = normalize(cross(distorted1 - displaced_position, distorted2 - displaced_position));\n\t\t\t\t\t\t\treturn displaced_position;\n\t\t\t\t\t\t}",[a,r]);n=e.include(o),i.push(this.scale.build(e,"f")),i.push(this.cropOrOffset.build(e,"v3")),i.push(this.movementOrTexture.build(e,"f")),i.push(this.voronoiStyle.build(e,"i")),i.push(this.smoothness.build(e,"f")),i.push(this.seed.build(e,"f")),i.push(this.highCut.build(e,"f")),i.push(this.lowCut.build(e,"f")),i.push(this.quality.build(e,"i"));break}}return i.push(this.intensity.build(e,"f")),i.push("displaced_normal"),e.format(n+"("+i.join(",")+")",this.getType(e),t)}return console.warn("VertexDisplacementNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},bT=yT;bT.Nodes=function(){let e=new $C("vec3 orthogonal(vec3 v) {\n\t\t\t\treturn normalize(abs(v.x) > abs(v.z) ? vec3(-v.y, v.x, 0.0) : vec3(0.0, -v.z, v.y));\n\t\t\t}"),t=new $C("float displacementMapTexture(sampler2D tex, float crop, vec2 uv, mat3 mat, vec2 offset) {\n\t\t\t\tvec2 uvs = (mat * vec3(uv * 2.0 - 1.0, 1.0) / 2.0 + 0.5).xy + offset;\n\t\t\t\tvec4 tmp = texture2D(tex, uvs);\n\t\t\t\tvec3 col = tmp.rgb;\n\t\t\t\tif (crop > 0.5) {\n\t\t\t\t\tif ( uvs.x < 0.0 || uvs.x > 1.0 || uvs.y < 0.0 || uvs.y > 1.0 )  {\n\t\t\t\t\t\treturn 0.0;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn col.r;\n\t\t\t}");return{map:new $C("vec3 vertexDisplacementMap(vec3 position, vec3 normal, sampler2D tex, vec2 uv, float crop, mat3 mat, float intensity, out vec3 displaced_normal) {\n\t\t\t\tvec3 displaced_position = position + normal * displacementMapTexture(tex, crop, uv, mat, vec2(0.0)) * intensity;\n\t\t\t\tvec3 tangent1 = normalize(orthogonal(normal));\n\t\t\t\tvec3 tangent2 = normalize(cross(normal, tangent1));\n\t\t\t\tvec3 nearby1 = position + tangent1 * 0.1;\n\t\t\t\tvec3 nearby2 = position + tangent2 * 0.1;\n\t\t\t\tvec3 distorted1 = nearby1 + normal * displacementMapTexture(tex, crop, uv, mat, vec2(neighbor_offset)) * intensity;\n\t\t\t\tvec3 distorted2 = nearby2 + normal * displacementMapTexture(tex, crop, uv, mat, vec2(neighbor_offset)) * intensity;\n\t\t\t\tdisplaced_normal = normalize(cross(distorted1 - displaced_position, distorted2 - displaced_position));\n\t\t\t\treturn displaced_position;\n\t\t\t}",[e,t])}}();var xT={normalRenderTarget:new hM,normalRenderTargetDepth:new hM,transmissionRenderTarget:new hM,aspectRatio:new XC,transmissionSize:new XC(2048,2048),transmissionRenderTargetDepth:new hM,aoRenderTarget:new hM,aoEnabled:new kM,pixelRatioNode:new uM(1),resolution:new XC,penumbraSize:new LM(5,.5),frameIndex:new RM(0),transmissionLod:new RM(2)};for(let n of Object.values(xT))n.isRenderGlobal=!0;var wT,ST={skiaWasmUrl:"https://unpkg.com/@splinetool/ui-wasm@1.9.63/build/ui.wasm"},_T=class extends VC{constructor(){super("basic"),this.nodeType="Basic",this.color=new IM(ab),this.shadingAlpha=new uM(1),this.shadingBlend=new RM(0),this.previousModelViewMatrix=new UM,this.previouseProjectionMatrix=new UM}get category(){return"phong"}generate(e){let t;if(e.isShader("vertex")){let n=this.position?this.position.analyzeAndFlow(e,"v3",{cache:"position"}):void 0;e.mergeUniform({frameIndex:xT.frameIndex}),e.mergeUniform({resolution:xT.resolution}),e.mergeUniform({previousModelViewMatrix:this.previousModelViewMatrix}),e.mergeUniform({previousProjectionMatrix:this.previouseProjectionMatrix}),e.mergeUniform(Ii.merge([Zi.fog])),e.addParsCode(["varying vec3 vViewPosition;","varying vec3 vWPosition;","#include <fog_pars_vertex>","#include <skinning_pars_vertex>","#include <normal_pars_vertex>","#include <morphtarget_pars_vertex>"].join("\n"));let i=["#include <beginnormal_vertex>","#include <morphnormal_vertex>","\n\t\t\t\t#include <skinbase_vertex>\n\t\t\t\t#include <skinnormal_vertex>\n\t\t\t\t#if !defined( USE_LAYER_DISPLACE )\n\t\t\t\t\t#include <defaultnormal_vertex>\n\t\t\t\t#endif\n\n\t\t\t\tvec3 displaced_position = position;\n\t\t\t\tvec3 displaced_normal = normal;\n\n\t\t\t\t#if defined( USE_LAYER_DISPLACE )\n\t\t\t\t\tvec3 transformed;\n\t\t\t\t\tvec3 transformedNormal;\n\t\t\t\t#endif\n\t\t\t\t","#include <normal_vertex>","\n\t\t\t\t#if !defined( USE_LAYER_DISPLACE )\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t#endif /* !USE_LAYER_DISPLACE */\n\t\t\t\t"];n&&i.push(n.code,n.result?"displaced_position = "+n.result+";":""),i.push("transformed = displaced_position;","#include <morphtarget_vertex>","#include <skinning_vertex>","transformedNormal = normalMatrix * displaced_normal;","#ifndef FLAT_SHADED","\tvNormal = transformedNormal;","#endif"),i.push("#include <project_vertex>","#include <fog_vertex>","#include <clipping_planes_vertex>","\tvViewPosition = - mvPosition.xyz;","#include <worldpos_vertex>"),i.push("vWPosition = ( modelMatrix * vec4( transformed, 1.0 ) ).xyz;"),t=i.join("\n")}else{void 0===this.color&&(this.color=new IM(ab)),this.color.analyze(e,{slot:"color"}),this.alpha&&this.alpha.analyze(e),this.afterColor&&this.afterColor.analyze(e,{slot:"afterColor"});let n=this.color.flow(e,"c",{slot:"color"}),i=this.alpha?this.alpha.flow(e,"f"):void 0,r=this.alphaOverride?this.alphaOverride.flow(e,"f"):void 0,s=this.afterColor?this.afterColor.flow(e,"c",{slot:"afterColor"}):void 0;e.requires.transparent=void 0!==i,e.addParsCode(["varying vec3 vWPosition;","#include <fog_pars_fragment>","#include <dithering_pars_fragment>","varying vec3 vViewPosition;","#include <normal_pars_fragment>"].join("\n"));let a=["#include <normal_fragment_begin>",n.code];i&&a.push(i.code,"#ifdef ALPHATEST"," if ( "+i.result+" <= ALPHATEST ) discard;","#endif"),s?a.push(s.code,"vec3 outgoingLight = ".concat(n.result,";"),"vec3 finalColor = spe_blend(outgoingLight, ".concat(s.result,", 1.0, SPE_BLENDING_NORMAL);")):a.push("vec3 finalColor = ".concat(n.result,";"));let o="1.0";this.mask&&(this.mask.analyze(e),o="luminance(".concat(this.mask.flow(e,"v3").result,")")),i?a.push("gl_FragColor = vec4( finalColor, accumAlpha * ".concat(i.result," * ").concat(o," );")):a.push("gl_FragColor = vec4("+n.result+", 1.0 );"),r&&a.push("gl_FragColor.a *= ".concat(r.result,";")),a.push("#include <fog_fragment>","#include <dithering_fragment>"),t=a.join("\n")}return t}},ET=class extends VC{constructor(){super("lambert"),this.nodeType="Lambert",this.color=new IM(ab),this.emissive=new IM(0),this.emissiveIntensity=new uM(1),this.previousModelViewMatrix=new UM,this.previouseProjectionMatrix=new UM,this.shadingAlpha=new uM(1),this.shadingBlend=new RM(0),this.occlusion=new kM(!0)}get category(){return"lambert"}build(e){let t;if(e.define("LAMBERT"),e.requires.lights=!0,e.extensions.derivatives=!0,e.isShader("vertex")){let n=this.position?this.position.analyzeAndFlow(e,"v3",{cache:"position"}):void 0;e.mergeUniform({frameIndex:xT.frameIndex}),e.mergeUniform({resolution:xT.resolution}),e.mergeUniform({previousModelViewMatrix:this.previousModelViewMatrix}),e.mergeUniform({previousProjectionMatrix:this.previouseProjectionMatrix}),e.mergeUniform(Ii.merge([Zi.fog,Zi.lights])),e.addParsCode(["varying vec3 vViewPosition;","varying vec3 vWPosition;","varying vec3 vLightFront;","varying vec3 vIndirectFront;","#ifndef DOUBLE_SIDED","   #define DOUBLE_SIDED","#endif","#ifdef DOUBLE_SIDED","\tvarying vec3 vLightBack;","\tvarying vec3 vIndirectBack;","#endif","#include <bsdfs>","#include <lights_pars_begin>","#include <color_pars_vertex>","#include <fog_pars_vertex>","#include <skinning_pars_vertex>","#include <normal_pars_vertex>","#include <morphtarget_pars_vertex>","#include <shadowmap_pars_vertex>","#include <clipping_planes_pars_vertex>"].join("\n"));let i=["#include <beginnormal_vertex>","#include <morphnormal_vertex>","\n\t\t\t\t#include <skinbase_vertex>\n\t\t\t\t#include <skinnormal_vertex>\n\t\t\t\t#ifndef USE_LAYER_DISPLACE\n\t\t\t\t\t#include <defaultnormal_vertex>\n\t\t\t\t#endif\n\n\t\t\t\tvec3 displaced_position = position;\n\t\t\t\tvec3 displaced_normal = objectNormal;\n\n\t\t\t\t#ifdef USE_LAYER_DISPLACE\n\t\t\t\t\tvec3 transformed;\n\t\t\t\t\tvec3 transformedNormal;\n\t\t\t\t#endif\n\t\t\t\t","#include <normal_vertex>","\n\t\t\t\t#ifndef USE_LAYER_DISPLACE\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t#endif\n\t\t\t\t"];n&&i.push(n.code,n.result?"displaced_position = "+n.result+";":""),i.push("transformed = displaced_position;","#include <morphtarget_vertex>","#include <skinning_vertex>","transformedNormal = normalMatrix * displaced_normal;","#ifndef FLAT_SHADED","    vNormal = transformedNormal;","#endif"),i.push("\t#include <project_vertex>","\t#include <clipping_planes_vertex>","\tvViewPosition = - mvPosition.xyz;","\t#include <worldpos_vertex>","\n\t\t\t\t\tvec3 diffuse = vec3( 1.0 );\n\t\t\t\t\tGeometricContext geometry;\n\t\t\t\t\tgeometry.position = mvPosition.xyz;\n\t\t\t\t\tgeometry.normal = normalize( transformedNormal );\n\t\t\t\t\tgeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( -mvPosition.xyz );\n\t\t\t\t"),i.push("\n\t\t\t\t\tGeometricContext backGeometry;\n\t\t\t\t\tbackGeometry.position = geometry.position;\n\t\t\t\t\tbackGeometry.normal = -geometry.normal;\n\t\t\t\t\tbackGeometry.viewDir = geometry.viewDir;\n\t\t\t\t\tvLightFront = vec3( 0.0 );\n\t\t\t\t\tvIndirectFront = vec3( 0.0 );\n\t\t\t\t\t#ifdef DOUBLE_SIDED\n\t\t\t\t\t\tvLightBack = vec3( 0.0 );\n\t\t\t\t\t\tvIndirectBack = vec3( 0.0 );\n\t\t\t\t\t#endif\n\t\t\t\t\tIncidentLight directLight;\n\t\t\t\t\tfloat dotNL;\n\t\t\t\t\tvec3 directLightColor_Diffuse;\n\t\t\t\t\tvIndirectFront += getAmbientLightIrradiance( ambientLightColor );\n\t\t\t\t\tvIndirectFront += getLightProbeIrradiance( lightProbe, geometry.normal );\n\t\t\t\t\t#ifdef DOUBLE_SIDED\n\t\t\t\t\t\tvIndirectBack += getAmbientLightIrradiance( ambientLightColor );\n\t\t\t\t\t\tvIndirectBack += getLightProbeIrradiance( lightProbe, backGeometry.normal );\n\t\t\t\t\t#endif\n\t\t\t\t\t#if NUM_POINT_LIGHTS > 0\n\t\t\t\t\t\t#pragma unroll_loop_start\n\t\t\t\t\t\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\t\t\t\t\t\tgetPointLightInfo( pointLights[ i ], geometry, directLight );\n\t\t\t\t\t\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\t\t\t\t\t\tdirectLightColor_Diffuse = directLight.color;\n\t\t\t\t\t\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t\t\t\t\t\t#ifdef DOUBLE_SIDED\n\t\t\t\t\t\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t\t\t\t\t\t#endif\n\t\t\t\t\t\t}\n\t\t\t\t\t\t#pragma unroll_loop_end\n\t\t\t\t\t#endif\n\t\t\t\t\t#if NUM_SPOT_LIGHTS > 0\n\t\t\t\t\t\t#pragma unroll_loop_start\n\t\t\t\t\t\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\t\t\t\t\t\tgetSpotLightInfo( spotLights[ i ], geometry, directLight );\n\t\t\t\t\t\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\t\t\t\t\t\tdirectLightColor_Diffuse = directLight.color;\n\t\t\t\t\t\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t\t\t\t\t\t#ifdef DOUBLE_SIDED\n\t\t\t\t\t\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t\t\t\t\t\t#endif\n\t\t\t\t\t\t}\n\t\t\t\t\t\t#pragma unroll_loop_end\n\t\t\t\t\t#endif\n\t\t\t\t\t#if NUM_DIR_LIGHTS > 0\n\t\t\t\t\t\t#pragma unroll_loop_start\n\t\t\t\t\t\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\t\t\t\t\t\tgetDirectionalLightInfo( directionalLights[ i ], geometry, directLight );\n\t\t\t\t\t\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\t\t\t\t\t\tdirectLightColor_Diffuse = directLight.color;\n\t\t\t\t\t\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t\t\t\t\t\t#ifdef DOUBLE_SIDED\n\t\t\t\t\t\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t\t\t\t\t\t#endif\n\t\t\t\t\t\t}\n\t\t\t\t\t\t#pragma unroll_loop_end\n\t\t\t\t\t#endif\n\t\t\t\t\t#if NUM_HEMI_LIGHTS > 0\n\t\t\t\t\t\t#pragma unroll_loop_start\n\t\t\t\t\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\t\t\t\t\tvIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );\n\t\t\t\t\t\t\t#ifdef DOUBLE_SIDED\n\t\t\t\t\t\t\t\tvIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry.normal );\n\t\t\t\t\t\t\t#endif\n\t\t\t\t\t\t}\n\t\t\t\t\t\t#pragma unroll_loop_end\n\t\t\t\t\t#endif\n\t\t\t\t","\t#include <shadowmap_vertex>","\t#include <fog_vertex>"),i.push("vWPosition = ( modelMatrix * vec4( transformed, 1.0 ) ).xyz;"),t=i.join("\n")}else{e.mergeUniform({penumbraSize:xT.penumbraSize}),e.mergeUniform({frameIndex:xT.frameIndex}),e.mergeUniform({aoMap:xT.aoRenderTarget}),e.mergeUniform({aoEnabled:xT.aoEnabled}),void 0===this.color&&(this.color=new IM(ab)),this.color.analyze(e,{slot:"color"}),this.shadingAlpha.analyze(e),this.shadingBlend.analyze(e),this.afterColor&&this.afterColor.analyze(e,{slot:"afterColor"}),this.alpha&&this.alpha.analyze(e);let n=this.color.flow(e,"c",{slot:"color"}),i=this.emissive.flow(e,"c",{slot:"emissive"}),r=this.emissiveIntensity.flow(e,"f",{slot:"emissive"}),s=this.occlusion.flow(e,"b",{slot:"occlusion"}),a=this.shadingAlpha.flow(e,"f"),o=this.shadingBlend.flow(e,"i"),l=this.afterColor?this.afterColor.flow(e,"c",{slot:"afterColor"}):void 0,c=this.alpha?this.alpha.flow(e,"f"):void 0,h=this.alphaOverride?this.alphaOverride.flow(e,"f"):void 0;e.requires.transparent=void 0!==c,e.addParsCode(["uniform float penumbraSize[".concat(5,"];"),"uniform sampler2D aoMap;","uniform bool aoEnabled;","varying vec3 vViewPosition;","varying vec3 vWPosition;","varying vec3 vLightFront;","varying vec3 vIndirectFront;","#ifndef DOUBLE_SIDED","   #define DOUBLE_SIDED","#endif","#include <normal_pars_fragment>","#ifdef DOUBLE_SIDED","\tvarying vec3 vLightBack;","\tvarying vec3 vIndirectBack;","#endif","#include <bsdfs>","#include <lights_pars_begin>","#include <fog_pars_fragment>","#include <shadowmap_pars_fragment>","#include <shadowmask_pars_fragment>","#include <clipping_planes_pars_fragment>","#include <dithering_pars_fragment>"].join("\n"));let u=["#include <normal_fragment_begin>","\n\t\t\t\t// NOTE: gl_FrontFacing alternative using face normal estimation.\n\t\t\t\tvec3 viewdx = dFdx(vViewPosition);\n\t\t\t\tvec3 viewdy = dFdy(vViewPosition);\n\t\t\t\tvec3 faceNormal = normalize(cross(viewdx, viewdy));\n\t\t\t\tbool isFrontFacing = (dot(normal, faceNormal) >= 0.0);\n\t\t\t\t","#include <clipping_planes_fragment>"];u.push(n.code,"vec3 diffuseColor = "+n.result+";","ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );"),c&&u.push(c.code,"#ifdef ALPHATEST","if ( "+c.result+" <= ALPHATEST ) discard;","#endif"),u.push("#ifdef DOUBLE_SIDED","\treflectedLight.indirectDiffuse += ( isFrontFacing ) ? vIndirectFront : vIndirectBack;","#else","\treflectedLight.indirectDiffuse += vIndirectFront;","#endif","#include <lightmap_fragment>","reflectedLight.indirectDiffuse *= BRDF_Lambert( diffuseColor.rgb );","#ifdef DOUBLE_SIDED","\treflectedLight.directDiffuse = ( isFrontFacing ) ? vLightFront : vLightBack;","#else","\treflectedLight.directDiffuse = vLightFront;","#endif","reflectedLight.directDiffuse *= BRDF_Lambert( diffuseColor.rgb ) * getShadowMask();"),i&&u.push(i.code,"reflectedLight.directDiffuse += "+i.result+" * "+r.result+";"),u.push("vec3 ao = aoEnabled && "+s.result+" ? tex2D(aoMap, gl_FragCoord.xy / resolution).rgb : vec3(1.0);","vec3 outgoingLight = (reflectedLight.directDiffuse + reflectedLight.indirectDiffuse) ;");let d="1.0";this.mask&&(this.mask.analyze(e),d="luminance(".concat(this.mask.flow(e,"v3").result,")")),u.push("\n\t\t\t\tif (outgoingLight != diffuseColor) {\n\t\t\t\t\tfloat lightAccu = clamp( length( reflectedLight.directSpecular + reflectedLight.indirectSpecular ), 0.0, 1.0 );\n\t\t\t\t\taccumAlpha += ( 1.0 - accumAlpha ) * ".concat(a.result," * ").concat(d," * lightAccu;\n\t\t\t\t\toutgoingLight = spe_blend( diffuseColor, outgoingLight, ").concat(a.result," * ").concat(d,", ").concat(o.result," );\n\n\t\t\t\t\toutgoingLight *= ao;\n\t\t\t\t}\n\t\t\t\t")),l&&u.push(l.code,"outgoingLight = spe_blend(outgoingLight, ".concat(l.result,", 1.0, SPE_BLENDING_NORMAL);")),c?u.push("gl_FragColor = vec4( outgoingLight, accumAlpha * ".concat(c.result," );")):u.push("gl_FragColor = vec4( outgoingLight, 1.0 );"),h&&u.push("gl_FragColor.a *= ".concat(h.result,";")),u.push("#include <encodings_fragment>","#include <fog_fragment>","#include <dithering_fragment>"),t=u.join("\n")}return t}},AT={dHdxy:new $C("vec2 dHdxy(sampler2D bumpMap, vec2 bumpMapUv, float bumpScale) {\n\n            // Gradient of UVs w.r.t. X coordinate (in screen-space)\n            vec2 dSTdx = dFdx(bumpMapUv);\n\n            // Gradient of UVs w.r.t. Y coordinate (in screen-space)\n            vec2 dSTdy = dFdy(bumpMapUv);\n            \n            // Forward differencing\n            float Hll = bumpScale * luminance(texture(bumpMap, bumpMapUv).rgb);\n            float dBx = bumpScale * luminance(texture(bumpMap, bumpMapUv + dSTdx).rgb) - Hll;\n            float dBy = bumpScale * luminance(texture(bumpMap, bumpMapUv + dSTdy).rgb) - Hll;\n            \n            return vec2( dBx, dBy );\n        }"),perturbNormalArb:new $C("vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {\n            vec3 vSigmaX = dFdx( surf_pos.xyz );\n            vec3 vSigmaY = dFdy( surf_pos.xyz );\n            vec3 vN = surf_norm; // normalized\n            \n            vN = normalize(vN);\n\n            vec3 R1 = cross( vSigmaY, vN );\n            vec3 R2 = cross( vN, vSigmaX );\n\n            R1 = normalize(R1);\n            R2 = normalize(R2);\n    \n            float fDet = dot( vSigmaX, R1 ) * faceDirection;\n    \n            vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n            return normalize( abs( fDet ) * vN - vGrad );\n        }")},CT=class extends VC{constructor(){super("phong"),this.nodeType="Phong",this.color=new IM(ab),this.specular=new IM(1118481),this.shininess=new uM(30),this.previousModelViewMatrix=new UM,this.previouseProjectionMatrix=new UM,this.shadingAlpha=new uM(1),this.shadingBlend=new RM(0),this.occlusion=new kM(!0)}get category(){return"phong"}build(e){let t;if(e.define("PHONG"),e.requires.lights=!0,e.extensions.derivatives=!0,e.isShader("vertex")){let n=this.position?this.position.analyzeAndFlow(e,"v3",{cache:"position"}):void 0;e.mergeUniform({frameIndex:xT.frameIndex}),e.mergeUniform({resolution:xT.resolution}),e.mergeUniform({previousModelViewMatrix:this.previousModelViewMatrix}),e.mergeUniform({previousProjectionMatrix:this.previouseProjectionMatrix}),e.mergeUniform(Ii.merge([Zi.fog,Zi.lights])),e.addParsCode(["varying vec3 vViewPosition;","varying vec3 vWPosition;","#include <fog_pars_vertex>","#include <skinning_pars_vertex>","#include <normal_pars_vertex>","#include <morphtarget_pars_vertex>","#include <shadowmap_pars_vertex>","#include <clipping_planes_pars_vertex>"].join("\n"));let i=["#include <beginnormal_vertex>","#include <morphnormal_vertex>","\n\t\t\t\t#include <skinbase_vertex>\n\t\t\t\t#include <skinnormal_vertex>\n\t\t\t\t#ifndef USE_LAYER_DISPLACE\n\t\t\t\t\t#include <defaultnormal_vertex>\n\t\t\t\t#endif\n\n\t\t\t\tvec3 displaced_position = position;\n\t\t\t\tvec3 displaced_normal = objectNormal;\n\n\t\t\t\t#ifdef USE_LAYER_DISPLACE\n\t\t\t\t\tvec3 transformed;\n\t\t\t\t\tvec3 transformedNormal;\n\t\t\t\t#endif\n\t\t\t\t","#include <normal_vertex>","\n\t\t\t\t#ifndef USE_LAYER_DISPLACE\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t#endif\n\t\t\t\t"];n&&i.push(n.code,n.result?"displaced_position = "+n.result+";":""),i.push("transformed = displaced_position;","#include <morphtarget_vertex>","#include <skinning_vertex>","transformedNormal = normalMatrix * displaced_normal;","#ifndef FLAT_SHADED","    vNormal = transformedNormal;","#endif"),i.push("\t#include <project_vertex>","\t#include <clipping_planes_vertex>","\tvViewPosition = - mvPosition.xyz;","\t#include <worldpos_vertex>","\t#include <shadowmap_vertex>","\t#include <fog_vertex>"),i.push("vWPosition = ( modelMatrix * vec4( transformed, 1.0 ) ).xyz;"),t=i.join("\n")}else{e.mergeUniform({penumbraSize:xT.penumbraSize}),e.mergeUniform({frameIndex:xT.frameIndex}),e.mergeUniform({aoMap:xT.aoRenderTarget}),e.mergeUniform({aoEnabled:xT.aoEnabled}),void 0===this.color&&(this.color=new IM(ab)),this.color.analyze(e,{slot:"color"}),this.specular.analyze(e),this.shininess.analyze(e);let n=this.occlusion.flow(e,"b",{slot:"occlusion"});this.shadingAlpha.analyze(e),this.shadingBlend.analyze(e),this.afterColor&&this.afterColor.analyze(e,{slot:"afterColor"}),this.alpha&&this.alpha.analyze(e);let i=this.color.flow(e,"c",{slot:"color"}),r=this.specular.flow(e,"c"),s=this.shininess.flow(e,"f"),a=this.shadingAlpha.flow(e,"f"),o=this.shadingBlend.flow(e,"i"),l=this.afterColor?this.afterColor.flow(e,"c",{slot:"afterColor"}):void 0,c=this.alpha?this.alpha.flow(e,"f"):void 0,h=this.alphaOverride?this.alphaOverride.flow(e,"f"):void 0;e.requires.transparent=void 0!==c,e.addParsCode(["varying vec3 vWPosition;","uniform vec3 emissive;","uniform float penumbraSize[".concat(5,"];"),"uniform sampler2D aoMap;","uniform bool aoEnabled;","#include <normal_pars_fragment>","#include <fog_pars_fragment>","#include <bsdfs>","#include <lights_pars_begin>","#include <lights_phong_pars_fragment>","#include <shadowmap_pars_fragment>","#include <dithering_pars_fragment>"].join("\n"));let u=["#include <normal_fragment_begin>","\n\t\t\t\t// NOTE: gl_FrontFacing alternative using face normal estimation.\n\t\t\t\tvec3 viewdx = dFdx(vViewPosition);\n\t\t\t\tvec3 viewdy = dFdy(vViewPosition);\n\t\t\t\tvec3 faceNormal = normalize(cross(viewdx,viewdy));\n\t\t\t\tif (dot(normal, faceNormal) < 0.0) {\n\t\t\t\t\tnormal *= -1.0;\n\t\t\t\t}\n\t\t\t\t","\tBlinnPhongMaterial material;"];if(this.bumpMap){e.include(AT.dHdxy),e.include(AT.perturbNormalArb);let t=this.bumpMap.texture.flow(e,"t"),n=this.bumpMap.flow(e,"v3"),i=this.bumpMapIntensity?this.bumpMapIntensity.flow(e,"f").result:"1.0",r="";r=4===this.bumpMap.projection.value?"\n\t\t\t\t\tvec3 bumpNormal = vec3(0.0);\n\t\t\t\t\t{\n\t\t\t\t\t\tvec2 uv0 = g".concat(this.bumpMap.uuid.toString().replace(/-/g,""),"_writeUvs0;\n\t\t\t\t\t\tvec2 uv1 = g").concat(this.bumpMap.uuid.toString().replace(/-/g,""),"_writeUvs1;\n\t\t\t\t\t\tvec2 uv2 = g").concat(this.bumpMap.uuid.toString().replace(/-/g,""),"_writeUvs2;\n\t\t\t\t\t\tvec3 weights = g").concat(this.bumpMap.uuid.toString().replace(/-/g,""),"_triplanarWeights;\n\n\t\t\t\t\t\tvec2 grad0 = dHdxy(").concat(t.result,", uv0, ").concat(i,");\n\t\t\t\t\t\tvec3 n0 = perturbNormalArb(-vViewPosition, normal, grad0, faceDirection);\n\n\t\t\t\t\t\tvec2 grad1 = dHdxy(").concat(t.result,", uv1, ").concat(i,");\n\t\t\t\t\t\tvec3 n1 = perturbNormalArb(-vViewPosition, normal, grad1, faceDirection);\n\n\t\t\t\t\t\tvec2 grad2 = dHdxy(").concat(t.result,", uv2, ").concat(i,");\n\t\t\t\t\t\tvec3 n2 = perturbNormalArb(-vViewPosition, normal, grad2, faceDirection);\n\t\t\t\t\t\t\n\t\t\t\t\t\tbumpNormal = n0 * weights.z + n1 * weights.x + n2 * weights.y;\n\t\t\t\t\t\tbumpNormal = normalize(bumpNormal);\n\t\t\t\t\t}\n\n\t\t\t\t\tnormal = bumpNormal;\n\t\t\t\t\t"):"\n\t\t\t\t\tvec2 bumpMapCachedUv = g".concat(this.bumpMap.uuid.toString().replace(/-/g,""),"_writeUvs;\n\t\t\t\t\tvec2 grad = dHdxy(").concat(t.result,", bumpMapCachedUv, ").concat(i,");\n\t\t\t\t\tnormal = perturbNormalArb( - vViewPosition, normal, grad, faceDirection );\n\t\t\t\t\t"),u.push("// Call the Texture Layer's function once here so that it writes out its procedural UV coordinates\n\t\t\t\t\t".concat(n.result,";\n\t\t\t\t\t").concat(r,"\n\t\t\t\t\t"))}u.push(i.code,"\tvec3 diffuseColor = "+i.result+";","\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );","\tvec3 totalEmissiveRadiance = emissive;",r.code,"\tvec3 specular = "+r.result+";",s.code,"\tfloat shininess = max( 0.0001, "+s.result+" );","\tfloat specularStrength = 1.0;"),c&&u.push(c.code,"#ifdef ALPHATEST","if ( "+c.result+" <= ALPHATEST ) discard;","#endif"),u.push("material.diffuseColor = diffuseColor;"),u.push("material.specularColor = specular;","material.specularShininess = shininess;","material.specularStrength = specularStrength;","#include <lights_fragment_begin>","#include <lights_fragment_end>"),u.push("vec3 ao = aoEnabled && "+n.result+" ? tex2D(aoMap, gl_FragCoord.xy / resolution).rgb : vec3(1.0);","vec3 outgoingLight = ((reflectedLight.directDiffuse + reflectedLight.indirectDiffuse)) + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;");let d="1.0";this.mask&&(this.mask.analyze(e),d="luminance(".concat(this.mask.flow(e,"v3").result,")")),u.push("\n\t\t\t\tif (outgoingLight != diffuseColor) {\n\t\t\t\t\tfloat lightAccu = clamp( length( reflectedLight.directSpecular + reflectedLight.indirectSpecular ), 0.0, 1.0 );\n\t\t\t\t\taccumAlpha += ( 1.0 - accumAlpha ) * ".concat(a.result," * ").concat(d," * lightAccu;\n\t\t\t\t\toutgoingLight = spe_blend( diffuseColor, outgoingLight, ").concat(a.result," * ").concat(d,", ").concat(o.result," );\n\t\t\t\t\t\n\t\t\t\t\toutgoingLight *= ao;\n\t\t\t\t}\n\t\t\t\t")),l&&u.push(l.code,"outgoingLight = spe_blend(outgoingLight, ".concat(l.result,", 1.0, SPE_BLENDING_NORMAL);")),c?u.push("gl_FragColor = vec4( outgoingLight, accumAlpha * ".concat(c.result,");")):u.push("gl_FragColor = vec4( outgoingLight, 1.0 );"),h&&u.push("gl_FragColor.a *= ".concat(h.result,";")),u.push("#include <encodings_fragment>","#include <fog_fragment>","#include <dithering_fragment>"),t=u.join("\n")}return t}},MT=class extends VC{constructor(){super("standard"),this.nodeType="Standard",this.color=new IM(ab),this.roughness=new uM(.3),this.metalness=new uM(0),this.reflectivity=new uM(.5),this.previousModelViewMatrix=new UM,this.previouseProjectionMatrix=new UM,this.shadingAlpha=new uM(1),this.shadingBlend=new RM(0),this.occlusion=new kM(!0)}get category(){return"physical"}build(e){let t;if(e.define("STANDARD"),e.requires.lights=!0,e.extensions.derivatives=!0,e.extensions.shaderTextureLOD=!0,e.isShader("vertex")){let n=this.position?this.position.analyzeAndFlow(e,"v3",{cache:"position"}):void 0;e.mergeUniform({frameIndex:xT.frameIndex}),e.mergeUniform({resolution:xT.resolution}),e.mergeUniform({previousModelViewMatrix:this.previousModelViewMatrix}),e.mergeUniform({previousProjectionMatrix:this.previouseProjectionMatrix}),e.mergeUniform(Ii.merge([Zi.fog,Zi.lights])),Zi.LTC_1&&(e.uniforms.ltc_1={value:void 0},e.uniforms.ltc_2={value:void 0}),e.addParsCode(["varying vec3 vViewPosition;","varying vec3 vWPosition;","#include <fog_pars_vertex>","#include <skinning_pars_vertex>","#include <normal_pars_vertex>","#include <morphtarget_pars_vertex>","#include <shadowmap_pars_vertex>","#include <clipping_planes_pars_vertex>"].join("\n"));let i=["#include <beginnormal_vertex>","#include <morphnormal_vertex>","\n\t\t\t\t#include <skinbase_vertex>\n\t\t\t\t#include <skinnormal_vertex>\n\t\t\t\t#if !defined( USE_LAYER_DISPLACE )\n\t\t\t\t\t#include <defaultnormal_vertex>\n\t\t\t\t#endif\n\n\t\t\t\tvec3 displaced_position = position;\n\t\t\t\tvec3 displaced_normal = objectNormal;\n\n\t\t\t\t#if defined( USE_LAYER_DISPLACE )\n\t\t\t\t\tvec3 transformed;\n\t\t\t\t\tvec3 transformedNormal;\n\t\t\t\t#endif\n\t\t\t\t","#include <normal_vertex>","\n\t\t\t\t#if !defined( USE_LAYER_DISPLACE )\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t#endif /* !USE_LAYER_DISPLACE */\n\t\t\t\t"];n&&i.push(n.code,n.result?"displaced_position = "+n.result+";":""),i.push("transformed = displaced_position;","#include <morphtarget_vertex>","#include <skinning_vertex>","transformedNormal = normalMatrix * displaced_normal;","#ifndef FLAT_SHADED","    vNormal = transformedNormal;","#endif"),i.push("#include <project_vertex>","#include <fog_vertex>","#include <clipping_planes_vertex>","\tvViewPosition = - mvPosition.xyz;","#include <worldpos_vertex>","#include <shadowmap_vertex>"),i.push("vWPosition = ( modelMatrix * vec4( transformed, 1.0 ) ).xyz;"),t=i.join("\n")}else{e.mergeUniform({penumbraSize:xT.penumbraSize}),e.mergeUniform({frameIndex:xT.frameIndex}),e.mergeUniform({aoMap:xT.aoRenderTarget}),e.mergeUniform({aoEnabled:xT.aoEnabled});let n={gamma:!0};void 0===this.color&&(this.color=new IM(ab)),this.color.analyze(e,{slot:"color",context:n}),this.roughness.analyze(e),this.metalness.analyze(e);let i=this.occlusion.flow(e,"b",{slot:"occlusion"});this.shadingAlpha.analyze(e),this.shadingBlend.analyze(e),this.afterColor&&this.afterColor.analyze(e,{slot:"afterColor"}),this.alpha&&this.alpha.analyze(e),this.reflectivity&&this.reflectivity.analyze(e);let r=this.color.flow(e,"c",{slot:"color",context:n}),s=this.roughness.flow(e,"f"),a=this.metalness.flow(e,"f"),o=this.shadingAlpha.flow(e,"f"),l=this.shadingBlend.flow(e,"i"),c=this.afterColor?this.afterColor.flow(e,"c",{slot:"afterColor"}):void 0,h=this.alpha?this.alpha.flow(e,"f"):void 0,u=this.alphaOverride?this.alphaOverride.flow(e,"f"):void 0,d=this.reflectivity?this.reflectivity.flow(e,"f"):void 0;e.requires.transparent=void 0!==h,e.addParsCode(["varying vec3 vViewPosition;","varying vec3 vWPosition;","uniform float penumbraSize[".concat(5,"];"),"uniform sampler2D aoMap;","uniform bool aoEnabled;","#include <normal_pars_fragment>","#include <dithering_pars_fragment>","#include <fog_pars_fragment>","#include <bsdfs>","#include <lights_pars_begin>","#include <lights_physical_pars_fragment>","#include <shadowmap_pars_fragment>"].join("\n"));let p=["#include <clipping_planes_fragment>","\t#include <normal_fragment_begin>","\n\t\t\t\t// NOTE: gl_FrontFacing alternative using face normal estimation.\n\t\t\t\tvec3 viewdx = dFdx(vViewPosition);\n\t\t\t\tvec3 viewdy = dFdy(vViewPosition);\n\t\t\t\tvec3 faceNormal = normalize(cross(viewdx,viewdy));\n\t\t\t\tif (dot(normal, faceNormal) < 0.0) {\n\t\t\t\t\tnormal *= -1.0;\n\t\t\t\t}\n\t\t\t\t","\tPhysicalMaterial material;","\tmaterial.diffuseColor = vec3( 1.0 );"];if(this.bumpMap){e.include(AT.dHdxy),e.include(AT.perturbNormalArb);let t=this.bumpMap.texture.flow(e,"t"),n=this.bumpMap.flow(e,"v3"),i=this.bumpMapIntensity?this.bumpMapIntensity.flow(e,"f").result:"1.0",r="";r=4===this.bumpMap.projection.value?"\n\t\t\t\t\tvec3 bumpNormal = vec3(0.0);\n\t\t\t\t\t{\n\t\t\t\t\t\tvec2 uv0 = g".concat(this.bumpMap.uuid.toString().replace(/-/g,""),"_writeUvs0;\n\t\t\t\t\t\tvec2 uv1 = g").concat(this.bumpMap.uuid.toString().replace(/-/g,""),"_writeUvs1;\n\t\t\t\t\t\tvec2 uv2 = g").concat(this.bumpMap.uuid.toString().replace(/-/g,""),"_writeUvs2;\n\t\t\t\t\t\tvec3 weights = g").concat(this.bumpMap.uuid.toString().replace(/-/g,""),"_triplanarWeights;\n\n\t\t\t\t\t\tvec2 grad0 = dHdxy(").concat(t.result,", uv0, ").concat(i,");\n\t\t\t\t\t\tvec3 n0 = perturbNormalArb(-vViewPosition, normal, grad0, faceDirection);\n\n\t\t\t\t\t\tvec2 grad1 = dHdxy(").concat(t.result,", uv1, ").concat(i,");\n\t\t\t\t\t\tvec3 n1 = perturbNormalArb(-vViewPosition, normal, grad1, faceDirection);\n\n\t\t\t\t\t\tvec2 grad2 = dHdxy(").concat(t.result,", uv2, ").concat(i,");\n\t\t\t\t\t\tvec3 n2 = perturbNormalArb(-vViewPosition, normal, grad2, faceDirection);\n\t\t\t\t\t\t\n\t\t\t\t\t\tbumpNormal = n0 * weights.z + n1 * weights.x + n2 * weights.y;\n\t\t\t\t\t\tbumpNormal = normalize(bumpNormal);\n\t\t\t\t\t}\n\n\t\t\t\t\tnormal = bumpNormal;\n\t\t\t\t\t"):"\n\t\t\t\t\tvec2 bumpMapCachedUv = g".concat(this.bumpMap.uuid.toString().replace(/-/g,""),"_writeUvs;\n\t\t\t\t\tvec2 grad = dHdxy(").concat(t.result,", bumpMapCachedUv, ").concat(i,");\n\t\t\t\t\tnormal = perturbNormalArb( - vViewPosition, normal, grad, faceDirection );\n\t\t\t\t\t"),p.push("// Call the Texture Layer's function once here so that it writes out its procedural UV coordinates\n\t\t\t\t\t".concat(n.result,";\n\t\t\t\t\t").concat(r,"\n\t\t\t\t\t"))}if(p.push(r.code,"\tvec3 diffuseColor = "+r.result+";","\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );",a.code,"\tfloat metalnessFactor = "+a.result+";"),this.roughnessMap){let t=this.roughnessMap.texture.flow(e,"t"),n=this.roughnessMap.flow(e,"v3"),i="";i=4===this.roughnessMap.projection.value?"\n\t\t\t\t\tfloat roughnessChange = 1.0;\n\t\t\t\t\t{\n\t\t\t\t\t\tvec2 uv0 = g".concat(this.roughnessMap.uuid.toString().replace(/-/g,""),"_writeUvs0;\n\t\t\t\t\t\tvec2 uv1 = g").concat(this.roughnessMap.uuid.toString().replace(/-/g,""),"_writeUvs1;\n\t\t\t\t\t\tvec2 uv2 = g").concat(this.roughnessMap.uuid.toString().replace(/-/g,""),"_writeUvs2;\n\t\t\t\t\t\tvec3 weights = g").concat(this.roughnessMap.uuid.toString().replace(/-/g,""),"_triplanarWeights;\n\n\t\t\t\t\t\tfloat r0 = luminance(texture(").concat(t.result,", uv0).rgb) * roughnessScale;\n\t\t\t\t\t\tfloat r1 = luminance(texture(").concat(t.result,", uv1).rgb) * roughnessScale;\n\t\t\t\t\t\tfloat r2 = luminance(texture(").concat(t.result,", uv2).rgb) * roughnessScale;\n\n\t\t\t\t\t\troughnessChange = (r0 * weights.z + r1 * weights.x + r2 * weights.y);\n\t\t\t\t\t}\n\t\t\t\t\tfloat roughnessFactor = roughnessChange * ").concat(s.result,";\n\t\t\t\t\t"):"\n\t\t\t\t\tvec2 roughnessMapCachedUv = g".concat(this.roughnessMap.uuid.toString().replace(/-/g,""),"_writeUvs;\n\n\t\t\t\t\tvec4 vals = texture(").concat(t.result,",  roughnessMapCachedUv);\n\t\t\t\t\tfloat roughnessFactor = luminance(vals.rgb) * ").concat(s.result,";\n\t\t\t\t\t"),p.push("// Call the Texture Layer's function once here so that it writes out its procedural UV coordinates\n\t\t\t\t\t".concat(n.result,";\n\n\t\t\t\t\tconst float roughnessScale = 1.0;\n\n\t\t\t\t\t").concat(i,"\n\t\t\t\t"))}else p.push(s.code,"\tfloat roughnessFactor = "+s.result+";");h&&p.push(h.code,"#ifdef ALPHATEST","\tif ( "+h.result+" <= ALPHATEST ) discard;","#endif"),p.push("vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );","float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );"),p.push("material.diffuseColor = diffuseColor * ( 1.0 - metalnessFactor );","material.roughness = max( roughnessFactor, 0.0525 );","material.roughness += geometryRoughness;","material.roughness = min( material.roughness, 1.0 );","material.roughness = clamp( roughnessFactor, 0.04, 1.0 );"),d?p.push(d.code,"material.specularColor = mix( vec3( 0.16 * pow2( "+d.result+" ) ), diffuseColor, metalnessFactor );"):p.push("material.specularColor = mix( vec3( 0.04 ), diffuseColor, metalnessFactor );"),p.push("#include <lights_fragment_begin>"),p.push("#include <lights_fragment_end>"),p.push("vec3 ao = aoEnabled && "+i.result+" ? tex2D(aoMap, gl_FragCoord.xy / resolution).rgb : vec3(1.0);","vec3 outgoingLight = ((reflectedLight.directDiffuse + reflectedLight.indirectDiffuse)) + reflectedLight.directSpecular + reflectedLight.indirectSpecular;");let f="1.0";this.mask&&(this.mask.analyze(e),f="luminance(".concat(this.mask.flow(e,"v3").result,")")),p.push("\n\t\t\t\tif (outgoingLight != diffuseColor) {\n\t\t\t\t\tfloat lightAccu = clamp( length( reflectedLight.directSpecular + reflectedLight.indirectSpecular ), 0.0, 1.0 );\n\t\t\t\t\taccumAlpha += ( 1.0 - accumAlpha ) * ".concat(o.result," * ").concat(f," * lightAccu;\n\t\t\t\t\toutgoingLight = spe_blend( diffuseColor, outgoingLight, ").concat(o.result," * ").concat(f,", ").concat(l.result," );\n\t\t\t\t\t\n\t\t\t\t\toutgoingLight *= ao;\n\t\t\t\t}\n\t\t\t\t")),c&&p.push(c.code,"outgoingLight = spe_blend(outgoingLight, ".concat(c.result,", 1.0, SPE_BLENDING_NORMAL);")),h?p.push("gl_FragColor = vec4( outgoingLight, accumAlpha * ".concat(h.result," );")):p.push("gl_FragColor = vec4( outgoingLight, 1.0 );"),u&&p.push("gl_FragColor.a *= ".concat(u.result,";")),p.push("#include <encodings_fragment>","#include <fog_fragment>","#include <dithering_fragment>"),t=p.join("\n")}return t}},TT=class extends VC{constructor(){super("toon"),this.nodeType="Toon",this.color=new IM(ab),this.specular=new IM(1118481),this.shininess=new uM(30),this.previousModelViewMatrix=new UM,this.previouseProjectionMatrix=new UM,this.shadingAlpha=new uM(1),this.shadingBlend=new RM(0)}get category(){return"toon"}build(e){let t;if(e.define("TOON"),e.requires.lights=!0,e.extensions.derivatives=!0,e.isShader("vertex")){let n=this.position?this.position.analyzeAndFlow(e,"v3",{cache:"position"}):void 0;e.mergeUniform({frameIndex:xT.frameIndex}),e.mergeUniform({resolution:xT.resolution}),e.mergeUniform({previousModelViewMatrix:this.previousModelViewMatrix}),e.mergeUniform({previousProjectionMatrix:this.previouseProjectionMatrix}),e.mergeUniform(Ii.merge([Zi.fog,Zi.lights])),e.addParsCode(["varying vec3 vViewPosition;","varying vec3 vWPosition;","#include <fog_pars_vertex>","#include <skinning_pars_vertex>","#include <normal_pars_vertex>","#include <morphtarget_pars_vertex>","#include <shadowmap_pars_vertex>","#include <clipping_planes_pars_vertex>"].join("\n"));let i=["#include <beginnormal_vertex>","#include <morphnormal_vertex>","\n\t\t\t\t#include <skinbase_vertex>\n\t\t\t\t#include <skinnormal_vertex>\n\t\t\t\t#ifndef USE_LAYER_DISPLACE\n\t\t\t\t\t#include <defaultnormal_vertex>\n\t\t\t\t#endif\n\n\t\t\t\tvec3 displaced_position = position;\n\t\t\t\tvec3 displaced_normal = objectNormal;\n\n\t\t\t\t#ifdef USE_LAYER_DISPLACE\n\t\t\t\t\tvec3 transformed;\n\t\t\t\t\tvec3 transformedNormal;\n\t\t\t\t#endif\n\t\t\t\t","#include <normal_vertex>","\n\t\t\t\t#ifndef USE_LAYER_DISPLACE\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t#endif\n\t\t\t\t"];n&&i.push(n.code,n.result?"displaced_position = "+n.result+";":""),i.push("transformed = displaced_position;","#include <morphtarget_vertex>","#include <skinning_vertex>","transformedNormal = normalMatrix * displaced_normal;","#ifndef FLAT_SHADED","    vNormal = transformedNormal;","#endif"),i.push("\t#include <project_vertex>","\t#include <fog_vertex>","\t#include <clipping_planes_vertex>","\tvViewPosition = - mvPosition.xyz;","\t#include <worldpos_vertex>","\t#include <shadowmap_vertex>","\t#include <fog_vertex>"),i.push("vWPosition = ( modelMatrix * vec4( transformed, 1.0 ) ).xyz;"),t=i.join("\n")}else{e.mergeUniform({penumbraSize:xT.penumbraSize}),e.mergeUniform({frameIndex:xT.frameIndex}),e.mergeUniform({aoMap:xT.aoRenderTarget}),e.mergeUniform({aoEnabled:xT.aoEnabled}),void 0===this.color&&(this.color=new IM(ab)),this.color.analyze(e,{slot:"color"}),this.specular.analyze(e),this.shininess.analyze(e),this.shadingAlpha.analyze(e),this.shadingBlend.analyze(e),this.afterColor&&this.afterColor.analyze(e,{slot:"afterColor"}),this.alpha&&this.alpha.analyze(e);let n=this.color.flow(e,"c",{slot:"color"}),i=this.specular.flow(e,"c"),r=this.shininess.flow(e,"f"),s=this.shadingAlpha.flow(e,"f"),a=this.shadingBlend.flow(e,"i"),o=this.afterColor?this.afterColor.flow(e,"c",{slot:"afterColor"}):void 0,l=this.alpha?this.alpha.flow(e,"f"):void 0,c=this.alphaOverride?this.alphaOverride.flow(e,"f"):void 0;e.requires.transparent=void 0!==l,e.addParsCode(["uniform float penumbraSize[".concat(5,"];"),"uniform sampler2D aoMap;","uniform bool aoEnabled;","varying vec3 vWPosition;","#include <normal_pars_fragment>","#include <gradientmap_pars_fragment>","#include <fog_pars_fragment>","#include <bsdfs>","#include <lights_pars_begin>","#include <dithering_pars_fragment>","\n\t\t\t\t\tvarying vec3 vViewPosition;\n\t\t\t\t\tstruct ToonMaterial {\n\t\t\t\t\t\tvec3\tdiffuseColor;\n\t\t\t\t\t\tvec3\tspecularColor;\n\t\t\t\t\t\tfloat\tspecularShininess;\n\t\t\t\t\t\tfloat\tspecularStrength;\n\t\t\t\t\t};\n\t\t\t\t\tvoid RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\t\t\t\t\t\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\t\t\t\n\t\t\t\t\t\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n\t\t\t\t\t\treflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;\n\t\t\t\t\t}\n\t\t\t\t\tvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\t\t\t\t\t\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n\t\t\t\t\t}\n\t\t\t\t\t#define RE_Direct\t\t\t\tRE_Direct_Toon\n\t\t\t\t\t#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon\n\t\t\t\t\t#define Material_LightProbeLOD( material )\t(0)\n\t\t\t\t\t","#include <shadowmap_pars_fragment>","#include <bumpmap_pars_fragment>","#include <normalmap_pars_fragment>"].join("\n"));let h=["#include <normal_fragment_begin>","\n\t\t\t\t// NOTE: gl_FrontFacing alternative using face normal estimation.\n\t\t\t\tvec3 viewdx = dFdx(vViewPosition);\n\t\t\t\tvec3 viewdy = dFdy(vViewPosition);\n\t\t\t\tvec3 faceNormal = normalize(cross(viewdx,viewdy));\n\t\t\t\tif (dot(normal, faceNormal) < 0.0) {\n\t\t\t\t\tnormal *= -1.0;\n\t\t\t\t}\n\t\t\t\t","\tToonMaterial material;"];if(this.bumpMap){e.include(AT.dHdxy),e.include(AT.perturbNormalArb);let t=this.bumpMap.texture.flow(e,"t"),n=this.bumpMap.flow(e,"v3"),i=this.bumpMapIntensity?this.bumpMapIntensity.flow(e,"f").result:"1.0",r="";r=4===this.bumpMap.projection.value?"\n\t\t\t\t\tvec3 bumpNormal = vec3(0.0);\n\t\t\t\t\t{\n\t\t\t\t\t\tvec2 uv0 = g".concat(this.bumpMap.uuid.toString().replace(/-/g,""),"_writeUvs0;\n\t\t\t\t\t\tvec2 uv1 = g").concat(this.bumpMap.uuid.toString().replace(/-/g,""),"_writeUvs1;\n\t\t\t\t\t\tvec2 uv2 = g").concat(this.bumpMap.uuid.toString().replace(/-/g,""),"_writeUvs2;\n\t\t\t\t\t\tvec3 weights = g").concat(this.bumpMap.uuid.toString().replace(/-/g,""),"_triplanarWeights;\n\n\t\t\t\t\t\tvec2 grad0 = dHdxy(").concat(t.result,", uv0, ").concat(i,");\n\t\t\t\t\t\tvec3 n0 = perturbNormalArb(-vViewPosition, normal, grad0, faceDirection);\n\n\t\t\t\t\t\tvec2 grad1 = dHdxy(").concat(t.result,", uv1, ").concat(i,");\n\t\t\t\t\t\tvec3 n1 = perturbNormalArb(-vViewPosition, normal, grad1, faceDirection);\n\n\t\t\t\t\t\tvec2 grad2 = dHdxy(").concat(t.result,", uv2, ").concat(i,");\n\t\t\t\t\t\tvec3 n2 = perturbNormalArb(-vViewPosition, normal, grad2, faceDirection);\n\t\t\t\t\t\t\n\t\t\t\t\t\tbumpNormal = n0 * weights.z + n1 * weights.x + n2 * weights.y;\n\t\t\t\t\t\tbumpNormal = normalize(bumpNormal);\n\t\t\t\t\t}\n\n\t\t\t\t\tnormal = bumpNormal;\n\t\t\t\t\t"):"\n\t\t\t\t\tvec2 bumpMapCachedUv = g".concat(this.bumpMap.uuid.toString().replace(/-/g,""),"_writeUvs;\n\t\t\t\t\tvec2 grad = dHdxy(").concat(t.result,", bumpMapCachedUv, ").concat(i,");\n\t\t\t\t\tnormal = perturbNormalArb( - vViewPosition, normal, grad, faceDirection );\n\t\t\t\t\t"),h.push("// Call the Texture Layer's function once here so that it writes out its procedural UV coordinates\n\t\t\t\t\t".concat(n.result,";\n\t\t\t\t\t").concat(r,"\n\t\t\t\t\t"))}h.push(n.code,"\tvec3 diffuseColor = "+n.result+";","\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );",i.code,"\tvec3 specular = "+i.result+";",r.code,"\tfloat shininess = max( 0.0001, "+r.result+" );","\tfloat specularStrength = 1.0;"),l&&h.push(l.code,"#ifdef ALPHATEST","if ( "+l.result+" <= ALPHATEST ) discard;","#endif"),h.push("material.diffuseColor = diffuseColor;"),h.push("material.specularColor = specular;","material.specularShininess = shininess;","material.specularStrength = specularStrength;","#include <lights_fragment_begin>","#include <lights_fragment_end>"),h.push("vec3 ao = aoEnabled ? tex2D(aoMap, gl_FragCoord.xy / resolution).rgb : vec3(1.0);","vec3 outgoingLight = ((reflectedLight.directDiffuse + reflectedLight.indirectDiffuse) * ao) + reflectedLight.directSpecular;");let u="1.0";this.mask&&(this.mask.analyze(e),u="luminance(".concat(this.mask.flow(e,"v3").result,")")),h.push("\n\t\t\t\tif (outgoingLight != diffuseColor) {\n\t\t\t\t\tfloat lightAccu = clamp( length( reflectedLight.directSpecular + reflectedLight.indirectSpecular ), 0.0, 1.0 );\n\t\t\t\t\taccumAlpha += ( 1.0 - accumAlpha ) * ".concat(s.result," * ").concat(u," * lightAccu;\n\t\t\t\t\toutgoingLight = spe_blend( diffuseColor, outgoingLight, ").concat(s.result," * ").concat(u,", ").concat(a.result," );\n\t\t\t\t}\n\t\t\t\t")),o&&h.push(o.code,"outgoingLight = spe_blend(outgoingLight, ".concat(o.result,", 1.0, SPE_BLENDING_NORMAL);")),l?h.push("gl_FragColor = vec4( outgoingLight, accumAlpha * ".concat(l.result," );")):h.push("gl_FragColor = vec4( outgoingLight, 1.0 );"),c&&h.push("gl_FragColor.a *= ".concat(c.result,";")),h.push("#include <encodings_fragment>","#include <fog_fragment>","#include <dithering_fragment>"),t=h.join("\n")}return t}},PT=class{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1e4;this.timeout=e,this.cache=new Map,this.head={data:null,time:0,src:null,next:null,prev:null},this.tail={data:null,time:1/0,src:null,next:null,prev:null},this.hasClean=!1,this.head.next=this.tail,this.tail.prev=this.head}log(){}remove(e){let t=this.cache.get(e);t&&(this.dispose(e,t.data),this.cache.delete(e),t.prev.next=t.next,t.next.prev=t.prev)}scheduleCleanup(){this.hasClean||(this.log("scheduled cleanup"),this.hasClean=!0,setTimeout((()=>{this.hasClean=!1,this.log("cleaning");let e=Date.now(),t=this.head.next;for(;t.time<e-this.timeout;)this.dispose(t.src,t.data),this.cache.delete(t.src),t=t.next,t.prev=this.head,this.head.next=t;this.head.next!==this.tail?this.scheduleCleanup():this.log("no more cleanup")}),this.timeout+1e3))}has(e){var t;return null===(t=this.cache.get(e))||void 0===t?void 0:t.data}load(e){let t=Date.now(),n=this.cache.get(e);return void 0===n?(n={data:this.create(e),src:e,time:t,next:null,prev:null},this.cache.set(e,n)):(n.time=t,n.prev.next=n.next,n.next.prev=n.prev),n.prev=this.tail.prev,n.next=this.tail,this.tail.prev.next=n,this.tail.prev=n,this.scheduleCleanup(),n.data}},DT=class extends PT{create(e){return URL.createObjectURL(new Blob([e]))}dispose(e,t){URL.revokeObjectURL(t)}};var OT=class{constructor(e,t){this.data=e,this.cache=t,this.refCount=0}deref(){this.refCount,this.refCount-=1,0===this.refCount&&(this.cache.remove(this),this.dispose())}dispose(){this.refCount,0}},IT=class{constructor(){this.cache=new Map}remove(e){this.cache.delete(e.data),0}load(e){let t=this.cache.get(e);return void 0===t&&(t=this.create(e),this.cache.set(e,t)),t.refCount+=1,t}},RT=class extends OT{constructor(e,t){super(e,t.imageHolderCache),this.data=e,this.shared=t,this.loaded=!1,this.isVideo=!1,this.isBuffer=!1,this._cache={1e3:{},1001:{},1002:{}},this.isVideo="video"===e.type,this.isBuffer=!0===e.isWebGLRenderTarget,this.loadPromise=this.updateSrc(this.isBuffer?e:e.data)}async updateSrc(e){if(typeof document>"u")return;this.disposeTextures(),this.loaded=!1;let t=()=>{this.loaded=!0;for(let e of Object.values(this._cache))for(let t of Object.values(e))for(let e of Object.values(t))e&&(e.image=this.img,e.needsUpdate=!0);this.shared.requestRender()};if(this.isBuffer)this.img=e,this.loaded=!0;else if(this.isVideo){if(this.img=document.createElement("video"),this.img.preload="auto",this.img.playsInline=!0,this.img.currentTime=.01,"string"!=typeof e){var n=new FileReader;let t;n.readAsDataURL(new Blob([e],{type:"video/mp4"})),await new Promise((e=>{n.onloadend=n=>{var i;t=null===(i=n.target)||void 0===i?void 0:i.result,e(null)}})),this.img.src=t}else this.img.src=e;this.img.onloadeddata=()=>{t()}}else this.img=new Image,this.img.src=function(e){return"string"==typeof e?e:(wT||(wT=new DT),wT.load(e))}(e),this.img.onload=t,await new Promise((e=>{this.img.onload=()=>{t(),e(null)}}))}getTexture(e){var t;let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1008,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1006,r=null===(t=this._cache[e])||void 0===t||null===(t=t[n])||void 0===t?void 0:t[i];if(r)return r;{let t;return t=this.isBuffer?this.img.texture:this.isVideo?new Ja(this.img,void 0,e,e):new Dt(this.img,void 0,e,e,i,n),this.loaded&&(t.needsUpdate=!0),void 0===this._cache[e]&&(this._cache[e]={}),void 0===this._cache[e][n]&&(this._cache[e][n]={}),this._cache[e][n][i]=t,t}}setNeedsUpdate(e){for(let t of Object.values(this._cache))for(let n of Object.values(t))for(let t of Object.values(n))t&&(t.needsUpdate=e)}disposeTextures(){for(let[e,t]of Object.entries(this._cache))for(let[n,i]of Object.entries(t))for(let[t,r]of Object.entries(i))null!==r&&void 0!==r&&r.dispose(),void 0!==this._cache[e]&&void 0!==this._cache[e][n]&&(this._cache[e][n][t]=void 0)}dispose(){super.dispose(),this.disposeTextures()}},kT=class extends RT{};function LT(e,t){var n=function(e){if(!zT[e]){var t=new Intl.DateTimeFormat("en-US",{hour12:!1,timeZone:"America/New_York",year:"numeric",month:"numeric",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}).format(new Date("2014-06-25T04:00:00.123Z")),n="06/25/2014, 00:00:00"===t||"\u200e06\u200e/\u200e25\u200e/\u200e2014\u200e \u200e00\u200e:\u200e00\u200e:\u200e00"===t;zT[e]=n?new Intl.DateTimeFormat("en-US",{hour12:!1,timeZone:e,year:"numeric",month:"numeric",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}):new Intl.DateTimeFormat("en-US",{hourCycle:"h23",timeZone:e,year:"numeric",month:"numeric",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"})}return zT[e]}(t);return n.formatToParts?function(e,t){try{for(var n=e.formatToParts(t),i=[],r=0;r<n.length;r++){var s=BT[n[r].type];s>=0&&(i[s]=parseInt(n[r].value,10))}return i}catch(UZ){if(UZ instanceof RangeError)return[NaN];throw UZ}}(n,e):function(e,t){var n=e.format(t).replace(/\u200E/g,""),i=/(\d+)\/(\d+)\/(\d+),? (\d+):(\d+):(\d+)/.exec(n);return[i[3],i[1],i[2],i[4],i[5],i[6]]}(n,e)}var BT={year:0,month:1,day:2,hour:3,minute:4,second:5};var zT={};function NT(e,t,n,i,r,s,a){var o=new Date(0);return o.setUTCFullYear(e,t,n),o.setUTCHours(i,r,s,a),o}var FT=36e5,UT={timezone:/([Z+-].*)$/,timezoneZ:/^(Z)$/,timezoneHH:/^([+-]\d{2})$/,timezoneHHMM:/^([+-]\d{2}):?(\d{2})$/};function jT(e,t,n){var i,r,s;if(!e||(i=UT.timezoneZ.exec(e)))return 0;if(i=UT.timezoneHH.exec(e))return GT(s=parseInt(i[1],10))?-s*FT:NaN;if(i=UT.timezoneHHMM.exec(e)){s=parseInt(i[1],10);var a=parseInt(i[2],10);return GT(s,a)?(r=Math.abs(s)*FT+6e4*a,s>0?-r:r):NaN}if(function(e){if(HT[e])return!0;try{return new Intl.DateTimeFormat(void 0,{timeZone:e}),HT[e]=!0,!0}catch(t){return!1}}(e)){t=new Date(t||Date.now());var o=n?t:function(e){return NT(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds(),e.getMilliseconds())}(t),l=VT(o,e),c=n?l:function(e,t,n){var i=e.getTime(),r=i-t,s=VT(new Date(r),n);if(t===s)return t;r-=s-t;var a=VT(new Date(r),n);return s===a?s:Math.max(s,a)}(t,l,e);return-c}return NaN}function VT(e,t){var n=LT(e,t),i=NT(n[0],n[1]-1,n[2],n[3]%24,n[4],n[5],0).getTime(),r=e.getTime(),s=r%1e3;return i-(r-=s>=0?s:1e3+s)}function GT(e,t){return-23<=e&&e<=23&&(null==t||0<=t&&t<=59)}var HT={};var WT=A(P(),1),qT=A(D(),1),XT=36e5,YT=6e4,QT={dateTimePattern:/^([0-9W+-]+)(T| )(.*)/,datePattern:/^([0-9W+-]+)(.*)/,plainTime:/:/,YY:/^(\d{2})$/,YYY:[/^([+-]\d{2})$/,/^([+-]\d{3})$/,/^([+-]\d{4})$/],YYYY:/^(\d{4})/,YYYYY:[/^([+-]\d{4})/,/^([+-]\d{5})/,/^([+-]\d{6})/],MM:/^-(\d{2})$/,DDD:/^-?(\d{3})$/,MMDD:/^-?(\d{2})-?(\d{2})$/,Www:/^-?W(\d{2})$/,WwwD:/^-?W(\d{2})-?(\d{1})$/,HH:/^(\d{2}([.,]\d*)?)$/,HHMM:/^(\d{2}):?(\d{2}([.,]\d*)?)$/,HHMMSS:/^(\d{2}):?(\d{2}):?(\d{2}([.,]\d*)?)$/,timeZone:/(Z|[+-]\d{2}(?::?\d{2})?| UTC| [a-zA-Z]+\/[a-zA-Z_]+(?:\/[a-zA-Z_]+)?)$/};function KT(e,t){if(arguments.length<1)throw new TypeError("1 argument required, but only "+arguments.length+" present");if(null===e)return new Date(NaN);var n=t||{},i=null==n.additionalDigits?2:(0,WT.default)(n.additionalDigits);if(2!==i&&1!==i&&0!==i)throw new RangeError("additionalDigits must be 0, 1 or 2");if(e instanceof Date||"object"==typeof e&&"[object Date]"===Object.prototype.toString.call(e))return new Date(e.getTime());if("number"==typeof e||"[object Number]"===Object.prototype.toString.call(e))return new Date(e);if("string"!=typeof e&&"[object String]"!==Object.prototype.toString.call(e))return new Date(NaN);var r=function(e){var t,n={},i=QT.dateTimePattern.exec(e);if(i?(n.date=i[1],t=i[3]):(i=QT.datePattern.exec(e),i?(n.date=i[1],t=i[2]):(n.date=null,t=e)),t){var r=QT.timeZone.exec(t);r?(n.time=t.replace(r[1],""),n.timeZone=r[1].trim()):n.time=t}return n}(e),s=function(e,t){var n,i=QT.YYY[t],r=QT.YYYYY[t];if(n=QT.YYYY.exec(e)||r.exec(e),n){var s=n[1];return{year:parseInt(s,10),restDateString:e.slice(s.length)}}if(n=QT.YY.exec(e)||i.exec(e),n){var a=n[1];return{year:100*parseInt(a,10),restDateString:e.slice(a.length)}}return{year:null}}(r.date,i),a=s.year,o=function(e,t){if(null===t)return null;var n,i,r,s;if(0===e.length)return i=new Date(0),i.setUTCFullYear(t),i;if(n=QT.MM.exec(e),n)return i=new Date(0),r=parseInt(n[1],10)-1,tP(t,r)?(i.setUTCFullYear(t,r),i):new Date(NaN);if(n=QT.DDD.exec(e),n){i=new Date(0);var a=parseInt(n[1],10);return function(e,t){if(t<1)return!1;var n=eP(e);return!(n&&t>366||!n&&t>365)}(t,a)?(i.setUTCFullYear(t,0,a),i):new Date(NaN)}if(n=QT.MMDD.exec(e),n){i=new Date(0),r=parseInt(n[1],10)-1;var o=parseInt(n[2],10);return tP(t,r,o)?(i.setUTCFullYear(t,r,o),i):new Date(NaN)}if(n=QT.Www.exec(e),n)return s=parseInt(n[1],10)-1,nP(t,s)?ZT(t,s):new Date(NaN);if(n=QT.WwwD.exec(e),n){s=parseInt(n[1],10)-1;var l=parseInt(n[2],10)-1;return nP(t,s,l)?ZT(t,s,l):new Date(NaN)}return null}(s.restDateString,a);if(isNaN(o))return new Date(NaN);if(o){var l,c=o.getTime(),h=0;if(r.time&&(h=function(e){var t,n,i;if(t=QT.HH.exec(e),t)return n=parseFloat(t[1].replace(",",".")),iP(n)?n%24*XT:NaN;if(t=QT.HHMM.exec(e),t)return n=parseInt(t[1],10),i=parseFloat(t[2].replace(",",".")),iP(n,i)?n%24*XT+i*YT:NaN;if(t=QT.HHMMSS.exec(e),t){n=parseInt(t[1],10),i=parseInt(t[2],10);var r=parseFloat(t[3].replace(",","."));return iP(n,i,r)?n%24*XT+i*YT+1e3*r:NaN}return null}(r.time),isNaN(h)))return new Date(NaN);if(r.timeZone||n.timeZone){if(l=jT(r.timeZone||n.timeZone,new Date(c+h)),isNaN(l))return new Date(NaN)}else l=(0,qT.default)(new Date(c+h)),l=(0,qT.default)(new Date(c+h+l));return new Date(c+h+l)}return new Date(NaN)}function ZT(e,t,n){t=t||0,n=n||0;var i=new Date(0);i.setUTCFullYear(e,0,4);var r=7*t+n+1-(i.getUTCDay()||7);return i.setUTCDate(i.getUTCDate()+r),i}var JT=[31,28,31,30,31,30,31,31,30,31,30,31],$T=[31,29,31,30,31,30,31,31,30,31,30,31];function eP(e){return e%400===0||e%4===0&&e%100!==0}function tP(e,t,n){if(t<0||t>11)return!1;if(null!=n){if(n<1)return!1;var i=eP(e);if(i&&n>$T[t]||!i&&n>JT[t])return!1}return!0}function nP(e,t,n){return!(t<0||t>52||null!=n&&(n<0||n>6))}function iP(e,t,n){return!(null!=e&&(e<0||e>=25)||null!=t&&(t<0||t>=60)||null!=n&&(n<0||n>=60))}function rP(e,t){return t.color(e)}function sP(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Date,t=arguments.length>1?arguments[1]:void 0,n=t.format,i=e.getSeconds(),r=e;t&&null!==t.timeZone&&(r=function(e,t,n){var i=KT(e,n),r=jT(t,i,!0),s=new Date(i.getTime()-r),a=new Date(0);return a.setFullYear(s.getUTCFullYear(),s.getUTCMonth(),s.getUTCDate()),a.setHours(s.getUTCHours(),s.getUTCMinutes(),s.getUTCSeconds(),s.getUTCMilliseconds()),a}(new Date,t.timeZone));let s,a=r.getHours(),o=r.getMinutes();"12ampm"===t.format12h24h&&(s=a>=12?"PM":"AM");let l,c,h=a;switch("24"!==t.format12h24h&&(h=a%12,0===h&&(h=12)),n){case"HH:mm:ss":l=[h,o,i];break;case"HH:mm":l=[h,o];break;case"HH":l=[h],s=void 0;break;case"mm":l=[o],s=void 0;break;case"ss":l=[i],s=void 0;break;case"year":c=r.getFullYear();break;case"month":c=r.getMonth()+1;break;case"dayOfYear":c=Math.floor((r.getTime()-new Date(r.getFullYear(),0,0).getTime())/864e5);break;case"dayOfMonth":c=r.getDate();break;case"secondOfDay":c=60*a*60+60*o+i;break;default:console.error("Unknown time format",n),c=0}return void 0!==l?{textValue:l,suffix:s}:c}function aP(e,t){switch(e.type){case"fresnel":return function(e,t){let{bias:n,scale:i,intensity:r,factor:s,color:a}=e;return o(o({},oP(e,t)),{},{color:rP(a,t),bias:n,scale:i,intensity:r,factor:s})}(e,t);case"gradient":return function(e,t){let{gradientType:n,smooth:i,colors:r,steps:s,angle:a,offset:l,morph:c}=e;return o(o({},oP(e,t)),{},{gradientType:n,smooth:i,colors:r.map((e=>new Ot(e[0],e[1],e[2],e[3]))),num:r.length,steps:s,offset:new ot(...l),morph:new ot(...c),angle:a})}(e,t);case"depth":return function(e,t){let{gradientType:n,near:i,far:r,isVector:s,isWorldSpace:a,origin:l,direction:c,colors:h,steps:u,smooth:d}=e;return o(o({},oP(e,t)),{},{gradientType:n,near:i,far:r,isVector:s,isWorldSpace:a,origin:new Bt(...l),direction:c?new Bt(...c):new Bt(1,0,0),colors:h.map((e=>void 0!==e?new Ot(e[0],e[1],e[2],e[3]):new Ot(0,0,0,0))),steps:u.slice(0,h.length),smooth:d})}(e,t);case"normal":return function(e,t){let{cnormal:n}=e;return o(o({},oP(e,t)),{},{cnormal:new Bt(n[0],n[1],n[2])})}(e,t);case"noise":return function(e,t){return o(o({},oP(e,t)),{},{scale:e.scale,move:e.move,fA:new ot(...e.fA),fB:new ot(...e.fB),size:new Bt(...e.size),distortion:new ot(...e.distortion),colorA:rP(e.colorA,t),colorB:rP(e.colorB,t),colorC:rP(e.colorC,t),colorD:rP(e.colorD,t),noiseType:e.noiseType,voronoiStyle:e.voronoiStyle,highCut:e.highCut,lowCut:e.lowCut,smoothness:e.smoothness,seed:e.seed,quality:e.quality})}(e,t);case"rainbow":return function(e,t){return o(o({},oP(e,t)),{},{filmThickness:e.filmThickness,movement:e.movement,wavelengths:new Bt(...e.wavelengths),noiseStrength:e.noiseStrength,noiseScale:e.noiseScale,offset:new Bt(...e.offset)})}(e,t);case"toon":return function(e,t){return o(o({},oP(e,t)),{},{positioning:e.positioning,colors:e.colors.map((e=>new Ot(e[0],e[1],e[2],e[3]))),num:e.colors.length,steps:e.steps,source:new Bt(...e.source),isWorldSpace:e.isWorldSpace,noiseStrength:e.noiseStrength,noiseScale:e.noiseScale,shadowColor:rP(e.shadowColor,t),offset:new Bt(...e.offset)})}(e,t);case"outline":return function(e,t){return o(o({},oP(e,t)),{},{outlineColor:rP(e.outlineColor,t),contourColor:rP(e.contourColor,t),outlineWidth:e.outlineWidth,contourWidth:e.contourWidth,outlineThreshold:e.outlineThreshold,contourThreshold:e.contourThreshold,outlineSmoothing:e.outlineSmoothing,contourFrequency:e.contourFrequency,contourDirection:new Bt(...e.contourDirection),positionalLines:e.positionalLines,compensation:e.compensation})}(e,t);case"transmission":return function(e,t){return o(o({},oP(e,t)),{},{thickness:e.thickness,ior:e.ior,roughness:e.roughness})}(e,t);case"color":return function(e,t){return o(o({},oP(e,t)),{},{color:rP(e.color,t)})}(e,t);case"pattern":return function(e,t){return o(o({},oP(e,t)),{},{style:e.style,projection:e.projection,axis:e.axis,blending:e.blending,offset:new ot(...e.offset),colorA:rP(e.colorA,t),colorB:rP(e.colorB,t),frequency:new ot(...e.frequency),size:e.size,variation:e.variation,smoothness:e.smoothness,zigzag:e.zigzag,rotation:e.rotation,vertical:new ot(...e.vertical),horizontal:new ot(...e.horizontal),sides:e.sides})}(e,t)}}function oP(e,t){var n;let{alpha:i,mode:r,isMask:s}=e,a="string"==typeof i?(null!==(n=Number(t.getVariable(i)))&&void 0!==n?n:100)/100:i;return o(o({},function(e){return{type:e.type}}(e)),{},{alpha:a,mode:r,isMask:s})}var lP=class extends QC{},cP={noise:["noiseType"],texture:["projection","axis","side"],video:["projection","axis","side"],displace:["noiseType"],light:["roughnessMap","bumpMap"],depth:["smooth","isWorldSpace","gradientType","isVector"],pattern:["style","projection","axis"]},hP={depth:["colors"]};function uP(e,t,n){if("isMask"===t)return!0;let i=cP[e.type],r=hP[e.type];if(void 0!==r){let i=e.color;if(r.includes(t)){var s;let e=null===(s=i[t])||void 0===s||null===(s=s.value)||void 0===s?void 0:s.length;if(void 0!==e&&e!==n.length)return!0}}return void 0!==i&&i.includes(t)}function dP(e,t,n){var i;let r=n.uniforms["f".concat(n.id,"_texture")];if(!r)return!1;let s=!1,a=e;if("image"in a){let e=a.image,n=t.image(e),i=r;i.image instanceof kT||i.image.deref(),i.image=n}if("video"in a){let e=a.video,n=t.video(e),i=r;i.image instanceof kT||i.image.deref(),i.image=n}if("wrapping"in a){r.wrap=a.wrapping}if("minFilter"in a){r.minFilter=a.minFilter}if("magFilter"in a){r.magFilter=a.magFilter}if("rotation"in a&&n.uniforms["f".concat(n.id,"_rotation")])return n.uniforms["f".concat(n.id,"_rotation")].value=(null!==(i=a.rotation)&&void 0!==i?i:0)*at.DEG2RAD,s;if("repeat"in a||"offset"in a||"rotation"in a){var o;let e="mat",t=n.uniforms["f".concat(n.id,"_").concat(e)];"repeat"in a&&(t.repeat=a.repeat),"offset"in a&&(t.offset=a.offset),"rotation"in a&&(t.rotation=null!==(o=a.rotation)&&void 0!==o?o:0),t.updateMatrix()}return s}var pP=(e,t,n)=>{var i,r;return null!==(i=Math.max(0,Math.min(1,Number(null!==(r=t.getVariable("number"==typeof e?100*e:e,n))&&void 0!==r?r:100)/100)))&&void 0!==i?i:1},fP=class{constructor(e,t,n,i,r){this.id=e,this.uuid=t,this.data=n,this.uniforms={};for(let s in i)this.uniforms["f".concat(this.id,"_").concat(s)]=i[s];for(let s in n)bP(s,this,n,r)}get type(){return this.data.type}static create(e,t,n,i){if("light"===n.type)return vP.createLightLayer(e,t,n,i);if("texture"===n.type||"video"===n.type){var r,s,a,l,c,h,u,d,p,f;let o="texture"===n.type?null!==(r=i.uiBuffer(n.texture.image))&&void 0!==r?r:i.image(n.texture.image):i.video(n.texture.video),m=new NM(o,n.texture.wrapping,null!==(s=n.texture.minFilter)&&void 0!==s?s:1008,null!==(a=n.texture.magFilter)&&void 0!==a?a:1006),g=new zM(o),v=new VM(n.texture.repeat,n.texture.offset,null!==(l=n.texture.rotation)&&void 0!==l?l:0),y=new uM(n.crop?1:0),b=new RM(null!==(c=n.projection)&&void 0!==c?c:0),x=new RM(null!==(h=["x","y","z"].indexOf(n.axis))&&void 0!==h?h:0),w=new RM(null!==(u=n.side)&&void 0!==u?u:0),S=new XC(n.size?new ot(n.size[0],n.size[1]):new ot(100,100)),_=new uM(null!==(d=n.blending)&&void 0!==d?d:0),E=new uM(pP(n.alpha,i)),A=new RM(null!==(p=n.mode)&&void 0!==p?p:0),C=new kM(null!==(f=n.isMask)&&void 0!==f&&f),M=new KM(m,g,y,b,x,w,S,_,v,E,A,C),T=new cM(M.calpha,"f");return new mP(e,t,n,{texture:m,textureSize:g,crop:y,projection:b,axis:x,side:w,size:S,blending:_,mat:v,alpha:E,mode:A,isMask:C},M,A,T,C,i)}if("matcap"===n.type){var m,g,v,y,b;let r=i.image(n.texture.image),s=new NM(r,n.texture.wrapping,null!==(m=n.texture.minFilter)&&void 0!==m?m:1008,null!==(g=n.texture.magFilter)&&void 0!==g?g:1006),a=new uM(pP(n.alpha,i)),o=new RM(null!==(v=n.mode)&&void 0!==v?v:0),l=new kM(null!==(y=n.isMask)&&void 0!==y&&y),c=new uM((null!==(b=n.texture.rotation)&&void 0!==b?b:0)*at.DEG2RAD),h=new iT(s,a,o,l,c),u=new cM(h.calpha,"f");return new mP(e,t,n,{texture:s,alpha:a,mode:o,isMask:l,rotation:c},h,o,u,l,i)}if("displace"===n.type){if("noise"===n.displacementType){var x,w,S,_,E,A,C,M,T,P;let r=new YC(new Bt(...n.offset)),s=new uM(null!==(x=n.scale)&&void 0!==x?x:10),a=new uM(null!==(w=n.intensity)&&void 0!==w?w:8),o=new uM(null!==(S=n.movement)&&void 0!==S?S:1),l=new RM(null!==(_=n.noiseType)&&void 0!==_?_:0),c=new RM(null!==(E=n.voronoiStyle)&&void 0!==E?E:0),h=new uM(null!==(A=n.smoothness)&&void 0!==A?A:.5),u=new uM(null!==(C=n.seed)&&void 0!==C?C:0),d=new uM(null!==(M=n.highCut)&&void 0!==M?M:1),p=new uM(null!==(T=n.lowCut)&&void 0!==T?T:0),f=new RM(null!==(P=n.quality)&&void 0!==P?P:1),m=new bT(a,o,r,c,h,u,d,p,f,s,l);return new gP(e,t,n,{offset:r,scale:s,intensity:a,movement:o,noiseType:l,voronoiStyle:c,smoothness:h,seed:u,highCut:d,lowCut:p,quality:f},m,i)}throw new Error}return function(e,t,n,i){let r=aP(n,i);return function(e,t,n,i,r){switch(e.type){case"color":{var s;let a=new IM(null!==(s=i.color)&&void 0!==s?s:ab),l=yP(i),c=new qM(a,l.alpha),h=new cM(c.calpha,"f");return new mP(t,n,e,o({color:a},l),c,l.mode,h,l.isMask,r)}case"fresnel":{var a,l,c,h,u;let s=new IM(null!==(a=i.color)&&void 0!==a?a:16777215),d=new uM(null!==(l=i.bias)&&void 0!==l?l:.1),p=new uM(null!==(c=i.scale)&&void 0!==c?c:1),f=new uM(null!==(h=i.intensity)&&void 0!==h?h:2),m=new uM(null!==(u=i.factor)&&void 0!==u?u:1),g=yP(i),v=new $M(s,d,p,f,m,g.alpha,g.mode,g.isMask),y=new cM(v.calpha,"f");return new mP(t,n,e,o({color:s,bias:d,scale:p,intensity:f,factor:m},g),v,g.mode,y,g.isMask,r)}case"rainbow":{var d,p,f,m,g,v;let s=new uM(null!==(d=i.filmThickness)&&void 0!==d?d:30),a=new uM(null!==(p=i.movement)&&void 0!==p?p:0),l=new YC(null!==(f=i.wavelengths)&&void 0!==f?f:new Bt(0,0,0)),c=new uM(null!==(m=i.noiseStrength)&&void 0!==m?m:0),h=new uM(null!==(g=i.noiseScale)&&void 0!==g?g:1),u=new YC(null!==(v=i.offset)&&void 0!==v?v:new Bt(0,0,0)),y=yP(i),b=new uT(s,a,l,c,h,u,y.alpha,y.isMask),x=new cM(b.calpha,"f");return new mP(t,n,e,o({filmThickness:s,movement:a,wavelengths:l,noiseStrength:c,noiseScale:h,offset:u},y),b,y.mode,x,y.isMask,r)}case"transmission":{var y,b,x;let s=new uM(null!==(y=i.thickness)&&void 0!==y?y:10),a=new uM(null!==(b=i.ior)&&void 0!==b?b:1.5),l=new uM(null!==(x=i.roughness)&&void 0!==x?x:.5),c=xT.transmissionSize,h=xT.transmissionRenderTarget,u=xT.transmissionRenderTargetDepth,d=window.innerWidth,p=window.innerHeight,f=d>=p?new XC(p/d,1):new XC(1,d/p),m=yP(i),g=new gT(s,a,l,c,h,u,f,m.alpha),v=new cM(g.calpha,"f");return new mP(t,n,e,o({thickness:s,ior:a,roughness:l,aspectRatio:f},m),g,m.mode,v,m.isMask,r)}case"toon":{var w,S,_,E,A,C;let s,a,l=new RM(null!==(w=i.positioning)&&void 0!==w?w:0);i.colors?s=new GM(i.colors.length,i.colors):(s=new GM(10,new Ot(0,0,0,1)),s.value[1]=new Ot(1,1,1,1)),i.steps?a=new LM(i.steps.length,i.steps):(a=new LM(10,1),a.value[0]=0);let c=new YC(null!==(S=i.source)&&void 0!==S?S:new Bt(0,0,0)),h=new kM(null===(_=i.isWorldSpace)||void 0===_||_),u=new uM(null!==(E=i.noiseStrength)&&void 0!==E?E:0),d=new uM(null!==(A=i.noiseScale)&&void 0!==A?A:1),p=new KC(i.shadowColor),f=new YC(null!==(C=i.offset)&&void 0!==C?C:new Bt(0,0,0)),m=yP(i),g=new pT(l,s,a,c,h,u,d,p,f,m.alpha),v=new cM(g.calpha,"f");return new mP(t,n,e,o({positioning:l,colors:s,steps:a,source:c,isWorldSpace:h,noiseStrength:u,noiseScale:d,shadowColor:p,offset:f},m),g,m.mode,v,m.isMask,r)}case"outline":{var M,T,P,D,O,I,R,k,L,B,z;let s=new IM(null!==(M=i.outlineColor)&&void 0!==M?M:16777215),a=new IM(null!==(T=i.contourColor)&&void 0!==T?T:16777215),l=new uM(null!==(P=i.outlineWidth)&&void 0!==P?P:.1),c=new uM(null!==(D=i.contourWidth)&&void 0!==D?D:.1),h=new uM(null!==(O=i.outlineThreshold)&&void 0!==O?O:.1),u=new uM(null!==(I=i.contourThreshold)&&void 0!==I?I:.1),d=new uM(null!==(R=i.outlineSmoothing)&&void 0!==R?R:.1),p=new uM(null!==(k=i.contourFrequency)&&void 0!==k?k:.1),f=new YC(null!==(L=i.contourDirection)&&void 0!==L?L:new Bt(0,1,0)),m=new kM(null!==(B=i.positionalLines)&&void 0!==B&&B),g=new kM(null===(z=i.compensation)||void 0===z||z),v=xT.normalRenderTarget,y=xT.normalRenderTargetDepth,b=xT.pixelRatioNode,x=xT.resolution,w=yP(i),S=new oT(s,a,l,c,h,u,d,p,f,m,g,x,v,y,b,w.alpha),_=new cM(S.calpha,"f");return new mP(t,n,e,o({outlineColor:s,contourColor:a,outlineWidth:l,contourWidth:c,outlineThreshold:h,contourThreshold:u,outlineSmoothing:d,contourFrequency:p,contourDirection:f,positionalLines:m,compensation:g},w),S,w.mode,_,w.isMask,r)}case"depth":{var N,F,U,j,V,G,H,W;let s,a,l=new RM(null!==(N=i.gradientType)&&void 0!==N?N:0),c=new kM(null!==(F=i.smooth)&&void 0!==F&&F),h=new uM(null!==(U=i.near)&&void 0!==U?U:50),u=new uM(null!==(j=i.far)&&void 0!==j?j:200),d=new uM(null!==(V=i.isVector)&&void 0!==V?V:1),p=new uM(null!==(G=i.isWorldSpace)&&void 0!==G?G:0),f=new YC(null!==(H=i.origin)&&void 0!==H?H:new Bt),m=new YC(null!==(W=i.direction)&&void 0!==W?W:new Bt);i.colors?s=new GM(i.colors.length,i.colors):(s=new GM(2,new Ot(0,0,0,1)),s.value[1]=new Ot(1,1,1,1)),i.steps?a=new LM(i.steps.length,i.steps):(a=new LM(2,1),a.value[0]=0);let g=yP(i),v=new JM(l,c,h,u,d,p,f,m,s,a,g.alpha,g.isMask),y=new cM(v.calpha,"f");return new mP(t,n,e,o({gradientType:l,smooth:c,near:h,far:u,isVector:d,isWorldSpace:p,origin:f,direction:m,colors:s,steps:a},g),v,g.mode,y,g.isMask,r)}case"noise":{var q,X,Y,Q,K,Z,J,$,ee,te,ne,ie,re;let s=new uM(null!==(q=i.scale)&&void 0!==q?q:1),a=new YC(null!==(X=i.size)&&void 0!==X?X:new Bt(100,100,100)),l=new uM(null!==(Y=i.move)&&void 0!==Y?Y:1),c=new XC(null!==(Q=i.fA)&&void 0!==Q?Q:new ot(1.7,9.2)),h=new XC(null!==(K=i.fB)&&void 0!==K?K:new ot(8.3,2.8)),u=new XC(null!==(Z=i.distortion)&&void 0!==Z?Z:new ot(1,1)),d=new KC(i.colorA),p=new KC(i.colorB),f=new KC(i.colorC),m=new KC(i.colorD),g=new RM(null!==(J=i.noiseType)&&void 0!==J?J:0),v=new RM(null!==($=i.voronoiStyle)&&void 0!==$?$:0),y=new uM(null!==(ee=i.highCut)&&void 0!==ee?ee:1),b=new uM(null!==(te=i.lowCut)&&void 0!==te?te:0),x=new uM(null!==(ne=i.smoothness)&&void 0!==ne?ne:.5),w=new uM(null!==(ie=i.seed)&&void 0!==ie?ie:.5),S=new RM(null!==(re=i.quality)&&void 0!==re?re:1),_=yP(i),E=new sT(s,a,l,c,h,u,d,p,f,m,_.alpha,g,_.isMask,v,y,b,x,w,S),A=new cM(E.calpha,"f");return new mP(t,n,e,o(o({scale:s,size:a,move:l,fA:c,fB:h,distortion:u,colorA:d,colorB:p,colorC:f,colorD:m,noiseType:g},_),{},{voronoiStyle:v,highCut:y,lowCut:b,smoothness:x,seed:w,quality:S}),E,_.mode,A,_.isMask,r)}case"normal":{var se;let s=new YC(null!==(se=i.cnormal)&&void 0!==se?se:new Bt(1,1,1)),a=yP(i),l=new YM(s,a.alpha),c=new cM(l.calpha,"f");return new mP(t,n,e,o({cnormal:s},a),l,a.mode,c,a.isMask,r)}case"gradient":{var ae,oe,le,ce,he;let s,a,l=new RM(null!==(ae=i.gradientType)&&void 0!==ae?ae:0),c=new kM(null!==(oe=i.smooth)&&void 0!==oe&&oe);i.colors?s=new GM(i.colors.length,i.colors):(s=new GM(10,new Ot(0,0,0,1)),s.value[1]=new Ot(1,1,1,1)),i.steps?a=new LM(i.steps.length,i.steps):(a=new LM(10,1),a.value[0]=0);let h=new XC(null!==(le=i.offset)&&void 0!==le?le:new ot(0,0)),u=new XC(null!==(ce=i.morph)&&void 0!==ce?ce:new ot(0,0)),d=new uM(null!==(he=i.angle)&&void 0!==he?he:0),p=yP(i),f=new tT(l,c,s,a,h,u,d,p.alpha,p.isMask),m=new cM(f.calpha,"f");return new mP(t,n,e,o({gradientType:l,smooth:c,colors:s,steps:a,offset:h,morph:u,angle:d},p),f,p.mode,m,p.isMask,r)}case"pattern":{var ue,de,pe,fe,me,ge,ve,ye,be,xe,we,Se,_e,Ee;let s=new RM(null!==(ue=i.style)&&void 0!==ue?ue:0),a=new RM(null!==(de=i.projection)&&void 0!==de?de:0),l=new RM(null!==(pe=["x","y","z"].indexOf(i.axis))&&void 0!==pe?pe:0),c=new uM(null!==(fe=i.blending)&&void 0!==fe?fe:0),h=new XC(null!==(me=i.offset)&&void 0!==me?me:new ot(0,0)),u=new KC(i.colorA),d=new KC(i.colorB),p=new XC(null!==(ge=i.frequency)&&void 0!==ge?ge:new ot(10,10)),f=new uM(null!==(ve=i.size)&&void 0!==ve?ve:.5),m=new uM(null!==(ye=i.variation)&&void 0!==ye?ye:0),g=new uM(null!==(be=i.smoothness)&&void 0!==be?be:.5),v=new uM(null!==(xe=i.zigzag)&&void 0!==xe?xe:0),y=new uM(null!==(we=i.rotation)&&void 0!==we?we:0),b=new XC(null!==(Se=i.vertical)&&void 0!==Se?Se:new ot(0,1)),x=new XC(null!==(_e=i.horizontal)&&void 0!==_e?_e:new ot(0,1)),w=new RM(null!==(Ee=i.sides)&&void 0!==Ee?Ee:6),S=yP(i),_=new cT(s,a,l,c,h,u,d,p,f,m,g,v,y,b,x,w,S.alpha,S.isMask),E=new cM(_.calpha,"f");return new mP(t,n,e,o({style:s,projection:a,axis:l,blending:c,offset:h,colorA:u,colorB:d,frequency:p,size:f,variation:m,smoothness:g,zigzag:v,rotation:y,vertical:b,horizontal:x,sides:w},S),_,S.mode,E,S.isMask,r)}default:{let s=new IM(1,0,0,1),a=yP(i),l=new qM(s,a.alpha),c=new cM(l.calpha,"f");return new mP(t,n,e,o({color:s},a),l,a.mode,c,a.isMask,r)}}}(n,e,t,r,i)}(e,t,n,i)}updateByOp(e,t,n){let i=e;if(void 0===i.path[0]){if(0===i.type)return"type"in i.props||"category"in i.props||"visible"in i.props||"noiseType"in i.props?(n.scene.markNeedsUpdateRendererDirty(),!0):function(e,t,n,i){let r=!1;for(let[s,a]of Object.entries(e)){if("bumpMap"===s||"roughnessMap"===s){r=!0;continue}if(!s||void 0===a)continue;if(bP(s,n,i,t)){"visible"===s&&"light"===n.type&&(r=!0);continue}n.visible=i.visible;let e=n.uniforms["f".concat(n.id,"_").concat(s)];if(e&&!(e instanceof BM))switch(r=r||uP(n,s,a),e.constructor){case IM:if("string"==typeof a){let n=t.getColor(a);n&&(e.value=n);break}{let t=a;e.value instanceof lP?e.value=new QC(t.r,t.g,t.b,t.a):e.setRGBA(t);break}case KC:if("string"==typeof a){let n=t.getColor(a);n&&(e.value=n);break}{let t=a;e.value instanceof lP?e.value=new QC(t.r,t.g,t.b,t.a):e.value.setRGBA(t.r,t.g,t.b,t.a);break}case XC:{let t=a;e.value.setX(t[0]),e.value.setY(t[1]);break}case YC:{let t=a;e.value.setX(t[0]),e.value.setY(t[1]),e.value.setZ(t[2]);break}case hM:dP(a,t,n);break;case GM:e.value=a.map((e=>new Ot(...e)));break;default:e.value=a}}return r}(i.props,n.shared,this,t)}else if("texture"===i.path[0])return!("texture"in t)&&!("video"in t)||dP(i.props,n.shared,this);return!1}dispose(){if(function(e){let t=e instanceof fP?e.type:e;return"texture"===t||"video"===t||"displace_map"===t||"matcap"===t}(this)){let e=this.uniforms["f".concat(this.id,"_texture")];if(!e)return!1;let t=e;t.image instanceof kT||t.image.deref()}}hasValueByKey(e){return void 0!==this.uniforms[e]}hasValue(e){return this.hasValueByKey("f".concat(this.id,"_").concat(e))}setValue(e,t){let n="f".concat(this.id,"_").concat(e);this.hasValueByKey(n)&&void 0!==t&&(this.uniforms[n].value=t)}getNode(e){let t="f".concat(this.id,"_").concat(e);if(this.hasValueByKey(t))return this.uniforms[t]}getValue(e){let t="f".concat(this.id,"_").concat(e);if(this.hasValueByKey(t))return this.uniforms[t].value}getName(e){let t=/f\d+_(.*)/.exec(e);if(t&&t.length>1)return t[1];console.log("Layer.getName: error ".concat(e))}getNames(){let e=[];for(let t in this.uniforms){let n=this.getName(t);n&&e.push(n)}return e}},mP=class extends fP{constructor(e,t,n,i,r,s,a,o,l){super(e,t,n,i,l),this.params=i,this.color=r,this.mode=s,this.alpha=a,this.isMask=o}},gP=class extends fP{constructor(e,t,n,i,r,s){super(e,t,n,i,s),this.position=r}},vP=class extends fP{constructor(e,t,n,i,r,s){super(e,t,n,r,s),this.node=i}static createLightLayer(e,t,n,i){let r,s,a=new uM(pP(n.alpha,i)),o=new RM(n.mode),l=new uM(n.bumpMapIntensity),c=new uM(pP(n.alphaOverride,i));if(n.visible)if("lambert"===n.category){var h,u;r=new ET;let e=new IM(null!==(h=i.color(n.emissive))&&void 0!==h?h:0),t=new kM(null===(u=n.occlusion)||void 0===u||u);s={emissive:e,occlusion:t},r.emissive=e,r.occlusion=t}else if("toon"===n.category){var d,p;r=new TT;let e=new uM(null!==(d=n.shininess)&&void 0!==d?d:30),t=new IM(null!==(p=i.color(n.specular))&&void 0!==p?p:1118481);s={shininess:e,specular:t},r.shininess=e,r.specular=t}else if("physical"===n.category){var f,m,g,v;r=new MT;let e=new uM(null!==(f=n.roughness)&&void 0!==f?f:.3),t=new uM(null!==(m=n.metalness)&&void 0!==m?m:0),i=new uM(null!==(g=n.reflectivity)&&void 0!==g?g:.5),a=new kM(null===(v=n.occlusion)||void 0===v||v);s={roughness:e,metalness:t,reflectivity:i,occlusion:a},r.roughness=e,r.metalness=t,r.reflectivity=i,r.occlusion=a}else{var y,b,x;r=new CT;let e=new uM(null!==(y=n.shininess)&&void 0!==y?y:30),t=new IM(void 0!==n.specular&&null!==(b=i.color(n.specular))&&void 0!==b?b:1118481),a=new kM(null===(x=n.occlusion)||void 0===x||x);s={shininess:e,specular:t,occlusion:a},r.shininess=e,r.specular=t,r.occlusion=a}else r=new _T,s={};return r.alpha=new uM(1),r.shadingAlpha=a,r.shadingBlend=o,r.bumpMapIntensity=l,r.alphaOverride=c,s.alpha=r.shadingAlpha,s.mode=r.shadingBlend,s.bumpMapIntensity=r.bumpMapIntensity,s.alphaOverride=r.alphaOverride,new vP(e,t,n,r,s,i)}get category(){return this.node.category}};function yP(e){var t,n,i;return{alpha:new uM(null!==(t=e.alpha)&&void 0!==t?t:1),mode:new RM(null!==(n=e.mode)&&void 0!==n?n:0),isMask:new kM(null!==(i=e.isMask)&&void 0!==i&&i)}}function bP(e,t,n,i){if("displace"===n.type&&("intensity"===e||"visible"===e)){let e=t.uniforms["f".concat(t.id,"_intensity")];return e?(e.value=n.intensity*(n.visible?1:0),e):void 0}if("displace"!==n.type&&("alpha"===e||"visible"===e)){let r=t.uniforms["f".concat(t.id,"_alpha")];if(!r)return;if(r.value=pP(n.alpha,i)*(n.visible?1:0),"outline"===n.type&&"visible"===e){let e=t.uniforms["f".concat(t.id,"_compensation")];e&&(e.value=n.compensation&&n.visible)}return r}}function xP(e,t){let n=0,i=e.layers.find((e=>"light"===e.data.type));if(i){let e=i.data,n=Number(t.getVariable(e.alphaOverride));if(("string"==typeof e.alphaOverride?n/100:e.alphaOverride)<1)return!0}for(let s of e.layers){if("displace"!==s.data.type&&s.data.isMask)return!0;if("displace"!==s.data.type&&"alpha"in s.data&&"light"!==s.data.type&&"fresnel"!==s.data.type&&"texture"!==s.data.type&&"matcap"!==s.data.type&&"rainbow"!==s.data.type&&"outline"!==s.data.type&&"pattern"!==s.data.type){var r;let e=s.data.visible?s.data.alpha:0;if("string"==typeof e&&(e=Math.max(0,Math.min(1,Number(null!==(r=t.getVariable(e))&&void 0!==r?r:100)/100))),1===e&&"depth"===s.data.type||"gradient"===s.data.type){for(let t of s.data.colors)if(t[3]<1){e=t[3];break}}else if(1===e&&"noise"===s.data.type){let n=t.color(s.data.colorA).a,i=t.color(s.data.colorB).a,r=t.color(s.data.colorC).a,a=t.color(s.data.colorD).a,o=Math.min(n,Math.min(i,Math.min(r,a)));o<1&&(e=o)}n+=(1-n)*e}}return n<1}var wP=class extends Ri{constructor(){super(void 0),this.flatShading=!1,this.needsJitter=!0,this.shadersPatchedForShapeBlend=!1,this.nodeContextUuid=0,this.fog=!0,this.dithering=!0,this.vertexColors=!0,this.transparent=!0}customProgramCacheKey(){return""}},SP=class extends wP{constructor(e,t,n,i){super(),this.flatShading=e,this.side=t,this.wireframe=n,this.root=i}updateAfterBuild(){let e=this.root;this.lights=e.lights,this.vertexShader=e.vertexShader,this.fragmentShader=e.fragmentShader,Object.assign(this.defines,e.defines),Object.assign(this.uniforms,e.uniforms),this.extensions=e.extensions,this.transparent=e.transparent,this.cacheKey=e.customProgramCacheKey()+"flat"+this.flatShading+this.side}onBeforeCompile(e,t){this.root.onBeforeCompile(e)}get data(){return this.root.data}get category(){return this.root.category}get hasAO(){return this.root.hasAO}getFlavor(e,t,n,i){return this.root.getFlavor(e,t,n,i)}get layers(){return this.root.layers}get fragment(){return this.root.fragment}getLayersOfType(e){return this.root.getLayersOfType(e)}getLayerByUuid(e){return this.root.getLayerByUuid(e)}updateByOp(e,t,n){this.root.updateByOp(e,t,n)}nodeMaterialDispose(){this.root.nodeMaterialDispose()}},_P=class extends wP{constructor(e,t){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];super(),this.data=e,this.allowVariableSaves=n,this.layerIdGen=0,this.flavors=[],this.masks={},this.type="NodeMaterial",this.updaters=[],this.needsJitter=t.shared.needsJitter,VC.startContext(this),this.reset0(e,t),VC.endContext(this)}get nodeMaterial(){return this}getFlavor(e,t,n,i){var r;let s=n?6:(e?3:0)+t;if(s+=7*((null!==(r=null===i||void 0===i?void 0:i.resolutionLevel)&&void 0!==r?r:0)-(null!==i&&void 0!==i&&i.useChildrenColors?4:0)),0===s)return this;void 0===this.flavors&&(this.flavors=[]),s-=1;let a=this.flavors[s];return void 0===a&&(a=new SP(e,t,n,this),a.needsJitter=this.needsJitter,this.flavors[s]=a,a.flatShading=e,a.side=t,a.updateAfterBuild(),i&&(a.defines.SHAPEBLEND=i.resolutionLevel,a.defines.SHAPEBLEND_C=i.useChildrenColors?1:0)),a}get fragment(){return this.lightLayer.node}get category(){return this.lightLayer.category}get hasAO(){var e,t;return null!==(e=null===(t=this.lightLayer.getNode("occlusion"))||void 0===t?void 0:t.value)&&void 0!==e&&e}reset(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];VC.startContext(this),(this.data!==e||n)&&this.reset0(e,t),VC.endContext(this)}reset0(e,t){var n,i;this.data=e;let r=null!==(n=e.layers)&&void 0!==n?n:Cb.defaultTwoLayerData("phong").layers;try{this.layers=r.map((e=>fP.create(this.layerIdGen++,e.id,e.data,t.shared)))}catch(s){this.layers=[]}this.layers.reverse(),this.name=null!==(i=e.name)&&void 0!==i?i:"Untitled Material",this.onUpdate(t.shared),this.transparent=xP(e,t.shared),this.saveVariableLocations(t)}onVariableUpdate(e,t,n){if("alphaOverride"===e[0])this.transparent=xP(this.data,n.shared),this.lightLayer.setValue("alphaOverride",Math.max(0,Math.min(Number(t)/100,1)));else if("layer"===e[0]){let i=e[1],r=e[2];if(i&&r){let e=this.layers.find((e=>e.uuid===i));(null===e||void 0===e?void 0:e.hasValue(r))&&("alpha"===r?(this.transparent=xP(this.data,n.shared),e.setValue(r,Math.max(0,Math.min(Number(t)/100,1)))):e.setValue(r,t))}}}saveVariableLocations(e){if(!this.allowVariableSaves)return;let t=this.data.layers.find((e=>"light"===e.data.type));t&&e.shared.getVariable(t.data.alphaOverride,["material",this.uuid,"alphaOverride"]),this.data.layers.forEach((t=>{"alpha"in t.data&&"string"==typeof t.data.alpha&&e.shared.getVariable(t.data.alpha,["material",this.uuid,"layer",t.id,"alpha"])}))}getLayersOfType(e){return this.layers.filter((t=>t.type===e))}getLayerByUuid(e){return this.layers.find((t=>t.uuid===e))}onUpdate(e){this.lightLayer=this.layers.find((e=>e instanceof vP)),void 0===this.lightLayer&&(this.lightLayer=new vP(0,"",o(o({},Ab.defaultData("light","phong")),{},{visible:!1}),new _T,{},e)),this.dispose();for(let t of this.flavors)t&&t.dispose();this.applyTextureMaps(),this.applyMasks(),this.blendColors(),this.blendAfterColors(),this.blendPositions(),this.build(),this.nodeContextUuid=0}applyTextureMaps(){let e=this.layers.find((e=>e instanceof vP));if(!e)return;let t=e.data,n=t.bumpMap,i=t.roughnessMap;e.node.bumpMap=void 0,e.node.roughnessMap=void 0;for(let r=0;r<this.layers.length;++r){let t=this.layers[r];t instanceof mP&&t.color instanceof KM&&(t.uuid===n&&(e.node.bumpMap=t.color),t.uuid===i&&(e.node.roughnessMap=t.color))}}updateByOp(e,t,n){if(VC.startContext(this),void 0!==t?this.data=t:t=this.data,this.transparent=xP(t,n.shared),"layers"===e.path[0]){let i=n.shared,r=e.path[1];if(void 0===r)n.scene.markNeedsUpdateRendererDirty(),this.reset0(t,n);else{0===e.type&&void 0!==e.props.occlusion&&n.scene.markNeedsUpdateRendererDirty();let s=this.layers.find((e=>e.uuid===r));if(s){let a,l=t.layers.data(r);0===e.type&&("alpha"in e.props||"alphaOverride"in e.props)&&(a="alpha"in e.props?o(o({},e.props),{},{alpha:pP(e.props.alpha,i,["material",this.uuid,"layer",r,"alpha"])}):o(o({},e.props),{},{alphaOverride:pP(e.props.alphaOverride,i,["material",this.uuid,"alphaOverride"])})),s.updateByOp(o(o(o({},e),a?{props:a}:{}),{},{path:e.path.slice(2)}),l,n)&&this.reset0(t,n)}}}else this.reset0(t,n);VC.endContext(this)}applyMasks(){for(let e=0;e<this.layers.length;++e){let t=this.layers[e];t instanceof mP?t.color.mask=void 0:t instanceof vP&&(t.node.mask=void 0)}for(let e=0;e<this.layers.length;++e){let t=this.layers[e];if(t instanceof mP&&t.isMask.value&&t.data.visible&&e>0){let n=e-1,i=this.layers[n];i instanceof vP?i.node.mask=new fM(t.color,t.alpha,fM.MUL):i instanceof mP&&(i.isMask.value||(i.color.mask=new fM(t.color,t.alpha,fM.MUL)))}}}blendColors(){let e=this.layers.findIndex((e=>e instanceof mP)),t=this.layers.findIndex((e=>e instanceof vP));if(-1!==e&&e<t){let n=this.layers[e].color;for(let i=e+1;i<t;++i){let e=this.layers[i];if(e instanceof mP){if(e.isMask.value)continue;n=new HM(n,e.color,e.alpha,e.mode)}}this.fragment.color=n}else this.fragment.color=void 0}blendAfterColors(){let e=new cM("outgoingLight","f"),t=this.layers.findIndex((e=>e instanceof vP));if(this.layers.length>t+1){for(let n=t+1;n<this.layers.length;++n){let t=this.layers[n];if(t instanceof mP){if(t.isMask.value)continue;e=new HM(e,t.color,t.alpha,t.mode)}}this.fragment.afterColor=e}else this.fragment.afterColor=void 0}blendPositions(){let e=this.layers.filter((e=>e instanceof gP));if(e.length>0){let t=e[0].position;for(let n=1;n<e.length;++n)e[n]&&(t=new fM(t,e[n].position,fM.ADD),t=new fM(t,new uM(.5).setReadonly(!0),fM.MUL));this.fragment.position=t}else this.fragment.position=void 0}getDefines(){return this.defines}getUniforms(){return this.uniforms}getVertexShader(){return this.vertexShader}getFragmentShader(){return this.fragmentShader}onBeforeCompile(e){this.shapeBlendhack&&this.shapeBlendhack(this),e.uniforms=this.uniforms,e.vertexShader=this.vertexShader,e.fragmentShader=this.fragmentShader,e.extensionDerivatives=!0===this.extensions.derivatives,e.extensionFragDepth=!0===this.extensions.fragDepth,e.extensionDrawBuffers=!0===this.extensions.drawBuffers,e.extensionShaderTextureLOD=!0===this.extensions.shaderTextureLOD}clampUniformsForPreview(e,t){let n=(e,t,n)=>Math.min(Math.max(e,t),n);for(let i of this.layers)if("displace"===i.type){let r=n(i.uniforms["f".concat(i.id,"_intensity")].value,e,t);i.uniforms["f".concat(i.id,"_intensity")].value=r}}updateFrame(e){for(let t=0;t<this.updaters.length;++t)e.updateNode(this.updaters[t])}build(){let e=new OM;e.needsJitter=this.needsJitter,this.lights=this.lightLayer.data.visible,e.build(this.fragment,this.fragment),this.vertexShader=e.getCode("vertex"),this.fragmentShader=e.getCode("fragment"),this.defines=e.defines,this.uniforms=e.uniforms,this.extensions=e.extensions,this.updaters=e.updaters;for(let t of this.flavors)t&&t.updateAfterBuild();return this.shadersPatchedForShapeBlend=!1,this}nodeMaterialDispose(){this.layers.forEach((e=>e.dispose())),super.dispose();for(let e of this.flavors)e&&e.dispose()}assetsLoaded(){for(let e of this.layers)if(e instanceof mP){let t=e.params.texture;if(t instanceof NM&&!t.image.loaded)return!1}return!0}};Object.defineProperties(wP.prototype,{properties:{get:function(){return this.fragment.properties}}});var EP=class extends _P{constructor(e,t,n){super(e,t,!1),this.uuid=n,this.allowVariableSaves=!0,this.saveVariableLocations(t)}},AP=new Map;function CP(e){if("string"==typeof e)return e;let t=AP.get(e);return t||(t={url:URL.createObjectURL(new Blob([e]))},AP.set(e,t)),t.url}var MP,TP,PP,DP=new Promise((e=>{MP=e})),OP=!1;function IP(){if(!OP)return TP||(TP=async function(){await n.e(519).then(n.bind(n,519)),MP(void 0!==window?window:global),OP=!0}())}function RP(e){let t=!1;return e.scene.objects.traverse(((e,n)=>{if(void 0===n.events||!1===Array.isArray(n.events))return!0;let i=[];n.events.forEach((e=>{"dragDropActions"in e.data?(i.push(...e.data.dragDropActions.drag),i.push(...e.data.dragDropActions.drop)):"inActions"in e.data?(i.push(...e.data.inActions),i.push(...e.data.outActions)):"gameActions"in e.data?(i.push(...e.data.gameActions.idle),i.push(...e.data.gameActions.move),i.push(...e.data.gameActions.jump),i.push(...e.data.gameActions.run)):"breakpoints"in e.data?e.data.breakpoints.forEach((e=>{i.push(...e.data.actions)})):"actions"in e.data&&i.push(...e.data.actions),t=t||i.some((e=>"Audio"===e.data.type))}))})),t}DP.then((e=>PP=e));var kP,LP,BP=class{constructor(e){let t,{src:n,volume:i,delay:r,loop:s}=e;this._volume=1,this.delay=0,this._loop=1,this.loopsRemaining=0,this._status="stopped",this.onEnd=()=>{this.loopsRemaining===1/0?this.replay():this.loopsRemaining>1?(this.replay(),this.loopsRemaining--):(this._status="stopped",this.loopsRemaining=this._loop)},t="string"==typeof n?{src:n}:{src:CP(n),format:"wav"},this.sound=new PP.Howl(t),this.sound.on("end",this.onEnd),this.src=n,void 0!==i&&(this.volume=i),void 0!==r&&(this.delay=r),void 0!==s&&(this.loop=s)}get status(){return this._status}get volume(){return this._volume}set volume(e){this._volume=e,this.sound.volume(e)}get loop(){return this._loop}set loop(e){this._loop=e,this.loopsRemaining=e}replay(){this.clearDelay(),this.delayTimerId=window.setTimeout((()=>{this.sound.play(),this.clearDelay()}),this.delay)}fade(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e3;e?(this.sound.volume(this._volume),this.clearFade(),this.fadeTimerId=window.setTimeout((()=>{this.sound.fade(this._volume,0,t),this.clearFade()}),e)):this.sound.fade(this._volume,0,t)}on(e,t,n){this.sound.on(e,t,n)}off(e,t,n){this.sound.off(e,t,n)}play(){"playing"===this._status||this.sound.playing()||("paused"===this._status?(0===this.sound.seek()?this.replay():this.sound.play(),this._status="playing"):"stopped"===this._status&&(this.replay(),this._status="playing"))}pause(){"playing"===this._status&&(this.sound.pause(),this.clearFade(),this.clearDelay(),this._status="paused")}stop(){this.sound.stop(),this.loopsRemaining=this._loop,this.clearFade(),this.clearDelay(),this._status="stopped"}clearFade(){this.fadeTimerId&&(clearTimeout(this.fadeTimerId),delete this.fadeTimerId)}clearDelay(){this.delayTimerId&&(clearTimeout(this.delayTimerId),delete this.delayTimerId)}dispose(){this.off(),this.stop(),this.clearFade(),this.clearDelay()}},zP=class{constructor(){this.type="ShapePath",this.color=new Et,this.subPaths=[],this.currentPath=null}moveTo(e,t){return this.currentPath=new bo,this.subPaths.push(this.currentPath),this.currentPath.moveTo(e,t),this}lineTo(e,t){var n;return null!==(n=this.currentPath)&&void 0!==n&&n.lineTo(e,t),this}quadraticCurveTo(e,t,n,i){var r;return null!==(r=this.currentPath)&&void 0!==r&&r.quadraticCurveTo(e,t,n,i),this}bezierCurveTo(e,t,n,i,r,s){var a;return null!==(a=this.currentPath)&&void 0!==a&&a.bezierCurveTo(e,t,n,i,r,s),this}splineThru(e){var t;return null!==(t=this.currentPath)&&void 0!==t&&t.splineThru(e),this}toShapes(){let e=0,t=1,n=2,i=3,r=4,s=5,a=6,o={loc:e,t:0};function l(t,i,r,s){let a=t.x,l=i.x,h=r.x,u=s.x,d=t.y,p=i.y,f=r.y,m=s.y,g=(u-h)*(d-f)-(m-f)*(a-h),v=(m-f)*(l-a)-(u-h)*(p-d),y=g/v,b=((l-a)*(d-f)-(p-d)*(a-h))/v;if(0===v&&0!==g||y<=0||y>=1||b<0||b>1)return null;if(0===g&&0===v){for(let h=0;h<2;h++){if(c(0===h?r:s,t,i),o.loc===e){let e=0===h?r:s;return{x:e.x,y:e.y,t:o.t}}if(o.loc===n){return{x:+(a+o.t*(l-a)).toPrecision(10),y:+(d+o.t*(p-d)).toPrecision(10),t:o.t}}}return null}for(let n=0;n<2;n++)if(c(0===n?r:s,t,i),o.loc===e){let e=0===n?r:s;return{x:e.x,y:e.y,t:o.t}}return{x:+(a+y*(l-a)).toPrecision(10),y:+(d+y*(p-d)).toPrecision(10),t:y}}function c(l,c,h){let u,d=h.x-c.x,p=h.y-c.y,f=l.x-c.x,m=l.y-c.y,g=d*m-f*p;return l.x===c.x&&l.y===c.y?(o.loc=e,void(o.t=0)):l.x===h.x&&l.y===h.y?(o.loc=t,void(o.t=1)):void(g<-Number.EPSILON?o.loc=i:g>Number.EPSILON?o.loc=r:d*f<0||p*m<0?o.loc=s:Math.sqrt(d*d+p*p)<Math.sqrt(f*f+m*m)?o.loc=a:(u=0!==d?f/d:m/p,o.loc=n,o.t=u))}function h(e,t,n){let i=new ot;t.getCenter(i);let r=[];return n.forEach((t=>{t.boundingBox.containsPoint(i)&&function(e,t){let n=[],i=[];for(let r=1;r<e.length;r++){let s=e[r-1],a=e[r];for(let e=1;e<t.length;e++){let r=l(s,a,t[e-1],t[e]);null!==r&&void 0===n.find((e=>e.t<=r.t+Number.EPSILON&&e.t>=r.t-Number.EPSILON))&&(n.push(r),i.push(new ot(r.x,r.y)))}}return i}(e,t.points).forEach((e=>{r.push({identifier:t.identifier,isCW:t.isCW,point:e})}))})),r.sort(((e,t)=>e.point.x-t.point.x)),r}let u=0,d=999999999,p=-999999999,f=[];this.subPaths.forEach((e=>{let t=e.getPoints(),n=-999999999,i=999999999,r=-999999999,s=999999999;for(let a=0;a<t.length;a++){let e=t[a];e.y>n&&(n=e.y),e.y<i&&(i=e.y),e.x>r&&(r=e.x),e.x<s&&(s=e.x)}p<=r&&(p=r+1),d>=s&&(d=s-1),t.length&&f.push({curves:e.curves,points:t,isCW:Zo.isClockWise(t),identifier:u++,boundingBox:new xc(new ot(s,i),new ot(r,n))})}));let m=f.map((e=>{var t;return function(e,t,n,i,r){(null==r||""===r)&&(r="nonzero");let s=new ot;e.boundingBox.getCenter(s);let a=h([new ot(n,s.y),new ot(i,s.y)],e.boundingBox,t);a.sort(((e,t)=>e.point.x-t.point.x));let o=[],l=[];a.forEach((t=>{t.identifier===e.identifier?o.push(t):l.push(t)}));let c=o[0].point.x,u=[],d=0;for(;d<l.length&&l[d].point.x<c;)u.length>0&&u[u.length-1]===l[d].identifier?u.pop():u.push(l[d].identifier),d++;if(u.push(e.identifier),"evenodd"===r){let t=u.length%2===0,n=u[u.length-2];return{identifier:e.identifier,isHole:t,for:n}}if("nonzero"===r){let n=!0,i=null,r=null;for(let e=0;e<u.length;e++){let s=u[e];t[s]&&(n?(r=t[s].isCW,n=!1,i=s):r!==t[s].isCW&&(r=t[s].isCW,n=!0))}return{identifier:e.identifier,isHole:n,for:i}}console.warn('fill-rule: "'+r+'" is currently not implemented.')}(e,f,d,p,null===(t=this.userData)||void 0===t?void 0:t.style.fillRule)})),g=[];return f.forEach((e=>{let t=m[e.identifier];if(t&&!t.isHole){let t=new Ao;t.curves=e.curves,m.filter((t=>(null===t||void 0===t?void 0:t.isHole)&&t.for===e.identifier)).forEach((e=>{if(e){let n=f[e.identifier],i=new bo;i.curves=n.curves,t.holes.push(i)}})),g.push(t)}})),g}},NP=!1,FP=new Promise((e=>{kP=e})),UP=!1;function jP(){if(NP=!0,!UP)return LP||(LP=async function(){let e=await n.e(946).then(n.bind(n,946));kP(e),UP=!0}(),LP)}var VP=new class{async load(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{},{load:i}=await FP;i(e,((e,i)=>{e||!i?n(null!==e&&void 0!==e?e:"Something went wrong"):t(i)}))}async parse(e){let{parse:t,Bidi:n}=await FP;try{let i=t(e),r=new n,s=e=>i.charToGlyphIndex(e.char);return r.registerModifier("glyphIndex",null,s),r.applyFeatures(i,i.defaultRenderOptions.features),{font:i,bidi:r}}catch(NZ){console.error(NZ)}}};async function GP(e){let t,n,i=!1;if(e.url?(t=await async function(e){return await(await fetch(e)).arrayBuffer()}(e.url),n=e.url,i=e.url.startsWith("/")):e.data&&(t=e.data.buffer.slice(e.data.byteOffset,e.data.byteOffset+e.data.byteLength)),t){if(!NP)return{font:void 0,url:n,intercepted:i,arr:t,bidi:null};{let e=await VP.parse(t);if(e)return{font:e.font,url:n,intercepted:i,arr:t,bidi:e.bidi}}}}function HP(e,t){return t.state.glyphIndex===e||t.state.fina===e||t.state.medi===e||t.state.init===e}var WP=class{constructor(e){var t;this._arrayBuffer=new ArrayBuffer(1),this._isLoaded=!1,this._intercepted=!1,this._isUserFont=null!==(t=e.isUserFont)&&void 0!==t&&t,this._loadingPromise=GP(e).then((e=>{e&&(this._arrayBuffer=e.arr,this._url=e.url,this.font=e.font,this._intercepted=e.intercepted,this._isLoaded=!0,this._bidi=e.bidi)}))}update(e){var t;this._isLoaded=!1,this._isUserFont=null!==(t=e.isUserFont)&&void 0!==t&&t,this._loadingPromise=GP(e).then((e=>{e&&(this._arrayBuffer=e.arr,this._url=e.url,this.font=e.font,this._intercepted=e.intercepted,this._isLoaded=!0,this._bidi=e.bidi)}))}get url(){return this._url}get intercepted(){return this._intercepted}get isLoaded(){return this._isLoaded}get loadingPromise(){return this._loadingPromise}reverseLigaturesTable(e,t,n){if(!this._bidi)return[];let i=this._bidi;i.getTextGlyphs(t);let r=i.tokenizer.tokens,s=[],a=0,o=n.length===r.length;for(let l=0;l<n.length;l++){let i=n[l].index,c=String.fromCharCode(n[l].unicode),h=r[a];if(HP(i,h)||o)s.push({char:c,index:i,replacements:[h.state.glyphIndex],replacementChars:[h.char]}),a++;else{let n=h.char,r="",o=[h.state.glyphIndex],l=[],u=!1;for(;!u;)a++,r=t.charAt(a),n+=r,o.push(e.charToGlyphIndex(r)),l=e.stringToGlyphs(n),1===l.length&&l[0].index===i&&(u=!0),a>t.length&&(u=!0);s.push({char:c,index:i,replacements:o,replacementChars:Array.from(n)}),a++}}return s}generateShapes(e,t){if(!this._isLoaded)return;let n,i=this.font,r=t.fontSize/this.unitsPerEm,s=t.fontSize*t.lineHeight,a=e.map((e=>this.getTextWidth(e,t))),o=t.width,l=this.getCharWidth("\n",t),c=1===t.horizontalAlign?l:0,h=this.computeSpaceWidthForLine(e,0,t),u=this.getLineInitialOffsetX(a[0],o,t.horizontalAlign,e[0],l),d=this.getLineInitialOffsetY(s,e.length,t.height,r,t.verticalAlign),p=[],f=e.map((e=>[])),m=e.map((e=>[]));for(let v=0;v<e.length;v++){let g=e[v],y={features:{liga:!0}},b=[];try{b=i.stringToGlyphs(g,y)}catch(nJ){console.warn(nJ)}u=this.getLineInitialOffsetX(a[v],o,t.horizontalAlign,g,l);let x=[];try{x=this.reverseLigaturesTable(i,g,b)}catch(nJ){console.warn(nJ)}h=this.computeSpaceWidthForLine(e,v,t);for(let e=0;e<b.length;e++){let s=b[e],a=0===s.index?"\n":s.unicode?String.fromCharCode(s.unicode):void 0,o=x[e],l=0,g=0;0===e&&2===t.horizontalAlign&&void 0!==s.leftSideBearing&&(g=-s.leftSideBearing*r),n&&(l=i.getKerningValue(s,n)*r),u+=g+l;let y=0;if("\n"===a)y=c;else if(" "===a)y=h;else{let e=this.createPath(s,r,u,d,t);e&&(y=e.offsetX-(l+g),p.push(e.path))}if(1===o.replacements.length)m[v].push([u,d]),f[v].push(y);else{let e=o.replacements.map((e=>{var t;return(null!==(t=i.glyphs.get(e).advanceWidth)&&void 0!==t?t:0)*r})),t=e.reduce(((e,t)=>e+t),0),n=e.map((e=>e/t)),s=u;for(let i=0;i<n.length;i++){let e=y*n[i];m[v].push([s,d]),f[v].push(e),s+=e}}u+=y,n=s}d-=s}let g=[];for(let v=0,y=p.length;v<y;v++)g.push(...p[v].toShapes());return{shapes:g,charWidths:f,lineWidths:a,charCoords:m}}get isUserFont(){return this._isUserFont}get arrayBuffer(){return this._arrayBuffer}get ascender(){var e,t;return null!==(e=null===(t=this.font)||void 0===t?void 0:t.ascender)&&void 0!==e?e:0}get descender(){var e,t;return null!==(e=null===(t=this.font)||void 0===t?void 0:t.descender)&&void 0!==e?e:0}get familyName(){var e,t;return null!==(e=null===(t=this.font)||void 0===t?void 0:t.names.fontFamily)&&void 0!==e?e:""}get subfamilyName(){var e,t;return null!==(e=null===(t=this.font)||void 0===t?void 0:t.names.fontSubfamily)&&void 0!==e?e:""}get unitsPerEm(){var e,t;return null!==(e=null===(t=this.font)||void 0===t?void 0:t.unitsPerEm)&&void 0!==e?e:1}getLineInitialOffsetX(e,t,n,i,r){return(3===n||2===n)&&i.indexOf("\n")>=0&&(e-=r),3===n?.5*t-.5*e:2===n?t-e:0}getLineInitialOffsetY(e,t,n,i,r){let s=t*e,a=e-Math.abs(this.ascender-this.descender)*i,o=-this.ascender*i-a/2;return 3===r?-(n-s-o):2===r?-(.5*n-.5*s-o):o}createPath(e,t,n,i,r){var s;let a=e.getPath(n,-i,r.fontSize,{kerning:!1,letterSpacing:r.letterSpacing});if(!a)return void console.error('THREE.Font: character "'+e+'" does not exists in font family '+this.familyName+".");let o=new zP,l=(null!==(s=e.advanceWidth)&&void 0!==s?s:1)*t;if(e)for(let h of a.commands){var c;let e=null===(c=o.currentPath)||void 0===c?void 0:c.currentPoint;if(!e||"Z"===h.type||e.x!==h.x||-e.y!==h.y)switch(h.type){case"M":o.moveTo(h.x,-h.y);break;case"L":o.lineTo(h.x,-h.y);break;case"Q":o.quadraticCurveTo(h.x1,-h.y1,h.x,-h.y);break;case"C":o.bezierCurveTo(h.x1,-h.y1,h.x2,-h.y2,h.x,-h.y)}}return o.subPaths.forEach((e=>{let t=function(e){if(e.length){let t=e[0];if(t instanceof po)return t.v1;if(t instanceof ho||t instanceof mo)return t.v0}}(e.curves);void 0!==t&&e.currentPoint.distanceTo(t)>0&&e.lineTo(t.x,t.y)})),{offsetX:l+r.fontSize*r.letterSpacing,path:o}}getCharWidth(e,t){var n,i;return null!==(n=null===(i=this.font)||void 0===i?void 0:i.getAdvanceWidth(e,t.fontSize,{kerning:!0,letterSpacing:t.letterSpacing}))&&void 0!==n?n:0}getTextWidth(e,t){var n,i;return null!==(n=null===(i=this.font)||void 0===i?void 0:i.getAdvanceWidth(e,t.fontSize,{kerning:!0,letterSpacing:t.letterSpacing}))&&void 0!==n?n:0}computeSpaceWidthForLine(e,t,n){let i=this.getCharWidth(" ",n),r=e[t];if(r){let s=this.countSpaces(r.trimEnd());if(4===n.horizontalAlign&&t<e.length-1&&s){return(n.width-(this.getTextWidth(r,n)-s*i))/s}}return i}countSpaces(e){return(e.match(/ /g)||[]).length}};var qP=class{constructor(){this.objects=new Map,this.unreachable=new Set}getCached(e){return this.objects.get(e)}get size(){return this.objects.size}get(e,t,n){let i=this.objects.get(e);return void 0===i?(i=this.createObject(e,t,n),this.objects.set(e,i)):i.isShared=!0,i}forceDelete(e){let t=this.objects.get(e);t&&(this.disposeObject(t),this.objects.delete(e))}mutateIfUnique(e,t){let n=this.objects.get(e);if(n&&!0!==n.isShared)return this.objects.delete(e),this.objects.set(t,n),n}startGc(){this.unreachable=new Set(this.objects.keys())}markAsReachable(e,t){t===this.objects.get(e)&&this.unreachable.delete(e)}endGc(){this.unreachable.forEach((e=>{this.disposeObject(this.objects.get(e)),this.objects.delete(e)})),this.unreachable.clear()}dispose(){this.objects.forEach((e=>{this.disposeObject(e)})),this.objects.clear()}},XP=class extends qP{constructor(e){super(),this.flatShading=e}disposeObject(e){e.dispose()}createObject(e,t,n){let i=eC(e,t,this.flatShading,n);return i.computeBoundingSphere(),i}},YP={markNeedsUpdateRendererDirty:()=>{}},QP=1e3,KP=512e3;var ZP="https://hooks.spline.design",JP="".concat(ZP,"/events?hashFile="),$P=("".concat(ZP,"/"),class{constructor(e,t){this.id=e,this.userWebhook=t,this.result=void 0,this._connected=!1,this.emitter=OA(),this.reconnectWaitFor=QP,this._onError=e=>{var t,n,i;null!==(t=this.eventSource)&&void 0!==t&&t.removeEventListener("message",this._onMessage),null!==(n=this.eventSource)&&void 0!==n&&n.removeEventListener("error",this._onError),null!==(i=this.eventSource)&&void 0!==i&&i.removeEventListener("open",this._onConnected),this._scheduleReconnect()},this._onConnected=e=>{clearTimeout(this.scheduledReconnectHandle),this.reconnectWaitFor=QP,this._connected=!0},this._onDisconnected=()=>{clearTimeout(this.scheduledReconnectHandle),this.reconnectWaitFor=QP,this._connected=!1},this._onMessage=e=>{let t,n=e.data;try{t=JSON.parse(n)}catch(NZ){console.error("Error parsing webhook message",NZ)}if(t){let e=!1;this.userWebhook.parametersSchemas.forEach((n=>{let{data:i}=n;void 0!==t[i.name]&&function(e,t){let n=typeof e;return!!(("string"===t||"number"===t)&&n===t||"boolean"===t&&("true"===e||"false"===e||!0===e||!1===e)||"image"===t&&"string"===n&&e.startsWith("http"))}(t[i.name],i.type)&&(void 0===this.result&&(this.result={}),this.result[i.name]=t[i.name],e=!0)})),e&&this.emitter.emit("message",{userWebhookId:this.id})}}}connect(){clearTimeout(this.scheduledReconnectHandle),this.userWebhook.url&&(this.eventSource=new EventSource(JP+this.userWebhook.url),this.eventSource.addEventListener("message",this._onMessage),this.eventSource.addEventListener("error",this._onError),this.eventSource.addEventListener("open",this._onConnected))}disconnect(){var e,t,n,i;null!==(e=this.eventSource)&&void 0!==e&&e.removeEventListener("message",this._onMessage),null!==(t=this.eventSource)&&void 0!==t&&t.removeEventListener("error",this._onError),null!==(n=this.eventSource)&&void 0!==n&&n.removeEventListener("open",this._onConnected),null!==(i=this.eventSource)&&void 0!==i&&i.close(),this._onDisconnected(),clearTimeout(this.scheduledReconnectHandle)}_scheduleReconnect(){this.reconnectWaitFor*=2,this.reconnectWaitFor>KP&&(this.reconnectWaitFor=KP),clearTimeout(this.scheduledReconnectHandle),this.scheduledReconnectHandle=setTimeout((()=>{this.scheduledReconnectHandle=void 0,this.connect()}),this.reconnectWaitFor)}update(e){this.userWebhook=e}dispose(){this._connected&&this.disconnect()}get connected(){return this._connected}on(e,t){this.emitter.on(e,t)}off(e,t){this.emitter.off(e,t)}getParametersKeys(){return this.userWebhook.parametersSchemas.map((e=>e.data.name))}getParameterValue(e){if(this.getParametersKeys().includes(e)){var t;if(this.result)return null===(t=this.result)||void 0===t?void 0:t[e];for(let t of this.userWebhook.parametersSchemas)if(t.data.name===e)return gx.defaultParameterValueByType(t.data.type)}}}),eD=globalThis.atob,tD=globalThis.btoa,nD=class{static floatTo16BitPCM(e){let t=new ArrayBuffer(2*e.length),n=new DataView(t),i=0;for(let r=0;r<e.length;r++,i+=2){let t=Math.max(-1,Math.min(1,e[r]));n.setInt16(i,t<0?32768*t:32767*t,!0)}return t}static base64ToArrayBuffer(e){let t=eD(e),n=t.length,i=new Uint8Array(n);for(let r=0;r<n;r++)i[r]=t.charCodeAt(r);return i.buffer}static arrayBufferToBase64(e){e instanceof Float32Array?e=this.floatTo16BitPCM(e):e instanceof Int16Array&&(e=e.buffer);let t="",n=new Uint8Array(e);for(let i=0;i<n.length;i+=32768){let e=n.subarray(i,i+32768);t+=String.fromCharCode.apply(null,e)}return tD(t)}static mergeInt16Arrays(e,t){if(e instanceof ArrayBuffer&&(e=new Int16Array(e)),t instanceof ArrayBuffer&&(t=new Int16Array(t)),!(e instanceof Int16Array)||!(t instanceof Int16Array))throw new Error("Both items must be Int16Array");let n=new Int16Array(e.length+t.length);for(let i=0;i<e.length;i++)n[i]=e[i];for(let i=0;i<t.length;i++)n[e.length+i]=t[i];return n}static generateId(e){let t="123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz",n=Array((arguments.length>1&&void 0!==arguments[1]?arguments[1]:21)-e.length).fill(0).map((e=>t[Math.floor(58*Math.random())])).join("");return"".concat(e).concat(n)}},iD=e=>new Promise((t=>setTimeout((()=>t()),e))),rD=class{constructor(){this.eventHandlers={},this.nextEventHandlers={}}clearEventHandlers(){return this.eventHandlers={},this.nextEventHandlers={},!0}on(e,t){return this.eventHandlers[e]=this.eventHandlers[e]||[],this.eventHandlers[e].push(t),t}onNext(e,t){return this.nextEventHandlers[e]=this.nextEventHandlers[e]||[],this.nextEventHandlers[e].push(t),t}off(e,t){let n=this.eventHandlers[e]||[];if(t){let i=n.indexOf(t);if(-1===i)throw new Error('Could not turn off specified event listener for "'.concat(e,'": not found as a listener'));n.splice(i,1)}else delete this.eventHandlers[e];return!0}offNext(e,t){let n=this.nextEventHandlers[e]||[];if(t){let i=n.indexOf(t);if(-1===i)throw new Error('Could not turn off specified next event listener for "'.concat(e,'": not found as a listener'));n.splice(i,1)}else delete this.nextEventHandlers[e];return!0}async waitForNext(e){let t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=Date.now();for(this.onNext(e,(e=>t=e));!t;){if(n&&Date.now()-i>n)return null;await iD(1)}return t}dispatch(e,t){let n=[].concat(this.eventHandlers[e]||[]);for(let r of n)r(t);let i=[].concat(this.nextEventHandlers[e]||[]);for(let r of i)r(t);return delete this.nextEventHandlers[e],!0}},sD=class extends rD{constructor(){let{url:e,apiKey:t,dangerouslyAllowAPIKeyInBrowser:n,debug:i}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(super(),this.defaultUrl="wss://api.openai.com/v1/realtime",this.url=e||this.defaultUrl,this.apiKey=t||null,this.debug=!!i,this.ws=null,globalThis.document&&this.apiKey&&!n)throw new Error('Can not provide API key in the browser without "dangerouslyAllowAPIKeyInBrowser" set to true')}isConnected(){return!!this.ws}log(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];let i=["[Websocket/".concat((new Date).toISOString(),"]")].concat(t).map((e=>"object"==typeof e&&null!==e?JSON.stringify(e,null,2):e));return this.debug&&console.log(...i),!0}async connect(){let{model:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{model:"gpt-4o-realtime-preview-2024-10-01"};if(!this.apiKey&&this.url===this.defaultUrl&&console.warn('No apiKey provided for connection to "'.concat(this.url,'"')),this.isConnected())throw new Error("Already connected");if(globalThis.document){this.apiKey&&console.warn("Warning: Connecting using API key in the browser, this is not recommended");let t=new(0,globalThis.WebSocket)("".concat(this.url).concat(e?"?model=".concat(e):""),["realtime","openai-insecure-api-key.".concat(this.apiKey),"openai-beta.realtime-v1"]);return t.addEventListener("message",(e=>{let t=JSON.parse(e.data);this.receive(t.type,t)})),new Promise(((e,n)=>{let i=()=>{this.disconnect(t),n(new Error('Could not connect to "'.concat(this.url,'"')))};t.addEventListener("error",i),t.addEventListener("open",(()=>{this.log('Connected to "'.concat(this.url,'"')),t.removeEventListener("error",i),t.addEventListener("error",(()=>{this.disconnect(t),this.log('Error, disconnected from "'.concat(this.url,'"')),this.dispatch("close",{error:!0})})),t.addEventListener("close",(()=>{this.disconnect(t),this.log('Disconnected from "'.concat(this.url,'"')),this.dispatch("close",{error:!1})})),this.ws=t,e(!0)}))}))}}disconnect(e){if(!e||this.ws===e)return this.ws&&this.ws.close(),this.ws=null,!0}receive(e,t){return this.log("received:",e,t),this.dispatch("server.".concat(e),t),this.dispatch("server.*",t),!0}send(e,t){if(!this.isConnected())throw new Error("RealtimeAPI is not connected");if("object"!=typeof(t=t||{}))throw new Error("data must be an object");let n=o({event_id:nD.generateId("evt_"),type:e},t);return this.dispatch("client.".concat(e),n),this.dispatch("client.*",n),this.log("sent:",e,n),this.ws.send(JSON.stringify(n)),!0}},aD=class{constructor(){C(this,"defaultFrequency",24e3),C(this,"EventProcessors",{"conversation.item.created":e=>{let{item:t}=e,n=JSON.parse(JSON.stringify(t));if(this.itemLookup[n.id]||(this.itemLookup[n.id]=n,this.items.push(n)),n.formatted={},n.formatted.audio=new Int16Array(0),n.formatted.text="",n.formatted.transcript="",this.queuedSpeechItems[n.id]&&(n.formatted.audio=this.queuedSpeechItems[n.id].audio,delete this.queuedSpeechItems[n.id]),n.content){let e=n.content.filter((e=>["text","input_text"].includes(e.type)));for(let t of e)n.formatted.text+=t.text}return this.queuedTranscriptItems[n.id]&&(n.formatted.transcript=this.queuedTranscriptItems.transcript,delete this.queuedTranscriptItems[n.id]),"message"===n.type?"user"===n.role?(n.status="completed",this.queuedInputAudio&&(n.formatted.audio=this.queuedInputAudio,this.queuedInputAudio=null)):n.status="in_progress":"function_call"===n.type?(n.formatted.tool={type:"function",name:n.name,call_id:n.call_id,arguments:""},n.status="in_progress"):"function_call_output"===n.type&&(n.status="completed",n.formatted.output=n.output),{item:n,delta:null}},"conversation.item.truncated":e=>{let{item_id:t,audio_end_ms:n}=e,i=this.itemLookup[t];if(!i)throw new Error('item.truncated: Item "'.concat(t,'" not found'));let r=Math.floor(n*this.defaultFrequency/1e3);return i.formatted.transcript="",i.formatted.audio=i.formatted.audio.slice(0,r),{item:i,delta:null}},"conversation.item.deleted":e=>{let{item_id:t}=e,n=this.itemLookup[t];if(!n)throw new Error('item.deleted: Item "'.concat(t,'" not found'));delete this.itemLookup[n.id];let i=this.items.indexOf(n);return i>-1&&this.items.splice(i,1),{item:n,delta:null}},"conversation.item.input_audio_transcription.completed":e=>{let{item_id:t,content_index:n,transcript:i}=e,r=this.itemLookup[t],s=i||" ";return r?(r.content[n].transcript=i,r.formatted.transcript=s,{item:r,delta:{transcript:i}}):(this.queuedTranscriptItems[t]={transcript:s},{item:null,delta:null})},"input_audio_buffer.speech_started":e=>{let{item_id:t,audio_start_ms:n}=e;return this.queuedSpeechItems[t]={audio_start_ms:n},{item:null,delta:null}},"input_audio_buffer.speech_stopped":(e,t)=>{let{item_id:n,audio_end_ms:i}=e;this.queuedSpeechItems[n]||(this.queuedSpeechItems[n]={audio_start_ms:i});let r=this.queuedSpeechItems[n];if(r.audio_end_ms=i,t){let e=Math.floor(r.audio_start_ms*this.defaultFrequency/1e3),n=Math.floor(r.audio_end_ms*this.defaultFrequency/1e3);r.audio=t.slice(e,n)}return{item:null,delta:null}},"response.created":e=>{let{response:t}=e;return this.responseLookup[t.id]||(this.responseLookup[t.id]=t,this.responses.push(t)),{item:null,delta:null}},"response.output_item.added":e=>{let{response_id:t,item:n}=e,i=this.responseLookup[t];if(!i)throw new Error('response.output_item.added: Response "'.concat(t,'" not found'));return i.output.push(n.id),{item:null,delta:null}},"response.output_item.done":e=>{let{item:t}=e;if(!t)throw new Error('response.output_item.done: Missing "item"');let n=this.itemLookup[t.id];if(!n)throw new Error('response.output_item.done: Item "'.concat(t.id,'" not found'));return n.status=t.status,{item:n,delta:null}},"response.content_part.added":e=>{let{item_id:t,part:n}=e,i=this.itemLookup[t];if(!i)throw new Error('response.content_part.added: Item "'.concat(t,'" not found'));return i.content.push(n),{item:i,delta:null}},"response.audio_transcript.delta":e=>{let{item_id:t,content_index:n,delta:i}=e,r=this.itemLookup[t];if(!r)throw new Error('response.audio_transcript.delta: Item "'.concat(t,'" not found'));return r.content[n].transcript+=i,r.formatted.transcript+=i,{item:r,delta:{transcript:i}}},"response.audio.delta":e=>{let{item_id:t,content_index:n,delta:i}=e,r=this.itemLookup[t];if(!r)throw new Error('response.audio.delta: Item "'.concat(t,'" not found'));let s=nD.base64ToArrayBuffer(i),a=new Int16Array(s);return r.formatted.audio=nD.mergeInt16Arrays(r.formatted.audio,a),{item:r,delta:{audio:a}}},"response.text.delta":e=>{let{item_id:t,content_index:n,delta:i}=e,r=this.itemLookup[t];if(!r)throw new Error('response.text.delta: Item "'.concat(t,'" not found'));return r.content[n].text+=i,r.formatted.text+=i,{item:r,delta:{text:i}}},"response.function_call_arguments.delta":e=>{let{item_id:t,delta:n}=e,i=this.itemLookup[t];if(!i)throw new Error('response.function_call_arguments.delta: Item "'.concat(t,'" not found'));return i.arguments+=n,i.formatted.tool.arguments+=n,{item:i,delta:{arguments:n}}}}),this.clear()}clear(){return this.itemLookup={},this.items=[],this.responseLookup={},this.responses=[],this.queuedSpeechItems={},this.queuedTranscriptItems={},this.queuedInputAudio=null,!0}queueInputAudio(e){return this.queuedInputAudio=e,e}processEvent(e){if(!e.event_id)throw console.error(e),new Error('Missing "event_id" on event');if(!e.type)throw console.error(e),new Error('Missing "type" on event');let t=this.EventProcessors[e.type];if(!t)throw new Error('Missing conversation event processor for "'.concat(e.type,'"'));for(var n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];return t.call(this,e,...i)}getItem(e){return this.itemLookup[e]||null}getItems(){return this.items.slice()}},oD=class extends rD{constructor(){let{url:e,apiKey:t,dangerouslyAllowAPIKeyInBrowser:n,debug:i}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super(),this.defaultSessionConfig={modalities:["text","audio"],instructions:"",voice:"alloy",input_audio_format:"pcm16",output_audio_format:"pcm16",input_audio_transcription:null,turn_detection:null,tools:[],tool_choice:"auto",temperature:.8,max_response_output_tokens:4096},this.sessionConfig={},this.transcriptionModels=[{model:"whisper-1"}],this.defaultServerVadConfig={type:"server_vad",threshold:.5,prefix_padding_ms:300,silence_duration_ms:200},this.realtime=new sD({url:e,apiKey:t,dangerouslyAllowAPIKeyInBrowser:n,debug:i}),this.conversation=new aD,this._resetConfig(),this._addAPIEventHandlers()}_resetConfig(){return this.sessionCreated=!1,this.tools={},this.sessionConfig=JSON.parse(JSON.stringify(this.defaultSessionConfig)),this.inputAudioBuffer=new Int16Array(0),!0}_addAPIEventHandlers(){var e=this;this.realtime.on("client.*",(e=>{let t={time:(new Date).toISOString(),source:"client",event:e};this.dispatch("realtime.event",t)})),this.realtime.on("server.*",(e=>{let t={time:(new Date).toISOString(),source:"server",event:e};this.dispatch("realtime.event",t)})),this.realtime.on("server.session.created",(()=>this.sessionCreated=!0));let t=function(t){for(var n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];let{item:s,delta:a}=e.conversation.processEvent(t,...i);return{item:s,delta:a}},n=function(n){for(var i=arguments.length,r=new Array(i>1?i-1:0),s=1;s<i;s++)r[s-1]=arguments[s];let{item:a,delta:o}=t(n,...r);return a&&e.dispatch("conversation.updated",{item:a,delta:o}),{item:a,delta:o}},i=async e=>{try{let t=JSON.parse(e.arguments),n=this.tools[e.name];if(!n)throw new Error('Tool "'.concat(e.name,'" has not been added'));let i=await n.handler(t);this.realtime.send("conversation.item.create",{item:{type:"function_call_output",call_id:e.call_id,output:JSON.stringify(i)}})}catch(FZ){this.realtime.send("conversation.item.create",{item:{type:"function_call_output",call_id:e.call_id,output:JSON.stringify({error:FZ.message})}})}this.createResponse()};return this.realtime.on("server.response.created",t),this.realtime.on("server.response.output_item.added",t),this.realtime.on("server.response.content_part.added",t),this.realtime.on("server.input_audio_buffer.speech_started",(e=>{t(e),this.dispatch("conversation.interrupted")})),this.realtime.on("server.input_audio_buffer.speech_stopped",(e=>t(e,this.inputAudioBuffer))),this.realtime.on("server.conversation.item.created",(e=>{let{item:t}=n(e);this.dispatch("conversation.item.appended",{item:t}),"completed"===t.status&&this.dispatch("conversation.item.completed",{item:t})})),this.realtime.on("server.conversation.item.truncated",n),this.realtime.on("server.conversation.item.deleted",n),this.realtime.on("server.conversation.item.input_audio_transcription.completed",n),this.realtime.on("server.response.audio_transcript.delta",n),this.realtime.on("server.response.audio.delta",n),this.realtime.on("server.response.text.delta",n),this.realtime.on("server.response.function_call_arguments.delta",n),this.realtime.on("server.response.output_item.done",(async e=>{let{item:t}=n(e);"completed"===t.status&&this.dispatch("conversation.item.completed",{item:t}),t.formatted.tool&&i(t.formatted.tool)})),!0}isConnected(){return this.realtime.isConnected()}reset(){return this.disconnect(),this.clearEventHandlers(),this.realtime.clearEventHandlers(),this._resetConfig(),this._addAPIEventHandlers(),!0}async connect(){if(this.isConnected())throw new Error("Already connected, use .disconnect() first");return await this.realtime.connect(),this.updateSession(),!0}async waitForSessionCreated(){if(!this.isConnected())throw new Error("Not connected, use .connect() first");for(;!this.sessionCreated;)await new Promise((e=>setTimeout((()=>e()),1)));return!0}disconnect(){this.sessionCreated=!1,this.realtime.isConnected()&&this.realtime.disconnect(),this.conversation.clear()}getTurnDetectionType(){var e;return(null===(e=this.sessionConfig.turn_detection)||void 0===e?void 0:e.type)||null}addTool(e,t){if(null===e||void 0===e||!e.name)throw new Error("Missing tool name in definition");let n=null===e||void 0===e?void 0:e.name;if(this.tools[n])throw new Error('Tool "'.concat(n,'" already added. Please use .removeTool("').concat(n,'") before trying to add again.'));if("function"!=typeof t)throw new Error('Tool "'.concat(n,'" handler must be a function'));return this.tools[n]={definition:e,handler:t},this.updateSession(),this.tools[n]}removeTool(e){if(!this.tools[e])throw new Error('Tool "'.concat(e,'" does not exist, can not be removed.'));return delete this.tools[e],!0}deleteItem(e){return this.realtime.send("conversation.item.delete",{item_id:e}),!0}updateSession(){let{modalities:e,instructions:t,voice:n,input_audio_format:i,output_audio_format:r,input_audio_transcription:s,turn_detection:a,tools:l,tool_choice:c,temperature:h,max_response_output_tokens:u}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};void 0!==e&&(this.sessionConfig.modalities=e),void 0!==t&&(this.sessionConfig.instructions=t),void 0!==n&&(this.sessionConfig.voice=n),void 0!==i&&(this.sessionConfig.input_audio_format=i),void 0!==r&&(this.sessionConfig.output_audio_format=r),void 0!==s&&(this.sessionConfig.input_audio_transcription=s),void 0!==a&&(this.sessionConfig.turn_detection=a),void 0!==l&&(this.sessionConfig.tools=l),void 0!==c&&(this.sessionConfig.tool_choice=c),void 0!==h&&(this.sessionConfig.temperature=h),void 0!==u&&(this.sessionConfig.max_response_output_tokens=u);let d=[].concat((l||[]).map((e=>{let t=o({type:"function"},e);if(this.tools[null===t||void 0===t?void 0:t.name])throw new Error('Tool "'.concat(null===t||void 0===t?void 0:t.name,'" has already been defined'));return t})),Object.keys(this.tools).map((e=>o({type:"function"},this.tools[e].definition)))),p=o({},this.sessionConfig);return p.tools=d,this.realtime.isConnected()&&this.realtime.send("session.update",{session:p}),!0}sendUserMessageContent(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];if(e.length){for(let t of e)"input_audio"===t.type&&(t.audio instanceof ArrayBuffer||t.audio instanceof Int16Array)&&(t.audio=nD.arrayBufferToBase64(t.audio));this.realtime.send("conversation.item.create",{item:{type:"message",role:"user",content:e}})}return this.createResponse(),!0}appendInputAudio(e){return e.byteLength>0&&(this.realtime.send("input_audio_buffer.append",{audio:nD.arrayBufferToBase64(e)}),this.inputAudioBuffer=nD.mergeInt16Arrays(this.inputAudioBuffer,e)),!0}createResponse(){return null===this.getTurnDetectionType()&&this.inputAudioBuffer.byteLength>0&&(this.realtime.send("input_audio_buffer.commit"),this.conversation.queueInputAudio(this.inputAudioBuffer),this.inputAudioBuffer=new Int16Array(0)),this.realtime.send("response.create"),!0}cancelResponse(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!e)return this.realtime.send("response.cancel"),{item:null};if(e){let n=this.conversation.getItem(e);if(!n)throw new Error('Could not find item "'.concat(e,'"'));if("message"!==n.type)throw new Error('Can only cancelResponse messages with type "message"');if("assistant"!==n.role)throw new Error('Can only cancelResponse messages with role "assistant"');this.realtime.send("response.cancel");let i=n.content.findIndex((e=>"audio"===e.type));if(-1===i)throw new Error("Could not find audio on item to cancel");return this.realtime.send("conversation.item.truncate",{item_id:e,content_index:i,audio_end_ms:Math.floor(t/this.conversation.defaultFrequency*1e3)}),{item:n}}}async waitForNextItem(){let e=await this.waitForNext("conversation.item.appended"),{item:t}=e;return{item:t}}async waitForNextCompletedItem(){let e=await this.waitForNext("conversation.item.completed"),{item:t}=e;return{item:t}}},lD=new Blob(["\nclass AudioProcessor extends AudioWorkletProcessor {\n\n  constructor() {\n    super();\n    this.port.onmessage = this.receive.bind(this);\n    this.initialize();\n  }\n\n  initialize() {\n    this.foundAudio = false;\n    this.recording = false;\n    this.chunks = [];\n  }\n\n  /**\n   * Concatenates sampled chunks into channels\n   * Format is chunk[Left[], Right[]]\n   */\n  readChannelData(chunks, channel = -1, maxChannels = 9) {\n    let channelLimit;\n    if (channel !== -1) {\n      if (chunks[0] && chunks[0].length - 1 < channel) {\n        throw new Error(\n          `Channel ${channel} out of range: max ${chunks[0].length}`\n        );\n      }\n      channelLimit = channel + 1;\n    } else {\n      channel = 0;\n      channelLimit = Math.min(chunks[0] ? chunks[0].length : 1, maxChannels);\n    }\n    const channels = [];\n    for (let n = channel; n < channelLimit; n++) {\n      const length = chunks.reduce((sum, chunk) => {\n        return sum + chunk[n].length;\n      }, 0);\n      const buffers = chunks.map((chunk) => chunk[n]);\n      const result = new Float32Array(length);\n      let offset = 0;\n      for (let i = 0; i < buffers.length; i++) {\n        result.set(buffers[i], offset);\n        offset += buffers[i].length;\n      }\n      channels[n] = result;\n    }\n    return channels;\n  }\n\n  /**\n   * Combines parallel audio data into correct format,\n   * channels[Left[], Right[]] to float32Array[LRLRLRLR...]\n   */\n  formatAudioData(channels) {\n    if (channels.length === 1) {\n      // Simple case is only one channel\n      const float32Array = channels[0].slice();\n      const meanValues = channels[0].slice();\n      return { float32Array, meanValues };\n    } else {\n      const float32Array = new Float32Array(\n        channels[0].length * channels.length\n      );\n      const meanValues = new Float32Array(channels[0].length);\n      for (let i = 0; i < channels[0].length; i++) {\n        const offset = i * channels.length;\n        let meanValue = 0;\n        for (let n = 0; n < channels.length; n++) {\n          float32Array[offset + n] = channels[n][i];\n          meanValue += channels[n][i];\n        }\n        meanValues[i] = meanValue / channels.length;\n      }\n      return { float32Array, meanValues };\n    }\n  }\n\n  /**\n   * Converts 32-bit float data to 16-bit integers\n   */\n  floatTo16BitPCM(float32Array) {\n    const buffer = new ArrayBuffer(float32Array.length * 2);\n    const view = new DataView(buffer);\n    let offset = 0;\n    for (let i = 0; i < float32Array.length; i++, offset += 2) {\n      let s = Math.max(-1, Math.min(1, float32Array[i]));\n      view.setInt16(offset, s < 0 ? s * 0x8000 : s * 0x7fff, true);\n    }\n    return buffer;\n  }\n\n  /**\n   * Retrieves the most recent amplitude values from the audio stream\n   * @param {number} channel\n   */\n  getValues(channel = -1) {\n    const channels = this.readChannelData(this.chunks, channel);\n    const { meanValues } = this.formatAudioData(channels);\n    return { meanValues, channels };\n  }\n\n  /**\n   * Exports chunks as an audio/wav file\n   */\n  export() {\n    const channels = this.readChannelData(this.chunks);\n    const { float32Array, meanValues } = this.formatAudioData(channels);\n    const audioData = this.floatTo16BitPCM(float32Array);\n    return {\n      meanValues: meanValues,\n      audio: {\n        bitsPerSample: 16,\n        channels: channels,\n        data: audioData,\n      },\n    };\n  }\n\n  receive(e) {\n    const { event, id } = e.data;\n    let receiptData = {};\n    switch (event) {\n      case 'start':\n        this.recording = true;\n        break;\n      case 'stop':\n        this.recording = false;\n        break;\n      case 'clear':\n        this.initialize();\n        break;\n      case 'export':\n        receiptData = this.export();\n        break;\n      case 'read':\n        receiptData = this.getValues();\n        break;\n      default:\n        break;\n    }\n    // Always send back receipt\n    this.port.postMessage({ event: 'receipt', id, data: receiptData });\n  }\n\n  sendChunk(chunk) {\n    const channels = this.readChannelData([chunk]);\n    const { float32Array, meanValues } = this.formatAudioData(channels);\n    const rawAudioData = this.floatTo16BitPCM(float32Array);\n    const monoAudioData = this.floatTo16BitPCM(meanValues);\n    this.port.postMessage({\n      event: 'chunk',\n      data: {\n        mono: monoAudioData,\n        raw: rawAudioData,\n      },\n    });\n  }\n\n  process(inputList, outputList, parameters) {\n    // Copy input to output (e.g. speakers)\n    // Note that this creates choppy sounds with Mac products\n    const sourceLimit = Math.min(inputList.length, outputList.length);\n    for (let inputNum = 0; inputNum < sourceLimit; inputNum++) {\n      const input = inputList[inputNum];\n      const output = outputList[inputNum];\n      const channelCount = Math.min(input.length, output.length);\n      for (let channelNum = 0; channelNum < channelCount; channelNum++) {\n        input[channelNum].forEach((sample, i) => {\n          output[channelNum][i] = sample;\n        });\n      }\n    }\n    const inputs = inputList[0];\n    // There's latency at the beginning of a stream before recording starts\n    // Make sure we actually receive audio data before we start storing chunks\n    let sliceIndex = 0;\n    if (!this.foundAudio) {\n      for (const channel of inputs) {\n        sliceIndex = 0; // reset for each channel\n        if (this.foundAudio) {\n          break;\n        }\n        if (channel) {\n          for (const value of channel) {\n            if (value !== 0) {\n              // find only one non-zero entry in any channel\n              this.foundAudio = true;\n              break;\n            } else {\n              sliceIndex++;\n            }\n          }\n        }\n      }\n    }\n    if (inputs && inputs[0] && this.foundAudio && this.recording) {\n      // We need to copy the TypedArray, because the `process`\n      // internals will reuse the same buffer to hold each input\n      const chunk = inputs.map((input) => input.slice(sliceIndex));\n      this.chunks.push(chunk);\n      this.sendChunk(chunk);\n    }\n    return true;\n  }\n}\n\nregisterProcessor('audio_processor', AudioProcessor);\n"],{type:"application/javascript"}),cD=URL.createObjectURL(lD),hD=[4186.01,4434.92,4698.63,4978.03,5274.04,5587.65,5919.91,6271.93,6644.88,7040,7458.62,7902.13],uD=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],dD=[],pD=[];for(let n=1;n<=8;n++)for(let e=0;e<hD.length;e++){let t=hD[e];dD.push(t/Math.pow(2,8-n)),pD.push(uD[e]+n)}var fD=[32,2e3],mD=dD.filter(((e,t)=>dD[t]>fD[0]&&dD[t]<fD[1])),gD=pD.filter(((e,t)=>dD[t]>fD[0]&&dD[t]<fD[1])),vD=class{static getFrequencies(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"frequency",r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:-100,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:-30;n||(n=new Float32Array(e.frequencyBinCount),e.getFloatFrequencyData(n));let a,o,l,c=t/2,h=1/n.length*c;if("music"===i||"voice"===i){let e="voice"===i?mD:dD,t=Array(e.length).fill(r);for(let i=0;i<n.length;i++){let r=i*h,s=n[i];for(let n=e.length-1;n>=0;n--)if(r>e[n]){t[n]=Math.max(t[n],s);break}}a=t,o="voice"===i?mD:dD,l="voice"===i?gD:pD}else a=Array.from(n),o=a.map(((e,t)=>h*t)),l=o.map((e=>"".concat(e.toFixed(2)," Hz")));let u=a.map((e=>Math.max(0,Math.min((e-r)/(s-r),1))));return{values:new Float32Array(u),frequencies:o,labels:l}}constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(this.fftResults=[],t){let{length:n,sampleRate:i}=t,r=new OfflineAudioContext({length:n,sampleRate:i}),s=r.createBufferSource();s.buffer=t;let a=r.createAnalyser();a.fftSize=8192,a.smoothingTimeConstant=.1,s.connect(a);let o=1/60,l=n/i,c=e=>{let t=o*e;t<l&&r.suspend(t).then((()=>{let t=new Float32Array(a.frequencyBinCount);a.getFloatFrequencyData(t),this.fftResults.push(t),c(e+1)})),1===e?r.startRendering():r.resume()};s.start(0),c(1),this.audio=e,this.context=r,this.analyser=a,this.sampleRate=i,this.audioBuffer=t}else{let t=new AudioContext,n=t.createMediaElementSource(e),i=t.createAnalyser();i.fftSize=8192,i.smoothingTimeConstant=.1,n.connect(i),i.connect(t.destination),this.audio=e,this.context=t,this.analyser=i,this.sampleRate=this.context.sampleRate,this.audioBuffer=null}}getFrequencies(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"frequency",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-100,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-30,i=null;if(this.audioBuffer&&this.fftResults.length){let e=this.audio.currentTime/this.audio.duration,t=Math.min(e*this.fftResults.length|0,this.fftResults.length-1);i=this.fftResults[t]}return vD.getFrequencies(this.analyser,this.sampleRate,i,e,t,n)}async resumeIfSuspended(){return"suspended"===this.context.state&&await this.context.resume(),!0}},yD=class{static floatTo16BitPCM(e){let t=new ArrayBuffer(2*e.length),n=new DataView(t),i=0;for(let r=0;r<e.length;r++,i+=2){let t=Math.max(-1,Math.min(1,e[r]));n.setInt16(i,t<0?32768*t:32767*t,!0)}return t}static mergeBuffers(e,t){let n=new Uint8Array(e.byteLength+t.byteLength);return n.set(new Uint8Array(e),0),n.set(new Uint8Array(t),e.byteLength),n.buffer}_packData(e,t){return[new Uint8Array([t,t>>8]),new Uint8Array([t,t>>8,t>>16,t>>24])][e]}pack(e,t){if(null===t||void 0===t||!t.bitsPerSample)throw new Error('Missing "bitsPerSample"');if(null===t||void 0===t||!t.channels)throw new Error('Missing "channels"');if(null===t||void 0===t||!t.data)throw new Error('Missing "data"');let{bitsPerSample:n,channels:i,data:r}=t,s=["RIFF",this._packData(1,52),"WAVE","fmt ",this._packData(1,16),this._packData(0,1),this._packData(0,i.length),this._packData(1,e),this._packData(1,e*i.length*n/8),this._packData(0,i.length*n/8),this._packData(0,n),"data",this._packData(1,i[0].length*i.length*n/8),r],a=new Blob(s,{type:"audio/mpeg"});return{blob:a,url:URL.createObjectURL(a),channelCount:i.length,sampleRate:e,duration:r.byteLength/(i.length*e*2)}}},bD=class{constructor(){let{sampleRate:e=44100,outputToSpeakers:t=!1,debug:n=!1}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.scriptSrc=cD,this.sampleRate=e,this.outputToSpeakers=t,this.debug=!!n,this._deviceChangeCallback=null,this._devices=[],this.stream=null,this.processor=null,this.source=null,this.node=null,this.recording=!1,this._lastEventId=0,this.eventReceipts={},this.eventTimeout=5e3,this._chunkProcessor=()=>{},this._chunkProcessorSize=void 0,this._chunkProcessorBuffer={raw:new ArrayBuffer(0),mono:new ArrayBuffer(0)}}static async decode(e){let t,n,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1,r=new AudioContext({sampleRate:arguments.length>1&&void 0!==arguments[1]?arguments[1]:44100});if(e instanceof Blob){if(-1!==i)throw new Error('Can not specify "fromSampleRate" when reading from Blob');n=e,t=await n.arrayBuffer()}else if(e instanceof ArrayBuffer){if(-1!==i)throw new Error('Can not specify "fromSampleRate" when reading from ArrayBuffer');t=e,n=new Blob([t],{type:"audio/wav"})}else{let r,s;if(e instanceof Int16Array){s=e,r=new Float32Array(e.length);for(let t=0;t<e.length;t++)r[t]=e[t]/32768}else if(e instanceof Float32Array)r=e;else{if(!(e instanceof Array))throw new Error('"audioData" must be one of: Blob, Float32Arrray, Int16Array, ArrayBuffer, Array<number>');r=new Float32Array(e)}if(-1===i)throw new Error('Must specify "fromSampleRate" when reading from Float32Array, In16Array or Array');if(i<3e3)throw new Error('Minimum "fromSampleRate" is 3000 (3kHz)');s||(s=yD.floatTo16BitPCM(r));let a={bitsPerSample:16,channels:[r],data:s};n=(new yD).pack(i,a).blob,t=await n.arrayBuffer()}let s=await r.decodeAudioData(t),a=s.getChannelData(0);return{blob:n,url:URL.createObjectURL(n),values:a,audioBuffer:s}}log(){return this.debug&&this.log(...arguments),!0}getSampleRate(){return this.sampleRate}getStatus(){return this.processor?this.recording?"recording":"paused":"ended"}async _event(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(n=n||this.processor,!n)throw new Error("Can not send events without recording first");let i={event:e,id:this._lastEventId++,data:t};n.port.postMessage(i);let r=(new Date).valueOf();for(;!this.eventReceipts[i.id];){if((new Date).valueOf()-r>this.eventTimeout)throw new Error('Timeout waiting for "'.concat(e,'" event'));await new Promise((e=>setTimeout((()=>e(!0)),1)))}let s=this.eventReceipts[i.id];return delete this.eventReceipts[i.id],s}listenForDeviceChange(e){if(null===e&&this._deviceChangeCallback)navigator.mediaDevices.removeEventListener("devicechange",this._deviceChangeCallback),this._deviceChangeCallback=null;else if(null!==e){let t=0,n=[],i=e=>e.map((e=>e.deviceId)).sort().join(","),r=async()=>{let r=++t,s=await this.listDevices();r===t&&i(n)!==i(s)&&(n=s,e(s.slice()))};navigator.mediaDevices.addEventListener("devicechange",r),r(),this._deviceChangeCallback=r}return!0}async requestPermission(){let e=await navigator.permissions.query({name:"microphone"});if("denied"===e.state)window.alert("You must grant microphone access to use this feature.");else if("prompt"===e.state)try{(await navigator.mediaDevices.getUserMedia({audio:!0})).getTracks().forEach((e=>e.stop()))}catch(t){window.alert("You must grant microphone access to use this feature.")}return!0}async listDevices(){if(!navigator.mediaDevices||!("enumerateDevices"in navigator.mediaDevices))throw new Error("Could not request user devices");await this.requestPermission();let e=(await navigator.mediaDevices.enumerateDevices()).filter((e=>"audioinput"===e.kind)),t=e.findIndex((e=>"default"===e.deviceId)),n=[];if(-1!==t){let i=e.splice(t,1)[0],r=e.findIndex((e=>e.groupId===i.groupId));-1!==r&&(i=e.splice(r,1)[0]),i.default=!0,n.push(i)}return n.concat(e)}async begin(e){if(this.processor)throw new Error("Already connected: please call .end() to start a new session");if(!navigator.mediaDevices||!("getUserMedia"in navigator.mediaDevices))throw new Error("Could not request user media");try{let t={audio:!0};e&&(t.audio={deviceId:{exact:e}}),this.stream=await navigator.mediaDevices.getUserMedia(t)}catch(a){throw new Error("Could not start media stream")}let t=new AudioContext({sampleRate:this.sampleRate}),n=t.createMediaStreamSource(this.stream);try{await t.audioWorklet.addModule(this.scriptSrc)}catch(jZ){throw console.error(jZ),new Error("Could not add audioWorklet module: ".concat(this.scriptSrc))}let i=new AudioWorkletNode(t,"audio_processor");i.port.onmessage=e=>{let{event:t,id:n,data:i}=e.data;if("receipt"===t)this.eventReceipts[n]=i;else if("chunk"===t)if(this._chunkProcessorSize){let e=this._chunkProcessorBuffer;this._chunkProcessorBuffer={raw:yD.mergeBuffers(e.raw,i.raw),mono:yD.mergeBuffers(e.mono,i.mono)},this._chunkProcessorBuffer.mono.byteLength>=this._chunkProcessorSize&&(this._chunkProcessor(this._chunkProcessorBuffer),this._chunkProcessorBuffer={raw:new ArrayBuffer(0),mono:new ArrayBuffer(0)})}else this._chunkProcessor(i)};let r=n.connect(i),s=t.createAnalyser();return s.fftSize=8192,s.smoothingTimeConstant=.1,r.connect(s),this.outputToSpeakers&&(console.warn("Warning: Output to speakers may affect sound quality,\nespecially due to system audio feedback preventative measures.\nuse only for debugging"),s.connect(t.destination)),this.source=n,this.node=r,this.analyser=s,this.processor=i,!0}getFrequencies(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"frequency",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-100,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-30;if(!this.processor)throw new Error("Session ended: please call .begin() first");return vD.getFrequencies(this.analyser,this.sampleRate,null,e,t,n)}async pause(){if(!this.processor)throw new Error("Session ended: please call .begin() first");if(!this.recording)throw new Error("Already paused: please call .record() first");return this._chunkProcessorBuffer.raw.byteLength&&this._chunkProcessor(this._chunkProcessorBuffer),this.log("Pausing ..."),await this._event("stop"),this.recording=!1,!0}async record(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:()=>{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:8192;if(!this.processor)throw new Error("Session ended: please call .begin() first");if(this.recording)throw new Error("Already recording: please call .pause() first");if("function"!=typeof e)throw new Error("chunkProcessor must be a function");return this._chunkProcessor=e,this._chunkProcessorSize=t,this._chunkProcessorBuffer={raw:new ArrayBuffer(0),mono:new ArrayBuffer(0)},this.log("Recording ..."),await this._event("start"),this.recording=!0,!0}async clear(){if(!this.processor)throw new Error("Session ended: please call .begin() first");return await this._event("clear"),!0}async read(){if(!this.processor)throw new Error("Session ended: please call .begin() first");return this.log("Reading ..."),await this._event("read")}async save(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.processor)throw new Error("Session ended: please call .begin() first");if(!e&&this.recording)throw new Error("Currently recording: please call .pause() first, or call .save(true) to force");this.log("Exporting ...");let t=await this._event("export");return(new yD).pack(this.sampleRate,t.audio)}async end(){if(!this.processor)throw new Error("Session ended: please call .begin() first");let e=this.processor;this.log("Stopping ..."),await this._event("stop"),this.recording=!1,this.stream.getTracks().forEach((e=>e.stop())),this.log("Exporting ...");let t=await this._event("export",{},e);return this.processor.disconnect(),this.source.disconnect(),this.node.disconnect(),this.analyser.disconnect(),this.stream=null,this.processor=null,this.source=null,this.node=null,(new yD).pack(this.sampleRate,t.audio)}async quit(){return this.listenForDeviceChange(null),this.processor&&await this.end(),!0}},xD=new Blob(["\nclass StreamProcessor extends AudioWorkletProcessor {\n  constructor() {\n    super();\n    this.hasStarted = false;\n    this.hasInterrupted = false;\n    this.outputBuffers = [];\n    this.bufferLength = 128;\n    this.write = { buffer: new Float32Array(this.bufferLength), trackId: null };\n    this.writeOffset = 0;\n    this.trackSampleOffsets = {};\n    this.port.onmessage = (event) => {\n      if (event.data) {\n        const payload = event.data;\n        if (payload.event === 'write') {\n          const int16Array = payload.buffer;\n          const float32Array = new Float32Array(int16Array.length);\n          for (let i = 0; i < int16Array.length; i++) {\n            float32Array[i] = int16Array[i] / 0x8000; // Convert Int16 to Float32\n          }\n          this.writeData(float32Array, payload.trackId);\n        } else if (\n          payload.event === 'offset' ||\n          payload.event === 'interrupt'\n        ) {\n          const requestId = payload.requestId;\n          const trackId = this.write.trackId;\n          const offset = this.trackSampleOffsets[trackId] || 0;\n          this.port.postMessage({\n            event: 'offset',\n            requestId,\n            trackId,\n            offset,\n          });\n          if (payload.event === 'interrupt') {\n            this.hasInterrupted = true;\n          }\n        } else {\n          throw new Error(`Unhandled event \"${payload.event}\"`);\n        }\n      }\n    };\n  }\n\n  writeData(float32Array, trackId = null) {\n    let { buffer } = this.write;\n    let offset = this.writeOffset;\n    for (let i = 0; i < float32Array.length; i++) {\n      buffer[offset++] = float32Array[i];\n      if (offset >= buffer.length) {\n        this.outputBuffers.push(this.write);\n        this.write = { buffer: new Float32Array(this.bufferLength), trackId };\n        buffer = this.write.buffer;\n        offset = 0;\n      }\n    }\n    this.writeOffset = offset;\n    return true;\n  }\n\n  process(inputs, outputs, parameters) {\n    const output = outputs[0];\n    const outputChannelData = output[0];\n    const outputBuffers = this.outputBuffers;\n    if (this.hasInterrupted) {\n      this.port.postMessage({ event: 'stop' });\n      return false;\n    } else if (outputBuffers.length) {\n      this.hasStarted = true;\n      const { buffer, trackId } = outputBuffers.shift();\n      for (let i = 0; i < outputChannelData.length; i++) {\n        outputChannelData[i] = buffer[i] || 0;\n      }\n      if (trackId) {\n        this.trackSampleOffsets[trackId] =\n          this.trackSampleOffsets[trackId] || 0;\n        this.trackSampleOffsets[trackId] += buffer.length;\n      }\n      return true;\n    } else if (this.hasStarted) {\n      this.port.postMessage({ event: 'stop' });\n      return false;\n    } else {\n      return true;\n    }\n  }\n}\n\nregisterProcessor('stream_processor', StreamProcessor);\n"],{type:"application/javascript"}),wD=URL.createObjectURL(xD),SD=class{constructor(){let{sampleRate:e=44100}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.scriptSrc=wD,this.sampleRate=e,this.context=null,this.stream=null,this.analyser=null,this.trackSampleOffsets={},this.interruptedTrackIds={}}async connect(){this.context=new AudioContext({sampleRate:this.sampleRate}),"suspended"===this.context.state&&await this.context.resume();try{await this.context.audioWorklet.addModule(this.scriptSrc)}catch(LZ){throw console.error(LZ),new Error("Could not add audioWorklet module: ".concat(this.scriptSrc))}let e=this.context.createAnalyser();return e.fftSize=8192,e.smoothingTimeConstant=.1,this.analyser=e,!0}getFrequencies(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"frequency",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-100,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-30;if(!this.analyser)throw new Error("Not connected, please call .connect() first");return vD.getFrequencies(this.analyser,this.sampleRate,null,e,t,n)}_start(){let e=new AudioWorkletNode(this.context,"stream_processor");return e.connect(this.context.destination),e.port.onmessage=t=>{let{event:n}=t.data;if("stop"===n)e.disconnect(),this.stream=null;else if("offset"===n){let{requestId:e,trackId:n,offset:i}=t.data,r=i/this.sampleRate;this.trackSampleOffsets[e]={trackId:n,offset:i,currentTime:r}}},this.analyser.disconnect(),e.connect(this.analyser),this.stream=e,!0}add16BitPCM(e){let t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"default";if("string"!=typeof n)throw new Error("trackId must be a string");if(!this.interruptedTrackIds[n]){if(this.stream||this._start(),e instanceof Int16Array)t=e;else{if(!(e instanceof ArrayBuffer))throw new Error("argument must be Int16Array or ArrayBuffer");t=new Int16Array(e)}return this.stream.port.postMessage({event:"write",buffer:t,trackId:n}),t}}async getTrackSampleOffset(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.stream)return null;let t,n=crypto.randomUUID();for(this.stream.port.postMessage({event:e?"interrupt":"offset",requestId:n});!t;)t=this.trackSampleOffsets[n],await new Promise((e=>setTimeout((()=>e()),1)));let{trackId:i}=t;return e&&i&&(this.interruptedTrackIds[i]=!0),t}async interrupt(){return this.getTrackSampleOffset(!0)}},_D=class{constructor(e,t,n){this.data=e,this.id=t,this.shared=n,this.items=[],this.isConnected=!1,this.rafId=0,this.emitter=OA(),this.voice=0,this.frequencies=new Float32Array([0]),this.onRealTimeEvent=e=>{let{time:t,source:n,event:i}=e;"server"===n&&"spline.ready"===i.type?this.onSessionCreated(i):"server"===n&&"session.created"===i.type&&(this.client.createResponse(),this.client.on("realtime.event",this.onRealTimeEvent))},this.onSessionCreated=async e=>{let t=Object.values(this.client.tools).map((e=>o({type:"function"},e.definition)));this.client.realtime.send("spline.tools",{tools:t}),this.client.realtime.send("spline.connect",{}),await this.wavRecorder.record((e=>this.client.isConnected()&&this.client.appendInputAudio(e.mono)))},this.animate=()=>{if(this.rafId=requestAnimationFrame(this.animate),this.isConnected){let e=this.wavStreamPlayer.analyser?this.wavStreamPlayer.getFrequencies("voice"):{values:new Float32Array([0])},t=e.values.reduce(((e,t)=>e+t),0)/e.values.length;this.voice=t,this.frequencies=e.values,this.emitter.emit("voice",{value:t,frequencies:e.values})}},this.client=new oD({url:"https://relayserver.spline.design/?uuidfile="+e.integration.hash}),this.wavRecorder=new bD({sampleRate:24e3}),this.wavStreamPlayer=new SD({sampleRate:24e3})}update(e){this.data=e,this.client=new oD({url:"https://relayserver.spline.design/?uuidfile="+e.integration.hash})}setColorByName(e,t){let n=this.shared.getColorByName(e);if(n){var i;let{id:e}=n,{r:r,g:s,b:a}=null!==(i=CA.hexStringToRgb(t))&&void 0!==i?i:{r:0,g:0,b:0};this.shared.updateColor(e,{r:r/255,g:s/255,b:a/255})}}connect(){if(this.isConnected)return;this.isConnected=!0,this.client.updateSession({turn_detection:{type:"server_vad"}}),this.client.addTool({name:"set_personality_color",description:"returns a color based on the voice personality of the ai assistant. This should be called by the voice assistant each time it is asks to speak differently. If a color cannot be associated to the personality, the color should be a neutral color.",parameters:{type:"object",properties:{color:{type:"string",description:"css hex color string, reflecting the personality"},personality:{type:"string",description:"the personality of the voice assistant"}},required:["color","personality"]}},(e=>{let{color:t}=e;this.setColorByName("Voice Assistant Color",t)}));let e=this.shared.getVariablesNames().join(", ");this.client.addTool({name:"set_variable",description:"Sets a Spline variable value when asked by the user.",parameters:{type:"object",properties:{name:{type:"string",description:"The name of the variable that needs to be set. Here's a list of available variables: ".concat(e,". It the variable does not exist, don't call the function and warn the user about it.")},value:{type:"string",description:"The new value for this variable, should always be a string even for number and boolean variables, assume that the value will be cast to the proper type afterwards."}},required:["name","value","type"]}},(e=>{let{name:t,value:n}=e,i=this.shared.getVariableByName(t);if(i){let e,t=this.shared.getVariable(i.id);e="number"==typeof t?parseFloat(n):"boolean"==typeof t?"true"===n.toLowerCase():{textValue:n},this.shared.updateVariable(i.id,e)}}));let t=this.shared.getColorNames().join(", ");this.client.addTool({name:"set_color",description:"Sets a Spline color asset value when asked by the user.",parameters:{type:"object",properties:{name:{type:"string",description:"The name of the color asset that needs to be set. Here's a list of available color assets: ".concat(t,". It the color asset does not exist, don't call the function and warn the user about it.")},value:{type:"string",description:"css hex color string"}},required:["name","value"]}},(e=>{let{name:t,value:n}=e;this.setColorByName(t,n)}));let n=this.shared.scene,i=[];n.traverseEntity((e=>{e.data.events.forEach((e=>{if("AIAssistantTrigger"===e.data.type){let{description:t}=e.data;i.push(t)}}))})),this.client.addTool({name:"trigger_event",description:"Trigger an event by name, here are the available events, please match what the user is asking for to one of these if it applies, otherwise don't call the function and warn the user.",parameters:{type:"object",properties:{description:{type:"string",description:"The name of the event that needs to be triggered. Here's a list of available events: ".concat(JSON.stringify(i),".")},direction:{type:"string",description:"default is forward, but can be forward or backward. Always set to forward unless the user ask to reverse or cancel the event, then set to backward."}},required:["description","direction"]}},(e=>{let{description:t,direction:n}=e;this.emitter.emit("trigger_event",{description:t,direction:n})})),this.client.on("error",(e=>console.error(e))),this.client.on("conversation.interrupted",(async()=>{let e=await this.wavStreamPlayer.interrupt();if(null!==e&&void 0!==e&&e.trackId){let{trackId:t,offset:n}=e;await this.client.cancelResponse(t,n)}})),this.client.on("conversation.updated",(async e=>{var t;let{item:n,delta:i}=e,r=this.client.conversation.getItems();if(null!==i&&void 0!==i&&i.audio&&this.wavStreamPlayer.add16BitPCM(i.audio,n.id),"completed"===n.status&&null!==(t=n.formatted.audio)&&void 0!==t&&t.length){let e=await bD.decode(n.formatted.audio,24e3,24e3);n.formatted.file=e}this.items=r})),this.animate()}disconnect(){cancelAnimationFrame(this.rafId),this.voice=0,this.isConnected=!1}async start(){try{await this.wavRecorder.end()}catch(e){}await this.wavRecorder.begin(),this.client.on("realtime.event",this.onRealTimeEvent),await this.wavStreamPlayer.connect(),await this.client.connect()}async stop(){try{this.client.off("realtime.event",this.onRealTimeEvent)}catch(kZ){console.error(kZ)}this.client.disconnect(),await this.wavRecorder.end(),await this.wavStreamPlayer.interrupt()}computeAnalysisForListenerEvent(e){if("range"===e.analysis){let t=this.frequencies.slice(...e.analysisRange);return t.reduce(((e,t)=>e+t),0)/t.length}return"single"===e.analysis?this.frequencies[e.analysisSingle]:this.voice}on(e,t){this.emitter.on(e,t)}off(e,t){this.emitter.off(e,t)}};function ED(e){return"variable_"+e}var AD=class extends IT{constructor(e){super(),this.shared=e}create(e){return new RT(e,this.shared)}},CD=class{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(this.data=e,this.needsJitter=n,this.enableLocalStorageForPersistentVariables=i,this.geometryCache=new XP(!0),this.geometryCache2=new XP(!1),this.imageHolderCache=new AD(this),this.thisContext={scene:YP,shared:this},this.deletedMaterial=new EP(Cb.defaultTwoLayerData("phong"),this.thisContext,""),this.deletedImage=new kT(Wx.emptyImage,this),this.deletedVideo=new kT(gb.defaultVideo,this),this.materials={},this.images={},this.uiBuffers={},this.videos={},this.colors={},this.audios={},this.particles={},this.fonts={},this.variables={},this.userAPIs={},this.userWebhooks={},this.mouseProperty=null,this.raycastProperty=null,this.requestRender=()=>{this._requestRender&&this._requestRender()},t.images)for(let[r,s]of Object.entries(t.images))this.addImage(r,s);if(t.videos)for(let[r,s]of Object.entries(t.videos))this.addVideo(r,s);if(t.audios)for(let[r,s]of Object.entries(t.audios))this.addAudio(r,s);if(t.particles)for(let[r,s]of Object.entries(t.particles))this.addParticle(r,s);this.reset(e)}setRequestRender(e){this._requestRender=e}getImageLoadPromises(){return Object.values(this.images).map((e=>e.loadPromise))}setEntityOpContext(e){this.entityOpContext=e}reset(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.data=e,this.resetLib(e.lib);for(let{id:n,data:i}of e.variables)this.addVariableHolder(n,i),t&&this.updateVariableHolder(n,i);for(let[n,i]of Object.entries(e.userAPIs))this.addUserAPI(n,i);for(let[n,i]of Object.entries(e.userWebhooks))this.addUserWebhook(n,i);for(let[n,i]of Object.entries(e.images))this.addImage(n,i);for(let[n,i]of Object.entries(e.videos))this.addVideo(n,i);for(let[n,i]of Object.entries(e.colors))this.addColor(n,i);for(let[n,i]of Object.entries(e.materials))this.addMaterial(n,i);for(let[n,i]of Object.entries(e.audios))this.addAudio(n,i);for(let[n,i]of Object.entries(e.particles))this.addParticle(n,i);for(let[n,i]of Object.entries(e.fonts))this.addFont(n,i)}addMaterial(e,t){if(this.materials[e]){let n=this.materials[e];n.reset(t,this.thisContext),n.dispose()}else{let n=new EP(t,this.thisContext,e);this.materials[e]=n}}deleteMaterial(e){this.materials[e]&&(this.materials[e].nodeMaterialDispose(),delete this.materials[e])}getMaterial(e){return this.materials[e]}getMaterialOrDeletedPlaceholder(e){var t;return null!==(t=this.materials[e])&&void 0!==t?t:this.deletedMaterial}material(e){return"string"==typeof e?this.getMaterialOrDeletedPlaceholder(e):null==e?(console.error("material is undefined or null"),this.deletedMaterial):new _P(e,this.thisContext)}getMaterials(){return this.materials}addImage(e,t){return this.images[e]?(this.onColorOrImageUpdate&&this.onColorOrImageUpdate(),this.images[e].updateSrc(t.data),!0):(this.images[e]=new kT(t,this),!1)}deleteImage(e){let t=this.images[e];t&&(t.dispose(),delete this.images[e])}getDefaultImage(){return this.images.image_0}getImage(e){var t;return null!==(t=this.images[e])&&void 0!==t?t:this.deletedImage}image(e){return"string"==typeof e?this.getImage(e):this.imageHolderCache.load(e)}addUIBuffer(e,t){return this.uiBuffers[e]?(this.onColorOrImageUpdate&&this.onColorOrImageUpdate(),this.uiBuffers[e].updateSrc(t),!0):(this.uiBuffers[e]=new kT(t,this),!1)}uiBuffer(e){return this.uiBuffers[e]}addVideo(e,t){return this.videos[e]?(this.videos[e].updateSrc(t.data),!0):(this.videos[e]=new kT(t,this),!1)}deleteVideo(e){let t=this.videos[e];t&&(t.dispose(),delete this.videos[e])}getVideo(e){var t;return null!==(t=this.videos[e])&&void 0!==t?t:this.deletedVideo}video(e){return"string"==typeof e?this.getVideo(e):this.imageHolderCache.load(e)}addColor(e,t){return this.colors[e]?(this.onColorOrImageUpdate&&this.onColorOrImageUpdate(),"a"in t?this.colors[e].setRGBA(t.r,t.g,t.b,t.a):this.colors[e].setRGBA(t.r,t.g,t.b,1),!0):(this.colors[e]=new lP(t.r,t.g,t.b,"a"in t?t.a:1),!1)}updateColor(e,t){if(this.colors[e]){var n,i,r,s;this.onColorOrImageUpdate&&this.onColorOrImageUpdate();let a=this.colors[e];return this.colors[e].r=null!==(n=t.r)&&void 0!==n?n:a.r,this.colors[e].g=null!==(i=t.g)&&void 0!==i?i:a.g,this.colors[e].b=null!==(r=t.b)&&void 0!==r?r:a.b,this.colors[e].a=null!==(s=t.a)&&void 0!==s?s:a.a,!0}return!1}deleteColor(e){this.colors[e]&&delete this.colors[e]}getColor(e){return this.colors[e]}getColorNames(){return Object.values(this.data.colors).map((e=>e.name))}getColorByName(e){for(let t in this.data.colors)if(this.data.colors[t].name===e)return{color:this.colors[t],id:t}}color(e){let t;if("string"!=typeof e)return new QC(e.r,e.g,e.b,"a"in e?e.a:1);{let n=this.getColor(e);n?t=n:(console.warn("Tried to create color layer params with a color key that does not exist in the assets manager"),t=new QC(0,0,0,0))}return t}addAudio(e,t){this.audios[e]=t}getAudio(e){let t=this.audios[e];if(t instanceof BP)return t;{let n=new BP({src:t.data});return this.audios[e]=n,n}}addParticle(e,t){this.particles[e]=t}getParticle(e){return this.particles[e]}deleteParticle(e){this.particles[e]&&delete this.particles[e]}deleteAudio(e){let t=this.audios[e];t&&(t instanceof BP&&t.dispose(),delete this.audios[e])}addFont(e,t){this.fonts[e]=new WP(t),this.fonts[e].loadingPromise.then((()=>this.requestRender()))}getFont(e){return this.fonts[e]}deleteFont(e){this.fonts[e]&&delete this.fonts[e]}dispose(){Object.keys(this.materials).forEach((e=>this.deleteMaterial(e))),this._requestRender=void 0,Object.values(this.audios).forEach((e=>{e instanceof BP&&e.dispose()})),this.audios={},this.particles={},this.geometryCache.dispose(),this.geometryCache2.dispose()}addVariableHolder(e,t){if(void 0===this.variables[e]){let n=t.value;if(this.enableLocalStorageForPersistentVariables&&t.persistent){let i=localStorage.getItem(ED(e));n=null!==i?JSON.parse(i):t.value}return this.variables[e]={value:n,locations:[],persistent:t.persistent},"dynamicVariableType"in t&&(this.variables[e].dynamicVariablePlayState="Playing",this.variables[e].dynamicVariableToggleIsForward=void 0),!0}return this.variables[e].value=t.value,!1}resetDynamicVariablePlayState(){for(let e in this.variables)void 0!==this.variables[e].dynamicVariablePlayState&&(this.variables[e].dynamicVariablePlayState="Playing",this.variables[e].dynamicVariableToggleIsForward=void 0)}updateVariableHolder(e,t){this.updateVariable(e,t.value)}updateVariable(e,t){if(void 0===this.variables[e])return!1;this.variables[e].value=t,this.enableLocalStorageForPersistentVariables&&this.variables[e].persistent&&localStorage.setItem(ED(e),JSON.stringify(t));let n=t;for(;"string"==typeof n;)n=this.variables[n].value;let i=this.entityOpContext.scene;for(let r=this.variables[e].locations.length-1;r>=0;r--){let t=this.variables[e].locations[r];if("material"===t[0]){let e=t[1],r=n,s={scene:i,shared:this},a=t.slice(2);i.traverseMaterial((t=>{var n;let i=null!==(n=t.root)&&void 0!==n?n:t;i.uuid===e&&i.onVariableUpdate(a,r,s)}));let o=this.materials[e];o&&o.onVariableUpdate(a,r,s)}else{let s=i.find(t[0]);if(void 0===s){this.variables[e].locations.splice(r,1);continue}if("geometry"!==t[1]&&"particles"!==t[1]){for(let e=1;e<t.length-1;e++)s=s[t[e]];"rotation"===t[1]?s[t[t.length-1]]=n*at.DEG2RAD:s[t[t.length-1]]=n}if(s=i.find(t[0]),"ParticleEmitter"===s.type&&s.updateVariableState(n,t),XS.is(s))if("position"===t[1]||"rotation"===t[1]||"scale"===t[1])s.onVariableUpdate();else if("geometry"===t[1]){let e=s;s.component&&(e=s.component);let t=e.dataPatched;e.chooseGeoemtryCache(this).forceDelete(t.geometry),e.createGeometryDelayed(this.entityOpContext),e.onVariableUpdate(!0),e.invalidateDownstreamBooleanData(),e.instances.forEach((e=>{let t=e.dataPatched;e.chooseGeoemtryCache(this).forceDelete(t.geometry),e.createGeometryDelayed(this.entityOpContext),e.onVariableUpdate(!0),e.invalidateDownstreamBooleanData()}))}else"morphTargetInfluences"===t[1]&&s.updateMorphInfluences(t[2],n)}}return this.requestRender(),!0}deleteVariable(e){this.variables[e]&&delete this.variables[e]}getVariable(e,t){if(Array.isArray(e)){var n,i,r,s;if("mouse"===e[0])return null!==(n=null===(i=this.mouseProperty)||void 0===i?void 0:i[e[1]])&&void 0!==n?n:0;if("raycast"===e[0])return null!==(r=null===(s=this.raycastProperty)||void 0===s?void 0:s[e[1]])&&void 0!==r?r:0;let t=this.entityOpContext.scene.find(e[0]);if("width"===e[1]||"height"===e[1]||"depth"===e[1])return t.geometry.userData.parameters[e[1]];for(let n=1;n<e.length;n++)t=t[e[n]];return"rotation"===e[1]&&(t*=at.RAD2DEG),t}for(let o in this.variables){var a;if(void 0===t)break;let e=this.variables[o],n=null===(a=e.locations)||void 0===a?void 0:a.findIndex((e=>Ug.equal(e,t)));void 0!==n&&-1!==n&&e.locations.splice(n,1)}if("string"==typeof e){let n=e,i=e;do{if(i=n,void 0===this.variables[n])break;let e=this.variables[n].value;t&&void 0!==this.variables[i]&&this.variables[i].locations.push(t),n=e}while("string"==typeof n);return n}return e}getVariables(){return this.variables}getVariablesNames(){return this.data.variables.map((e=>e.data.name))}getVariableByName(e){for(let t of this.data.variables)if(t.data.name===e)return{variable:t.data,id:t.id}}getDynamicVariablePlayState(e){var t;return null===(t=this.variables[e])||void 0===t?void 0:t.dynamicVariablePlayState}setDynamicVariablePlayState(e,t){void 0!==this.variables[e]&&(this.variables[e].dynamicVariablePlayState=t)}getDynamicVariableToggleIsForward(e){var t;return null===(t=this.variables[e])||void 0===t?void 0:t.dynamicVariableToggleIsForward}setDynamicVariableToggleIsForward(e,t){void 0!==this.variables[e]&&(this.variables[e].dynamicVariableToggleIsForward=t)}resetLib(e){for(let[t,n]of Object.entries(e.images))this.addImage(t,n.asset);for(let[t,n]of Object.entries(e.audios))this.addAudio(t,n.asset);for(let[t,n]of Object.entries(e.particles))this.addParticle(t,n.asset);for(let[t,n]of Object.entries(e.colors))this.addColor(t,n.asset);for(let[t,n]of Object.entries(e.fonts))this.addFont(t,n.asset);for(let[t,n]of Object.entries(e.materials))this.addMaterial(t,n.asset);for(let[t,n]of Object.entries(e.videos))this.addVideo(t,n.asset);for(let[t,n]of Object.entries(e.variables))this.addVariableHolder(t,n.asset)}updateLibByOp(e,t){"images"===e.path[0]?1===e.path.length&&1===e.type?this.addImage(e.id,e.data.asset):1===e.path.length&&2===e.type&&this.deleteImage(e.id):"videos"===e.path[0]?1===e.path.length&&1===e.type?this.addVideo(e.id,e.data.asset):1===e.path.length&&2===e.type&&this.deleteVideo(e.id):"audios"===e.path[0]?1===e.path.length&&1===e.type?this.addAudio(e.id,e.data.asset):1===e.path.length&&2===e.type&&this.deleteAudio(e.id):"particles"===e.path[0]?1===e.path.length&&1===e.type?this.addParticle(e.id,e.data.asset):1===e.path.length&&2===e.type&&this.deleteParticle(e.id):"colors"===e.path[0]?1===e.path.length&&1===e.type?this.addColor(e.id,e.data.asset):1===e.path.length&&2===e.type&&this.deleteColor(e.id):"materials"===e.path[0]?1===e.path.length&&1===e.type?this.addMaterial(e.id,e.data.asset):1===e.path.length&&2===e.type&&this.deleteMaterial(e.id):"fonts"===e.path[0]?1===e.path.length&&1===e.type?this.addFont(e.id,e.data.asset):1===e.path.length&&2===e.type&&this.deleteFont(e.id):"variables"===e.path[0]?1===e.path.length&&1===e.type?this.addVariableHolder(e.id,e.data.asset):1===e.path.length&&2===e.type&&this.deleteVariable(e.id):"components"===e.path[0]&&t.updateByLibOp(e,this)}updateByOp(e,t,n){if(this.data=t,"images"===e.path[0])2===e.path.length&&0===e.type?e.props.data&&this.getImage(e.path[1]).updateSrc(e.props.data):1===e.path.length&&1===e.type?this.addImage(e.id,e.data):1===e.path.length&&2===e.type&&this.deleteImage(e.id);else if("videos"===e.path[0])2===e.path.length&&0===e.type?e.props.data&&this.getVideo(e.path[1]).updateSrc(e.props.data):1===e.path.length&&1===e.type?this.addVideo(e.id,e.data):1===e.path.length&&2===e.type&&this.deleteVideo(e.id);else if("audios"===e.path[0])2===e.path.length&&0===e.type?e.props.data&&this.addAudio(e.path[1],t.audios[e.path[1]]):1===e.path.length&&1===e.type?this.addAudio(e.id,e.data):1===e.path.length&&2===e.type&&this.deleteAudio(e.id);else if("particles"===e.path[0])2===e.path.length&&0===e.type?e.props.data&&this.addParticle(e.path[1],t.particles[e.path[1]]):1===e.path.length&&1===e.type?this.addParticle(e.id,e.data):1===e.path.length&&2===e.type&&this.deleteParticle(e.id);else if("colors"===e.path[0])2===e.path.length&&0===e.type?this.updateColor(e.path[1],e.props):1===e.path.length&&1===e.type?this.addColor(e.id,e.data):1===e.path.length&&2===e.type&&this.deleteColor(e.id);else if("materials"===e.path[0])1===e.path.length&&1===e.type?this.addMaterial(e.id,e.data):1===e.path.length&&2===e.type?this.deleteMaterial(e.id):e.path.length>1&&this.getMaterial(e.path[1]).updateByOp(vg.drop(e,2),t.materials[e.path[1]],{shared:this,scene:n});else if("fonts"===e.path[0])2===e.path.length&&0===e.type?this.updateFont(e.path[1],e,n):1===e.path.length&&1===e.type?this.addFont(e.id,e.data):1===e.path.length&&2===e.type&&this.deleteFont(e.id);else if("variables"===e.path[0])2===e.path.length&&0===e.type?"value"in e.props?this.updateVariable(e.path[1],e.props.value):"persistent"in e.props&&(this.variables[e.path[1]].persistent=e.props.persistent):1===e.path.length&&4===e.type?this.addVariableHolder(e.id,e.data):1===e.path.length&&5===e.type&&this.deleteVariable(e.id);else if("userAPIs"===e.path[0]){if(1===e.path.length&&1===e.type)this.addUserAPI(e.id,e.data);else if(1===e.path.length&&2===e.type)this.deleteUserAPI(e.id);else if("string"==typeof e.path[1]){let n=t.userAPIs[e.path[1]];if(n){let t=0===e.type&&void 0===e.props.debounce,i=this.getUserAPI(e.path[1]);i instanceof _D?i.update(n):null===i||void 0===i||i.update(n,this,t)}}}else if("userWebhooks"===e.path[0]){if(1===e.path.length&&1===e.type)this.addUserWebhook(e.id,e.data);else if(1===e.path.length&&2===e.type)this.deleteUserWebhook(e.id);else if("string"==typeof e.path[1]){var i;let n=t.userWebhooks[e.path[1]];n&&(null===(i=this.getUserWebhook(e.path[1]))||void 0===i||i.update(n))}}else"lib"===e.path[0]&&this.updateLibByOp(vg.drop(e,1),n)}updateFont(e,t,n){if(t.props.url){let i=this.getFont(e),r=o(o({},this.data.fonts[e]),{},{url:t.props.url});i.update(r),i.loadingPromise.then((()=>this.requestRender())),n.updateFont(e,this)}}addUserAPI(e,t){var n,i;return this.userAPIs[e]?(this.userAPIs[e].update(t,this),!0):(null===(n=this.openAIRealtime)||void 0===n?void 0:n.id)===e?(this.openAIRealtime.update(t),!0):"VoiceAssistant"===(null===(i=t.integration)||void 0===i?void 0:i.type)?(this.openAIRealtime=new _D(t,e,this),!1):(this.userAPIs[e]=new IA(e,t,this),!1)}getUserAPI(e){var t;return(null===(t=this.openAIRealtime)||void 0===t?void 0:t.id)===e?this.openAIRealtime:this.userAPIs[e]}getUserAPIs(){return this.userAPIs}deleteUserAPI(e){let t=this.userAPIs[e];t&&(t.dispose(),delete this.userAPIs[e])}addUserWebhook(e,t){return this.userWebhooks[e]?(this.userWebhooks[e].update(t),!0):(this.userWebhooks[e]=new $P(e,t),!1)}getUserWebhook(e){return this.userWebhooks[e]}getUserWebhooks(){return this.userWebhooks}deleteUserWebhook(e){let t=this.userWebhooks[e];t&&(t.dispose(),delete this.userWebhooks[e])}get scene(){return this.entityOpContext.scene}},MD=(new CD(_x.emptyData()),class extends UC{updateByPatchedOp(e,t,n){if(super.updateByPatchedOp(e,t,n),null!==function(e,t){let n=[];if(t.length!==e.length)return null;for(var i=0;i<e.length;){if("*"===t[i])n.push(e[i]);else if(e[i]!==t[i])return null;i+=1}return n}(e.path,["materials"])&&0===e.type&&Array.isArray(this.material))for(let[i,r]of Object.entries(e.props)){let e=n.shared.material(r);this.material[Number(i)]=e}else if(qg(e.path,["material"])&&this.material instanceof wP)"material"in t&&"string"!=typeof t.material&&this.material.updateByOp(vg.drop(e,1),t.material,n);else if(qg(e.path,["materials","*"])&&Array.isArray(this.material)){let i=e.path[1];if("materials"in t&&i<this.material.length){let r=t.materials[i];"string"!=typeof r&&this.material[i].updateByOp(vg.drop(e,2),r,n)}}}get needsAO(){return void 0!==this.material&&(Array.isArray(this.material)?this.material[0]:this.material).hasAO}updateState(e,t){var n,i;super.updateState(e,t),void 0!==e.castShadow&&(this.castShadow=e.castShadow),void 0!==e.receiveShadow&&(this.receiveShadow=e.receiveShadow);let r,s=this.dataPatched;if("Mesh"===this.dataPatched.type&&this.dataPatched.geometry.shapeBlendNode&&this.layers.set(9),"Mesh"===this.dataPatched.type&&"ShapeBlendGeometry"===this.dataPatched.geometry.type&&(r={resolutionLevel:this.dataPatched.geometry.resolutionLevel,useChildrenColors:this.dataPatched.geometry.useChildrenColors}),"NonParametricGeometry"!==(null===(n=e.geometry)||void 0===n?void 0:n.type)&&"material"in e&&void 0!==e.material&&(this.disposeMaterial(),this.material=t.shared.material(e.material).getFlavor(s.flatShading,s.side,s.wireframe,r),t.scene.markNeedsUpdateRendererDirty()),("NonParametricGeometry"===(null===(i=e.geometry)||void 0===i?void 0:i.type)||"materials"in e)&&("materials"in e&&void 0!==e.materials?(this.disposeMaterial(),this.material=e.materials.map((e=>t.shared.material(e).getFlavor(s.flatShading,s.side,s.wireframe))),t.scene.markNeedsUpdateRendererDirty()):"material"in e&&void 0!==e.material&&(this.disposeMaterial(),this.material=[t.shared.material(e.material).getFlavor(s.flatShading,s.side,s.wireframe)],t.scene.markNeedsUpdateRendererDirty())),void 0!==e.flatShading||void 0!==e.wireframe||void 0!==e.side)if(Array.isArray(this.material))for(let a=0;a<this.material.length;a++)this.material[a]=this.material[a].getFlavor(s.flatShading,s.side,s.wireframe);else this.material=this.material.getFlavor(s.flatShading,s.side,s.wireframe,r)}disposeMaterial(){this.material&&Bm(this.material).forEach((e=>{e instanceof wP&&(e instanceof EP||e.nodeMaterialDispose())}))}dispose(){this.disposeMaterial(),super.dispose()}}),TD=new Bt,PD=new Ot,DD=new Ot,OD=new Bt,ID=new pn,RD=class extends MD{constructor(e,t,n){super(e,t),this.data=t,this.isSkinnedMesh=!1,this.localGeometry=void 0,t.bindMode&&t.bindMatrix&&(this.bindMode=t.bindMode,this.bindMatrix=(new pn).fromArray(t.bindMatrix),this.bindMatrixInverse=new pn)}chooseGeoemtryCache(e){return e.geometryCache}markGeometryAsReachable(e){this.geometryCreateDeleyed instanceof di&&this.chooseGeoemtryCache(e).markAsReachable(this.dataPatched.geometry,this.geometryCreateDeleyed)}get geometry(){if(void 0!==this.localGeometry)return this.localGeometry;if(this.geometryCreateDeleyed instanceof CD){let e=this.geometryCreateDeleyed,t=this.chooseGeoemtryCache(e);this.geometryCreateDeleyed=t.get(this.dataPatched.geometry,e,this)}return this.geometryCreateDeleyed}set geometry(e){this.localGeometry=e}get is2DAndNoDepth(){let e=this.dataPatched.geometry;return Rb.is2DParametricMesh(e.type)&&0===e.depth}get is2DType(){return Rb.is2DParametricMesh(this.geometry.userData.type)}get isNonParametric(){return"NonParametricGeometry"===this.geometry.userData.type}updateByPatchedOp(e,t,n){super.updateByPatchedOp(e,t,n),qg(e.path,["geometry"])&&this.updateByPatchedOpGeometry(vg.drop(e,1),t.geometry,n)}removeInteractionGeometry(e){var t;null!==(t=this.localGeometry)&&void 0!==t&&t.dispose(),this.localGeometry=void 0}updateGeometryInteractions(e,t){this.invalidateDownstreamBooleanData();let n=this.data.geometry.type;if("NonParametricGeometry"===n||"SubdivGeometry"===n){let n,i,r,s=e;if(void 0===this.localGeometry){let e=o(o({},this.data.geometry),s);this.localGeometry=eC(e,t,this.data.flatShading,this)}s.scaleBaked?[n,i,r]=s.scaleBaked:({width:n,height:i,depth:r}=s);let a=this.localGeometry.userData;void 0!==a.sxPrev&&nC(this.localGeometry.attributes,n/a.sxPrev,i/a.syPrev,r/a.szPrev),a.sxPrev=n,a.syPrev=i,a.szPrev=r}else{var i;let n=o(o({},this.data.geometry),e);null!==(i=this.localGeometry)&&void 0!==i&&i.dispose(),this.localGeometry=eC(n,t,this.data.flatShading,this)}}refreshAttachedClonersInteractions(){for(let e of this.attachedSurfaceCloners)e.update()}refreshAttachedCloners(e){for(let t of this.attachedSurfaceCloners)e.scene.addPendingUpdateCloner(t.object)}refreshAttachedPaths(e){for(let t of this.attachedPaths)e.scene.addPendingCommand((()=>t.updateShape()))}createGeometryDelayed(e){this.geometryCreateDeleyed=e.shared,this.refreshAttachedCloners(e),this.refreshAttachedPaths(e)}updateByPatchedOpGeometry(e,t,n){var i;let r=!1;0===e.type&&0===e.path.length&&Object.keys(e.props).includes("scaleBaked")&&this.geometryCreateDeleyed instanceof cC&&this.chooseGeoemtryCache(n.shared).mutateIfUnique(this.geometryCreateDeleyed.data,t)===this.geometryCreateDeleyed&&(r=!0,this.geometryCreateDeleyed.mutateDirectlyScaleBaked(t,e.props.scaleBaked),this.refreshAttachedCloners(n),this.refreshAttachedPaths(n)),r||(null!==(i=n.scene)&&void 0!==i&&i.markGeometryCacheDirty(),this.createGeometryDelayed(n)),this.resetBBoxNeedsUpdate(),this.invalidateDownstreamBooleanData()}updateGeometryOnStateUpdate(e,t){this.createGeometryDelayed(t)}updateState(e,t){void 0!==e.geometry&&this.updateGeometryOnStateUpdate(e.geometry,t);let n=e.morphTargetInfluences;if(n){this.updateMorphTargets(),this.geometry.morphTargetsRelative=!0;for(let{data:{name:e,value:i}}of n)this.updateMorphInfluences(e,t.shared.getVariable(i,[this.uuid,"morphTargetInfluences",e]))}super.updateState(e,t)}updateMorphInfluences(e,t){if(void 0===this.morphTargetDictionary)return;let n=this.morphTargetDictionary[e];void 0!==n&&(this.morphTargetInfluences[n]=t)}updateGeometryGroupsIfNeeded(){var e,t;Array.isArray(this.material)&&0===this.geometry.groups.length&&this.geometry.addGroup(0,Math.max(null!==(e=null===(t=this.geometry.getIndex())||void 0===t?void 0:t.count)&&void 0!==e?e:0,this.geometry.getAttribute("position").count),0)}updateEntityBoxSize(e,t){var n,i;let r=this.geometry.userData.parameters;this.is2DType?e.set(0,0,.5*r.depth):this.isNonParametric?(e.setScalar(0),this.geometry.boundingSphere&&e.copy(this.geometry.boundingSphere.center),t.set(r.width,r.height,null!==(n=r.depth)&&void 0!==n?n:0).multiplyScalar(.5)):r.centerOffset?e.fromArray(r.centerOffset):e.setScalar(0),t.set(r.width,r.height,null!==(i=r.depth)&&void 0!==i?i:0).multiplyScalar(.5)}updateMatrixWorld(e){super.updateMatrixWorld(e),"attached"===this.bindMode?this.bindMatrixInverse.copy(this.matrixWorld).invert():"detached"===this.bindMode&&this.bindMatrixInverse.copy(this.bindMatrix).invert()}bind(e,t){this.skeleton=e,this.isSkinnedMesh=!0,void 0===t&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.copy(t).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(e){let t=new Ot,n=this.geometry.attributes.skinWeight;for(let i=0,r=n.count;i<r;i++){t.fromBufferAttribute(n,i);let e=1/t.manhattanLength();e!==1/0?t.multiplyScalar(e):t.set(1,0,0,0),n.setXYZW(i,t.x,t.y,t.z,t.w)}}boneTransform(e,t){let n=this.skeleton;if(void 0===n)return;let i=this.geometry;PD.fromBufferAttribute(i.attributes.skinIndex,e),DD.fromBufferAttribute(i.attributes.skinWeight,e),TD.copy(t).applyMatrix4(this.bindMatrix),t.set(0,0,0);for(let r=0;r<4;r++){let e=DD.getComponent(r);if(0!==e){let i=PD.getComponent(r);ID.multiplyMatrices(n.bones[i].matrixWorld,n.boneInverses[i]),t.addScaledVector(OD.copy(TD).applyMatrix4(ID),e)}}return t.applyMatrix4(this.bindMatrixInverse)}};function kD(e){if(Array.isArray(e.material)){for(let t of e.material)if(0===t.getLayersOfType("outline").length)return}else if(!(e.material instanceof wP)||0===e.material.getLayersOfType("outline").length)return;e instanceof RD&&e.is2DAndNoDepth?function(e){if(e.geometry.attributes.extrudeNormals||!e.geometry.attributes.position)return;let t=e.geometry.attributes.position.array,n=new Float32Array(t.length),i=new Bt;for(let r=0;r<t.length;r+=3)i.set(t[r],t[r+1],t[r+2]).normalize(),n[r]=i.x,n[r+1]=i.y,n[r+2]=i.z;e.geometry.setAttribute("extrudeNormal",new ri(n,3))}(e):function(e){if(e.geometry.attributes.extrudeNormal||!e.geometry.attributes.position||!e.geometry.attributes.normal)return;let t=new Map,n=e.geometry.attributes,i=n.position.array,r=n.normal.array,s=new Float32Array(i.length);for(let l=0;l<i.length;l+=3){var a;let e="".concat(i[l],"_").concat(i[l+1],"_").concat(i[l+2]),n=new Bt(r[l],r[l+1],r[l+2]);t.has(e)?null===(a=t.get(e))||void 0===a||a.normals.push(n):t.set(e,{normals:[n],result:new Bt})}t.forEach(((e,t)=>{for(let n of e.normals)e.result.add(n);e.result.divideScalar(e.normals.length)}));for(let l=0;l<i.length;l+=3){var o;let e="".concat(i[l],"_").concat(i[l+1],"_").concat(i[l+2]),n=null===(o=t.get(e))||void 0===o?void 0:o.result;n&&(s[l]=n.x,s[l+1]=n.y,s[l+2]=n.z)}e.geometry.setAttribute("extrudeNormal",new ri(s,3))}(e)}function LD(e){if(!e.geometry.attributes.position)return;let t=e.geometry.attributes.position.array,n=new Float32Array(t.length),i=parseInt(e.uuid.replace(/\D/g,"")),r=[at.seededRandom(i),at.seededRandom(i+1e4),at.seededRandom(i+2e4)];for(let s=0;s<t.length;s++)n[s]=r[s%3];e.geometry.setAttribute("randomColor",new ti(n,3))}var BD=new Ft,zD=new Bt;function ND(e){let t=!1;return e.scene.objects.traverse(((e,n)=>{"Mesh"===n.type&&"SubdivGeometry"===n.geometry.type&&(t=!0)})),t}var FD=class extends RD{constructor(e,t,n){super(e,t,n),this.data=t,this.hiddenMatrixOld=new pn,this.smoothShading=!0,this.skipReactionUpdate=!1}chooseGeoemtryCache(e){return this.dataPatched.flatShading?e.geometryCache:e.geometryCache2}get subdivPointerNew(){return void 0!==this.localGeometry?this.subdivPointer:this.geometry.ensureSubdivPointer()}get originalGeometryNew(){return void 0!==this.localGeometry?this.originalGeometry:this.geometry.originalGeometry}get phongAngle(){var e;return null!==(e=this.data.geometry.phongAngle)&&void 0!==e?e:45}updateEntityBoxSize(e,t){var n;let i=this.geometry.userData.parameters;e.copy(this.originalGeometryNew.boundingSphere.center),t.set(i.width,i.height,null!==(n=i.depth)&&void 0!==n?n:0).multiplyScalar(.5)}createGeometryByControls(e){var t,n,i,r;if(!0===this.skipReactionUpdate)return;let s=null===(t=this.localGeometry)||void 0===t?void 0:t.uuid,{originalGeometry:a,subdividedGeometry:o,subdivPointer:l}=cC.build(e,this.subdivPointer,this.smoothShading,this.hasNonUniformScale?this.shearScale:void 0);this.subdivPointer=l,void 0!==a&&(null!==(n=this.originalGeometry)&&void 0!==n&&n.dispose(),this.originalGeometry=a),void 0!==o&&(null!==(i=this.subdividedGeometry)&&void 0!==i&&i.dispose(),this.subdividedGeometry=null!==o&&void 0!==o?o:void 0),this.localGeometry=null!==(r=this.subdividedGeometry)&&void 0!==r?r:this.originalGeometry,kD(this),LD(this),this.calcBoundingBox(),s&&(this.localGeometry.uuid=s)}updateState(e,t){if(super.updateState(e,t),void 0!==e.flatShading){let n=this.material;this.material=Array.isArray(n)?n.map((e=>e.getFlavor(!1,e.side,e.wireframe))):n.getFlavor(!1,n.side,n.wireframe),this.smoothShading=!e.flatShading,this.createGeometryDelayed(t)}}updateMesh(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];cC.buildLevel(this.subdivPointer,!0,this.smoothShading?this.phongAngle:-1,this.originalGeometry,e&&this.hasNonUniformScale?this.shearScaleInv:void 0),this.subdividedGeometry&&cC.buildLevel(this.subdivPointer,!1,this.smoothShading?this.phongAngle:-1,this.subdividedGeometry,e&&this.hasNonUniformScale?this.shearScaleInv:void 0)}updateTopology(){var e;this.originalGeometry.dispose(),this.originalGeometry=cC.buildLevel(this.subdivPointer,!0,this.smoothShading?this.phongAngle:-1),this.subdividedGeometry&&(this.subdividedGeometry.dispose(),this.subdividedGeometry=cC.buildLevel(this.subdivPointer,!1,this.smoothShading?this.phongAngle:-1)),this.localGeometry=null!==(e=this.subdividedGeometry)&&void 0!==e?e:this.originalGeometry}raycast(e,t){let n=this.localGeometry;this.localGeometry=this.originalGeometryNew,UC.prototype.raycast.call(this,e,t),this.localGeometry=n}activateSVDCompensation(){!this.hasNonUniformScale||(this.matrix.copy(this.matrixWorldRigid),this.hiddenMatrixOld.copy(this.hiddenMatrix),this.hiddenMatrix.copy(this.parent.matrixWorld).invert())}deactivateSVDCompensation(){!this.hasNonUniformScale||(this.updateMatrix(),this.hasNonUniformScale=void 0,this.hiddenMatrix.copy(this.hiddenMatrixOld))}calcBoundingBox(){let e=this.originalGeometry;null===e.boundingSphere&&(e.boundingSphere=new rn,this.subdividedGeometry&&(this.subdividedGeometry.boundingSphere=e.boundingSphere));let t=e.attributes.position,n=e.boundingSphere.center;BD.setFromBufferAttribute(t),BD.getCenter(n),e.boundingSphere.radius=n.distanceTo(BD.max),isNaN(e.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this),BD.getSize(zD),this.hasNonUniformScale&&zD.divide(this.scale);let i={width:zD.x,height:zD.y,depth:zD.z};return this.geometry.userData.parameters=i,i}updateBoundingSphere(e){let t=this.originalGeometry;BD.min.set(e[0],e[2],e[4]),BD.max.set(e[1],e[3],e[5]),this.hasNonUniformScale&&(BD.min.applyMatrix4(this.shearScaleInv),BD.max.applyMatrix4(this.shearScaleInv)),null===t.boundingSphere&&(t.boundingSphere=new rn);let n=t.boundingSphere.center;BD.getCenter(n),t.boundingSphere.radius=n.distanceTo(BD.max)}freeSubdivPointer(){var e,t;this.subdivPointer&&(cC.freeSubdivPointer(this.subdivPointer),this.subdivPointer=0),this.localGeometry=void 0,null!==(e=this.originalGeometry)&&void 0!==e&&e.dispose(),null===(t=this.subdividedGeometry)||void 0===t||t.dispose()}dispose(){super.dispose(),this.freeSubdivPointer()}updateByPatchedOpGeometry(e,t,n){super.updateByPatchedOpGeometry(e,t,n),this.localGeometry&&this.createGeometryByControls(t)}},UD={x:[1,0,0],"-x":[-1,0,0],y:[0,1,0],"-y":[0,-1,0],z:[0,0,1],"-z":[0,0,-1]},jD={polygon_center:0,edge:1,vertex:2},VD=(e,t)=>(n,i)=>t&&0!==n&&0!==e?e*i/100:0,GD=(e,t)=>{let n=Math.abs(t),i=-1*n;return(e- -1)*(n-i)/2+i},HD=new Bt,WD=new Bt,qD=new Bt,XD=new Bt;function YD(e,t){let n=qD.fromArray(e),i=XD.fromArray(t);WD.copy(i).sub(n);let r=WD.length();return WD.normalize().multiplyScalar(.5*r),HD.copy(n).add(WD).toArray()}var QD=new Qn,KD=new Bt,ZD=new Bt,JD=new Bt;var $D=e=>.5*(1-Math.cos(e*Math.PI)),eO=class{constructor(){this.perlin=new Array(4096)}noise(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(null==this.perlin){this.perlin=new Array(4096);for(let e=0;e<4096;e++)this.perlin[e]=Math.random()}e<0&&(e=-e),t<0&&(t=-t),n<0&&(n=-n);let i,r,s,a,o,l=Math.floor(e),c=Math.floor(t),h=Math.floor(n),u=e-l,d=t-c,p=n-h,f=0,m=.5;for(let g=0;g<4;g++){let e=l+(c<<4)+(h<<8);i=$D(u),r=$D(d),s=this.perlin[4095&e],s+=i*(this.perlin[e+1&4095]-s),a=this.perlin[e+16&4095],a+=i*(this.perlin[e+16+1&4095]-a),s+=r*(a-s),e+=256,a=this.perlin[4095&e],a+=i*(this.perlin[e+1&4095]-a),o=this.perlin[e+16&4095],o+=i*(this.perlin[e+16+1&4095]-o),a+=r*(o-a),s+=$D(p)*(a-s),f+=s*m,m*=.5,l<<=1,u*=2,c<<=1,d*=2,h<<=1,p*=2,u>=1&&(l++,u--),d>=1&&(c++,d--),p>=1&&(h++,p--)}return f}noiseSeed(e){let t=(()=>{let e,t;return{setSeed(n){t=e=(null!==n&&void 0!==n?n:4294967296*Math.random())>>>0},getSeed:()=>e,rand:()=>(t=(1664525*t+1013904223)%4294967296,t/4294967296)}})();t.setSeed(e),this.perlin=new Array(4096);for(let n=0;n<4096;n++)this.perlin[n]=t.rand()}},tO=new Bt,nO=new pn,iO=new dn;function rO(e){let t=!1;return e.scene.objects.traverse(((e,n)=>{"Mesh"===n.type&&("TextGeometry"===n.geometry.type||"InputGeometry"===n.geometry.type)&&(t=!0)})),t}var sO,aO,oO,lO,cO=class extends RD{constructor(e,t,n){super(e,t,n),this.data=t}get textGeometry(){return this.geometry}get charWidths(){return this.textGeometry.charWidths}get charCoords(){return this.textGeometry.charCoords}get wrappedText(){return this.textGeometry.wrappedText}get font(){return this.textGeometry.font}get initialOffsetY(){var e,t;let n=this.dataPatched;return null!==(e=null===(t=this.font)||void 0===t?void 0:t.getLineInitialOffsetY(this.lineHeight,this.wrappedText.length,n.geometry.height,this.fontScale,n.geometry.verticalAlign))&&void 0!==e?e:0}get fontScale(){let e=this.dataPatched;return this.font?e.geometry.fontSize/this.font.unitsPerEm:1}get AD(){return Math.abs(this.ascender-this.descender)}get ascender(){var e,t;return(null!==(e=null===(t=this.font)||void 0===t?void 0:t.ascender)&&void 0!==e?e:1)*this.fontScale}get descender(){var e,t;return(null!==(e=null===(t=this.font)||void 0===t?void 0:t.descender)&&void 0!==e?e:1)*this.fontScale}get lineHeight(){let e=this.dataPatched;return e.geometry.fontSize*e.geometry.lineHeight}raycast(e,t){let{matrixWorld:n}=this;if(!isNaN(e.ray.origin.x)&&0!==this.scale.x&&0!==this.scale.y&&0!==this.scale.z&&(nO.copy(n).invert(),iO.copy(e.ray).applyMatrix4(nO),iO.intersectBox(this.singleBBox,tO))){let i=tO.applyMatrix4(n),r=e.ray.origin.distanceTo(i);t.push({distance:r,point:i.clone(),object:this})}}},hO=1e-4,uO=new Bt,dO=new Bt;KA.then((e=>{aO=[(sO=e).get_face_center,sO.get_edge_midpoint,sO.get_vertex_position],oO=[sO.get_face_normal,sO.get_edge_normal,sO.get_vertex_normal],lO=[sO.face_count,sO.edge_count,sO.vertex_count]}));var pO=new pn,fO=new pn,mO=new Bt,gO=new Bt,vO=new Bt,yO=new Bt,bO=new Bt,xO=new Bt,wO=class{constructor(e,t){this.data=e,this.is3D=t,this.perlin=new eO,"perlin"===e.noiseType?(this.perlin.noiseSeed(e.seed),this.noise=t?(e,t,n)=>this.perlin.noise(e,t,n):e=>this.perlin.noise(e)):this.noise=t?function(){let e=FS(arguments.length>0&&void 0!==arguments[0]?arguments[0]:Math.random),t=new Float64Array(e).map((e=>NS[e%12*3])),n=new Float64Array(e).map((e=>NS[e%12*3+1])),i=new Float64Array(e).map((e=>NS[e%12*3+2]));return function(r,s,a){let o,l,c,h,u,d,p,f,m,g,v=(r+s+a)*kS,y=BS(r+v),b=BS(s+v),x=BS(a+v),w=(y+b+x)*LS,S=r-(y-w),_=s-(b-w),E=a-(x-w);S>=_?_>=E?(u=1,d=0,p=0,f=1,m=1,g=0):S>=E?(u=1,d=0,p=0,f=1,m=0,g=1):(u=0,d=0,p=1,f=1,m=0,g=1):_<E?(u=0,d=0,p=1,f=0,m=1,g=1):S<E?(u=0,d=1,p=0,f=0,m=1,g=1):(u=0,d=1,p=0,f=1,m=1,g=0);let A=S-u+LS,C=_-d+LS,M=E-p+LS,T=S-f+2*LS,P=_-m+2*LS,D=E-g+2*LS,O=S-1+.5,I=_-1+.5,R=E-1+.5,k=255&y,L=255&b,B=255&x,z=.6-S*S-_*_-E*E;if(z<0)o=0;else{let r=k+e[L+e[B]];z*=z,o=z*z*(t[r]*S+n[r]*_+i[r]*E)}let N=.6-A*A-C*C-M*M;if(N<0)l=0;else{let r=k+u+e[L+d+e[B+p]];N*=N,l=N*N*(t[r]*A+n[r]*C+i[r]*M)}let F=.6-T*T-P*P-D*D;if(F<0)c=0;else{let r=k+f+e[L+m+e[B+g]];F*=F,c=F*F*(t[r]*T+n[r]*P+i[r]*D)}let U=.6-O*O-I*I-R*R;if(U<0)h=0;else{let r=k+1+e[L+1+e[B+1]];U*=U,h=U*U*(t[r]*O+n[r]*I+i[r]*R)}return 32*(o+l+c+h)}}((0,OS.default)(e.seed)):function(){let e=FS(arguments.length>0&&void 0!==arguments[0]?arguments[0]:Math.random),t=new Float64Array(e).map((e=>zS[e%12*2])),n=new Float64Array(e).map((e=>zS[e%12*2+1]));return function(i,r){let s,a,o=0,l=0,c=0,h=(i+r)*IS,u=BS(i+h),d=BS(r+h),p=(u+d)*RS,f=i-(u-p),m=r-(d-p);f>m?(s=1,a=0):(s=0,a=1);let g=f-s+RS,v=m-a+RS,y=f-1+2*RS,b=m-1+2*RS,x=255&u,w=255&d,S=.5-f*f-m*m;if(S>=0){let i=x+e[w];S*=S,o=S*S*(t[i]*f+n[i]*m)}let _=.5-g*g-v*v;if(_>=0){let i=x+s+e[w+a];_*=_,l=_*_*(t[i]*g+n[i]*v)}let E=.5-y*y-b*b;if(E>=0){let i=x+1+e[w+1];E*=E,c=E*E*(t[i]*y+n[i]*b)}return 70*(o+l+c)}}((0,OS.default)(e.seed))}},SO=class extends(YS(Nn)){constructor(e,t){super(),this.parameters=t,this.objectForSample=void 0,this._pendingMediaLoad=!1,this.random=null,this.object=e}resetOnMove(){this.removeFromParent(),this.parent=null}expandClones(e){if(null===this.parent)this.updateState(this.parameters,e);else for(let t of this.children)t instanceof KS&&t.expand()}invalidateTransform(e){this.matrixWorldNeedsUpdate=!0,this.traverse((t=>{t instanceof KS&&t.object===e&&(t.matrixWorldNeedsUpdate=!0)}))}onObjUpdateMatrix(){"toObject"!==this.parameters.type&&(this.matrixWorldNeedsUpdate=!0)}update(){switch(this._updateCount(),this.parameters.type){case"radial":this._updateRadial(this.parameters);break;case"linear":this._updateLinear(this.parameters);break;case"grid":this._updateGrid(this.parameters);break;case"toObject":this._updateToObject(this.parameters)}for(let e of this.children)e.updateMatrix(),e.hasNonUniformScale&&(e.updateMatrixWorld(),e.updateMatrixWorldSVD())}_updateCount(e){let t;if(t=void 0!==e?e:"grid"===this.parameters.type?Math.round(this.parameters.grid.count[0])*Math.round(this.parameters.grid.count[1])*Math.round(this.parameters.grid.count[2]):this.parameters.count,"toObject"===this.parameters.type)if(this.parameters.toObject.object){if(void 0===e&&"random"!==this.parameters.toObject.spreadType)return}else t=0;if("toObject"===this.parameters.type&&this.objectForSample){let e=this.children;if(e.length===t)return;if(e.length<t)for(let n=0,i=t-e.length;n<i;++n){let e=new KS(this.object);e.expand(),this.add(e)}else for(let n=0,i=e.length-t;n<i;++n)this.remove(e[n])}else{if(this.children.length===t)return;if(this.children.length<t)for(let e=0,n=t-this.children.length;e<n;++e){let e=new KS(this.object);e.expand(),this.add(e)}else for(let e=0,n=this.children.length-t;e<n;++e)this.remove(this.children[e])}}getRandom(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return(null===this.random||this.random.data.seed!==e.seed||this.random.is3D!==t)&&(this.random=new wO(e,t)),this.random}_updateRadial(e){var t;let n,i=e.radial,r=i.start*at.DEG2RAD,s=r-i.end*at.DEG2RAD,a=new _n(i.rotation[0],i.rotation[1],i.rotation[2]);switch(i.axis){case"z":n=new Bt(0,0,1);break;case"y":n=new Bt(0,1,0);break;default:n=new Bt(1,0,0)}let o=null!==(t=e.randomnessObject)&&void 0!==t?t:nb.defaultData([1,1,1]).randomnessObject,l=this.getRandom(o),c=VD(o.strength,this.parameters.randomness);for(let[h,u]of this.children.entries()){let t=h*(o.freqScale/10)+o.movement,d=l.noise(t,t,t),p=h+1;u.scale.x=i.scale[0]+c(p,GD(d,o.scale[0]))||hO,u.scale.y=i.scale[1]+c(p,GD(d,o.scale[1]))||hO,u.scale.z=i.scale[2]+c(p,GD(d,o.scale[2]))||hO,u.position.setScalar(0);let f=s/e.count*h-r;switch(i.axis){case"x":u.rotation.set(0,f,0);break;case"y":u.rotation.set(0,0,f);break;case"z":u.rotation.set(f,0,0)}u.translateOnAxis(n,i.radius),u.position.x+=i.position[0]+c(p,GD(d,o.position[0])),u.position.y+=i.position[1]+c(p,GD(d,o.position[1])),u.position.z+=i.position[2]+c(p,GD(d,o.position[2]));let m=c(p,GD(d,o.rotation[0])),g=c(p,GD(d,o.rotation[1])),v=c(p,GD(d,o.rotation[2]));!0===i.alignment?(u.rotation.x+=a.x+m,u.rotation.y+=a.y+g,u.rotation.z+=a.z+v):u.rotation.set(a.x+m,a.y+g,a.z+v)}}_updateLinear(e){var t;if("linear"!==e.type)throw new Error;let n=e.linear,i=new _n(n.rotation[0],n.rotation[1],n.rotation[2]),r=null!==(t=e.randomnessObject)&&void 0!==t?t:nb.defaultData([1,1,1]).randomnessObject,s=this.getRandom(r),a=VD(r.strength,this.parameters.randomness);for(let[o,l]of this.children.entries()){let e=o*(r.freqScale/10)+r.movement,t=s.noise(e,e,e),c=o+1,h=a(c,GD(t,r.rotation[0])),u=a(c,GD(t,r.rotation[1])),d=a(c,GD(t,r.rotation[2]));l.scale.x=1+(n.scale[0]-1)*o+a(c,GD(t,r.scale[0]))||hO,l.scale.y=1+(n.scale[1]-1)*o+a(c,GD(t,r.scale[1]))||hO,l.scale.z=1+(n.scale[2]-1)*o+a(c,GD(t,r.scale[2]))||hO,l.rotation.x=i.x*o+h,l.rotation.y=i.y*o+u,l.rotation.z=i.z*o+d,l.position.x=n.position[0]*o+a(c,GD(t,r.position[0])),l.position.y=n.position[1]*o+a(c,GD(t,r.position[1])),l.position.z=n.position[2]*o+a(c,GD(t,r.position[2]))}}_updateGrid(e){var t;let n=0,i=e.grid,r=null!==(t=e.randomnessObject)&&void 0!==t?t:nb.defaultData([1,1,1]).randomnessObject,s=this.getRandom(r,!0),a=VD(r.strength,this.parameters.randomness);if(!0===i.useCenter){let e={x:i.count[0]%2===0?2:1,y:i.count[1]%2===0?2:1,z:i.count[2]%2===0?2:1},t=new Bt(i.size[0]*(i.count[0]-e.x)*.5,i.size[1]*(i.count[1]-e.y)*.5,i.size[2]*(i.count[2]-e.z)*.5);for(let o=0;o<i.count[0];o++)for(let e=0;e<i.count[1];e++)for(let l=0;l<i.count[2];l++){let c=s.noise((o+1)*(r.freqScale/10)+r.movement,(e+1)*(r.freqScale/10)+r.movement,(l+1)*(r.freqScale/10)+r.movement),h=this.children[n++];h.scale.x=1+a(n,GD(c,r.scale[0]))||hO,h.scale.y=1+a(n,GD(c,r.scale[1]))||hO,h.scale.z=1+a(n,GD(c,r.scale[2]))||hO;let u=a(n,GD(c,r.rotation[0])),d=a(n,GD(c,r.rotation[1])),p=a(n,GD(c,r.rotation[2]));h.rotation.set(u,d,p),h.position.x=i.size[0]*o-t.x+a(n,GD(c,r.position[0])),h.position.y=i.size[1]*e-t.y+a(n,GD(c,r.position[1])),h.position.z=i.size[2]*l-t.z+a(n,GD(c,r.position[2]))}}else for(let o=0;o<i.count[0];o++)for(let e=0;e<i.count[1];e++)for(let t=0;t<i.count[2];t++){let l=s.noise((o+1)*(r.freqScale/10)+r.movement,(e+1)*(r.freqScale/10)+r.movement,(t+1)*(r.freqScale/10)+r.movement),c=this.children[n++];c.scale.x=1+a(n,GD(l,r.scale[0]))||hO,c.scale.y=1+a(n,GD(l,r.scale[1]))||hO,c.scale.z=1+a(n,GD(l,r.scale[2]))||hO;let h=a(n,GD(l,r.rotation[0])),u=a(n,GD(l,r.rotation[1])),d=a(n,GD(l,r.rotation[2]));c.rotation.set(h,u,d),c.position.x=i.size[0]*o+a(n,GD(l,r.position[0])),c.position.y=-i.size[1]*e+a(n,GD(l,r.position[1])),c.position.z=-i.size[2]*t+a(n,GD(l,r.position[2]))}}_updateToObject(e){var t,n;if("toObject"!==e.type)throw new Error;let{toObject:i}=e,r=new _n(i.rotation[0],i.rotation[1],i.rotation[2]),s=null!==(t=e.randomnessObject)&&void 0!==t?t:nb.defaultData([1,1,1]).randomnessObject,a=this.getRandom(s),o=VD(s.strength,this.parameters.randomness);if(!i.object){for(let[,e]of this.children.entries())e.position.set(0,0,0),e.scale.setScalar(1),e.rotation.set(0,0,0);return void(this.objectForSample=void 0)}if(!this.objectForSample)return;if(this.objectForSample instanceof cO){if(null===(n=this.objectForSample.font)||void 0===n||!n.isLoaded||void 0===this.objectForSample.geometry.attributes.position)return void(this._pendingMediaLoad=!0);this._pendingMediaLoad=!1}if(void 0===this.objectForSample.geometry&&this.objectForSample.isAncestorOf(this.object.uuid))return void console.warn('Oh no! The object "'.concat(this.object.name,'" (').concat(this.object.uuid,") seem to be a child/descendant of the object it's being cloned to. Please re-parent it so that they are siblings instead."));let l=this.getSubdivData();if(l.length>0){let e=Math.round(l.length*i.count/100);this._updateCount(e)}else{let e=this.objectForSample.geometry.getAttribute("position");if(!e||isNaN(e.count)||0===e.count)return void console.warn('Oh no! The object "'.concat(this.object.name,'" (').concat(this.object.uuid,') cannot be cloned on the surface of "').concat(this.objectForSample.name,'" (').concat(this.objectForSample.uuid,") because the latter does not have a valid geometry."))}this.objectForSample.updateMatrixWorld();let c=new VS(this.objectForSample).build(),h=UD[i.axis],u=this.children;c.setRandomGenerator((0,OS.default)(this.object.uuid+i.seed));for(let[d,p]of u.entries()){let e=d*(s.freqScale/10)+s.movement,t=a.noise(e,e,e),n=d+1,u=o(n,GD(t,s.rotation[0])),f=o(n,GD(t,s.rotation[1])),m=o(n,GD(t,s.rotation[2]));"random"===i.spreadType?c.sample(vO,yO):(l.length&&(vO.fromArray(l[d].pos),yO.fromArray(l[d].norm)),this.objectForSample instanceof FD&&vO.applyMatrix4(pO.copy(this.objectForSample.matrixWorld).invert())),vO.applyMatrix4(this.object.hiddenMatrix.clone().invert()),p.position.copy(vO),mO.fromArray(h);let g="normal"===i.align?yO:this.object.getWorldDirection(xO),v=gO.fromArray(i.position);gO.x+=o(n,GD(t,s.position[0])),gO.y+=o(n,GD(t,s.position[1])),gO.z+=o(n,GD(t,s.position[2]));let y=Math.acos(g.dot(mO)),b=bO.crossVectors(mO,g).normalize(),x=fO.makeRotationAxis(b,y),w=g.clone().cross(this.object.up).normalize(),S=w.clone().cross(g).normalize(),_=(new pn).makeBasis(w,g,S),E=new Bt(mO.y,mO.z,mO.x).normalize(),A=E.clone().cross(mO).normalize(),C=(new pn).makeBasis(E,mO,A).invert(),M=(new pn).multiplyMatrices(_,C);p.rotation.setFromRotationMatrix(M),v.applyMatrix4(x),p.position.add(v),p.rotation.x=p.rotation.x+r.x+u,p.rotation.y=p.rotation.y+r.y+f,p.rotation.z=p.rotation.z+r.z+m,p.scale.setScalar(1),p.scale.x=p.scale.x+i.scale[0]+o(n,GD(t,s.scale[0]))||hO,p.scale.y=p.scale.y+i.scale[1]+o(n,GD(t,s.scale[1]))||hO,p.scale.z=p.scale.z+i.scale[2]+o(n,GD(t,s.scale[2]))||hO,p.scale.multiply(this.object.scale),p.hiddenMatrix=this.object.hiddenMatrix}}getSubdivData(){if(!this.objectForSample)return[];let e=this.parameters.toObject.spreadType,t=new Map,n=(e,n)=>{let i=Math.round(1e4*e[0])+"_"+Math.round(1e4*e[1])+"_"+Math.round(1e4*e[2]),r=t.get(i);r?(r.pos[0]+=e[0],r.pos[1]+=e[1],r.pos[2]+=e[2],r.norm[0]+=n[0],r.norm[1]+=n[1],r.norm[2]+=n[2],r.count+=1):t.set(i,{pos:[...e],norm:[...n],count:1})};if("random"===e)return[];if(this.objectForSample instanceof FD){let t=this.objectForSample,i=jD[e],r=lO[i],s=aO[i],a=oO[i],o=r(t.subdivPointerNew);for(let e=0;e<=o-1;e++){let i=s(t.subdivPointerNew,e),r=a(t.subdivPointerNew,e);uO.fromArray(i).applyMatrix4(t.matrixWorld),dO.fromArray(r),n(uO.toArray(),dO.toArray())}}else(this.objectForSample.geometry.index?function(e){let t=[];for(let n=0;n<=e.index.count;n++)if(KD.fromArray(e.index.array,3*n),QD.setFromAttributeAndIndices(e.attributes.position,KD.x,KD.y,KD.z),QD.getNormal(ZD),QD.getMidpoint(JD),!(isNaN(JD.x)||isNaN(JD.y)||isNaN(JD.z))){let{a:e,b:n,c:i}=QD,r=e.toArray(),s=n.toArray(),a=i.toArray(),o=e.distanceTo(n),l=n.distanceTo(i),c=i.distanceTo(e),h=YD(r,s),u=YD(s,a),d=YD(a,r),p=[o,l,c],f=Math.max(...p),m=p.filter((e=>Math.round(e)===Math.round(f))).length>1,g=[],v=QD.getMidpoint(JD).toArray();f===o&&!m&&(g=[u,d,d],v=h),f===l&&!m&&(g=[h,d,d],v=u),f===c&&!m&&(g=[h,u,u],v=d),m&&(g=[h,u,d]),t.push({vertices:[r,s,a],faceCenters:g,midpoint:v,norm:QD.getNormal(ZD).toArray()})}return t}(this.objectForSample.geometry):function(e){let t=[],{position:n}=e.attributes;for(let i=0;i<n.count;i++){QD.setFromAttributeAndIndices(n,3*i,3*i+1,3*i+2),QD.getNormal(ZD),QD.getMidpoint(JD);let e=QD.a.toArray(),r=QD.b.toArray(),s=QD.c.toArray();t.push({vertices:[e,r,s],faceCenters:[YD(e,r),YD(r,s),YD(s,e)],midpoint:JD.toArray(),norm:ZD.toArray()})}return t}(this.objectForSample.geometry)).forEach(((t,i)=>{"polygon_center"===e&&n(t.midpoint,t.norm),"vertex"===e&&(n(t.vertices[0],t.norm),n(t.vertices[1],t.norm),n(t.vertices[2],t.norm)),"edge"===e&&(n(t.faceCenters[0],t.norm),n(t.faceCenters[1],t.norm),n(t.faceCenters[2],t.norm))}));let i=Array.from(t.values());for(let r of i)r.pos[0]/=r.count,r.pos[1]/=r.count,r.pos[2]/=r.count,r.norm[0]/=r.count,r.norm[1]/=r.count,r.norm[2]/=r.count;return i}updateState(e,t){var n;if(this.parameters=zf(e),"toObject"!==this.parameters.type)(null===this.parent||this.parent!==this.object)&&(this.removeFromParent(),null!==(n=this.object.parent)&&void 0!==n&&n.add(this),this.matrix=this.object.matrix,this.hiddenMatrix=this.object.hiddenMatrix,this.matrixWorldNeedsUpdate=!0,this.matrixAutoUpdate=!1);else if(null===this.parent||this.parent.uuid!==this.parameters.toObject.object){this.removeFromParent();let e=t.find(this.parameters.toObject.object);this.objectForSample=e instanceof UC?e:void 0,this.matrix=new pn,this.hiddenMatrix=new pn,this.matrixWorldNeedsUpdate=!0,this.matrixAutoUpdate=!1,e&&e.add(this)}this.update()}get pendingMediaLoad(){return this._pendingMediaLoad}},_O=e=>{var t;return(t=class extends e{}).geometryHelper=new Ti(30,30,30),t},EO=new dn,AO=new rn,CO=new pn,MO=function(e,t,n,i){let r=arguments.length>4&&void 0!==arguments[4]&&arguments[4],s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:e,a=t,o=s.matrixWorld;if(null===a.boundingSphere&&a.computeBoundingSphere(),AO.copy(a.boundingSphere),AO.applyMatrix4(o),!1===n.ray.intersectsSphere(AO)||(CO.copy(o).invert(),EO.copy(n.ray).applyMatrix4(CO),null!==a.boundingBox&&!1===EO.intersectsBox(a.boundingBox)))return;let l,c,h,u,d,p,f=a.index,m=a.attributes.position,g=a.drawRange;if(!1===r){for(d=Math.max(0,g.start),p=Math.min(f.count,g.start+g.count);d<p;d+=3)if(c=f.getX(d),h=f.getX(d+1),u=f.getX(d+2),l=v(e,n,EO,m,c,h,u),l)return l.faceIndex=Math.floor(d/3),void i.push(l)}else{let t=a.attributes.position,r=new Bt,o=new Bt,l=new Bt,c=new Bt,h=2,u=1/((s.scale.x+s.scale.y+s.scale.z)/3),d=u*u;for(let a=Math.max(0,g.start),p=Math.min(t.count,g.start+g.count)-1;a<p;a+=h){if(r.fromBufferAttribute(t,a),o.fromBufferAttribute(t,a+1),EO.distanceSqToSegment(r,o,c,l)>d)continue;c.applyMatrix4(s.matrixWorld);let h=n.ray.origin.distanceTo(c);h<n.near||h>n.far||i.push({distance:h,point:l.clone().applyMatrix4(s.matrixWorld),object:e})}}function v(e,t,n,i,r,s,a){let o=new Bt,l=new Bt,c=new Bt,h=new Bt,u=new Bt;if(o.fromBufferAttribute(i,r),l.fromBufferAttribute(i,s),c.fromBufferAttribute(i,a),null===n.intersectTriangle(o,l,c,!1,h))return null;u.copy(h),u.applyMatrix4(e.matrixWorld);let d=t.ray.origin.distanceTo(u);return d<t.near||d>t.far?null:{faceIndex:1,distance:d,point:u.clone(),object:e}}},TO=new Bt,PO=new ki,DO=class extends Za{constructor(e){let t=new di,n=new Va({color:16777215,vertexColors:!0,toneMapped:!1}),i=[],r=[],s={},a=new Et(15711266),o=new Et(15711266),l=new Et(2857471);function c(e,t,n){h(e,n),h(t,n)}function h(e,t){i.push(0,0,0),r.push(t.r,t.g,t.b),void 0===s[e]&&(s[e]=[]),s[e].push(i.length/3-1)}c("n1","n2",a),c("n2","n4",a),c("n4","n3",a),c("n3","n1",a),c("f1","f2",a),c("f2","f4",a),c("f4","f3",a),c("f3","f1",a),c("n1","f1",a),c("n2","f2",a),c("n3","f3",a),c("n4","f4",a),c("p","n1",o),c("p","n2",o),c("p","n3",o),c("p","n4",o),c("u1","u2",l),c("u2","u3",l),c("u3","u1",l),t.setAttribute("position",new ri(i,3)),t.setAttribute("color",new ri(r,3)),super(t,n),this.type="CameraHelper",this.camera=e,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=s,this.update()}update(){let e=this.geometry,t=this.pointMap;PO.projectionMatrixInverse.elements=[.5112609807824982,-0,-0,-0,-0,.41421356237309503,-0,-0,-0,-0,-0,-.099999,-0,-0,-1.0000000000000002,.100001];let n=.8;OO("n1",t,e,PO,-1,-1,n),OO("n2",t,e,PO,1,-1,n),OO("n3",t,e,PO,-1,1,n),OO("n4",t,e,PO,1,1,n);let i=n;OO("f1",t,e,PO,-1,-1,i),OO("f2",t,e,PO,1,-1,i),OO("f3",t,e,PO,-1,1,i),OO("f4",t,e,PO,1,1,i);let r=i;OO("u1",t,e,PO,.35,1.1,r),OO("u2",t,e,PO,-.35,1.1,r),OO("u3",t,e,PO,0,1.55,r),e.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}};function OO(e,t,n,i,r,s,a){TO.set(r,s,a).unproject(i);let o=t[e];if(void 0!==o){let e=n.getAttribute("position");for(let t=0,n=o.length;t<n;t++)e.setXYZ(o[t],TO.x,TO.y,TO.z)}}var IO,RO=class extends(_O(DO)){constructor(e){super(e),this.object=e,this.object=e,this.name="CombinedCameraHelper: ".concat(e.uuid)}updateMatrixWorld(e){super.updateMatrixWorld(e),this.updateTarget()}updateTarget(){let e=this.object.getTarget();this.updateWorldMatrix(!0,!1),this.worldToLocal(e)}raycast(e,t){MO(this.object,this.geometry,e,t,!0)}};(e=>{e.is=e=>"objectHelper"in e})(IO||(IO={}));var kO=(e,t)=>class extends(g_(e)){constructor(){super(...arguments),this.objectHelper=new t(this),this.gizmos={}}get geometryHelper(){return t.geometryHelper}raycast(e,t){this.objectHelper.raycast(e,t)}showGizmos(){for(let e in this.gizmos){let t=this.gizmos[e];t instanceof Lc&&(t.visible=!0)}}updateEntityBoxSize(e,t){this.objectHelper.visible&&this.geometryHelper instanceof Ti?(e.setScalar(0),t.set(this.geometryHelper.parameters.width,this.geometryHelper.parameters.height,this.geometryHelper.parameters.height).multiplyScalar(.5)):super.updateEntityBoxSize(e,t)}hideGizmos(){for(let e in this.gizmos){let t=this.gizmos[e];t instanceof Lc&&(t.visible=!1)}}},LO=new Bt,BO=new Bt,zO=new Lt,NO=new Bt,FO=new Bt,UO=new Bt,jO=class extends(kO(ki,RO)){constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:o(o({},tx.defaultData),{},{name:""});super(),this._cameraType="OrthographicCamera",this.targetOffset=tb.DefaultTargetOffset,this.isUpVectorFlipped=!1,this.angleOffsetFromUp=0,this.wasMovedByUser=!1,this.wasMovedBySwitchCameraAction=!1,this.super_Entity(e,t),this.previousProjectionMatrix=new pn,this.matrixAutoUpdate=!0,this.width=window.innerWidth,this.height=window.innerHeight;let n=this.width,i=this.height;this.orthoCamera=new ar(-.5*n,.5*n,.5*i,-.5*i,-5e4,1e4),this.perspCamera=new Li(45,n/i,50,1e4),this.left=this.orthoCamera.left,this.right=this.orthoCamera.right,this.top=this.orthoCamera.top,this.bottom=this.orthoCamera.bottom,this.far=this.orthoCamera.far,this.view=this.orthoCamera.view,this.aspect=this.perspCamera.aspect,this.focus=this.perspCamera.focus,this.filmGauge=this.perspCamera.filmGauge,this.filmOffset=this.perspCamera.filmOffset,this.objectHelper.update()}get isPerspectiveCamera(){return"PerspectiveCamera"===this.cameraType}get isOrthographicCamera(){return!this.isPerspectiveCamera}get cameraType(){return this._cameraType}set fov(e){this.perspCamera.fov=e}get fov(){return this.perspCamera.fov}setNear(e,t){"PerspectiveCamera"===e?this.perspCamera.near=t:this.orthoCamera.near=t}setZoom(e,t){t>=0&&("PerspectiveCamera"===e?this.perspCamera.zoom=t:this.orthoCamera.zoom=t)}set cameraType(e){"PerspectiveCamera"===e?this.toPerspective():"OrthographicCamera"===e&&this.toOrthographic()}get near(){return"PerspectiveCamera"===this._cameraType?this.perspCamera.near:this.orthoCamera.near}set near(e){"PerspectiveCamera"===this._cameraType?this.perspCamera.near=e:this.orthoCamera.near=e}get zoom(){return"PerspectiveCamera"===this._cameraType?this.perspCamera.zoom:this.orthoCamera.zoom}set zoom(e){e>=0&&("PerspectiveCamera"===this._cameraType?this.perspCamera.zoom=e:this.orthoCamera.zoom=e)}lookAt(e,t,n){"number"==typeof e&&(e=new Bt(e,t,n)),super.lookAt(e),this.getWorldPosition(LO),this.targetOffset=LO.distanceTo(e)}getTarget(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Bt;return this.getWorldDirection(BO),this.getWorldPosition(LO),BO.multiplyScalar(this.targetOffset),e.copy(LO).add(BO),e}getDistanceToTarget(){let e=this.getTarget();return this.getWorldPosition(LO),LO.distanceTo(e)}updateUp(){this.getWorldQuaternion(zO),NO.set(0,0,1).applyQuaternion(zO),FO.copy(Nn.DEFAULT_UP),this.isUpVectorFlipped&&FO.negate(),FO.applyQuaternion(zO),UO.copy(Nn.DEFAULT_UP).projectOnPlane(NO),this.angleOffsetFromUp=UO.angleTo(FO),this.angleOffsetFromUp*=UO.cross(FO).dot(NO)>=0?1:-1}updateTransformState(e,t){let n=super.updateTransformState(e,t);return void 0!==e.isUpVectorFlipped&&(this.isUpVectorFlipped=e.isUpVectorFlipped),this.updateUp(),n}getViewFrontToObject(e){let t=e.getWorldPosition(new Bt),n=e.getWorldDirection(new Bt).multiplyScalar(this.targetOffset);return{position:t.clone().add(n),target:t}}getViewToTarget(e){let t=this.getWorldDirection(new Bt).multiplyScalar(this.targetOffset);return{position:e.clone().sub(t),target:e}}getViewToObject(e){let t=new Bt;e.getWorldPosition(t);return this.getViewToTarget(t)}setViewplaneSize(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this.aspect=e/t,n){let n=e>t?this.aspect:1,i=e>t?1:this.aspect;this.left=-395*n,this.right=395*n,this.top=1/i*395,this.bottom=1/i*-395}else this.left=.5*-e,this.right=.5*e,this.top=.5*t,this.bottom=.5*-t;this.updateProjectionMatrix()}copyViewPlaneSize(e){this.aspect=e.aspect,this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.updateProjectionMatrix()}toOrthographic(){this.orthoCamera.left=this.left,this.orthoCamera.right=this.right,this.orthoCamera.top=this.top,this.orthoCamera.bottom=this.bottom,this.orthoCamera.view=this.view,this.orthoCamera.far=this.far,this.orthoCamera.updateProjectionMatrix(),this.projectionMatrix=this.orthoCamera.projectionMatrix,this.projectionMatrixInverse=this.orthoCamera.projectionMatrixInverse,this._cameraType="OrthographicCamera",this.objectHelper&&this.objectHelper.update()}toPerspective(){this.perspCamera.aspect=this.aspect,this.perspCamera.fov=this.fov,this.perspCamera.view=this.view,this.perspCamera.far=this.far,this.perspCamera.updateProjectionMatrix(),this.projectionMatrix=this.perspCamera.projectionMatrix,this.projectionMatrixInverse=this.perspCamera.projectionMatrixInverse,this._cameraType="PerspectiveCamera",this.objectHelper&&this.objectHelper.update()}setFocalLength(e){this.perspCamera.setFocalLength(e),this.toPerspective()}getFocalLength(){return this.perspCamera.getFocalLength()}getEffectiveFOV(){return this.perspCamera.getEffectiveFOV()}getFilmWidth(){return this.perspCamera.getFilmWidth()}getFilmHeight(){return this.perspCamera.getFilmHeight()}setViewOffset(e,t,n,i,r,s){"PerspectiveCamera"===this._cameraType?this.perspCamera.setViewOffset(e,t,n,i,r,s):this.orthoCamera.setViewOffset(e,t,n,i,r,s)}clearViewOffset(){"PerspectiveCamera"===this._cameraType?(this.perspCamera.clearViewOffset(),this.toPerspective()):(this.orthoCamera.clearViewOffset(),this.toOrthographic())}copyHistory(){this.previousProjectionMatrix&&this.previousProjectionMatrix.copy(this.projectionMatrix)}updateProjectionMatrix(){"PerspectiveCamera"===this._cameraType?this.toPerspective():"OrthographicCamera"===this._cameraType&&this.toOrthographic()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}copy(e,t){return super.copy(e,t),this.parent=e.parent,this.orthoCamera.copy(e.orthoCamera),this.perspCamera.copy(e.perspCamera),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.far=e.far,this.view=null===e.view?null:Object.assign({},e.view),this._cameraType=e._cameraType,this.aspect=e.aspect,this.fov=e.fov,this.focus=e.focus,this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this.targetOffset=e.targetOffset,this.updateProjectionMatrix(),this}toCameraState(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t={type:this.cameraType,far:this.far,orthographic:{near:this.orthoCamera.near,zoom:this.orthoCamera.zoom},perspective:{near:this.perspCamera.near,fov:this.perspCamera.fov,zoom:this.perspCamera.zoom},up:this.up.toArray(),targetOffset:this.targetOffset,isUpVectorFlipped:this.isUpVectorFlipped};return xm(t,e)}updateCameraSubtype(e,t){let n="perspective"===e?"PerspectiveCamera":"OrthographicCamera";void 0!==t.zoom&&this.setZoom(n,t.zoom),void 0!==t.near&&this.setNear(n,t.near),void 0!==t.fov&&"PerspectiveCamera"===n&&(this.fov=t.fov)}updateState(e,t){this.updateCameraState(e,t)}updateCameraState(e,t){this.updateState_Entity(e,t),void 0!==e.far&&(this.far=e.far),void 0!==e.orthographic&&this.updateCameraSubtype("orthographic",e.orthographic),void 0!==e.perspective&&this.updateCameraSubtype("perspective",e.perspective),void 0!==e.type&&(this.cameraType=e.type),void 0!==e.up&&this.up.fromArray(e.up),void 0!==e.targetOffset&&(this.targetOffset=e.targetOffset),void 0!==e.isUpVectorFlipped&&(this.isUpVectorFlipped=e.isUpVectorFlipped),this.updateProjectionMatrix()}updateByPatchedOp(e,t,n){super.updateByPatchedOp(e,t,n),1===e.path.length&&0===e.type&&this.updateCameraSubtype(e.path[0],e.props)}toState(e){return o(o(o({},super.toState(e)),this.toCameraState(e)),{},{type:this.cameraType})}},VO=new pn,GO=new pn;function HO(e){let t=!1;return e.scene.objects.traverse(((e,n)=>{var i;"BooleanGeometry"===(null===(i=n.geometry)||void 0===i?void 0:i.type)&&(t=!0)})),t}var WO,qO=class extends MD{constructor(e,t,n){super(e,t),this.data=t,this.meshSetAddresses=[],this.needsTransformForDownstream=!1,this.geometry=new di,this.onAfterRender=(e,t,n,i,r,s)=>{super.onAfterRender(e,t,n,i,r,s),this.recomputeBoolean()},this.geometry.userData.parameters={width:0,height:0,depth:0}}get booleanOp(){return this.data.geometry.operation}get phongAngle(){var e;return null!==(e=this.data.geometry.phongAngle)&&void 0!==e?e:45}get isLOD(){return this.recomputeBoolean(),!1}updateByPatchedOp(e,t,n){super.updateByPatchedOp(e,t,n),1===e.path.length&&"geometry"===e.path[0]&&0===e.type&&void 0!==e.props.operation&&(this.freeBooleanPointer(),this.resetBBoxNeedsUpdate())}freeBooleanPointer(){super.freeBooleanPointer(),this.geometry.dispose()}recomputeBoolean(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(-1!==this.booleanMeshSetAddress&&!e)return;for(let s=0;s<this.children.length;s++){let n=this.children[s];n instanceof qO&&!0===n.dataPatched.visible&&n.recomputeBoolean(!0===e,t)}this.meshSetAddresses=[];for(let s=0;s<this.children.length;s++){var n;let r=this.children[s];if(r instanceof UC&&!0===r.dataPatched.visible&&(null===(n=r.geometry.attributes.position)||void 0===n?void 0:n.count)>0&&r.geometry.drawRange.count>0&&0!==r.booleanMeshSetAddress){VO.multiplyMatrices(r.hiddenMatrix,r.matrix);try{if(-1===r.booleanMeshSetAddress){var i;if((null!==(i=r.geometry.index)&&void 0!==i?i:r.geometry.getAttribute("position")).count/3<15e5&&(r.booleanMeshSetAddress=vC.getMeshSet(r.geometry,!0===e,t)),-1===r.booleanMeshSetAddress)return;vC.transformMeshSet(r.booleanMeshSetAddress,VO),r.booleanMatrixInvOld.copy(VO).invert(),r.booleanWasTransformed=!1}else r instanceof qO&&!0===r.needsTransformForDownstream?(vC.transformMeshSet(r.booleanMeshSetAddress,VO),r.needsTransformForDownstream=!1):!0===r.booleanWasTransformed&&(vC.transformMeshSet(r.booleanMeshSetAddress,GO.multiplyMatrices(VO,r.booleanMatrixInvOld)),r.booleanMatrixInvOld.copy(VO).invert(),r.booleanWasTransformed=!1)}catch(jZ){console.error(jZ),r.booleanMeshSetAddress=0,r.geometry.userData.booleanOperationDidFail=!0;continue}!1===vC.hasOpenEdges(r.booleanMeshSetAddress)||s===this.children.length-1&&2===this.booleanOp?(this.meshSetAddresses.push(r.booleanMeshSetAddress),r.geometry.userData.booleanOperationDidFail=!1):r.geometry.userData.booleanOperationDidFail="openEdges"}}if(0===this.meshSetAddresses.length)return this.geometry.setAttribute("position",new ri([],0)),void this.geometry.setDrawRange(0,0);if(!0===e)return vC.calcBooleanTopological(this.meshSetAddresses,this.booleanOp);let r=this.geometry;r.dispose(),this.geometry=new di,this.geometry.userData=r.userData,this.geometry.boundingSphere=r.boundingSphere;try{this.booleanMeshSetAddress=vC.calcBoolean(this.meshSetAddresses,this.booleanOp,this.geometry,this.phongAngle)}catch(FZ){this.booleanMeshSetAddress=0,this.geometry.userData.booleanOperationDidFail=!0,console.error(FZ)}this.booleanMatrixInvOld.copy(this.matrix).invert(),this.needsTransformForDownstream=!0,kD(this),LD(this)}dispose(){super.dispose(),this.geometry.dispose()}};(e=>{e.is=function(e){return XS.is(e)&&e instanceof kl}})(WO||(WO={}));var XO=(e,t)=>class extends(kO(e,t)){updateState_Light(e,t){this.updateState_Entity(e,t),void 0!==e.color&&(this.color=t.shared.color(e.color)),void 0!==e.intensity&&(this.intensity=e.intensity),void 0!==e.depth&&(this.shadow.camera.far=e.depth,this.shadow.needsUpdate=!0),void 0!==e.shadows&&(this.castShadow=e.shadows)}},YO=e=>e instanceof UC,QO=e=>null!==e&&e instanceof qO,KO=e=>IO.is(e),ZO=new Bt(1,1,1),JO=new Bt,$O=new Bt,eI=new Lt,tI=class extends(_O(Bc)){constructor(e){super(arguments.length>1&&void 0!==arguments[1]?arguments[1]:15),this.object=e,this.dummy=new va,this.object.updateMatrixWorld(),this.name="EmptyObjectHelper: ".concat(e.uuid),this.matrix=this.dummy.matrixWorld,this.matrixAutoUpdate=!1,this.object.isBone&&(this.visible=!1)}raycast(e,t){MO(this.object,tI.geometryHelper,e,t,!1,this.dummy)}update(){}updateMatrix(){}updateMatrixWorld(e){this.object.matrixWorld.decompose(JO,eI,$O),this.matrix.compose(JO,eI,ZO),super.updateMatrixWorld(e)}updateWorldMatrix(e,t){}},nI=class extends(kO(va,tI)){constructor(e,t){super(),this.super_Entity(e,t),this.objectHelper.update()}updateState(e,t){this.updateState_Entity(e,t),"buffer"in e&&1===Object.keys(e).length&&t.scene.reloadSplats()}},iI=class extends(kO(va,tI)){constructor(e,t,n){super(),this.super_Entity(e,t),this.context=n,this.objectHelper.update()}updateState(e,t){this.updateState_Entity(e,t)}},rI=0,sI=1,aI="varying vec2 vUv;void main(){vUv=position.xy*0.5+0.5;gl_Position=vec4(position.xy,1.0,1.0);}",oI=class extends Ri{constructor(){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];super({name:"BokehMaterial",defines:{PASS:arguments.length>0&&void 0!==arguments[0]&&arguments[0]?"2":"1"},uniforms:{kernel64:new fc(null),kernel16:new fc(null),inputBuffer:new fc(null),cocBuffer:new fc(null),texelSize:new fc(new ot),scale:new fc(1)},blending:0,depthWrite:!1,depthTest:!1,fragmentShader:"#ifdef FRAMEBUFFER_PRECISION_HIGH\nuniform mediump sampler2D inputBuffer;\n#else\nuniform lowp sampler2D inputBuffer;\n#endif\nuniform lowp sampler2D cocBuffer;uniform vec2 texelSize;uniform float scale;uniform vec4 kernel64[32];varying vec2 vUv;void main(){\n#ifdef FOREGROUND\nvec2 CoCNearFar=texture2D(cocBuffer,vUv).rg;float CoC=CoCNearFar.r*scale;\n#else\nfloat CoC=texture2D(cocBuffer,vUv).g*scale;\n#endif\nif(CoC==0.0){gl_FragColor=texture2D(inputBuffer,vUv);}else{\n#ifdef FOREGROUND\nvec2 step=texelSize*max(CoC,CoCNearFar.g*scale);\n#else\nvec2 step=texelSize*CoC;\n#endif\nvec4 acc=vec4(0.0);for(int i=0;i<32;++i){vec4 kernel=kernel64[i];vec2 uv=step*kernel.xy+vUv;acc+=texture2D(inputBuffer,uv);uv=step*kernel.zw+vUv;acc+=texture2D(inputBuffer,uv);}gl_FragColor=acc/64.0;}}",vertexShader:aI}),this.toneMapped=!1,e&&(this.defines.FOREGROUND="1"),this.generateKernel()}set inputBuffer(e){this.uniforms.inputBuffer.value=e}setInputBuffer(e){this.uniforms.inputBuffer.value=e}set cocBuffer(e){this.uniforms.cocBuffer.value=e}setCoCBuffer(e){this.uniforms.cocBuffer.value=e}get scale(){return this.uniforms.scale.value}set scale(e){this.uniforms.scale.value=e}getScale(e){return this.uniforms.scale.value=e}setScale(e){this.uniforms.scale.value=e}generateKernel(){let e=new Float32Array(128),t=new Float32Array(32),n=0,i=0;for(let a=0;a<80;++a){let r=2.39996323*a,s=Math.sqrt(a)/Math.sqrt(80),o=s*Math.cos(r),l=s*Math.sin(r);a%5===0?(t[i++]=o,t[i++]=l):(e[n++]=o,e[n++]=l)}let r=[],s=[];for(let a=0;a<128;)r.push(new Ot(e[a++],e[a++],e[a++],e[a++]));for(let a=0;a<32;)s.push(new Ot(t[a++],t[a++],t[a++],t[a++]));this.uniforms.kernel64.value=r,this.uniforms.kernel16.value=s}setTexelSize(e,t){this.uniforms.texelSize.value.set(e,t)}setSize(e,t){this.uniforms.texelSize.value.set(1/e,1/t)}};function lI(e,t,n){return e*(t-n)-t}function cI(e,t,n){return Math.min(Math.max((e+t)/(t-n),0),1)}var hI=class extends Ri{constructor(e){super({name:"CircleOfConfusionMaterial",defines:{DEPTH_PACKING:"0"},uniforms:{depthBuffer:new fc(null),focusDistance:new fc(0),focusRange:new fc(0),cameraNear:new fc(.3),cameraFar:new fc(1e3)},blending:0,depthWrite:!1,depthTest:!1,fragmentShader:"#include <common>\n#include <packing>\n#ifdef GL_FRAGMENT_PRECISION_HIGH\nuniform highp sampler2D depthBuffer;\n#else\nuniform mediump sampler2D depthBuffer;\n#endif\nuniform float focusDistance;uniform float focusRange;uniform float cameraNear;uniform float cameraFar;varying vec2 vUv;float readDepth(const in vec2 uv){\n#if DEPTH_PACKING == 3201\nreturn unpackRGBAToDepth(texture2D(depthBuffer,uv));\n#else\nreturn texture2D(depthBuffer,uv).r;\n#endif\n}void main(){float depth=readDepth(vUv);\n#ifdef PERSPECTIVE_CAMERA\nfloat viewZ=perspectiveDepthToViewZ(depth,cameraNear,cameraFar);float linearDepth=viewZToOrthographicDepth(viewZ,cameraNear,cameraFar);\n#else\nfloat linearDepth=depth;\n#endif\nfloat signedDistance=linearDepth-focusDistance;float magnitude=smoothstep(0.0,focusRange,abs(signedDistance));gl_FragColor.rg=magnitude*vec2(step(signedDistance,0.0),step(0.0,signedDistance));}",vertexShader:aI}),this.toneMapped=!1,this.uniforms.focalLength=this.uniforms.focusRange,this.adoptCameraSettings(e)}get near(){return this.uniforms.cameraNear.value}get far(){return this.uniforms.cameraFar.value}set depthBuffer(e){this.uniforms.depthBuffer.value=e}set depthPacking(e){this.defines.DEPTH_PACKING=e.toFixed(0),this.needsUpdate=!0}setDepthBuffer(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Fe;this.depthBuffer=e,this.depthPacking=t}get focusDistance(){return this.uniforms.focusDistance.value}set focusDistance(e){this.uniforms.focusDistance.value=e}get worldFocusDistance(){return-lI(this.focusDistance,this.near,this.far)}set worldFocusDistance(e){this.focusDistance=cI(-e,this.near,this.far)}getFocusDistance(e){this.uniforms.focusDistance.value=e}setFocusDistance(e){this.uniforms.focusDistance.value=e}get focalLength(){return this.focusRange}set focalLength(e){this.focusRange=e}get focusRange(){return this.uniforms.focusRange.value}set focusRange(e){this.uniforms.focusRange.value=e}get worldFocusRange(){return-lI(this.focusRange,this.near,this.far)}set worldFocusRange(e){this.focusRange=cI(-e,this.near,this.far)}getFocalLength(e){return this.focusRange}setFocalLength(e){this.focusRange=e}adoptCameraSettings(e){e&&(this.uniforms.cameraNear.value=e.near,this.uniforms.cameraFar.value=e.far,e instanceof Li?this.defines.PERSPECTIVE_CAMERA="1":delete this.defines.PERSPECTIVE_CAMERA,this.needsUpdate=!0)}},uI=class extends Ri{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new ot;super({name:"KawaseBlurMaterial",uniforms:{inputBuffer:new fc(null),texelSize:new fc(new ot),halfTexelSize:new fc(new ot),kernel:new fc(0),scale:new fc(1)},blending:0,depthWrite:!1,depthTest:!1,fragmentShader:"#include <common>\n#include <dithering_pars_fragment>\n#ifdef FRAMEBUFFER_PRECISION_HIGH\nuniform mediump sampler2D inputBuffer;\n#else\nuniform lowp sampler2D inputBuffer;\n#endif\nvarying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;void main(){vec4 sum=texture2D(inputBuffer,vUv0);sum+=texture2D(inputBuffer,vUv1);sum+=texture2D(inputBuffer,vUv2);sum+=texture2D(inputBuffer,vUv3);gl_FragColor=sum*0.25;\n#include <encodings_fragment>\n#include <dithering_fragment>\n}",vertexShader:"uniform vec2 texelSize;uniform vec2 halfTexelSize;uniform float kernel;uniform float scale;varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;void main(){vec2 uv=position.xy*0.5+0.5;vec2 dUv=(texelSize*vec2(kernel)+halfTexelSize)*scale;vUv0=vec2(uv.x-dUv.x,uv.y+dUv.y);vUv1=vec2(uv.x+dUv.x,uv.y+dUv.y);vUv2=vec2(uv.x+dUv.x,uv.y-dUv.y);vUv3=vec2(uv.x-dUv.x,uv.y-dUv.y);gl_Position=vec4(position.xy,1.0,1.0);}"}),this.toneMapped=!1,this.setTexelSize(e.x,e.y)}set inputBuffer(e){this.uniforms.inputBuffer.value=e}setInputBuffer(e){this.inputBuffer=e}get scale(){return this.uniforms.scale.value}set scale(e){this.uniforms.scale.value=e}getScale(){return this.uniforms.scale.value}setScale(e){this.uniforms.scale.value=e}getKernel(){return null}get kernel(){return this.uniforms.kernel.value}set kernel(e){this.uniforms.kernel.value=e}setKernel(e){this.kernel=e}setTexelSize(e,t){this.uniforms.texelSize.value.set(e,t),this.uniforms.halfTexelSize.value.set(e,t).multiplyScalar(.5)}setSize(e,t){let n=this.uniforms;n.texelSize.value.set(1/e,1/t),n.halfTexelSize.value.copy(n.texelSize.value).multiplyScalar(.5)}},dI=class extends Ri{constructor(){super({name:"CopyMaterial",uniforms:{inputBuffer:new fc(null),opacity:new fc(1)},blending:0,depthWrite:!1,depthTest:!1,fragmentShader:"#ifdef FRAMEBUFFER_PRECISION_HIGH\nuniform mediump sampler2D inputBuffer;\n#else\nuniform lowp sampler2D inputBuffer;\n#endif\nuniform float opacity;varying vec2 vUv;void main(){vec4 texel=texture2D(inputBuffer,vUv);gl_FragColor=opacity*texel;\n#include <encodings_fragment>\n}",vertexShader:aI}),this.toneMapped=!1}set inputBuffer(e){this.uniforms.inputBuffer.value=e}setInputBuffer(e){this.uniforms.inputBuffer.value=e}getOpacity(e){return this.uniforms.opacity.value}setOpacity(e){this.uniforms.opacity.value=e}},pI={DEPTH:0,LUMA:1,COLOR:2},fI={DISABLED:0,DEPTH:1,CUSTOM:2},mI=class extends Ri{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new ot,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:pI.COLOR;super({name:"EdgeDetectionMaterial",defines:{THREE_REVISION:k.replace(/\D+/g,""),LOCAL_CONTRAST_ADAPTATION_FACTOR:"2.0",EDGE_THRESHOLD:"0.1",DEPTH_THRESHOLD:"0.01",PREDICATION_MODE:"0",PREDICATION_THRESHOLD:"0.01",PREDICATION_SCALE:"2.0",PREDICATION_STRENGTH:"1.0",DEPTH_PACKING:"0"},uniforms:{inputBuffer:new fc(null),depthBuffer:new fc(null),predicationBuffer:new fc(null),texelSize:new fc(e)},blending:0,depthWrite:!1,depthTest:!1,fragmentShader:"varying vec2 vUv;varying vec2 vUv0;varying vec2 vUv1;\n#if THREE_REVISION < 143\n#define luminance(v) linearToRelativeLuminance(v)\n#endif\n#if EDGE_DETECTION_MODE != 0\nvarying vec2 vUv2;varying vec2 vUv3;varying vec2 vUv4;varying vec2 vUv5;\n#endif\n#if EDGE_DETECTION_MODE == 1\n#include <common>\n#endif\n#if EDGE_DETECTION_MODE == 0 || PREDICATION_MODE == 1\n#ifdef GL_FRAGMENT_PRECISION_HIGH\nuniform highp sampler2D depthBuffer;\n#else\nuniform mediump sampler2D depthBuffer;\n#endif\nfloat readDepth(const in vec2 uv){\n#if DEPTH_PACKING == 3201\nreturn unpackRGBAToDepth(texture2D(depthBuffer,uv));\n#else\nreturn texture2D(depthBuffer,uv).r;\n#endif\n}vec3 gatherNeighbors(){float p=readDepth(vUv);float pLeft=readDepth(vUv0);float pTop=readDepth(vUv1);return vec3(p,pLeft,pTop);}\n#elif PREDICATION_MODE == 2\nuniform sampler2D predicationBuffer;vec3 gatherNeighbors(){float p=texture2D(predicationBuffer,vUv).r;float pLeft=texture2D(predicationBuffer,vUv0).r;float pTop=texture2D(predicationBuffer,vUv1).r;return vec3(p,pLeft,pTop);}\n#endif\n#if PREDICATION_MODE != 0\nvec2 calculatePredicatedThreshold(){vec3 neighbours=gatherNeighbors();vec2 delta=abs(neighbours.xx-neighbours.yz);vec2 edges=step(PREDICATION_THRESHOLD,delta);return PREDICATION_SCALE*EDGE_THRESHOLD*(1.0-PREDICATION_STRENGTH*edges);}\n#endif\n#if EDGE_DETECTION_MODE != 0\nuniform sampler2D inputBuffer;\n#endif\nvoid main(){\n#if EDGE_DETECTION_MODE == 0\nconst vec2 threshold=vec2(DEPTH_THRESHOLD);\n#elif PREDICATION_MODE != 0\nvec2 threshold=calculatePredicatedThreshold();\n#else\nconst vec2 threshold=vec2(EDGE_THRESHOLD);\n#endif\n#if EDGE_DETECTION_MODE == 0\nvec3 neighbors=gatherNeighbors();vec2 delta=abs(neighbors.xx-vec2(neighbors.y,neighbors.z));vec2 edges=step(threshold,delta);if(dot(edges,vec2(1.0))==0.0){discard;}gl_FragColor=vec4(edges,0.0,1.0);\n#elif EDGE_DETECTION_MODE == 1\nfloat l=luminance(texture2D(inputBuffer,vUv).rgb);float lLeft=luminance(texture2D(inputBuffer,vUv0).rgb);float lTop=luminance(texture2D(inputBuffer,vUv1).rgb);vec4 delta;delta.xy=abs(l-vec2(lLeft,lTop));vec2 edges=step(threshold,delta.xy);if(dot(edges,vec2(1.0))==0.0){discard;}float lRight=luminance(texture2D(inputBuffer,vUv2).rgb);float lBottom=luminance(texture2D(inputBuffer,vUv3).rgb);delta.zw=abs(l-vec2(lRight,lBottom));vec2 maxDelta=max(delta.xy,delta.zw);float lLeftLeft=luminance(texture2D(inputBuffer,vUv4).rgb);float lTopTop=luminance(texture2D(inputBuffer,vUv5).rgb);delta.zw=abs(vec2(lLeft,lTop)-vec2(lLeftLeft,lTopTop));maxDelta=max(maxDelta.xy,delta.zw);float finalDelta=max(maxDelta.x,maxDelta.y);edges.xy*=step(finalDelta,LOCAL_CONTRAST_ADAPTATION_FACTOR*delta.xy);gl_FragColor=vec4(edges,0.0,1.0);\n#elif EDGE_DETECTION_MODE == 2\nvec4 delta;vec3 c=texture2D(inputBuffer,vUv).rgb;vec3 cLeft=texture2D(inputBuffer,vUv0).rgb;vec3 t=abs(c-cLeft);delta.x=max(max(t.r,t.g),t.b);vec3 cTop=texture2D(inputBuffer,vUv1).rgb;t=abs(c-cTop);delta.y=max(max(t.r,t.g),t.b);vec2 edges=step(threshold,delta.xy);if(dot(edges,vec2(1.0))==0.0){discard;}vec3 cRight=texture2D(inputBuffer,vUv2).rgb;t=abs(c-cRight);delta.z=max(max(t.r,t.g),t.b);vec3 cBottom=texture2D(inputBuffer,vUv3).rgb;t=abs(c-cBottom);delta.w=max(max(t.r,t.g),t.b);vec2 maxDelta=max(delta.xy,delta.zw);vec3 cLeftLeft=texture2D(inputBuffer,vUv4).rgb;t=abs(c-cLeftLeft);delta.z=max(max(t.r,t.g),t.b);vec3 cTopTop=texture2D(inputBuffer,vUv5).rgb;t=abs(c-cTopTop);delta.w=max(max(t.r,t.g),t.b);maxDelta=max(maxDelta.xy,delta.zw);float finalDelta=max(maxDelta.x,maxDelta.y);edges*=step(finalDelta,LOCAL_CONTRAST_ADAPTATION_FACTOR*delta.xy);gl_FragColor=vec4(edges,0.0,1.0);\n#endif\n}",vertexShader:"uniform vec2 texelSize;varying vec2 vUv;varying vec2 vUv0;varying vec2 vUv1;\n#if EDGE_DETECTION_MODE != 0\nvarying vec2 vUv2;varying vec2 vUv3;varying vec2 vUv4;varying vec2 vUv5;\n#endif\nvoid main(){vUv=position.xy*0.5+0.5;vUv0=vUv+texelSize*vec2(-1.0,0.0);vUv1=vUv+texelSize*vec2(0.0,-1.0);\n#if EDGE_DETECTION_MODE != 0\nvUv2=vUv+texelSize*vec2(1.0,0.0);vUv3=vUv+texelSize*vec2(0.0,1.0);vUv4=vUv+texelSize*vec2(-2.0,0.0);vUv5=vUv+texelSize*vec2(0.0,-2.0);\n#endif\ngl_Position=vec4(position.xy,1.0,1.0);}"}),this.toneMapped=!1,this.edgeDetectionMode=t}set depthBuffer(e){this.uniforms.depthBuffer.value=e}set depthPacking(e){this.defines.DEPTH_PACKING=e.toFixed(0),this.needsUpdate=!0}setDepthBuffer(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Fe;this.depthBuffer=e,this.depthPacking=t}get edgeDetectionMode(){return Number(this.defines.EDGE_DETECTION_MODE)}set edgeDetectionMode(e){this.defines.EDGE_DETECTION_MODE=e.toFixed(0),this.needsUpdate=!0}getEdgeDetectionMode(){return this.edgeDetectionMode}setEdgeDetectionMode(e){this.edgeDetectionMode=e}get localContrastAdaptationFactor(){return Number(this.defines.LOCAL_CONTRAST_ADAPTATION_FACTOR)}set localContrastAdaptationFactor(e){this.defines.LOCAL_CONTRAST_ADAPTATION_FACTOR=e.toFixed("6"),this.needsUpdate=!0}getLocalContrastAdaptationFactor(){return this.localContrastAdaptationFactor}setLocalContrastAdaptationFactor(e){this.localContrastAdaptationFactor=e}get edgeDetectionThreshold(){return Number(this.defines.EDGE_THRESHOLD)}set edgeDetectionThreshold(e){this.defines.EDGE_THRESHOLD=e.toFixed("6"),this.defines.DEPTH_THRESHOLD=(.1*e).toFixed("6"),this.needsUpdate=!0}getEdgeDetectionThreshold(){return this.edgeDetectionThreshold}setEdgeDetectionThreshold(e){this.edgeDetectionThreshold=e}get predicationMode(){return Number(this.defines.PREDICATION_MODE)}set predicationMode(e){this.defines.PREDICATION_MODE=e.toFixed(0),this.needsUpdate=!0}getPredicationMode(){return this.predicationMode}setPredicationMode(e){this.predicationMode=e}set predicationBuffer(e){this.uniforms.predicationBuffer.value=e}setPredicationBuffer(e){this.uniforms.predicationBuffer.value=e}get predicationThreshold(){return Number(this.defines.PREDICATION_THRESHOLD)}set predicationThreshold(e){this.defines.PREDICATION_THRESHOLD=e.toFixed("6"),this.needsUpdate=!0}getPredicationThreshold(){return this.predicationThreshold}setPredicationThreshold(e){this.predicationThreshold=e}get predicationScale(){return Number(this.defines.PREDICATION_SCALE)}set predicationScale(e){this.defines.PREDICATION_SCALE=e.toFixed("6"),this.needsUpdate=!0}getPredicationScale(){return this.predicationScale}setPredicationScale(e){this.predicationScale=e}get predicationStrength(){return Number(this.defines.PREDICATION_STRENGTH)}set predicationStrength(e){this.defines.PREDICATION_STRENGTH=e.toFixed("6"),this.needsUpdate=!0}getPredicationStrength(){return this.predicationStrength}setPredicationStrength(e){this.predicationStrength=e}setSize(e,t){this.uniforms.texelSize.value.set(1/e,1/t)}},gI={FRAGMENT_HEAD:"FRAGMENT_HEAD",FRAGMENT_MAIN_UV:"FRAGMENT_MAIN_UV",FRAGMENT_MAIN_IMAGE:"FRAGMENT_MAIN_IMAGE",VERTEX_HEAD:"VERTEX_HEAD",VERTEX_MAIN_SUPPORT:"VERTEX_MAIN_SUPPORT"},vI=class extends Ri{constructor(e,t,n,i){let r=arguments.length>4&&void 0!==arguments[4]&&arguments[4];super({name:"EffectMaterial",defines:{THREE_REVISION:k.replace(/\D+/g,""),DEPTH_PACKING:"0",ENCODE_OUTPUT:"1"},uniforms:{inputBuffer:new fc(null),depthBuffer:new fc(null),resolution:new fc(new ot),texelSize:new fc(new ot),cameraNear:new fc(.3),cameraFar:new fc(1e3),aspect:new fc(1),time:new fc(0)},blending:0,depthWrite:!1,depthTest:!1,dithering:r}),this.toneMapped=!1,e&&this.setShaderParts(e),t&&this.setDefines(t),n&&this.setUniforms(n),this.adoptCameraSettings(i)}set inputBuffer(e){this.uniforms.inputBuffer.value=e}setInputBuffer(e){this.uniforms.inputBuffer.value=e}get depthBuffer(){return this.uniforms.depthBuffer.value}set depthBuffer(e){this.uniforms.depthBuffer.value=e}get depthPacking(){return Number(this.defines.DEPTH_PACKING)}set depthPacking(e){this.defines.DEPTH_PACKING=e.toFixed(0),this.needsUpdate=!0}setDepthBuffer(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Fe;this.depthBuffer=e,this.depthPacking=t}setShaderParts(e){return this.fragmentShader="#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#define packFloatToRGBA(v) packDepthToRGBA(v)\n#define unpackRGBAToFloat(v) unpackRGBAToDepth(v)\n#ifdef FRAMEBUFFER_PRECISION_HIGH\nuniform mediump sampler2D inputBuffer;\n#else\nuniform lowp sampler2D inputBuffer;\n#endif\n#ifdef GL_FRAGMENT_PRECISION_HIGH\nuniform highp sampler2D depthBuffer;\n#else\nuniform mediump sampler2D depthBuffer;\n#endif\nuniform vec2 resolution;uniform vec2 texelSize;uniform float cameraNear;uniform float cameraFar;uniform float aspect;uniform float time;varying vec2 vUv;\n#if THREE_REVISION < 143\n#define luminance(v) linearToRelativeLuminance(v)\n#endif\n#if THREE_REVISION >= 137\nvec4 sRGBToLinear(const in vec4 value){return vec4(mix(pow(value.rgb*0.9478672986+vec3(0.0521327014),vec3(2.4)),value.rgb*0.0773993808,vec3(lessThanEqual(value.rgb,vec3(0.04045)))),value.a);}\n#endif\nfloat readDepth(const in vec2 uv){\n#if DEPTH_PACKING == 3201\nreturn unpackRGBAToDepth(texture2D(depthBuffer,uv));\n#else\nreturn texture2D(depthBuffer,uv).r;\n#endif\n}float getViewZ(const in float depth){\n#ifdef PERSPECTIVE_CAMERA\nreturn perspectiveDepthToViewZ(depth,cameraNear,cameraFar);\n#else\nreturn orthographicDepthToViewZ(depth,cameraNear,cameraFar);\n#endif\n}FRAGMENT_HEADvoid main(){FRAGMENT_MAIN_UVvec4 color0=texture2D(inputBuffer,UV);vec4 color1=vec4(0.0);FRAGMENT_MAIN_IMAGEgl_FragColor=color0;\n#ifdef ENCODE_OUTPUT\n#include <encodings_fragment>\n#endif\n#include <dithering_fragment>\n}".replace(gI.FRAGMENT_HEAD,e.get(gI.FRAGMENT_HEAD)).replace(gI.FRAGMENT_MAIN_UV,e.get(gI.FRAGMENT_MAIN_UV)).replace(gI.FRAGMENT_MAIN_IMAGE,e.get(gI.FRAGMENT_MAIN_IMAGE)),this.vertexShader="uniform vec2 resolution;uniform vec2 texelSize;uniform float cameraNear;uniform float cameraFar;uniform float aspect;uniform float time;varying vec2 vUv;VERTEX_HEADvoid main(){vUv=position.xy*0.5+0.5;VERTEX_MAIN_SUPPORTgl_Position=vec4(position.xy,1.0,1.0);}".replace(gI.VERTEX_HEAD,e.get(gI.VERTEX_HEAD)).replace(gI.VERTEX_MAIN_SUPPORT,e.get(gI.VERTEX_MAIN_SUPPORT)),this.needsUpdate=!0,this}setDefines(e){for(let t of e.entries())this.defines[t[0]]=t[1];return this.needsUpdate=!0,this}setUniforms(e){for(let t of e.entries())this.uniforms[t[0]]=t[1];return this}setExtensions(e){this.extensions={};for(let t of e)this.extensions[t]=!0;return this}get encodeOutput(){return void 0!==this.defines.ENCODE_OUTPUT}set encodeOutput(e){this.encodeOutput!==e&&(e?this.defines.ENCODE_OUTPUT="1":delete this.defines.ENCODE_OUTPUT,this.needsUpdate=!0)}isOutputEncodingEnabled(e){return this.encodeOutput}setOutputEncodingEnabled(e){this.encodeOutput=e}get time(){return this.uniforms.time.value}set time(e){this.uniforms.time.value=e}setDeltaTime(e){this.uniforms.time.value+=e}adoptCameraSettings(e){e&&(this.uniforms.cameraNear.value=e.near,this.uniforms.cameraFar.value=e.far,e instanceof Li?this.defines.PERSPECTIVE_CAMERA="1":delete this.defines.PERSPECTIVE_CAMERA,this.needsUpdate=!0)}setSize(e,t){let n=this.uniforms;n.resolution.value.set(e,t),n.texelSize.value.set(1/e,1/t),n.aspect.value=e/t}static get Section(){return gI}},yI=class extends Ri{constructor(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;super({name:"LuminanceMaterial",defines:{THREE_REVISION:k.replace(/\D+/g,"")},uniforms:{inputBuffer:new fc(null),threshold:new fc(0),smoothing:new fc(1),range:new fc(null)},blending:0,depthWrite:!1,depthTest:!1,fragmentShader:"#include <common>\n#if THREE_REVISION < 143\n#define luminance(v) linearToRelativeLuminance(v)\n#endif\n#ifdef FRAMEBUFFER_PRECISION_HIGH\nuniform mediump sampler2D inputBuffer;\n#else\nuniform lowp sampler2D inputBuffer;\n#endif\n#ifdef RANGE\nuniform vec2 range;\n#elif defined(THRESHOLD)\nuniform float threshold;uniform float smoothing;\n#endif\nvarying vec2 vUv;void main(){vec4 texel=texture2D(inputBuffer,vUv);float l=luminance(texel.rgb);\n#ifdef RANGE\nfloat low=step(range.x,l);float high=step(l,range.y);l*=low*high;\n#elif defined(THRESHOLD)\nl=smoothstep(threshold,threshold+smoothing,l);\n#endif\n#ifdef COLOR\ngl_FragColor=vec4(texel.rgb*l,l);\n#else\ngl_FragColor=vec4(l);\n#endif\n}",vertexShader:aI}),this.toneMapped=!1,this.colorOutput=e,this.luminanceRange=t}set inputBuffer(e){this.uniforms.inputBuffer.value=e}setInputBuffer(e){this.uniforms.inputBuffer.value=e}get threshold(){return this.uniforms.threshold.value}set threshold(e){this.smoothing>0||e>0?this.defines.THRESHOLD="1":delete this.defines.THRESHOLD,this.uniforms.threshold.value=e}getThreshold(){return this.threshold}setThreshold(e){this.threshold=e}get smoothing(){return this.uniforms.smoothing.value}set smoothing(e){this.threshold>0||e>0?this.defines.THRESHOLD="1":delete this.defines.THRESHOLD,this.uniforms.smoothing.value=e}getSmoothingFactor(){return this.smoothing}setSmoothingFactor(e){this.smoothing=e}get useThreshold(){return this.threshold>0||this.smoothing>0}set useThreshold(e){}get colorOutput(){return void 0!==this.defines.COLOR}set colorOutput(e){e?this.defines.COLOR="1":delete this.defines.COLOR,this.needsUpdate=!0}isColorOutputEnabled(e){return this.colorOutput}setColorOutputEnabled(e){this.colorOutput=e}get useRange(){return null!==this.luminanceRange}set useRange(e){this.luminanceRange=null}get luminanceRange(){return this.uniforms.range.value}set luminanceRange(e){null!==e?this.defines.RANGE="1":delete this.defines.RANGE,this.uniforms.range.value=e,this.needsUpdate=!0}getLuminanceRange(){return this.luminanceRange}setLuminanceRange(e){this.luminanceRange=e}},bI=0,xI=1,wI=class extends Ri{constructor(){super({name:"MaskMaterial",uniforms:{maskTexture:new fc(arguments.length>0&&void 0!==arguments[0]?arguments[0]:null),inputBuffer:new fc(null),strength:new fc(1)},blending:0,depthWrite:!1,depthTest:!1,fragmentShader:"#ifdef FRAMEBUFFER_PRECISION_HIGH\nuniform mediump sampler2D inputBuffer;\n#else\nuniform lowp sampler2D inputBuffer;\n#endif\n#ifdef MASK_PRECISION_HIGH\nuniform mediump sampler2D maskTexture;\n#else\nuniform lowp sampler2D maskTexture;\n#endif\n#if MASK_FUNCTION != 0\nuniform float strength;\n#endif\nvarying vec2 vUv;void main(){\n#if COLOR_CHANNEL == 0\nfloat mask=texture2D(maskTexture,vUv).r;\n#elif COLOR_CHANNEL == 1\nfloat mask=texture2D(maskTexture,vUv).g;\n#elif COLOR_CHANNEL == 2\nfloat mask=texture2D(maskTexture,vUv).b;\n#else\nfloat mask=texture2D(maskTexture,vUv).a;\n#endif\n#if MASK_FUNCTION == 0\n#ifdef INVERTED\nmask=step(mask,0.0);\n#else\nmask=1.0-step(mask,0.0);\n#endif\n#else\nmask=clamp(mask*strength,0.0,1.0);\n#ifdef INVERTED\nmask=1.0-mask;\n#endif\n#endif\n#if MASK_FUNCTION == 2\ngl_FragColor=vec4(mask*texture2D(inputBuffer,vUv).rgb,mask);\n#else\ngl_FragColor=mask*texture2D(inputBuffer,vUv);\n#endif\n}",vertexShader:aI}),this.toneMapped=!1,this.setColorChannel(rI),this.setMaskFunction(bI)}set inputBuffer(e){this.uniforms.inputBuffer.value=e}setInputBuffer(e){this.uniforms.inputBuffer.value=e}set maskTexture(e){this.uniforms.maskTexture.value=e,delete this.defines.MASK_PRECISION_HIGH,e.type!==fe&&(this.defines.MASK_PRECISION_HIGH="1"),this.needsUpdate=!0}setMaskTexture(e){this.maskTexture=e}set colorChannel(e){this.defines.COLOR_CHANNEL=e.toFixed(0),this.needsUpdate=!0}setColorChannel(e){this.colorChannel=e}set maskFunction(e){this.defines.MASK_FUNCTION=e.toFixed(0),this.needsUpdate=!0}setMaskFunction(e){this.maskFunction=e}get inverted(){return void 0!==this.defines.INVERTED}set inverted(e){this.inverted&&!e?delete this.defines.INVERTED:e&&(this.defines.INVERTED="1"),this.needsUpdate=!0}isInverted(){return this.inverted}setInverted(e){this.inverted=e}get strength(){return this.uniforms.strength.value}set strength(e){this.uniforms.strength.value=e}getStrength(){return this.strength}setStrength(e){this.strength=e}},SI=class extends Ri{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new ot,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new ot;super({name:"SMAAWeightsMaterial",defines:{MAX_SEARCH_STEPS_INT:"16",MAX_SEARCH_STEPS_FLOAT:"16.0",MAX_SEARCH_STEPS_DIAG_INT:"8",MAX_SEARCH_STEPS_DIAG_FLOAT:"8.0",CORNER_ROUNDING:"25",CORNER_ROUNDING_NORM:"0.25",AREATEX_MAX_DISTANCE:"16.0",AREATEX_MAX_DISTANCE_DIAG:"20.0",AREATEX_PIXEL_SIZE:"(1.0 / vec2(160.0, 560.0))",AREATEX_SUBTEX_SIZE:"(1.0 / 7.0)",SEARCHTEX_SIZE:"vec2(66.0, 33.0)",SEARCHTEX_PACKED_SIZE:"vec2(64.0, 16.0)"},uniforms:{inputBuffer:new fc(null),searchTexture:new fc(null),areaTexture:new fc(null),resolution:new fc(t),texelSize:new fc(e)},blending:0,depthWrite:!1,depthTest:!1,fragmentShader:"#define sampleLevelZeroOffset(t, coord, offset) texture2D(t, coord + offset * texelSize)\n#if __VERSION__ < 300\n#define round(v) floor(v + 0.5)\n#endif\n#ifdef FRAMEBUFFER_PRECISION_HIGH\nuniform mediump sampler2D inputBuffer;\n#else\nuniform lowp sampler2D inputBuffer;\n#endif\nuniform lowp sampler2D areaTexture;uniform lowp sampler2D searchTexture;uniform vec2 texelSize;uniform vec2 resolution;varying vec2 vUv;varying vec4 vOffset[3];varying vec2 vPixCoord;void movec(const in bvec2 c,inout vec2 variable,const in vec2 value){if(c.x){variable.x=value.x;}if(c.y){variable.y=value.y;}}void movec(const in bvec4 c,inout vec4 variable,const in vec4 value){movec(c.xy,variable.xy,value.xy);movec(c.zw,variable.zw,value.zw);}vec2 decodeDiagBilinearAccess(in vec2 e){e.r=e.r*abs(5.0*e.r-5.0*0.75);return round(e);}vec4 decodeDiagBilinearAccess(in vec4 e){e.rb=e.rb*abs(5.0*e.rb-5.0*0.75);return round(e);}vec2 searchDiag1(const in vec2 texCoord,const in vec2 dir,out vec2 e){vec4 coord=vec4(texCoord,-1.0,1.0);vec3 t=vec3(texelSize,1.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;++i){if(!(coord.z<float(MAX_SEARCH_STEPS_DIAG_INT-1)&&coord.w>0.9)){break;}coord.xyz=t*vec3(dir,1.0)+coord.xyz;e=texture2D(inputBuffer,coord.xy).rg;coord.w=dot(e,vec2(0.5));}return coord.zw;}vec2 searchDiag2(const in vec2 texCoord,const in vec2 dir,out vec2 e){vec4 coord=vec4(texCoord,-1.0,1.0);coord.x+=0.25*texelSize.x;vec3 t=vec3(texelSize,1.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;++i){if(!(coord.z<float(MAX_SEARCH_STEPS_DIAG_INT-1)&&coord.w>0.9)){break;}coord.xyz=t*vec3(dir,1.0)+coord.xyz;e=texture2D(inputBuffer,coord.xy).rg;e=decodeDiagBilinearAccess(e);coord.w=dot(e,vec2(0.5));}return coord.zw;}vec2 areaDiag(const in vec2 dist,const in vec2 e,const in float offset){vec2 texCoord=vec2(AREATEX_MAX_DISTANCE_DIAG,AREATEX_MAX_DISTANCE_DIAG)*e+dist;texCoord=AREATEX_PIXEL_SIZE*texCoord+0.5*AREATEX_PIXEL_SIZE;texCoord.x+=0.5;texCoord.y+=AREATEX_SUBTEX_SIZE*offset;return texture2D(areaTexture,texCoord).rg;}vec2 calculateDiagWeights(const in vec2 texCoord,const in vec2 e,const in vec4 subsampleIndices){vec2 weights=vec2(0.0);vec4 d;vec2 end;if(e.r>0.0){d.xz=searchDiag1(texCoord,vec2(-1.0,1.0),end);d.x+=float(end.y>0.9);}else{d.xz=vec2(0.0);}d.yw=searchDiag1(texCoord,vec2(1.0,-1.0),end);if(d.x+d.y>2.0){vec4 coords=vec4(-d.x+0.25,d.x,d.y,-d.y-0.25)*texelSize.xyxy+texCoord.xyxy;vec4 c;c.xy=sampleLevelZeroOffset(inputBuffer,coords.xy,vec2(-1,0)).rg;c.zw=sampleLevelZeroOffset(inputBuffer,coords.zw,vec2(1,0)).rg;c.yxwz=decodeDiagBilinearAccess(c.xyzw);vec2 cc=vec2(2.0)*c.xz+c.yw;movec(bvec2(step(0.9,d.zw)),cc,vec2(0.0));weights+=areaDiag(d.xy,cc,subsampleIndices.z);}d.xz=searchDiag2(texCoord,vec2(-1.0,-1.0),end);if(sampleLevelZeroOffset(inputBuffer,texCoord,vec2(1,0)).r>0.0){d.yw=searchDiag2(texCoord,vec2(1.0),end);d.y+=float(end.y>0.9);}else{d.yw=vec2(0.0);}if(d.x+d.y>2.0){vec4 coords=vec4(-d.x,-d.x,d.y,d.y)*texelSize.xyxy+texCoord.xyxy;vec4 c;c.x=sampleLevelZeroOffset(inputBuffer,coords.xy,vec2(-1,0)).g;c.y=sampleLevelZeroOffset(inputBuffer,coords.xy,vec2(0,-1)).r;c.zw=sampleLevelZeroOffset(inputBuffer,coords.zw,vec2(1,0)).gr;vec2 cc=vec2(2.0)*c.xz+c.yw;movec(bvec2(step(0.9,d.zw)),cc,vec2(0.0));weights+=areaDiag(d.xy,cc,subsampleIndices.w).gr;}return weights;}float searchLength(const in vec2 e,const in float offset){vec2 scale=SEARCHTEX_SIZE*vec2(0.5,-1.0);vec2 bias=SEARCHTEX_SIZE*vec2(offset,1.0);scale+=vec2(-1.0,1.0);bias+=vec2(0.5,-0.5);scale*=1.0/SEARCHTEX_PACKED_SIZE;bias*=1.0/SEARCHTEX_PACKED_SIZE;return texture2D(searchTexture,scale*e+bias).r;}float searchXLeft(in vec2 texCoord,const in float end){vec2 e=vec2(0.0,1.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;++i){if(!(texCoord.x>end&&e.g>0.8281&&e.r==0.0)){break;}e=texture2D(inputBuffer,texCoord).rg;texCoord=vec2(-2.0,0.0)*texelSize+texCoord;}float offset=-(255.0/127.0)*searchLength(e,0.0)+3.25;return texelSize.x*offset+texCoord.x;}float searchXRight(vec2 texCoord,const in float end){vec2 e=vec2(0.0,1.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;++i){if(!(texCoord.x<end&&e.g>0.8281&&e.r==0.0)){break;}e=texture2D(inputBuffer,texCoord).rg;texCoord=vec2(2.0,0.0)*texelSize.xy+texCoord;}float offset=-(255.0/127.0)*searchLength(e,0.5)+3.25;return-texelSize.x*offset+texCoord.x;}float searchYUp(vec2 texCoord,const in float end){vec2 e=vec2(1.0,0.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;++i){if(!(texCoord.y>end&&e.r>0.8281&&e.g==0.0)){break;}e=texture2D(inputBuffer,texCoord).rg;texCoord=-vec2(0.0,2.0)*texelSize.xy+texCoord;}float offset=-(255.0/127.0)*searchLength(e.gr,0.0)+3.25;return texelSize.y*offset+texCoord.y;}float searchYDown(vec2 texCoord,const in float end){vec2 e=vec2(1.0,0.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;i++){if(!(texCoord.y<end&&e.r>0.8281&&e.g==0.0)){break;}e=texture2D(inputBuffer,texCoord).rg;texCoord=vec2(0.0,2.0)*texelSize.xy+texCoord;}float offset=-(255.0/127.0)*searchLength(e.gr,0.5)+3.25;return-texelSize.y*offset+texCoord.y;}vec2 area(const in vec2 dist,const in float e1,const in float e2,const in float offset){vec2 texCoord=vec2(AREATEX_MAX_DISTANCE)*round(4.0*vec2(e1,e2))+dist;texCoord=AREATEX_PIXEL_SIZE*texCoord+0.5*AREATEX_PIXEL_SIZE;texCoord.y=AREATEX_SUBTEX_SIZE*offset+texCoord.y;return texture2D(areaTexture,texCoord).rg;}void detectHorizontalCornerPattern(inout vec2 weights,const in vec4 texCoord,const in vec2 d){\n#if !defined(DISABLE_CORNER_DETECTION)\nvec2 leftRight=step(d.xy,d.yx);vec2 rounding=(1.0-CORNER_ROUNDING_NORM)*leftRight;rounding/=leftRight.x+leftRight.y;vec2 factor=vec2(1.0);factor.x-=rounding.x*sampleLevelZeroOffset(inputBuffer,texCoord.xy,vec2(0,1)).r;factor.x-=rounding.y*sampleLevelZeroOffset(inputBuffer,texCoord.zw,vec2(1,1)).r;factor.y-=rounding.x*sampleLevelZeroOffset(inputBuffer,texCoord.xy,vec2(0,-2)).r;factor.y-=rounding.y*sampleLevelZeroOffset(inputBuffer,texCoord.zw,vec2(1,-2)).r;weights*=clamp(factor,0.0,1.0);\n#endif\n}void detectVerticalCornerPattern(inout vec2 weights,const in vec4 texCoord,const in vec2 d){\n#if !defined(DISABLE_CORNER_DETECTION)\nvec2 leftRight=step(d.xy,d.yx);vec2 rounding=(1.0-CORNER_ROUNDING_NORM)*leftRight;rounding/=leftRight.x+leftRight.y;vec2 factor=vec2(1.0);factor.x-=rounding.x*sampleLevelZeroOffset(inputBuffer,texCoord.xy,vec2(1,0)).g;factor.x-=rounding.y*sampleLevelZeroOffset(inputBuffer,texCoord.zw,vec2(1,1)).g;factor.y-=rounding.x*sampleLevelZeroOffset(inputBuffer,texCoord.xy,vec2(-2,0)).g;factor.y-=rounding.y*sampleLevelZeroOffset(inputBuffer,texCoord.zw,vec2(-2,1)).g;weights*=clamp(factor,0.0,1.0);\n#endif\n}void main(){vec4 weights=vec4(0.0);vec4 subsampleIndices=vec4(0.0);vec2 e=texture2D(inputBuffer,vUv).rg;if(e.g>0.0){\n#if !defined(DISABLE_DIAG_DETECTION)\nweights.rg=calculateDiagWeights(vUv,e,subsampleIndices);if(weights.r==-weights.g){\n#endif\nvec2 d;vec3 coords;coords.x=searchXLeft(vOffset[0].xy,vOffset[2].x);coords.y=vOffset[1].y;d.x=coords.x;float e1=texture2D(inputBuffer,coords.xy).r;coords.z=searchXRight(vOffset[0].zw,vOffset[2].y);d.y=coords.z;d=round(resolution.xx*d+-vPixCoord.xx);vec2 sqrtD=sqrt(abs(d));float e2=sampleLevelZeroOffset(inputBuffer,coords.zy,vec2(1,0)).r;weights.rg=area(sqrtD,e1,e2,subsampleIndices.y);coords.y=vUv.y;detectHorizontalCornerPattern(weights.rg,coords.xyzy,d);\n#if !defined(DISABLE_DIAG_DETECTION)\n}else{e.r=0.0;}\n#endif\n}if(e.r>0.0){vec2 d;vec3 coords;coords.y=searchYUp(vOffset[1].xy,vOffset[2].z);coords.x=vOffset[0].x;d.x=coords.y;float e1=texture2D(inputBuffer,coords.xy).g;coords.z=searchYDown(vOffset[1].zw,vOffset[2].w);d.y=coords.z;d=round(resolution.yy*d-vPixCoord.yy);vec2 sqrtD=sqrt(abs(d));float e2=sampleLevelZeroOffset(inputBuffer,coords.xz,vec2(0,1)).g;weights.ba=area(sqrtD,e1,e2,subsampleIndices.x);coords.x=vUv.x;detectVerticalCornerPattern(weights.ba,coords.xyxz,d);}gl_FragColor=weights;}",vertexShader:"uniform vec2 texelSize;uniform vec2 resolution;varying vec2 vUv;varying vec4 vOffset[3];varying vec2 vPixCoord;void main(){vUv=position.xy*0.5+0.5;vPixCoord=vUv*resolution;vOffset[0]=vUv.xyxy+texelSize.xyxy*vec4(-0.25,-0.125,1.25,-0.125);vOffset[1]=vUv.xyxy+texelSize.xyxy*vec4(-0.125,-0.25,-0.125,1.25);vOffset[2]=vec4(vOffset[0].xz,vOffset[1].yw)+vec4(-2.0,2.0,-2.0,2.0)*texelSize.xxyy*MAX_SEARCH_STEPS_FLOAT;gl_Position=vec4(position.xy,1.0,1.0);}"}),this.toneMapped=!1}set inputBuffer(e){this.uniforms.inputBuffer.value=e}setInputBuffer(e){this.uniforms.inputBuffer.value=e}get searchTexture(){return this.uniforms.searchTexture.value}set searchTexture(e){this.uniforms.searchTexture.value=e}get areaTexture(){return this.uniforms.areaTexture.value}set areaTexture(e){this.uniforms.areaTexture.value=e}setLookupTextures(e,t){this.searchTexture=e,this.areaTexture=t}get orthogonalSearchSteps(){return Number(this.defines.MAX_SEARCH_STEPS_INT)}set orthogonalSearchSteps(e){let t=Math.min(Math.max(e,0),112);this.defines.MAX_SEARCH_STEPS_INT=t.toFixed("0"),this.defines.MAX_SEARCH_STEPS_FLOAT=t.toFixed("1"),this.needsUpdate=!0}setOrthogonalSearchSteps(e){this.orthogonalSearchSteps=e}get diagonalSearchSteps(){return Number(this.defines.MAX_SEARCH_STEPS_DIAG_INT)}set diagonalSearchSteps(e){let t=Math.min(Math.max(e,0),20);this.defines.MAX_SEARCH_STEPS_DIAG_INT=t.toFixed("0"),this.defines.MAX_SEARCH_STEPS_DIAG_FLOAT=t.toFixed("1"),this.needsUpdate=!0}setDiagonalSearchSteps(e){this.diagonalSearchSteps=e}get diagonalDetection(){return void 0===this.defines.DISABLE_DIAG_DETECTION}set diagonalDetection(e){e?delete this.defines.DISABLE_DIAG_DETECTION:this.defines.DISABLE_DIAG_DETECTION="1",this.needsUpdate=!0}isDiagonalDetectionEnabled(){return this.diagonalDetection}setDiagonalDetectionEnabled(e){this.diagonalDetection=e}get cornerRounding(){return Number(this.defines.CORNER_ROUNDING)}set cornerRounding(e){let t=Math.min(Math.max(e,0),100);this.defines.CORNER_ROUNDING=t.toFixed("4"),this.defines.CORNER_ROUNDING_NORM=(t/100).toFixed("4"),this.needsUpdate=!0}setCornerRounding(e){this.cornerRounding=e}get cornerDetection(){return void 0===this.defines.DISABLE_CORNER_DETECTION}set cornerDetection(e){e?delete this.defines.DISABLE_CORNER_DETECTION:this.defines.DISABLE_CORNER_DETECTION="1",this.needsUpdate=!0}isCornerRoundingEnabled(){return this.cornerDetection}setCornerRoundingEnabled(e){this.cornerDetection=e}setSize(e,t){let n=this.uniforms;n.texelSize.value.set(1/e,1/t),n.resolution.value.set(e,t)}},_I=new ki,EI=null;var AI=class{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Pass",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Ca,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:_I;this.name=e,this.renderer=null,this.scene=t,this.camera=n,this.screen=null,this.rtt=!0,this.needsSwap=!0,this.needsDepthTexture=!1,this.enabled=!0}get renderToScreen(){return!this.rtt}set renderToScreen(e){if(this.rtt===e){let t=this.getFullscreenMaterial();null!==t&&(t.needsUpdate=!0),this.rtt=!e}}setRenderer(e){this.renderer=e}isEnabled(){return this.enabled}setEnabled(e){this.enabled=e}get fullscreenMaterial(){return null!==this.screen?this.screen.material:null}set fullscreenMaterial(e){let t=this.screen;null!==t?t.material=e:(t=new Ci(function(){if(null===EI){let e=new Float32Array([-1,-1,0,3,-1,0,-1,3,0]),t=new Float32Array([0,0,2,0,0,2]);void 0!==(EI=new di).setAttribute?(EI.setAttribute("position",new ti(e,3)),EI.setAttribute("uv",new ti(t,2))):(EI.addAttribute("position",new ti(e,3)),EI.addAttribute("uv",new ti(t,2)))}return EI}(),e),t.frustumCulled=!1,null===this.scene&&(this.scene=new Ca),this.scene.add(t),this.screen=t)}getFullscreenMaterial(){return this.fullscreenMaterial}setFullscreenMaterial(e){this.fullscreenMaterial=e}getDepthTexture(){return null}setDepthTexture(e){}render(e,t,n,i,r){throw new Error("Render method not implemented!")}setSize(e,t){}initialize(e,t,n){}dispose(){for(let e of Object.keys(this)){let t=this[e];if(null!==t&&"object"==typeof t&&"function"==typeof t.dispose){if(t instanceof Ca||t===this.renderer)continue;this[e].dispose()}}}},CI=class extends AI{constructor(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super("CopyPass"),this.fullscreenMaterial=new dI,this.needsSwap=!1,this.renderTarget=e,void 0===e&&(this.renderTarget=new It(1,1,{minFilter:ue,magFilter:ue,stencilBuffer:!1,depthBuffer:!1}),this.renderTarget.texture.name="CopyPass.Target"),this.autoResize=t}get resize(){return this.autoResize}set resize(e){this.autoResize=e}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}setAutoResizeEnabled(e){this.autoResize=e}render(e,t,n,i,r){this.fullscreenMaterial.inputBuffer=t.texture,e.setRenderTarget(this.renderToScreen?null:this.renderTarget),e.render(this.scene,this.camera)}setSize(e,t){this.autoResize&&this.renderTarget.setSize(e,t)}initialize(e,t,n){void 0!==n&&(this.renderTarget.texture.type=n,n!==fe?this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1":e.outputEncoding===Ne&&(this.renderTarget.texture.encoding=Ne))}},MI=class extends AI{constructor(){super("ClearMaskPass",null,null),this.needsSwap=!1}render(e,t,n,i,r){let s=e.state.buffers.stencil;s.setLocked(!1),s.setTest(!1)}},TI=new Et,PI=class extends AI{constructor(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];super("ClearPass",null,null),this.needsSwap=!1,this.color=e,this.depth=t,this.stencil=n,this.overrideClearColor=null,this.overrideClearAlpha=-1}setClearFlags(e,t,n){this.color=e,this.depth=t,this.stencil=n}getOverrideClearColor(){return this.overrideClearColor}setOverrideClearColor(e){this.overrideClearColor=e}getOverrideClearAlpha(){return this.overrideClearAlpha}setOverrideClearAlpha(e){this.overrideClearAlpha=e}render(e,t,n,i,r){let s=this.overrideClearColor,a=this.overrideClearAlpha,o=e.getClearAlpha(),l=null!==s,c=a>=0;l?(TI.copy(e.getClearColor(TI)),e.setClearColor(s,c?a:o)):c&&e.setClearAlpha(a),e.setRenderTarget(this.renderToScreen?null:t),e.clear(this.color,this.depth,this.stencil),l?e.setClearColor(TI,o):c&&e.setClearAlpha(o)}},DI=-1,OI=class extends qe{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:DI,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:DI,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;super(),this.resizable=e,this.base=new ot(1,1),this.preferred=new ot(t,n),this.target=this.preferred,this.s=i}get width(){let e,{base:t,preferred:n,scale:i}=this;return e=n.width!==DI?n.width:n.height!==DI?Math.round(n.height*(t.width/Math.max(t.height,1))):Math.round(t.width*i),e}set width(e){this.preferredWidth=e}get height(){let e,{base:t,preferred:n,scale:i}=this;return e=n.height!==DI?n.height:n.width!==DI?Math.round(n.width/Math.max(t.width/Math.max(t.height,1),1)):Math.round(t.height*i),e}set height(e){this.preferredHeight=e}getWidth(){return this.width}getHeight(){return this.height}get scale(){return this.s}set scale(e){this.s!==e&&(this.s=e,this.preferred.setScalar(DI),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}getScale(){return this.scale}setScale(e){this.scale=e}get baseWidth(){return this.base.width}set baseWidth(e){this.base.width!==e&&(this.base.width=e,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}getBaseWidth(){return this.base.width}setBaseWidth(e){this.base.width!==e&&(this.base.width=e,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}get baseHeight(){return this.base.height}set baseHeight(e){this.base.height!==e&&(this.base.height=e,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}getBaseHeight(){return this.baseHeight}setBaseHeight(e){this.baseHeight=e}setBaseSize(e,t){(this.base.width!==e||this.base.height!==t)&&(this.base.set(e,t),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}get preferredWidth(){return this.preferred.width}set preferredWidth(e){this.preferred.width!==e&&(this.preferred.width=e,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}getPreferredWidth(){return this.preferredWidth}setPreferredWidth(e){this.preferredWidth=e}get preferredHeight(){return this.preferred.height}set preferredHeight(e){this.preferred.height!==e&&(this.preferred.height=e,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}getPreferredHeight(){return this.preferredHeight}setPreferredHeight(e){this.preferredHeight=e}setPreferredSize(e,t){(this.preferred.width!==e||this.preferred.height!==t)&&(this.preferred.set(e,t),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}copy(e){this.base.set(e.getBaseWidth(),e.getBaseHeight()),this.preferred.set(e.getPreferredWidth(),e.getPreferredHeight()),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height)}static get AUTO_SIZE(){return DI}},II=!1,RI=class{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.originalMaterials=new Map,this.material=null,this.materials=null,this.materialsBackSide=null,this.materialsDoubleSide=null,this.materialsFlatShaded=null,this.materialsFlatShadedBackSide=null,this.materialsFlatShadedDoubleSide=null,this.setMaterial(e),this.meshCount=0,this.replaceMaterial=e=>{if(e.isMesh){let t;if(e.material.flatShading)switch(e.material.side){case 2:t=this.materialsFlatShadedDoubleSide;break;case 1:t=this.materialsFlatShadedBackSide;break;default:t=this.materialsFlatShaded}else switch(e.material.side){case 2:t=this.materialsDoubleSide;break;case 1:t=this.materialsBackSide;break;default:t=this.materials}this.originalMaterials.set(e,e.material),e.isSkinnedMesh?e.material=t[2]:e.isInstancedMesh?e.material=t[1]:e.material=t[0],++this.meshCount}}}setMaterial(e){if(this.disposeMaterials(),this.material=e,null!==e){let t=this.materials=[e.clone(),e.clone(),e.clone()];for(let n of t)n.uniforms=Object.assign({},e.uniforms),n.side=0;t[2].skinning=!0,this.materialsBackSide=t.map((t=>{let n=t.clone();return n.uniforms=Object.assign({},e.uniforms),n.side=1,n})),this.materialsDoubleSide=t.map((t=>{let n=t.clone();return n.uniforms=Object.assign({},e.uniforms),n.side=2,n})),this.materialsFlatShaded=t.map((t=>{let n=t.clone();return n.uniforms=Object.assign({},e.uniforms),n.flatShading=!0,n})),this.materialsFlatShadedBackSide=t.map((t=>{let n=t.clone();return n.uniforms=Object.assign({},e.uniforms),n.flatShading=!0,n.side=1,n})),this.materialsFlatShadedDoubleSide=t.map((t=>{let n=t.clone();return n.uniforms=Object.assign({},e.uniforms),n.flatShading=!0,n.side=2,n}))}}render(e,t,n){let i=e.shadowMap.enabled;if(e.shadowMap.enabled=!1,II){let i=this.originalMaterials;this.meshCount=0,t.traverse(this.replaceMaterial),e.render(t,n);for(let e of i)e[0].material=e[1];this.meshCount!==i.size&&i.clear()}else{let i=t.overrideMaterial;t.overrideMaterial=this.material,e.render(t,n),t.overrideMaterial=i}e.shadowMap.enabled=i}disposeMaterials(){if(null!==this.material){let e=this.materials.concat(this.materialsBackSide).concat(this.materialsDoubleSide).concat(this.materialsFlatShaded).concat(this.materialsFlatShadedBackSide).concat(this.materialsFlatShadedDoubleSide);for(let t of e)t.dispose()}}dispose(){this.originalMaterials.clear(),this.disposeMaterials()}static get workaroundEnabled(){return II}static set workaroundEnabled(e){II=e}},kI=class extends AI{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;super("RenderPass",e,t),this.needsSwap=!1,this.clearPass=new PI,this.overrideMaterialManager=null===n?null:new RI(n),this.ignoreBackground=!1,this.skipShadowMapUpdate=!1,this.selection=null}get renderToScreen(){return super.renderToScreen}set renderToScreen(e){super.renderToScreen=e,this.clearPass.renderToScreen=e}get overrideMaterial(){let e=this.overrideMaterialManager;return null!==e?e.material:null}set overrideMaterial(e){let t=this.overrideMaterialManager;null!==e?null!==t?t.setMaterial(e):this.overrideMaterialManager=new RI(e):null!==t&&(t.dispose(),this.overrideMaterialManager=null)}getOverrideMaterial(){return this.overrideMaterial}setOverrideMaterial(e){this.overrideMaterial=e}get clear(){return this.clearPass.enabled}set clear(e){this.clearPass.enabled=e}getSelection(){return this.selection}setSelection(e){this.selection=e}isBackgroundDisabled(){return this.ignoreBackground}setBackgroundDisabled(e){this.ignoreBackground=e}isShadowMapDisabled(){return this.skipShadowMapUpdate}setShadowMapDisabled(e){this.skipShadowMapUpdate=e}getClearPass(){return this.clearPass}render(e,t,n,i,r){let s=this.scene,a=this.camera,o=this.selection,l=a.layers.mask,c=s.background,h=e.shadowMap.autoUpdate,u=this.renderToScreen?null:t;null!==o&&a.layers.set(o.getLayer()),this.skipShadowMapUpdate&&(e.shadowMap.autoUpdate=!1),(this.ignoreBackground||null!==this.clearPass.overrideClearColor)&&(s.background=null),this.clearPass.enabled&&this.clearPass.render(e,t),e.setRenderTarget(u),null!==this.overrideMaterialManager?this.overrideMaterialManager.render(e,s,a):e.render(s,a),a.layers.mask=l,s.background=c,e.shadowMap.autoUpdate=h}},LI=class extends AI{constructor(e,t){let{resolutionScale:n=1,width:i=OI.AUTO_SIZE,height:r=OI.AUTO_SIZE,renderTarget:s}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};super("DepthPass"),this.needsSwap=!1,this.renderPass=new kI(e,t,new ha({depthPacking:3201}));let a=this.renderPass;a.skipShadowMapUpdate=!0,a.ignoreBackground=!0;let o=a.getClearPass();o.overrideClearColor=new Et(16777215),o.overrideClearAlpha=1,this.renderTarget=s,void 0===this.renderTarget&&(this.renderTarget=new It(1,1,{minFilter:le,magFilter:le,stencilBuffer:!1}),this.renderTarget.texture.name="DepthPass.Target");let l=this.resolution=new OI(this,i,r,n);l.addEventListener("change",(e=>this.setSize(l.baseWidth,l.baseHeight)))}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}getResolution(){return this.resolution}getResolutionScale(){return this.resolution.scale}setResolutionScale(e){this.resolution.scale=e}render(e,t,n,i,r){let s=this.renderToScreen?null:this.renderTarget;this.renderPass.render(e,s)}setSize(e,t){let n=this.resolution;n.setBaseSize(e,t),this.renderTarget.setSize(n.width,n.height)}},BI=(new Float32Array([255/256/256**3,255/256/65536,255/256/256,255/256]),{SKIP:0,ADD:1,ALPHA:2,AVERAGE:3,COLOR_BURN:4,COLOR_DODGE:5,DARKEN:6,DIFFERENCE:7,EXCLUSION:8,LIGHTEN:9,MULTIPLY:10,DIVIDE:11,NEGATION:12,NORMAL:13,OVERLAY:14,REFLECT:15,SCREEN:16,SOFT_LIGHT:17,SUBTRACT:18}),zI=new Map([[BI.SKIP,null],[BI.ADD,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return min(x+y,1.0)*opacity+x*(1.0-opacity);}"],[BI.ALPHA,"vec3 blend(const in vec3 x,const in vec3 y,const in float opacity){return y*opacity+x*(1.0-opacity);}vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){float a=min(y.a,opacity);return vec4(blend(x.rgb,y.rgb,a),max(x.a,a));}"],[BI.AVERAGE,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return(x+y)*0.5*opacity+x*(1.0-opacity);}"],[BI.COLOR_BURN,"float blend(const in float x,const in float y){return(y==0.0)?y:max(1.0-(1.0-x)/y,0.0);}vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=vec4(blend(x.r,y.r),blend(x.g,y.g),blend(x.b,y.b),blend(x.a,y.a));return z*opacity+x*(1.0-opacity);}"],[BI.COLOR_DODGE,"float blend(const in float x,const in float y){return(y==1.0)?y:min(x/(1.0-y),1.0);}vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=vec4(blend(x.r,y.r),blend(x.g,y.g),blend(x.b,y.b),blend(x.a,y.a));return z*opacity+x*(1.0-opacity);}"],[BI.DARKEN,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return min(x,y)*opacity+x*(1.0-opacity);}"],[BI.DIFFERENCE,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return abs(x-y)*opacity+x*(1.0-opacity);}"],[BI.EXCLUSION,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return(x+y-2.0*x*y)*opacity+x*(1.0-opacity);}"],[BI.LIGHTEN,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return max(x,y)*opacity+x*(1.0-opacity);}"],[BI.MULTIPLY,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return x*y*opacity+x*(1.0-opacity);}"],[BI.DIVIDE,"float blend(const in float x,const in float y){return(y>0.0)?min(x/y,1.0):1.0;}vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=vec4(blend(x.r,y.r),blend(x.g,y.g),blend(x.b,y.b),blend(x.a,y.a));return z*opacity+x*(1.0-opacity);}"],[BI.NEGATION,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return(1.0-abs(1.0-x-y))*opacity+x*(1.0-opacity);}"],[BI.NORMAL,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return y*opacity+x*(1.0-opacity);}"],[BI.OVERLAY,"float blend(const in float x,const in float y){return(x<0.5)?(2.0*x*y):(1.0-2.0*(1.0-x)*(1.0-y));}vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=vec4(blend(x.r,y.r),blend(x.g,y.g),blend(x.b,y.b),blend(x.a,y.a));return z*opacity+x*(1.0-opacity);}"],[BI.REFLECT,"float blend(const in float x,const in float y){return(y==1.0)?y:min(x*x/(1.0-y),1.0);}vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=vec4(blend(x.r,y.r),blend(x.g,y.g),blend(x.b,y.b),blend(x.a,y.a));return z*opacity+x*(1.0-opacity);}"],[BI.SCREEN,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return(1.0-(1.0-x)*(1.0-y))*opacity+x*(1.0-opacity);}"],[BI.SOFT_LIGHT,"float blend(const in float x,const in float y){return(y<0.5)?(2.0*x*y+x*x*(1.0-2.0*y)):(sqrt(x)*(2.0*y-1.0)+2.0*x*(1.0-y));}vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=vec4(blend(x.r,y.r),blend(x.g,y.g),blend(x.b,y.b),blend(x.a,y.a));return z*opacity+x*(1.0-opacity);}"],[BI.SUBTRACT,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return max(x+y-1.0,0.0)*opacity+x*(1.0-opacity);}"]]),NI=class extends qe{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;super(),this.f=e,this.opacity=new fc(t)}getOpacity(){return this.opacity.value}setOpacity(e){this.opacity.value=e}get blendFunction(){return this.f}set blendFunction(e){this.f=e,this.dispatchEvent({type:"change"})}getBlendFunction(){return this.blendFunction}setBlendFunction(e){this.blendFunction=e}getShaderCode(){return zI.get(this.blendFunction)}},FI={NONE:0,DEPTH:1,CONVOLUTION:2},UI=class extends qe{constructor(e,t){let{attributes:n=FI.NONE,blendFunction:i=BI.SCREEN,defines:r=new Map,uniforms:s=new Map,extensions:a=null,vertexShader:o=null}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};super(),this.name=e,this.renderer=null,this.attributes=n,this.fragmentShader=t,this.vertexShader=o,this.defines=r,this.uniforms=s,this.extensions=a,this.blendMode=new NI(i),this.blendMode.addEventListener("change",(e=>this.setChanged()))}getName(){return this.name}setRenderer(e){this.renderer=e}getDefines(){return this.defines}getUniforms(){return this.uniforms}getExtensions(){return this.extensions}getBlendMode(){return this.blendMode}getAttributes(){return this.attributes}setAttributes(e){this.attributes=e,this.setChanged()}getFragmentShader(){return this.fragmentShader}setFragmentShader(e){this.fragmentShader=e,this.setChanged()}getVertexShader(){return this.vertexShader}setVertexShader(e){this.vertexShader=e,this.setChanged()}setChanged(){this.dispatchEvent({type:"change"})}setDepthTexture(e){}update(e,t,n){}setSize(e,t){}initialize(e,t,n){}dispose(){for(let e of Object.keys(this)){let t=this[e];if(null!==t&&"object"==typeof t&&"function"==typeof t.dispose){if(t instanceof Ca||t===this.renderer)continue;this[e].dispose()}}}};function jI(e,t,n){for(let i of t){let t="$1"+e+i.charAt(0).toUpperCase()+i.slice(1),r=new RegExp("([^\\.])(\\b"+i+"\\b)","g");for(let e of n.entries())null!==e[1]&&n.set(e[0],e[1].replace(r,t))}}function VI(e,t,n,i,r,s,a){let o=new Map([["fragment",t.getFragmentShader()],["vertex",t.getVertexShader()]]),l=void 0!==o.get("fragment")&&/mainImage/.test(o.get("fragment")),c=void 0!==o.get("fragment")&&/mainUv/.test(o.get("fragment")),h=[],u=[],d=!1,p=!1;if(void 0===o.get("fragment"))console.error("Missing fragment shader",t);else if(c&&0!==(a&FI.CONVOLUTION))console.error("Effects that transform UV coordinates are incompatible with convolution effects",t);else if(l||c){let f=/(?:\w+\s+(\w+)\([\w\s,]*\)\s*{[^}]+})/g,m=vI.Section;if(c){let t="\t".concat(e,"MainUv(UV);\n");n.set(m.FRAGMENT_MAIN_UV,n.get(m.FRAGMENT_MAIN_UV)+t),d=!0}if(null!==o.get("vertex")&&/mainSupport/.test(o.get("vertex"))){let t="\t".concat(e,"MainSupport(");t+=/mainSupport *\([\w\s]*?uv\s*?\)/.test(o.get("vertex"))?"vUv);\n":");\n",n.set(m.VERTEX_MAIN_SUPPORT,n.get(m.VERTEX_MAIN_SUPPORT)+t),h=h.concat([...o.get("vertex").matchAll(/(?:varying\s+\w+\s+(\w*))/g)].map((e=>e[1]))),u=u.concat(h).concat([...o.get("vertex").matchAll(f)].map((e=>e[1])))}u=u.concat([...o.get("fragment").matchAll(f)].map((e=>e[1]))),u=u.concat([...t.defines.keys()].map((e=>e.replace(/\([\w\s,]*\)/g,"")))),u=u.concat([...t.uniforms.keys()]),t.uniforms.forEach(((t,n)=>s.set(e+n.charAt(0).toUpperCase()+n.slice(1),t))),t.defines.forEach(((t,n)=>r.set(e+n.charAt(0).toUpperCase()+n.slice(1),t))),jI(e,u,r),jI(e,u,o);let g=t.blendMode;if(i.set(g.blendFunction,g),l){let t=/MainImage *\([\w\s,]*?depth[\w\s,]*?\)/,i="".concat(e,"MainImage(color0, UV, ");0!==(a&FI.DEPTH)&&t.test(o.get("fragment"))&&(i+="depth, ",p=!0),i+="color1);\n\t";let r=e+"BlendOpacity";s.set(r,g.opacity),i+="color0 = blend".concat(g.blendFunction,"(color0, color1, ").concat(r,");\n\n\t"),n.set(m.FRAGMENT_MAIN_IMAGE,n.get(m.FRAGMENT_MAIN_IMAGE)+i),i="uniform float ".concat(r,";\n\n"),n.set(m.FRAGMENT_HEAD,n.get(m.FRAGMENT_HEAD)+i)}n.set(m.FRAGMENT_HEAD,n.get(m.FRAGMENT_HEAD)+o.get("fragment")+"\n"),null!==o.get("vertex")&&n.set(m.VERTEX_HEAD,n.get(m.VERTEX_HEAD)+o.get("vertex")+"\n")}else console.error("The fragment shader contains neither a mainImage nor a mainUv function",t);return{varyings:h,transformedUv:d,readDepth:p}}var GI=class extends AI{constructor(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];super("EffectPass"),this.fullscreenMaterial=new vI(null,null,null,e),this.effects=n.sort(((e,t)=>t.attributes-e.attributes)),this.skipRendering=!1,this.uniformCount=0,this.varyingCount=0,this.minTime=1,this.maxTime=Number.POSITIVE_INFINITY}get encodeOutput(){return this.fullscreenMaterial.encodeOutput}set encodeOutput(e){this.fullscreenMaterial.encodeOutput=e}get dithering(){return this.fullscreenMaterial.dithering}set dithering(e){let t=this.fullscreenMaterial;t.dithering=e,t.needsUpdate=!0}verifyResources(){let e=this.renderer.capabilities,t=Math.min(e.maxFragmentUniforms,e.maxVertexUniforms);this.uniformCount>t&&console.warn("The current rendering context doesn't support more than "+t+" uniforms, but "+this.uniformCount+" were defined"),t=e.maxVaryings,this.varyingCount>t&&console.warn("The current rendering context doesn't support more than "+t+" varyings, but "+this.varyingCount+" were defined")}updateMaterial(){let e=vI.Section,t=new Map([[e.FRAGMENT_HEAD,""],[e.FRAGMENT_MAIN_UV,""],[e.FRAGMENT_MAIN_IMAGE,""],[e.VERTEX_HEAD,""],[e.VERTEX_MAIN_SUPPORT,""]]),n=new Map,i=new Map,r=new Map,s=new Set,a=0,o=0,l=0,c=!1,h=!1;for(let d of this.effects)if(d.blendMode.blendFunction===BI.SKIP)l|=d.getAttributes()&FI.DEPTH;else if(0!==(l&d.getAttributes()&FI.CONVOLUTION))console.error("Convolution effects cannot be merged",d);else{l|=d.getAttributes();let e=VI("e"+a++,d,t,n,i,r,l);if(o+=e.varyings.length,c=c||e.transformedUv,h=h||e.readDepth,null!==d.extensions)for(let t of d.extensions)s.add(t)}let u=/\bblend\b/g;for(let d of n.values()){let n=d.getShaderCode().replace(u,"blend".concat(d.blendFunction));t.set(e.FRAGMENT_HEAD,t.get(e.FRAGMENT_HEAD)+n+"\n")}if(0!==(l&FI.DEPTH)){if(h){let n="float depth = readDepth(UV);\n\n\t";t.set(e.FRAGMENT_MAIN_IMAGE,n+t.get(e.FRAGMENT_MAIN_IMAGE))}this.needsDepthTexture=null===this.getDepthTexture()}else this.needsDepthTexture=!1;if(c){let n="vec2 transformedUv = vUv;\n";t.set(e.FRAGMENT_MAIN_UV,n+t.get(e.FRAGMENT_MAIN_UV)),i.set("UV","transformedUv")}else i.set("UV","vUv");t.forEach(((e,t,n)=>n.set(t,e.trim().replace(/^#/,"\n#")))),this.uniformCount=r.size,this.varyingCount=o,this.skipRendering=0===a,this.needsSwap=!this.skipRendering,this.fullscreenMaterial.setShaderParts(t).setExtensions(s).setUniforms(r).setDefines(i)}recompile(){this.updateMaterial(),this.verifyResources()}getDepthTexture(){return this.fullscreenMaterial.depthBuffer}setDepthTexture(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Fe;this.fullscreenMaterial.depthBuffer=e,this.fullscreenMaterial.depthPacking=t;for(let n of this.effects)n.setDepthTexture(e,t)}render(e,t,n,i,r){for(let s of this.effects)s.update(e,t,i);if(!this.skipRendering||this.renderToScreen){let r=this.fullscreenMaterial;r.inputBuffer=t.texture,r.time+=i,e.setRenderTarget(this.renderToScreen?null:n),e.render(this.scene,this.camera)}}setSize(e,t){this.fullscreenMaterial.setSize(e,t);for(let n of this.effects)n.setSize(e,t)}initialize(e,t,n){this.renderer=e;for(let i of this.effects)i.initialize(e,t,n),i.addEventListener("change",(e=>this.handleEvent(e)));this.updateMaterial(),this.verifyResources(),void 0!==n&&n!==fe&&(this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1")}dispose(){super.dispose();for(let e of this.effects)e.dispose()}handleEvent(e){if("change"===e.type)this.recompile()}},HI=[new Float32Array([0,0]),new Float32Array([0,1,1]),new Float32Array([0,1,1,2]),new Float32Array([0,1,2,2,3]),new Float32Array([0,1,2,3,4,4,5]),new Float32Array([0,1,2,3,4,5,7,8,9,10])],WI=class extends AI{constructor(){let{resolutionScale:e=.5,width:t=OI.AUTO_SIZE,height:n=OI.AUTO_SIZE,kernelSize:i=ZI.LARGE}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super("KawaseBlurPass"),this.renderTargetA=new It(1,1,{minFilter:ue,magFilter:ue,stencilBuffer:!1,depthBuffer:!1}),this.renderTargetA.texture.name="Blur.Target.A",this.renderTargetB=this.renderTargetA.clone(),this.renderTargetB.texture.name="Blur.Target.B";let r=this.resolution=new OI(this,t,n,e);r.addEventListener("change",(e=>this.setSize(r.baseWidth,r.baseHeight))),this.blurMaterial=new uI,this.ditheredBlurMaterial=new uI,this.ditheredBlurMaterial.uniforms.scale=this.blurMaterial.uniforms.scale,this.ditheredBlurMaterial.dithering=!0,this.dithering=!1,this.kernelSize=i}getResolution(){return this.resolution}get width(){return this.resolution.width}set width(e){this.resolution.preferredWidth=e}get height(){return this.resolution.height}set height(e){this.resolution.preferredHeight=e}get scale(){return this.blurMaterial.scale}set scale(e){this.blurMaterial.scale=e}getScale(){return this.blurMaterial.scale}setScale(e){this.blurMaterial.scale=e}getKernelSize(){return this.kernelSize}setKernelSize(e){this.kernelSize=e}getResolutionScale(){return this.resolution.scale}setResolutionScale(e){this.resolution.scale=e}render(e,t,n,i,r){let s,a,o=this.scene,l=this.camera,c=this.renderTargetA,h=this.renderTargetB,u=HI[this.kernelSize],d=this.blurMaterial,p=t;for(this.fullscreenMaterial=d,s=0,a=u.length-1;s<a;++s){let t=0===(1&s)?c:h;d.kernel=u[s],d.inputBuffer=p.texture,e.setRenderTarget(t),e.render(o,l),p=t}this.dithering&&(d=this.ditheredBlurMaterial,this.fullscreenMaterial=d),d.kernel=u[s],d.inputBuffer=p.texture,e.setRenderTarget(this.renderToScreen?null:n),e.render(o,l)}setSize(e,t){let n=this.resolution;n.setBaseSize(e,t);let i=n.width,r=n.height;this.renderTargetA.setSize(i,r),this.renderTargetB.setSize(i,r),this.blurMaterial.setSize(i,r),this.ditheredBlurMaterial.setSize(i,r)}initialize(e,t,n){void 0!==n&&(this.renderTargetA.texture.type=n,this.renderTargetB.texture.type=n,n!==fe?(this.blurMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1",this.ditheredBlurMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1"):e.outputEncoding===Ne&&(this.renderTargetA.texture.encoding=Ne,this.renderTargetB.texture.encoding=Ne))}static get AUTO_SIZE(){return OI.AUTO_SIZE}},qI=class extends AI{constructor(){let{width:e=OI.AUTO_SIZE,height:t=OI.AUTO_SIZE,renderTarget:n,luminanceRange:i,colorOutput:r}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super("LuminancePass"),this.fullscreenMaterial=new yI(r,i),this.needsSwap=!1,this.renderTarget=n,void 0===this.renderTarget&&(this.renderTarget=new It(1,1,{minFilter:ue,magFilter:ue,stencilBuffer:!1,depthBuffer:!1}),this.renderTarget.texture.name="LuminancePass.Target",this.renderTarget.texture.generateMipmaps=!1);let s=this.resolution=new OI(this,e,t);s.addEventListener("change",(e=>this.setSize(s.baseWidth,s.baseHeight)))}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}getResolution(){return this.resolution}render(e,t,n,i,r){this.fullscreenMaterial.inputBuffer=t.texture,e.setRenderTarget(this.renderToScreen?null:this.renderTarget),e.render(this.scene,this.camera)}setSize(e,t){let n=this.resolution;n.setBaseSize(e,t),this.renderTarget.setSize(n.width,n.height)}initialize(e,t,n){void 0!==n&&n!==fe&&(this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1")}},XI=class extends AI{constructor(e,t){super("MaskPass",e,t),this.needsSwap=!1,this.clearPass=new PI(!1,!1,!0),this.inverse=!1}get inverted(){return this.inverse}set inverted(e){this.inverse=e}get clear(){return this.clearPass.enabled}set clear(e){this.clearPass.enabled=e}getClearPass(){return this.clearPass}isInverted(){return this.inverted}setInverted(e){this.inverted=e}render(e,t,n,i,r){let s=e.getContext(),a=e.state.buffers,o=this.scene,l=this.camera,c=this.clearPass,h=this.inverted?0:1,u=1-h;a.color.setMask(!1),a.depth.setMask(!1),a.color.setLocked(!0),a.depth.setLocked(!0),a.stencil.setTest(!0),a.stencil.setOp(s.REPLACE,s.REPLACE,s.REPLACE),a.stencil.setFunc(s.ALWAYS,h,4294967295),a.stencil.setClear(u),a.stencil.setLocked(!0),this.clearPass.enabled&&(this.renderToScreen?c.render(e,null):(c.render(e,t),c.render(e,n))),this.renderToScreen?(e.setRenderTarget(null),e.render(o,l)):(e.setRenderTarget(t),e.render(o,l),e.setRenderTarget(n),e.render(o,l)),a.color.setLocked(!1),a.depth.setLocked(!1),a.stencil.setLocked(!1),a.stencil.setFunc(s.EQUAL,1,4294967295),a.stencil.setOp(s.KEEP,s.KEEP,s.KEEP),a.stencil.setLocked(!0)}},YI=class extends AI{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"inputBuffer";super("ShaderPass"),this.fullscreenMaterial=e,this.inputBufferUniform=null,this.setInput(t)}setInput(e){if(this.inputBufferUniform=null,null!==this.fullscreenMaterial){let t=this.fullscreenMaterial.uniforms;void 0!==t&&void 0!==t[e]&&(this.inputBufferUniform=t[e])}}render(e,t,n,i,r){null!==this.inputBufferUniform&&null!==t&&(this.inputBufferUniform.value=t.texture),e.setRenderTarget(this.renderToScreen?null:n),e.render(this.scene,this.camera)}initialize(e,t,n){void 0!==n&&n!==fe&&(this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1")}},QI=.001,KI=class{constructor(){this.previousTime=0,this.currentTime=0,this.delta=0,this.fixedDelta=1e3/60,this.elapsed=0,this.timescale=1,this.fixedDeltaEnabled=!1,this.autoReset=!1}setFixedDeltaEnabled(e){return this.fixedDeltaEnabled=e,this}isAutoResetEnabled(e){return this.autoReset}setAutoResetEnabled(e){return typeof document<"u"&&void 0!==document.hidden&&(e?document.addEventListener("visibilitychange",this):document.removeEventListener("visibilitychange",this),this.autoReset=e),this}getDelta(){return this.delta*QI}getFixedDelta(){return this.fixedDelta*QI}setFixedDelta(e){return this.fixedDelta=1e3*e,this}getElapsed(){return this.elapsed*QI}getTimescale(){return this.timescale}setTimescale(e){return this.timescale=e,this}update(e){return this.fixedDeltaEnabled?this.delta=this.fixedDelta:(this.previousTime=this.currentTime,this.currentTime=void 0!==e?e:performance.now(),this.delta=this.currentTime-this.previousTime),this.delta*=this.timescale,this.elapsed+=this.delta,this}reset(){return this.delta=0,this.elapsed=0,this.currentTime=performance.now(),this}handleEvent(e){document.hidden||(this.currentTime=performance.now())}dispose(){this.setAutoResetEnabled(!1)}},ZI={VERY_SMALL:0,SMALL:1,MEDIUM:2,LARGE:3,VERY_LARGE:4,HUGE:5},JI=class extends UI{constructor(){let{blendFunction:e=BI.SCREEN,luminanceThreshold:t=.9,luminanceSmoothing:n=.025,resolutionScale:i=.5,intensity:r=1,width:s=OI.AUTO_SIZE,height:a=OI.AUTO_SIZE,kernelSize:o=ZI.LARGE}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super("BloomEffect","#ifdef FRAMEBUFFER_PRECISION_HIGH\nuniform mediump sampler2D map;\n#else\nuniform lowp sampler2D map;\n#endif\nuniform float intensity;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){outputColor=clamp(texture2D(map,uv)*intensity,0.0,1.0);}",{blendFunction:e,uniforms:new Map([["map",new fc(null)],["intensity",new fc(r)]])}),this.renderTarget=new It(1,1,{minFilter:ue,magFilter:ue,stencilBuffer:!1,depthBuffer:!1}),this.renderTarget.texture.name="Bloom.Target",this.renderTarget.texture.generateMipmaps=!1,this.uniforms.get("map").value=this.renderTarget.texture,this.luminancePass=new qI({renderTarget:this.renderTarget,colorOutput:!0}),this.luminanceMaterial.threshold=t,this.luminanceMaterial.smoothingFactor=n,this.blurPass=new WI({resolutionScale:i,width:s,height:a,kernelSize:o});let l=this.blurPass.getResolution();l.addEventListener("change",(e=>this.setSize(l.baseWidth,l.baseHeight)))}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}get resolution(){return this.blurPass.resolution}getResolution(){return this.blurPass.resolution}getBlurPass(){return this.blurPass}getLuminancePass(){return this.luminancePass}get luminanceMaterial(){return this.luminancePass.fullscreenMaterial}getLuminanceMaterial(){return this.luminancePass.fullscreenMaterial}get width(){return this.resolution.width}set width(e){this.resolution.preferredWidth=e}get height(){return this.resolution.height}set height(e){this.resolution.preferredHeight=e}get dithering(){return this.blurPass.dithering}set dithering(e){this.blurPass.dithering=e}get kernelSize(){return this.blurPass.kernelSize}set kernelSize(e){this.blurPass.kernelSize=e}get distinction(){return console.warn(this.name,"distinction was removed"),1}set distinction(e){console.warn(this.name,"distinction was removed")}get intensity(){return this.uniforms.get("intensity").value}set intensity(e){this.uniforms.get("intensity").value=e}getIntensity(){return this.intensity}setIntensity(e){this.intensity=e}getResolutionScale(){return this.resolution.scale}setResolutionScale(e){this.resolution.scale=e}update(e,t,n){let i=this.renderTarget;this.luminancePass.enabled?(this.luminancePass.render(e,t,i),this.blurPass.render(e,i,i)):this.blurPass.render(e,t,i)}setSize(e,t){let n=this.resolution;n.setBaseSize(e,t),this.renderTarget.setSize(n.width,n.height),this.luminancePass.resolution.copy(n)}initialize(e,t,n){this.blurPass.initialize(e,t,n),void 0!==n&&(this.renderTarget.texture.type=n,e.outputEncoding===Ne&&(this.renderTarget.texture.encoding=Ne))}},$I=class extends UI{constructor(){let{blendFunction:e=BI.NORMAL,brightness:t=0,contrast:n=0}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super("BrightnessContrastEffect","uniform float brightness;uniform float contrast;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec3 color=inputColor.rgb+vec3(brightness-0.5);if(contrast>0.0){color/=vec3(1.0-contrast);}else{color*=vec3(1.0+contrast);}outputColor=vec4(min(color+vec3(0.5),1.0),inputColor.a);}",{blendFunction:e,uniforms:new Map([["brightness",new fc(t)],["contrast",new fc(n)]])})}get brightness(){return this.uniforms.get("brightness").value}set brightness(e){this.uniforms.get("brightness").value=e}getBrightness(e){return this.brightness}setBrightness(e){this.brightness=e}get contrast(){return this.uniforms.get("contrast").value}set contrast(e){this.uniforms.get("contrast").value=e}getContrast(e){return this.contrast}setContrast(e){this.contrast=e}},eR=class extends UI{constructor(){super("ColorAverageEffect","void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){outputColor=vec4(vec3(average(inputColor.rgb)),inputColor.a);}",{blendFunction:arguments.length>0&&void 0!==arguments[0]?arguments[0]:BI.NORMAL})}},tR=class extends UI{constructor(){let{blendFunction:e=BI.NORMAL,offset:t=new ot(.001,5e-4)}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super("ChromaticAberrationEffect","varying vec2 vUvR;varying vec2 vUvB;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec2 ra=texture2D(inputBuffer,vUvR).ra;vec2 ba=texture2D(inputBuffer,vUvB).ba;outputColor=vec4(ra.x,inputColor.g,ba.x,max(max(ra.y,ba.y),inputColor.a));}",{vertexShader:"uniform vec2 offset;varying vec2 vUvR;varying vec2 vUvB;void mainSupport(const in vec2 uv){vec2 shift=offset*vec2(1.0,aspect);vUvR=uv+shift;vUvB=uv-shift;}",blendFunction:e,attributes:FI.CONVOLUTION,uniforms:new Map([["offset",new fc(t)]])})}get offset(){return this.uniforms.get("offset").value}set offset(e){this.uniforms.get("offset").value=e}getOffset(){return this.offset}setOffset(e){this.offset=e}},nR=class extends UI{constructor(e){let{blendFunction:t=BI.NORMAL,worldFocusDistance:n,worldFocusRange:i,focusDistance:r=0,focalLength:s=.1,focusRange:a=s,bokehScale:o=1,width:l=OI.AUTO_SIZE,height:c=OI.AUTO_SIZE}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super("DepthOfFieldEffect","#ifdef FRAMEBUFFER_PRECISION_HIGH\nuniform mediump sampler2D nearColorBuffer;uniform mediump sampler2D farColorBuffer;\n#else\nuniform lowp sampler2D nearColorBuffer;uniform lowp sampler2D farColorBuffer;\n#endif\nuniform lowp sampler2D nearCoCBuffer;uniform float scale;void mainImage(const in vec4 inputColor,const in vec2 uv,const in float depth,out vec4 outputColor){vec4 colorNear=texture2D(nearColorBuffer,uv);vec4 colorFar=texture2D(farColorBuffer,uv);float CoCNear=texture2D(nearCoCBuffer,uv).r;CoCNear=min(CoCNear*scale,1.0);vec4 result=inputColor*(1.0-colorFar.a)+colorFar;result=mix(result,colorNear,CoCNear);outputColor=result;}",{blendFunction:t,attributes:FI.DEPTH,uniforms:new Map([["nearColorBuffer",new fc(null)],["farColorBuffer",new fc(null)],["nearCoCBuffer",new fc(null)],["scale",new fc(1)]])}),this.camera=e,this.renderTarget=new It(1,1,{minFilter:ue,magFilter:ue,stencilBuffer:!1,depthBuffer:!1}),this.renderTarget.texture.name="DoF.Intermediate",this.renderTarget.texture.generateMipmaps=!1,this.renderTargetMasked=this.renderTarget.clone(),this.renderTargetMasked.texture.name="DoF.Masked.Far",this.renderTargetNear=this.renderTarget.clone(),this.renderTargetNear.texture.name="DoF.Bokeh.Near",this.uniforms.get("nearColorBuffer").value=this.renderTargetNear.texture,this.renderTargetFar=this.renderTarget.clone(),this.renderTargetFar.texture.name="DoF.Bokeh.Far",this.uniforms.get("farColorBuffer").value=this.renderTargetFar.texture,this.renderTargetCoC=this.renderTarget.clone(),this.renderTargetCoC.texture.name="DoF.CoC",this.renderTargetCoCBlurred=this.renderTargetCoC.clone(),this.renderTargetCoCBlurred.texture.name="DoF.CoC.Blurred",this.uniforms.get("nearCoCBuffer").value=this.renderTargetCoCBlurred.texture,this.cocPass=new YI(new hI(e));let h=this.cocMaterial;h.focusDistance=r,h.focusRange=a,void 0!==n&&(h.worldFocusDistance=n),void 0!==i&&(h.worldFocusRange=i),this.blurPass=new WI({kernelSize:ZI.MEDIUM,width:l,height:c});let u=this.blurPass.getResolution();u.addEventListener("change",(e=>this.setSize(u.getBaseWidth(),u.getBaseHeight()))),this.maskPass=new YI(new wI(this.renderTargetCoC.texture));let d=this.maskPass.fullscreenMaterial;d.maskFunction=xI,d.colorChannel=sI,this.bokehNearBasePass=new YI(new oI(!1,!0)),this.bokehNearBasePass.fullscreenMaterial.cocBuffer=this.renderTargetCoCBlurred.texture,this.bokehNearFillPass=new YI(new oI(!0,!0)),this.bokehNearFillPass.fullscreenMaterial.cocBuffer=this.renderTargetCoCBlurred.texture,this.bokehFarBasePass=new YI(new oI(!1,!1)),this.bokehFarBasePass.fullscreenMaterial.cocBuffer=this.renderTargetCoC.texture,this.bokehFarFillPass=new YI(new oI(!0,!1)),this.bokehFarFillPass.fullscreenMaterial.cocBuffer=this.renderTargetCoC.texture,this.target=null,this.bokehScale=o}get cocTexture(){return this.renderTargetCoC.texture}get cocMaterial(){return this.cocPass.fullscreenMaterial}get circleOfConfusionMaterial(){return this.cocMaterial}getCircleOfConfusionMaterial(){return this.circleOfConfusionMaterial}getBlurPass(){return this.blurPass}get resolution(){return this.blurPass.getResolution()}getResolution(){return this.blurPass.getResolution()}get bokehScale(){return this.uniforms.get("scale").value}set bokehScale(e){let t=[this.bokehNearBasePass,this.bokehNearFillPass,this.bokehFarBasePass,this.bokehFarFillPass];for(let n of t)n.fullscreenMaterial.setScale(e);this.maskPass.fullscreenMaterial.setStrength(e),this.uniforms.get("scale").value=e}getBokehScale(){return this.bokehScale}setBokehScale(e){this.bokehScale=e}getTarget(){return this.target}setTarget(e){this.target=e}calculateFocusDistance(e){let t=this.camera;return cI(-t.position.distanceTo(e),t.near,t.far)}setDepthTexture(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Fe;this.circleOfConfusionMaterial.depthBuffer=e,this.circleOfConfusionMaterial.depthPacking=t}update(e,t,n){let i=this.renderTarget,r=this.renderTargetCoC,s=this.renderTargetCoCBlurred,a=this.renderTargetMasked;if(null!==this.target){let e=this.calculateFocusDistance(this.target);this.circleOfConfusionMaterial.focusDistance=e}this.cocPass.render(e,null,r),this.blurPass.render(e,r,s),this.maskPass.render(e,t,a),this.bokehFarBasePass.render(e,a,i),this.bokehFarFillPass.render(e,i,this.renderTargetFar),this.bokehNearBasePass.render(e,t,i),this.bokehNearFillPass.render(e,i,this.renderTargetNear)}setSize(e,t){let n=this.resolution;n.setBaseSize(e,t);let i=n.width,r=n.height,s=[this.cocPass,this.blurPass,this.maskPass,this.bokehNearBasePass,this.bokehNearFillPass,this.bokehFarBasePass,this.bokehFarFillPass];s.push(this.renderTargetCoC,this.renderTargetMasked),s.forEach((n=>n.setSize(e,t))),s=[this.renderTarget,this.renderTargetNear,this.renderTargetFar,this.renderTargetCoCBlurred],s.forEach((e=>e.setSize(i,r))),[this.bokehNearBasePass,this.bokehNearFillPass,this.bokehFarBasePass,this.bokehFarFillPass].forEach((e=>e.fullscreenMaterial.setSize(i,r)))}initialize(e,t,n){[this.cocPass,this.maskPass,this.bokehNearBasePass,this.bokehNearFillPass,this.bokehFarBasePass,this.bokehFarFillPass].forEach((i=>i.initialize(e,t,n))),this.blurPass.initialize(e,t,fe),void 0!==n&&(this.renderTarget.texture.type=n,this.renderTargetNear.texture.type=n,this.renderTargetFar.texture.type=n,this.renderTargetMasked.texture.type=n,e.outputEncoding===Ne&&(this.renderTarget.texture.encoding=Ne,this.renderTargetNear.texture.encoding=Ne,this.renderTargetFar.texture.encoding=Ne,this.renderTargetMasked.texture.encoding=Ne))}},iR=(new Bt,new pn,class extends UI{constructor(){let{blendFunction:e=BI.NORMAL,hue:t=0,saturation:n=0}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super("HueSaturationEffect","uniform vec3 hue;uniform float saturation;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec3 color=vec3(dot(inputColor.rgb,hue.xyz),dot(inputColor.rgb,hue.zxy),dot(inputColor.rgb,hue.yzx));float average=(color.r+color.g+color.b)/3.0;vec3 diff=average-color;if(saturation>0.0){color+=diff*(1.0-1.0/(1.001-saturation));}else{color+=diff*-saturation;}outputColor=vec4(min(color,1.0),inputColor.a);}",{blendFunction:e,uniforms:new Map([["hue",new fc(new Bt)],["saturation",new fc(n)]])}),this.hue=t}get saturation(){return this.uniforms.get("saturation").value}set saturation(e){this.uniforms.get("saturation").value=e}getSaturation(){return this.saturation}setSaturation(e){this.saturation=e}get hue(){let e=this.uniforms.get("hue").value;return Math.acos((3*e.x-1)/2)}set hue(e){let t=Math.sin(e),n=Math.cos(e);this.uniforms.get("hue").value.set((2*n+1)/3,(-Math.sqrt(3)*t-n+1)/3,(Math.sqrt(3)*t-n+1)/3)}getHue(){return this.hue}setHue(e){this.hue=e}}),rR=(new Et,class extends UI{constructor(){let{blendFunction:e=BI.SCREEN,premultiply:t=!1}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super("NoiseEffect","void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec3 noise=vec3(rand(uv*time));\n#ifdef PREMULTIPLY\noutputColor=vec4(min(inputColor.rgb*noise,vec3(1.0)),inputColor.a);\n#else\noutputColor=vec4(noise,inputColor.a);\n#endif\n}",{blendFunction:e}),this.premultiply=t}get premultiply(){return this.defines.has("PREMULTIPLY")}set premultiply(e){this.premultiply!==e&&(e?this.defines.set("PREMULTIPLY","1"):this.defines.delete("PREMULTIPLY"),this.setChanged())}isPremultiplied(){return this.premultiply}setPremultiplied(e){this.premultiply=e}}),sR=class extends UI{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:30;super("PixelationEffect","uniform bool active;uniform vec2 d;void mainUv(inout vec2 uv){if(active){uv=vec2(d.x*(floor(uv.x/d.x)+0.5),d.y*(floor(uv.y/d.y)+0.5));}}",{uniforms:new Map([["active",new fc(!1)],["d",new fc(new ot)]])}),this.resolution=new ot,this.d=0,this.granularity=e}get granularity(){return this.d}set granularity(e){let t=Math.floor(e);t%2>0&&(t+=1),this.d=t,this.uniforms.get("active").value=t>0,this.setSize(this.resolution.width,this.resolution.height)}getGranularity(){return this.granularity}setGranularity(e){this.granularity=e}setSize(e,t){this.resolution.set(e,t),this.uniforms.get("d").value.setScalar(this.d).divide(this.resolution)}},aR=(Math.PI,new Bt,new Bt,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAAAQCAYAAACm53kpAAAAeElEQVRYR+2XSwqAMAxEJ168ePEqwRSKhIIiuHjJqiU0gWE+1CQdApcVAMUAuARaMGCX1MIL/Ow13++9lW2s3mW9MWvsnWc/2fvGygwPAN4E8QzAA4CXAB6AHjG4JTHYI1ey3pcx6FHnEfhLDOIBKAmUBK6/ANUDTlROXAHd9EC1AAAAAElFTkSuQmCC"),oR="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAKAAAAIwCAYAAAABNmBHAAAgAElEQVR4Xuy9CbhlV1ktOvbpq09DkiIkUBI6kxASIH0DlAQiIK1wRfSJTx+i4JX7vKIigs8HXpXvqVcvrcC9agQ7IDTSSWgqCQQliDRBJKkkhDSkqVPNqVOnP+8b//rH3P+eZ+199tlznVTlvVrft7+1T7OaueZY42/m37QALKNk2wHg1pITlB17mC+Pp11W3X/LHyT32vhg48/5SOv+PnwpsHA70JoGlueB1iKApeqzvOzn44GatTB76Xzhd7suBR7+WWADgDEAwwCG/L54b/poDLrHuvvm70Z2Avhsc+PVcxscBU8F8C8ADg5+ipIjD/PlGwfgju8B924E5seARUfLsiNmqQW0IjL8+7L2NYD/7COBzfcCm+aB8SVgdAkYIRCXKyDax4EdAanL5PuNPllNvXDlAHwFgP8AcC2AhRIoDXbsYb48dl5WkVFTE3LGDcC9m4CZCWBuFFgeAZaGAYJQQCRqDHT+McJrVb8zwATUXH02MHYfMHEIGFsAxgjApQqACYQORjtd/B7Axt/z79sC0+cMPgjjlwPwVwHcA+DfAHzTxcVgWBroqMN8+cYBeM71wH0TwKExYHYUWCIAHYRLTlkCYgcIBcAgU/n3qy8GRu4HRgnAOWBkERhddPAJhGJDBxkvw7cqimr+zFM/ZLnZF64cgL8BYD+AWwB8x/dlWuWagHiYL984AJ/0RWBy1AE4AizyM1yxYAcTigW55xMbAkxEiwEdkJ/ZCQxPAiOHgBECcKEC4TBZcKkSv+mTieNcNPNC26mLNsj45QD8LQDTAO4GcJt/7iw2bfoG4WG+vAGwm9ExiEg69zpg/wgwPQLMjgALzn4E4aIzoJjQ9g4024uygkj+pyuAoX0VAIfngOH5NgCHMhAm8Sv2y3XDZeBhNIp8OzJE8OsBzAKYBHAXgDt8/4O+MVT0j4f58o0D8Pxrgf3DwMwIMEPQEYRkNwfgsuuDZLskip0No0gWMD/9HGDoADAkAC4Aw/wsAgZAgs2Z0ABI0GU6IVmKv+f28KDnHxkA/G0A8y6G73N9kOCjXnh/Ebb6OvgwX75xAF5wLTA1VIHPADgMLDj4yIA5AAm6aCUnv4oz46eeDwxNAUMzwJAz4BABSNDFTwSfg7DDKHE23MG5PqIY8A1u/dINs9dBdy8AgnGPM2NfUBrsnw7z5RsH4IXXAAcJviFgluAbygBINnSLWOAjGxJ4pgOKDV0v/OSLKp8iGXBovhLBBOCQM2ACoTOhnYrAdItYbCij5JFzRyIAqRccAnDAQUjg6UNQ7hsMXP0cRQAexss3DsCLCECCLwCQzMcPwUi2MwAScAKbfnY/YRLFQ8DHX+IAJAMSfDkAF13kLvleIjhjQQHxUVS3jjgGpKeeNzYVQEjgUS8k+PghONdhIwAP4+XXBYCHKIJbwJyDTgaIAdCBJx3Q2M8tYAHP9m4df/ylQOsQ0JqtRLCx30K1wtLBggScQOgsKBGcWHAJeOwRC0BSM1mQIKRbhh+Bj98JQP6t4U0APEyXXxcAEnxkQAFwoVUxID9kvQg+c1C7vidRbIDkc24B//hTQGumDcCWA5DgMxASdNIFBUI5pCML8v8API5zfEQx4BudgqiczviSnJhQwCP4BMCGl+wO8+U7AJi/W4O4YS6+pmK/2ciADsAOBhTIIiAJnPB7AvNjP+0AnANaYkAHX2JBAc+tYaJXOqBZv24Vc386XW5dtkHGW+4HFAJonpOe+YYQZAShgKjv3PNvPQaxVoI8zJdfFwASfPzMUwS3Kt1v0UFIlos6oDFdAGFcliMAP/ryAEAGNwQRnDOgLbdlIEwrIs6AZ/QgkMMHQF6ZAKQcJAsSYPwIeAIk9wJgoPK1gi7+PwF4GC/fOAAvIQPSs0URTPBJ/Pp3GSEGRHfBCIQ0xowBtUbcAj7ys5X4Jfu1HIAGQrIgQRXEsAFQIORDFhiDY/rMHmrU4QUgR08AkgUjCAW6CD6CkwBsAIQC4GG6fPMA3OXiNzCg2I9gNCMksmAAoemDzoimFwL48M85AKkiuQVMAAp8CYRRDAt8GQiJ67N6GJODAXAHlsGguscA2AJg1IPGYmxOpBxFWkRN9LsATgIwXnNs/v/5z/9XCf8BO3YAtxbc/46/KDt+5+ea1Yku2VUxHz/z0v24FwMGK1gWsK2OUUxHHdCBeRUB6OxHABr4ZICIBd0QWSF+XRdMTAjgCdTrG9cBNwE4F8CpDkICyYLGsuhFt6zs+gISwUen8zEAjgMw4cfx2H6O/90yAFo84Cbg4ID3/9TfLTt+5+ebnRABkODjx0SwPi5ec/FrYpmqSAxM8Dn60CsqAFI6GfhqAMiDE/gokmvEr0C4PgDkBQm40wE8zMFEUDKEVoxIMLl/KS73mE7H9d+vcKHQQcjwW0Yu9nP8m8sAmOIBuWY6wP2/4s0ezjjg8TuvaR6ABJ70vxUApGrm7EbGE+i472BAB+WHfqHS/eoAaEwY2E9+wLSXTqhI7CXgnB6LCoOJ4BiST+hTnG0HcCwAglCx3ARoZEVFXnBPp/O/A/hXACc7CPs9/i1lAOyIB+RDX+P9/+pbQjjjAMfv/PL6AFDs1wFAgs/9fgKfgdE/ZEpuiQlbwAde6QAMBgiRmsSwA9BY0JfjovGRDBMH4TlcXGhcBOc6HkF0gjPhZgchxTLZMAci/04W/B6Ab3t09EPXcPyflgFwRTwgJ2MN9/8bf5qFM67x+B/aW4XQz42FeL0YrRyikztUFw0704mf9kXgxhOAqc3AAsPyRxxQCs/PdXOFY0W1KHy3QIUGtx+6vdnx1vsB+dsTncm2AogglFgVEAlUWrOMB2RyEmMCGQ/Y7/HvKns6tfGAnJQ+r/9b76oJZ1zD8WdyQjYBh8aBhVEHjELouQ8ukQ7VRSCJAALwkr+sALhnGzDD3JAJYJHg9uhoi4bx8ytkWUtvHT/7+Zc4dw1uZ3612fH2dkQf7yxIEEockwkJQn4IQoq8unhAhmPRKKFx0uv4K8ueTs94wD7u//VX9ghn7OP4c+4G7h8HpseB+dF2AKlFLwuAIZ8jD6NPrOhAffmfA9/ZBuzZCkyRWSeqBCWyoYGQ5yQrBpDbum/ME1HoPo0XEkSD2zlfbna8q6+EUJcTCxKEtHL5EQjP6BEPyIgYAZBvYt3xHyx7OqvGA65y/7/9wVXCGVc5/sl7qxD66dEqiYgRzAqhN1A4CBNAAlDyAFI+iZ9/N3DLJuC+jcDUBmCWyUnOrmTYCMIOkNclLg0B8/RsNLg9+UvNjnd1APLmmQpFHyEBROuWACQT8nN+H/GAvY7/VNnT6SsesMf13/CpahGnZzhjj+PPmwX2MYdDIfQexWyBAwEUOQDrRDN/98p3A7dvAO6fAA5sqHJDBEAyoUVGkwEd6HR12XU4kwzfl6fCXTZzjy57vvnR513X7Hj7AyDvggAUi9EyFgiZqNxPQF6345nOWbD1HQ/Y5fpvuLa/2+82/vNHgAPDFQDnhoF5j2C2qBWCI8bw1eRw5CL5l94L3DEOTI4DB8Y9OWmsEu/zBJ3rgsaybqBob/7A4C7jtWcooRrczr+u2fH2D0AOQgAUCxKEP7aGgLy64+m6KdjWFA9Yc/03/Osa4glrjr+AupqHz1sEs0cxG0BC9HIePLoit9eNkVf9L+DuUWByDJgaq4ybGYLPAWgiXmLedUE7dwC7saL7CqfPKXi4NYdaykCD410bAHlDEsNiwZ9wAPYbkJcfz6T2gm3N8YDZ9d/wHxUA+739fPwXPrSKYGb+BuP3jAFDElFH9HIWwbzCIGkBr/or4J4RYO8oMOW6ZVcAuvi1Cgoha04BCwT5gfMKHm7NoRde2+x41w5A3hQZkADk5+cGiAeMx3+/7AENFA8Yrv/G71cAXFM4Yzj+otOAaQLQA0gZxaIIZtMDFTigKJV8H9Iq6aZ59ZXAvSPAvpEKgBTtBODcSCWCZeRYtpzrmLyeGNCAyFl1v+Hei8qeb370Rdc2O97BAMi7EgB/2QG41nhAHU9LuWAbOB7Qr//GPRUA13r7Gv9FZwIMoVcEswEwfDoimEP0shKKtIphaZQAXv1+YM+wA3DEdcvRKkGJADQQEsQuhi1Tjt95vBsh5nx2IO59SsHDrTmUOStNjndwAAqEry0IyCMICkOyiuIBNwBvPFQQT7gBuPjc9oRYAIHyOEL4vIFEYVNaOou5vCGE/tV/A0wOVcnpzI47NOri3QFIBpSeaSDUdYLOSWvYImSGgftpJDa4MWJbAGxivGUA5MAOc0Be6eVLj7/4Mk+hzCOYPYpZDBiNkLh+G/M3yFyv/ltgL3W3YQfgcFUhgRY2PwY+Z7/EhAR1SFyXCOb57r28QfQBsJQBMn5D4y0HYLPje9Cd7RIC0PM3EiMofF4gVCBp1P840ix/gyz56r+vAMjk9Gl375iB4+CzveuZdLkkEPJ8ZEfX/6R73vOjzT5Si9hucLxHAVg4PwJgRwh9CKOXK8YA4ZEqKZXSQWh5P+5AftXfA/uGKvYjCKn72cctbFrZNECka5L5CPwIPtMH3TVz17MLB5gdLgA2Nd6jACycHwLQxFEUSR5ASvARDB0h9AQb9bXIgCGk6lUfAPYTgEPAITKgg1BObk58srTJgG58WMkWMaAbQQT1nc8rHGANAJsc71EAFs4PAagQestgC1lsBJ4BMCSOK6dDUcwqqaFiQr/0QeAAAdjy+jBiQQeeMSBZT3nCPUDIa9z+/MIB1gCwyfEeBWDh/BCAeQSzgkjFfGLBBD5nxQ4DxN0wv3hVxX5TBGDwL5obxvVA5YqYL5BeMLd66YYxJpRB0gK+96LCAdYAsMnxHgVg4fwIgMrhUPKQ2C+Bz0PmBTqBMQehAbDlIjj4F80KJguSVZ0FuXpjoCOgXawLjALhbT9eOMAuAGxqvEcBWDg/l1IE05Ed0ygZnyHdz0VwCqEPIfNyx0QQvvLDFQCp+8nfZk5und8tXwIgWcHSNX0N2CJmnAl3v6RwgNnhl17T7HiPArBwfghAS7mV/hey2JS9FvM3BLpUUi1YwDRMXvkRYJoAlAh2l0dcZ04s6JUTDIjyBcrl4yDc/dLCAdYAsMnxHgVg4fxwKVwJgGEJNmWtxpQMpX9on2eRhVA+O56AjMfnP+e3Xvf3NwG4xIPTleiY55bpGh6UbafNU0l0z0p+5Jh5HqYJ6b51nP6XP8cx12XNHQVgIQB/bFPVg2OC7Q+WgVFWng/FvtWLI06uWh5oguKEcXVS/9sEAF//VGD7t4ETDgJbF4CNi8CGZWBs2fPL/H6Vwp2KEtVk4fJ+v/EIYPN9wKa5qu+IncfPwXHVZe/aOL3EbwS7xv8A1rQvnO0j8PArTgTGZ4BxFv9mIxhOCGsv+0OPYDRghcLfkWkEuq0+G00x4OtfDGz+d2DbHmDLjL8si8AYP/7CGIAiEEMTG92zXqSbH+d9R2aA0XnvO+JjthiIrOVDHHPOkBrzUQAWAPsZp3oPDpa/Xag6EVkLBK+5rAnJC3/nYk/APD704WiEAV8OTHwX2LQH2DgFbJgFNrBhjd8r79deGoEwsllgNBOzy8CdjweG9wBj08AIAci2D6HafmyAk4/Z7SJ72hGYRwFYAMDLTwOGp4FRFgD3HhzqRGQiyeurqOdG6r0Rm8IEZjzRlkiqCWoEgK8Axm4BJu4HJhyAbFhDxmbDGnZO4j0SgLGDkpibgEq66TJw/1nA0F5gdLpq+zDqFfd5LMeWqu5HNST0uJOIllg+qgMWgI+HPv0xwLA3gWHpW2sC441gCECbmKziaGrnUdMO4aHeh6MxAP4SMHI7ML4HGD8AjHvHJGNAgpDgY/ck3stipRemvVhc+uASMPUEYGh/9dIRgGx8Y+MNbR/00uVtH0wEx94j/v0oAxaA8Ed+GBieAYZZg5kADC0QWGOFzGJlcGPzl1BxNLXD8sk4xftwNAbA/wwM3wGMUmxOOQBnHXzetIYvibonmSiuYTNjriVg7glAiwBk0fNZH6+PmX9P6kfNmCXGpftJ7TgKwBIAnln14BAAYxMYm5C6RjCyCoOyr0qkD/c+HI0B8DXA8N3AyCQwesD1VQKH7EcASm1Q+y4CkN9pUKiVF5nLvy+fBbTUd8QBaH1HvNBROiZvfsNnrF4kcvPwpdsBLBeU18Nf7AB23Dp4ecHC8oBgUlJJecLS+7+WOpE3gbE+HKw+yoevCYkMGKqPJrdEKARutaFYRs1fiEZ0wP8CDN8LDO8FRqYq3W10pgKgfYLaYCzootgA6KXaTA90y374TKB1sBozy77xHFZ536utRgAmEaw6g5kUSFZwSXnA330qsOlfgHMPDlZesLA8IOjoLypPWHj/11EnCiVwkz7kAExtsGraYUWdSDX5TmsagL8KDBGA7Bd30JsW0oWivnEOQNP7yGTSBR101AlZSUtGyfgZDkCWY1HnJdcBVe6325hTvelg2CQjZNDygG/2An0j1wKnL6y9vGBheUC8prQ8YeH9X39OVQSc7Mc6fCaKvAeHdCIVf4yMYCynTpX+nb97NJmlSQb8r8DQHm9YOFUZTKOzoXGhs6AxF0HIexcLBvWBuiHN8s2ne98R3qc6L4Vyb2oBVjfm9MIFHbjDCh6kPOBbQoG+oW8CO5bWVl6wsDwgfr20PGHh/X/1iaEIuDcCTIW/1Q4rFv8OnYiW3c+W2iKwUjKbyjQNwL1uuR6sAEgDgq1brXOmV81PxhNB6DUDBSYzQJwFtz623XcktX1Q1VWKaTF/zZhVazBVYA1tX5MazsGvobwe/jQr0Ne6BTh5uf/ygoXlAfG60vKEhff/rSe1i4DnTWDUACY1guFTDqLYdCBvf6DJYSMYATBfOx1kLfj1v1axH10nQ3Sd0GUkBnTfpemtBJgseIKQAHLQcVxa2TnuMW0Aqui5es8xBIegVdVVE8VhzHnLh65WMB9An+X18K6aAn2tO4ETl6vqbKuVFywsDwhevqg8YeH93/Rk70JE90nowxZbIJjvS3WYNSGUwGHJTpPxwwcbBuBrgRYBeKACn7VtpdUu/c0NJxO9BIxcKu4TTODzbkonPLoaL0vyUQRb2y8HsL1ckfWzMeuFi40Qezqi+yiPhyt7FOjr6/gCFwgP7Xb5vssTFt7/nQRg6MGRWmDRoeyTlpgw68GRTwgZgo1gGmXAX6/8dtaylSKY/koyID9BhzML3q1gAos2AcOrZYSoq/pJp1VtODRm9Z3LS/7WjVkvXOzEtOpKyGrlAT+4SoG+VY8vBGCvy/dVnrDw/vee65NBJiAjBIVcAJQjOm+DkCZEeiGAMw6sAwDZsJrAdhFM9rPGhd4904Co5oVuCZPV6kD40Ec6+9W8dBTBsfdc3nkpvnB82fp2RPcs79dHgb51LA9ofsDV6vut5/3PnxcAmLVBiDqgevDaJLkYrpuQxzcNwN8AWgIgRbB8loEBzXDwl4cGiDGft58SCOWGedgjvOJ+bPvgRkiuA+ZjzhnQQOiFNVbloa7l/fos0LdO5QENgEXlCfs8Qbf7HyMA3QVjYihYhLENgjX9y/qwxQmRU/asfd0ZcLU2CHVGyusJQLKfVi98CS12T5f7iECkHpsMkAhCF8+nshWH2I/jXsOYO144GV/9ApAIrS3vt4YCfetQHtAA2G+/4PW4/2PPbzMgmUMi2NoeSCRxIt2/FvuxWURIWCXg357gfTjEDNIHnTRXRCpH5ugKwGl3HpMBXQc0v6WLYVm/5limj04rG762K2uYY9jBkr9+rI03NL5ZbczS/dJ+LQyoga4o77fGAn0NlwdMAOy3vl/T938KAcj121z8Bn+Y9eWQJRz8Y6kNagDh2ey5EvxjxQD8TWdAuneCCO4An1vw5vdzQMmdktwq7pLZQR+dM34+ZumAxvY1Y04uqOAJ6FsExzeto7zfAAX6GiwPaLWR1lrfr8n7f/Rl3QGzmsis+/uO71V9OFgP2gpPhgr7TGRqRUT6dyvr4aIs/pm/2zVUNbBSv6G8e5pEv0Cvec7Po7+bTtjlBRlkvAMBkDeQyvsNWKCvofKACYBrre/X1P0/oWEAnnFD1YdjhtXxR73mX10FfCHHE9pVWcGAI/S0gKsfA2y+twrFZw6Hxf/F0Pk8Ri/kpGSnMuDx5T0iACgQHioo0NdAecBUHW6QdsV2/cL7v/Cyqr5gnc42CCOcfX1VIZ/V8We9IDmTzVXwPDJiXuKXPxtDBma8+lzP4WAgKkPxCUAPE4v5GzEuMX0PYJPLhB6FJsc7MAMmkVxaYC/K9gG+F1++8AQ7Gwbgk78I7GFpXgIwFiRXOwaJZPUbiR0yCUDRk+cHf+YpwMj9HgfI8ClGPyvsSiH0WSKRuYlitLb/zHM/JOSs5C/YIC9cMQDZr/dwxgOW9gtGYUBi0wA8l304vDQvAchilFbpIBQhZ7Ejq6ZQ0/Yhil8y4j89Axie9DAsD6FX9HOK3QtROTFkviN83kG4felIY8DCeLrSeMDSfsEovAECUFsTjHD+tcB+tkFgcXKvBRir7qtFl9owmO4Xy/1G3bAFfPrZHorFNWBFwHjQAFctIghj2kBarw06If/+MM9ZqTN6DgsDojCerjQesLRfMApvoGkAWh8Ob/tgAPSKWCp8ngNQtadjmTdltvNvn3peFYhgQQgh+iUmEaUAUoXM1yRLmWuFLaE9Z+XIAWBhPF1pPGBpv2AU3kDTALzwmqo6qtVh9kJErAudABia38TC5wJgS2xIhAwBn3yhByL4EhzXfRXxYsDTJ4IvrNN2JFMxZcBzVo4cABbG05XGA5b2C0bhDTQNQLZBYH1AVsQSAAU+imI1obHyblnjG/kJk3U8BHz8xVUQAhnQIl5CyNgKAGp5LKSSCoAySh5Jj79vTagcxUaIBeRNe79g9gq+DXig4wGzy+PONfT7RWFA4noAkGXZVAhcBckJQgNgrLiaNb3paIDo1vHHX+oA9LQBi4DxJcOUPJUnTgU2NJUyROs8irGARxQAC+PpCtsFd40H/AEf0gMQkLgeACT41PiGoLOKqyrJq3K/Ya9mNyr5FusN/uPLPIeDa8Bc+w3rtyl4VFHaMZc3i9RWBM9jjzgAFsbTFbYLRmm/YBTeQNMAtD4cBKDXBTQGdAB2MGBo8SCLmEuS1AFVAJ3A/NhPt0PoCcA8bSDG76XI7aySg6JYuGfKwJHFgH0E5B3ueMCe/Y4L+xVHAOZ+9EHcEgQgwbeiEYx6jwTdz4qfu7EhEJqxGqruf/RnHIAEnxgwBM0aC8aUAYWNBRCmoIll4HTqO122QcZbrgMWxtMVtgvuOx6wa7/jwhtoGoDWh4MBJ16WN4lfr8AqI0TVV1O1fa9BbQzovkAy4Ed+NgCQUSxZCFWvCOaOFREXyUwZOPIA2GdA3uGOB6wPaOz+QPv5S+MA3OXiN9aclghW+d3IgupBF2pPqxcxGenDPxfSRh2ASiKKiVP2PaZScvAKoA0VDc6cOlIB2GdA3uGOB1zR77iwX/F6AFB9ONSOQW0frA50sILVcckWJyIDSgwPAVcJgFbYuZ3FJvAlEHbJ3IsgJLGedeBIA+AAAXmHOx6wo99xYb/i9QKg2iAIfDJEJHqj4SExbEty0gkdhB/6P9oZbBZIGiKYVb9GKaN50lRHBLOvhDxh/5EKwDUG5B3ueMB2QGM/grb7/6wHAPNGMAY+GSGUjC52VX2f2CD4+HO0gqkZfegXKgBaHkcWtS0AWii9xG1ImrLlN5XR8L8fmQD05BVrmEENmpYSP9QX+KHiqj2/82+HqqDWwnbBRfGATdzAegGwru2DpRq7Mzq2fpAf0Nq0Rl2wBXzglZ4yUAPAmDSVWDBPHQjLcgTqOZ6zUvdKHh4ruDCerox/Dnu7YqwXAC1NI/QcEQuK6WK/kdgCTGC0PYAP/KIDMBgglq+hIkrOfsaCviLSofcJgJ5AdM7kkSaCj/HqQKVIGvD4swF8bcBjmzjsaQ2H5D/6acBd9wALB4DFWWB5AVherMp4GKIYEOp7+26UF0aSfT/xYuDG7wDjrIpAERytXf2vajj7ueryQXSFl10K/ON3gIWDwCLvjfGB8Z54O+Ee4ve6513uB2R1yzsqC+twbC8HcNVhfAeaBuDP/TvwtS3A/ePAIfYFVlPq2HHTuyulZCTlhbjhETF5yxTQGgPGhoHhIWC4VSXGD3n0tLkMHXHxu+YyB+MlPwDuZs5K6FlsbCzdVO9DuKfkHM8AEkP7B8fOkwDcD+B7np42+JkGOvKdAL4E4K8P0zvQdET0b14D3DgB3D0B7B8HZka9WzrD88N6sFm+YcUjrn7E1ZDvMtF9DBgeAYaHgSGB0PNHCD4BLwLRsByAyX/ij0/dDUxuqlIG5hix7eFhvLcOVUAtyPSydAFmOQNe6EYGV/9ZESiKgIEgtbaD/gHALQC4ovY5r5KwtjOU/XfTAHzzLuCmIeDuMWDvKHBwpMoN0WQzNtAaYSs0K4ZlOSAjGG9kPjCBRwZ0ABKEBJexYAZEAU3A7Oi1BeDym4EDnjQ1TwCGWMW8MXcKks0YOyZNlQOQjcgYIUHllEzYQ0ktm+r6oz8G4F4AXwXwRd8/kO9A0wB8y65KmPxgGJgcqYJTKYpTv2CCzyddQJRDOjKivn+Deh8BF8BnwBtaCUA+YYEyAU8h+c6Az9gNHHRmrgOgmDA3jHQ+iWupCeUAvNSrA9HNwqx+muk9nJVNg/CTfrmbAPwbgK8D+PcHkIibjob5o13A3XypWsAkG1cPA9PDFQDZM1id0i1KxsWfOrKnAFXlifCFFMMRcASigOcs2MGAIfE9iWXplS6On7UbmPaUUTXQrgsVMzcRj5Folg2V5ayUA5BWYKwOxKUafnosWjcJwk+7W5F2EKvlE3xcXaNYfiCYsGkA/smuqug6hcleAnAImPbO6YwRpMgjCAVAm/yQmKTv5hNsAf/i7SyNBSl2a8Qv/4/M1yF+BZSYlNQCnnVrpbC+mToAACAASURBVJcaI7sOSEY2NpaDXLqpR+vE/OVksDgImgGgghHoYJbTWc7oJtFWc65/cg2AYvh2ALsB3AzgVv95nS/f4QdsIkT9T3cBrGtITWZfC5hqtQHInsEGQn3UDDvEDEY/ICf7SxMOrAg8T+c00JGkvHGd2DABUYZIAONzCUDppCFhSukCBsLQrFtZe/IixYQpSyEoJoqnuPWrVRAubQh83HNlZB23z7j1ywmj6CIIqUPxw2Xeu9bx2jx10wz4Z7sqTYZaDD8EIDuoE3hMVEphWg66JIp90k0sBxBcy+iPIIaT1RtEsHS/yIAqw+VSNPWQfe5tlVEk8auXgVa5BUsEJuT5uoliAbE5AGotmIAjCPnR9xDG3TQernYAUupTdBGEFMf83OkApHG+XlvTAPwfuyrgSZOhas3u6cwTsUBVn2gTwyFMi8wjHZAA1M9fYGHDULJD1m8Cpa8fRxDad+l+Ykf/3XNvd11U+qiL39SxXevSsshdDFvgbI1O2AwAtRZMZzTBRuDFjxe1Xg8QEIB8yyj5yYIUxfQIkfkIRnmHCM712JoG4FsdgHHp3ACoMH2G6jM4lWzoQarSvwQ6MSB/vporVaFkh+mCLlpVR8Z+dqDZLoDOpHSiQeAFDkBjPrlgCHgCUaFifg67H/9uYjn4Ai1vpTERTAASBaoQJBAKeNqHlL6mwPDZYAOROag/EYRkPX34MwHIvzW9rQcA+TLpI22G7EcQKlJGsYIJhC6ClUMiXfBTbFUQAej6nPS/OuAl9pOOqIc2BLzg++3VmWgIEUz82cRuCAtLIHQQm0gO52uOAb22sC3JEWgRfPpZf2sQBQIgLydPEIFGwPEj8MlF2bSbsulghLftqsCXq9HGgHysznrGgi5qzTUTFH8FLhAUn3hIJwCN0HLncw37qaF2zoYvuKNivmQIuUNc7GvWt6sHNs26twA6vhyq8NEMAHlyntFrDCcQehyaPTl+FwAbXDcmAKMRThakEk8Q8kPg8SPL0qzLBl+A9QCgR6uZGs3vfHz8TtBZvkgGQrEPBVAUg2Sij50QAOjiVKI3saADJRm7dSLYWfSFDkCem/dhZeMy9pPY5QvSDYQyUJoDIK8qMezh3wY6fSL49PcGgCAA8pScJLIgAUYQEmz8RPA17StvGoBv39W24eREiBoNQSgWNI1HBkdgxJSw1AI+dFIbgOYmkjimQ1r6XXC3rAbCHycAgytohf8vsB/r2KRaRq7zpZ+D37HMX0s3DDcCUGLYaw53MJ4YUODzusqlGCQAOQCejuxA8UULUkxIwAmMAp8Wa3qkN/R9W+sBwOhIEPjk5SLr8HeKFbTQfb77csPIMHGl/4MPbReslPhNe4+MiTpi9AFGV4nI7MfvagNQLh/pfrYnDAS8aJQ42A2w4em2cAyWQUuJVQTGWLs1uL7DG9J1RjhA+jvYk4t3KXeMqijpzrud4At9z3XtP16yGfjKZmCGooYh1tZzvv8xXPFl4PoJYC97k9FlwZWD+Azi/deMZWeP13eQCGEyoERudChIjbb3mJYwH7V0QIKuCwj/gfMj0asn2I0FXRSHXfL/iRkNgLyeVj8ccMY//J1fyxzTAXT2+xoQViKYD/1hDqLxPiYxTgSvQrphphG97tz4Slqafnj7uk1kIQDZrvWTw8B3jwEW+RLxPgSiCERdPwPR7+wCPg/gulFgfruDkOMQkFc5x84e708JAMmCuRNBXi4TIg5CGRzGiBGE/D4E/C2r2vcAYJoify62i0aJSMhB+2IHoNwu0fkcjQ85pu3ack5nIBREqneYFyWLkAXIJHESe00Cyx5QyeL6F/tyEcDcrOW2n7fX8df0mME+/vQ/PQjhoy3gzo3AISYf80MQaQx1peH9wb7v2mrtmCBkIMMejp3jIJD1MsaxaMZ8v5N/67INAsB3BAYU4JL4DSo1J15AFPAEwuQHZJzkKfUAtOHLJSOQRWndBYQvCQA01cfnNopfsaCJaD2baBn79QjSTiOEP1EcawIpkq2kegBTNgHWEpOKF8Uwq2NRFPM4AqCf46/rA2U9/uVDvurB01zvAJpiiwOl3fEeciCGF+Ij11f+QkbSfMPfIzqw57mEFZ9Dl3Ps5HXWAYByHJAJKV7N+s0cCQQhwSlfm4lGZ0KB8C/rABgZUS6ZHITBSEhCowUYAAksF7cStWREyxRwtuPpOlgw+5s9sq6OaIJIIlUgEhA1edoTgHxa9HVw5jibZNF+j/9yGQA/7pbujZ4bwv2+cWB6tFo0NzYnkxFA+cvEAo43VBoEo2e+48EMXEOmD9F6xhCE8RwZEJ80VblKvDlmzwicfqy93/o+8K8TwB2jVSgW138FrJQTXBNlnJgmrjZwanow9CBP/rL9wF0jwAGWDtFyoN9PHutnIHT05mPXz93dMGQAPniJsjiBXiTbxDZFMF9NLUPQxKR5qezz1Y6/YZDH0D6GkdAkYJIvRalAdHAMmPZoYhb6NhDWvEyf/ma737CXN7R1ZC7hUbPgcFgqt/ZZjADnM1xqEVhYBpb4CUk5UsL7jQvj///5buDrLeCOEeD+YQchYwG9VIfyg1NaZszFiCH6DkRGLze5/dgk8IMWcMCjdCiCzR8od1B8OTwvJM8JEShFut1fzMhi+eRJr6LI7hYP2M/xVLwKNoZjUTwRMAQQmYyhWGQxsSADOflZ4kukj7PhZ75bETjBpkAGahMkcrGgwhsXeCyBHBj1wmOBQwvAwqKzoFeRV8ZaerjKYAuirmPY/o9X7q5Cyr7fAvYMAftCPGAEoYlBiVtFwLjtp2U4irj7yOANbi+crHyrfCbTquJV44O0F1FrwQGIMZFqdQDyP/gGSZ8TC0ZRRsOlVzzgasd/u+zpMByLehAfCgMQCDyGZJHFCCgLZ2f8mgI5qauEcVx9e5vACTgCTwEMWr5TdIpWKJb5MvrnoocDswvAPAG4VLGg6UKeqmi4iuDz4er30oX0FP7u5moMvIf7W8B+jwlUNAzFnlZCIhvGFRCeWzrgXSSIBreXTFZSgVLHAp4UHOFuociEEsn2PJwl/XEk0dzfSojeerFg1IOo5BKAveIBex1P67lgUzgWQaJwLAKRH04i14ItgDKEtGsRnWx49b2Vkk9wUefTGrKCF7R0JxZMqxN8cmPAxWcAcxGABKEAKPA5u9lEaAbCmKMI+sDN1X3z+ro24wEZFc0VEE64ABgT180PF9ZdBcDb6JpqcPtPk+1ACbmKjJnllwyuILunEAWjZHkBsrsRUnfD0qEiC5IJfyisgMhzWhcP2O14Ro4WbASgAMQJ48SJwchmBCDFa8qpyBbSP7OvU4PQ0p2W7+LSnSJUFOrI4V7w5IoBTQQTfJ6oTSYk2mQcpGRyH2syGjIF6EM3V/fM++C1CfwUExhCsmzCaQT43lZC3e1hBpEHh36XEqrB7Scmq5dV0XZxmV8WuDFzAF9iwhow9seAGoBcGtKjqAc+1l9rLb/1igesO55ysmCrC8ei6IxRMAKTWNBi6Xw98xNTFUi0jEcmpYgRAPhddpVi9OIEPP5cYD4CcLkCooHPwaW9kV+iwWrQHT8uA1fd3F7DFvgUHUP2k8jTiogAqLoxFpDgbMj9jXSuN7i9dLIdaxzBp5XVBMIMgFEnFAPKT9qPd6A9BIGI7MfPmf4U+40HzI8nWgq2PBxL4FEkjKJixGRRFyQQPzzd1iAUzCAQas1YOmAEoFjwkecDC/PAwhKw6CxIkCXwOdVJLxTobMjBdyIgfvimNvNJ7Evf4jWtdnRYD1YNGVuG93VWuWs4Jf+mlZCCZxwP/cnJ6mXVKk2+tK8lQQVHRTGc64SDAZB3Ey3JcxyACkToJx4wHl+YwqloGDICmYmTFgMQFBET8yyYzyAG/AfWX8mCGQg0BTRoHwt9KVaPE/HQ890AIfgWK+CRAaMRYnVdxHbhdY8Wslw1V93UDsmPIj9GxgiAioRRMIJNvoti+SW/Ikd0gwAU8+XxJcbGITJPDvI6XdCFREFSknTB83xka40H1PGF9dnycCxFwygkK0bASJQSVAbAYeD98xUAe5U3jKIwBosSgNsuABYogl3/IwgFPrOIg1Xc4ZrpAsSrvruykl2ucykapkMMh4CExD5DwJfWAYAxwk4MKPAJgOIjGSEGwuCakRhemw6Yv0UUwRf7L00L9pnsNx6Qx4feY4O8pDEcixOjsoTKKpMYjSFYYjOC8Eq3Wnnr0YYS+0Tmi2HysrPGLqwASNYzBnT2Mz2QD91laxLB0gs12GAh81cf/o/OcHyJ+qj0S/zxnhUZbSyYWaL8+Rq2S29wowiWkJPan4MvgrDDGAlRe7KIywDIgR3meEDWg9HbJgApNTkXo8o0i7oVgxnEgFr8F7jEdnU5GvqfJQKQKyEOPlsNIQvyvupAGHS/Okv4qv9oh+PHxMLk8ggBCRxvAmEN+AiEzz2iQfQBeNmkh4K52hJBKOaNe/FSLobLRXCz43rQnu2yi9oMSMDxs2jo8303ERz1wsCGZECF4kd3DwEYYwJjhoNlQrgIjlYodbBPrwMAZfEmyzcIv27gs6XDzC/IR1DOgA9a6DRz4wZAsZ+LYXvQYsHoD4ziOFklna6YD3+nnU6dZ7bGDAcBUImIAmEUw/zbJ1i/scGNDJiLXmle3RhQ+l/aq57gUQCWzwwBKPeLsZ/LFrGg/ShRXAe64Ajkv30kALAjF8R11Dy3K7KRwJcsUTaqWScARou3w/INVnCH+A36n8RvM3nB5XP4oD6DATBYwGb5ajlOLOh6X8JaBKRG77+7ygGYp1bn+V25/01AzBnwQ1ypanD7KWfA1QDYC3zJIj7KgOUzc9nFbetX/r+O5biwNhyX5uSEDr5o0xsJwLp8/m4A7GaJUv/j3/5+HQFYJ3oFPPkho/hNeqBcMkcB2BAA6XrxmMBkfFAci/m0JpwzXw0TXvXtzrz+PKc/Ml/ugzM9MDqCAbz/keVjjGcQA/YLvjoguo1mRslRI6RwfsiA5nqhL5D6nscF8gfTdfxpS+/hLzvWfzMQCoB1Fq/8b3VWaPIDZqsRV64DALsZHVHs1gEvsqFAeBSApQC8pHK90Oql4UEAyvCwNeGcBXNLOPMLftgZsI75ouUr9ousp2TEyIJ/sU4AzC1e+WIFshyAHPZREVwItrrD3wGAhibTYBhxVpe/xePyrNBuWaoNp3DgFwC81O+RAepK/a5Lfe51jxr7JwA83nPXYgq1asl0yX5N48+f4VEGLATlK1vAo5YB1gBSRmsM+NFE57lcfPD5pPFWCJImtyvGgGfOAacBYO59zFglgHgPefZsXV6/gPXBYeC0RVgyJNOGYuJjPka9eHWgjL9bWzhWk0/n/wPn+k8bgFNmgYcsVflZnBRmIShtJM/m7JGibGBoOIIez9wKPP4AcNpylfbNlGfdI+9NjBjz8JVzppckZuJ+dBw4aQ44drk6j1LIY9JkPD7P4s2lwVEGLHwJnncscNIh4Nh5YMsSsHm5ndOu1BGFThJ8/K6JrZtoslST2+XHA6ftB05ZAE5crgAups5TfaL6EF+UyIif3gAcOwtsXep82eIYY9JkXpMgMp/AeZQBC2b8OduBYw8C2+aALQvARgJwGZhY7swEzbNa88IRvAVO1qkF91J36DNOBE7eD2yfB45fqphLnevzdGeBKBfL8UX5/CZgyyyweRHYsFwxYHzRNK6oetSBMDLjUQAWTPqPngpsnQK2zgKbCMAlYMMSME4ALrcnR6JYQIwsoUnjpDRstOLy7cBJB4CHUGwuAtuW2nUDVH1EFUhycSwWjGD64mZg0xywcaECoI0z5P3X5P6nWlHdgHgUgAUAfOYOYMtBYNMssHEe2LgITBCADkIzSJZXpCOnIg25uPrhgnupO/TyhwLHHwSOmwW2LVSik2pCrDsQskzNIBGIpBdGI+VfNgMb5oENCxX4yPRjPj4xaJ0+WGeEHRXBDUz2Mx4FbDoIbJypADixUAFwzAFI8KUJChMV2SUaAGc1cE/xFJef3FYRti64nkqWDrqqEhbrsm5zvZCdPCd8nHzJOLZuABRz9hTHZwPL7LnLnoNMIY2VyaKcjtZLHOAbNgNPngKe4BacfGF1pnydD+hphQ/8XV5UiEueLGnDN1tWXj/3/4cTwAUzwGPcRcFJiDpPt3FLmf5vjwE2HAQ2zPrEzDv7OQg5OSM+ScYQy5Xbo8465u/ZfLTJ7fKHAdumKxVh8wKwealSE6inEoSy2MWCdbUHIghv3AqMzwHji9VLZuDzD8cXxxWZs5c7apmW0fMBnIHKn5X7d6I5npvRz94O7LgXuGIReJSb+Xl1tzqflybwRwqf9i97BQRWomWJQ7oZVFtJoqDX/b/oGODsvcBTATB9gsfGqmzdjtVz+G+PAyamgYmZCoDjFE2anCVg1CeJwOMnTRB/DmUINVkkgia3y08BtkwDW+YqAFJFMD1VAAw6XG61R31O9/fdrcDYPDDmY0zjc1UjivBuAMx1QdMB+WAYXU8dhEU16dOSkppbcHFSrng8MHwnsGMPcN5ypURHp2xMIa7zDz2z8Gn/kVe0YomO0wEwBYKujL7v/zHA6C3AxfOVh58g5AsZxx4fZM7sf3h6BcDxWWeGBZ+cMEFiwGEHHRnDzun7ONHs/djkRgBunql0VDOSHIDU3cxSD4aEajhFXS4H4S1bgVGN0V8we7E0Fh9jVDG6Obr1LJMRwn+kOCaTEYT0dsfqZHXl/p7PrLi9wIY7gO0H2yAgCAWCWCowKrYE8nMLn/a7PQn9X7zIJPPkCcK+758y7x7guNsB6l98gZjLLYet3Ay5n0sv4R+fCYxPA2MOwLEAQLIDPyP8uBg2cRYmzFweAYilKkn+OC8/Fdh0CNhEA4nGA40kd6FES13WLO8v1qHKAfh9B+DoYjU2Ak/js/8NAIwg7OUb7LCC+WAfB4CpBJoIiTRNRmS1l13kqWh3Adv2A8cdqqp1MB+aIOSxWv6pq5D2kkIAvt8rF7BLJksN/jMqfa7v+7/Ak4B3A6ceqpasKMq5akAmlLWY37t8ZW97PDB2qALg2BxgAFwANEGcnI5JcrDZRPlkaXL4u1KJUAfAjbTQ59x6dSvdLPXAgGYshZWR6JIRaXB/NwFI8C1WwLMXzMeSwLfcXuKrA2G+wrLCDcN/IIg4ERRn0qvyySAQX6mG1XuA4fuAbTOVwktRRr2MLCoQyvEZ/UY/WwjAj3jtFJZkU79g1ghkgEBf98+0Umb/3A2M3lkBl/fOcdMok2EjkZyv8773LAfgHDDKjwNwxEUw9yailpwdxBAEYhBbAuGzG3aKkQEJwAkCkOCjlb7Y6SYyf2UwlAS+vKYnAXjfNmDEX7DEfA5CjUcsnzvbu1nDtUMmCDkRZEEyGdlAk6G6lQTSa6m0MP6HuY73AxNTlcJLZ6WOJYC5/CNxLpHMgdKIKNl69Qvu6/75AjHOiTU87gKOOViJb748BKCWrnK/maTA+58AjM0Ao7PA6Lx/xBAupoYDC9okBRAmPdBZ47lNA/DhwMRsxX7mPgl+SrmK5EaRNRslXFQ9CKB9DkADn79cZtkHFkysJ103eBbqlh97DpmTQTYgk9VNxu+xYbXKU3lhFoJPOgdFGY+lPkgQxokkgF9Xgj4AvfoFs84eX4Ke9x9fIC+tRfDxvvniif358sSir2LCj5wNjBKAc8CIi2AxxLCzIAGY9L7AhGIKgpATw4l8wToB0JjPrfTkp+SLQbHrOqm5jNyajS6VCMIpApDAWwQ4LrGgXqzIfnq5cv0vN0ZXHTInME5GBNLb1DGdOYQsI7AfGKFjlgqve8wJwG4T+fuFAFytXzCLb+VgWnH/fIGYfc46Hs7iHC8ZkPcdXx4VfVXJw8+cA4wIgM6AHSLKWZCTESfLfg7WsIyRF3ckiRQ+HACXkwHptyP4KHrpJvKVGnOhRF9eBF9wE0mUEogz2wC+WGI/vVxiQQIxAs9+rmHA6E1YFYB8DJwQMZl0OrLZ++i7sfT8zroYHLS9df4RACWKxSZvLXzG/fQLZqk2gqn2/vUCUQ9UZaM9wDaPeSPrC4A5C1KV+NITKwCS/SiCR/jRBDlLmP7nHynsxno1IPwJSyRpbiMADXzuPDYfZfBTEoAmcuVQdiaW0zwXwQsCYDYmMaDA1wG8TBSvaoR0G77EcGSET6hjOvVApfRPAUN0zjr45JzVcSqiTxD+VeGzXku/4Nr7JwDJOkxFIwt6j6+RqUrlkO4bXzp1gCAAv04AzgLDDsBhKugLFUvQUhTwCEKbnKCw14HwJ9cDgGQ9WegRgDI8XEcVEDvAl7lVlglAgi+I4CR+Zf1mLGgMmDFhBGFfDCicRJFERviSABjLS7FC0MFKMU+07wOPE0kGvaoQgGvtF9z1/iODkwn3VWoEXxres5ib9xx1wZufBAwLgAQexbAD0JiQwJOuJBA68/H3Zhk6+3CifqqwWNMKN8wjKgbk6gWJgC+FMaBb5vJVmsUbV2vCqo3cRWZcCIACoax53+ulkqNd7iqOcU1WcC9cxEm5kQBUdZ+sTnSL/jEtTWngi21jhJNJBivZBukXvOL+yYBkcOqxKjJ4AGgxzMrBVwdAMmHrZOAYF2l6y/mwV6xD17zmWo6MbRyeWtOHwxJ91IIhr6rqZS70DPPLXDVUrfBwzHKr1EUp6/h0T/6L/GcCqslt4IhoTcwdAqDSs7I60WQH6R329pHuFyuXDJmEjuOSbdB+wSvuP5bGUjmsA5XoUvcvBXKKAQnApUdXwah0b8jXR2YzJTsC0ZHB33FL+2yiX3h/1YeD1fFZGT81g/H6yqkVa9YEpqMhTADle8erHA6t7Mh6j4ZBXdBGjFyO4CSIm9wGBiBvgqxwIAJQlXIyEJLyI/i0SkAG/FbhaEr6BXfcv+5dLKhCg4z1C1HEBJ8+BODQGZXfk/quAZC6ketAZEQCTWAU8PIJt0fgwHzZvVWNaKqi7JLOmtDWFy42g1FxH/XfqGkII0C+a0tnDkfsGxQjn3VPsk7tXmuy+Xp0JhtoJosAaFcUAJUYKiYJxcqHqKAH9rPlG2cMrmCUbMX9guMLpGTcCMKDlZGhMK8IPnPIn1X5PA2AwegwEEYmDGBMjOI5whGQP3NPBT7VJlRNaKvF4t2IWHbDErtDlSk1p4lJ7/zd246tglGZryIfrFhQ7pU8WCAX0ZENG+57U14Z4YrCeLrSxXdev6TfLwrbxT7znMrfKQXfHLQCnyvmRIv0Q3430ezMmL98P393G3wqz6am1NYzzoGn+svqRmTAU2citctqAX/2EI8F9ACEmLHXLZGoFxtSl2xyK2bAYwrj6Xr12+1noL/jUTCD9vvFrn6u0v1/nvGkaoVBAQi0eummMAuXQHMWJAA7gCixG8U0gFfcXdlBKk4Z6zELgAJfZEKrxpC1xOIl/+Sk7jkcdYlSco90y9+gK6vJrRiADD0piad7RuFo3udNCgft94vCdrGXn+tujgV3QAcHLcFnroelivHkchEL8ue0uQ74S3eubAITS3IQhKkMRjBMokgWG3L//2z3VSnP4VDgQWxUEEUxAZFHL0eR3HDfm3IRbDHkBfF0zy4EIKNhSvr9goGEBdvTz/MIYQLQdVsTwRTFDj5jQmdArRDYJQNDSs961R3tPhx5NXoVgoxleHnarjohgLec3D2HI492yQNvIwvqO9fJm9zKGbAwnu6FhaP5pFuMg/b7tTbpBdvTz68cz/zI8azVj8iAHTqgmFHXDUB89R2dtaC7tUGw4kDOgFb0R2wYRDGZ8g9O8aU4XwPOczhiwGlMjqqLWiFYGu570wADFsbTvaxg8nkow7E8nM/atfKzln6/1mS4YHv6BQ4+Z0BbqHcd0NwwYbVD3+1yWhXJxPBrbq8AqE/XApSqAxiBV2MZ/54DMOZwKE00rnDUWcR5KiV/brjtSAMALIyn+/mCyeehjIYp6fdrvVELth8RAClyHXxmhPi6r1m8FM0ucgk8+y4RHC1kAK/5XgW+2hZYofafWcPq1B5AqDqEYsQ3nepR2gqhV2yiol1COkD0C+aOaoGx4aL7DQCwMJ7uVwomn4fm7VrX2u/XAlELth+5sHPtN+l/Ap6sX2dCsZ/phZkIJgv9l++1wbcq+2WFv2NXIjNKAPzuw7MUAV8DTuynFIEsQy83RgTAhiv+NgBABaQOGE/3mwWTLwAqHnaQfr9GnwUbARgDNBUlkpzQboyYCyYDYdILdf0l4NduW9kGoa4geNdazLElKoA3Prx7DofiETtC6XvE7hGEzJlpcis3Qgrj6d5UOJoYDcMglrX2+y0NPtl5UZUjkfx/Hqbecoe0OZzdF1gHQrln9Bhee4s3f3Zxm4MvAk9VSFdUIw0i+Q2PaBtISiBSSFgCYMjMW00MP7pwvvLDmwFgQTzdHxcOSGvBg/b7ZRZByWYAlOERluKM3Ra9CKWc0q73dTBhMFT4ZwIw9l5Lrpes+HjeBiGCUOKXeuBvPcKTiEIOR0f+RhDBMYi0Lhea4GTaa5NbOQAVDzhgPB1La5RssV3rIP1+7yy5OAADoAchEHBkFbKfGRpiweAPtMs5IFNokyOGk/7rAYC9OhBFwNXVY1at5tftCBHaWVS2AJdEcEinrDNC+Lumiyc1B8AB4+muLARAXTDCWvr93lR4/Z0Xt6ODFQkj8WtumEwHTKDLQejAfN3uds/dfjoQdatGLxb8jQBAYz6/boxiFgAVudzNIc2/s3xLk1szAORoB4yn+2DhaATAGJCtbpkCYq9+v4V+aBgAQ4i66XtaC85YkDog/zdZvzUgfN1N7a633Xqv6fe9msDIHfNaB6Ay2JRE1AHAEDIfI5nzZCLeN4Nbm9yaA+CA8XSsul6yqV0rJ2WQfr+splCyCYBR/HJyKX4phs0PKBZ0lqOYTpvniAiUAmAd+HKjo1cvDjHgr+3wPJQsVCymUZrPMuRsRBDG4AQCsunyJtFGHwAAIABJREFUcc0BUJlxQoH62q8ST8cggpKNAFRGwCD9fkuvbwAkyGgJE3C+Nz1P1q9/T3F1EZBxvZh50s6AEYC5yyUHXt5/Q8zI5/KrAmAIkkipkyGPYwXz1aRT8v5ZO6jJrRyAvKOvNXlLazsXs9bo/ztc29Pohgotp5J49Rcj/pzfIwGS//3OM4CNd1dpntQpFUmjEH4LYIgnyn/OLjL8FeDGhwJbNgFjI8DIEDA8BAy1PFK7FSKf43cNKrvHx+8C/vmxwMgmYHgEaA35J0StpvvzL/nP8RbLAfhyT207TChgDRiu/ZL9DsfWNABvYzbhCDBKoBAk/pEobGWTqp819hzQ1/0k0PoaMDEJbJjxVZFgDad0SaUO5LksWVj+XScDmw5UEUDJ6U4d0nVbC91S3ovfVHp5al64cgC+k7mZAP768KCA0WD3A/ieLz090CDceVmlAuhBljLgrfcAw6PAyDAwPFwBkCAbItM4a/FiNtERjBl76W9ffD2AbwJDdwFj+6syImRXrd5Y2FjIYcnzWPLEqnsfC0zsr6qBMQmfIDR/pyJ6xMhKyMrSDiKD2xja6TADTt0/AGAs1KcAUCFrOLF6tbtiRVFavT/wuMCa7MfVTlH098YBeBcwNAIMEYAUlS4uBULOmK3LCnwOPANlEIOSoF9+C4DvVoWXhvdWZVOYqWgi3vOXDUQhgieB0EElViMYJ08HxqeqnG8D4IIDkAzo51DKQQJvBKUmKACzbM4+5hUivwrgiwC4LzvjmgCh6nBcgiMTcv9Abo0D8E6g5eCjfpUA6AxoQIzgi8ALmWwC4z//DxcPPwBak8DQFDB8yJPpPZHeGCyC0KN5DFCByfh9/+OAsekKgEzCTwD047X0SCPM1IYQjCv2E/MJoGVwUUQoPboq0MdqkWVn7RtDDMahB4g+P6qhXFpjVtkDtRGA2nKjos7IyOyHFUbIrXe0FXsTuzIYfNb4O2M3ATGIYQOmPn6hG6gi3eUkQQAeAIYOAUOzALMVh2pAlESqGFBAXAYOMQVjxll03iO/yYKRAT0FQXkwZkjp1pz51LO2XAT3KtD3AIAwj4Wg05kfiuUHYlsXAJLVnP0INLM0OYFx78AzcRySeTsw2AJueI+Dj2Fne4EWKz5MA0MzDkCCkAByUWqsJzarEanzj2zXwjEGFHuGY+pYsMojzZL1G9EBexXou339IRBrC3lJGmNDuSHX+w7WC4Cm6wWxm8DngLTImgC8pBcGBuTXf/1fXnyTugnFwxTQOgi0CECyIFlsvvJfEnh0mhsYI/s5uxFYi1xZof7oOqSAawwYjRGBzYGXbtWXaCIrlvHUagX6SP/ruMVYCEbEqECXAMjfree2HgA0ESur1/0vtnNwGSsG0RsZME20/+/XWH6Mugk/yngPAGy5GDYALjiIHIgRUIrsZjM7Ax+BSx1S4pfffQVIep8dL7dMDsTGjJB+CvQxTHmdtrw4l0CovFruC2NOe975egDQsCXRK/eK634JhBK90q2C7I1i+Gt0jxF40k1cPJAB7UP2m3MGJAAFQrGei9iUTH9yBUDTHfU3B5+BOIKQ43BWtNtPcWIOzEZE8FoK9K0DCGNxLi3FqaKA9gTgeoFwPQAoI0OulWT11oEwiFz7cwbErzNxWtEYBB+VY76Vh4DWrH8IOoGQ7Ocg1CqMRLPltmxvs1/SHaP4dcAJePYyyUCRIzrTB8tE8FoL9DUMwl61kQQ87Rmy2PS2rgB0a1ci18RudEJH57OsY02y/+83/sZdBKr4FXQTApBvprGgQCg9UEAM+h9F6ugJDkC3gJPBEvRGrYoYCBX9IxEcS5K4i6cZAHIw8oXQ4mLBb35YH5d7OekadtTV1UZSjaEIPH4nQzYNwgjAHNwDuWGYpZc7lzPfX1cQur5oBorfzDf+zi0yVTuSkuxBI2Q+PhQDIUEnMLo1TBCZLufGw/ixbQa0KB8CTODjPohdY78IQmfDjmW7Yo/doAX6GqIiAtDHaYswSmeMubV81kp11L6hy2PdAcgblfslOKC1IiKRmyRxZgV/8++DS8BFrxXi5Hd/U6MeSKdqEsEKhpBRsgRMbAtuG4KU/+9ry5brzP/lPVMv1EPOQegharrVcgZUhVHFxNPcp9VFtlOWkL437C0WABWypFRGsV0sb5Hn2zYBwvUGoKl10v1knDgo0y7XA8Pfv0UACnjaK33Co9gJQAOe64FkNvtZAHQdjz9v2Nz2GSa3jYej2W3KGuZ9ixGdIVSoKT13B2s5AHkGheST6qn0erHv5AIgAAU+LVfw/wq3CEAV7clBKDDGZG9/5oVXx/oyYARczcqH5GyH8eFplTawFvAtrtXLGpNrQDGbejupB3omlIHQGc/ErzOcGSRs8zrhAbbuL1Tco/JfbLlNwHOmi2kIcs3owbdwNpYtynDQhsFcgvuG9/YapGFvYX22zZcAU0/GwA2LJ/4AmGF9mwEbBu98Y3cMF+uAGQCj2HVp3BbPuo3IlqxAy5wHAq4OfARmEBXGfNIBa0BIsG0ecwC67merHgRpZLwocrWaovuTxew/V0txJQ2DWeae3WAGbdhb2DB4+wRw7w5g8Qpv88liyGtoWHzMi4C9fAEHbBi8kwUKu2xNAdBxaGBLbJdZux1LwAGECYAEm6wyfpelJrEgFnRDxESwgyUxIUsVMwjVy5AYO0bG89Auu1/5BF38KqjBHlUAYXsteNCGwTeWNuwtk4JMkrlzGNizA1hm69g1Nix+zDOBW0aBeRZZGqBh8M4emfWNADDT+zqMjQyESdQFHfDbZECCLRgdHeCTe8CBaKJY1rDnBRCIAuGW4TYAZeFG8ZuMkGiQ1IEwGCJtHZBmy1obBsvVMnDD3jIAerti3LEBOMjGcOpa3WfD4ic9t6oveDtLfw7QMHjnH6wPAybW6yaG4+8D4HIQfvtDIVtLejpBFsVvUI7NIBHw3DUjRzL3rDVtsYPOkAScuX3coNDynT2VYJCkn+PjqvUD8hVbS8NgjphGxcANe8sAGNoVY/824BCBtIaGxRe8pLKZdpMkTvXiJ2toGHzSNHDPScAyq3er4qPyGaNc7JCRXWLT2TjwGmCOeQashq6+qSpZmp8vojQpheF58ncdZVjLnjWPHr4VWKTKxrHGUqq97qXu3jp0wPy+eEC/DYNZsZAO6IEb9pY9lNCuGPcNV830ZmkM9dmw+OKfbdcXvJMPdY0Ng0/7GnDXKcDMccBS7MwdKz8KCAKQIgY0MWGCtr4TOHAasMwOkTqf6unyuLykfd254nkb7qsw/iVg7jhgmSX31Vpd9yRHeLx+zRhjEGRbB6wDYT8NdymyubzDzCCGfpMJWfSRYfr9HP/aMgBm7YoxNQHMbQHm+ID6aFh8yS93tAvGQb7da2gYfPoXgbtPAqaPA+a3AEubgGU1RM6B060fgkRoCzj+TcD+04CFE4BldZdRc4/YxlxgjJMewSiwN1zWfsOngdljq3EmY08vm5i/7j5yIMqpvupKyGoNg9lngYosl9wY/0dZdrMzYl8Ne8sAWNOu2MA3zw/F2CoNiy99XbvftrcLriz6PhsGn3U9cM9xMODObQYWCMANwPJ49UliuW6SaqqBn/gGYP8pwPyJwNIxwDK76ahDeN6uXYCuYyABkEza4LbpY5WEWdSLxjF26/dQB0SJ6r4ByAN6NQxmkWcqrnQ00x1DEDJFjR8CcNWGvWVPp6ZdMQ6OVOCb3wAscPJ6NCy+7PerkP5Q3tBY1PrT9tEw+JwbgPu2AlNbgVkCcCOwtAFYcgAuiwWlM/XqDjMEbP9t4MB2YO54YJFMo/5gHIcALV1TRZ17FXOhPtvgtvkqf9H4kvHDlyKK4l6VzvVSBF22uwjOb7pbw+CfcwBSkyeFEHAUx/yw9JTyEbo27C17Ol3aFWNuAlgIn9QxO2tYfNlbK6MvaxeMRYquvL9rTcPgJ30TuH8LcHAzMOugX3QALo21WXBZLEHwRF1OgHS2eOgbgIPHA7PHAezNu7QFWFZ7JnXJ5rnqxHEulvlzwyVNN3+wern5Yovl7SXLGwvn4riLWO4fgMRJXcPd/+pmOymELEhRzBxJAo9gVL4kwVnbsLccgHEpWi3epocCAMeBRU5eTcPiy/6qtl0wpvhA+2gYfO7NwOQm4OBGYGaDs+5ExYDGgqP+ccAkINaVpB8GTv4d4OBxwNw2YGFrxYCmV0YxLNYheCXau7EhV3ga3Lb8g4+R45uoGLADgHWqhsBXA8K1AZADyRvuvtkBSArh+i9DsQhCOtf0UUgW/7aiYW/Z0+nRrhizoxXwFhyAi5y4rGHxU66qAFhT3rDSIVdpGHzencDejcDBDcDsBDBP1uX1CMJRwFiQIBzxieL3KIY1YW5MPOxNwLRb8gs0aghAss1GZ1O+SFHsdRPt0i/PLHu++dFb/x4mXfhcbWxhfCtYMFr/uWvKxfDaAcg7ipPCvFOVpuo3HrCjYW/ZA+rRrti6TS6MVQ+L4NPH2nx698GnXF0BsKa8Iab4dFZpGHz+JLBvApieqAA4J8CPOQuOBBAOV0CUYbIskRkAecrvAdNbXc/aDCxSpyT4CEIyTgRgneiLIp3nP6fs+a4A4N8B8/48CUC+ZGJA29fpuLmxJW+5h5kNFg2jiWHSi0r0Uv4pCoZsxw8DUfnhd4Vk0XGdGvaWPaBV2hVjdjgA0BlpkQ/K9bmn/HOVqtClvKEBqlfD4AtmgP3jDsBxB6DA7tdbcvYzJvQJkii2n4NOeMpbgJktbYPGACiF3wFoEx1ZMNe/4jnPLXu+KwD4t/5SO/iMBcXuesHylyACMBPDgzGg7opM8mEHIGdwrfGA1rC37AH10a64Yr4APvvOSdwEPOVbKxu+K2pdKRTmdI3dqkPPVgbSTBGAY8AsATjWniBdx0QxJylOFCcr6HBiw1P/CDgU3EgEIMW52M8YkLolQRddIN1AyKWiBretf9MJQN6HsaCPxe4rvgDdHOcOxDIAcmDFDXvLnk4f7Yqt63gEIB/Yoj+4p9xaAbBHeUPM8qF2aRh84QQwNQYcGgdmx4C50WqCFngNsgSvQ+Dxu4MuiawhwIAXVk1O+e/A7CZgThY1dcno1nHL2oDIyZULpBsAFTBZ9pjT0QQgn2V6ufRicS8QRgbs5ZYpEsENDejBfpoLrwAOjgIzZMBRZ0AHoUC+SOA56xJwNlEyTFw5FxBPeWvlzpnbANCdQ1eSGTRybMuydgMggVBsKmtYoC6Mt8znZxsZMLzAxoAOvsh+ydDqtXx4FIDl8L/omQ7A0QqA82S/ERdTI22mNfaTuBIIxR4BhKe+y61punQC+MytI/Zz/c9EuvyBeetLAfGZ5WOMZ9j2/gqABB1fMLsHAVBqhfTcyH5d9MByEdzs+B50Z7voGZX+NzNSsd8cwUcG5ASRKYbdHRNYwhhDIHRgGmO0gFP+HJh15jOXjnyKblVT5Cbfoq+yJOszF8P8+VnNPlICkMAzds/YLxlYznrJwIpO6egTPMqA5ZNDAB6iCCYAyYBcBqTRQ0e4630SxZyQJQIvMJ8mSeLrYe+p/GzGfnTpEIBy6US/out+K1wg+brs88rHmDOgAVCMnrEfxxMte1Mt6j7u9zzKgIXzczEBOJIB0BnCJoqgIfDEhM58SWzJEPGJe9hfVH42un/Mfxl9bgSiBySIBWnAJBDGEDAB8QWFA8wO3/a+wH4+rg4RLPYLul8tCI8CsJmJMQAOuwFC9qMI9g9Z0CxhZz65K0wfFBPqu7PEyVdWAOTHVlTcpxhXHZLz1w0ZA6EDLhkCskRf0sw4dRYC0PQ/vVSRAYPo7QCdj7GqVOSMeBSAzUzMxZcDMwLgcKX/zbv45SQlHXDIgagJc+bjZBqAWhUoH/Y+B2D0J7rFa6LYDRmzomsAaOeKqxEvbWacHQB08JkRIteSXiSBLYJOLB+X4xrzAzY7vgfd2S4RAKkDDgPzNEAIxMASSWF38WsgkuXLyXTRSRCe/DduSZMBMwe6ObTd8JBj24Aot07uDObPP9XsIzUGFPs5+JJ/M6oT4buxHv9X7BeY8KgOWDg/Z58GTC9Xq5FxTXOw9c3Cm6k5fPcjgbHbgAlvVG2tH1T3Oavoq6BlniZ+12n5u/2sDbOvasqoFg8x2Lnbcd1GdhSAhXN+7qMrAC4sA8sORJ6yHwD28z+Ft4fdv8UyqUDrDmCEBcpZ39kLS6aq9l4D2rLb/KYsFTPWdfbvh86vQu2s1K/K+zIjTsXIVQ9a59Egs4Y6sZfIA/EcSp/jEXv8BWcAhxaA+SVgSQAkGAMICcwVlNLlqTc9Gbv/HAA7MrL4+f1VlXwrUq7SvCoyGcrrWpGhuur2fNGYwM8YT67hT3s1LaZvqn5MLM0bzmHMmIFSgdFNj/mIBct63NhFZwEzDsBFgpDPeanNgATfCtGsX9TIKwNrg9tuVkhlng7TI/YArX1VkXKrEe1l2SynN1RCsFJsqnQv3UIMxhwIRjU5AGN9QUteVz3BUAvahuNgjC3HxLAND7nBp/cgONXF5wCz8xUDGgCjKPbvevlzcKUHH2ag6cnYzepYBB9Zi2FxDJdjoXJv1WDFiLJ6MKqKZUzoQFTfj2HmwTKcTpVWvcxHKm6kKgoORAEvVclPD6NdzLXpMT8IYNPcLV7yJGB2AVhYrAC4SNA5AxKM9ryDPE5fs6eeVKWGZ2M3S3MQfEyJUKV8L1ZpJXpVJ9pLilmlAxWkVJHKwIhjjD9TtVXVm1HdOy/pJiaMFRWM+bo0rWl4yM1N7oPhTJecC8wRgAttBjQWdBBGESwgSiV0Pb9DRgu0TY19N+M1mRKh8niqFx3rRDsLqjgl9yaGXT80vcL1wnE252PAZCzAHQCoiqoW3yYWFIt664fUpKaREr1NPakH6XkuOQ+YDwy4FMSwgU8GSRSz0UJx3Vx/5vFNbrs/EiLRY+v4ACITww6iJEodQKwBIyBRv9vwhKzUW6z66TUGEwhDS3ezqusAyNxnJn8xa1KRPSFts9YfFB/QDZcAm78CnDBT5U8rCqjfc3yh8Gn/hGd/MsKf1+QzYJ4891Jye13iy1cAE9cDJ+6FpYrEkidxDN3OtXR+FwBGMezoMmxJLOumAuD4J4rxJrfdH/XCoLGFVKiUbw+LAPQqWWaMMLrd6/+JycSIm85w9lOpt1j1MwAwFTiqAWEUxeYH5ENn/jInUVHeMXQ/f/jRePvCa4DhTwLHfBc4frGqqaNJzLPw6iZxV+HTplFGvZrXZT45N39+HW3TujlZv8D6fp8HRq8Dts9XIOR5YtakgBgdrrrt5Qsq8Ssd0BhQ4HMwmVitAWHAY/LbLDQNQDaTVJ8Q6W4qVB51OOqDZDPVB3TLOBepW5jmqaLbec3jGgBGMSxvvemDYkQ9GoKF1ShUCSKCqBeQrvmfVZPC1keBjXcCmw911tTJ8q5XgOLaQgA+x/OdWA2EGZ98gbjleTHdQHQN+2iwls3nK3/Zhj3VeQhovYzdxmArSwQgDRA3QiSCJUrTnjfl4KozRCSCCeYmt90EoJJbVCk/1+FiCwFZxLk4dRfLFia6x8LbYkD9v9cXtLG6+O4AYQRfrgPygVIcqyhTXcWFOJH8fh3rz7EKwnUArq8mcGwK2MCC1i7WY7Zenh56feHT/jE3yliE4TZncd636gPFCKWavGhcRx2J+cvs9MlSw0Ty3cCm+c7n0G0MExdW4BMIbTXE9UCynvyCCX+Ovm4gbByA/xisVgJPpXrzLj4EoRJjJIZrWHArS9iprK+KcefgiyB0XVKGjOmCmW9xhRVMUSyRFnNeFGEdI2q+/HFXclkp9WsAbgTG9wGj08CI64WxRk/OTDcUAvBHXSLQxcVCDMQSWbzv+1e7WVbz+k5w2tJtsbcCYV6WJY7hmAsDA7r1Sz3OgOgoM+KTOJbcjSI5yGIaNE1uuwlAAU/MF+tF5/0sIghVLdVdM2S0bSzHx2Mi+FTxXf8X925NC4BycK8QwfmgVX1LlcFiykEMcL2BndJJ7aQfijKfxLGDwAhByM7aC5U4qwPzNwufNnNuOH4VZaCPlPo2AahqFqoPVFc14ga2m+WEEL0cAz9kdPrOmMu8r1o/rTsXz7f9oswFs+jO6LAqkvC3Ggg5Fg6mwW03CUI6X12h8lyfcz3QHqr3DIl64DbqaQKc9mI87QXACD6vpJqY0EVxz2CEyCI5eMSGX2e7VtI5J4yTRyZhscrvt1nQuivOAaNLlYESwcySgiVbr37Bfd0/u31yEgg2FVaiPCeVOguqAfGov0iR0R9JABJ0bnwk9nMxw+fOh55EbgRhzozrBUA1polN9CLwok5HEEUQBjFMQB7D+j656PW+IrJ8O/bBCo4sGFdGejqiyYCx3mKe9/JtTiBvmI5OFiTisg9LtJFF7gZGDrUbHKs79+hyu5hSaUvh1foFr3r/6vZJCiXgCDwVVFJ7MVmRLsrGltuFCc68yFdACMDAflwR4QM3HPoKgIExt4gz42SuaQb8hBOE2oZmlu+KFlKR3QSssMJxDPWbbjpfLoJrxG8CYT8MKGZSVTCxYFTIb84nkCxCIPLDiby30gXFghaF4c2ReR466Uu2fvoFr3r/fKAEFxvpqMcd9yonIrkuK5LLV7MVCM+/uDJCyIC2J8a0z1iwqyESgMl15Sa33QKgmtPEBnp11mwuXgO70Ud4DHWzfgDYC3zBEOk7HlA6XKyHQzb8HgGoCSQLqsxorIy1Bxie7Wx0rFaf+wr9Xv32C+56/7HbJ5VHtRYT+GJrsehHcya57PyKAQk6+vBkBZPpjPEExlwU59awg3C24W6KBsC6tqHR+MidyVG3i3rdAnAsH2T093XT+zLr197MTA80h3SfsZP2UqpCrPQ46oF317VrpeiKXTJ9MhMLkgGdCacKG/mupV9w1/vnwyGgCDCKWzJe3lqsyzLWZWe6/kc/oKzgKH4jC7oolhdC4jiuzM0WPo+cPQ2AsX1obFCTO5Jzn566PwbReiwnfTWjI4KvDoh1juh+aT+WKSYD3i8Aql2rJk+VsVQly5kkddv2FvHT61icqO7Fr71/IkLNXOi0FQjV0046oBy6wZ922Q95ICqDEaL4XWw3COcf9Mw73DFB9AqE6wZAAS8XuzGQIDKf+oVkqxt00ttAc+YT0PJ9qRFSB8xoye5Xu1ZVeCSgCLbYLVNswoncHxoeLwCzBGjBNki/4BX3z9lXgUCyIIGmhova83cRgO5Te9yLgP3MfmsBS8xs8/U67ePQOqy9umBUruDchqo8sHSd3PMfT5ifo+ack8eFHI6QEcnT5GvdOnVdXof+ptJ+BVPWceiaRHA8Us/nkACo8mzqlqmWrbFDppT5A5UIZm7CPA2Vgm3QfsEd909kKIqB1qJAKCBG8ZstZz3xHOAAiwmpDIdng1maZQAkZzsHZ537YfQrwNyxoQ+HakrnS0h1mUA1C96TdJTmORyhC3oeqdwROi+GDhkFI6bYNrcNDEDeAkXwQizPRpmnIs3OdqZPSaRFUcbchHlgie6agq2kX7Dd/+d8lUJVXuUzk8ERmS+2vfd4uvN2VOV5rSwb0y3JhgIh9wJeN3YMQCIgR78Q+nDEVYBYZUrUpbXFnM7COSdf7N4IPvtDnT2BY/h8Chh10MXQeYGS+7GGjaQiABpuNIFiECnzdWJMIUHcazLptC7YivsF8/7FgLFMqpiQL5TuNbKfA/DC46rqqAbAwIKWK+timRUBEiNGsOQsyQm+Gpjd4n046hbT84KPuYjOmHHyp92gcgDS2OoIuVIeh/xyUkaVwyEWdLrewHE3uBUDcKIwnq40HpDXL+n3CzbaKdguel5VnFJl2awaghLQBTzteZ0cjLq2A2n0M6EPh2pC57Wg41poLzZsAZNso0Hw6eVR/J8bF9YjWGmVCpGKwQLBRCcrbiSxNLgVAxCF8XSl8YDHHFPW7xeFBRwv/rGqOKUBkODzqgdWPYAM53vTASMQu4Bx9J+69OHIF+N71F1O1gUB+AsBfFqKC+4Wi4BWX+CYgOTAU36wdMVNVKka3MoBWBhPxyiuko3xkSX9fvGMkqsDlzzHC1N6SQ4DoINOe7KelWWTheziObeKCdARApD1AdVnRH048gKUAmAEYi6Oh4DJV4VoGDWqjq4XLbO5o1jBoimEPhPJmwu9FvnTLgdgYTwd2wyXbMyRKen3i2eXXB245FlVYUpVxUpGiLtmGBlrTEhVUwV8dEkVKAq3MHJ1uzRbRx+OOgDWFX6MsXJU/36lJoEoA2AKvw8+uwTEDIBbStdOs8ddDsDCeDom7ZdszBIs6fcL9ror2C75US9IxJJsEsHdGFBil4yYuUwknofJgF4XcEUfjrz+X7fKo4EJJ//PkMORO6FrVjQMeL5kJhZMMXzLwNZCt1nzDFgYT8cQwpLt4hDON0i/X7ys5OrAJVe0S/ISgFY7j9ZvnQ7I3+lyqpYaL98CWp/N+nDkZdhi6bW8An1kP3fRTLKVWlwF6RZCH2L4zDDR0k1IqeTNb2OQSYNbOQMWxtMxeqtkY6I+ny9VEz6btfb7xc+XXB249AoXv85+tIBVgJJ6n4lf6oV+mfjdDJNMH0wAVFX90GMk1f5TxlS3Fggh92DyN0IORy5665KIfCktsl+K3VsGtpVOWOMiuDCerlSnjQ2rB+n3C+pIBdulz8wqonrNPLKgwKaC5B3s53qhXVq6oDNg6sOhqvqhEr3V2VNLBjmnSSNdrOLJ1zkAu6VPRjFcFz4fXDJ8i45hG94Gt3IGjOFYA8TTlQZ/qGH1oP1+8ZtlT1MAtHK8mQg25zOZUSCLIliWcbw8wfW5Ln04ssqnHX04euiCk6/3de66MPpuAQVZAEFkw2MKFw6a1wEL4+lSBvmAOMhD8vkOkFX77feLNw14YT/ssmc4A6oOdHBEkwXlgjH2k4Nal6wB4fIuX9LzZjAmorNeHMo5Tc0OewHwDTUh9HXxfGJsYkAbAAAgAElEQVS/uvCpoAcew6zBBrdyBlQwwoDxdLZWXLDFkHyF8xGE/fb7xR8XXByAAVC1oB18HQYIT+8uGfP75SCUs1o64he8v4j6cIQ+IqkPhxrBCHjdjBH6AblQkAeY1ondukSiELmsUPpjbyp7XuvDgAXxdNZVvWCLIfmKg6Bbhrjup98v3lVwcQLw8gqA5v9zC9jErutltg8gMxDWWMBaMVkmANWFyEV6R0uH2I1IzW7ypbkQOTP5f2ch9KsFkwp0kQlDAOmxzHpscGuGAQvi6VD4RgmAg/b7xZVlT5MATNXwqQc6KGwf2U2uGV2uzg3D4ua7fDnPwZcKgIdq9GaIBPZb0YdD7hgyIFWMXiH0eQ5vXS5HcMkc++9lz2t9GLAgns7KxxZsCkgdtN8vWD+vYDMAUpcja7lOR9eLVcIP4tcuob/3AOHCdW02VTX62ApB4Mv1v24gnPy9HiH03fJ366KYHYTHsgBBg1s5AxbG0+HLZaOp65i+ln6/YM5EwdYBwGj1cmUkE7+8THLNdAHhwrUOXtcrO/pwhF4cct2oN68BMDCfmsJM/n6PEPoYPp8bH3kCkbtjji2tJJA962YAWBBPZ0WBCrbYsFoOf9pDAiENk179fkuvf9nTXewKcBSjsn7ldonWbgQpx+26otaLIwAlfi2QQSJY3Yjy5i9dmsFM/oEDMM/Z7Uf0RiYUA7J+ToNbOQC3e0WBBm9qLad6HICG1ZK1XB5PoxnuOOIcxSXe/Of8xHV/P+FpwN47gKUpYHmuSve0pKZgCKSq5wqniWE1WZz/xouBm74KTMwBI17lVBXwtWSs+8/vL45Ff3vhpcAnvwos8d48DZX3M2hx9XIAnu0IIO0chu35AOgLL0yuG/jOmwbg028G/mNz1YWdETbm4I5BrFlov+EtD2wIo7l+Atg8D2xY7iw3V5diEqO54mnj6XdMAYcU+6gon7A3NSO2qFjlyZYDkAX6uD5Iam44YaUfVNDNxaJcLIPXcGGpfi6PnZdVD1wPspQBX/wl4OaNwN6Jqg+xwrxslcVFuYJblehkcYYZGPS3L20BxueBcS8nwg5H5kZkx6TQSbXFZcCQKadx5Cz5mPurAFxrRaa17pAR2PFC+ElSHKQ/0QjQcgCyGyM9v3SnsDBRJgL6msWCf6IfWeUJac8UFlpY8500DcCfvgb43hiwZwyYVhd2D/VSrKGAmIDnBkiafEcN9cprHgKMzgNjS1V7rRjRlceyrqif6KAkMgXIM+6tAnDl+zSL36O9+U8p9jGHQo285/2XA/AnXeNnKAorDXH/AILwbSvLEz6Ql2+cAf/3XcCdw8DkKHBwpOpFbE2wadzIdyh3jjNQirYWEwYq+/zJwMh8pf+xKNSwM6DZMmzNRRbM2K+2Ii6TlFrAWfd5V3i/F7IgT2LBF5LbIdkqxLPWvtzlAGQ3RpU3Y7AiixMxLOUB2t7pKQ8M0qCTnp8HkojJgNqaMEJesQv4AR3Iw8DB4QqAs+6SWRiqgJgY0HVDAdBA4Ba4xN7ndlSFAAjAYX4IPO5dBDMAdS2i+Jx7XTf1eEdTDfgAQnR34p/wQkRmjNAoByDT/ugFphXAmjAEn8qaPQAgZCs0lSckCNmVigEbFMsPBBE3DcBX7gLuawH7hoAD7EM8DMw48AhATrjtQwiXoqkTEwWd7LOneXNCbz6Tiq/TInb2M8ZzIFrTQbGiy92oGz7pXl/7jvdAJnb2470IbB3T77Sai+hyAP5voTqW6sKwFAc/TAdc5+3dvcsTrvPVYSK4SQb8xV3+6IaAqSHg0FDVh3iOIFTIFxtit9orL5Z/LD1Q4s+B8OnHVuXwhhdd5DoLGsgCCJ04q66X/Ju/vSaeAxDPvbdtmdtKDV90gVEPIl/xySkviOhmAEjrlzSkwj40SlQZYZ39I+8JBMx8mZryhOsKwqYB+KpdVSDFvhYwPVR9BD7uyX4SwRS59nNI+bRck/DzJ05v12M0nY8fAk8iWL5BB5qASPGRCi8EVjzv3mqpkC9ACrrwhKukB67GhpqRRowQMqCiYbj8oOoHeUWpdYIBAUj8c8WjrjyhNIJ1unzjDPjqXdUjJAAP8TMEzLYq9uOHICQALe/EwWe+QgddAqCzzD8+vgIgg0qp+5nYjaDzCgjmnCYone0klqP4JSgvvK+6LoFPoFMlkPGh+0rPWta4RHTNJJQz4M8EAGoNTPVU8opS64CC9zoAWTFChcq7lCdch6s3L4J/2QFIEBKA1P9mHIBmhPh3Ai354RyAAmWsR/PRs6vOR8Z8FMPS97yxtIlYgVB/I7jC0rIKSfLXF1EEB+BFFjQ3jCLA49OWsRTTEPzvzQEwry7VrZ5KwzAQAPssT9jw1dcHgCrORQCS/bgn+1HsCYQSveaHkzvGv1scgU/6R55Y1YIxhvOm1EZekQWl8wVDxJgwc88QiJc6AKX/meHDawX9z16M/Em7bO8Q08GBP/jEkAEVjMBoAFWXUjRA3KtNwOBXW3EkAZhrALktpC6lKtTV4OU7RHB+3kHWgv/zrnYZl2kCkF4uF8MGQGc+MqEYUCA0n1tkwxbw4ScHAHr71Q7W4++c8czwcBAmHVB/c7Bcek9b3FuwbdD/kjGWgzJjQ3thGmVA3jhfOyU+RxB6FamOFp8NrhsTgLy8Cpzm5QlVptAU+6CiNgXCaIQ0BcDYV8b0P4pi30vfIxD5+w72C9aliegW8MHzqrmh/meuFhYi0pKbs6D9fsh/n1XFMrYMbPgUByCZz6J+uEknDA9AornWFRb01WZEsACoHhOqyC7wdetT0QAK2KqOb5MCUvPyhLE0oQxzqaYNXL5xBvyVXe12vByLADjXAvgxBvSPGFGMIjCmJbEW8HfntxtQmxT0cmxp9UPAdKAZ1upA6EB7qgDo6oCUxXRtPVSpAwJpnUhuxAqWCCYK1MBExZljY5S8SYr+pxAFAuBayhNG26jw8usCQLX0SAAkwwcAEngyQizaXoziIli+Oe7/9kJvNk1LmBMe9ECO3XRB7aPeF0EYHNVPdT8gj016YBcWtBfBVYJuz7mF7VgGY/pO8f5WdQ1/7U67nIKNS7j0wIbDPFZsyNHHY7od/xdlEHj8CcC3TgCWHgGAPSxiSdt4312u/8SPAl8/Dlh4pDeZW2PD4J1c9+uyDaIDkgEJQKnTfG/N8nUAmu5HUnMW5ARbPfEuIHy/ACjRK7FL5pOR4RaxgTHofKl8r/S1ZWBnAGDKefbn3AFIPRPXB7sFiVQimKVgGdl5ooNwLQ1/1U+DQGSXQ9r5Evy1q9rZbP1lGQDZsPpzI8APHgXgod7qUx11YtBbFzC+/C+BL7SAWwhgdoLkONSLqy5oLogYft3ZI1F7EAC+phsAnekokhP4HIzml/PvthQWmPB9LJ7jxkcSr14jWj4/0wFlgJD5eoDw6fe4DzAYPHokWhHJZ3TFSkn4h7YOSOBwEtiMTv1aY0uktFYTmI2/43EMQmCuAJmUE0gmVD8EFdPpdnxhVhqzDr8F4NMtYM9Jfg98EVTeNu9Q2OFZBX7vr9vtgm/lcezczZ61ZNN8DCvilYCdPXqNDQpAlfGTKm0M6AA0PTAyoMSx64cRfPQHXsniOTI+fEWDFGp+Qb9BeySRBV2kpl0QxxGAlHDmkI56X6z+EP7UDYSdRgh/IouwIZ36lHabBE0GJ0r10Rgb/xA/tt/j/6aMAf+7R4CxzuBXWRGULwBfIrY6UNfpvLae7n0I+LO/reoLMqiVMbW38oUhkNkQIzZO7tIweGePcmWlAFTjAYHPVGwXxWoLYblEDkLuTT8MDPhXLJ4jALpaJB+ggU6xfgJknT7IKXIQXh4Y0FZCog+wxiUTwSkXUbSMV1rB/A31OXWuFpPUda/mRHKi1e6U+hA7Zq7l+A+UAfDtHg/LrptkQpZ727cRWOL9542Pa3rOvuOqagUltgtmJM08j4/PILbIDKz6w5PAHsbraTnMGdZWIwIzxIfeK0rn578J3LAVuH8CODRahV/FFQ/1IumIvXP1QudNfyNT8oVqcHviPcBd48A0g2RDuoDqHdb2SalZAdG9dnfDkAE0gXnH5ijWCDbKCq5/MRiV0QD8HgHQ63jG0hdsLGxA3x9Bw1Asli7hO3BwApgng/Gjvq01IHrXJ7q3Cz7E++YziF2rs1ZLZ+8H9jJsSoECWXj6igmR87aLgfbGq4GvbgLu2gjsHwdmCEIPSI1h+SkCRjpfUC3iNWcpoRrcnrYbuGsUOMBo7QBCxSTG/igxVcBIVGPWM1h1JYQPnyKNExGZMDIJ9b66eEBGxPDY1Y5nv+GCjfGAxD+DDpiawphABWZPjwNzNLAEIH4XCH0M7/5c93bBfI8Yk2cgVAdvdT10ifDkBWC/r9lGH51NhIsnsWHOfPmEUKT94WeAG8eAO8aAfWPAwVEHISNQlKQUglJjJExqC+H6Nq93kOpUg9szbwLuHa66QzFWkaFieXxi6hgVHOMCYGRuJ+5V4jYJIDKI9KlsAvFDq8QDrnb8NWVPh9EwdFkQ79TlSMIsN0Mi5s9MoOGno4U6f3YAvefL7Y7rvdoFLxOANSA8f7xSgWmd0kCQbmZ6mTLEnJ0UqWLhUkxlrBn6n3wWuGkYuGukCsufGq2iojnRFpafsU7MDxErJuZhYCsJosHtWTcBe1oeq+hxigJgXBrMmTBPnJKLrr+VED54ibHYvZos8sO+DNcrHrDX8YVVyglAKud0LtMjFPtNMz6QLDY7VomLJd671AEH4Xu+3g7nWq28ISvX58/hguOBg8vtFQvV/hEzxfqOevuTfpjri8vAWz8L3NYCfjBc6ZYHmBcitnFd06pxyb8W4gPlgonBqffTtdTg9pybqiVNBssyUsdUD7eGO9amnf3sXtxQipl7Wg/sD4A8AwHIyZMYky50Tp/xgN2OL8y051qw2hXzwRCEdT2nmck1RxHG+w5jeO9NFQBpR6ldMIMXlFWgVndqF2dVFsJzuOgRwMElB6DcI6rznemD0RnbwQiSRS3g7Z+tVIl7PC9kahiYZm6IizuLigliT/VoUog+p8P9l3wJ7qGEanB77k3VczroUToWLCsABud4ypaLCUoxf9i/9w9ADiICULrQRWuIB6w7nuZrwaZwLBGwClSqSyz3AhHbaRGEFGOmC44D72UVgjW2C2Z4lIF4ArjodODQcqUGqAxfcpG4mJVuVqcL5tbs2z/veV0tYK/nhTAqesYNHdO5PCJZos+WuzxHJIViuXFyJxupNLg976ZK2lizUKodilGUgzyGhokF8yw5Mf+qRkjdjfuDtwkkm7DTkNaBaQ2ox1q3eMD8+B6O3H6em8Kx1Ccx9ptWl9iYIUAAWrI3I3nHgPdOtsO5eOuxXXBdj0V1vOL/so3Cxef60tlSpYwveKf0pAu6ohfdJ8k4CUqgvr5jV6VGTBKALeCAh+VbZLTnh5gu6D44A6H8cVlkNK95O1WkBrfn31R5HSy+JCwPplAxRegE/2T+AloGncNmbQyogUQx/KwB4gHj8YWNTwRAOW0FIIIndoqNkTAxz/bd09XDGLBdMM6/pLKi5whAX60gCK2ujxzEAqGL2pQ1Jis5AJEAFHvTujYAKjRf+SEugm1d2COQLU/DAwQ44caEw8AtZzSIPgAvuKkdrWMM6M7xCMBoiBn4YpCE2NCfxWAA5MEuwvCCEICwlnhAHV+YORfDsWJGgPpMKwg1b9QpFnzHbD2BK2JGul9s8KkYW17vLALQRTCBpzXZpS4gtCXXMAkduuAy8E7PijPWprXJ5CR38ygw1fJDohh2BlRAgq2OeN7uTWc1D0AFNtmL54ESBsCaJcLkDajxj5ZXRiCIGA0waDwgjy8sk5+HY+X9ppUbJSCp6TnFCMXwny1WAFQ8rUAc2wUrRL6mXTAefWnFfnz3FpbagQKLAqAzoZjAKkkpXkNO5GCEvOMLFXOnnC4xIKOjnQGNdWSM+GqHQGd7JSsxUf+JzQLwhTdV4je1nQvr1MkPGtlf9yP2Dy+gAqZ6rQytfvdHSDxgLwBF8AmAYjHWluEDiKGMiqOVvtejXTBOuRSYJwDJAARgZAGWL9Nk+IM3SzgTydE4eec1nZHbtDaNAf1Dpd/SMx2END6kD0oXtFhBXmcY+OY6AFChnKnzl7NfdMR3qCAae2B+VVMYXASvDs3/X/zHJZcB84vuiqABEo0QPnhnwqQLyRURmZBPytnwHde0M1vN2lR6picoKULaxHDIEdHkW2iWg4/7b5zb7DSQAVd0/griV2JYojfpwRGEYsGBrOBmx/OgP5sAKANkcbFzNWTRnX/GSGImMYH/LYlk+gGvdT+bW+SWH+Ig1GqL5QeTtR2EYj5LVHfjw/ZDwL8yJ6TB7UU3VVoTjTYxYDK+Ivv7dzNAZIxpZSiU8jjKgIWTcykZkBawDBBnQdMr5QeTKI5iWCB09AmEb7+ucnOQ/aTPWn6wuzyS4u+R0Ob6CUGqJpIDA97AdqINbgRgBJ69CG4Jp6q/ckjXqB/RKla4WpkO2ODgHoynigA0JiLwaNiEt95YQKJ4FRC+7brKzRH9jZbN6iJYuSHm9I5iOAOhHNJfZkh+gxsBKPbLu3+JgaWDdojhMO5kkDWSlNTg4B6MpyIAjf3IggJgMD4MCARjFMU9QCgAykhSKnUCYHB9JB0wy5aTRUxmup4h+Q1uAmDs+hpXgFLnB6ULONOn5xACNJqxghsc3IPxVBGAiQG9aLeilWUJW1FvVXEN0TKp1C6At19TMSCBpz1dHtT/JH7N9yaxp6QkF73KBxYIr10nAMproB44qQGTj6sjUrtOFPtLeFQHLES9AdDFrq1E6M13MaxVCTNAXNFThIylLcor40zxtgDAPKuVwDMrOKw+SBTbtR2MND7sZwC7Qvm4wqHa4T/uIrhb+7n0EgbQdTijoyg+agWXT8llDsAFWr/B8qP1K7bT0pvtVwHhW6+t2C/m8svvZlawi2CKe37nhFtapkDnILRqBQA+v04AjMyn79EIkXO/DnzyCBwVweX4wxs9B4rRZgyPVFqykgDd+5JSpBU5r0vHyHz+jsc3ub0KABsZMCyQgeExKyFPVIz3lmcM6OfPAGCADYPE67Jfs6h7G0o+xvi7oyK4cLZfOgpsXwC2Lq9MwuuVERonKn4nSJrcXnQKcM7dwMMXgYcsVxkSebJgzOWPqdB1ad2f3gpsnwK2LXWeR9m3danUIV1lBSCPArBwtp+7DThuBti6UDWDmWA/DvXk8LRptfPtNUlihYZTOPCi04GH3wFsnwGOW6iAs5n3GeJJ+KLoE+9VDClQ8R6vOQHYegDYwuY3S6H/iJ8jb11ck0q9Qhoc9QMWgPBZJwFbpoFN88DGRWBiqQIgWyJY3lPozaGJ1KTEPh36zpTkJrcXPRE44S7g+Cng2DlgyyKwaclfFoIwvCwx9Zn3Q1DmIPx/2/sSaMuusszvjfXq1ZRUElJkKsBEGQyYhJCBSkUqAW1tsBdpuxEVaBzowXZqe1g90G2LotjQdmMjKqtBxQERdAWUAkUlZNBGkQRNyIAEMAkxpFKpqjfUG3t9//m/c/+737njPq9uVeqcte66b7jnnn32/s6///3v//++Tz0dmD0KzC4DM6vAFpd/0L3Gh6yTDgnvLwKzAWDGiH/ThcC2OWDrErB1pRgQisIQhAa+AED+HEEY6uNLyrRnZLSl6tSbrgLOeBQ44yiw8ziwfaV4UGbdegmA5QMTLFlqsfn7XecDW+eAmePAltXiXnkuZSBkRcm4UGXtU2uo3xsAZgz6y54JzMwDWzkgBOAqMMVBCSAUObh8QuN/CiTgcWAuyWhL1amvvBbY+VgxbW477paa7gIBqCnUrbUBiQuhAKDUot13IbBlDtiyBEyvtO5VDxvvVfxW/JkWNFrCeK8NAGsY7BsvKQC4hQCkJNaKy2LRIsg6SJ3IQSe1onKKC2CsOYMeN+0Dtj0ObDsGbFsEZmWp5S74g2Ir2uA22BScAJGA+dJFwPQ8ML0ETAUAkgDTPq9zdK/+sMWpPF19NxYwA4g3PtsHxAE4SQC6FdSgmGWRRIJLZJll8EGKjHiX1jwaN10HzD4BbD0GzC4WrsKMW2pNobZoCu6CLCDfCTqzgg6sr+wFphaAKQfgZHKvpRSYg7HN5XCL2AbAZwPrZGaj6ippXhgn0kqmU1woxnHedg5AATuWHig2FE1uVRwoxoX+Wcbg89S3AqCKPONcCi8oPtVP+9++G3j+oSK2xRBFDElUxbTS+3nvc4FpDsjxllXQoJg8FgdCQoGJJTTicLcQ6vPL6wbg9cDM4cJv27oAzFA5ky9/UOSvmg8oP86n0dICBn25JwjARWDSAUgBHN6vfdbv10AbARh8X91vDM2ss+NvAECKPVLCsHoyUgRqrlbnRwB933OBc+4DXrIC0IEmiLnE75di8HsyAcjzWUVGUi6uICMpVwwJVMXdeOk3XAxc+Hng+vV2esAYw+sWoP31r3eLcLwQBeQUrEHh4Jo2h4vDmJPuAyMLGAeEn7uqbgB+I7DlSWBGCwe31Gb9aL20kGDb/EGRxY6WTz8f2wtM8l4pgL1SgM8esHCvsuylME4nn9cfQLtldg6TZ0kUKorAfij23vAPCmqp3fcCl60XFINid1PlZrf41/dnApB6wSQjutUfIDJR8CGIQOwWEH7DywpKrWc8CFzqRLHkVYrB2jS2FQH5vkuBycXCAlIUUAAkCM2iRBA6+ARCe7DjYmQduLYTleiQ/XTTS4DpI+6nLhZW2nzVCEBaMLd+soIGqjD1ampdugiYWCpeBKA9bBJC9ActAk8LES26SqsftInLZ44dQif4Igdhym5WLrPDyuYH/7HTCNwDnPko8LXrBccjQaioe6BiKad3+QY/MGTH6rS3OBvCnQDuAIyqhiDkQ9RX+29yE3on8IwjxQPI8zkTiApGU3oVkD/4fGDieAuAdMw5MFQjEgg1DYsUku+a3uI0TGBfV7PotwHwaOEmbHEATvuDIutni6UAQoFRIFRYhfe/dhEw7tbe9Of0Si1g8HkrwRcevDajz07gIJ7n05rYyWIpb4ya/7vv8PRdFpj/LXDmkQLAnA4jCCOlTBRN/rFMAJKgkkVHpGUjySSBSFeg7/azqk8EgbSEq8UDRACLKDXSyaQ7Br//DcA4LSCtwnKhTEkQcmAIQhtM+Uaajl0uS9NatITXWzpzfcdNB4DpY+6nBgDaCtanYLN6fCj4u1ay0QIqtML/EYC61wSA9tAJeP6eWsAoDysFpg1eB0HIQRCIIkVeCqQf/05P3WCB+UPA+CPAzvmCaFWDKEuYcl1yMN+Y2dckqGTeHPEvvWDSNhOAfbefX0A6rS8CUw8X9066bFIfdqMHJID++DJgLACQumyc3gyAEYRRKFCLD1eu5ODLF6QvXedx0w3A1BwwxdAJLTXjd8seQnGrZ9bPFxLyA7WIKON63tYtCQBN/sv9QPm6BkLp0vl9t/m6ietR6fbyBA4gnXtORwRRpNnTtPpW6gWLH83lKqcOFTEnDiKtoHwy8RNFhrefyeztbnrBfbWfgttsP+kIyO32ELD1cHHvInrlvWs6TsnB7qAUlg/suFtAWkE55zYQ0QpqcALoNCXTEt7A3KoaDwGQfqoAOEUBa7fUbKctltwCajVbxvSiyvoasM0BaBKwwdKb9fN7NfcqBWGiSWykWXER0umeacUEonQgCKRfIgDFjya5yq8Wfsfs8dYgiuMxgpAg/vnMzu6mF0z6Zj5APdvPQec0TEosnvQosGOhaLuIYvnwEYSithE52F1XFAA0p5yigD4otCqygFKnpHUpLYP0OcKURYv6Mj4MNR433QhM0gL6QongawOg+6rl9CswKoSkEIxPyTsuAPigCYBmAXVfYcVf+n0SRYw6dP1YwNgHsgSajiJP429RrpWOM6cxDiJB6NINM4w7LbUGMQUwB/M9mZ3dSy+YVG0EoBiDBST5ddZ+PkCsAiIlQZDa3LVatJ0WXG2PbL98AB+4omB3oP/HgTUhmGgBfRqWf2TTrUSjExDSP/qWzQDgfAFAWyzR8rkFtDAKX75jo6nUguZxZ8NByHbvvqBQ36T1swcsBaBAGGRg40Ir+rt9WUDhQ5ZAU7Es2e9LLzglqHRxNkbeuW+oQRRls5jaMjnK0a9ecNf2R4LAwO829kQB3LTtEYQPUwzQAWgW0AGo8AQH0ljp/V17pm0KRcEifGuNOnocO1rACQbKPXhs8TtNwVr5uh+n6Zf3wDgu29g2FdMtOc8B6PdpFj08ZFrplw+ZA5FTvAQQ0/BT36FPDkRqBT9Jag7xYlQItY0f88j78sZzCcKPZlrAQfSCK9uvB4h577SCotUiEJ8opq8IQFl/PUBPEoBLxbRE62LSqG4dFB8r5bHcOtiOQSqT5T7RKzYDgJx+BUCCTxZQCwhaQc9oKcEnEBKknj5FsJ1LAPo9xoWWPWDy+6IIoqbeaO0VA+zHB0zxIQDKkn1GgtXiRxMIAx0Vn0Db+lkuFjLRCt5WEwD71Qvu2H5OfekD5FaciQay/GIbFgBXriwAyGmJADR1ck3DwTE3TQ4B0LetzBJErTYAr2BBSI3HTS8tLKBZPo/fWQDZp197Z3scjGb5BDp/L3+njMweB6B83Gj9wj3atOsPWin9WgXCFlVO/3ctf4iD8XkBkH5USlAZlNPZAQqARr5vxu1yjmH0givbX0UQKI63o0Wun/xHuR8E4VnPK5JQLd4VNttTBvK2uoiKOUf/f+GjwMNBh0NMV6J0c0NpcRv7mrYv3kh8/uHxYp+bVpwLp3R7sts2YzouSq3KGa+q7+x7Co4nazAerRKsVlV1QitF59dyyFZaYY0HMu9mWL3gtvZXMbymBIFMZ1ov2h0B+LTLisxgW+Eq5uU92iZ72ud9vvR+4JFp4NjkRh2ONi0OB1/UBCkvEYRhfuNs4OmhhiPKnFQlx6aAjMnSXJUAACAASURBVPjmz1w41nnwO4cCIBvBwZgTAOUHRq3gyDExD4zRGVYEnpm5LqmQc0M5esFt7acFl0SlHiBxuTkYxxdaihUC4QVXFu5FCUD5QtJl85sjGA0ziQxqeu/fem+hw0F2fLLQGxFlYMRvo7v1WmIVtpt1DFkXvOR7LwJ2HSkyoZmEypoVVe8p7b6qEMnidGG/Vl/L2aPOIwuA1pAIQE3DAmFa4j9f7CPaFpCHKujr5xzZesGdHqAqKz5X+FLRAl58le+jui+kTBALMcgZ73CDBkpN2/7+bfcWOhwUyCEAjQTcAVhKdjkPc2RajewKyu/n1//qJcA2uhBMRGXQOcn9U6JIOjXHQqSYOsVoQp1HNgAvz8yny80H5PVz9H6RqVd849WtXQ/zA0Ow2ayGLJ474L0G79vvbulwkJi8BGCg4S01SKqofoNvSIC+5zkhFUupV8rUTpJN06KpaBkFQm5M1HlkA3AyM5/u9Zl38zrk6f0iU6/4hmscgK5ISUtCTowyDqb7UxwsqFJW3fo/vbuIBJEZ1YRgyHwQKNi0KEl1OKTCZJdxtPDn//v8ooaDaVgqFyiTD2IKfcjZS4Fo+7g+HXOPv84jG4DIzKfLzQf8KVfI/FNKrQ6h94tfz+vOA9cGAAbrpylY2SDlVTTt+uCnV3/V3a7DQQAysJAwobZJgUXi78Qayhd812WeiOAZzEyUiAkHMeu5BF5FwZQAWLPwknkLQy9CrPMy8+lIHZFzvN3T+YbV+8X7c64OHHix74V6zIxB+RJ0wQ+UU992tYoFy3fcXcTDxQkoPsCUhFIczKVCegSg5B8A/PILN9ZwxBSxtiKiUAOi7JW0dLTustF8AGbm0/1o3vjjnSGdj+lYlGwdRO8XN+c1wABIoHk6k61yuSCJITq3jDY9Vx0BqK++uwAfX6JkI/hME0SC1EGguiQ+isqcQRLrF6/0jO2w+6FMnZhyZYsQ1W50qOHgPX1NXndtODsfgMwHzMin+0+ZN0S9YOllMzWfLwKQSS396P3iY3kNOLDPM1y065H4gOW3p4uTDkB8zWdb7FgbdDhEgJkCUDRvogTmd/vPv3BVAUBuvylNzAAYi4hisVQnEHoIqWblrxqm4Mx8ujfljT+YjsWBYgIOc0oJPsq1slCpH71fKybJOEoAuuVTRSCnYlmU6P/Z4iSJEcbLv+Yu9/1EAh7JKEXDKxq4ChUiKymRbwjgHdcUWTARgLYXHSr2LOU+BV7MVwzxwOfkOWybYAGZD5iRT0edjpxD6VhcOQ6j94tP51wdOHBdMeXa9OqWRcmWXA1XLUIUH6zyCwlAs3z+YBkfs1u+VIejJEF3ckrjI9T0y/aMA2+/tgAg08VURKT8vbKMUgAMIGzzAcOi5HknHQAz8+l+MW/829KxhtH7tTz+jIMAJPCYMULAWd6fvi+EY9ouoZBM/Kx/4LUBgFLgNC5o16FrE8JJVJgkiFhaQQBv3+dVbMrWVsC8UxFRkjjaVsW2DtRdOJ/vAyohVYK7A+bTvTdj8HlqTMcaRu/XxHkzjgNkIOWuDr8jnYYDKDutgpUhra0uAlAyCCUAK8BXcjBXgLCk/h0D/hcByDxFAdAzoFUqUBYRJTUcMWdPP7ONL6i5bLQeALJRQ+bT/W7G4AuAOXq/lsGdcRgAY+glLkYclJVTsa6ptCX3uQjAKINQstFrAZKIwWxQIhIJuovB/Nx+r2LzFCwlj8Y0evl/MYk0kieVtcvrwGUnHQCVjjVkPl3mItQsIPuElx9G79dOzDgMgGkAWlNyBJn8xKprBRC+zgEo4LWRgcdVcOCjjlNvmx84DrzNAahaFZWLygKWxUNibIhTcPD9BMLLa65bzreAMSGVoXvJ/Cgh1WUfO+XTZS5CDYDs9GH1fnOrIDcAkABTTDCCLYK0Cwi/586WcKJUiEpC8CCBYDsiiSplqUIUmOjf+o2tIiKVUJbgU5uSWl4DWwX4+PcXnrQATBNS+8yny1yEopdcay+930y5YhgAg+9n2OoUeI5TdQer+32fdhmGoOBZanBo+g1yEKU4dYgFSvqB//vZBIBt9RshkTbW8ZZZ2hUgvDL3iU3uux4LSBM0ZD7dPRnTH08VAIfV+2XAOucQAMuVcKfFSD/+IAABsEoGwYAoHZIKEEYxRIHwLS8pUuhjFVs6/ZZhIVWyxVKBBIRXnbQATBNS+8ynI4tBzkEACv+chlUVIKE/5cRGsWmlKfIzudc3APLQSlg3E2OCyVRc1kpU3DgBmKoQsWtlBcswjPu+nfTYtBL+GQdgOf16GCZW6pXlBCqWSgqJypoOAFfXXDifbwFJLvi5HAjlnUsiIe6AjOp4iQNQHRlT2PlgJCUbbc2s+v/hFwFb/q7gm6HlYpBbmTV2sscQyy/qFBj2v0/cAdz/HGD7NDA1AUyOOU+1CwWOewNjKj6/O03F1/WuugW4/XJgfBoYmwDGdH7IxB5kLPIB+I8AfNwZgga5ck2fJbEm8V9zNWPfrasbgMuPAcuseJ8Exsb9FdBhA+7gaQNKB6TfcgCYug+YJT+g89aoBDMmIMScP12uTKj13uDv8zsKig/uJ1uQOsnojm3qB5P5ACRBH3OhPuzzRN9DV88HqQLEWPJnvTy5nm/t/1s4BcuSpRZtGAu4fi+wtBVYEyccrYwn6hF8/FkJp9bKxAKVFsn/d8urgbHPA9NPOEOWl4+2cfoFHhfVrJTZPKHSj5daOtup6JyCpPx8rHWRVQ7WOlrYCMx8AHIzlxkALPD9c0VB+x/A3E/+E2fUYHXdF7KTGwdvTd0AHP9r4PgWYG0KWBdfsBdsMPfPrKKsoL9XAVLAvO2fFylCE4cKliyrDVZNcGS1CqEYhWFiAZV+XntaURdTLmpCEbpchTYLqi6NrkMCzLzt5Xc4HwyJmmkJ+Z73jQOh4NWeDUZiK1K08f0EXt7CMHVawIk7gaVpYJUA9LI1Ao8bzKX1cytoFtFfpdCIWz7rgzHgth8u0oPGDwETc8CEMySUzFaikgtlpW1Ta8JqNba7lVljSRgW+Q6ZP/57WQvj6fydBjXfAjKbgEvMLwWCvhNoipgNpnQshlS4IGFWzIk6ylWwAz93ETLxGWB5ClidLABoIOS7pmGfG+33YAG5mND0G8F4678vkiPJczNOAC4UyQm2N8w94kirFlfIAl7i402d6dbPWWAtrsjOFiuCvAJZOQE0pHTFsckHYDeCvhNgipQNxoAz8/8IPr5nbvH2jd+6AThJAE4AqwTdZKEBLDoDgU4+YVkPHIBoPwareOt/BkDexsMFAFnbzNJYm0IDnVwbt4uyur1kwL7Tp+iZM/08WT9Rc7DHUmuYTr/x+6o4ovvu9fjBbgR9JyA+omwwxvZI5ULg6ZW7y9FPf9QNwKm/CgCcKABovh8ByVy/UCtJq2f+X1yYJPGU27lIZLbuEWDsWBHesZeDz4iURLUWa1TE47LqK12fZmd3OXidFctqm92KatVs1jAEsNv6sdymaa2g8+xUL4I+Pn2beCgbLGWHI/h8G3oTr45iK86POlbBU9yKI/AcfLR+ouQwH9BfmmbLlTHboOnZ/T9+5vaf8FUaAThXsFOQ45mUcgZCWTAxe0UQ+urYMO1/37GtxQmoLCBtRSp30LrDp2SFdzYMgk/R+VNwvwR9mwQDsaspGSfJgYDYNTbp8psCQFJxEIBkQjDrxt8dXCUIY+COH5MVFPi8SOn2n/QYLZ9Gp0cxANIP5IvAkzVzxivRydnKNzBa8fddM84b6AFyAriMF2pajk9kYIeoClXmA3AQgr5NQEHMBqMVFMNaIOayNRL/vhlH3RZwmhbQQUcAasrVVGz4EtjCu/3dfb/ID3PbT7uKAZ/MhcIC0vqRTo4W0IBIEAmEtFwCYqjW03bcmdwBYeoWgetUbrR8snrloiR2drpACf+rD4D9EvTVjIJu7HBV+781X752Czj9lwUZkTEgcPoNPp5Nv4oBRhCG6dd+1DkMz1JIhR1BAHJ7zwqO3fIRRM5tmDK5CoQKsSgOeBYBKFZULTqcB9r6Ni5KYmd3WKDUA0BlhNLM8EbT1QBXBU72aI5ZjUcVOxz7WLkQ8d37vsart/uA6RcPsxNSAtAXHDYNC1AEpf9s01kKwuBwGU7HgVt/1jtD1e60fgQigSe/j5bQp+KYpGB+H62jT7P8/ZypBIC8Dhcx8eY9wF015abhmnoAyJ5WSrKeNgKO9SHxnT/LSasJBim5lRjWBEIVeROInKL1qunybRawLgASdEy74qjaNNzJCgqEEYzBGvK0297mAFSHEIB6ebKDgc8J1ksmV8t29f1en6L5v6cxIK5iK6Xne/5jCTiFcTqVn/r/tWDPWwXnEPTVgIKUHU7ljASawKefIwDpMdRxRB+wFgD+RREDJABpwSzz2c0LfxczVjkVKwaYgtBBezu3SvX08d39P5uO3QKahXMQciourZRAGKZWar/YZ1xXRPe8wQr2AUK7TvbOVTZBXx4MBECRnConUBSFEXT6mf/TK+/qmzAF/0UBOPqBZYF52HrTFCw2LH5G8UCzJEko5nZqmRnPh/uCXmpnVpDTsIPPwKApOaSA2QLDLSHf97iPx0tpISLfz7bl4iFfsUsnj+HZWEeOYDCDnDmCvZkEgedcCjxGseIhBYt3vx049HwMLRh8gA9gh2MoH9ABqKJzxf0McO7XlSAU4HzhYYFq+5D7hwBu/98OQLlIBCKnW39SlXNY+nqeiq2dkQg+gnGPb9/ZpT0lq6MV5D96gLCwgDmCwbdnCvZmCgY/dxy47xxg5SWuUjigYPHFbwA+fyGwfr2rXrMvPB+vp3L3GHCgi9JOHQCkRVPppeUBigXLFymyejYTB4YsgfA20ofRAlYB0FfAlvQqP0/TsX5PLOB5DNu471cmIwiBaRww/F01J+mz2pqChxUMZvpJlmBv3iTocsW4dzewfhkGFix+2febXDAeJO/YEILBB7pU1g8LQFo98QASVGYNQ6DZfEG3fnEqrgLhbf/HV15anbkFNCvohWSl9XPQ2XTM/2s3I4DwPIZwBEDfgitH0Ek6N6x+u/iD7T4g/YdBBYPpWHEaHlqwNw+AQa4Yj54JrJO+aQDB4pt+oCAyYvOPEIQDCgYfeF/9U3AbAMX7ItAlVtAspKZdz5SOlvA2pstxjES3wJ+92NgAGK2gwi78QoVfEhBeQACqNNP1RdoA18kKdgDhxkUI/zKIYDCnqyzB3jwAJnLFOEIW7QEEi1/1Y21ywVglCAcQDD5/Efj7M4CVrZ5AKlkhxeQUaxBI4nvFzxf8IfCVC4HV7cC6ZEX5nen3VX1vAGLZq8ysrvHY+QBwbGfI2E6JpLvdX+ksthpUvQrmX/sVDGZVUJZgb17vJHLFeGQcmCdVb5+Cxd/5xjZ6QzzMLOQBBIOfTV2Ps4HFHQ7CLQUQmUrV0rgKJMsCjsxGAqTn/hzw0EXA4tnAyg5gbTYBorKkUyLnkB9YVhTxu+kT13iccwtwdBewPAus+b2ar9xJAafqfgMQO4dh+J9+BHe5gqZZZzYok1JJUcpaR6bp93P+W/N6p0KuGIemgEWKgPQhWPxdP7NBLhiHKYHUp2DwpZ8rLOD8tmJQVplOLxAqmbRKC6EDYC7/CeCRPcCx3cDSrsISrs04CPm9ArZk55UvKAspYLqPaPdR4/H0g8DRHcDyVr/X6VabLHk2PhjpPVZY7d5xwF6CwS9y/4LbbVyQsEKIufGiKe0p2JvXOx3kinF0GjhOQY+oNRtljji9TQPf/fOV9IZY4Gq4D8Hgy/4W+Oo2YG5bUUy04vUcLCqSJVRWszJbNgxSmMau+q/Ao2cBR88EjtOqbgNWWaTkIFz3YiWrF4nAjtN0nBZrJnU+/8PA3CxwfMYB6LUra3oglL0tps6wlVha5rLiqd9AdDfB4Je6U0s/0BXTDYh80Sr2FOzNA2AXuWIszABL1JaKWq1R+nwGeM17OsoFY5XTVw/B4Cv+Djg0C8xvLYqJCECzgsxmZlq9T8e0XGUyaUizavPtxoFr/zvw2BnA0Z3A8e2FVV3x6c4sqwObckeyhiXAowUSADhD1XhceDMwx37lvU4XxVN2n3rJIocygkr/Vbs7fe+EdBLcfaXXQ3IPWIrpBB6XlnwpR76jYG9e7/SQKzarxM7qJFj8mg8UarMV9IZ4gvNDD8HgKx8HDs8A8zMFAFnPYQPDl0Co2g4fpDZLqKCxT0/7fhJ4fCdwbFvhRiwRgJruCOwUgCpeCvUjZmEFxhfk9W969kW/B8xvKQqnVgg+B6CB0MsI7P70AHgmd2n1NQ0rv7FvALIlVYK73MnQCDLThSGZoDpuP7uCeuX5n8zroB5yxThGnQ0CgyBMxY63Aq/5aBHG6EBviDlOLV0Eg1+0AByZLgbl+HRxnZXJoqqttA4ODovlJZVuSjTQFtq+NwNPbHMAzramdVpVs6wEoPtdNg37wJfvsYiJP9NFqvHY+7vAwjSwxAeNxVO8T6aNVRRRlT6hHrJ0Ovaw0WDJCKng7g86APvNB9wg2JvXO33IFWOBgn8EIf2nRLD4tbe1+AU7yAWbZeskGHwVdd2mgAUCcNKnJgLQrZ/V9/Jnn5JUYmnAE3hCmv3+t8AWQfSzyPK/POOgJgDdsgqA5nfJAvLdLV+bz0kK4RqPZ3wQWJxyAPqDVhZQyQr7gyaXI9axWCFVAGLvRUhV46PgLnUWBs0HbBPszeudPuWKsTRZAJDTo8l8ui/42juL5veQC7ZpsEow+OrZQlqVVuH4FLA8WVyDAOTAmHUQCAWQkOlsQAwDt/9/AE8SgPQpNa07+AhAA6HLXbb5Xr4IaAMfv/eGvP5NzyYA7UGjBWTWjh40v9fSyscHLtaxhJWxFVsNNAXH1khw983+DYPmA5aCvXkdNIBccemfceooAfhAAcA+6A2xLuAGucxrzgKOMexDfV9OwbS2BB/BEoqLSrBoYGgJ3E8qLcIEsP/ngCPuUy7S13L3wb6PU56/m/Xj4Ps0TKCXQA6AXuNeZY3HMz5QANAeND1kwcKXlj6wOZQ+b7R+Pi0PD0DeFAfk590CKg8qncfoFzIRVWVqfFfBhgn25vXOAHLFWCDbvPstBsJZ4LUPt+jdesgFg+qVptWq11bg2gtgfuLiRAAgQeg+oEmsOujsXb5SsAoCIN/3vx04OlNM6Yv0tdx1MKvK7/TFjVmeCD4HQQQhf159eV7/pmc/kwCcKABoeYvR0oept7SEoZQ0Tr1lPuPQFlAtO0nyAcWhpzw/FSjFzGjLx+RGvxzoSeC1hwsA9klvaFN5FAy+9mJgnhaQ0qqagglADo4c9AhCDpJPl5ZommQ8738HcGw6AJBW1VecZv0cePwOY0/wl1lAD/WUCx0mMlDLr8bjmb+Dwp3x4nkDYbD0thIO5aNtfmDi/xGEeRawxhs7Vb/q2huABQJwAlhyy2cC0xoggjAAUCWWAkksOiIY978TmOOqeqqwqAx3WGhHK06n7TDwOcAV/iipPAKjwgrZm2o8nkUA0gKmAHTrp+o9MTrEYvq44o9pZIOtgmu8mafCV72YAKT/RwAy5OPOuVlAAk9Oule6xQRTWUKlWtkU/IvAHAHti5oIwDK841ZPFtCmdr0U8PaC9hVultd4CIC8P2Ztt/m5/qC11TJXlJDGGpfGAmYODgFoCxACkLpuWh3KCgqE8gNVZK4KtxgjJAB/2X1Krao1rfN7CWZf3LSBT4uAEIyWBVpipL7GgwA0AW25GbGENBTRx3rm1M2w39mmrFVwjTd1Kn+VAZALEE5LtIDyMWUBvbLNLGHgd5H/V07BDp7r3uU+Jadgn3ptxekA5MBri0/Wp4wzBjDbCnkMWMqVpE8GJwLQqvfc0pqbkVj5aNk7gbCxgJno30cAjntowtXNaZ1suvSKNhsYTcVKmw9F5xGE+94dfEoP+JYhD/8OC8eIPUsUHokVVKB78XszbzAF4Pvd//PCKVGIpOAr78mn4DZOm8YC1jco+w6EFTDDPJqeCEBZBa5GffVbhmQ8DtZW5TYOvPhXip0GTuu22lTMLSw+aAVl9QhEWjurI/aQiLJkTMLsX9R3r/ymZ73fp1+37OU9hunXSkdl7T3QrhKCtlCM59k2i5CMMSIAGdqxEIwrmptzTsCEut5yilKoJLAcxCq3fe8tLCDBFwO+tKjyuxSCMdYEXoeDrHcHvu0tTwLzmwHA4N/Gh6zNCqqeOSxC2lb8tQSiMwbuqXIqAcjFh2JjBKGJyShQG6ygVbfJegULWBYcMR3rvb6oCRaQwFPgl1M5rR7/JtBZOIZWx/0+s4QeY5z/1/X2tFnAxPpFELaVkdLN8MWGVr4pCBsfMHN8bmTKfCjZ0Ncp456/x58zLzfw6Qf3ABd8pUgEYmqk5bGyek06IQl1bkXScnlN/u8L24Gdx1qVq91KQvrpgwaAAw9p+wnXPw1YjyWMGtDo2ASOFGMU7SIEUzdYD34vMPmXwLbHgdkFYAtlGiim6DpxJtvq9LtlVr/aWKEB8pUXAOOPAFPzwBTZ9r04vdQ9Ts4pAZ3cd+yHxgfMAOH+vcA69/9Uxijmz/AerYpdar1lNSMYzV+vWY/34I8DY58Gph8Bpo8A04vAFEFIknIHohGVR62QhFRSYjQE6qFri2z3iaPAhHNNlxKwArI0Q1IAxwfReacbC5gBPp66/5ICgLKCtqnsrKKlrFZUFPKOr7osMTtdsxzqQRZ93Q1MPARMPllohUxRqkEK6gShOP0S+dY2hlRv99y+ovRi7IiTnTvLqmg6xDPYpqAUgRgsoR7MxgJmgHD/c4E1FXu7FRRbvEgd7evXWlbPpp9EgUjiJpwe6zwOMlvpAWCMVusJYPIYMOlSDZRpoGiNxKzbdIQlXONMWJbGtw4svdgz3El47nzTRvPrrKptAJT6ZrzfintvAJgx4vsvdQvIXK5VYF3sUZxmJUvgA1FOvwF8spKyBtM1y6EepI4LqVMedbEaTp0EIKdPKh5FqYYqSxgo2jgFr13j6XXHnOiSZOeBVSvyC8qC2r05FVvVw9cAMAOA178AWPMp2LJaaekiCPXExwHw660n1oB/niGQazwOkkSepbJ/72I1x4CJ+cJ6lYI1riccrVicUuVSmIW82pkwnHHVOKbFsOozQGkFkwewnBES37ABYMaAX39ZAUCCb82nIlo+40p2gNnvsoKunxH1xGwA/LOzdQOQJPIuHzV2GBg7Cow7AI0l33XfjOsv6oVodes6ISbBsAZMX+kJxU56KY7pkmFVhOciuvTzSt05v0+ryuT/9gDrZNe4wPMsI7VJP3GcP7gUOOdvgL1rRYJ0ZI5IV3hV4/wrGYPPU3/AiRhYusy2K7mU999P+z90ObD7LuBZK0Xdkeq9NSX2+o4HLwfWlopFCC0fgciBMtAFC8CGrYXVoVjnU2G7rTXrzh4kfRzLY1kyGwBoeiGcPiXb5eAzdXWnazPCSScb4j3xfmav8Cx2p50lAMW0VXINitCogl2r9H2dcctWwQxQsn6ZTBbMNtcgdKIbiZj51VcBk38CXPxoQcfCUg8pjcYgZScw/momACnXyr4leBhs5QaBTHpf7X8dMPYJYO8XgAv9e8QJlAZZq8D4xSuANYKPJQn0AR2AHKy1MACKe9nfFI6IEqduEWoHIJ9wlsVKLekoMCa9EAegSTYQeM4TXco2SEMkAHEbBZoj4bbYtdyCVrFqGXgTSxgXYTZeHLi9AMjEQRCVUXP/n4KUaaT8vVTi+Rtg7GPAuYcAWlMCgUVkQfJ2Q12yBvPXMwHImhDWwf81imsTiLSEvHZkr+jY/p9CQRD4p8DOBwteItai05qn31FFdfLlFxYWgCDUIkRkj/TxbCEi/89jfPZ3X2VqYSJQbmUNQY3HQT7hbv2sLoerVwKQHNEEoCsm8R4MhPRjXUGzVEIKIoY7yaEYuY4dgGb5RXruoSgtSCLLarkICQ9f6QNykGjFdjsIBaI4kGlt8W+Rg5g0HJ8qAp47nihAzFpuWtPIMBZJlASILvR6fQ0DCVbJCkJOJCqnk4pGpb99tZ8MopyiKDX7WWDiwYKXiEQOehCrgKh+eJQ+EQHo1Lby/zRlyf8TIbf9XS5ftIb8I92YugH4ay2pLusorl7dAoonWtMwQSTdOFuQSLTGHyIC8kxSIQuA4hwU2WUAoO4/grBcDbsfWElSzg+JCoYDoEGM1ixSkHzgF/wG7y8sIa3J7JPAGWuFJSQIaU01iJHUiYP4e33BrPOHmG/JMaOfTZVYRhwGav87vWKPJ9/rSH4IOGO5sITqg/ggxXs4TOaBAECbeoOsgfl+DrQShFqcEIhyyt0MbMusEkx76iAZXKM8BvXiZAGlF+KaIbaadYpem4aDgpJZQz6YJABV5VcHAJZ0v4FxX6KG5UpYs0KnqjhRuagEVgPglYAl9ciHf8mdUrJh0Qx9vkDBzBywfbkYQIGwahA/kglATsHsDzKA0BATiPyZ4NEDwIeoa/uFYKKXL2f24nQoIgd9R3yQCMTFqwIAfdBWI7+yB5ZLECYLETd85YJl+2YAUNosLIel/xYlu4Jsl6bhNhD6it4WJCvA2Zc4Gxo73RcgJeOqFmGR6rcChLYACyGojmEYdj59KnZ+tIQRhH9IvWA2hiREjDeRI9Cly7fMF3EtWRFawhQIf5IJwE56wdTIYdt7tp9ys1K8JnoJvod9Wn682PNkP4hUy1ndWgstAtBDMLYN5/6PAc5DGNoF4SrZfN+4+IhT8jqwg2Cp8ThIJ5vfSWBXAVCrWN9SMxDK+skaOvhoAc8me654pmUB3f0wyt+E8FyRAGmPlOEoiSD2qgvmAKoOm52fAuiTDHSyIRxx+lI0QxxADubfF5vffMmSajrWlP7nmZ3dSy+4r/ZzAUEHnQ8R70HsXlK+PgJsW68G4XYGZj0EY2EYATCAT6tAhmE0DXcC4faapcwMgAIfLb0kuzT9Qmw5uwAAIABJREFUSi+EfeALkSrpBovbrQDnkm8wAo8/E3i+CCsZ98NCpAp8cUekZyBavI4ET/TnaAk/RQCyAXy6uNSPA0i+wMeB6ePA5HFgZq2wpNGK3FUDAHmv3fSCe7afX8CB4UNEEOolVi/3obastNwJ9cO5BOBKEQMsAcifHWzRAigWWAlCn5K2bQYAOe1KMjTIR2kRUhKVS7IrLia0v+3xwHMZMCbYNP0KfG79zAqK5DxOvyEuWu6VD5KSHy2YAEQAfpaRdl5UkuUctIpBnCIIl4psD03FtIIP1ADAlBuJM47EqqUX3LX9kSBQcuuyftK78xUkHyQ+RLqHZ3Fv1KcgLj5kAQ1s0Qo6IA1nHhNLQzA8ZxvBXuNx8DcS5UYpNnoYxsCnUIqvZo0F3wPTMa7Hv53HOJVbS/l+5bumX7d+5WLE44hxIRJB2NMCqj9ixwuE90svWCaIA6bAp959EKeWChAyA0PTOV2unGMQveCO7bfqHbcS4rJR7Ewqnw5AWhLuImg2uFQAXAVs8RGmntW4+g2hB3P79L/EJ9zGvqrxOPibiVihAOgrWQOf/EBfBcsPNBBqW9Hv6zzGqFzmoXz3B9AePgXiq6bgiv4YOB9QHS8AfpkAFMMjrWAcQA0iO9XJiQyAnos2vV7ESHOOQfWCO7Zf7F40mZFQScRKAYBaSU6vAVcTgN7xXHiUFpDTMK2dFh56912BTiDcvpkATIXzCL4g3WXTZ4jpGfjoF/oihL+fx+0yWUABLwIwtYKKIabgCzHQvi2ggBKn0McEQDaKT5cGkIOo6SuyYzEfjQB0EM5nZgAPoxe8of3sgSqCQM3jkdFLvpRvR13+7UVRuhUFSavNO6otwp88ZZ3+t4M6HLtch6OT9AG/q9cmtf//gV1JDYcnQ2zY6/YakfSrU+Pg1M45NqPt3IEtoM7WFHokyrWKkooglCMWLYjiUXMtK3g8Uzd1WL3gDe3vRRCoUEYCwGtYFxxqgA2E/jI20F5hhmQod98BHNnlxOTig1aGiDanO21yV4DygWuB8YeB6fnC9WEtiKVVKeE0ZGiXWczeJoWMIig5a9V5DA1ANoKDeDylZ9NSXxyAsiKawrQqmCv2HVf5e8aRoxfc1n7xs+khItAUvojvyWryxVcWJZksVSyZoQRA3dcAoHzax4Gj2wtu6FVKM7gMgti02jbV476oUJJs1j/AbA1mQ3Pm8eTRsoZDtR+xZKCiEKmMXTIeXHPGdhYArX8FwG4DGMEnAHIK4yvT58nWC2b73cexaZgWWaEKgU1gjNbPP7PvOYGsUSBkv3hBtmRWNzxjTk9RWktvxp6POj0vARjY9sWkFel8RWxegjIF4RjwAOnZWMPBTGjqvHmszxJOBUD3xyznL2bqROvoP3N3q84jG4C7M/PpcvMBef0cvV9k6hXv+2Yno5QfGArRbaCC0mWv2YtF3ecerNDhkNZIIsXQRv5dlTtGADJSz2gEE1EJQM//026HdIEZLC8B6A0tk0g1Ja8DuzJdphS82QBEZj5dbj7gxZN5er/IZI+67pscgE7QaDOUMyC0Wb8+gXjuR4F5J6YsaXnFhBoAGEVvUhb60jISgCQnoh/OLBgvIrL8v7DdFkEYM5dtNg97tvz5zJqzdfIBmJlPl5sP+DJP5xtW7xffnzeh7H+Z+3+RpkyWT1YxuURJYVtx6T0fCTocouQV85VkHRIGegEuEv/YKpkA/JceVmL8kv6t5/9pu62tfiPWcFQVEa0DZ9WcLJEPwMx8uvfnjT9IgZyj94t/ldeA/S9tMaGa9SNdmsIxbvVscVJ1GScoMt4UPwhAsmMZ0aXzQBsvdGRBjQz0FUpEJRAJQOq4KAnBdz+sfiPJ3bOYn8fsykyVWMfiN3BOzckS+QDMzKe7OW/88aqQzsfE5kH1fvGjeQ0wADodmVGwOeiMsUqHrGOnS4UFy9P/wAEojkEnI+IqOIJQNLgpCXhcmLAtD/D+kgQE235L93tj+YBqgTX9BiCeW/NedT4AmQ+YkU/3sbzxBymQuZhm8g1T+QbV+wWFdjKO/Te2mEFNlCb6gPF708VJ1TXHgKd91GnZpDfi1k/gM2vqU3DUnCuBmNQe3P9vw6pe229KOvB0K1k+ZS+rnrfM2AlA3JMZtah/EZKZT3drxuDz1O/yxAwu9JgJxr3lQfR+8aa8Buy/wdWQZAVl+ZzCrG3q9c/YrkmHy3IRYryAAqAkEBIlopJxNNUbER+fA/H+/+AAdP9PmS9dazicJybm7mlB8nR2dI1HvgVkOlZGPt2nM29GCamcGZjAwlQ+vvrV+8X/zGsAAUiLVPp/wd+zaTMFWw+/kAA0GQQnpCw5mDsAMIrcRB5mC/+MAffTwgfwKY2KfmCZ6ZIkUShrxXxBX4yYaV8Hzmcn13jUA8CMfDqWYeQcSkhVOl8U6uxH7xekrsg49h8oiCENgC5TUG5vKxxT8f2aRtOtcAKQ1s8soPuOVUIwpchNlEEIOyNSIrrvv3hwnckWIZPZsnbcDyzTpvg3lU8mpZQqozyfK74aj3wAKh1LgrsD5tMxiz/nkGD1sHq/YNFOxkEAcuW7oqmXlisuQOT7VV2jwi/kTgj1RkoZhBje8Z83SCAEEJZW0C3gff8tADCt4VASaWIBK0HI9q8BF5yUAMzIp8tNx5Jg9bB6v/jdDPSRns0BWIZeUitIo9IhHmhXTvzCPQddccnZ76U1V/IvC4SBCFyg26DFNg7c++Mhhb6qiCikT7WVUmr6lYn2nRKyrdZ51GMBlZIc07GUBdMjny6XCiUmpA6j94vMZbgBMFo552pu27PXAqXTyAUQcitOQjAm9xX0N9pIwIPmSCmH5QuPqER0L4kDYgp9zOUL6fYxkbZcFceyAreAF3GlV+NRDwAz8uksnT3jiILVSmpWNlhMze+k94vMZfgGAPJeHDjpCrgM01Tdry9OzvmYAzAqLVWIwEShwzbRwwSEn+MqP6bQK5tZlWyhjCCCsC19Xv7gOnBRbgp7cu/5AOyVjqVMmA75dJZ9nHF0yohWNlhMxKnS+0XmMtwAmFq4imnYbrEqNJPc+9kfd62RKh0On8qV9hXZ9askEPgAfI56ziocUgVbzGT28lEtRMoKtg7lBHtznfZNA+CQ+XQWM8k4uglWK/NLYKzS+8U9GReXD0g/Tyvh4Ne17Yb4Zbr6g6y7/aNWcoPpjKRTsJIags5IJwkEAv6en05S6GUBfRWsUExZyVZVQCQwrgN7Wfdd41GPBczIp8ODeXfTSbBa6YYxlY8/p3q/udc3C+jTbtvqt2oadnB2m4oNgMn0W0p+hYWHWbwg9yU/0Kb9EIy+5y2hiCit4UgKyTeAkN8Valk4Le/ldlONRz4AWWBRM6fdIPfHstw/G+SE5rMnVQ/kA5AkLHS0ak7V7reXfhgACaBqDtD3e/nmc5k9kA/A80JReq+U38zGVp3ObJo/BvAOD3dtwiWar9zEHsgHIGlFubqSx7+Jja36anLLcDvvgwA+NDpDfILv+qlzuXwAXuSjrkKemlO2e3U1uWUYnL8dwB/5e2apca9LNv+vsQfyAUheX4VguB+mzIsaG9ntqxhF4Xbe3QD+n7/uHLAW9wQ1tblMRQ/UA0CaHC7plXEh+q4T0OWcfhleYTSHBK0EH/mi+fcRuKQn4I6fWpeoB4AevCz3HOOm9yb3F5mBlZBNclYCj1aRfyfrbgPCTR6AzK+vD4CyglX7jpmN7HY66d1E0ctdIrEEE4wEIMlam+Pk7YF6AMj7EwAVbU82vTerCwhAXopJN9zVI+AYrOeULLZgErY2x8nZA/kAJGWr0naUWdFpy2cT+oCWjpdjLFxE5UzYIBBpEUX5nLnlvAktb76SPVAfAOUHpiAMm96bsVtCAMaKALICMyxDq6cXfycA+b/mOLl6oF4AiqBRIEzBp7/X2Af0+fi1XIioMIlAI+AIPIGPmeROWV3j1Zuvyu2B+gHoFfZiDS2lC0LiY52WUADkQoTTMH1BFSYRdHoRfKSu5v9qrizMHYPT+vx6ARhSuDcAzzmDo5ZGHT1PAKYMwQxME2jiSo/gEwBrrq+u41ZOy++oD4BaCcsXTPiSI3ey8s4KGoG8QwCMFM+0ggQhLR0BF19SXuD/ayakz7uR0/TsMcxg3SjfqWNA0hsrga/ojaq/8WPcC+YIk4Ke4CMSuB2XVht1Oj8zIfXlU8BtU8DhmYRXWdfrdF1fgr3+S8At48CD04DVjXQSDO70PTUnaJ5uOCwsIIFHSSFy1pKPWCDsZxCpw8UVgKSPxLXM937OzxxAljzcPAbcswU4Qh4V3UN8mKoeKm/bu78IfKJQa8VD48CylHQiL3O3/qg5Rf30BKACMtJXjXKQcfBSK8Dfqc3KVCwuN2VFGRnm/yKZtq4Re5ifyQQgM2A+BeB3GHaZBo5MAIue0l7Kt3cC4xhw+5eL7TuCkJk1jBtyerbUfYG5ExjZ/pqrxE5fAOrOq5SmowVIrRp1IyT2R6+fg0bgVYG4CsyZe2UsaiOGKXr4Sfp9k8CxCYAFSKyvXeY1o1BxQux91yMtfsHPutgnnyUuUvhc0ZsgUXib+nVkq6+ZKaABIHsgVZnuwD9sVo66rrR4ImdhLGSQ8zPL/JgBQxeU1ouWkO9PTgDzbgmXxrzMkatl3keivfG5x4r4IRcz5BfkO5vEZ0kgpIfBZ8yKjlL17syy0tMNcOn9dl4Fy6dLFabj1Mpvow9Ify+I4Nlo9Xt+ZqU9VdJpqZh4QDDyxUyYOYJwHDg+DhgI/WUVZl7aSEt93+GO9Ia2iuZKOfA7lhp9JpvAVy61w2mOwO5hmCgMHC1H9O24gu6UD9jP+ZmbtLRaSsei9SL4XDPbAEh/kGQ/pSUcc0lbApFWb67lQUhpVnLBsoKqqZclFMmUtrxPcwxl3X7vOCAtYLSCcugFQmqhdssH7HU+RznjiOlYXA8wqkOfkItTAom+oKygca4ES8jY+N3z7fSG4hfUtp3ihUHruVSsFy1iRvNP+1N7A5BdJACmVpAgZPhGOyCigEjlPLudn7kvFtOxuB4g6OjD8UWLRkCZFRwrLCEXJQQhp2K+37lQeBCRX1A7KPQto1prFEmSYn2mB9EAsO+kYfk8KQhZF8yjVz5gp/MztyOUjiW9bCUhEBhKRCCgSis45uQ/PhX/xfFWMgOnWu2gxB0TF/o0kEZ/kCDM1Ts+3RHYnwVUL6XhDFrAswfIB6w6P1MrTulY0sum1VICglKwCEACqvQFCUK3gHcsFQCM/ILayqP1k9JshVqrncMalOYYvgcGAyCvIwuod8YBJQmZpmGJeyRwkGw4n8jJOJQNw3idLFhMRNB0SgASTJyKoy/4ieXCeFfJBUeV2SoAclFyR0bbm1OHTUiN0/DTAwD7zQeM52dqj8VsGEkVE2jKetG7AEhQ0frJAv6RC0trC1skl+IWlNinGLbSaZg7Mc0xfA8MbgF1LQV1z08A2G8+oM7PVF9Ms2GUE0gQyp+Lwu2yagLgR9ZaYpkSypQ6a6Q2DCqzpkvietXIFdoZfuieGmcOD0DeP0HEbBhNwYPmA/L8zJQsATAKnguEqS+XTqkE4YfWWwCUFZTksYAYwZfIBeN9Tw0cjOwu8gDIZqsoSSvhEeQDiiGYFoyWiSDRypWgi69UP5sc5fIcquSCNeXqe2X9ZAHfM7Khe2pcOB+AT41+aO5iRD3QAHBEHd9ctuiBBoANEkbaAw0AR9r9zcUbADYYGGkPNAAcafc3F28A2GBgpD3QAHCk3d9cvAFgg4GR9kADwJF2f3PxBoANBkbaAw0AR9r9zcUbADYYGGkPNAAcafc3F28A2GBgpD3QAHCk3d9cfOxqYJ2au9RdPtdp/khoEOlglDYT39V1PzQFXLsMXAlgt9PCxJKPbufyf8/KHIPfBPAZABf79Xc5XQ0ZQ1Q7360NbxoHrlsDvs5ZRsgo0une06by6X1mZvtP99PNAp4F4LsBXA5gjw8EGTeqaGF4QhzQF80CX7cAvGIdeDYAfhdZ2sTKUcVrpE7nd31N5gj8e2dIo2osk7NZpMdK0Z19tv+bJ4F9K8D1ACj8yfNSikHeg+5Z969m57Y/8/ZP+dPLKZhP/rcA+AYAF7g1oRUhEMUzFMt6eSJfX78b2DkPfM0i8GIAX+uWlAMppreUUErn8p2gzTl+2flg/sDbTkvIOik+CP20//mzwAXzwDcCuNTPJeFXpEpM6QEjIHm/zTF8D7T5gATYNQCe69aAloRTGulfBESBSYNyxR5g/Bhw7hKwZwl4vk9LnM5JmsBzUyDGAX3B8G23Mz/g9BuUa/0IiutfMkj7zwKmngAuXSvOpUvAWYBtF4BTnspIj/O8zPaf7qdvWITw6eZA0JLQEhKEGgxZhUj/dz3NzSKwbR44exnYvVKcy+mM5Km0JhxInUtrGkmzCPicg3W5LMGkQiZZTm9xS9Z3+4m2o8C5c4X15pTKW2Lb+fCx7WLtjYxzqiql29Icw/dA5SqYf6RTTilg+lYCIXmICKQ4IK9wxfSJY8AZK8CuFWDnanEua9ZTAMsaCog3Dt92O/MvnRGBtGwkqKRmMEkqCaa+2k+0LQDTh4rP88UHj74kF1WaATo9QHQ7mmP4HugYhtEKj4PB6ZQ+FS0hQahpldPya1kXTOqNY8DscgG+HavAttUCvBxInitrkgL4lcO33c7spBdM3kAuSnq2nx9gQfAh4JyVwvrxwel2z3p4aMlzH6DM2z/lT+8aB+Q/OT4EEqckWQSBkGD6EQKQnDCLwBSnYgcf32fXioGUFawC4esyu7CXXnDP9tOCsyD4KLB1rmgvX7zfbu2WG/Jtme0/3U/vKxBNAMoi0KcjkATCN3HOEr3UAjDrwOP71rXixYEkeKMFlSX8ocwR6KUXTJ7AaNE2tF8WfA4Ye7Kw1mwvX/yZn+eKnvcrfzC6IK/ObP/pfnpfAGQnySoISBqUXyAASS1AK0JfagWYcRDOrAF66TxZQU7jBOEbM0egH71gcgXSFZAV54NQtj9YcNIpbONCyh8Ygi8CVospApDuB63g92W2/3Q/vW8AsqM4gLIKBBIH8bcJwMCNMX68BTqBb8s6sGWtsIA6jwDk662ZI9CvXjA5A6NVa2t/IAicnC/aGV+8T74IQPm/AmGuBc+8/VP+9IEAyLslAKMV/LgAyIUInfnjwPQqMOOgI/DstQ5Mr7UAqMF8V2YXDqoXXNl+EQQ6N9v29aKdesUpWJZbAPyPme0/3U8fGIDssDid/pUASCvCaXgJmFguAEfgEXT27gDkuwaUg/nbmSMwjF7whvbLhSDL5TwwvdRqo9oqHzACkCB8U2b7T/fThwIgO01T1IMCoAZxGRhbKoAXQUcQTjkI+a4B5e5FzjGsXvCG9gdqrLGFYrpVG/UuHzBOw2/LaXxzbh43DKeoJwlAHqLndSs4udoCoIBHQE45EPk3DuitmYOQoxdctp8+rFwIWsGFYiFFoLGNchcEQC6e+OJC5J2Z7T/dTx/aApYdJ37AyJK/DIwvFxYvWr0IwEn/H1Opco5sveDUhSAAF4HJpQJkWixp6k2n4IYfMGf0amDHev2I8+l4/UbvNw8Eozw72wJePOJ8und7EkKj9ztKGA1/7WwATo44n45pWI3e7/AAGPWZ2QBkYHCU+XTMfGGQmYIxjd7vqOE0+PXzATjifDrKtTZ6v4MP/MlyRj4AR5xPF+VaqZLJF1UzKdPV6P2eLDDr3I58AI44n07ZMARbo/d78gMubWE+AEecT8e9YOn2Uheu0fs9tUCYD8AR59MpG6bR+z21gKfW1gNAz4geRT5dTEZo9H5PPRDmAzBmRM8BJzqfLiYjSKKr0fs9dYBYDwBHmE9XtRfMsIz04aQZ1+j9npygrA+Akqs8wfl0BCCTWRq935MTYL1aVQ8Ao1zlAnAi8+kEQGZTNXq/vYb75Pt/fQAcUT5dBGCj93vyAaxXi+oDoFLyT3A+3Rcavd9eY3xS/z8fgCQX/LPR3SOzkon55jg1eyAfgD8M4NcAPD6aDmBtB1e4NMDNcer1QD4AbwbwxwDe4UvRE9wHZG1gNSXDLlwLNcep1QP5APxzzwj9IIAPnXhT5ORc5EYCA9HNcWr1QD4AmRH6FQBMTSZZH98ZmD5Bh5g1FopiNns1x6nTA/kAvAfAEwDudnI+EvQxPfkEzYfaCXRSBluQMB7YHKdGD+QDsBNBH/9+AkAobqTADGK7Inw1x8nfA/kA7EXQt8kgrGAGMfBxZ5Cv5ji5eyAfgL0I+r68uR0QmUFoBQU8vfNvzXHy9kA9AORoMw7CdGQCjoUZDwL4kv/+8OZ1gJhBIjGDgMh3vTavBc035/RAPgD7JegjODfhiMwgoqeJwNPPTaB6Ezq/hq+sB4AcXeXEP+ZhGVo9vRimIQD5v5oPAZCupgDI9wg8/qz/1Xz55usyeyAfgMMQ9GU2Op4eAchpOIJQQEz/VuPlm6/K7IH6AMjgGzdl6QtyX5jWjpQFevF3lq3xf6yhrOlIAUgQCojR8gmE+l9Nl2++JrMH6gEgR5UA5KYsc+AZmCbQCDi+IvgEQMob1XBEAHIajgBMLV+0kCdws6aGu3zqfkV9AGTwjftg3JRVVRAtHQEXX/wbAcoXP5d5CID8GoJKvqDAloKOoIz/y7x8c3pmD4zhaqwjRzCYyQg5gr2ZgsFTLweWr8XQgsXjbwLWrnNtMlKgNoLBmZAa7PTCAuYIBlMvlWQswwr2UlUw45jdDSx8HbD+Ctd+HVCwePKbgJV9aASDM8Yg59TWFDysYPBtmYK91IbNOHaPA/M7gUXKXA4hWDz79cA8+W0aweCMURj+1HYfcBjBYO54MMY3tGDv8I3nmWSHOzYOLJ0LLPGXAQWLz3oB8MQUsEa16kYwOG8whjh74yJkUMFgbsNlCfYO0epwissVY34bsHw2sEIRkAEEi/dcU0SP5qhF1ggG5w3GEGdXr4L5134Fg4kAjuDQgr1DtDqcUmZETwArZwAru4BVqsv0KVh8/o3F4v0QXZBGMDhvMIY4u3MYhv95Zh+Cu1xBcxuOU/HfeDIq5cv7FuwdotXhlCBXjOXZAnyrO4BV6in0IVh8wStLuWCsUAyvEQzOG5ABz+4eB+R/ewnu/kOP/3G/l4kJTERlljQtIot2e53/IwO2OPl4FLtcnCqAp9cahT56CBZf+LpSLhhz1N5qBIPzBmTAs/sLRHcTDKbiNHdBGGymOC/3hglEvgjAnoK9A7Y4+XgiV4zVWYDAs/etxaubYPFFP1QkLtCIP8neaASD8wZkwLP7AyC/tJNg8L/xLNBu+YBdBXsHbHEFAINcMVamgdWZAoRrfPdXm8KitLdmgYveWAq+2y7iMqfuRjA4b1AGOLt/APJLqwSD3+y5T1yI0AoSbAxMMzGV1o8/My2ro2DvAK2t+GgiV4zj4+3AIwDXtwBrVJeuECze+9aW4Dut4PxkIhYsdetGMDhvoDqcPRgA+SWp4O4veQ5Uv/mAGwR78+6rQq4Yq9PAOi2fA4/vBkKudKVU7VZw77uKvWFuZbtcMNb5v0YwOG9g+jx7cADyi6Pg7gccgIxlcA5TKhaD01yYKBmVFpBZMfx/m2Bvny3t8LGqoqTliZbVI+gMgHwnMAnCIFi897cLAAZ6QyzFzzSCwXkD1OPs4QDIL5XgLmk5JHk/SD5gKdibd38VcsVYGmuBTaAzEHLHgyCcaokB7/1IkUET5IKxwF5pBIPzBqbPs4cHIC/AaeqvPL9pmHxAE+zts6VdLCD/lcgVY3UyWD0Bj1ZwqgCggXA7sPfWAoAJvaEtZBrB4Lyx6efsPADyCtmCvf00s/NnOsgVY3m8BTRZPZuGBUACdArY+5lWDqGmYbIrLHEx0ggG5w1OH2fnA7CPizQfaXqgUw80AGywMdIeaAA40u5vLt4AsMHASHugAeBIu7+5eAPABgMj7YEGgCPt/ubiDQAbDIy0BxoAjrT7m4s3AGwwMNIeaAA40u5vLt4AsMHASHugAeBIu7+5eAPABgMj7YEGgCPt/ubiDQAbDIy0B8ZYNMbkX+ZekpuIiOQrPar+xs889HJg6jZg5jAwvVZ8B+ll9PlO5/Fc/o+ECjnHfi8zYfkvM5ulmp4qJXVqx5deD4zfAkw/CGxdAZgoHfuh131QkaI5hu8Bs4Ds8B0AWLnIRGCBsFfn87JffDMwdjOw5R5g8giwZa34jnQQUwDo99wBfJ4TM7COiNdlaj2rA/jeV/vfDeATAP4UGH8I2Lrc6gc+SHqY4oMZ74VSKM0xfA+UUzB/oBUUCKMl6zSQ/PsXqZD5KQC/A0w/DEwcAcYXgYnVwppwADuBkefnCim90FmBWXwnK87Uen53BI8sbuwqaz9p5UgnQhBS+ZN1zE8Ak0utviCwq8DI8/nx5hi+Bzb4gJzKZE1SEFZZgS9/2pWR/gTAJ4HJQ8DEMWB8ARhfBsaWCwDquwQKvvNgHXvOcYVbPFJPkw+dDxC/W1Y4tWDpw/Rlgo4lo1T4/KxTihDNpJwj3/UiMLXemprjffC7eWpzDN8DlYsQDiKtVxzEqoHkyX9HRizW+nIgaQnvAiaeBCbmC0s4tgSMu2rMePAR9X252jXklaTFU108K0MHav/nvJ6ZxVVk9OI7GR2IZoGQNc/HgbHgIwqILIVujuF7oOMqWFawCoRxkfEIB5CWgkREBCNf9wMTc8A4QciBWyoGz16rwNgaML5eWKpctYZL3N+TWLX0gvtuP0HHk2n16JDyxXmVhfU0qywbJbr5GSuXKxA/sV5Y9UYWdnjwyS3qKKgarWA69Wg6fjQOIK0HadnIjPVFB+AiME4AuiUkCFnESyCSkmAuU7Cjm15wX+2X2ifBRn9A8mKcW2UFjULVQcgVDl80u40SYh763FfvquhLCxitoBYUsoJfjXKttByMq9CKcHn4sPuCbgXNJwyWkECcz5Q376UX3LNncZyQAAADEklEQVT9fFgIJs6lBBwtn3Tt6FpIz4RWnuQxPh2XIGzm4CwQ9hWIFgBTK0gQHiIAJddKq0ELQh+KL1qUR4MvSEsoENIKrgALHNiMox+94K7tl9qnnMio8MSf6SNwGpYVjCDk/Ju7isq496fCqX0BkDeqlWwKwic1gAQSpzGREnFgREz01eALLvvq2Kfi45m6cf3qBXdsfxRbJMho8dimqOhEK8cXQRr9QVpvPoDNMXQP9A3ACELFxPh+jACkP0fLIKFCCRRqKuPUdqjlC9o07JZwKVNHeBC94DQcZO0XAAkmgotAk9QYrR9f/BvByYfMSATDVMzwTXMM3QMDAVAgVHCZ7/MaQK4QZUHiNCbBQlqUw74YCb7gcmYkelC9YFlwvVv7RRAorTuBkECU9asCID9/x9B935zYzyKkqpfiNHxcA0gLQgvBAaPVkCqm3h2AtC5m/RyEqzw/4xhGL3hD++MmslgqCbgUfLKAcRrmTlBzDN0DA1tAXUlWcDm1IOIIJAjlT/Fd05lbFQFwjdtgGcewesFt7Rc/Gx8iWjUCjGCT1YvWT1MwgUqrf3NG45tTbcu0aximWx9xENcEQHGbcYAEwtSXSqY0gnCdgeuMI0cvuGx/FUGgFhwEYrR80QckWN+X0fjm1DwAWv8RgJFilJZBznz0pQg+AZAAlVWh1GvGka0XzB0cCQi30aSGVa9AF62fLOB7MhrfnJoPwPER59Px+o3e76mL5Kwp2G57xPl0kxc3er+nLvyKtLmhfUC78RHn081ONnq/pzcAR5xPR9mRRu/31IVgvgUccT4dNaobvd/TGYAjzqejumqj93s6A3DE+XRUg2VSCjdaGr3fUw+I+VPwiPPpqJjO8J1Nw43e7ymHwHoAKMFd7QErAeEE5NNJMb3R+z3lsGcNzgfgiPPpomJ6o/d76oGwPgCOKJ8uKqY3er+nKwBHmE+noqRG7/fUA199U/AI8+kEwEbv93QHoEhZTnA+nYqSGr3fBoAtaiqBUImdm5hPJwA2er+nKwBHnE+X1gUzSbnR+z11wPj/AeCpPDD3t7rvAAAAAElFTkSuQmCC",lR={LOW:0,MEDIUM:1,HIGH:2,ULTRA:3},cR=class extends UI{constructor(){let e,t,{preset:n=lR.MEDIUM,edgeDetectionMode:i=pI.COLOR,predicationMode:r=fI.DISABLED}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super("SMAAEffect","uniform sampler2D weightMap;varying vec2 vOffset0;varying vec2 vOffset1;void movec(const in bvec2 c,inout vec2 variable,const in vec2 value){if(c.x){variable.x=value.x;}if(c.y){variable.y=value.y;}}void movec(const in bvec4 c,inout vec4 variable,const in vec4 value){movec(c.xy,variable.xy,value.xy);movec(c.zw,variable.zw,value.zw);}void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec4 a;a.x=texture2D(weightMap,vOffset0).a;a.y=texture2D(weightMap,vOffset1).g;a.wz=texture2D(weightMap,uv).rb;vec4 color=inputColor;if(dot(a,vec4(1.0))>=1e-5){bool h=max(a.x,a.z)>max(a.y,a.w);vec4 blendingOffset=vec4(0.0,a.y,0.0,a.w);vec2 blendingWeight=a.yw;movec(bvec4(h),blendingOffset,vec4(a.x,0.0,a.z,0.0));movec(bvec2(h),blendingWeight,a.xz);blendingWeight/=dot(blendingWeight,vec2(1.0));vec4 blendingCoord=blendingOffset*vec4(texelSize,-texelSize)+uv.xyxy;color=blendingWeight.x*texture2D(inputBuffer,blendingCoord.xy);color+=blendingWeight.y*texture2D(inputBuffer,blendingCoord.zw);}outputColor=color;}",{vertexShader:"varying vec2 vOffset0;varying vec2 vOffset1;void mainSupport(const in vec2 uv){vOffset0=uv+texelSize*vec2(1.0,0.0);vOffset1=uv+texelSize*vec2(0.0,1.0);}",blendFunction:BI.NORMAL,attributes:FI.CONVOLUTION|FI.DEPTH,uniforms:new Map([["weightMap",new fc(null)]])}),arguments.length>1&&(e=arguments[0],t=arguments[1],arguments.length>2&&(n=arguments[2]),arguments.length>3&&(i=arguments[3])),this.renderTargetEdges=new It(1,1,{minFilter:ue,stencilBuffer:!1,depthBuffer:!1}),this.renderTargetEdges.texture.name="SMAA.Edges",this.renderTargetWeights=this.renderTargetEdges.clone(),this.renderTargetWeights.texture.name="SMAA.Weights",this.uniforms.get("weightMap").value=this.renderTargetWeights.texture,this.clearPass=new PI(!0,!1,!1),this.clearPass.overrideClearColor=new Et(0),this.clearPass.overrideClearAlpha=1,this.edgeDetectionPass=new YI(new mI),this.edgeDetectionMaterial.edgeDetectionMode=i,this.edgeDetectionMaterial.predicationMode=r,this.weightsPass=new YI(new SI);let s=new Cl;s.onLoad=()=>{let n=new Dt(e);n.name="SMAA.Search",n.magFilter=le,n.minFilter=le,n.generateMipmaps=!1,n.needsUpdate=!0,n.flipY=!0,this.weightsMaterial.searchTexture=n;let i=new Dt(t);i.name="SMAA.Area",i.magFilter=ue,i.minFilter=ue,i.generateMipmaps=!1,i.needsUpdate=!0,i.flipY=!1,this.weightsMaterial.areaTexture=i,this.dispatchEvent({type:"load"})},s.itemStart("search"),s.itemStart("area"),void 0!==e&&void 0!==t?(s.itemEnd("search"),s.itemEnd("area")):typeof Image<"u"&&(e=new Image,t=new Image,e.addEventListener("load",(()=>s.itemEnd("search"))),t.addEventListener("load",(()=>s.itemEnd("area"))),e.src=aR,t.src=oR),this.applyPreset(n)}get edgesTexture(){return this.renderTargetEdges.texture}getEdgesTexture(){return this.edgesTexture}get weightsTexture(){return this.renderTargetWeights.texture}getWeightsTexture(){return this.weightsTexture}get edgeDetectionMaterial(){return this.edgeDetectionPass.fullscreenMaterial}get colorEdgesMaterial(){return this.edgeDetectionMaterial}getEdgeDetectionMaterial(){return this.edgeDetectionMaterial}get weightsMaterial(){return this.weightsPass.fullscreenMaterial}getWeightsMaterial(){return this.weightsMaterial}setEdgeDetectionThreshold(e){this.edgeDetectionMaterial.edgeDetectionThreshold=e}setOrthogonalSearchSteps(e){this.weightsMaterial.orthogonalSearchSteps=e}applyPreset(e){let t=this.edgeDetectionMaterial,n=this.weightsMaterial;switch(e){case lR.LOW:t.edgeDetectionThreshold=.15,n.orthogonalSearchSteps=4,n.diagonalDetection=!1,n.cornerDetection=!1;break;case lR.MEDIUM:t.edgeDetectionThreshold=.1,n.orthogonalSearchSteps=8,n.diagonalDetection=!1,n.cornerDetection=!1;break;case lR.HIGH:t.edgeDetectionThreshold=.1,n.orthogonalSearchSteps=16,n.diagonalSearchSteps=8,n.cornerRounding=25,n.diagonalDetection=!0,n.cornerDetection=!0;break;case lR.ULTRA:t.edgeDetectionThreshold=.05,n.orthogonalSearchSteps=32,n.diagonalSearchSteps=16,n.cornerRounding=25,n.diagonalDetection=!0,n.cornerDetection=!0}}setDepthTexture(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Fe;this.edgeDetectionMaterial.depthBuffer=e,this.edgeDetectionMaterial.depthPacking=t}update(e,t,n){this.clearPass.render(e,this.renderTargetEdges),this.edgeDetectionPass.render(e,t,this.renderTargetEdges),this.weightsPass.render(e,this.renderTargetEdges,this.renderTargetWeights)}setSize(e,t){this.edgeDetectionMaterial.setSize(e,t),this.weightsMaterial.setSize(e,t),this.renderTargetEdges.setSize(e,t),this.renderTargetWeights.setSize(e,t)}dispose(){let{searchTexture:e,areaTexture:t}=this.weightsMaterial;null!==e&&null!==t&&(e.dispose(),t.dispose()),super.dispose()}static get searchImageDataURL(){return aR}static get areaImageDataURL(){return oR}},hR={DEFAULT:0,ESKIL:1},uR=class extends UI{constructor(){let{blendFunction:e=BI.NORMAL,technique:t=hR.DEFAULT,eskil:n=!1,offset:i=.5,darkness:r=.5}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super("VignetteEffect","uniform float offset;uniform float darkness;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){const vec2 center=vec2(0.5);vec3 color=inputColor.rgb;\n#if VIGNETTE_TECHNIQUE == 0\nfloat d=distance(uv,center);color*=smoothstep(0.8,offset*0.799,d*(darkness+offset));\n#else\nvec2 coord=(uv-center)*vec2(offset);color=mix(color,vec3(1.0-darkness),dot(coord,coord));\n#endif\noutputColor=vec4(color,inputColor.a);}",{blendFunction:e,defines:new Map([["VIGNETTE_TECHNIQUE",t.toFixed(0)]]),uniforms:new Map([["offset",new fc(i)],["darkness",new fc(r)]])})}get technique(){return Number(this.defines.get("VIGNETTE_TECHNIQUE"))}set technique(e){this.technique!==e&&(this.defines.set("VIGNETTE_TECHNIQUE",e.toFixed(0)),this.setChanged())}get eskil(){return this.technique===hR.ESKIL}set eskil(e){this.technique=e?hR.ESKIL:hR.DEFAULT}getTechnique(){return this.technique}setTechnique(e){this.technique=e}get offset(){return this.uniforms.get("offset").value}set offset(e){this.uniforms.get("offset").value=e}getOffset(){return this.offset}setOffset(e){this.offset=e}get darkness(){return this.uniforms.get("darkness").value}set darkness(e){this.uniforms.get("darkness").value=e}getDarkness(){return this.darkness}setDarkness(e){this.darkness=e}};new Float32Array(3),new Float32Array(3),new Float32Array(3),new Float32Array(3),new Float32Array(3),new Float32Array(3),new Float32Array([0,0,0]),new Float32Array([1,0,0]),new Float32Array([1,1,0]),new Float32Array([1,1,1]),new Float32Array([0,0,0]),new Float32Array([1,0,0]),new Float32Array([1,0,1]),new Float32Array([1,1,1]),new Float32Array([0,0,0]),new Float32Array([0,0,1]),new Float32Array([1,0,1]),new Float32Array([1,1,1]),new Float32Array([0,0,0]),new Float32Array([0,1,0]),new Float32Array([1,1,0]),new Float32Array([1,1,1]),new Float32Array([0,0,0]),new Float32Array([0,1,0]),new Float32Array([0,1,1]),new Float32Array([1,1,1]),new Float32Array([0,0,0]),new Float32Array([0,0,1]),new Float32Array([0,1,1]),new Float32Array([1,1,1]),new Float32Array(2),new Float32Array(2),new Float32Array([0,-.25,.25,-.125,.125,-.375,.375]),new Float32Array([0,0]),new Float32Array([.25,-.25]),new Float32Array([-.25,.25]),new Float32Array([.125,-.125]),new Float32Array([-.125,.125]),new Uint8Array([0,0]),new Uint8Array([3,0]),new Uint8Array([0,3]),new Uint8Array([3,3]),new Uint8Array([1,0]),new Uint8Array([4,0]),new Uint8Array([1,3]),new Uint8Array([4,3]),new Uint8Array([0,1]),new Uint8Array([3,1]),new Uint8Array([0,4]),new Uint8Array([3,4]),new Uint8Array([1,1]),new Uint8Array([4,1]),new Uint8Array([1,4]),new Uint8Array([4,4]),new Uint8Array([0,0]),new Uint8Array([1,0]),new Uint8Array([0,2]),new Uint8Array([1,2]),new Uint8Array([2,0]),new Uint8Array([3,0]),new Uint8Array([2,2]),new Uint8Array([3,2]),new Uint8Array([0,1]),new Uint8Array([1,1]),new Uint8Array([0,3]),new Uint8Array([1,3]),new Uint8Array([2,1]),new Uint8Array([3,1]),new Uint8Array([2,3]),new Uint8Array([3,3]),new Map([[pR(0,0,0,0),new Float32Array([0,0,0,0])],[pR(0,0,0,1),new Float32Array([0,0,0,1])],[pR(0,0,1,0),new Float32Array([0,0,1,0])],[pR(0,0,1,1),new Float32Array([0,0,1,1])],[pR(0,1,0,0),new Float32Array([0,1,0,0])],[pR(0,1,0,1),new Float32Array([0,1,0,1])],[pR(0,1,1,0),new Float32Array([0,1,1,0])],[pR(0,1,1,1),new Float32Array([0,1,1,1])],[pR(1,0,0,0),new Float32Array([1,0,0,0])],[pR(1,0,0,1),new Float32Array([1,0,0,1])],[pR(1,0,1,0),new Float32Array([1,0,1,0])],[pR(1,0,1,1),new Float32Array([1,0,1,1])],[pR(1,1,0,0),new Float32Array([1,1,0,0])],[pR(1,1,0,1),new Float32Array([1,1,0,1])],[pR(1,1,1,0),new Float32Array([1,1,1,0])],[pR(1,1,1,1),new Float32Array([1,1,1,1])]]);function dR(e,t,n){return e+(t-e)*n}function pR(e,t,n,i){let r=dR(e,t,.75),s=dR(n,i,.75);return dR(r,s,.875)}var fR=class{constructor(e,t){this.enabled=!1,this.effect=new e(t),Object.defineProperty(this,"opacity",{enumerable:!0,set(e){this.effect.blendMode.opacity.value=e},get(){return this.effect.blendMode.opacity.value}}),Object.defineProperty(this,"blendFunction",{enumerable:!0,set(e){this.effect.blendMode.setBlendFunction(Number(e))},get(){return this.effect.blendMode.blendFunction}}),this.blendFunction=BI.NORMAL}},mR=class extends fR{constructor(){super(JI),this.blendFunction=BI.SCREEN}set intensity(e){this.effect.intensity=e}get intensity(){return this.effect.intensity}set luminanceThreshold(e){this.effect.luminanceMaterial.threshold=e}get luminanceThreshold(){return this.effect.luminanceMaterial.threshold}set luminanceSmoothing(e){this.effect.luminanceMaterial.smoothing=e}get luminanceSmoothing(){return this.effect.luminanceMaterial.smoothing}set blurScale(e){this.effect.blurPass.scale=e}get blurScale(){return this.effect.blurPass.scale}set kernelSize(e){this.effect.blurPass.kernelSize=e}get kernelSize(){return this.effect.blurPass.kernelSize}},gR=class extends fR{constructor(){super($I)}set contrast(e){this.effect.uniforms.get("contrast").value=e}get contrast(){return this.effect.uniforms.get("contrast").value}set brightness(e){this.effect.uniforms.get("brightness").value=e}get brightness(){return this.effect.uniforms.get("brightness").value}},vR=class extends fR{constructor(){super(tR),this.effect.offset=new ot(.01,.01)}set offset(e){this.effect.offset.set(e[0]/1e3,e[1]/1e3)}get offset(){return[1e3*this.effect.offset.x,1e3*this.effect.offset.y]}},yR=class extends fR{constructor(){super(eR)}},bR=class extends fR{constructor(){super(iR),this._hue=0}set hue(e){this._hue=e,this.effect.setHue(e)}get hue(){return this._hue}set saturation(e){this.effect.uniforms.get("saturation").value=e}get saturation(){return this.effect.uniforms.get("saturation").value}},xR=class extends fR{constructor(){super(rR),this.blendFunction=BI.OVERLAY}},wR=class extends fR{constructor(){super(uR)}get eskil(){return this.effect.eskil}set eskil(e){this.effect.eskil=e}get darkness(){return this.effect.uniforms.get("darkness").value}set darkness(e){this.effect.uniforms.get("darkness").value=e}get offset(){return this.effect.uniforms.get("offset").value}set offset(e){this.effect.uniforms.get("offset").value=e}},SR=class extends fR{constructor(e){super(nR)}set focalLength(e){this.effect.circleOfConfusionMaterial.uniforms.focalLength.value=e/2e3}get focalLength(){return this.effect.circleOfConfusionMaterial.uniforms.focalLength.value}set focusDistance(e){this.effect.circleOfConfusionMaterial.uniforms.focusDistance.value=this.isPerspectiveCamera?e/2e3:(e+992)/2e3}get focusDistance(){return this.effect.circleOfConfusionMaterial.uniforms.focusDistance.value}get bokehScale(){return this.effect.bokehScale}set bokehScale(e){this.effect.bokehScale=e}setCamera(e){let t=!1;(e.isPerspectiveCamera&&!1===this.isPerspectiveCamera||!e.isPerspectiveCamera&&!0===this.isPerspectiveCamera)&&(t=!0),e.isPerspectiveCamera?(this.effect.circleOfConfusionMaterial.adoptCameraSettings(e.perspCamera),this.isPerspectiveCamera=!0):(this.effect.circleOfConfusionMaterial.adoptCameraSettings(e),this.isPerspectiveCamera=!1),t&&this.effect.setChanged()}},_R=class extends fR{constructor(){super(sR)}get granularity(){return this.effect.getGranularity()}set granularity(e){this.effect.setGranularity(e)}},ER=class extends Ri{constructor(){super({name:"PassthroughMaterial",uniforms:{inputBuffer:new fc(null)},blending:0,depthWrite:!1,depthTest:!1,vertexShader:"#define GLSLIFY 1\nvarying vec2 vUv;void main(){gl_Position=vec4(position.xy,1.0,1.0);vUv=position.xy*0.5+0.5;}",fragmentShader:"#define GLSLIFY 1\nlayout(location=1)out vec4 gVelocity;varying vec2 vUv;uniform sampler2D inputBuffer;void main(){gl_FragColor=texture2D(inputBuffer,vUv);gVelocity=vec4(0.0);}"})}set inputBuffer(e){this.uniforms.inputBuffer.value=e}},AR=class extends AI{constructor(){super("TAAResolvePass"),this.MRTCompatible=!0,this.needsSwap=!1,this.passThroughMaterial=new ER,this.resolutionVector=new ot,this.resolveMaterial=new Ri({name:"TAAResolveMaterial",uniforms:{inputBuffer:new fc(null),historyBuffer:new fc(null),velocityBuffer:new fc(null),depthBuffer:new fc(null),resolution:new fc(new ot)},blending:0,depthWrite:!1,depthTest:!1,vertexShader:"#define GLSLIFY 1\nvarying vec2 vUv;varying vec2 vTexCoords[9];uniform vec2 resolution;void main(){vUv=position.xy*0.5+0.5;vec2 texelSize=vec2(1.0)/resolution;vTexCoords[0]=vUv+vec2(-texelSize.x,-texelSize.y);vTexCoords[1]=vUv+vec2(0.0,-texelSize.y);vTexCoords[2]=vUv+vec2(texelSize.x,-texelSize.y);vTexCoords[3]=vUv+vec2(-texelSize.x,0.0);vTexCoords[4]=vUv+vec2(0.0,0.0);vTexCoords[5]=vUv+vec2(texelSize.x,0.0);vTexCoords[6]=vUv+vec2(-texelSize.x,texelSize.y);vTexCoords[7]=vUv+vec2(0.0,texelSize.y);vTexCoords[8]=vUv+vec2(texelSize.x,texelSize.y);gl_Position=vec4(position.xy,1.0,1.0);}",fragmentShader:"#define GLSLIFY 1\n#include <common>\nvarying vec2 vUv;varying vec2 vTexCoords[9];uniform sampler2D inputBuffer;uniform sampler2D historyBuffer;uniform sampler2D velocityBuffer;uniform sampler2D depthBuffer;uniform vec2 resolution;\n#define USE_YCOCG\n#define USE_CATMULL_ROM\nconst float feedback_min=0.5;const float feedback_max=0.95;vec3 RGB_YCoCg(vec3 c){return vec3(c.x/4.0+c.y/2.0+c.z/4.0,c.x/2.0-c.z/2.0,-c.x/4.0+c.y/2.0-c.z/4.0);}vec3 YCoCg_RGB(vec3 c){return clamp(vec3(c.x+c.y-c.z,c.x+c.z,c.x-c.y-c.z),vec3(0.0),vec3(1.0));}vec4 sample_color(sampler2D tex,vec2 uv){\n#ifdef USE_YCOCG\nvec4 c=texture(tex,uv);return vec4(RGB_YCoCg(c.rgb),c.a);\n#else\nreturn texture(tex,uv);\n#endif\n}vec4 sample_catmull_rom(sampler2D tex,vec2 uv,vec2 texSize){vec2 samplePos=uv*texSize;vec2 texPos1=floor(samplePos-0.5)+0.5;vec2 f=samplePos-texPos1;vec2 w0=f*(-0.5+f*(1.0-0.5*f));vec2 w1=1.0+f*f*(-2.5+1.5*f);vec2 w2=f*(0.5+f*(2.0-1.5*f));vec2 w3=f*f*(-0.5+0.5*f);vec2 w12=w1+w2;vec2 offset12=w2/(w1+w2);vec2 texPos0=texPos1-1.0;vec2 texPos3=texPos1+2.0;vec2 texPos12=texPos1+offset12;texPos0/=texSize;texPos3/=texSize;texPos12/=texSize;vec4 result=vec4(0.0);result+=texture2D(tex,vec2(texPos12.x,texPos0.y))*w12.x*w0.y;result+=texture2D(tex,vec2(texPos0.x,texPos12.y))*w0.x*w12.y;result+=texture2D(tex,vec2(texPos12.x,texPos12.y))*w12.x*w12.y;result+=texture2D(tex,vec2(texPos3.x,texPos12.y))*w3.x*w12.y;result+=texture2D(tex,vec2(texPos12.x,texPos3.y))*w12.x*w3.y;return result;}vec3 choose_motion_vector(){\n#ifdef CHOOSE_LONGEST_MOTION_VECTOR\nfloat longest=-1.0;vec3 v_choose=vec3(-1.0);for(int i=0;i<9;i++){vec3 v=texture2D(velocityBuffer,vTexCoords[i]).rgb;float l=length(v.xy);if(l>longest){longest=l;v_choose=v;}}return v_choose;\n#else\nfloat closest_depth=1000.0;vec2 closest_uv_offset=vec2(0.0);for(int i=0;i<9;i++){float neighbor_depth=texture2D(depthBuffer,vTexCoords[i]).r;if(neighbor_depth<closest_depth){closest_uv_offset=vTexCoords[i];closest_depth=neighbor_depth;}}return texture2D(velocityBuffer,closest_uv_offset).rgb;\n#endif\n}vec4 clipAabb(vec3 aabb_min,vec3 aabb_max,vec4 avg,vec4 input_texel){const float FLT_EPS=0.00000001;vec3 p_clip=0.5*(aabb_max+aabb_min);vec3 e_clip=0.5*(aabb_max-aabb_min)+FLT_EPS;vec4 v_clip=input_texel-vec4(p_clip,avg.w);vec3 v_unit=v_clip.xyz/e_clip;vec3 a_unit=abs(v_unit);float ma_unit=max(a_unit.x,max(a_unit.y,a_unit.z));if(ma_unit>1.0){return vec4(p_clip,avg.w)+v_clip/ma_unit;}else{return input_texel;}}vec3 clip_aabb_variance(in vec3 cOld,in vec3 cNew,in vec3 centre,in vec3 halfSize){if(all(lessThanEqual(abs(cOld-centre),halfSize))){return cOld;}vec3 dir=(cNew-cOld);vec3 near=centre-sign(dir)*halfSize;vec3 tAll=(near-cOld)/dir;float t=0.0001;for(int i=0;i<3;i++){if(tAll[i]>=0.0&&tAll[i]<t){t=tAll[i];}}if(t>=0.0001){return cOld;}return cOld+dir*t;}void main(){vec3 v=choose_motion_vector();vec2 velocity=v.rg;vec2 previousPixelPos=vUv-velocity;vec4 currentColor=sample_color(inputBuffer,vUv);\n#ifdef USE_CATMULL_ROM\nvec4 previousColor=sample_catmull_rom(historyBuffer,previousPixelPos,resolution);\n#else\nvec4 previousColor=sample_color(historyBuffer,previousPixelPos);\n#endif\n#ifdef USE_YCOCG\npreviousColor=vec4(RGB_YCoCg(previousColor.rgb),previousColor.a);\n#endif\nvec4 ctl=sample_color(inputBuffer,vTexCoords[0]);vec4 ctc=sample_color(inputBuffer,vTexCoords[1]);vec4 ctr=sample_color(inputBuffer,vTexCoords[2]);vec4 cml=sample_color(inputBuffer,vTexCoords[3]);vec4 cmc=sample_color(inputBuffer,vTexCoords[4]);vec4 cmr=sample_color(inputBuffer,vTexCoords[5]);vec4 cbl=sample_color(inputBuffer,vTexCoords[6]);vec4 cbc=sample_color(inputBuffer,vTexCoords[7]);vec4 cbr=sample_color(inputBuffer,vTexCoords[8]);vec4 cmin=min(ctl,min(ctc,min(ctr,min(cml,min(cmc,min(cmr,min(cbl,min(cbc,cbr))))))));vec4 cmax=max(ctl,max(ctc,max(ctr,max(cml,max(cmc,max(cmr,max(cbl,max(cbc,cbr))))))));vec4 cavg=(ctl+ctc+ctr+cml+cmc+cmr+cbl+cbc+cbr)/9.0;vec4 cmin5=min(ctc,min(cml,min(cmc,min(cmr,cbc))));vec4 cmax5=max(ctc,max(cml,max(cmc,max(cmr,cbc))));vec4 cavg5=(ctc+cml+cmc+cmr+cbc)/5.0;cmin=0.5*(cmin+cmin5);cmax=0.5*(cmax+cmax5);cavg=0.5*(cavg+cavg5);\n#ifdef USE_YCOCG\nvec2 chroma_extent=vec2(0.25*0.5*(cmax.r-cmin.r));vec2 chroma_center=currentColor.gb;cmin.yz=chroma_center-chroma_extent;cmax.yz=chroma_center+chroma_extent;cavg.yz=chroma_center;\n#endif\nvec4 previousColorClipped=clamp(previousColor,cmin,cmax);\n#ifdef LUMINANCE_DIFFERENCES\n#ifdef USE_YCOCG\nfloat lum0=currentColor.r;float lum1=previousColorClipped.r;\n#else\nfloat lum0=luminance(currentColor.rgb);float lum1=luminance(previousColorClipped.rgb);\n#endif\nfloat unbiased_diff=abs(lum0-lum1)/max(lum0,max(lum1,0.2));float unbiased_weight=1.0-unbiased_diff;float unbiased_weight_sqr=unbiased_weight*unbiased_weight;float k_feedback=mix(feedback_min,feedback_max,unbiased_weight_sqr);vec4 result=mix(currentColor,previousColorClipped,vec4(k_feedback));\n#else\nconst float alpha=0.1;vec4 result=mix(currentColor,previousColorClipped,1.0-alpha);\n#endif\n#ifdef USE_YCOCG\ngl_FragColor=vec4(YCoCg_RGB(result.rgb).rgb,result.a);\n#else\ngl_FragColor=result;\n#endif\n}"}),this.historyRenderTarget=new It(1024,1024,{minFilter:ue,stencilBuffer:!1,depthBuffer:!1}),this.historyRenderTarget.texture.name="TAA.History",this.resultRenderTarget=new It(1024,1024,{minFilter:ue,stencilBuffer:!1,depthBuffer:!1}),this.resultRenderTarget.texture.name="TAA.Output"}setSize(e,t){this.historyRenderTarget.setSize(e,t),this.resultRenderTarget.setSize(e,t)}render(e,t){this.fullscreenMaterial=this.resolveMaterial,this.resolveMaterial.uniforms.inputBuffer.value=t.texture[0],this.resolveMaterial.uniforms.velocityBuffer.value=t.texture[1],this.resolveMaterial.uniforms.depthBuffer.value=t.depthTexture,this.resolveMaterial.uniforms.historyBuffer.value=this.historyRenderTarget.texture,this.resolveMaterial.uniforms.resolution.value.set(t.width,t.height),e.setRenderTarget(this.resultRenderTarget),e.render(this.scene,this.camera),this.fullscreenMaterial=this.passThroughMaterial,this.passThroughMaterial.inputBuffer=this.resultRenderTarget.texture,e.setRenderTarget(this.historyRenderTarget),e.render(this.scene,this.camera);let n=this.renderToScreen?null:t;this.fullscreenMaterial=this.passThroughMaterial,this.passThroughMaterial.inputBuffer=this.resultRenderTarget.texture,e.setRenderTarget(n),e.render(this.scene,this.camera)}dispose(){this.resultRenderTarget.dispose(),this.historyRenderTarget.dispose(),this.resolveMaterial.dispose(),this.passThroughMaterial.dispose()}},CR=class extends AI{constructor(e,t,n){super("TransmissionPass",void 0,t),this.MRTCompatible=!0,this.depthPass=new LI(e,t,{renderTarget:n.transmissionDepthTarget}),this.passThroughMaterial=new ER,this.splineScene=e,this.needsSwap=!1}updatePasses(e){this.passThroughMaterial=new ER,this.depthPass=new LI(this.splineScene,this.camera,{renderTarget:e.transmissionDepthTarget})}setCamera(e){this.camera=e}setScene(e){this.splineScene=e}render(e,t,n){let i=this.camera.layers.mask,r=e;r.setRenderTarget(r.transmissionRenderTarget),this.fullscreenMaterial=this.passThroughMaterial,this.passThroughMaterial.inputBuffer=t.texture[0],r.clear(),r.render(this.scene,this.camera),this.camera.layers.disable(3),this.depthPass.render(e,t,n),r.shadowMap.needsUpdate=!1,r.shadowMap.autoUpdate=!1;let s=this.renderToScreen?null:t;this.camera.layers.set(3),e.setRenderTarget(s),e.render(this.splineScene,this.camera),this.camera.layers.mask=i}},MR=new Ca,TR=new Ri({transparent:!0,vertexShader:"\n        void main() {\n            gl_Position = vec4(0.0);\n        }\n    ",fragmentShader:"\n        layout(location = 1) out vec4 gVelocity;\n\n        void main() {\n            gl_FragColor = vec4(0.0);\n\t\t\tgVelocity = vec4(0.0);\n        }\n    "}),PR=class extends AI{constructor(e,t,n){super("OpaquePass",null!==t&&void 0!==t?t:MR,n),this.MRTCompatible=!0,this.originalMaterials=[],this.hasTransmissionPass=!1,this.clear=!0,this.clearColorOnly=!1,this.clearDepth=!1,this.needsSwap=!1,this.MRTCompatible=e}setCamera(e){this.camera=e}setScene(e){this.scene=null!==e&&void 0!==e?e:MR}getScene(){return this.scene}render(e,t){this.camera.layers.enable(3),this.hasTransmissionPass&&(this.originalMaterials.length=0,this.scene.traverse((e=>{e.layers.isEnabled(3)&&e instanceof UC&&(this.originalMaterials.push([e,e.material]),e.material=TR)})),e.shadowMap.needsUpdate=!0,e.shadowMap.autoUpdate=!0),this.camera.layers.enable(8);let n=this.renderToScreen?null:t;e.setRenderTarget(n),this.clearColorOnly&&e.clear(!0,!1,!0),this.clear&&e.clear(),e.render(this.scene,this.camera),this.clearDepth&&e.clear(!1,!0,!1),this.hasTransmissionPass&&this.originalMaterials.forEach((e=>{e[0].material=e[1]}))}},DR=class{constructor(e){let{depthBuffer:t=!0,stencilBuffer:n=!1,multisampling:i=0,frameBufferType:r=0}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.renderer=e,this.helperStartIndex=0,this.copyPass=new CI,this.depthTexture=null,this.timer=new KI,this._width=1,this._height=1,this.passes=[],this.helperPasses=[],this.autoRenderToScreen=!0,this.inputBuffer=this.createBuffer(t,n,r,i,!0,"input buffer mrt"),this.inputBufferSingle=this.createBuffer(t,n,r,i,!1," input buffer single"),this.inputBufferSingle.texture.dispose(),this.inputBufferSingle.depthTexture.dispose(),this.inputBufferSingle.texture=this.inputBuffer.texture[0],this.inputBufferSingle.depthTexture=this.inputBuffer.depthTexture,this.outputBuffer=this.inputBuffer.clone(),this.outputBuffer.name="output buffer mrt",this.outputBufferSingle=this.createBuffer(t,n,r,i,!1,"output buffer single"),this.outputBufferSingle.texture.dispose(),this.outputBufferSingle.depthTexture.dispose(),this.outputBufferSingle.texture=this.outputBuffer.texture[0],this.outputBufferSingle.depthTexture=this.outputBuffer.depthTexture,this.setRenderer(e)}get multisampling(){return this.inputBuffer.samples||0}set multisampling(e){let t=this.inputBuffer,n=this.multisampling;n>0&&e>0?(this.inputBuffer.samples=e,this.outputBuffer.samples=e,this.inputBuffer.dispose(),this.outputBuffer.dispose()):n!==e&&(this.inputBuffer.dispose(),this.outputBuffer.dispose(),console.log("creating new input buffer"),this.inputBuffer=this.createBuffer(t.depthBuffer,t.stencilBuffer,t.texture.type,e,!0,"new input buffer"),this.inputBuffer.depthTexture=this.depthTexture,this.outputBuffer=this.inputBuffer.clone())}getTimer(){return this.timer}getRenderer(){return this.renderer}setRenderer(e){if(this.renderer=e,null!==e){var t,n;let i=e.getSize(new ot),r=null!==(t=null===(n=e.getContext().getContextAttributes())||void 0===n?void 0:n.alpha)&&void 0!==t&&t,s=this.inputBuffer.texture[0].type;s===fe&&e.outputEncoding===Ne&&(this.inputBuffer.texture[0].encoding=Ne,this.outputBuffer.texture[0].encoding=Ne,this.inputBuffer.dispose(),this.outputBuffer.dispose(),console.log("doing some kinda dispose??")),e.autoClear=!1,this.setSize(i.width,i.height,!1);for(let t of this.passes)t.initialize(e,r,s)}}replaceRenderer(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=this.renderer,i=n.domElement.parentNode;return this.setRenderer(e),t&&null!==i&&(i.removeChild(n.domElement),i.appendChild(e.domElement)),n}createDepthTexture(){let e=this.depthTexture=new xa(this._width,this._height);return this.inputBuffer.depthTexture=e,this.inputBuffer.stencilBuffer?(e.format=we,e.type=ye):e.type=me,e}deleteDepthTexture(){if(null!==this.depthTexture){this.depthTexture.dispose(),this.depthTexture=null,this.inputBuffer.depthTexture=null,this.inputBuffer.dispose();for(let e of this.passes)e.setDepthTexture(null)}}createBuffer(e,t,n,i,r,s){let a,o=this.renderer,l=null===o?new ot:o.getDrawingBufferSize(new ot),c={minFilter:ue,magFilter:ue,wrapS:ae,wrapT:ae,stencilBuffer:t,depthBuffer:e};return i>0?(a=new It(l.width,l.height,c),a.samples=i):(r?(a=new kt(l.width,l.height,2,c),a.texture[1].type=ve):a=new It(l.width,l.height,c),a.depthTexture=new xa(2048,2048),a.depthTexture.type=ge),n===fe&&null!==o&&o.outputEncoding===Ne&&(Array.isArray(a.texture)?a.texture.forEach((e=>e.encoding=Ne)):a.texture.encoding=Ne),Array.isArray(a.texture)?a.texture.forEach(((e,t)=>{e.name="EffectComposer.Buffer ".concat(r," ").concat(t),e.generateMipmaps=!1})):(a.texture.name="EffectComposer.Buffer ".concat(r),a.texture.generateMipmaps=!1),a.name=s,a}addPass(e,t){var n,i;let r,s=this.passes,a=this.renderer,o=a.getDrawingBufferSize(new ot),l=null!==(n=null===(i=a.getContext().getContextAttributes())||void 0===i?void 0:i.alpha)&&void 0!==n&&n;if(e.MRTCompatible&&(r=this.inputBuffer.texture[0].type),e.MRTCompatible||(r=this.inputBuffer.texture.type),e.setRenderer(a),e.setSize(o.width,o.height),e.initialize(a,l,r),this.autoRenderToScreen&&(s.length>0&&(s[s.length-1].renderToScreen=!1),e.renderToScreen&&(this.autoRenderToScreen=!1)),void 0!==t?s.splice(t,0,e):s.push(e),this.autoRenderToScreen&&(s[s.length-1].renderToScreen=!0),e.needsDepthTexture||null!==this.depthTexture)if(null===this.depthTexture){let t=this.createDepthTexture();for(e of s)e.setDepthTexture(t)}else e.setDepthTexture(this.depthTexture)}setHelperStartIndex(e){this.helperStartIndex=e}removePass(e){let t=this.passes,n=t.indexOf(e);if(-1!==n&&t.splice(n,1).length>0){if(null!==this.depthTexture){let n=(e,t)=>e||t.needsDepthTexture;t.reduce(n,!1)||e.getDepthTexture()===this.depthTexture&&e.setDepthTexture(null)}this.autoRenderToScreen&&n===t.length&&(e.renderToScreen=!1,t.length>0&&(t[t.length-1].renderToScreen=!0))}}removeAllPasses(){let e=this.passes;e.length>0&&(this.autoRenderToScreen&&(e[e.length-1].renderToScreen=!1),this.passes=[])}render(e){let t,n,i,r,s=this.renderer,a=this.copyPass,o=this.inputBuffer,l=this.outputBuffer,c=this.inputBufferSingle,h=this.outputBufferSingle,u=!1;void 0===e&&(e=this.timer.update().getDelta());for(let d of this.passes)d.enabled&&(d.MRTCompatible?d.render(s,o,l,e,u):d.render(s,c,h,e,u),d.needsSwap&&(u&&(a.renderToScreen=d.renderToScreen,t=s.getContext(),n=s.state.buffers.stencil,n.setFunc(t.NOTEQUAL,1,4294967295),a.render(s,o,l,e,u),n.setFunc(t.EQUAL,1,4294967295)),i=o,r=c,o=l,c=h,l=i,h=r),d instanceof XI?u=!0:d instanceof MI&&(u=!1))}setSize(e,t,n){let i=this.renderer;if(this._width=e,this._height=t,void 0===e||void 0===t){let n=i.getSize(new ot);e=n.width,t=n.height}i.setSize(e,t,n);let r=i.getDrawingBufferSize(new ot);this.inputBuffer.setSize(r.width,r.height),this.outputBuffer.setSize(r.width,r.height),this.inputBufferSingle.setSize(r.width,r.height),this.outputBufferSingle.setSize(r.width,r.height);for(let s of this.passes)s.setSize(r.width,r.height)}reset(){let e=this.timer.isAutoResetEnabled();this.dispose(),this.autoRenderToScreen=!0,this.timer.setAutoResetEnabled(e)}dispose(){for(let e of this.passes)e.dispose();this.passes=[],null!==this.inputBuffer&&this.inputBuffer.dispose(),null!==this.outputBuffer&&this.outputBuffer.dispose(),null!==this.inputBufferSingle&&this.inputBufferSingle.dispose(),null!==this.outputBufferSingle&&this.outputBufferSingle.dispose(),this.deleteDepthTexture(),this.copyPass.dispose(),this.timer.dispose()}},OR=new Ri({name:"CombineMaterial",uniforms:{inputBufferA:new fc(null),inputBufferB:new fc(null)},blending:0,depthWrite:!1,depthTest:!1,vertexShader:"\nvarying vec2 vUv;\nvoid main() {\n    gl_Position = vec4(position.xy, 1.0, 1.0);\n    vUv = position.xy * 0.5 + 0.5;\n}\n",fragmentShader:"\n    varying vec2 vUv;\n    uniform sampler2D inputBufferA;\n    uniform sampler2D inputBufferB;\n\n    // TODO: Why do we need these when postpro of framemode is enabled???\n    layout(location = 1) out vec4 gVelocity;\n\n    void main() {\n\tvec4 resA = texture2D(inputBufferA, vUv);\n\tvec4 resB = texture2D(inputBufferB, vUv);\n    float a = resA.a + resB.a * ( 1.0 - resA.a );\n\n\tvec4 res;\n\tres.rgb =  resA.rgb + (resB.rgb * (1.0 - resA.a));\n\tres.a = resA.a + resB.a * (1.0 - resA.a);\n\tgl_FragColor = res;\n    gVelocity = vec4(0.0);\n    }\n"}),IR=class extends AI{constructor(e){super("HelperPass",void 0,e),this.MRTCompatible=!1,this.fullscreenMaterial=OR,this.helperPass=new PR(!1,void 0,this.camera),this.helperPass.hasTransmissionPass=!1,this.helperPass.clear=!1,this.helperPass.renderToScreen=!1,this.helperPassOnTop=new PR(!1,void 0,this.camera),this.helperPassOnTop.hasTransmissionPass=!1,this.helperPassOnTop.clear=!1,this.helperPassOnTop.renderToScreen=!1;let t=new cR({preset:lR.LOW,edgeDetectionMode:pI.COLOR});this.effectPass=new GI(this.camera,t),this.rt=new It(10,10,{minFilter:ue,magFilter:ue,wrapS:ae,wrapT:ae,depthBuffer:!0})}setSize(e,t){this.rt.setSize(e,t),this.effectPass.setSize(e,t)}set sceneHelpers(e){this.helperPass.setScene(e)}get sceneHelpers(){return this.helperPass.getScene()}set sceneHelpersOnTop(e){this.helperPassOnTop.setScene(e)}get sceneHelpersOnTop(){return this.helperPassOnTop.getScene()}setCamera(e){this.helperPass.setCamera(e),this.helperPassOnTop.setCamera(e)}initialize(e,t,n){super.initialize(e,t,n),this.effectPass.initialize(e,t,n)}dispose(){super.dispose(),this.rt.dispose(),this.effectPass.dispose()}render(e,t,n){this.rt.depthTexture=t.depthTexture;let i=e.getClearAlpha();e.setClearAlpha(0),this.helperPass.clearDepth=!0,this.helperPass.clearColorOnly=!0,this.helperPass.render(e,this.rt),this.helperPassOnTop.render(e,this.rt),this.effectPass.renderToScreen=!1,this.effectPass.render(e,this.rt,n),this.fullscreenMaterial.uniforms.inputBufferA.value=n.texture,this.fullscreenMaterial.uniforms.inputBufferB.value=t.texture,e.setClearAlpha(i),e.setRenderTarget(null),e.clear(),e.render(this.scene,this.camera)}},RR=[[.478712,.875764],[-.337956,-.793959],[-.955259,-.028164],[.864527,.325689],[.209342,-.395657],[-.106779,.672585],[.156213,.235113],[-.413644,-.082856],[-.415667,.323909],[.141896,-.93998],[.954932,-.182516],[-.766184,.410799],[-.434912,-.458845],[.415242,-.078724],[.728335,-.491777],[-.058086,-.066401],[.20299,.686837],[-.808362,-.556402],[.507386,-.640839],[-.723494,-.22924],[.48974,.317826],[-.622663,.765301],[-.01064,.929347],[.663146,.647618],[-.096674,-.413835],[.525945,-.321063],[-.122533,.366019],[.195235,-.687983],[-.563203,.098748],[.418563,.561335],[-.378595,.800367],[.826922,.001024],[-.085372,-.766651],[-.92192,.183673],[-.590008,-.721799],[.167751,-.164393],[.032961,-.56253],[.6329,-.107059],[-.46408,.569669],[-.173676,-.958758],[-.242648,-.234303],[-.275362,.157163],[.382295,-.795131],[.562955,.115562],[.190586,.470121],[.770764,-.297576],[.237281,.93105],[-.666642,-.455871],[-.905649,-.298379],[.33952,.157829],[.701438,-.7041],[-.062758,.160346],[-.220674,.957141],[.642692,.432706],[-.77339,-.015272],[-.671467,.24688],[.158051,.062859],[.806009,.527232],[-.05762,-.247071],[.333436,-.51671],[-.550658,-.315773],[-.652078,.589846],[.008818,.530556],[-.210004,.519896]],kR=new Ri({vertexShader:"#define GLSLIFY 1\n#include <skinning_pars_vertex>\n#include <morphtarget_pars_vertex>\nout vec3 n;void main(){\n#include <beginnormal_vertex>\n#include <morphnormal_vertex>\n#include <skinbase_vertex>\n#include <skinnormal_vertex>\n#include <defaultnormal_vertex>\n#include <begin_vertex>\n#include <morphtarget_vertex>\n#include <skinning_vertex>\nvec4 view_space=viewMatrix*modelMatrix*vec4(transformed,1.0);gl_Position=projectionMatrix*view_space;n=normalize(transformedNormal);}",fragmentShader:"#define GLSLIFY 1\nin vec3 n;void main(){gl_FragColor=vec4(n,1.0);}"}),LR=new Ri({vertexShader:"#define GLSLIFY 1\nout vec2 v_uv;void main(){gl_Position=vec4(position.xy,1.0,1.0);v_uv=uv;}",fragmentShader:"#define GLSLIFY 1\nin vec2 v_uv;uniform sampler2D texture_ao_lrez;uniform sampler2D texture_depth_lrez;uniform sampler2D texture_depth_hrez;uniform float near;uniform float far;float linearize_depth(float depth_sampled){float z=depth_sampled*2.0-1.0;return(2.0*near*far)/(far+near-z*(far-near));}vec2 nearest_depth_filter(in vec2 uv){vec2 resolution=vec2(textureSize(texture_depth_lrez,0));vec2 texel_size=1.0/resolution;vec2 offset=uv-0.5*texel_size;float d_hrez=texture(texture_depth_hrez,uv).r;float a=abs(d_hrez-texture(texture_depth_lrez,offset).r);float b=abs(d_hrez-texture(texture_depth_lrez,offset+vec2(texel_size.x,0.0)).r);float c=abs(d_hrez-texture(texture_depth_lrez,offset+vec2(0.0,texel_size.y)).r);float d=abs(d_hrez-texture(texture_depth_lrez,offset+vec2(texel_size.x,texel_size.y)).r);float min_diff=min(a,min(b,min(c,d)));if(min_diff==a)return offset;if(min_diff==b)return offset+vec2(texel_size.x,0.0);if(min_diff==c)return offset+vec2(0.0,texel_size.y);if(min_diff==d)return offset+vec2(texel_size.x,texel_size.y);}void main(){\n#ifdef DEBUG\nfloat d_lrez=texture(texture_depth_lrez,v_uv).r;float d_hrez=texture(texture_depth_hrez,v_uv).r;float output_d=mix(linearize_depth(d_lrez)/far,linearize_depth(d_hrez)/far,step(0.5,v_uv.x));gl_FragColor=vec4(vec3(output_d),1.0);\n#else\nvec2 filtered_uv=nearest_depth_filter(v_uv);vec4 ao=texture(texture_ao_lrez,filtered_uv);gl_FragColor=vec4(ao.rgb,1.0);gl_FragColor=ao;\n#endif\n}",uniforms:{texture_ao_lrez:new fc(null),texture_depth_lrez:new fc(null),texture_depth_hrez:new fc(null),near:new fc(null),far:new fc(null)}}),BR=class extends AI{constructor(e,t){super("AmbientOcclusionPass",void 0,t),this.fogEnabled=!1,this.fogNear=1,this.fogFar=1e3,this.frameIndex=0,this._runHalfRes=!0,this._width=1,this._height=1;let n=1024,i=1024;this.gBuffer=new It(n,i,{type:Om?ve:ge,depthTexture:new xa(n,i),minFilter:ue,magFilter:ue}),this.depthBufferHighRes=new It(n,i,{depthTexture:new xa(n,i)}),this.aoBuffer=new It(n,i,{minFilter:ue,magFilter:ue}),this.splineScene=e,this.splineCamera=t;let r=new Float32Array(2*RR.length);for(let a=0;a<RR.length;a++){let e=2*a;r[e+0]=RR[a][0],r[e+1]=RR[a][1]}this.blueNoiseInDiskTexture=new Oa(r,RR.length,1,_e,ge),this.blueNoiseInDiskTexture.wrapS=se,this.blueNoiseInDiskTexture.wrapT=se,this.blueNoiseInDiskTexture.needsUpdate=!0,this.hbaoMaterial=new Ri({vertexShader:"#define GLSLIFY 1\nout vec2 v_uv;void main(){v_uv=uv;gl_Position=vec4(position.xy,1.0,1.0);}",fragmentShader:"#define GLSLIFY 1\nin vec2 v_uv;const float pi=3.14159265;const float num_steps=4.0;const float num_directions=4.0;uniform float near;uniform float far;uniform float fov;uniform vec4 proj_info;uniform bool is_ortho;uniform vec2 resolution;uniform float radius_of_influence;uniform float radius_in_screen_space;uniform float exponent;uniform vec3 ao_color;uniform float bias;uniform sampler2D texture_depth;uniform sampler2D texture_normals;uniform sampler2D texture_blue_noise;uniform sampler2D texture_blue_noise_in_disk;uniform sampler2D texture_color_pass;uniform int frame_index;uniform bool fog_enabled;uniform float fog_near;uniform float fog_far;vec3 uv_to_view_space(vec2 uv,float eye_z){return vec3((uv*proj_info.xy+proj_info.zw)*(is_ortho ? 1.0 : eye_z),eye_z);}float linearize_depth(float depth_sampled){float z=is_ortho ? depth_sampled : depth_sampled*2.0-1.0;return mix((2.0*near*far)/(far+near-z*(far-near)),near+z*(far-near),float(is_ortho));}vec3 get_view_position(vec2 uv_coords){float linear_depth=linearize_depth(texture(texture_depth,uv_coords).x);return uv_to_view_space(uv_coords,linear_depth);}vec3 min_difference(vec3 p,vec3 right,vec3 left){vec3 v1=right-p;vec3 v2=p-left;return(dot(v1,v1)<dot(v2,v2))? v1 : v2;}vec3 rebuild_normal(in vec2 uv,in vec3 p){vec2 one_over_resolution=1.0/resolution;vec3 r=get_view_position(uv+vec2(one_over_resolution.x,0));vec3 l=get_view_position(uv+vec2(-one_over_resolution.x,0));vec3 t=get_view_position(uv+vec2(0,one_over_resolution.y));vec3 b=get_view_position(uv+vec2(0,-one_over_resolution.y));return normalize(cross(min_difference(p,r,l),min_difference(p,t,b)));}float falloff(float distance_squared){float neg_inv_r2=-1.0/(radius_of_influence*radius_of_influence);return distance_squared*neg_inv_r2+1.0;}float ao_contribution(vec3 P,vec3 N,vec3 S){vec3 to_sample=S-P;float norm_squared=dot(to_sample,to_sample);float norm=sqrt(norm_squared);float cos_theta=dot(N,to_sample)/norm;return clamp(cos_theta-bias,0.0,1.0)*clamp(falloff(norm_squared),0.0,1.0);}float compute_ambient_occlusion(vec2 uv,float radius_in_screen_space,vec3 pc,vec3 view_space_n){vec2 one_over_resolution=1.0/resolution;ivec2 noise_uv=ivec2(int(mod(gl_FragCoord.x,128.0)),int(mod(gl_FragCoord.y,128.0)));float noise=texelFetch(texture_blue_noise,noise_uv,0).r;noise=fract(noise+0.61803398875*float(frame_index));float theta=noise*2.0*3.1415;float ct=cos(theta);float st=sin(theta);float step_size=radius_in_screen_space/(num_steps+1.0);const float angle_step=2.0*pi/num_directions;float contribution=0.0;for(int i=0;i<int(num_directions);++i){float current_pixel=step_size+1.0;for(int j=0;j<int(num_steps);++j){int index=i*int(num_steps)+j;vec2 blue_noise_sample=texelFetch(texture_blue_noise_in_disk,ivec2(index,0),0).rg;vec2 disk_point;disk_point.x=blue_noise_sample.x*ct-blue_noise_sample.y*st;disk_point.y=blue_noise_sample.x*st+blue_noise_sample.y*ct;vec2 sample_direction=disk_point;vec2 snapped_uv=round(current_pixel*sample_direction)*one_over_resolution+uv;vec3 ps=get_view_position(snapped_uv);current_pixel+=step_size;contribution+=ao_contribution(pc,view_space_n,ps);}}float mult=1.0/(1.0-bias);contribution*=mult/(num_directions*num_steps);return clamp(1.0-contribution*2.0,0.0,1.0);}\n#define USE_GBUFFER_NORMALS\nvoid main(){vec3 view_space_p=get_view_position(v_uv);\n#ifdef USE_GBUFFER_NORMALS\nvec3 view_space_n=texture(texture_normals,v_uv).rgb;view_space_n.z*=-1.0;\n#else\nvec3 view_space_n=-rebuild_normal(v_uv,view_space_p);\n#endif\nfloat radius_ss=radius_in_screen_space/(is_ortho ? 1.0 : view_space_p.z);float ao=compute_ambient_occlusion(v_uv,radius_ss,view_space_p,view_space_n);float final=pow(ao,exponent);if(view_space_p.z>=far){final=1.0;}vec3 color=mix(ao_color,vec3(1.0),final);if(fog_enabled){float fog_factor=smoothstep(fog_near,fog_far,view_space_p.z);color=mix(color,vec3(1.0),fog_factor);}gl_FragColor=vec4(color,1.0);}",uniforms:{near:new fc(null),far:new fc(null),fov:new fc(null),proj_info:new fc(new Ot),is_ortho:new fc(!1),resolution:new fc(new ot),radius_of_influence:new fc(8),radius_in_screen_space:new fc(1),exponent:new fc(1),ao_color:new fc(new Bt),bias:new fc(.5),texture_depth:new fc(null),texture_normals:new fc(null),texture_blue_noise:new fc(null),texture_blue_noise_in_disk:new fc(this.blueNoiseInDiskTexture),frame_index:new fc(0),fog_enabled:new fc(!1),fog_near:new fc(1),fog_far:new fc(1e3)}}),this.radius=128,this.aoColor={r:0,g:0,b:0},this.bias=.5,this.hbaoMaterial.uniforms.texture_depth.value=this.gBuffer.depthTexture,this.hbaoMaterial.uniforms.texture_normals.value=this.gBuffer.texture,this.needsSwap=!0,this.aaBuffer=new It(n,i,{minFilter:ue,magFilter:ue,wrapS:ae,wrapT:ae,depthBuffer:!1,type:ge});let s=new cR({preset:lR.ULTRA,edgeDetectionMode:pI.COLOR});this.effectPass=new GI(this.camera,s)}initialize(e,t,n){super.initialize(e,t,n),this.effectPass.initialize(e,t,n)}setBlueNoiseTexture(e){this.hbaoMaterial.uniforms.texture_blue_noise.value=e}setSize(e,t){this._width=e,this._height=t,this.depthBufferHighRes.setSize(e,t);let n=this._runHalfRes?.5:1,i=e*n,r=t*n;this.gBuffer.setSize(i,r),this.aoBuffer.setSize(i,r),this.hbaoMaterial.uniforms.resolution.value.set(i,r),this.aaBuffer.setSize(i,r),this.effectPass.setSize(i,r)}get runHalfRes(){return this._runHalfRes}set runHalfRes(e){this._runHalfRes=e,this.setSize(this._width,this._height)}setCamera(e){this.splineCamera=e}setScene(e){this.splineScene=e}setDepthTexture(e){this.depthBufferHighRes.depthTexture=e,LR.uniforms.texture_depth_hrez.value=e,LR.needsUpdate=!0}render(e,t,n){this.splineScene.overrideMaterial=kR;let i=this.splineCamera.layers.mask;if(this.splineCamera.layers.set(5),e.setRenderTarget(this.gBuffer),e.clear(),e.render(this.splineScene,this.splineCamera),e.setRenderTarget(this.depthBufferHighRes),e.clear(),e.render(this.splineScene,this.splineCamera),this.splineScene.overrideMaterial=null,this.splineCamera.layers.mask=i,this.hbaoMaterial.uniforms.radius_of_influence.value=this.radius,this.hbaoMaterial.uniforms.ao_color.value.set(this.aoColor.r,this.aoColor.g,this.aoColor.b),this.hbaoMaterial.uniforms.bias.value=this.bias,this.hbaoMaterial.uniforms.fog_enabled.value=this.fogEnabled,this.hbaoMaterial.uniforms.fog_near.value=this.fogNear,this.hbaoMaterial.uniforms.fog_far.value=this.fogFar,this.hbaoMaterial.uniforms.frame_index.value=this.frameIndex,this.frameIndex++,this.splineCamera.isPerspectiveCamera){this.hbaoMaterial.uniforms.near.value=this.splineCamera.perspCamera.near,this.hbaoMaterial.uniforms.far.value=this.splineCamera.perspCamera.far;let e=this.splineCamera.perspCamera.projectionMatrix.elements,t=2/e[0],n=2/e[5],i=-(1-e[8])/e[0],r=-(1+e[9])/e[5];this.hbaoMaterial.uniforms.proj_info.value.set(t,n,i,r);let s=this.splineCamera.perspCamera.fov*(Math.PI/180),a=this.hbaoMaterial.uniforms.resolution.value.y/(2*Math.tan(.5*s)),o=.5*this.hbaoMaterial.uniforms.radius_of_influence.value*a;this.hbaoMaterial.uniforms.radius_in_screen_space.value=o,this.hbaoMaterial.uniforms.is_ortho.value=!1}else{this.hbaoMaterial.uniforms.near.value=this.splineCamera.orthoCamera.near,this.hbaoMaterial.uniforms.far.value=this.splineCamera.orthoCamera.far;let e=this.splineCamera.orthoCamera.projectionMatrix.elements,t=2/e[0],n=2/e[5],i=-(1+e[12])/e[0],r=-(1-e[13])/e[5];this.hbaoMaterial.uniforms.proj_info.value.set(t,n,i,r);let s=this.hbaoMaterial.uniforms.resolution.value.y/n*.5,a=this.hbaoMaterial.uniforms.radius_of_influence.value*s;this.hbaoMaterial.uniforms.radius_in_screen_space.value=a,this.hbaoMaterial.uniforms.is_ortho.value=!0}this.runHalfRes?(this.fullscreenMaterial=this.hbaoMaterial,e.setRenderTarget(this.aoBuffer),e.clear(),e.render(this.scene,this.camera),this.fullscreenMaterial=LR,LR.uniforms.texture_ao_lrez.value=this.aoBuffer.texture,LR.uniforms.texture_depth_lrez.value=this.gBuffer.depthTexture,LR.uniforms.texture_depth_hrez.value=this.depthBufferHighRes.depthTexture,e.setRenderTarget(e.aoRenderTarget),e.clear(),e.render(this.scene,this.camera)):(this.fullscreenMaterial=this.hbaoMaterial,e.setRenderTarget(this.aaBuffer),e.clear(),e.render(this.scene,this.camera),this.effectPass.renderToScreen=!1,this.effectPass.render(e,this.aaBuffer,e.aoRenderTarget))}dispose(){this.gBuffer.dispose(),this.depthBufferHighRes.dispose(),this.aoBuffer.dispose()}},zR=class extends YI{constructor(){super(new Ri({vertexShader:"\nvarying vec2 vUv;\nvoid main() {\n    vUv = uv;\n    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"\nuniform sampler2D tInput;\nuniform sampler2D tMap;\nuniform vec2 resolution;\nvarying vec2 vUv;\n\nuniform vec2 uResolution;\nuniform vec2 uCoords;\n\n// Draws a rectangle at center <st> with size <size>\nfloat rectangle(vec2 st, vec2 size) {\n    size = vec2(0.5) - size * 0.5;\n    vec2 uv = vec2(step(size.x, st.x), step(size.y, st.y));\n    uv *= vec2(step(size.x, 1.0 - st.x), step(size.y, 1.0 - st.y));\n\n    return uv.x * uv.y;\n}\n\nuniform vec2 uSize;\nuniform float uScale;\nuniform float uDPR;\nuniform float uCurrent;\nuniform vec3 uSceneColor;\n\nvoid main() {\n    vec2 screenUv = gl_FragCoord.xy / uResolution.xy;\n    screenUv *= 1.0 / uDPR;\n\n    vec2 center = vec2(0.5, -0.5);\n    vec2 outsideUv = screenUv;\n    outsideUv += center;\n    outsideUv -= uCoords.xy / uResolution.xy;\n    outsideUv = (outsideUv - 0.5) + 0.5;\n    outsideUv -= center;\n    vec2 s = (uSize / uResolution) * uScale;\n    float isOutside = 1.0 - rectangle(outsideUv, s);\n    \n    vec2 mid = vec2(0.5);\n    vec2 insideUv = (screenUv - mid + s * mid) / s;\n    vec4 background = texture2D(tInput, screenUv);\n    vec4 image = texture2D(tMap, insideUv);\n    gl_FragColor = mix(image, background, isOutside);\n}\n",uniforms:{tInput:new fc(null),tMap:new fc(null),uResolution:new fc(new ot),uSize:new fc(new ot),uCoords:new fc(new ot),uScale:new fc(1),uSceneColor:new fc(new Et(16711680)),uDPR:new fc(1),uCurrent:new fc(0)}}),"tInput"),this.needsSwap=!0}get uniforms(){return this.fullscreenMaterial.uniforms}get texture(){return this.uniforms.tMap.value}set texture(e){this.uniforms.tMap.value=e}},NR=[],FR=class extends YI{constructor(){super(new Ri({vertexShader:"\nvoid main() {\n    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"\nuniform sampler2D toScene;\nuniform sampler2D fromScene;\nuniform vec2 resolution;\n\nuniform vec2 uResolution;\nuniform float uDPR;\n\nuniform float mixRatio;\nuniform sampler2D tMixTexture;\nuniform int useTexture;\nuniform float threshold;\n\nvoid main() {\n\tvec2 screenUv = gl_FragCoord.xy / uResolution.xy;\n\tscreenUv *= 1.0 / uDPR;\n\n\tvec4 texel1 = texture2D( fromScene, screenUv );\n\tvec4 texel2 = texture2D( toScene, screenUv );\n\n\tif (useTexture==1) {\n\t\t\n\t\tvec4 transitionTexel = texture2D( tMixTexture, screenUv );\n\t\tfloat r = mixRatio * (1.0 + threshold * 2.0) - threshold;\n\t\tfloat mixf=clamp((transitionTexel.r - r)*(1.0/threshold), 0.0, 1.0);\n\t\t\n\t\tgl_FragColor = mix( texel1, texel2, mixf );\n\t} else {\n\t\t\n\t\tgl_FragColor = mix( texel1, texel2, mixRatio );\n\t\t\n\t}\n}\n",uniforms:{toScene:new fc(null),fromScene:new fc(null),uResolution:new fc(new ot),uDPR:new fc(1),mixRatio:new fc(0),threshold:new fc(.1),useTexture:new fc(0),tMixTexture:{value:NR[0]}}}),"toScene"),this.needsSwap=!0}get uniforms(){return this.fullscreenMaterial.uniforms}get texture(){return this.uniforms.fromScene.value}set texture(e){this.uniforms.fromScene.value=e}},UR=class extends YI{constructor(){super(new Ri({vertexShader:"\nvoid main() {\n    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"\nuniform sampler2D inputBuffer;\nuniform sampler2D blurredInputBuffer;\nuniform sampler2D overlay;\nuniform float blurIntensity;\n\nuniform vec2 uResolution;\nuniform float uDPR;\n\nvoid main() {\n\tvec2 screenUv = gl_FragCoord.xy / uResolution.xy;\n\tscreenUv *= 1.0 / uDPR;\n\n\tvec4 texel1 = texture2D( overlay, screenUv );\n\tvec4 texel2 = texture2D( inputBuffer, screenUv );\n\tvec4 texel3 = texture2D( blurredInputBuffer, screenUv );\n\n\tfloat blurMask2 = max(sign(texel1.a), 0.0) * blurIntensity;\n    gl_FragColor = mix( mix(texel2, texel3, blurMask2), texel1, texel1.a );\n}\n",uniforms:{inputBuffer:new fc(null),blurredInputBuffer:new fc(null),overlay:new fc(null),uResolution:new fc(new ot),uDPR:new fc(1),blurIntensity:new fc(0)}})),this._blurEnabled=!1,this.blurTarget=new It(1,1,{minFilter:ue,magFilter:ue,wrapS:ae,wrapT:ae}),this.blurPass=new WI({width:window.innerWidth,height:window.innerHeight,kernelSize:ZI.HUGE,resolutionScale:.25}),this.blurPass.renderToScreen=!1,this.uniforms.blurredInputBuffer.value=this.blurTarget.texture}get uniforms(){return this.fullscreenMaterial.uniforms}get texture(){return this.uniforms.overlay.value}set texture(e){this.uniforms.overlay.value=e}setResolution(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;this.uniforms.uResolution.value.set(e,t),this.uniforms.uDPR.value=n,this.blurPass.setSize(e,t),this.blurTarget.setSize(e,t),this.blurPass.setSize(e,t)}get uiCanvas(){return this._uiCanvas}set uiCanvas(e){this._uiCanvas=e,e.texture&&(this.uniforms.overlay.value=e.texture);let t=e.frame;if(t){let e=t.data.backgroundBlur,n=e.radius;this._blurEnabled=e.enabled,this.uniforms.blurIntensity.value=this._blurEnabled?1:0,this.blurPass.scale=n/3}}render(e,t,n,i,r){this._blurEnabled&&(this.blurPass.setDepthTexture(this.getDepthTexture()),this.blurPass.render(e,t,this.blurTarget,i,r)),super.render(e,t,n,i,r)}},jR=class extends YI{constructor(){super(new Ri({vertexShader:"\nvarying vec2 vUv;\nvoid main() {\n    vUv = uv;\n    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"\nuniform sampler2D tInput;\nuniform sampler2D tOverlayImage;\nvarying vec2 vUv;\nuniform vec2 uResolution;\nuniform vec2 uRightBottom;\nuniform vec2 uImageSize;\nuniform float uScale;\nuniform float uDPR;\n\nvec3 blendNormal(vec3 base, vec3 blend) {\n\treturn blend;\n}\n\nvec3 blendNormal(vec3 base, vec3 blend, float opacity) {\n\treturn (blendNormal(base, blend) * opacity + base * (1.0 - opacity));\n}\n\nvec4 drawFixedSizeImage(sampler2D image, vec2 screenUV, vec2 imageSize, vec2 imageCoords, vec2 screenSize, float dpr) {\n\tvec2 uv = (screenUV * screenSize * dpr - imageCoords) / (imageSize * dpr);\n\tif (uv.x < 0.0 || uv.x > 1.0 || uv.y < 0.0 || uv.y > 1.0) {\n\t\treturn vec4(0.0);\n\t}\n\treturn texture2D(image, uv);\n}\n\nvoid main() {\n    vec2 screenUV = gl_FragCoord.xy / (uResolution.xy * uDPR);\n\tvec2 imageCoords = vec2(uResolution.x * uDPR - uImageSize.x * uScale * uDPR - uRightBottom.x * uDPR, uRightBottom.y * uDPR);\n    vec4 background = texture2D(tInput, screenUV);\n    vec4 image = drawFixedSizeImage(tOverlayImage, screenUV, uImageSize * uScale, imageCoords, uResolution, uDPR);\n    gl_FragColor = vec4(blendNormal(background.rgb, image.rgb, image.a), max(background.a, image.a));\n}\n",uniforms:{tInput:new fc(null),tOverlayImage:new fc(null),uResolution:new fc(new ot),uImageSize:new fc(new ot),uRightBottom:new fc(new ot(20,20)),uScale:new fc(.25),uDPR:new fc(1)}}),"tInput")}get uniforms(){return this.fullscreenMaterial.uniforms}get texture(){return this.uniforms.tOverlayImage.value}set texture(e){this.uniforms.tOverlayImage.value=e,this.uniforms.uImageSize.value.set(e.image.width,e.image.height)}};function VR(e,t){return t&&t.enabled&&e.push(t.effect),e}var GR=e=>Object.values(BI).includes(e)?e:BI.NORMAL,HR=class extends qe{constructor(e,t){super(),this._needsDOFResize=t,this.postprocessingState=Fb.defaultData,this._scene=new Ca,this._camera=new jO,this.effects=new Map,this.blueNoiseTexture=new Oa,this._renderToScreen=!0,this._isUIOverlayEnabled=!1,this.clock=new Zl,this.renderer=e,this.debug=!1,this.effects.set("bloom",new mR),this.effects.set("chromaticAberration",new vR),this.effects.set("vignette",new wR),this.effects.set("noise",new xR),this.effects.set("colorAverage",new yR),this.effects.set("hueSaturation",new bR),this.effects.set("brightnessContrast",new gR),this.effects.set("depthOfField",new SR),this.effects.set("pixelation",new _R),this.effectComposer=new DR(this.renderer),this.effectComposer.autoRenderToScreen=!1,this.opaquePass=new PR(!0,this.scene,this.camera),this.opaquePass.clear=!0,this.transmissionPass=new CR(this.scene,this.camera,this.renderer),this.aoPass=new BR(this.scene,this.camera),this.taaPass=new AR,this.taaPass.renderToScreen=!1,this.helperPass=new IR(this.camera),this.helperPass.renderToScreen=!1,this.stylesOverlayPass=new zR,this.stylesOverlayPass.enabled=!1,this.uiOverlayPass=new UR,this.uiOverlayPass.enabled=!1,this.logoOverlayPass=new jR,this.logoOverlayPass.enabled=!1,this.sceneTransitionPass=new FR,this.sceneTransitionPass.enabled=!1,this._initCopyPass(),this._initPasses()}set overlayTexture(e){void 0!==e?(this.stylesOverlayPass.texture=e,this.stylesOverlayPass.enabled=!0):this.stylesOverlayPass.enabled=!1}get overlayTexture(){return this.stylesOverlayPass.texture}set sceneHelpers(e){this.helperPass.sceneHelpers=e}get sceneHelpers(){return this.helperPass.sceneHelpers}set sceneHelpersOnTop(e){this.helperPass.sceneHelpersOnTop=e}get sceneHelpersOnTop(){return this.helperPass.sceneHelpersOnTop}get scene(){return this._scene}set scene(e){this._scene=e,this.opaquePass.setScene(e),this.transmissionPass.setScene(e),this.aoPass.setScene(e)}get camera(){return this._camera}set camera(e){let t=this._camera!==e;this._camera=e,this.opaquePass.setCamera(e),this.transmissionPass.setCamera(e),t&&this.transmissionPass.updatePasses(this.renderer),this.aoPass.setCamera(e),this.helperPass.setCamera(e),this.effects.get("depthOfField").setCamera(e)}updateRenderToScreen(){let e=!1;for(let t=this.effectComposer.passes.length-1;t>=0;t--){let n=this.effectComposer.passes[t];!0!==n.enabled||e||!this._renderToScreen?n.renderToScreen=!1:(n.renderToScreen=!0,e=!0)}}get isUIOverlayEnabled(){return this._isUIOverlayEnabled}disableUIOverlay(){this._isUIOverlayEnabled=!1}enableUIOverlay(){this._isUIOverlayEnabled=!0}disableHelpers(){this.helperPass.enabled=!1,this.updateRenderToScreen()}enableHelpers(){this.helperPass.enabled=!0,this.updateRenderToScreen()}updateBlueNoiseTexture(e){this.blueNoiseTexture=new Oa(e,128,128),this.blueNoiseTexture.wrapS=se,this.blueNoiseTexture.wrapT=se,this.blueNoiseTexture.minFilter=le,this.blueNoiseTexture.magFilter=le,this.blueNoiseTexture.needsUpdate=!0}setAmbientOcclusionParams(e,t,n,i,r,s,a,o){this.aoPass.enabled=e,this.aoPass.radius=t,this.aoPass.bias=n,this.aoPass.aoColor=i,this.aoPass.fogEnabled=r,this.aoPass.fogNear=s,this.aoPass.fogFar=a,this.aoPass.runHalfRes!==!o&&(this.aoPass.runHalfRes=!o)}setTransmissionPassEnabled(e){this.transmissionPass.enabled=e,this.opaquePass.hasTransmissionPass=e}_initPasses(){var e,t;if(null!==(e=this.uvEffectPass)&&void 0!==e&&e.dispose(),null!==(t=this.effectPass)&&void 0!==t&&t.dispose(),this.effectComposer.removeAllPasses(),this.transmissionPass.updatePasses(this.renderer),this.effectComposer.addPass(this.aoPass),this.effectComposer.addPass(this.opaquePass),this.effectComposer.addPass(this.transmissionPass),this.effectComposer.addPass(this.taaPass),this.postprocessingState.enabled){var n;let e=[this.effects.get("pixelation")].reduce(VR,[]);e.length>0&&(this.uvEffectPass=new GI(this.camera,...e),this.uvEffectPass.renderToScreen=!1,this.effectComposer.addPass(this.uvEffectPass));let t=[this.effects.get("chromaticAberration"),this.effects.get("bloom"),this.effects.get("depthOfField"),this.effects.get("colorAverage"),this.effects.get("hueSaturation"),this.effects.get("brightnessContrast"),this.effects.get("vignette"),this.effects.get("noise")].reduce(VR,[]);if(t.length>0&&(this.effectPass=new GI(this.camera,...t),this.effectPass.renderToScreen=!1,this.effectComposer.addPass(this.effectPass),this._needsDOFResize&&null!==(n=this.effects.get("depthOfField"))&&void 0!==n&&n.enabled&&void 0!==window)){let e=this.renderer.viewportWidth,t=this.renderer.viewportHeight;this.renderer.setSize(e-1,t-1),this.renderer.setSize(e,t)}}this.effectComposer.addPass(this.stylesOverlayPass),this.effectComposer.addPass(this.uiOverlayPass),this.effectComposer.addPass(this.sceneTransitionPass),this.effectComposer.addPass(this.helperPass),this.effectComposer.addPass(this.logoOverlayPass)}_initCopyPass(){if(this._savePass)return;let e=new ot;this.renderer.getDrawingBufferSize(e),this._rt=new It(e.x,e.y,{depthBuffer:!1,stencilBuffer:!1,wrapS:se,wrapT:se}),this._rt.samples=0,this._savePass=new CI(this._rt,!1),this._savePass.renderToScreen=!1}setCopyPass(e){this._rt=e,this._savePass=new CI(this._rt,!1),this.renderToScreen=!1}get renderToScreen(){return this._renderToScreen}set renderToScreen(e){if(this._renderToScreen===e)return;let t=this.effectComposer;!t||(!0===e?t.removePass(this._savePass):t.addPass(this._savePass),this._renderToScreen=e,this.updateRenderToScreen())}set sceneTransitionFromTexture(e){e!==this.sceneTransitionPass.texture&&(null!==e?this.sceneTransitionPass.enabled=!0:(this.sceneTransitionPass.enabled=!1,this.updateRenderToScreen()),this.sceneTransitionPass.texture=e)}setWatermark(e){this.logoOverlayPass.enabled=null!==e,e&&(this.logoOverlayPass.texture=e)}get texture(){return this._rt&&this._rt.texture}get renderTarget(){return this._rt}updatePostprocessing(e){let{enabled:t}=e,n=l(e,g),i=!1;t!==this.postprocessingState.enabled&&(i=!0);for(let r of Object.entries(n)){let e=r[1],t=this.effects.get(r[0]);if(t){t.enabled!==e.enabled&&(i=!0),t.enabled=e.enabled;for(let[n,i]of Object.entries(e))"blendFunction"===n?t.blendFunction=GR(i):t[n]=i}}this.postprocessingState=e,i&&this._initPasses()}render(){this.effectComposer.render(this.clock.getDelta())}setScissor(e,t,n,i){e instanceof Ot?(this.effectComposer.inputBuffer.scissor.set(e.x,e.y,e.z,e.w),this.effectComposer.outputBuffer.scissor.set(e.x,e.y,e.z,e.w)):(this.effectComposer.inputBuffer.scissor.set(e,t,n,i),this.effectComposer.outputBuffer.scissor.set(e,t,n,i));let r=this.renderer.getPixelRatio();this.effectComposer.inputBuffer.scissor.multiplyScalar(r),this.effectComposer.outputBuffer.scissor.multiplyScalar(r),this.renderer.setScissor(e,t,n,i)}setScissorTest(e){this.effectComposer.inputBuffer.scissorTest=e,this.effectComposer.outputBuffer.scissorTest=e,this.renderer.setScissorTest(e)}setViewport(e,t,n,i){e instanceof Ot?(this.effectComposer.inputBuffer.viewport.copy(e),this.effectComposer.outputBuffer.viewport.copy(e)):(this.effectComposer.inputBuffer.viewport.set(e,t,n,i),this.effectComposer.outputBuffer.viewport.set(e,t,n,i))}resize(e,t,n){if(this.effectComposer.setSize(e,t,n),this._rt){let n=this.renderer.getPixelRatio();this._rt.setSize(e*n,t*n)}}dispose(){var e,t;null!==(e=this.uvEffectPass)&&void 0!==e&&e.dispose(),null!==(t=this.effectPass)&&void 0!==t&&t.dispose(),this.effectComposer.dispose()}},WR=Ki.lights_fragment_begin,qR=Ki.shadowmask_pars_fragment,XR=null,YR=new Ri({vertexShader:"\nattribute vec3 randomColor;\nvarying vec3 vNormal;\nflat out vec3 vColor;\n#include <skinning_pars_vertex>\n#include <morphtarget_pars_vertex>\n\t\nvoid main()\n{\n#include <beginnormal_vertex>\n#include <morphnormal_vertex>\n#include <skinbase_vertex>\n#include <skinnormal_vertex>\nvec3 transformed = vec3(position);\n#include <morphtarget_vertex>\n#include <skinning_vertex>\n\nvNormal = normal;\nvColor = randomColor;\ngl_Position = projectionMatrix * (modelViewMatrix * vec4(transformed, 1.0));\n}\n",fragmentShader:"\nuniform float depthContrast;\nvarying vec3 vNormal;\nflat in vec3 vColor;\nvoid main()\n{\nvec3 normal = (normalize(vNormal)).rgb;\n\nfloat contrastDepth = (gl_FragCoord.z - 0.5) * depthContrast + 0.5;\n\nvec3 resultColor = mix(mix(vColor, normal, 0.2), vec3(contrastDepth), 0.4);\ngl_FragColor = vec4(resultColor, vColor.r);\ngl_FragColor = vec4(resultColor, vColor.r);\n}\n",uniforms:{depthContrast:{value:1}}}),QR=new Dt,KR=new ot,ZR=class extends Ea{constructor(e){var t,n;super(e),t=this,this._pixelRatio=this.getPixelRatio(),this.viewportWidth=1,this.viewportHeight=1,this.resolution=new ot,this.dummyCamera=new jO,this.sceneTransitionDuration=0,this.sceneTransitionTimeRemaining=-1,this.isXRCopyPassSet=!1,this.clear=function(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=t.getContext(),s=0;e&&(s|=r.COLOR_BUFFER_BIT),n&&(s|=r.DEPTH_BUFFER_BIT),i&&(s|=r.STENCIL_BUFFER_BIT),r.clear(s),r.clearBufferfv(r.COLOR,1,[0,0,0,1])},this.pipeline=new HR(this,null!==(n=null===e||void 0===e?void 0:e.needsDOFResize)&&void 0!==n&&n),this.autoClear=!1;let i=this.setPixelRatio.bind(this),r=this.setSize.bind(this);this.shadowMap.enabled=!0,this.shadowMap.type=1,this.dummyCamera.matrixAutoUpdate=!1,this.domElement.removeAttribute("data-engine");let s=this.getContext();if(s&&"drawingBufferColorSpace"in s)try{s.drawingBufferColorSpace="display-p3"}catch(UZ){console.warn(UZ)}this.setPixelRatio=e=>{this._pixelRatio!==e&&(this._pixelRatio=e,i(e))},this.setSize=function(e,n){var i,s;let a=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];(t.viewportWidth!==e||t.viewportHeight!==n)&&(t.viewportWidth=e,t.viewportHeight=n,r(e,n,a),null!==(i=t.normalRenderTarget)&&void 0!==i&&i.setSize(e*t._pixelRatio,n*t._pixelRatio),t._resizeTransmission(e,n),null!==(s=t.transmissionDepthTarget)&&void 0!==s&&s.setSize(e*t._pixelRatio/2,n*t._pixelRatio/2),t.pipeline.resize(e,n,a))},this._superDispose=this.dispose,this.dispose=this._currentDispose}createAORenderTarget(){void 0===this.aoRenderTarget&&(this.aoRenderTarget=new It(this.viewportWidth*this._pixelRatio,this.viewportHeight*this._pixelRatio,{generateMipmaps:!1,minFilter:ue,magFilter:ue,wrapS:ae,wrapT:ae,depthBuffer:!1}))}_resizeTransmission(e,t){var n,i;null!==(n=this.transmissionRenderTarget)&&void 0!==n&&n.setSize(e*this._pixelRatio/(this.hdTransmission?1:2),t*this._pixelRatio/(this.hdTransmission?1:2)),null===(i=this.aoRenderTarget)||void 0===i||i.setSize(e*this._pixelRatio/1,t*this._pixelRatio/1)}get hdTransmission(){return 1===xT.transmissionLod.value}set hdTransmission(e){xT.transmissionLod.value=!0===e?1:2,this._resizeTransmission(this.viewportWidth,this.viewportHeight)}createTransmissionRenderTarget(){void 0===this.transmissionRenderTarget&&(this.transmissionRenderTarget=new It(this.viewportWidth*this._pixelRatio/(this.hdTransmission?1:2),this.viewportHeight*this._pixelRatio/(this.hdTransmission?1:2),{generateMipmaps:!0,minFilter:pe,magFilter:ue,wrapS:ae,wrapT:ae,depthBuffer:!1}),this.transmissionDepthTarget=new It(this.viewportWidth*this._pixelRatio/2,this.viewportHeight*this._pixelRatio/2,{minFilter:le,magFilter:le,depthBuffer:!1}))}createNormalRenderTarget(){void 0===this.normalRenderTarget&&(this.normalRenderTarget=new It(this.viewportWidth*this._pixelRatio,this.viewportHeight*this._pixelRatio,{generateMipmaps:!1,minFilter:le,magFilter:le,type:ge,depthTexture:new xa(this.viewportWidth*this._pixelRatio,this.viewportHeight*this._pixelRatio)}))}renderNormal(e,t,n){this.normalRenderTarget&&(this.setClearColor(0),n.layers.enable(8),n.layers.disable(0),n.layers.disable(3),t.traverseEntity((e=>{e.layers.isEnabled(8)&&(e.copyPreviousMatrix=!1)})),this.setRenderTarget(this.normalRenderTarget),this.clear(),YR.uniforms.depthContrast.value=n instanceof jO?(n.far-n.near)/1e4:1,t.overrideMaterial=YR,this.render(t,n),this.setClearColor(t.bgColor,t.bgColor.a),this.setRenderTarget(null),t.overrideMaterial=e.wireframeState?_B:null,n.layers.enable(0),n.layers.enable(3),t.traverseEntity((e=>{e.layers.isEnabled(8)&&(e.copyPreviousMatrix=!0)})))}renderSplineSceneWithDummyCamera(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;this.dummyCamera.updateCameraState(t.dataPatched),this.dummyCamera.matrix.copy(t.matrixWorld);let i=t.height,r=t.width,s=this.viewportWidth/this.viewportHeight;r<i?r=i*s:i=r/s,this.dummyCamera.setViewplaneSize(r,i);for(let a=0;a<n;a++)this.renderSplineScene(e,this.dummyCamera)}renderSplineScene(e,t){var n;let{sceneHelpers:i=this.sceneHelpers,sceneHelpersOnTop:r=this.sceneHelpersOnTop,overrideTransmission:s,overrideNormal:a}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=e instanceof AB?e.activePage:e,l=o.visible;o.visible=!0;let c=o.scene;this.xr.enabled&&(!1===this.isXRCopyPassSet&&null!==this.getRenderTarget()&&(this.pipeline.setCopyPass(this.getRenderTarget()),this.isXRCopyPassSet=!0),this.xr.updateCamera(t)),this.setClearColor(o.bgColor,o.bgColor.a),o.penumbraSizeArray.forEach(((e,t)=>{xT.penumbraSize.value[t]=e})),xT.pixelRatioNode.value=this.getPixelRatio(),0!==this.resolution.x&&0!==this.resolution.y?xT.resolution.value.set(this.resolution.x,this.resolution.y):xT.resolution.value.set(this.viewportWidth*this._pixelRatio,this.viewportHeight*this._pixelRatio),void 0!==a?(xT.normalRenderTarget.value=a,xT.normalRenderTargetDepth.value=QR):c.needsNormal()&&(this.createNormalRenderTarget(),xT.normalRenderTarget.value=this.normalRenderTarget.texture,xT.normalRenderTargetDepth.value=this.normalRenderTarget.depthTexture,this.renderNormal(c,o,t));let h=o.data.ao,u=h.occlusion;if(u&&(this.createAORenderTarget(),xT.aoRenderTarget.value=this.aoRenderTarget.texture),xT.aoEnabled.value=u,this.pipeline.setAmbientOcclusionParams(h.occlusion,h.radius,h.bias,o.aoColor,null!==o.fog,o.backupFog.near,o.backupFog.far,h.aoFullRes&&!Om),this.pipeline.aoPass.setBlueNoiseTexture(this.pipeline.blueNoiseTexture),this.pipeline.isUIOverlayEnabled&&null!==(n=o.uiCanvas)&&void 0!==n&&n.enabled&&o.uiCanvas.texture&&o.uiCanvas.texture.image.width>0){let e=this.getSize(KR),t=this.getPixelRatio();(o.uiCanvas.width!==this.viewportWidth||o.uiCanvas.height!==this.viewportHeight||o.uiCanvas.dpr!==t)&&o.uiCanvas.applySize({width:this.viewportWidth,height:this.viewportHeight},t),o.uiCanvas.render(this),this.pipeline.uiOverlayPass.uiCanvas=o.uiCanvas,this.pipeline.uiOverlayPass.enabled=!0,this.pipeline.uiOverlayPass.setResolution(e.x,e.y,t),this.pipeline.updateRenderToScreen()}else this.pipeline.uiOverlayPass.enabled=!1,this.pipeline.updateRenderToScreen();if(this.pipeline.logoOverlayPass.enabled){let e=this.getSize(KR),t=this.getPixelRatio();this.pipeline.logoOverlayPass.uniforms.uResolution.value.set(e.x,e.y),this.pipeline.logoOverlayPass.uniforms.uDPR.value=t}let d=!1;if(void 0!==s)xT.transmissionRenderTarget.value=s,xT.transmissionRenderTargetDepth.value=QR,this.pipeline.setTransmissionPassEnabled(!1);else{let e=c.needsTransmission();e&&(void 0===this.transmissionRenderTarget&&(d=!0),this.createTransmissionRenderTarget(),xT.transmissionRenderTarget.value=this.transmissionRenderTarget.texture,xT.aspectRatio.value=function(e,t){return e>=t?new ot(t/e,1):new ot(1,e/t)}(this.viewportWidth,this.viewportHeight),xT.transmissionRenderTargetDepth.value=this.transmissionDepthTarget.texture),this.pipeline.setTransmissionPassEnabled(e)}t.layers.enable(3),t.layers.enable(8),this.pipeline.sceneHelpers=i,this.pipeline.sceneHelpersOnTop=r,this.pipeline.scene=o,this.pipeline.camera=t,d&&this.pipeline.transmissionPass.updatePasses(this),this.pipeline.postprocessingState!==o.postprocessing&&(this.pipeline.updatePostprocessing(o.postprocessing),!i&&!r&&this.pipeline.disableHelpers()),void 0!==this.clearAlphaOverride&&this.setClearAlpha(this.clearAlphaOverride),c.shapeBlendIntances.forEach((e=>{e.onBeforeShadowPass(this)})),o.overrideMaterial=c.wireframeState?_B:null,this.pipeline.render(),xT.frameIndex.value=(xT.frameIndex.value+1)%16,t instanceof jO&&t.copyHistory(),o.visible=l}renderFromSceneForSceneTransitionPass(e,t,n){this.pipeline.renderToScreen=!1,this.pipeline.renderTarget,this.renderSplineScene(e,t),this.pipeline.sceneTransitionFromTexture=this.pipeline.renderTarget.texture,this.sceneTransitionDuration=n,this.sceneTransitionTimeRemaining=n,this.pipeline.renderToScreen=!0;let i=this.pipeline.sceneTransitionPass.uniforms;i.uDPR.value=window.devicePixelRatio,i.uResolution.value.set(this.domElement.width,this.domElement.height).divideScalar(window.devicePixelRatio)}_currentDispose(){var e,t,n,i,r;this._superDispose(),this.pipeline.dispose(),null!==(e=this.aoRenderTarget)&&void 0!==e&&e.dispose(),null!==(t=this.transmissionRenderTarget)&&void 0!==t&&t.dispose(),null!==(n=this.transmissionDepthTarget)&&void 0!==n&&n.dispose(),null!==(i=this.normalRenderTarget)&&void 0!==i&&i.dispose(),null===(r=this.normalRenderTarget)||void 0===r||null===(r=r.depthTexture)||void 0===r||r.dispose()}},JR=class extends(_O(Dc)){constructor(e){super(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:15,arguments.length>2&&void 0!==arguments[2]?arguments[2]:10066329),this.object=e,this.added=!1,this.name="DirectionalLightHelper: ".concat(e.uuid)}raycast(e,t){MO(this.object,JR.geometryHelper,e,t)}},$R=class extends(_O(Cc)){constructor(e){super(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:15,arguments.length>2&&void 0!==arguments[2]?arguments[2]:6710886),this.object=e,this.name="PointLightHelper: ".concat(e.uuid)}raycast(e,t){MO(this.object,$R.geometryHelper,e,t)}},ek=class extends(_O(Ac)){constructor(e){super(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:6710886),this.object=e,this.name="SpotLightHelper: ".concat(e.uuid)}raycast(e,t){MO(this.object,ek.geometryHelper,e,t)}update(){if(void 0!==this.object){let e=ek._vector,t=this.object.distance?this.object.distance:1e3,n=t*Math.tan(this.object.angle);this.cone.scale.set(n,n,t),e.setFromMatrixPosition(this.object.target.matrixWorld),this.cone.lookAt(e);let i=void 0!==this.color?this.color:this.light.color;if(this.cone.material instanceof Array)for(let r=0,s=this.cone.material.length;r<s;r++)this.cone.material[r].color.set(i);else this.cone.material.color.set(i)}}},tk=ek;tk._vector=new Bt;var nk=class extends va{constructor(){super(),this.caretIndex=0,this._caretVisibleAlpha=1,this._selectionVisibleAlpha=.3,this.current={start:0,end:void 0},this.matrixAutoUpdate=!1,this.caretMesh=new Ci(new Qi(1,1),new Jn({transparent:!0,opacity:0,side:2})),this.add(this.caretMesh),this.selectionMesh=new Ci(new Qi(1,1),new Jn({color:2857471,transparent:!0,depthTest:!1,depthWrite:!1,opacity:0,side:2})),this.add(this.selectionMesh),this.hide()}get caretHeight(){var e,t;return null!==(e=null===(t=this.object)||void 0===t?void 0:t.AD)&&void 0!==e?e:0}show(e){this.visible=!0,this.object=e,this.caretMesh.scale.set(1,this.caretHeight,1),this.caretMesh.position.y=.5*-this.caretHeight,this.setCaretPosition(this.caretIndex),this.update()}hide(){this.visible=!1}update(){if(void 0===this.object)return;this.updateHelperMatrix();let{depth:e}=this.object.geometry.userData.parameters;this.caretMesh.position.z=e,this.selectionMesh.position.z=e}updateHelperMatrix(){if(void 0===this.object)return;let e=this.object,t=e.parent;null!==t&&t.updateWorldMatrix(!0,!1),e.matrixAutoUpdate&&e.updateMatrix(),null!==t?(this.matrixWorld.multiplyMatrices(t.matrixWorld,e.hiddenMatrix),this.matrixWorld.multiplyMatrices(this.matrixWorld,e.matrix)):this.matrixWorld.multiplyMatrices(e.hiddenMatrix,e.matrix),this.matrix.copy(this.matrixWorld);for(let n of this.children)n.matrixWorld.copy(this.matrixWorld);e.updateWorldMatrix(!0,!0)}setCaretColor(e){let t=this.caretMesh.material;t.color.setRGB(e.r,e.g,e.b);let n=this._caretVisibleAlpha===t.opacity;this._caretVisibleAlpha=e.a,n&&(t.opacity=this._caretVisibleAlpha)}setSelectionColor(e){this.selectionMesh.material.color.setRGB(e.r,e.g,e.b)}setCaretPosition(e){if(void 0===this.object)return;this.caretIndex=e;let t=this.object.wrappedText,[n,i]=rk(t,e),[r,s]=e>0?rk(t,e-1):[null,null];"\n"===(e>0&&t.length?t[r].charAt(s):null)&&(n++,i=0),this.current.start=e,this.current.end=void 0;let[a,o]=ik(this.object,n,i),{AD:l,descender:c}=this.object,h=c+.5*l,{width:u,height:d,depth:p}=this.object.geometry.userData.parameters,f="string"==typeof u?0:u,m="string"==typeof d?0:d;this.caretMesh.scale.set(1,this.caretHeight,1),this.caretMesh.position.set(a-.5*f,o+h+.5*m,p),this.hideSelectionMesh(),this.showCaretMesh()}setSelection(e,t){if(void 0===this.object)return;let n=this.object.wrappedText;this.current.start=e,this.current.end=t;let i=[],r=[],s=function(e,t,n){let[i,r]=rk(e,t),[s,a]=rk(e,n),o=[];r>=e[i].length&&(i++,r=0);for(let l=i;l<=s;l++){let t=e[l],n=l===i?r:0,c=l===s?a:t.length;o.push([l,n,c])}return o}(n,e,t),{lineHeight:a,AD:o,descender:l}=this.object,c=l+.5*o-.5*a;for(let[g,v,y]of s)if(v!==y){let[e,t]=ik(this.object,g,v),[n,s]=ik(this.object,g,y);t+=c,s+=c,s+=a;let o=i.length/3;i.push(e,t,0),i.push(n,t,0),i.push(n,s,0),i.push(e,s,0),r.push(o+0,o+1,o+2),r.push(o+2,o+3,o+0)}let h=new di;h.setIndex(r),h.setAttribute("position",new ri(i,3));let{width:u,height:d,depth:p}=this.object.geometry.userData.parameters,f="string"==typeof u?0:u,m="string"==typeof d?0:d;this.selectionMesh.geometry.dispose(),this.selectionMesh.geometry=h,this.selectionMesh.position.x=.5*-f,this.selectionMesh.position.y=.5*m,this.selectionMesh.position.z=p,this.showSelectionMesh(),this.hideCaretMesh()}getSelectionFromPosition(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"previous";if(void 0===this.object||void 0===this.object.font)return;let i=this.object.wrappedText,r=i.length,s=this.object.lineHeight,a=r*s,{height:o,verticalAlign:l}=this.object.geometry.userData.parameters,c="string"==typeof o?0:o,h=0;3===l?h=c-a:2===l&&(h=.5*c-.5*a);let u=Math.min(Math.floor(Math.max(Math.min(-t-h,a),0)/s),r-1),d=this.object.charCoords[u],p=this.object.charWidths[u],f=0,m=!1;if("previous"===n){for(let g=0;g<d.length;g++)if(d[g][0]+.5*p[g]-e>0){f=g,m=!0;break}}else if("closest"===n){let t=1/0;for(let n=0;n<d.length;n++){let i=d[n][0]+.5*p[n],r=Math.abs(i-e);r<t&&(t=r,f=n,m=!0)}}else for(let g=0;g<d.length;g++){let t=d[g][0],n=d[g][0]+p[g];if(e>=t&&e<n){f=g,m=!0;break}}return m||(f=d.length),{index:this.getGlobalIndexFromLineAndCharIndexes(i,u,f),lineIndex:u,characterIndex:f}}getGlobalIndexFromLineAndCharIndexes(e,t,n){return e.slice(0,t).reduce(((e,t)=>e+t.length),0)+n}showSelectionMesh(){this.selectionMesh.material.opacity=this._selectionVisibleAlpha}hideSelectionMesh(){this.selectionMesh.material.opacity=0}showCaretMesh(){this.caretMesh.material.opacity=this._caretVisibleAlpha}hideCaretMesh(){this.caretMesh.material.opacity=0}};function ik(e,t,n){let{charCoords:i,charWidths:r,initialOffsetY:s,lineHeight:a}=e;if(i[t]&&0===i[t].length||0===i.length){let n=0,{horizontalAlign:i}=e.data.geometry,r=e.wrappedText,{width:o}=e.geometry.userData.parameters;return 1===r.length&&0===r[0].length&&(3===i?n=.5*o:2===i&&(n=o)),[n,s-a*t]}let o=i[t];if(void 0===o||0===o.length)return[0,0];let[l,c]=o[Math.min(n,o.length-1)];return n>=o.length&&(l+=r[t][n-1]),[l,c]}function rk(e,t){var n,i;let r=0;for(let s=0;s<e.length;s++){let n=e[s],i=t-r;if(i<=n.length)return[s,i];r+=n.length}return[Math.max(0,e.length-1),null!==(n=null===(i=e[e.length-1])||void 0===i?void 0:i.length)&&void 0!==n?n:0]}function sk(e,t){return"string"==typeof e?t.data.colors[e]:e}function ak(e){return e.colors[0]}var ok,lk=class extends(XO(Yl,JR)){constructor(e,t,n){super(),this.super_Entity(e,t),this.castShadow=!0,this.shadow.mapSize.width=2048,this.shadow.mapSize.height=2048,this.shadow.normalBias=1,this.layers.enable(3);let i=this.shadow.camera;i.top=1250,i.bottom=-1250,i.right=1250,i.left=-1250,i.near=-1e4,i.far=2500;let r=new Rc(this.shadow.camera);r.visible=!1,this.gizmos.shadowmap=r}update(){this.shadow.camera.updateProjectionMatrix();for(let e in this.gizmos){let t=this.gizmos[e];t instanceof Rc&&t.update()}}updateMatrixWorld(e){super.updateMatrixWorld(e),this.objectHelper&&this.objectHelper.update()}updateState(e,t){this.updateState_Light(e,t);let n=void 0!==e.depth&&e.depth!==this.shadow.camera.far||void 0!==e.size&&e.size/2!==this.shadow.camera.right;void 0!==e.size&&function(e,t){e.shadow.camera.right=t/2,e.shadow.camera.left=-t/2,e.shadow.camera.top=t/2,e.shadow.camera.bottom=-t/2,e.shadow.needsUpdate=!0}(this,e.size),void 0!==e.shadowRadius&&(this.shadow.radius=e.shadowRadius),void 0!==e.shadowResolution&&(this.shadow.mapSize.set(e.shadowResolution,e.shadowResolution),this.shadow.map&&(this.shadow.map.dispose(),this.shadow.map=null)),void 0!==e.penumbraSize&&t.scene.markPenumbraSizeDirty(),n&&this.update()}},ck=new Bt,hk=new Bt,uk=new Lt,dk=class extends(XO(jl,tk)){constructor(e,t,n){super(),this.super_Entity(e,t),this.castShadow=!0,this.shadow.mapSize.width=1024,this.shadow.mapSize.height=1024,this.shadow.normalBias=1,this.layers.enable(3);let i=this.shadow.camera;i.fov=2*at.RAD2DEG*this.angle,i.aspect=1,i.near=100,i.far=2500;let r=new Rc(this.shadow.camera);r.visible=!1,this.gizmos.shadowmap=r,this.update()}update(){this.shadow.camera.updateProjectionMatrix();for(let e in this.gizmos){let t=this.gizmos[e];t instanceof Rc&&t.update()}}updateMatrixWorld(e){super.updateMatrixWorld(e),hk.setFromMatrixPosition(this.matrixWorld),uk.setFromRotationMatrix(this.matrixWorld),ck.copy(this.up).applyQuaternion(uk).negate().multiplyScalar(this.distance),this.target.position.copy(hk).add(ck),this.target.updateMatrixWorld(),this.objectHelper&&this.objectHelper.update()}updateState(e,t){this.updateState_Light(e,t),void 0!==e.distance&&(this.distance=e.distance),void 0!==e.decay&&(this.decay=e.decay),void 0!==e.angle&&(this.angle=e.angle),void 0!==e.penumbra&&(this.penumbra=e.penumbra),void 0!==e.shadowRadius&&(this.shadow.radius=e.shadowRadius),void 0!==e.penumbraSize&&t.scene.markPenumbraSizeDirty(),void 0!==e.shadowResolution&&(this.shadow.mapSize.set(e.shadowResolution,e.shadowResolution),this.shadow.map&&(this.shadow.map.dispose(),this.shadow.map=null))}};function pk(e,t){return[[e[0][0]*t[0][0]+e[0][1]*t[1][0],e[0][0]*t[0][1]+e[0][1]*t[1][1]],[e[1][0]*t[0][0]+e[1][1]*t[1][0],e[1][0]*t[0][1]+e[1][1]*t[1][1]]]}function fk(e){return[[e[0][0],e[1][0]],[e[0][1],e[1][1]]]}function mk(e){let[t,n,i]=function(e){let t=(e[0][0]+e[1][1])/2,n=(e[0][0]-e[1][1])/2,i=(e[1][0]+e[0][1])/2,r=(e[1][0]-e[0][1])/2,s=Math.sqrt(t*t+r*r),a=Math.sqrt(n*n+i*i),o=s+a,l=s-a,c=Math.atan2(i,n),h=Math.atan2(r,t),u=(h-c)/2,d=(h+c)/2,p=[[Math.cos(d),Math.sin(d)],[-Math.sin(d),Math.cos(d)]],f=[[o,0],[0,l]],m=[[Math.cos(u),Math.sin(u)],[-Math.sin(u),Math.cos(u)]];return p[0][0]*=-1,p[0][1]*=-1,m[0][0]*=-1,m[1][0]*=-1,[p,f,m]}(e),r=pk(t,fk(i)),s=pk(pk(i,n),fk(i));return{rotation:Math.atan2(r[1][0],r[0][0]),scale:[s[0][0],s[1][1]],shear:[s[0][1]/s[1][1],s[1][0]/s[0][0]]}}(e=>{function t(e){return[e[0],e[3],e[1],e[4],e[2],e[5]]}e.identity=function(){return[1,0,0,0,1,0,0,0,1]},e.copy=function(t){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.identity();for(let e=0,i=t.length;e<i;e++)n[e]=t[e];return n},e.create=function(t,n,i,r,s,a){return e.setAbcdef(e.identity(),t,n,i,r,s,a)},e.setAbcdef=function(e,t,n,i,r,s,a){return e[0]=t,e[1]=i,e[2]=s,e[3]=n,e[4]=r,e[5]=a,e},e.append=function(n,i){let[r,s,a,o,l,c]=t(n),[h,u,d,p,f,m]=t(i),g=h*r+u*a,v=h*s+u*o,y=d*r+p*a,b=d*s+p*o,x=f*r+m*a+l,w=f*s+m*o+c;return e.create(g,v,y,b,x,w)},e.prepend=function(n,i){let[r,s,a,o,l,c]=t(n),[h,u,d,p,f,m]=t(i),g=r,v=s,y=a,b=o;(1!==h||0!==u||0!==d||1!==p)&&(g=r*h+s*d,v=r*u+s*p,y=a*h+o*d,b=a*u+o*p);let x=l*h+c*d+f,w=l*u+c*p+m;return e.create(g,v,y,b,x,w)},e.getAbcdef=t,e.invert=function(t){let[n,i,r,s,a,o]=e.getAbcdef(t),l=n*s-i*r,c=s/l,h=-i/l,u=-r/l,d=n/l,p=(r*o-s*a)/l,f=-(n*o-i*a)/l;return e.create(c,h,u,d,p,f)},e.apply=function(t,n){let[i,r]=t,[s,a,o,l,c,h]=e.getAbcdef(n);return[s*i+o*r+c,a*i+l*r+h]},e.applyInverse=function(t,n){let[i,r,s,a,o,l]=e.getAbcdef(n),c=1/(i*a+s*-r),[h,u]=t;return[a*c*h+-s*c*u+(l*s-o*a)*c,i*c*u+-r*c*h+(-l*i+o*r)*c]},e.scale=function(t,n){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:n,[r,s,a,o,l,c]=e.getAbcdef(t);return e.setAbcdef(t,r*n,s*i,a*n,o*i,l*n,c*i),t},e.rotate=function(t,n){let i=Math.cos(n),r=Math.sin(n),[s,a,o,l,c,h]=e.getAbcdef(t);return e.setAbcdef(t,s*i-a*r,s*r+a*i,o*i-l*r,o*r+l*i,c*i-h*r,c*r+h*i),t},e.rotateAround=function(t,n,i){let[r,s]=i,a=e.translate(t,-r,-s);return a=e.rotate(a,n),a=e.translate(a,r,s),a},e.translate=function(t,n,i){let[r,s,a,o,l,c]=e.getAbcdef(t);return e.setAbcdef(t,r,s,a,o,l+n,c+i),t},e.setTranslate=function(t,n,i){let[r,s,a,o]=e.getAbcdef(t);return e.setAbcdef(t,r,s,a,o,n,i),t},e.setPosition=function(t,n,i){let[r,s,a,o]=e.getAbcdef(t);return e.setAbcdef(t,r,s,a,o,n,i),t},e.getScale=function(t){let[n,i,r,s]=e.getAbcdef(t);return[Math.sqrt(n*n+i*i),Math.sqrt(r*r+s*s)]},e.getPosition=function(t){let[,,,,n,i]=e.getAbcdef(t);return[n,i]},e.getRotation=function(t,n){return e.decompose(t,n).rotation},e.decompose=function(t,n){let[i,r,s,a,o,l]=e.getAbcdef(t),{rotation:c,scale:h,shear:u}=mk([[i,s],[r,a]]);return{position:[o+(n[0]*i+n[1]*s)-n[0],l+(n[0]*r+n[1]*a)-n[1]],scale:h,rotation:c,shear:u,pivot:n}},e.compose=function(t,n,i,r){let s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[0,0],[a,o]=t,[l,c]=r,[h,u,d,p]=function(e){let{rotation:t,scale:n,shear:i}=e,r=Math.cos(t),s=Math.sin(t),a=pk([[r,-s],[s,r]],[[n[0],i[0]*n[1]],[i[1]*n[0],n[1]]]);return[a[0][0],a[1][0],a[0][1],a[1][1]]}({rotation:i,scale:n,shear:s}),f=a-(l*h+c*d)+l,m=o-(l*u+c*p)+c;return e.create(h,u,d,p,f,m)}})(ok||(ok={}));var gk=Math.PI/180;Math.PI;var vk=class{constructor(e,t,n){var i;this.uuid=e,this.data=t,this.localMatrix=ok.identity(),this.worldMatrix=ok.identity(),this.ignoreCameraZoom=!1,this.visible=!0,this._singleBBox=new Mk,this._recursiveBBox=new Mk,this.singleBBoxNeedsUpdate=!0,this.recursiveBBoxNeedsUpdate=!0,this.stateSelection=null,this.prevState=null,this.currentState=null,this.reversibleToState=null,this.currentTransitionEvent=null,this.previousAction=null,this.name="",this.position=[0,0],this.scale=[1,1],this.rotation=0,this.shear=[0,0],this.emitter=OA(),this.dpr=null!==(i=n.dpr)&&void 0!==i?i:1,this.dataPatched=t}project(e,t){let n=this.worldMatrix;return t&&(n=ok.append(t.worldMatrix,n)),ok.applyInverse(e,n)}intersects(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return this.visible&&!this.data.raycastLock&&this.intersectsInLocalSpace(...this.project([e,t],n),i)}intersectsInLocalSpace(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],{min:i,max:r}=n?this.recursiveBBox:this.singleBBox;return e>=i[0]&&e<=r[0]&&t>=i[1]&&t<=r[1]}applyTransforms(e){e.setTransform(this.worldMatrix,this.ignoreCameraZoom)}get singleBBox(){return this.singleBBoxNeedsUpdate&&(this.singleBBoxNeedsUpdate=!1,this._singleBBox.setFromObjectSize(this,!1),this._singleBBox.computeVertices(),this._singleBBox.computeEdges()),this._singleBBox}get recursiveBBox(){return this.recursiveBBoxNeedsUpdate&&(this.recursiveBBoxNeedsUpdate=!1,this._recursiveBBox.setFromObjectSize(this,!0),this._recursiveBBox.computeVertices(),this._recursiveBBox.computeEdges()),this._recursiveBBox}updateLocalMatrix(){this.localMatrix=ok.compose(this.position,this.scale,function(e){return e*gk}(this.rotation),lw.getPivot(this.dataPatched),this.shear)}updateWorldMatrix(e,t,n){let i=this.parent;t&&null!==i&&void 0!==i&&i.updateWorldMatrix(e,!0,!1),e&&this.updateLocalMatrix(),this.parent?this.worldMatrix=ok.append(this.parent.worldMatrix,this.localMatrix):this.worldMatrix=ok.copy(this.localMatrix),this.singleBBoxNeedsUpdate=!0,this.recursiveBBoxNeedsUpdate=!0}get pivot(){return lw.getPivot(this.data)}getCenter(){return[0,0]}getHalfSize(){return[0,0]}get id(){return this.uuid}resetBBoxNeedsUpdateSelf(){this.singleBBoxNeedsUpdate=!0,this.recursiveBBoxNeedsUpdate=!0}resetBBoxNeedsUpdate(){this.resetBBoxNeedsUpdateSelf(),this.traverseAncestors((e=>{e.resetBBoxNeedsUpdateSelf()}))}updateTransformState(e){let t=!1;void 0!==e.position&&(t=!0,this.position=e.position),void 0!==e.rotation&&(t=!0,this.rotation=e.rotation),void 0!==e.scale&&(t=!0,this.scale=e.scale),void 0!==e.shear&&(t=!0,this.shear=e.shear),t&&(this.updateWorldMatrix(!0,!1,!0),this.resetBBoxNeedsUpdate())}updateByOp(e,t,n){0===e.type&&void 0!==e.props.visible&&(this.visible=e.props.visible),this.data=t,this.data=t;let i=e,r=qg(e.path,["states","*"]);if(null!==r){if(0===e.type){let[t]=r;if((null===this||void 0===this?void 0:this.stateSelection)===t){let t=o({},e.props);if(delete t.name,Object.values(e.props).some((e=>void 0===e))){let n=this.data;if(void 0!==n){let i=Ug.zoom(n,e.path.slice(2));if(i)for(let n in e.props)void 0===e.props[n]&&n in i&&(t[n]=i[n])}}i=o(o({},e),{},{props:t,path:e.path.slice(2)})}}}else if(0===e.type){let t=this.stateSelection?this.data.states.data(this.stateSelection):void 0;if(void 0!==t){if(void 0!==e.props.name&&t.name){let{name:e}=t;t=l(t,v)}let n=Ug.removeOverridden(e.path,e.props,t);i=o(o({},e),{},{props:n})}}this.updateByPatchedOpBase(i,Zx.patch(this.data,this.stateSelection?this.data.states.data(this.stateSelection):void 0),n)}changeSelectedState(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(0!==this.data.states.length||n){for(let e of this.data.states)Zx.toOps(this.data,e.data).forEach((e=>{let n=gg.replaceProps(e,this.data);this.dataPatched=this.data,this.updateByPatchedOp(n,this.data,t)}));if(null!==e){let n=this.data.states.data(e);n&&(this.dataPatched=Zx.patch(this.data,n),Zx.toOps(this.data,n).forEach((e=>{this.updateByPatchedOp(e,this.dataPatched,t)})))}n&&this.updateTransformState(this.dataPatched),this.stateSelection=e}}updateState(e,t){void 0!==e.name&&(this.name=e.name),void 0!==e.visible&&(this.visible=e.visible),this.updateTransformState(e)}updateByPatchedOpBase(e,t,n){this.dataPatched=t,this.updateByPatchedOp(e,t,n)}updateByPatchedOp(e,t,n){0===e.path.length&&0===e.type&&this.updateState(e.props,n),this.requestRender()}traverseFrameAncestors(e){this.traverseAncestors((t=>{"frame2d"===t.data.type&&e(t)}))}traverseAncestors(e){let t=this.parent;for(;t;)e(t),t=t.parent}requestRender(){this.traverseFrameAncestors((e=>{e.requestRender()}))}clone(e){let t=new vk(this.uuid,this.data,e);return t.parent=void 0,t}addEventListener(e,t){this.emitter.on(e,t)}removeEventListener(e,t){this.emitter.off(e,t)}dispatchEvent(e){var t;this.emitter.emit(e.type,o(o({},e),{},{target:null!==(t=e.target)&&void 0!==t?t:this}))}traverseSortNextHelper(){let e=this.parent;if(e){let t=e.children;if(t){let n=t.indexOf(this)+1;return t[n]?t[n]:e.traverseSortNextHelper()}}}sortNext(){let e=this.children;return e&&e.length>0&&e[0]?e[0]:this.traverseSortNextHelper()}isDescendantOf(e){e instanceof vk&&(e=e.uuid);let t=this;for(;t.parent;){if(t.parent.uuid===e)return!0;t=t.parent}return!1}},yk=class extends vk{constructor(e,t,n){super(e,t,n),this.uuid=e,this.data=t,this.context=n,this.children=[]}add(e){e.parent&&e.parent instanceof yk&&e.parent.remove(e),this.children.push(e),e.parent=this}remove(e){let t=this.children.indexOf(e);t>=0&&(this.children.splice(t,1),e.parent=void 0)}traverse(e){let t=e(this);if(!0!==t)for(let n of this.children)n instanceof yk?n.traverse(e):t=e(n)}intersectsChildrenHelper(e,t,n,i,r){for(let s of this.children)if(s.intersects(e,t,n,!1)&&(r.push(s),i)||s instanceof yk&&s.intersectsChildrenHelper(e,t,n,i,r))return!0;return!1}intersectsChildren(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[];return this.intersectsChildrenHelper(e,t,n,i,r),r}intersectsChildrenHelperReverse(e,t,n,i,r){for(let s of this.children)if(s instanceof yk&&s.intersectsChildrenHelperReverse(e,t,n,i,r)||s.intersects(e,t,n,!1)&&(r.push(s),i))return!0;return!1}intersectsChildrenReverse(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[];return this.intersectsChildrenHelperReverse(e,t,n,i,r),r}updateWorldMatrix(e,t,n){if(super.updateWorldMatrix(e,t,n),n&&this.children)for(let i of this.children)i.updateWorldMatrix(e,!1,!0)}find(e){let t;return this.traverse((n=>{n.uuid===e&&(t=n)})),t}innerDrawChildren(e){for(let t=this.children.length-1;t>=0;t--)this.children[t].draw(e)}resetBBoxNeedsUpdate(){super.resetBBoxNeedsUpdate(),this.traverse((e=>{e.resetBBoxNeedsUpdateSelf()}))}clone(e){let t=new yk(this.uuid,this.data,e);t.parent=void 0;for(let n of this.children)t.add(n.clone(e));return t}},bk=class extends yk{constructor(e,t,n){super(e,t,n),this.uuid=e,this.data=t,this.updateState(t,n)}draw(e){!this.visible||(e.save(),this.applyTransforms(e),this.innerDrawChildren(e),e.restore())}clone(e){let t=new bk(this.uuid,this.data,e);t.parent=void 0;for(let n of this.children)t.add(n.clone(e));return t}};function xk(e,t){let[[n,i],[r,s]]=e,[[a,o],[l,c]]=t,h=(n-r)*(o-c)-(i-s)*(a-l);if(0===h)return!1;let u=((n-a)*(o-c)-(i-o)*(a-l))/h,d=-((n-r)*(i-o)-(i-s)*(n-a))/h;return u>=0&&u<=1&&d>=0&&d<=1}var wk,Sk,_k,Ek,Ak=[[-1,1],[-1,-1],[1,-1],[1,1]],Ck=(e,t,n)=>{let i=e.getCenter(),r=e.getHalfSize(),s=ok.append(t,e.worldMatrix);0===r[0]&&0===r[1]?n.push(ok.apply(i,s)):Ak.forEach((e=>{let t=[e[0]*r[0]+i[0],e[1]*r[1]+i[1]];n.push(ok.apply(t,s))}))},Mk=class{constructor(){this.matrix=ok.identity(),this.min=[1/0,1/0],this.max=[-1/0,-1/0],this.vertices=[],this.edges=[]}setFromObjectSize(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];e.updateWorldMatrix(),this.makeEmpty(),ok.copy(e.worldMatrix,this.matrix);let n=ok.invert(e.worldMatrix);this.expandByObjectSize(e,n,t)}expandByObjectSize(e,t){let n=[];!0===(arguments.length>2&&void 0!==arguments[2]&&arguments[2])&&e instanceof yk?e.traverse((e=>{e.visible&&Ck(e,t,n)})):Ck(e,t,n),this.setFromPoints(n)}setFromSize(e,t,n){this.makeEmpty(),ok.copy(n,this.matrix),this.expandBySize(e,t,n)}expandBySize(e,t,n){[ok.apply([0,0],n),ok.apply([0,t],n),ok.apply([e,t],n),ok.apply([e,0],n)].forEach((e=>this.expandByPoint(e)))}getCenter(){let[e,t]=this.min,[n,i]=this.getHalfSize();return ok.apply([e+n,t+i],this.matrix)}getSize(){return[this.max[0]-this.min[0],this.max[1]-this.min[1]]}getHalfSize(){return[.5*(this.max[0]-this.min[0]),.5*(this.max[1]-this.min[1])]}makeEmpty(){this.min=[1/0,1/0],this.max=[-1/0,-1/0]}setFromPoints(e){this.makeEmpty();for(let t of e)this.expandByPoint(t)}expandByPoint(e){this.min=[Math.min(this.min[0],e[0]),Math.min(this.min[1],e[1])],this.max=[Math.max(this.max[0],e[0]),Math.max(this.max[1],e[1])]}computeVertices(){let[e,t]=this.getHalfSize(),n=this.getCenter(),[i,r,s,a]=ok.getAbcdef(this.matrix),o=ok.create(i,r,s,a,n[0],n[1]);this.vertices=Ak.map((n=>{let[i,r]=n;return ok.apply([i*e,r*t],o)}))}computeEdges(){this.edges=[];for(let e=0,t=this.vertices.length;e<t;++e)this.edges.push([this.vertices[e],this.vertices[(e+1)%t]])}project(e,t){let n=this.matrix;return t&&(n=ok.append(t.worldMatrix,n)),ok.applyInverse(e,n)}intersects(e,t,n){return this.intersectsInLocalSpace(...this.project([e,t],n))}intersectsInLocalSpace(e,t){let{min:n,max:i}=this;return e>=n[0]&&e<=i[0]&&t>=n[1]&&t<=i[1]}containsPoint(e){let[t,n]=e,[i,r]=this.min,[s,a]=this.max;return t>=i&&t<=s&&n>=r&&n<=a}intersectsBBox2D(e){for(let t=0,n=this.edges.length;t<n;t++){let n=this.edges[t];for(let t=0,i=e.edges.length;t<i;t++){if(xk(n,e.edges[t]))return!0}}for(let t=0,n=e.vertices.length;t<n;t++){let n=e.vertices[t];if(this.containsPoint(n))return!0}return!1}ensureMinMax(){let e=this.min,t=this.max;this.min=[Math.min(e[0],t[0]),Math.min(e[1],t[1])],this.max=[Math.max(e[0],t[0]),Math.max(e[1],t[1])]}copy(e){this.min=[...e.min],this.max=[...e.max],ok.copy(e.matrix,this.matrix),this.computeVertices(),this.computeEdges()}clone(){let e=new Mk;return e.copy(this),e}},Tk=new Promise((e=>{wk=e})),Pk=!1;function Dk(){if(!Pk)return Sk||(Sk=async function(){var e;let t=await n.e(160).then(n.bind(n,160));wk(null!==(e=t.default)&&void 0!==e?e:t),Pk=!0}(),Sk)}function Ok(e){let t=!1;return e.scene.objects.traverse(((e,n)=>{("Mesh"===n.type&&"UIGeometry"===n.geometry.type||"Page"===n.type&&void 0!==n.uiFrame)&&(t=!0)})),t}var Ik=ok.identity(),Rk=class{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;this.canvas=e,this._dpr=t,this._width=0,this._height=0,this._strokeMode="inside",this._layerBlur=0,this._backgroundBlur=0,this._dropShadowBlur=0,this._dropShadowOffsetX=0,this._dropShadowOffsetY=0,this._dropShadowColor=Qy.transparent,this._innerShadowBlur=0,this._innerShadowOffsetX=0,this._innerShadowOffsetY=0,this._innerShadowSpread=0,this._innerShadowColor=Qy.transparent,this._fonts=new Map,this._isSizeDirty=!1;try{let n=e.getBoundingClientRect();e.width=n.width*t,e.height=n.height*t}catch(n){console.log(e.width,t)}this._currentM3Transform=Ik,this._currentTransform=new Float32Array(Ik)}get dpr(){return this._dpr}set dpr(e){this._dpr=e,this._isSizeDirty=!0}async init(){var e,t;if(!this.wasmURL)throw Error("Your must set the wasm binary url with renderer.wasmURL = ... before you can call renderer.init");await async function(e){let t=await Tk;_k||(Ek||(Ek=t({locateFile:()=>e})),_k=await Ek)}(this.wasmURL),this._surface=_k.MakeWebGLCanvasSurface(this.canvas),this.ctx=null===(e=this._surface)||void 0===e?void 0:e.getCanvas(),this._paint=new _k.Paint,this._paint.setAntiAlias(!0),this._paintFill=this._paint.copy(),this._paintFill.setStyle(_k.PaintStyle.Fill),this._paintStroke=this._paint.copy(),this._paintStroke.setStyle(_k.PaintStyle.Stroke),null===(t=this.ctx)||void 0===t||t.scale(this.dpr,this.dpr)}get currentTransform(){return this._currentM3Transform}get currentTransformBuffer(){return this._currentTransform}set currentTransform(e){this._currentM3Transform=e,this._currentTransform.set(e)}async loadFont(e,t){let n=await(await fetch(e)).arrayBuffer();this.registerFont(n,t)}registerFont(e,t){if(this._fonts.has(t))return;let n=_k.FontMgr.FromData(e);if(!n)throw new Error("Invalid font data for "+t);this._fonts.set(t,n)}get width(){return this._width}get height(){return this._height}set strokeColor(e){this._paintStroke&&this._paintStroke.setColor(Lk(e),_k.ColorSpace.DISPLAY_P3)}set fillColor(e){this._paintFill&&this._paintFill.setColor(Lk(e),_k.ColorSpace.DISPLAY_P3)}set lineWidth(e){this._paintStroke&&this._paintStroke.setStrokeWidth("center"===this._strokeMode?e:2*e)}set strokeMode(e){this._strokeMode=e}set dropShadowBlur(e){this._dropShadowBlur=e}set dropShadowColor(e){this._dropShadowColor=e}set dropShadowOffsetX(e){this._dropShadowOffsetX=e}set dropShadowOffsetY(e){this._dropShadowOffsetY=e}set innerShadowBlur(e){this._innerShadowBlur=e}set innerShadowColor(e){this._innerShadowColor=e}set innerShadowOffsetX(e){this._innerShadowOffsetX=e}set innerShadowOffsetY(e){this._innerShadowOffsetY=e}set innerShadowSpread(e){this._innerShadowSpread=e}set layerBlur(e){this._layerBlur=e}set backgroundBlur(e){this._backgroundBlur=e}clear(){var e;null===(e=this.ctx)||void 0===e||e.clear(_k.TRANSPARENT)}save(){var e;null===(e=this.ctx)||void 0===e||e.save()}restore(){var e;null===(e=this.ctx)||void 0===e||e.restore()}beginPath(){var e;null!==(e=this._currentPath)&&void 0!==e&&e.delete(),this._currentPath=new _k.Path}closePath(){let e=this._currentPath;if(e){if(e.isEmpty())return;let t=e.getBounds();(t[3]-t[1]||t[2]-t[0])&&e.close()}}fill(){this._paintInner(this._paintFill,!0)}stroke(){this._paintInner(this._paintStroke,!1)}clipRect(e,t,n,i){var r;let s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,l=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,c=_k.XYWHRect(e,t,n,i);if(0===s&&0===a&&0===l&&0===o)null===(r=this.ctx)||void 0===r||r.clipRect(c,_k.ClipOp.Intersect,!0);else{var h;let e=_k.RRectXY(c,s,s);e[4]=e[5]=s,e[6]=e[7]=a,e[8]=e[9]=o,e[10]=e[11]=l,null===(h=this.ctx)||void 0===h||h.clipRRect(e,_k.ClipOp.Intersect,!0)}}_applyShadowOffsetMatrix(){if(this.ctx){let e=ok.invert(this.currentTransform);this.ctx.concat(e);let t=ok.translate(ok.identity(),this._dropShadowOffsetX,this._dropShadowOffsetY);this.ctx.concat(t),this.ctx.concat(this._currentTransform)}}_applyEffectsToPaint(e,t){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this.ctx&&this._currentPath){let d,p=!1;if(n&&this._hasDropShadow()){var i,r,s;let n,a=e.copy();a.setColor(Lk(this._dropShadowColor)),this._dropShadowBlur>0&&(n=_k.MaskFilter.MakeBlur(_k.BlurStyle.Normal,this._dropShadowBlur*this.dpr*(null!==(i=null===(r=this.camera)||void 0===r?void 0:r.scale)&&void 0!==i?i:1),!1),a.setMaskFilter(n)),this.ctx.save(),this.ctx.clipPath(this._currentPath,_k.ClipOp.Difference,!0),this._applyShadowOffsetMatrix(),t(a),this.ctx.restore(),a.delete(),null===(s=n)||void 0===s||s.delete()}if(this._backgroundBlur>0&&n){this.ctx.save(),this.ctx.clipPath(this._currentPath,_k.ClipOp.Intersect,!0);let t=_k.ImageFilter.MakeBlur(this._backgroundBlur,this._backgroundBlur,_k.TileMode.Clamp,null),n=e.copy();n.setImageFilter(t),n.setAlphaf(1);let i=this._currentPath.computeTightBounds();this.ctx.saveLayer(n,i,null,_k.SaveLayerInitWithPrevious),this.ctx.drawColor(e.getColor()),this.ctx.restore(),this.ctx.restore(),n.delete(),t.delete(),p=!0}if(this._layerBlur>0){var a,o;let n=e.copy();d=_k.MaskFilter.MakeBlur(_k.BlurStyle.Normal,this._layerBlur*this.dpr*(null!==(a=null===(o=this.camera)||void 0===o?void 0:o.scale)&&void 0!==a?a:1),!1),n.setMaskFilter(d),t(n),n.delete(),d.delete(),p=!0}if(p||t(e),n&&this._hasInnerShadow()){var l,c,h,u;let e,t=new _k.Paint;t.setAntiAlias(!0),t.setStyle(_k.PaintStyle.Fill),t.setColor(Lk(this._innerShadowColor)),this._innerShadowBlur>0&&(e=_k.MaskFilter.MakeBlur(_k.BlurStyle.Normal,this._innerShadowBlur*this.dpr*(null!==(l=null===(c=this.camera)||void 0===c?void 0:c.scale)&&void 0!==l?l:1),!1),t.setMaskFilter(e));let n=this._currentPath.computeTightBounds(),[i,r,s,a]=n,o=s-i,d=a-r;this.ctx.save(),this.ctx.clipPath(this._currentPath,_k.ClipOp.Intersect,!0),this.ctx.saveLayer(t,n,null,_k.SaveLayerInitWithPrevious),null!==(h=this.ctx)&&void 0!==h&&h.translate(this._innerShadowOffsetX,this._innerShadowOffsetY),this.ctx.drawRect(_k.XYWHRect(-1e3-this._innerShadowOffsetX,-1e3-this._innerShadowOffsetY,2e3+o+Math.abs(2*this._innerShadowOffsetX),2e3+d+Math.abs(2*this._innerShadowOffsetY)),t),t.setBlendMode(_k.BlendMode.Clear),this.ctx.drawPath(this._currentPath,t),this.ctx.restore(),this.ctx.restore(),t.delete(),null===(u=e)||void 0===u||u.delete()}}}_paintInner(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.ctx&&this._currentPath&&e){let n=this.ctx,i=this._currentPath;this._applyEffectsToPaint(e,(e=>{let r=!1;!t&&"center"!==this._strokeMode&&(n.save(),n.clipPath(i,"outside"===this._strokeMode?_k.ClipOp.Difference:_k.ClipOp.Intersect,!0),r=!0),n.drawPath(i,e),r&&n.restore()}),t)}}_hasDropShadow(){var e;return(null===(e=this._dropShadowColor)||void 0===e?void 0:e.a)>0}_hasInnerShadow(){var e;return(null===(e=this._innerShadowColor)||void 0===e?void 0:e.a)>0}path(e){var t;null===(t=this._currentPath)||void 0===t||t.addPath(_k.Path.MakeFromSVGString(e))}ellipse(e,t,n,i,r,s,a,o){var l;if(!kk([e,t,n,i])||!this._currentPath)return;if(n<0||i<0)throw Error("radii cannot be negative");let c=_k.XYWHRect(e-n,t-i,2*n,2*i);null===(l=this._currentPath)||void 0===l||l.addOval(c)}rect(e,t,n,i){var r;let s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,l=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,c=_k.XYWHRect(e,t,n,i);if(kk(c))if(0===s&&0===a&&0===l&&0===o)null===(r=this._currentPath)||void 0===r||r.addRect(c);else{var h;let e=_k.RRectXY(c,s,s);e[4]=e[5]=s,e[6]=e[7]=a,e[8]=e[9]=o,e[10]=e[11]=l,null===(h=this._currentPath)||void 0===h||h.addRRect(e)}}getHorizontalAlign(e){switch(e){case 2:return _k.TextAlign.Right;case 3:return _k.TextAlign.Center;case 4:return _k.TextAlign.Justify;default:return _k.TextAlign.Left}}drawTextInner(e,t,n,i,r,s){let[a,o,l,c]=i,h=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],u=0,{ctx:d}=this;if(!d)return u;let p=s.copy(),f=s.copy();return f.setAlphaf(0),this._applyEffectsToPaint(p,(i=>{t.pushPaintStyle(n,i,f),t.addText(e);let s=t.build();s.layout(l);let h=o;2===r?h+=(c-s.getHeight())/2:3===r&&(h+=c-s.getHeight()),d.drawParagraph(s,a,h),u=s.getHeight(),t.reset(),s.delete()}),h),p.delete(),f.delete(),u}drawText(e,t){let n=0,i=this._fonts.get(t.font),{ctx:r,_paintFill:s,_paintStroke:a}=this;if(i&&r){let r=new _k.TextStyle({fontFamilies:[t.font],fontSize:t.fontSize,heightMultiplier:t.lineHeight,letterSpacing:t.letterSpacing}),o=new _k.ParagraphStyle({textStyle:r,textAlign:this.getHorizontalAlign(t.horizontalAlign)}),l=_k.XYWHRect(t.x,t.y,t.width,t.height),c=_k.ParagraphBuilder.Make(o,i);s&&(n=this.drawTextInner(e,c,r,l,t.verticalAlign,s,!0)),a&&(n=this.drawTextInner(e,c,r,l,t.verticalAlign,a,!1)),c.delete()}return{height:n}}render(){var e;null===(e=this._surface)||void 0===e||e.flush()}moveTo(e,t){var n;null===(n=this._currentPath)||void 0===n||n.moveTo(e,t)}lineTo(e,t){var n;null===(n=this._currentPath)||void 0===n||n.lineTo(e,t)}bezierCurveTo(e,t,n,i,r,s){var a;null===(a=this._currentPath)||void 0===a||a.cubicTo(e,t,n,i,r,s)}quadraticCurveTo(e,t,n,i){var r;null===(r=this._currentPath)||void 0===r||r.quadTo(e,t,n,i)}setTransform(e){var t,n,i,r;let s=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this.ctx)return;let a=this.ctx.getTotalMatrix(),o=ok.invert(a);if(o&&this.ctx.concat(o),null!==(t=this.ctx)&&void 0!==t&&t.scale(this.dpr,this.dpr),null!==(n=this.camera)&&void 0!==n&&n.enabled&&(null!==(i=this.ctx)&&void 0!==i&&i.concat(this.camera.worldMatrix),s)){var l;let e=ok.getScale(this.camera.worldMatrix);null===(l=this.ctx)||void 0===l||l.scale(1/e[0],1/e[1])}null!==(r=this.ctx)&&void 0!==r&&r.concat(e),this.currentTransform=e}transform(e){var t;null===(t=this.ctx)||void 0===t||t.concat(e)}setSize(e,t){var n;!this._isSizeDirty&&e===this._width&&t===this._height||(this._isSizeDirty=!1,this._width=e,this._height=t,this.canvas.style.width=e+"px",this.canvas.style.height=t+"px",this.canvas.width=e*this.dpr,this.canvas.height=t*this.dpr,this._surface&&(this._surface=_k.MakeWebGLCanvasSurface(this.canvas),this.ctx=null===(n=this._surface)||void 0===n?void 0:n.getCanvas()))}};function kk(e){for(let t=0;t<e.length;t++)if(void 0!==e[t]&&!Number.isFinite(e[t]))return!1;return!0}function Lk(e){let{r:t,g:n,b:i,a:r}=e;return _k.Color4f(t,n,i,r)}var Bk,zk,Nk,Fk=class{constructor(e,t,n){this.uuid=e,this.data=t,this.enabled=!1,this.color=Qy.transparent,this.blurRadius=0,this.offset=[0,0],this.spread=0,this.update(t)}update(e){void 0!==e.color&&(this.color=e.color),void 0!==e.enabled&&(this.enabled=e.enabled),void 0!==e.blurRadius&&(this.blurRadius=e.blurRadius),void 0!==e.offset&&(this.offset=e.offset),void 0!==e.spread&&(this.spread=e.spread)}},Uk=class{constructor(e,t,n){this.uuid=e,this.data=t,this.enabled=!1,this.radius=0,this.update(t)}update(e){void 0!==e.enabled&&(this.enabled=e.enabled),void 0!==e.radius&&(this.radius=e.radius)}},jk=class{constructor(e,t,n){this.uuid=e,this.data=t,this.enabled=!1,this.color=Qy.transparent,this.update(t)}update(e){void 0!==e.enabled&&(this.enabled=e.enabled),void 0!==e.color&&(this.color=e.color)}},Vk=class{constructor(e,t,n){this.uuid=e,this.data=t,this.enabled=!1,this.color=Qy.transparent,this.thickness=0,this.mode="inside",this.update(t)}update(e){void 0!==e.enabled&&(this.enabled=e.enabled),void 0!==e.color&&(this.color=e.color),void 0!==e.thickness&&(this.thickness=e.thickness),void 0!==e.mode&&(this.mode=e.mode)}},Gk=class extends vk{constructor(e,t,n){super(e,t,n),this.uuid=e,this.data=t,this.autoClose=!0,this.fill=new jk(e+"-fill",t.fill,n),this.stroke=new Vk(e+"-stroke",t.stroke,n),this.dropShadow=new Fk(e+"-dropShadow",t.dropShadow,n),this.innerShadow=new Fk(e+"-innerShadow",t.innerShadow,n),this.backgroundBlur=new Uk(e+"-backgroundBlur",t.backgroundBlur,n),this.layerBlur=new Uk(e+"-layerBlur",t.layerBlur,n)}applyFillStroke(e){e.fillColor=this.fill.enabled?this.fill.color:Qy.transparent,e.strokeColor=this.stroke.enabled&&this.stroke.thickness>0?this.stroke.color:Qy.transparent,e.strokeMode=this.stroke.mode,e.lineWidth=this.stroke.thickness}applyFilters(e){this.layerBlur.enabled?e.layerBlur=5*this.layerBlur.radius:e.layerBlur=0,this.backgroundBlur.enabled?e.backgroundBlur=5*this.backgroundBlur.radius:e.backgroundBlur=0,this.dropShadow.enabled?(e.dropShadowBlur=5*this.dropShadow.blurRadius,e.dropShadowColor=this.dropShadow.color,e.dropShadowOffsetX=this.dropShadow.offset[0],e.dropShadowOffsetY=this.dropShadow.offset[1]):e.dropShadowColor=Qy.transparent,this.innerShadow.enabled?(e.innerShadowSpread=this.innerShadow.spread,e.innerShadowBlur=5*this.innerShadow.blurRadius,e.innerShadowColor=this.innerShadow.color,e.innerShadowOffsetX=this.innerShadow.offset[0],e.innerShadowOffsetY=this.innerShadow.offset[1]):e.innerShadowColor=Qy.transparent}innerDraw(e){}draw(e){!this.visible||(e.save(),this.applyTransforms(e),this.applyFilters(e),this.applyFillStroke(e),e.beginPath(),this.innerDraw(e),this.autoClose&&e.closePath(),this.fill.enabled&&e.fill(),this.stroke.enabled&&e.stroke(),e.restore())}updateByPatchedOp(e,t,n){super.updateByPatchedOp(e,t,n),0===e.type&&(qg(e.path,["fill"])?this.fill.update(e.props):qg(e.path,["stroke"])?this.stroke.update(e.props):qg(e.path,["dropShadow"])?this.dropShadow.update(e.props):qg(e.path,["innerShadow"])?this.innerShadow.update(e.props):qg(e.path,["layerBlur"])?this.layerBlur.update(e.props):qg(e.path,["backgroundBlur"])?this.backgroundBlur.update(e.props):this.resetBBoxNeedsUpdate())}updateState(e,t){super.updateState(e,t),void 0!==e.fill&&this.fill.update(e.fill),void 0!==e.stroke&&this.stroke.update(e.stroke),void 0!==e.dropShadow&&this.dropShadow.update(e.dropShadow),void 0!==e.innerShadow&&this.innerShadow.update(e.innerShadow),void 0!==e.layerBlur&&this.layerBlur.update(e.layerBlur),void 0!==e.backgroundBlur&&this.backgroundBlur.update(e.backgroundBlur)}clone(e){let t=new Gk(this.uuid,this.data,e);return t.parent=void 0,t}},Hk=class extends Gk{constructor(e,t,n){super(e,t,n),this.uuid=e,this.data=t,this.width=0,this.height=0,this.updateState(t,n)}innerDraw(e){e.ellipse(.5*this.width,.5*this.height,.5*this.width,.5*this.height,0,0,2*Math.PI)}intersectsInLocalSpace(e,t){return function(e,t,n,i,r,s){let a=e-n,o=t-i;return a*a/(r*r)+o*o/(s*s)<=1}(e,t,.5*this.width,.5*this.height,.5*this.width,.5*this.height)}getCenter(){return[.5*this.width,.5*this.height]}getHalfSize(){return[.5*this.width,.5*this.height]}updateSizeState(e){let t=!1;void 0!==e.width&&(this.width="number"==typeof e.width?e.width:this.width,t=!0),void 0!==e.height&&(this.height="number"==typeof e.height?e.height:this.height,t=!0),t&&this.updateWorldMatrix(!0,!1,!0)}updateState(e,t){super.updateState(e,t),this.updateSizeState(e)}clone(e){let t=new Hk(this.uuid,this.data,e);return t.parent=void 0,t}},Wk=class extends Gk{constructor(e,t,n){super(e,t,n),this.uuid=e,this.data=t,this.width=0,this.height=0,this.cornerRadius=[0,0,0,0],this.updateState(t,n)}innerDraw(e){e.rect(0,0,this.width,this.height,...this.cornerRadius)}getCenter(){return[.5*this.width,.5*this.height]}getHalfSize(){return[.5*this.width,.5*this.height]}updateCornerState(e){void 0!==e.cornerRadius&&(this.cornerRadius=e.cornerRadius)}updateSizeState(e){let t=!1;void 0!==e.width&&(this.width="number"==typeof e.width?e.width:this.width,t=!0),void 0!==e.height&&(this.height="number"==typeof e.height?e.height:this.height,t=!0),t&&this.updateWorldMatrix(!0,!1,!0)}updateState(e,t){super.updateState(e,t),this.updateSizeState(e),this.updateCornerState(e)}clone(e){let t=new Wk(this.uuid,this.data,e);return t.parent=void 0,t}},qk=class extends Gk{constructor(e,t,n){super(e,t,n),this.uuid=e,this.data=t,this._textHeight=0,this._textHeightDirty=!0,this.width=0,this.height=0,this.updateState(t,n)}get textHeight(){return this._textHeight}applyFillStroke(e){e.fillColor=this.fill.enabled?this.fill.color:Qy.transparent,e.strokeColor=this.stroke.enabled&&this.stroke.thickness>0?this.stroke.color:Qy.transparent,e.strokeMode="center",e.lineWidth=this.stroke.thickness}innerDraw(e){var t,n,i;(null===(t=this._fontHolder)||void 0===t?void 0:t.arrayBuffer)&&this._fontHolder.arrayBuffer.byteLength>1&&this.data.font&&e.registerFont(this._fontHolder.arrayBuffer,this.data.font);let r=this.data.textTransform,s=this.data.text.textValue.toString(),a=2===r?s.toUpperCase():3===r?s.toLowerCase():s,{height:o}=e.drawText(a,{x:0,y:0,width:this.width,height:this.height,fontSize:this.data.fontSize,lineHeight:null!==(n=this.data.lineHeight)&&void 0!==n?n:1,letterSpacing:null!==(i=this.data.letterSpacing)&&void 0!==i?i:0,horizontalAlign:this.data.horizontalAlign,verticalAlign:this.data.verticalAlign,font:this.data.font});this._textHeight=o}getCenter(){return[.5*this.width,.5*this.height]}getHalfSize(){return[.5*this.width,.5*this.height]}updateSizeState(e){let t=!1;void 0!==e.width&&(this.width="number"==typeof e.width?e.width:this.width,t=!0),void 0!==e.height&&(this.height="number"==typeof e.height?e.height:this.height,t=!0),t&&this.updateWorldMatrix(!0,!1,!0)}updateFontState(e,t){let{shared:n}=t;void 0!==e.font&&(this._fontHolder=n.getFont(e.font),this._fontHolder&&!this._fontHolder.isLoaded&&this._fontHolder.loadingPromise.then((()=>{this.requestRender()})))}updateState(e,t){super.updateState(e,t),this.updateSizeState(e),this.updateFontState(e,t)}clone(e){let t=new qk(this.uuid,this.data,e);return t.parent=void 0,t}},Xk=class extends Gk{constructor(e,t,n){super(e,t,n),this.uuid=e,this.data=t,this.curves=[],this.extremasBBox={min:[0,0],max:[0,0]},this.updateState(t,n)}computeExtremas(){0===this.curves.length&&this.computeCurves();let e=this.curves.map((e=>Bk.extremas(e))),t=[1/0,1/0],n=[-1/0,-1/0];for(let i=0,r=e.length;i<r;i++){let r=e[i];r[0][0]<t[0]&&(t[0]=r[0][0]),r[0][1]<t[1]&&(t[1]=r[0][1]),r[1][0]>n[0]&&(n[0]=r[1][0]),r[1][1]>n[1]&&(n[1]=r[1][1])}return this.extremasBBox.min=[t[0],t[1]],this.extremasBBox.max=[n[0],n[1]],this.extremasBBox}computeCurves(){this.curves=[];for(let n=1,i=this.data.points.length;n<i;n++){let e=this.data.points[n].data,t=this.data.points[n-1].data,i={start:t.position,cp1:t.controlNext.position,cp2:e.controlPrevious.position,end:e.position};this.curves.push(i)}let e=this.data.points[0].data,t=this.data.points[this.data.points.length-1].data;if(this.data.isClosed){let n={start:t.position,cp1:t.controlNext.position,cp2:e.controlPrevious.position,end:e.position};this.curves.push(n)}}getCenter(){let[e,t]=this.extremasBBox.min,[n,i]=this.getHalfSize();return[e+n,t+i]}getHalfSize(){let{min:e,max:t}=this.extremasBBox;return[.5*(t[0]-e[0]),.5*(t[1]-e[1])]}innerDraw(e){for(let i=0,r=this.data.points.length;i<r;i++){let t=this.data.points[i].data;if(0===i){let[n,i]=t.position;e.moveTo(n,i)}else{let n=this.data.points[i-1].data,[r,s]=n.controlNext.position,[a,o]=t.controlPrevious.position,[l,c]=t.position,h={start:n.position,cp1:n.controlNext.position,cp2:t.controlPrevious.position,end:t.position};Bk.derive(h),e.bezierCurveTo(r,s,a,o,l,c)}}let t=this.data.points[0].data,n=this.data.points[this.data.points.length-1].data;if(this.data.isClosed){let[i,r]=n.controlNext.position,[s,a]=t.controlPrevious.position,[o,l]=t.position;e.bezierCurveTo(i,r,s,a,o,l)}}updateState(e,t){super.updateState(e,t),this.computeExtremas()}clone(e){let t=new Xk(this.uuid,this.data,e);return t.parent=void 0,t}};(e=>{function t(e,t,n){let i=e-2*t+n;if(0!==i){let r=-Math.sqrt(Math.abs(t*t-e*n)),s=-e+t;return[-(r+s)/i,-(-r+s)/i]}return t!==n&&0===i?[(2*t-n)/(2*(t-n))]:[]}e.derive=function(e){let t=e.start,n=e.cp1,i=e.cp2,r=e.end,s={start:[3*(n[0]-t[0]),3*(n[1]-t[1])],cp:[3*(i[0]-n[0]),3*(i[1]-n[1])],end:[3*(r[0]-i[0]),3*(r[1]-i[1])]};return e.derivative=s,s.derivative=zk.derive(s),s},e.droot=function(n){var i;let r=null!==(i=n.derivative)&&void 0!==i?i:e.derive(n),s=r.start,a=r.cp,o=r.end;return[t(s[0],a[0],o[0]),t(s[1],a[1],o[1])]},e.extremas=function(t){let[n,i]=e.droot(t),r=[t.start[0],t.end[0]],s=[t.start[1],t.end[1]];for(let a of n)r.push(e.compute(t,Math.min(1,Math.max(0,a)))[0]);for(let a of i)s.push(e.compute(t,Math.min(1,Math.max(0,a)))[1]);return r.sort(((e,t)=>e-t)),s.sort(((e,t)=>e-t)),[[r[0],s[0]],[r[r.length-1],s[s.length-1]]]},e.compute=function(e,t){if(0===t)return[...e.start];if(1===t)return[...e.end];let n=1-t,i=n*n,r=t*t,s=i*n,a=i*t*3,o=n*r*3,l=t*r;return[s*e.start[0]+a*e.cp1[0]+o*e.cp2[0]+l*e.end[0],s*e.start[1]+a*e.cp1[1]+o*e.cp2[1]+l*e.end[1]]}})(Bk||(Bk={})),(e=>{e.derive=function(e){let t=e.start,n=e.cp,i=e.end,r={start:[2*(n[0]-t[0]),2*(n[1]-t[1])],end:[2*(i[0]-n[0]),2*(i[1]-n[1])]};return r.derivative=Nk.derive(r),e.derivative=r,r},e.droot=function(t){var n;let i=null!==(n=t.derivative)&&void 0!==n?n:e.derive(t),r=i.start,s=i.end;return[r[0]!==s[0]?r[0]/(r[0]-s[0]):0,r[1]!==s[1]?r[1]/(r[1]-s[1]):0]},e.compute=function(e,t){if(0===t)return[...e.start];if(1===t)return[...e.end];let n=1-t,i=n*n,r=n*t*2,s=t*t;return[i*e.start[0]+r*e.cp[0]+s*e.end[0],i*e.start[1]+r*e.cp[1]+s*e.end[1]]}})(zk||(zk={})),(e=>{e.derive=function(e){let t=e.start,n=e.end,i=[n[0]-t[0],n[1]-t[1]];return e.derivative=i,e.derivative},e.compute=function(e,t){if(0===t)return[...e.start];if(1===t)return[...e.end];let n=e.start,i=e.end;return[n[0]+(i[0]-n[0])*t,n[1]+(i[1]-n[1])*t]}})(Nk||(Nk={}));var Yk=class extends yk{constructor(e,t,n){super(e,t,n),this.uuid=e,this.width=0,this.height=0,this.clipped=!0,this.background=new Wk(e+"-background",nw.defaultData,n),this.background.parent=this,this.updateState(t,n)}get fill(){return this.background.fill}get stroke(){return this.background.stroke}get backgroundBlur(){return this.background.backgroundBlur}get layerBlur(){return this.background.layerBlur}get dropShadow(){return this.background.dropShadow}get innerShadow(){return this.background.innerShadow}get cornerRadius(){return this.background.cornerRadius}set cornerRadius(e){this.background.cornerRadius=e}updateLocalMatrix(){var e;super.updateLocalMatrix(),null===(e=this.background)||void 0===e||e.updateLocalMatrix()}updateWorldMatrix(e,t,n){var i;super.updateWorldMatrix(e,t,n),null===(i=this.background)||void 0===i||i.updateWorldMatrix(e,t,n)}draw(e){if(!this.visible)return;e.save();let t=this.width,n=this.height;this.applyTransforms(e),this.background.width=t,this.background.height=n,this.background.draw(e),this.clipped&&e.clipRect(0,0,t,n,...this.cornerRadius),this.innerDrawChildren(e),e.restore()}getCenter(){return[.5*this.width,.5*this.height]}getHalfSize(){return[.5*this.width,.5*this.height]}updateCornerState(e){void 0!==e.cornerRadius&&(this.cornerRadius=e.cornerRadius)}updateSizeState(e){let t=!1;void 0!==e.width&&(this.width="number"==typeof e.width?e.width:this.width,t=!0),void 0!==e.height&&(this.height="number"==typeof e.height?e.height:this.height,t=!0),t&&this.updateWorldMatrix(!0,!1,!0)}updateState(e,t){super.updateState(e,t),this.updateSizeState(e),this.updateCornerState(e),void 0!==e.fill&&this.fill.update(e.fill),void 0!==e.stroke&&this.stroke.update(e.stroke),void 0!==e.dropShadow&&this.dropShadow.update(e.dropShadow),void 0!==e.innerShadow&&this.innerShadow.update(e.innerShadow),void 0!==e.layerBlur&&this.layerBlur.update(e.layerBlur),void 0!==e.backgroundBlur&&this.backgroundBlur.update(e.backgroundBlur),void 0!==e.clipped&&(this.clipped=e.clipped)}requestRender(){super.requestRender(),this.dispatchEvent({type:"render"})}dispose(){this.removeEventListener("render")}updateByPatchedOp(e,t,n){super.updateByPatchedOp(e,t,n),0===e.type&&(qg(e.path,["fill"])?this.fill.update(e.props):qg(e.path,["stroke"])?this.stroke.update(e.props):qg(e.path,["dropShadow"])?this.dropShadow.update(e.props):qg(e.path,["innerShadow"])?this.innerShadow.update(e.props):qg(e.path,["layerBlur"])?this.layerBlur.update(e.props):qg(e.path,["backgroundBlur"])?this.backgroundBlur.update(e.props):this.resetBBoxNeedsUpdate())}clone(e){let t=new Yk(this.uuid,this.data,e);t.parent=void 0;for(let n of this.children)t.add(n.clone(e));return t}},Qk=A(I(),1),Kk=class extends Gk{constructor(e,t,n){super(e,t,n),this.uuid=e,this.data=t,this._pathBBox=new DOMRect,this.path="",this.updateState(t,n),this.autoClose=!1,this.computeSVGBBox()}computeSVGBBox(){let e=document.createElementNS("http://www.w3.org/2000/svg","svg"),t=document.createElementNS("http://www.w3.org/2000/svg","path");document.body.appendChild(e),t.setAttribute("d",this.path),e.appendChild(t),this._pathBBox=t.getBBox(),e.remove()}innerDraw(e){e.path(this.path)}intersectsInLocalSpace(e,t){return e>=this._pathBBox.x&&e<=this._pathBBox.x+this._pathBBox.width&&t>=this._pathBBox.y&&t<=this._pathBBox.y+this._pathBBox.height}getCenter(){return[(this._pathBBox.x+this._pathBBox.width)/2,(this._pathBBox.y+this._pathBBox.height)/2]}getHalfSize(){return[(this._pathBBox.x+this._pathBBox.width)/2,(this._pathBBox.y+this._pathBBox.height)/2]}updateState(e,t){super.updateState(e,t),void 0!==e.path&&(this.path=e.path,this.computeSVGBBox())}clone(e){let t=new Kk(this.uuid,this.data,e);return t.parent=void 0,t}};var Zk=class{constructor(e,t,n){this.uuid=e,this.data=t,this.group=new bk(Zk.GROUP_ID,o({},aw.defaultData),n),this.createChildrenObjects(t.objects,this.group,n)}createObject(e,t,n,i,r,s){let a=function(e,t,n){switch(t.type){case"ellipse2d":return new Hk(e,t,n);case"rectangle2d":return new Wk(e,t,n);case"text2d":return new qk(e,t,n);case"vector2d":return new Xk(e,t,n);case"path2d":return new Kk(e,t,n);case"frame2d":return new Yk(e,t,n);default:return new bk(e,t,n)}}(e,t,s);a&&(i.add(a),i.children.splice(r,0,i.children.pop()),a.updateWorldMatrix(),n.length>0&&(a instanceof bk||a instanceof Yk)&&this.createChildrenObjects(n,a,s))}createChildrenObjects(e,t,n){let i=0;for(let r of e)this.createObject(r.id,r.data,r.children,t,i,n),i+=1}draw(e){this.group.draw(e)}updateEntityByOp(e,t,n,i){let r=this.find(e);if(r)try{r.updateByOp(t,n,{shared:i})}catch(UZ){console.error(UZ)}}updateTreeByOp(e,t){if(0===e.path.length&&7===e.type){let n=null===e.parent?this.group:this.find(e.parent);void 0!==n&&n instanceof yk&&(this.createObject(e.id,e.data,e.children,n,e.localIndex,t),n.requestRender())}else if(0===e.path.length&&8===e.type){let t=this.find(e.id);if(void 0!==t&&void 0!==t.parent&&t.parent instanceof yk){let e=t.parent;t.resetBBoxNeedsUpdate(),null!==e&&void 0!==e&&e.remove(t),null===e||void 0===e||e.requestRender()}}else if(0===e.path.length&&9===e.type){let t=this.find(e.id);if(void 0!==t){let n=t.parent,i=null===e.parent?this:this.find(e.parent);if(i instanceof yk||i===this){i.add(t);let r=e.localIndex;i.children.splice(r,0,i.children.pop()),t.updateWorldMatrix(!0,!1,!0),null!==n&&void 0!==n&&n.requestRender(),t.requestRender()}t.resetBBoxNeedsUpdate()}}}add(e){this.group.add(e)}remove(e){this.group.remove(e)}traverse(e){this.group.traverse((t=>{t!==this.group&&e(t)}))}intersectsChildren(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[];return this.group.intersectsChildren(e,t,n,i,r,!0)}intersectsChildrenReverse(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[];return this.group.intersectsChildrenReverse(e,t,n,i,r,!0)}find(e){return this.group.find(e)}get children(){return this.group.children}project(e,t){return this.group.project(e,t)}getWithSortKey(e){let t=this.find(e);if(void 0===t)return;let n=[],i=t;for(;i!==this.group;){let e=i;i=i.parent;let t=i.children.indexOf(e);n.splice(0,0,t)}return{entity:t,sortKey:n}}getAllSorted(e){let t=[];for(let n of e){let e=this.getWithSortKey(n.id);void 0!==e&&t.push(e)}return t.sort(((e,t)=>zm(e.sortKey,t.sortKey))),t.map((e=>e.entity))}},Jk=Zk;function $k(e){let{constraints:t,newParentWidth:n,newParentHeight:i,initialParentWidth:r,initialParentHeight:s,objectInitialWidth:a,objectInitialHeight:o,objectInitialPosition:l}=e,{horizontalConstraint:c,verticalConstraint:h}=t,u=n-r,d=i-s,p=a,f=o,m=l[0],g=l[1];if(0!==c)if(1===c)m+=u;else if(3===c)m+=u/2;else if(2===c)p=Math.max(1,p+u);else if(4===c){let e=n/r;p*=e,m*=e}if(0!==h)if(1===h)g+=d;else if(3===h)g+=d/2;else if(2===h)f=Math.max(1,f+d);else if(4===h){let e=i/s;f*=e,g*=e}return{width:p,height:f,position:[m,g]}}Jk.GROUP_ID="scene2d";A(I(),1);var eL=new ar(-1,1,1,-1,0,1),tL=new class extends di{constructor(){super(),this.setAttribute("position",new ri([-1,3,0,-1,-1,0,3,-1,0],3)),this.setAttribute("uv",new ri([0,2,0,0,2,0],2))}},nL=new Ri({defines:{},uniforms:{tDiffuse:new fc(null)},vertexShader:"\n\tvarying vec2 vUv;\n\tvoid main() {\n\t\tvUv = uv;\n\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t}",fragmentShader:"\n\tuniform sampler2D tDiffuse;\n\tvarying vec2 vUv;\n\tvoid main() {\n\t\tvec4 texel = texture2D( tDiffuse, vUv );\n\t\tgl_FragColor = texel;\n\t}"}),iL=new class{constructor(e){this._mesh=new Ci(tL,e)}dispose(){this._mesh.geometry.dispose()}render(e){e.render(this._mesh,eL)}get material(){return this._mesh.material}set material(e){this._mesh.material=e}}(nL),rL=null,sL=null,aL=ok.identity(),oL=class{constructor(e,t,n,i){this.uuid=e,this.width=t,this.height=n,this.context=i,this.enabled=!0,this.isScreenSpace=!1,this.dpr=window.devicePixelRatio,this.isFrameDirty=!1,this.onRenderRequestedDownstream=()=>{this.isFrameDirty=!0,this.context.shared.requestRender()},this._innerApplySize=()=>{let e=this.width,t=this.height,n=this.dpr;this.renderer.dpr=this.isScreenSpace?n:Math.floor(2048/Math.max(e,t)),this.renderer.setSize(e,t)},this.onFrameOverrideObjectEvent=e=>{var t;if(void 0!==(null===(t=e.target)||void 0===t?void 0:t.uuid)){var n;let t=null===(n=this.frameRoot)||void 0===n?void 0:n.find(e.target.uuid);t&&t.dispatchEvent(o(o({},e),{},{target:t}))}},this.scene2d=new Jk(at.generateUUID(),cw.defaultData,{dpr:window.devicePixelRatio,shared:i.shared}),this.canvas=(null===rL&&(rL=document.createElement("canvas")),rL),this.renderer=(e=>(null===sL&&(sL=new Rk(e)),sL))(this.canvas),this.promise=this.init(),this.renderTarget=new It(1,1,{type:ve,stencilBuffer:!1,depthBuffer:!1}),i.shared.addUIBuffer(this.uuid,this.renderTarget),this.textureHolder=i.shared.uiBuffer(this.uuid)}get canvasTexture(){return this._canvasTexture||(this._canvasTexture=new $a(this.canvas)),this._canvasTexture}async init(){this.renderer instanceof Rk&&(this.renderer.wasmURL=ST.skiaWasmUrl),await this.renderer.init()}render(e){if(this.isFrameDirty){var t,n;this.isFrameDirty=!1,this._innerApplySize(),this.renderer.clear(),null!==(t=this.frameOverride)&&void 0!==t&&t.draw(this.renderer),this.renderer.render(),nL.uniforms.tDiffuse.value=this.canvasTexture,this.canvasTexture.needsUpdate=!0;let i=e.getRenderTarget();e.setRenderTarget(this.renderTarget),e.clear(),iL.render(e),e.setRenderTarget(i),null===(n=this.textureHolder)||void 0===n||n.setNeedsUpdate(!0)}}updateEntity2DByOp(e,t,n,i){this.scene2d.updateEntityByOp(e,t,n,i),this.applySize()}updateTreeByOp(e,t){this.scene2d.updateTreeByOp(e,t),this.applySize()}applyOverrides(e){if(this.frameOverride&&this.frameRoot){var t,n;this.frameOverride.position=[0,0],this.frameOverride.rotation=0;let i=null!==(t=null===e||void 0===e?void 0:e.width)&&void 0!==t?t:this.width,r=null!==(n=null===e||void 0===e?void 0:e.height)&&void 0!==n?n:this.height;this.frameOverride.width=i,this.frameOverride.height=r,this.frameOverride.localMatrix=aL,this.isScreenSpace&&(this.frameOverride.fill.color=Qy.from0to1([0,0,0,0])),this.frameOverride.data=o(o({},this.frameOverride.data),{},{width:i,height:r}),lL({objectOverride:this.frameOverride,objectRoot:this.frameRoot,newParentWidth:this.frameOverride.width,newParentHeight:this.frameOverride.height,initialParentWidth:this.frameRoot.width,initialParentHeight:this.frameRoot.height}),this.frameOverride.updateWorldMatrix(!0,!1,!0)}}applySize(e){var t,n,i,r;let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:window.devicePixelRatio,a=Math.max(1,null!==(t=null===e||void 0===e?void 0:e.width)&&void 0!==t?t:this.width),o=Math.max(1,null!==(n=null===e||void 0===e?void 0:e.height)&&void 0!==n?n:this.height);this.dpr=s,this.width=a,this.height=o,this._innerApplySize();let l=1;(a*s<512||o*s<512)&&(l=Math.max(512/(a*s),512/(o*s))),this.renderTarget.setSize(a*s*l,o*s*l),null!==(i=this._canvasTexture)&&void 0!==i&&i.dispose(),this._canvasTexture=void 0,this.applyOverrides(e),null===(r=this.frameOverride)||void 0===r||r.requestRender()}applyFrame(e){var t,n;let i=this.context.scene.find2D(e);if(i&&i instanceof Yk)return this.disposeFrameOverride(),this.frameRoot=i,this.frameOverride=i.clone({dpr:this.renderer.dpr,shared:this.context.shared}),this.scene2d.add(this.frameOverride),this.applySize(),null!==(t=this.frame)&&void 0!==t&&t.addEventListener("render",this.onRenderRequestedDownstream),this.frameOverride.traverse((e=>{e.addEventListener("beginState",this.onFrameOverrideObjectEvent)})),this.frameOverride.traverse((e=>{e.addEventListener("completeState",this.onFrameOverrideObjectEvent)})),null!==(n=this.frame)&&void 0!==n&&n.requestRender(),i}get frame(){return this.frameOverride}get frameId(){var e;return null===(e=this.frame)||void 0===e?void 0:e.uuid}find(e){return this.scene2d.find(e)}get texture(){var e;return null===(e=this.textureHolder)||void 0===e?void 0:e.getTexture(1001)}disposeFrameOverride(){var e,t,n;null!==(e=this.frameOverride)&&void 0!==e&&e.removeEventListener("render",this.onRenderRequestedDownstream),null!==(t=this.frameOverride)&&void 0!==t&&t.traverse((e=>{e.removeEventListener("beginStateChange",this.onFrameOverrideObjectEvent)})),null!==(n=this.frameOverride)&&void 0!==n&&n.traverse((e=>{e.removeEventListener("completeState",this.onFrameOverrideObjectEvent)})),this.frameOverride&&this.scene2d.remove(this.frameOverride)}};function lL(e){let{objectOverride:t,objectRoot:n,newParentWidth:i,newParentHeight:r,initialParentWidth:s,initialParentHeight:a}=e;if(t instanceof Yk&&n instanceof Yk||t instanceof bk&&n instanceof bk)for(let o=0,l=t.children.length;o<l;o++){let e=t.children[o],l=n.children[o];e&&l&&e.uuid===l.uuid&&cL({objectOverride:e,objectRoot:l,newParentWidth:i,newParentHeight:r,initialParentWidth:s,initialParentHeight:a})}}function cL(e){let{objectOverride:t,objectRoot:n,newParentWidth:i,newParentHeight:r,initialParentWidth:s,initialParentHeight:a}=e,[l,c]=function(e){if(uL(e))return[e.width,e.height];if(e instanceof Kk){let[t,n]=e.getHalfSize();return[2*t,2*n]}if(e instanceof bk){let[t,n]=e.recursiveBBox.getHalfSize();return[2*t,2*n]}return[0,0]}(n),{width:h,height:u,position:d}=$k({constraints:t.data,newParentWidth:i,newParentHeight:r,initialParentWidth:s,initialParentHeight:a,objectInitialWidth:l,objectInitialHeight:c,objectInitialPosition:n.position});if(t.position=d,t.data=o(o({},t.data),{},{position:d}),t.states)for(let o in t.states)hL({stateId:o,objectOverride:t,objectRoot:n,newParentWidth:i,newParentHeight:r,initialParentWidth:s,initialParentHeight:a});if(uL(t)||t instanceof bk)uL(t)&&(t.width=h,t.height=u,t.data=o(o({},t.data),{},{width:h,height:u})),lL({objectOverride:t,objectRoot:n,newParentWidth:h,newParentHeight:u,initialParentWidth:l,initialParentHeight:c});else if(t instanceof Kk){let e=n,i=0!==l?h/l:1,r=0!==c?u/c:1;t.path=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;if(t<=0||n<=0)return e;let i=(0,Qk.parseSVG)(e).map((e=>{let i=o({},e);return"x"in i&&(i.x=i.x*t),"y"in i&&(i.y=i.y*n),"x1"in i&&(i.x1=i.x1*t),"x2"in i&&(i.x2=i.x2*t),"y1"in i&&(i.y1=i.y1*n),"y2"in i&&(i.y2=i.y2*n),"rx"in i&&(i.rx=i.rx*t),"ry"in i&&(i.ry=i.ry*n),i}));return function(e){let t,n=["rx","ry","xAxisRotation","largeArc","sweep","x1","y1","x2","y2","x","y"];return e.map((e=>{let i=[];n.forEach((t=>{if(t in e){let n=1*e[t];i.length&&n>=0&&i.push(","),i.push(n)}}));let r=(t===e.code?i[0]<0?"":",":e.code)+i.join("");return t=e.code,r})).join("")}(i)}(e.path,i,r),t.data=o(o({},t.data),{},{path:t.path})}}function hL(e){var t,n;let{stateId:i,objectOverride:r,objectRoot:s,newParentWidth:a,newParentHeight:o,initialParentWidth:l,initialParentHeight:c}=e,h=null===(t=r.states)||void 0===t?void 0:t[i],u=null===(n=s.states)||void 0===n?void 0:n[i];if(h&&u){let{width:e,height:t,position:n}=$k({constraints:r.data,newParentWidth:a,newParentHeight:o,initialParentWidth:l,initialParentHeight:c,objectInitialWidth:lw.isResizeable(u)?u.width:0,objectInitialHeight:lw.isResizeable(u)?u.height:0,objectInitialPosition:u.position});Object.assign(r.states[i],{position:n}),lw.isResizeable(h)&&Object.assign(r.states[i],{width:e,height:t})}}function uL(e){return e instanceof Wk||e instanceof Yk||e instanceof Hk||e instanceof qk}var dL=class extends(g_(Ca)){constructor(e,t,n){super(),this.data=t,this.bgColor=new QC(1,1,1,1),this.fog=null,this.backupFog=new Aa(16777215,.1,2e3),this.fogUseBGColor=!1,this.isActive=!1,this.aoColor=new Et,this.penumbraSizeArrayCache=null,this.super_Entity(e,t),this.personalCamera=new jO(rb,o(o(o({},tx.defaultData),t.camera),{},{name:"Personal Camera"})),this.personalCamera.objectHelper.visible=!1,this.add(this.personalCamera),this.activeCamera=this.personalCamera,this.ambientLight=new Ll(13882323,8553090,.75),this.ambientLight.name="Default Ambient Light",this.ambientLight.layers.enable(3),this.ambientLight.removeFromParent(),this.add(this.ambientLight),t.uiScene?this.uiScene=new Jk((Array.isArray(e)?e[0]:e)+"-ui",t.uiScene,{dpr:window.devicePixelRatio,shared:n.shared}):t.uiFrame&&this.createUICanvas(t.uiFrame,n)}get scene(){return this.parent}get postprocessing(){return this.data.postprocessing}get frameId(){return this.data.uiFrame}get frame(){var e;return null===(e=this.uiCanvas)||void 0===e?void 0:e.frame}createUICanvas(e,t){this.uiCanvas=new oL(this.uuid+"-uiscreen",window.innerWidth,window.innerHeight,t),this.uiCanvas.isScreenSpace=!0,this.uiCanvas.promise.then((()=>{var t,n;null!==(t=this.uiCanvas)&&void 0!==t&&t.applyFrame(e),null===(n=this.uiCanvas)||void 0===n||n.applySize()}))}updateVisible(){}setBackgroundColor(e){this.bgColor=e,!0===this.fogUseBGColor&&(this.backupFog.color=e)}entityChildrenCount(){return this.uiScene?this.uiScene.children.length:super.entityChildrenCount()}updateAmbientLight(e,t){void 0!==e.color&&(this.ambientLight.color=rP(e.color,t)),void 0!==e.intensity&&(this.ambientLight.intensity=e.intensity),void 0!==e.enabled&&(e.enabled?this.add(this.ambientLight):this.remove(this.ambientLight))}onDeactive(){this.isActive=!1}onActive(e){this.isActive=!0,e.fog=this.fog,this.traverseEntity((e=>{e instanceof qO&&e.recomputeBoolean()})),this.updateShadow(this.data.shadow)}forceMaterialsUpdate(){this.traverseEntity((e=>{if(e instanceof MD)if(Array.isArray(e.material))for(let t of e.material)t.needsUpdate=!0;else e.material.needsUpdate=!0,e.material.dispose()}))}updateShadow(e){void 0!==e.softShadowQuality&&this.isActive&&function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"medium";if(XR===e)return!1;XR=e;let t=(e=>{switch(e){case"low":return 8;case"medium":default:return 16;case"high":return 32}})(e);Ki.shadowmap_pars_fragment=(e=>"\n\n// PCSS implementation based on:\n// https://www.gamedev.net/articles/programming/graphics/contact-hardening-soft-shadows-made-fast-r4906/\n// NOTE: This number affects how big the shadow blur can\n// possibly get. Bigger number == bigger blur, but less precise results\n\nconst float  gPenumbraFilterSize = 80.0;\nconst int   gPenumbraSamples = ".concat(e,";\nconst int gShadowSamples = ").concat(e,";\nconst float gShadowSamplesRpc = 1.0f / float(gShadowSamples);\n\n#ifdef USE_SHADOWMAP\n    #if NUM_DIR_LIGHT_SHADOWS > 0\n\n        uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n        varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\n        struct DirectionalLightShadow {\n            float shadowBias;\n            float shadowNormalBias;\n            float shadowRadius;\n            vec2 shadowMapSize;\n        };\n\n        uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\n    #endif\n\n    #if NUM_SPOT_LIGHT_SHADOWS > 0\n\n        uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n        varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\n        struct SpotLightShadow {\n            float shadowBias;\n            float shadowNormalBias;\n            float shadowRadius;\n            vec2 shadowMapSize;\n        };\n\n        uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\n    #endif\n\n    #if NUM_POINT_LIGHT_SHADOWS > 0\n\n        uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n        varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\n        struct PointLightShadow {\n            float shadowBias;\n            float shadowNormalBias;\n            float shadowRadius;\n            vec2 shadowMapSize;\n            float shadowCameraNear;\n            float shadowCameraFar;\n        };\n\n        uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\n    #endif\n\n    /*\n    #if NUM_RECT_AREA_LIGHTS > 0\n\n        // TODO (abelnation): create uniforms for area light shadows\n\n    #endif\n    */\n\nfloat computePenumbra(int index, sampler2D shadowMap, float temporalAngle, float texelSize, vec2 uv, float compare, float texelScalar, float shadowRadius)\n{\n    float penumbra = 1.0;\n    float blockerDepthAvg = 0.0;\n    float blockerCount = 0.0;\n\n    #pragma unroll_loop_start\n    for(int i = 0; i < gPenumbraSamples; i ++)\n    {\n        vec2 offset = (vogelDiskSample(i, gShadowSamples, temporalAngle) * texelSize) * texelScalar;\n        float depth = unpackRGBAToDepth( texture2D( shadowMap, uv + offset ) );\n\n        if(depth < compare + 0.0001)\n        {\n            blockerDepthAvg += depth;\n            blockerCount++;\n        }\n    }\n    #pragma unroll_loop_end\n\n    if (blockerCount > 0.0)\n    {\n        blockerDepthAvg /= blockerCount;\n\n        // Compute penumbra\n        penumbra = (compare - blockerDepthAvg) / (blockerDepthAvg);\n        penumbra *= penumbra;\n        penumbra *= 200.0 * penumbraSize[min(index, ",5," - 1)]; // Magic number that affects how quickly the penumbra grows\n\n        return clamp(penumbra, 0.00, 1.0);\n    }\n    return 0.0;\n}\n\nfloat vogelShadow(int index, sampler2D shadowMap, vec2 uv, float texelSize, float compare, float shadowRadius)\n{\n    float shadow         = 0.0f;\n\n    // NOTE: When using TAA, we should use screen space interleaved gradient noise\n    vec2 halton = haltonSequence[frameIndex];\n    float temporalOffset = getNoiseInterleavedGradient(gl_FragCoord.xy + halton);\n    float temporalAngle  = temporalOffset * PI2;\n\n    float texelScalar = (gPenumbraFilterSize) / (texelSize * 1024.);\n    float penumbra = computePenumbra(index, shadowMap, temporalAngle, texelSize, uv, compare, texelScalar, shadowRadius);\n    if (penumbra == -1.0) {\n        return 1.0;\n    }\n\n    #pragma unroll_loop_start\n    for (int i = 0; i < gShadowSamples; i++)\n    {\n        vec2 vogelSample =  vogelDiskSample(i, gShadowSamples, temporalAngle) * texelSize;\n        // Overall blurring offset\n        vec2 offset = vogelSample * (shadowRadius * 2.);\n\n        // Penumbra offset\n        offset += vogelSample * (penumbra * texelScalar);\n\n        shadow += step( compare, unpackRGBAToDepth( texture2D( shadowMap, uv + offset ) ) );\n    }\n    #pragma unroll_loop_end\n\n    return shadow * gShadowSamplesRpc;\n}\n\n\n    float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\n        return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\n    }\n\n    vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\n        return unpackRGBATo2Half( texture2D( shadow, uv ) );\n\n    }\n\n    float VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\n        float occlusion = 1.0;\n\n        vec2 distribution = texture2DDistribution( shadow, uv );\n\n        float hard_shadow = step( compare , distribution.x ); // Hard Shadow\n\n        if (hard_shadow != 1.0 ) {\n\n            float distance = compare - distribution.x ;\n            float variance = max( 0.00000, distribution.y * distribution.y );\n            float softness_probability = variance / (variance + distance * distance ); // Chebeyshevs inequality\n            softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 ); // 0.3 reduces light bleed\n            occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\n        }\n        return occlusion;\n\n    }\n\n    float getShadow( int i, sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\n        float shadow = 1.0;\n\n        shadowCoord.xyz /= shadowCoord.w;\n        shadowCoord.z += shadowBias;\n\n        // if ( something && something ) breaks ATI OpenGL shader compiler\n        // if ( all( something, something ) ) using this instead\n\n        bvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n        bool inFrustum = all( inFrustumVec );\n\n        bvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\n        bool frustumTest = all( frustumTestVec );\n\n        if ( frustumTest ) {\n\n        #if defined( SHADOWMAP_TYPE_PCF )\n\n            vec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n            return vogelShadow(i, shadowMap, shadowCoord.xy, texelSize.x, shadowCoord.z, shadowRadius );\n\n        #elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\n            vec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n            float dx = texelSize.x;\n            float dy = texelSize.y;\n\n            vec2 uv = shadowCoord.xy;\n            vec2 f = fract( uv * shadowMapSize + 0.5 );\n            uv -= f * texelSize;\n\n            shadow = (\n                texture2DCompare( shadowMap, uv, shadowCoord.z ) +\n                texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n                texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n                texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n                mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),\n                     texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n                     f.x ) +\n                mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),\n                     texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n                     f.x ) +\n                mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),\n                     texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n                     f.y ) +\n                mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),\n                     texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n                     f.y ) +\n                mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),\n                          texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n                          f.x ),\n                     mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),\n                          texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n                          f.x ),\n                     f.y )\n            ) * ( 1.0 / 9.0 );\n\n        #elif defined( SHADOWMAP_TYPE_VSM )\n\n            shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\n        #else // no percentage-closer filtering:\n\n            shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\n        #endif\n\n        }\n\n        return shadow;\n\n    }\n\n    // cubeToUV() maps a 3D direction vector suitable for cube texture mapping to a 2D\n    // vector suitable for 2D texture mapping. This code uses the following layout for the\n    // 2D texture:\n    //\n    // xzXZ\n    //  y Y\n    //\n    // Y - Positive y direction\n    // y - Negative y direction\n    // X - Positive x direction\n    // x - Negative x direction\n    // Z - Positive z direction\n    // z - Negative z direction\n    //\n    // Source and test bed:\n    // https://gist.github.com/tschw/da10c43c467ce8afd0c4\n\n    vec2 cubeToUV( vec3 v, float texelSizeY ) {\n\n        // Number of texels to avoid at the edge of each square\n\n        vec3 absV = abs( v );\n\n        // Intersect unit cube\n\n        float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n        absV *= scaleToCube;\n\n        // Apply scale to avoid seams\n\n        // two texels less per square (one texel will do for NEAREST)\n        v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\n        // Unwrap\n\n        // space: -1 ... 1 range for each square\n        //\n        // #X##         dim    := ( 4 , 2 )\n        //  # #         center := ( 1 , 1 )\n\n        vec2 planar = v.xy;\n\n        float almostATexel = 1.5 * texelSizeY;\n        float almostOne = 1.0 - almostATexel;\n\n        if ( absV.z >= almostOne ) {\n\n            if ( v.z > 0.0 )\n                planar.x = 4.0 - v.x;\n\n        } else if ( absV.x >= almostOne ) {\n\n            float signX = sign( v.x );\n            planar.x = v.z * signX + 2.0 * signX;\n\n        } else if ( absV.y >= almostOne ) {\n\n            float signY = sign( v.y );\n            planar.x = v.x + 2.0 * signY + 2.0;\n            planar.y = v.z * signY - 2.0;\n\n        }\n\n        // Transform to UV space\n\n        // scale := 0.5 / dim\n        // translate := ( center + 0.5 ) / dim\n        return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\n    }\n\n    float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\n        float shadow = 1.0;\n        vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\n        // for point lights, the uniform @vShadowCoord is re-purposed to hold\n        // the vector from the light to the world-space position of the fragment.\n        vec3 lightToPosition = shadowCoord.xyz;\n\n        // dp = normalized distance from light to fragment position\n        float compare = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear ); // need to clamp?\n        compare += shadowBias;\n\n        // bd3D = base direction 3D\n        vec3 bd3D = normalize( lightToPosition );\n\n        vec2 halton = haltonSequence[frameIndex];\n        float temporalOffset = getNoiseInterleavedGradient(gl_FragCoord.xy + halton);\n        float temporalAngle  = temporalOffset * PI2;\n\n        #if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_VSM )\n            for (int i = 0; i < gShadowSamples; i++) {\n                vec2 vogelSample = vogelDiskSample(i, gShadowSamples, temporalAngle) * texelSize;\n\n                // Overall blurring offset\n                vec3 offset = vec3(vogelSample.x, vogelSample.y, -vogelSample.x) * (shadowRadius + 5.);\n\n                // NOTE: Removed for now\n                // Penumbra offset\n                //offset += vec3(vogelSample.x, vogelSample.y, vogelSample.y)  * (penumbra * gPenumbraFilterSize);\n\n                shadow += texture2DCompare( shadowMap, cubeToUV( bd3D + offset, texelSize.y ), compare );\n\n            }\n            return shadow * gShadowSamplesRpc;\n\n        #elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n            for (int i = 0; i < 16; i++) {\n                vec2 vogelSample = vogelDiskSample(i, gShadowSamples, temporalAngle) * texelSize;\n\n                // Overall blurring offset\n                vec3 offset = vec3(vogelSample.x, vogelSample.y, -vogelSample.x) * (shadowRadius + 5.);\n\n                shadow += texture2DCompare( shadowMap, cubeToUV( bd3D + offset, texelSize.y ), compare );\n\n            }\n            return shadow * (1.0 / 16.0);\n        #else // no percentage-closer filtering\n\n            return texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), compare );\n\n        #endif\n\n    }\n\n#endif\n"))(t);let n=WR.slice();n=n.replace("getShadow( spotShadowMap[ i ]","getShadow( UNROLLED_LOOP_INDEX + ".concat(3,", spotShadowMap[ i ]")),n=n.replace("getShadow( directionalShadowMap[ i ]","getShadow( UNROLLED_LOOP_INDEX, directionalShadowMap[ i ]"),Ki.lights_fragment_begin=n;let i=qR.slice();return i=i.replaceAll("getShadow(","getShadow( UNROLLED_LOOP_INDEX, "),Ki.shadowmask_pars_fragment=i,!0}(e.softShadowQuality)&&this.forceMaterialsUpdate()}updateFog(e,t){if(e.enabled?this.fog=this.backupFog:this.fog=null,this.isActive){this.scene.fog=this.fog}this.fogUseBGColor=e.useBackgroundColor,e.useBackgroundColor?this.backupFog.color.set(this.bgColor):this.backupFog.color=rP(e.color,t),this.backupFog.near=e.near,this.backupFog.far=e.far}updateAo(e,t){void 0!==e.aoColor&&(this.aoColor=rP(e.aoColor,t))}updateByOp(e,t,n,i){let r=this.data.uiFrame;super.updateByOp(e,t,n,i);let s=t;qg(e.path,["fog"])?this.updateFog(s.fog,n.shared):qg(e.path,["ao"])?this.updateAo(s.ao,n.shared):qg(e.path,["ambient"])?this.updateAmbientLight(s.ambient,n.shared):qg(e.path,["shadow"])?this.updateShadow(s.shadow):0===e.type&&0===e.path.length&&(void 0!==e.props.uiFrame||r!==s.uiFrame)&&this.updateUIFrame(e.props.uiFrame,n)}updateUIFrame(e,t){e?(this.uiCanvas||this.createUICanvas(e,t),this.uiCanvas.enabled=!0,this.uiCanvas.applyFrame(e)):this.uiCanvas&&(this.uiCanvas.enabled=!1)}updateState(e,t){this.updateState_Entity(e,t),void 0!==e.backgroundColor&&this.setBackgroundColor(rP(e.backgroundColor,t.shared)),void 0!==e.fog&&this.updateFog(e.fog,t.shared),void 0!==e.ambient&&this.updateAmbientLight(e.ambient,t.shared),void 0!==e.ao&&this.updateAo(e.ao,t.shared),void 0!==e.shadow&&this.updateShadow(e.shadow)}createFrame(e,t){}raycast(e,t){super.raycast(e,t)}switchActiveCamera(e){e&&e.isDescendantOf(this)&&(this.activeCamera!==this.personalCamera&&(this.activeCamera.objectHelper.visible=!0),this.activeCamera=e,e.objectHelper.visible=!1)}get playCamera(){var e,t;return null!==(e=null===(t=this.scene)||void 0===t?void 0:t.find(this.data.publish.playCamera))&&void 0!==e?e:this.personalCamera}switchToPlayCamera(){this.switchActiveCamera(this.playCamera)}get penumbraSizeArray(){return null===this.penumbraSizeArrayCache&&this.updatePenumbraSizeArray(),this.penumbraSizeArrayCache}updatePenumbraSizeArray(){this.penumbraSizeArrayCache=new Array(5).fill(.5);let e=0,t=0;this.traverseEntity((n=>{var i,r;if(!n.visible)return!0;n instanceof lk&&n.visible&&e<3&&(this.penumbraSizeArrayCache[e]=null!==(i=n.data.penumbraSize)&&void 0!==i?i:.5,e+=1),n instanceof dk&&n.visible&&e<2&&(this.penumbraSizeArrayCache[3+t]=null!==(r=n.data.penumbraSize)&&void 0!==r?r:.5,t+=1)}))}raycastWithClones(e){let t=[],n=i=>{for(let r of i.children){let i=r.cloner;XS.is(r)&&(r.visible||(null===i||void 0===i?void 0:i.object.data.visible))&&((YO(r)||KO(r)&&this.scene.enableHelpers&&r.objectHelper.visible)&&(e.intersectObject(r,!1,t),oB(r,e,t,!0)),n(r))}};return n(this),t}updateEntity2DByOp(e,t,n,i){var r;null===(r=this.uiCanvas)||void 0===r||r.updateEntity2DByOp(e,t,n,i)}},pL=class extends(XO(ql,$R)){constructor(e,t,n){super(),this.super_Entity(e,t),this.castShadow=!0,this.shadow.mapSize.width=1024,this.shadow.mapSize.height=1024,this.shadow.normalBias=1,this.layers.enable(3);let i=this.shadow.camera;i.fov=90,i.aspect=1,i.near=100,i.far=2500;let r=new Bt(-i.far+this.position.x,-i.far+this.position.y,-i.far+this.position.z),s=new Bt(i.far+this.position.x,i.far+this.position.y,i.far+this.position.z),a=new Ft(r,s),o=new Lc(a,new Et(16755200));o.visible=!1,this.gizmos.shadowmap=o,this.update()}update(){if(this.shadow&&(this.shadow.camera.updateProjectionMatrix(),this.gizmos))for(let e in this.gizmos){let t=this.gizmos[e];if(t instanceof Lc){let e=this.shadow.camera,n=new Bt(-e.far+this.position.x,-e.far+this.position.y,-e.far+this.position.z),i=new Bt(e.far+this.position.x,e.far+this.position.y,e.far+this.position.z);t.box.set(n,i),t.updateMatrixWorld(!0)}}}updateMatrixWorld(e){super.updateMatrixWorld(e),this.objectHelper&&this.objectHelper.update()}updateState(e,t){this.updateState_Light(e,t),void 0!==e.distance&&(this.distance=e.distance),void 0!==e.decay&&(this.decay=e.decay),void 0!==e.shadowRadius&&(this.shadow.radius=e.shadowRadius),void 0!==e.shadowResolution&&(this.shadow.mapSize.set(e.shadowResolution,e.shadowResolution),this.shadow.map&&(this.shadow.map.dispose(),this.shadow.map=null))}},fL=class extends RD{get forceComputeSize(){return!0}get shape(){return this.geometry.userData.shape}updateEntityBoxSize(e,t){let n=this.geometry.getAttribute("position");void 0!==n?zC(n,this.geometry.drawRange.start,this.geometry.drawRange.count<1/0?this.geometry.drawRange.count:n.count,e,t):super.updateEntityBoxSize(e,t)}},mL=class extends RD{constructor(e,t,n){super(e,t,n),this._shapeId=null,this._context=n}updateState(e,t){super.updateState(e,t),this.updateShape(),this.refreshAttachedCloners(t)}updateShape(){let e,t=o({},this.data.geometry.extrusion.shape);for(let r in t)"string"==typeof t[r]&&(t[r]=this._context.shared.getVariable(t[r],[this.uuid,"geometry","extrusion","shape",r]));if("Custom"===t.type){let i=t.shapeId;if(i!==this._shapeId&&this.detachShape(),i){var n;this._shapeId=i;let t=this._context.scene.find(i);null!==t&&void 0!==t&&t.data&&(t.attachedPaths.add(this),e=null===(n=t.geometry.userData)||void 0===n?void 0:n.shape),e||this._context.scene.addPendingCommand((()=>this.updateShape()))}}else{let n;switch(t.type){case"Rectangle":n=_A;break;case"Ellipse":n=VE;break;case"Polygon":n=yA;break;case"Star":n=AA;break;default:throw new Error("Unknown shape type: ".concat(t.type))}e=n.create({parameters:t}).userData.shape}let i=this.geometry;e&&i.inputs&&(i.inputs.shapeData=e,i.build())}detachShape(){var e;null!==this._shapeId&&(null===(e=this._context.scene.find(this._shapeId))||void 0===e||e.attachedPaths.delete(this))}createGeometryDelayed(e){this.geometryCreateDeleyed=e.shared,this.updateShape(),this.refreshAttachedPaths(e)}updateTransformState(e,t){return super.updateTransformState(e,t)}updateGeometryInteractions(e,t){super.updateGeometryInteractions(e,t),this.updateShape()}updateEntityBoxSize(e,t){let n=this.geometry.getAttribute("position");void 0!==n?zC(n,this.geometry.drawRange.start,this.geometry.drawRange.count<1/0?this.geometry.drawRange.count:n.count,e,t):super.updateEntityBoxSize(e,t)}},gL=class extends cO{constructor(e,t,n){super(e,t,n),this.data=t}},vL=class extends(kO(va,tI)){constructor(e,t,n){super(),"Instance"===t.type&&"string"==typeof e&&(t=this.transformAssignData(t,n)),this.super_Entity(e,t),this.objectHelper.update()}get isComponentRoot(){return"Component"===this.data.type&&"string"==typeof this.identity}get isInstanceRoot(){return"Instance"===this.data.type&&"string"==typeof this.identity}transformAssignData(e,t){let n=Hx.getComponentData({scene:t.scene.data,shared:t.shared.data},e.component);if(n){let t,i;for(let r of rx.rootOverrideProps)void 0===e[r]?(void 0===t&&(t=o({},e)),t[r]=n.data[r]):(void 0===i&&(i={}),i[r]=e[r],void 0===t&&(t=o({},e)),t[r]=mg.apply(n.data[r],e[r]));return this.overrideData=i,t}return o(o(o({},Qb.defaultData),e),Am(Qb.defaultData,rx.rootOverrideProps))}updateByOp(e,t,n,i){let r;if(this.isInstanceRoot&&!i)if(t=this.transformAssignData(t,n),0===e.type&&0===e.path.length&&this.component)for(let s of rx.rootOverrideProps)s in e.props&&void 0===e.props[s]&&(void 0===r&&(r=o(o({},e),{},{props:o({},e.props)})),r.props[s]=this.component.data[s]);else if(0===e.type&&e.path.length>0&&rx.rootOverrideProps.includes(e.path[0])){let n=e.path[0];void 0===r&&(r=o(o({},e),{},{path:[],props:{[n]:t[n]}}))}super.updateByOp(null!==r&&void 0!==r?r:e,t,n,i)}updateState(e,t){this.updateState_Entity(e,t)}expandInstanceChildren(e){let t=this.data;if(void 0===this.component){var n;let i=null!==(n=e.scene.find(t.component))&&void 0!==n?n:null,r=!1;if(i!==this.oldComponent){if(this.oldComponent){let t=0;for(let n of this.children){if(!XS.is(n))break;e.scene.disposeAndUnregisterEntityRecursivelyIfNotReregistered(n),yL(n),t+=1}this.children.splice(0,t)}r=!0}if(i){let n={};xL(e,[this.uuid],t.overrides,this,i,i,0,r,n);for(let t of this.children)if(XS.is(t)){let i=t.data;"Empty"===i.type&&i.animations&&t.traverseEntity((t=>{let i=t.dataPatched;if(t instanceof RD&&i.bones&&i.boneInverses){let i=t.dataPatched;if(i.bones&&i.boneInverses){let r=i.bones.map((t=>e.scene.find(n[t]))),s=i.boneInverses.map((e=>(new pn).fromArray(e))),a=new ka(r,s);t.bind(a,t.bindMatrix)}}else t.matrixAutoUpdate=!0}))}}this.oldComponent=this.component}}};function yL(e){if(e.component){let t=e.component.instances.indexOf(e);t>=0&&e.component.instances.splice(t,1);for(let n of e.children)XS.is(n)&&yL(n)}}function bL(e,t,n,i){return e.component===t&&fm(e.identity,i)?e.overrideData===n?2:1:0}function xL(e,t,n,i,r,s,a,l,c){if(a>50)return!1;if(i.component!==r){if(i.component){let e=i.component.instances.indexOf(i);e>=0&&i.component.instances.splice(e,1)}r.instances.find((e=>e===i))||r.instances.push(i),i.component=r}r instanceof vL&&r.isInstanceRoot&&r.expandInstanceChildren(e);let h=0;for(let d of r.children)if(XS.is(d)){let r=[...t,..."string"==typeof d.identity?[d.identity]:d.identity],p=ix.resolve(n,r,1);null==p||p instanceof bg||(Object.setPrototypeOf(p,bg.prototype),console.error("wrong prototype"));let f,m=null;if(!l){var u;let t=i.children[h];if(m=XS.is(t)?t:null,null!==m){let e=bL(m,d,p,r);f=e>=1?m.stateSelection:void 0,2!==e&&(m=null)}if(null===m&&(m=null!==(u=e.scene.findInstance(r))&&void 0!==u?u:null,null!==m)){let t=bL(m,d,p,r);if(f=t>=1?m.stateSelection:void 0,2!==t)m=null;else{let t=m.parent.children.indexOf(m);m.parent.children.splice(t,1),i.children.splice(h,0,m),m.parent===i?t<=h&&console.error("not possible"):(m.parent=i,m.matrixWorldNeedsUpdate=!0,m.resetBBoxNeedsUpdate(),m.updateVisible(),e.pendingDeletes.delete(m))}}}if(null===m){let t=p?mg.apply(d.data,p):d.data;eb.is(t.type)&&(t=o(o({},t),{},{type:"Empty"})),m=s_.createEntity(r,t,e),m.overrideData=p,i.add(m),i.children.splice(i.children.length-1,1),i.children.splice(h,0,m),m.updateState(m.data,e),f&&m.changeSelectedState(f,e),e.scene.registerInstanceAndSetUuid(m)}if(m.isBone){c[m.identity[m.identity.length-1]]=m.uuid}h+=1,xL(e,t,n,m,d,s,a+1,l,c)}if(!l){let t=h;for(;;){let t=i.children[h];if(!XS.is(t))break;e.pendingDeletes.add(t),h+=1}i.children.splice(t,h-t)}return!0}var wL=class extends(kO(Da,tI)){constructor(e,t){super(),this.super_Entity(e,t),this.objectHelper.update(),this.matrixAutoUpdate=!0}updateState(e,t){this.updateState_Entity(e,t)}},SL=class extends RD{constructor(e,t,n){super(e,t,n),this.onBeforeRender=e=>{this.uiCanvas.render(e)},this.uiCanvas=new oL(e+"-canvas",t.geometry.width,t.geometry.height,n),this.uiCanvas.promise.then((()=>{this.applyFrame(this.dataPatched.geometry.frame,n.shared)}))}updateByPatchedOpGeometry(e,t,n){super.updateByPatchedOpGeometry(e,t,n),0===e.type&&(void 0!==e.props.frame&&this.applyFrame(e.props.frame,n.shared),(void 0!==e.props.width||void 0!==e.props.height)&&this.applySize(e.props,n.shared))}applySize(e,t){var n,i;let r=null!==(n=null===e||void 0===e?void 0:e.width)&&void 0!==n?n:this.dataPatched.geometry.width,s=null!==(i=null===e||void 0===e?void 0:e.height)&&void 0!==i?i:this.dataPatched.geometry.height;this.uiCanvas.applySize({width:r,height:s}),this.applyGeometryParametersFromFrame(t)}applyFrame(e,t){this.uiCanvas.applyFrame(e),this.applyGeometryParametersFromFrame(t),this.applyMaterialParametersFromFrame({shared:t})}applyGeometryParametersFromFrame(e){var t;let n=this.frame;n&&(Object.assign(this.data,{geometry:Object.assign(this.data.geometry,{cornerRadius:n.cornerRadius,cornerType:0})}),Object.assign(this.dataPatched,{geometry:Object.assign(this.dataPatched.geometry,{cornerRadius:n.cornerRadius,cornerType:0})}),null!==(t=this.localGeometry)&&void 0!==t&&t.dispose(),this.localGeometry=eC(this.dataPatched.geometry,e,this.data.flatShading,this))}applyMaterialParametersFromFrame(e){let t=this.frame;if(t){let n=t.data.backgroundBlur;Object.assign(this.data.material.layers[0].data.texture,{image:this.uiCanvas.uuid}),Object.assign(this.data.material.layers[1].data,{roughness:n.radius,alpha:n.enabled?1:0}),Object.assign(this.dataPatched.material.layers[0].data.texture,{image:this.uiCanvas.uuid}),Object.assign(this.dataPatched.material.layers[1].data,{roughness:n.radius,alpha:n.enabled?1:0}),this.material.reset(this.dataPatched.material,e,!0)}}updateEntity2DByOp(e,t,n,i){this.uiCanvas.updateEntity2DByOp(e,t,n,i),e===this.frameId&&0===t.type&&(void 0!==t.props.cornerRadius?this.applyGeometryParametersFromFrame(i):qg(t.path,["backgroundBlur"])&&this.applyMaterialParametersFromFrame({shared:i}))}get frame(){return this.uiCanvas.frame}get frameId(){var e;return null===(e=this.frame)||void 0===e?void 0:e.uuid}removeInteractionGeometry(e){super.removeInteractionGeometry(e),this.applySize({},e)}updateGeometryInteractions(e,t){super.updateGeometryInteractions(e,t),this.applySize({width:e.width,height:e.height},t)}},_L=class{constructor(e,t,n){this.variables=[],this.currentTextureIndex=0;let i=ge,r=new Ca,s=new ki;s.position.z=1;let a={passThruTexture:{value:null}},o=h("uniform sampler2D passThruTexture;\n\nvoid main() {\n\n\tvec2 uv = gl_FragCoord.xy / resolution.xy;\n\n\tgl_FragColor = texture2D( passThruTexture, uv );\n\n}\n",a),l=new Ci(new Qi(2,2),o);function c(n){n.defines.resolution="vec2( "+e.toFixed(1)+", "+t.toFixed(1)+" )"}function h(e,t){let n=new Ri({uniforms:t=t||{},vertexShader:"void main()\t{\n\n\tgl_Position = vec4( position, 1.0 );\n\n}\n",fragmentShader:e});return c(n),n}r.add(l),this.setDataType=function(e){return i=e,this},this.addVariable=function(e,t,n){let i={name:e,initialValueTexture:n,material:this.createShaderMaterial(t),dependencies:null,renderTargets:[],wrapS:null,wrapT:null,minFilter:le,magFilter:le};return this.variables.push(i),i},this.setVariableDependencies=function(e,t){e.dependencies=t},this.init=function(){if(!1===n.capabilities.isWebGL2&&!1===n.extensions.has("OES_texture_float"))return"No OES_texture_float support for float textures.";if(0===n.capabilities.maxVertexTextures)return"No support for vertex shader textures.";for(let n=0;n<this.variables.length;n++){let i=this.variables[n];i.renderTargets[0]=this.createRenderTarget(e,t,i.wrapS,i.wrapT,i.minFilter,i.magFilter),i.renderTargets[1]=this.createRenderTarget(e,t,i.wrapS,i.wrapT,i.minFilter,i.magFilter),this.renderTexture(i.initialValueTexture,i.renderTargets[0]),this.renderTexture(i.initialValueTexture,i.renderTargets[1]);let r=i.material,s=r.uniforms;if(null!==i.dependencies)for(let e=0;e<i.dependencies.length;e++){let t=i.dependencies[e];if(t.name!==i.name){let e=!1;for(let n=0;n<this.variables.length;n++)if(t.name===this.variables[n].name){e=!0;break}if(!e)return"Variable dependency not found. Variable="+i.name+", dependency="+t.name}s[t.name]={value:null},r.fragmentShader="\nuniform sampler2D "+t.name+";\n"+r.fragmentShader}}return this.currentTextureIndex=0,null},this.compute=function(){let e=this.currentTextureIndex,t=0===this.currentTextureIndex?1:0;for(let n=0,i=this.variables.length;n<i;n++){let i=this.variables[n];if(null!==i.dependencies){let t=i.material.uniforms;for(let n=0,r=i.dependencies.length;n<r;n++){let r=i.dependencies[n];t[r.name].value=r.renderTargets[e].texture}}this.doRenderTarget(i.material,i.renderTargets[t])}this.currentTextureIndex=t},this.getCurrentRenderTarget=function(e){return e.renderTargets[this.currentTextureIndex]},this.getAlternateRenderTarget=function(e){return e.renderTargets[0===this.currentTextureIndex?1:0]},this.dispose=function(){l.geometry.dispose(),l.material.dispose();let e=this.variables;for(let t=0;t<e.length;t++){let n=e[t];n.initialValueTexture&&n.initialValueTexture.dispose();let i=n.renderTargets;for(let e=0;e<i.length;e++)i[e].dispose()}},this.addResolutionDefine=c,this.createShaderMaterial=h,this.createRenderTarget=function(n,r,s,a,o,l){return new It(n=n||e,r=r||t,{wrapS:s=s||ae,wrapT:a=a||ae,minFilter:o=o||le,magFilter:l=l||le,format:be,type:i,depthBuffer:!1})},this.createTexture=function(){let n=new Float32Array(e*t*4),i=new Oa(n,e,t,be,ge);return i.needsUpdate=!0,i},this.renderTexture=function(e,t){a.passThruTexture.value=e,this.doRenderTarget(o,t),a.passThruTexture.value=null},this.doRenderTarget=function(e,t){let i=n.getRenderTarget(),a=n.xr.enabled,c=n.shadowMap.autoUpdate,h=n.outputEncoding,u=n.toneMapping;n.xr.enabled=!1,n.shadowMap.autoUpdate=!1,n.outputEncoding=ze,n.toneMapping=0,l.material=e,n.setRenderTarget(t),n.render(r,s),l.material=o,n.xr.enabled=a,n.shadowMap.autoUpdate=c,n.outputEncoding=h,n.toneMapping=u,n.setRenderTarget(i)}}},EL=new Qn,AL=new Bt,CL=class{constructor(e){let t=e.geometry;if(!t.isBufferGeometry||3!==t.attributes.position.itemSize)throw new Error("THREE.MeshSurfaceSampler: Requires BufferGeometry triangle mesh.");t.index&&(console.warn("THREE.MeshSurfaceSampler: Converting geometry to non-indexed BufferGeometry."),t=t.toNonIndexed()),this.geometry=t,this.randomFunction=Math.random,this.positionAttribute=this.geometry.getAttribute("position"),this.colorAttribute=this.geometry.getAttribute("color"),this.weightAttribute=null,this.distribution=null}setWeightAttribute(e){return this.weightAttribute=e?this.geometry.getAttribute(e):null,this}build(){let e=this.positionAttribute,t=this.weightAttribute,n=new Float32Array(e.count/3);for(let r=0;r<e.count;r+=3){let i=1;t&&(i=t.getX(r)+t.getX(r+1)+t.getX(r+2)),EL.a.fromBufferAttribute(e,r),EL.b.fromBufferAttribute(e,r+1),EL.c.fromBufferAttribute(e,r+2),i*=EL.getArea(),n[r/3]=i}this.distribution=new Float32Array(e.count/3);let i=0;for(let r=0;r<n.length;r++)i+=n[r],this.distribution[r]=i;return this}setRandomGenerator(e){return this.randomFunction=e,this}sample(e,t,n){let i=this.distribution[this.distribution.length-1],r=this.binarySearch(this.randomFunction()*i);return this.sampleFace(r,e,t,n)}binarySearch(e){let t=this.distribution,n=0,i=t.length-1,r=-1;for(;n<=i;){let s=Math.ceil((n+i)/2);if(0===s||t[s-1]<=e&&t[s]>e){r=s;break}e<t[s]?i=s-1:n=s+1}return r}sampleFace(e,t,n,i){let r=this.randomFunction(),s=this.randomFunction();return r+s>1&&(r=1-r,s=1-s),EL.a.fromBufferAttribute(this.positionAttribute,3*e),EL.b.fromBufferAttribute(this.positionAttribute,3*e+1),EL.c.fromBufferAttribute(this.positionAttribute,3*e+2),t.set(0,0,0).addScaledVector(EL.a,r).addScaledVector(EL.b,s).addScaledVector(EL.c,1-(r+s)),void 0!==n&&EL.getNormal(n),void 0!==i&&void 0!==this.colorAttribute&&(EL.a.fromBufferAttribute(this.colorAttribute,3*e),EL.b.fromBufferAttribute(this.colorAttribute,3*e+1),EL.c.fromBufferAttribute(this.colorAttribute,3*e+2),AL.set(0,0,0).addScaledVector(EL.a,r).addScaledVector(EL.b,s).addScaledVector(EL.c,1-(r+s)),i.r=AL.x,i.g=AL.y,i.b=AL.z),this}};function ML(e,t){let n=e,i=new Float32Array(4*t*t);for(let s=0;s<t*t;s++)i[4*s]=n[3*s],i[4*s+1]=n[3*s+1],i[4*s+2]=n[3*s+2],i[4*s+3]=0;let r=new Oa(i,t,t,be,ge);return r.needsUpdate=!0,r}var TL="\n// uniform sampler2D uCurrentPosition; // Pass in the variable from GPGPU\n// uniform sampler2D uCurrentVelocity; // Pass in the variable from GPGPU\n// uniform sampler2D uCurrentEmissionRate; // Pass in the variable from GPGPU\nuniform sampler2D uOriginalPosition;\nuniform sampler2D uDirections;     \nuniform vec3 uDirectionsAxis;\nuniform vec4 uWorldQuaternion;\nuniform vec3 uGravity;        \nuniform float uNoiseStrength;     // Variation of the noise\nuniform float uNoiseScale;        // Scale of the noise\nuniform float uNoiseSeed;         // Seed of the noise\nuniform float particleSize;\nuniform float uSpeed;     // update speed of the particles\nuniform float uRandomMassFactor;\n\n// COLLIDER\nuniform vec3 uColliderPos;                // Collider Position\nuniform vec3 uColliderSize;               // Collider Dimension\nuniform vec4 uColliderQuaternion;         // Collider Rotation\nuniform vec4 uColliderQuaternionInvert;   // Collider Rotation\nuniform float uBounce;                    // Bounce factor\nuniform float uForceDamping;\nuniform float uForceIntensity;\n\n\n\n\n    vec3 mod289(vec3 x) {\n      return x - floor(x * (1.0 / 289.0)) * 289.0;\n    }\n    \n    vec4 mod289(vec4 x) {\n    return x - floor(x * (1.0 / 289.0)) * 289.0;\n    }\n    \n    vec4 permute(vec4 x) {\n        return mod289(((x*34.0)+1.0)*x);\n    }\n    \n    vec4 taylorInvSqrt(vec4 r)\n    {\n    return 1.79284291400159 - 0.85373472095314 * r;\n    }\n    \n    vec3 fade(vec3 t) {\n  return t*t*t*(t*(t*6.0-15.0)+10.0);\n}\n\n    float snoise(vec3 v)\n    {\n    const vec2  C = vec2(1.0/6.0, 1.0/3.0) ;\n    const vec4  D = vec4(0.0, 0.5, 1.0, 2.0);\n    vec3 i  = floor(v + dot(v, C.yyy) );\n    vec3 x0 =   v - i + dot(i, C.xxx) ;\n    vec3 g = step(x0.yzx, x0.xyz);\n    vec3 l = 1.0 - g;\n    vec3 i1 = min( g.xyz, l.zxy );\n    vec3 i2 = max( g.xyz, l.zxy );\n    vec3 x1 = x0 - i1 + C.xxx;\n    vec3 x2 = x0 - i2 + C.yyy; // 2.0*C.x = 1/3 = C.y\n    vec3 x3 = x0 - D.yyy;      // -1.0+3.0*C.x = -0.5 = -D.y\n    \n    // Permutations\n    i = mod289(i);\n    vec4 p = permute( permute( permute(\n                i.z + vec4(0.0, i1.z, i2.z, 1.0 ))\n              + i.y + vec4(0.0, i1.y, i2.y, 1.0 ))\n              + i.x + vec4(0.0, i1.x, i2.x, 1.0 ));\n    \n    // Gradients: 7x7 points over a square, mapped onto an octahedron.\n    // The ring size 17*17 = 289 is close to a multiple of 49 (49*6 = 294)\n    float n_ = 0.142857142857; // 1.0/7.0\n    vec3  ns = n_ * D.wyz - D.xzx;\n    \n    vec4 j = p - 49.0 * floor(p * ns.z * ns.z);  //  mod(p,7*7)\n    \n    vec4 x_ = floor(j * ns.z);\n    vec4 y_ = floor(j - 7.0 * x_ );    // mod(j,N)\n    \n    vec4 x = x_ *ns.x + ns.yyyy;\n    vec4 y = y_ *ns.x + ns.yyyy;\n    vec4 h = 1.0 - abs(x) - abs(y);\n    \n    vec4 b0 = vec4( x.xy, y.xy );\n    vec4 b1 = vec4( x.zw, y.zw );\n    \n    vec4 s0 = floor(b0)*2.0 + 1.0;\n    vec4 s1 = floor(b1)*2.0 + 1.0;\n    vec4 sh = -step(h, vec4(0.0));\n    \n    vec4 a0 = b0.xzyw + s0.xzyw*sh.xxyy ;\n    vec4 a1 = b1.xzyw + s1.xzyw*sh.zzww ;\n    \n    vec3 p0 = vec3(a0.xy,h.x);\n    vec3 p1 = vec3(a0.zw,h.y);\n    vec3 p2 = vec3(a1.xy,h.z);\n    vec3 p3 = vec3(a1.zw,h.w);\n    \n    //Normalise gradients\n    vec4 norm = taylorInvSqrt(vec4(dot(p0,p0), dot(p1,p1), dot(p2, p2), dot(p3,p3)));\n    p0 *= norm.x;\n    p1 *= norm.y;\n    p2 *= norm.z;\n    p3 *= norm.w;\n    \n    // Mix final noise value\n    vec4 m = max(0.6 - vec4(dot(x0,x0), dot(x1,x1), dot(x2,x2), dot(x3,x3)), 0.0);\n    m = m * m;\n    return 42.0 * dot( m*m, vec4( dot(p0,x0), dot(p1,x1),\n                                  dot(p2,x2), dot(p3,x3) ) );\n    }\n    \n    vec3 snoiseVec3( vec3 x ){\n    \n      float s  = snoise(vec3( x ));\n      float s1 = snoise(vec3( x.y - 19.1 , x.z + 33.4 , x.x + 47.2 ));\n      float s2 = snoise(vec3( x.z + 74.2 , x.x - 124.5 , x.y + 99.4 ));\n      vec3 c = vec3( s , s1 , s2 );\n      return c;\n    \n    }\n    \n      \n    vec3 curlNoise( vec3 p, float seed){\n      p += seed;\n      const float e = .1;\n      vec3 dx = vec3( e   , 0.0 , 0.0 );\n      vec3 dy = vec3( 0.0 , e   , 0.0 );\n      vec3 dz = vec3( 0.0 , 0.0 , e   );\n    \n      vec3 p_x0 = snoiseVec3( p - dx );\n      vec3 p_x1 = snoiseVec3( p + dx );\n      vec3 p_y0 = snoiseVec3( p - dy );\n      vec3 p_y1 = snoiseVec3( p + dy );\n      vec3 p_z0 = snoiseVec3( p - dz );\n      vec3 p_z1 = snoiseVec3( p + dz );\n    \n      float x = p_y1.z - p_y0.z - p_z1.y + p_z0.y;\n      float y = p_z1.x - p_z0.x - p_x1.z + p_x0.z;\n      float z = p_x1.y - p_x0.y - p_y1.x + p_y0.x;\n    \n      const float divisor = 1.0 / ( 2.0 * e );\n      return normalize( vec3( x , y , z ) * divisor );\n    \n    }\n\n\n// Classic Perlin noise\nfloat cnoise(vec3 P)\n{\n  vec3 Pi0 = floor(P); // Integer part for indexing\n  vec3 Pi1 = Pi0 + vec3(1.0); // Integer part + 1\n  Pi0 = mod289(Pi0);\n  Pi1 = mod289(Pi1);\n  vec3 Pf0 = fract(P); // Fractional part for interpolation\n  vec3 Pf1 = Pf0 - vec3(1.0); // Fractional part - 1.0\n  vec4 ix = vec4(Pi0.x, Pi1.x, Pi0.x, Pi1.x);\n  vec4 iy = vec4(Pi0.yy, Pi1.yy);\n  vec4 iz0 = Pi0.zzzz;\n  vec4 iz1 = Pi1.zzzz;\n\n  vec4 ixy = permute(permute(ix) + iy);\n  vec4 ixy0 = permute(ixy + iz0);\n  vec4 ixy1 = permute(ixy + iz1);\n\n  vec4 gx0 = ixy0 * (1.0 / 7.0);\n  vec4 gy0 = fract(floor(gx0) * (1.0 / 7.0)) - 0.5;\n  gx0 = fract(gx0);\n  vec4 gz0 = vec4(0.5) - abs(gx0) - abs(gy0);\n  vec4 sz0 = step(gz0, vec4(0.0));\n  gx0 -= sz0 * (step(0.0, gx0) - 0.5);\n  gy0 -= sz0 * (step(0.0, gy0) - 0.5);\n\n  vec4 gx1 = ixy1 * (1.0 / 7.0);\n  vec4 gy1 = fract(floor(gx1) * (1.0 / 7.0)) - 0.5;\n  gx1 = fract(gx1);\n  vec4 gz1 = vec4(0.5) - abs(gx1) - abs(gy1);\n  vec4 sz1 = step(gz1, vec4(0.0));\n  gx1 -= sz1 * (step(0.0, gx1) - 0.5);\n  gy1 -= sz1 * (step(0.0, gy1) - 0.5);\n\n  vec3 g000 = vec3(gx0.x,gy0.x,gz0.x);\n  vec3 g100 = vec3(gx0.y,gy0.y,gz0.y);\n  vec3 g010 = vec3(gx0.z,gy0.z,gz0.z);\n  vec3 g110 = vec3(gx0.w,gy0.w,gz0.w);\n  vec3 g001 = vec3(gx1.x,gy1.x,gz1.x);\n  vec3 g101 = vec3(gx1.y,gy1.y,gz1.y);\n  vec3 g011 = vec3(gx1.z,gy1.z,gz1.z);\n  vec3 g111 = vec3(gx1.w,gy1.w,gz1.w);\n\n  vec4 norm0 = taylorInvSqrt(vec4(dot(g000, g000), dot(g010, g010), dot(g100, g100), dot(g110, g110)));\n  g000 *= norm0.x;\n  g010 *= norm0.y;\n  g100 *= norm0.z;\n  g110 *= norm0.w;\n  vec4 norm1 = taylorInvSqrt(vec4(dot(g001, g001), dot(g011, g011), dot(g101, g101), dot(g111, g111)));\n  g001 *= norm1.x;\n  g011 *= norm1.y;\n  g101 *= norm1.z;\n  g111 *= norm1.w;\n\n  float n000 = dot(g000, Pf0);\n  float n100 = dot(g100, vec3(Pf1.x, Pf0.yz));\n  float n010 = dot(g010, vec3(Pf0.x, Pf1.y, Pf0.z));\n  float n110 = dot(g110, vec3(Pf1.xy, Pf0.z));\n  float n001 = dot(g001, vec3(Pf0.xy, Pf1.z));\n  float n101 = dot(g101, vec3(Pf1.x, Pf0.y, Pf1.z));\n  float n011 = dot(g011, vec3(Pf0.x, Pf1.yz));\n  float n111 = dot(g111, Pf1);\n\n  vec3 fade_xyz = fade(Pf0);\n  vec4 n_z = mix(vec4(n000, n100, n010, n110), vec4(n001, n101, n011, n111), fade_xyz.z);\n  vec2 n_yz = mix(n_z.xy, n_z.zw, fade_xyz.y);\n  float n_xyz = mix(n_yz.x, n_yz.y, fade_xyz.x); \n  return 2.2 * n_xyz;\n}\n\n\nvec3 fbm_vec3(vec3 p, float frequency, float offset)\n{\n  return vec3(\n    cnoise((p+vec3(offset))*frequency),\n    cnoise((p+vec3(offset+20.0))*frequency),\n    cnoise((p+vec3(offset-30.0))*frequency)\n  );\n}\n\n"+"\nfloat rand(vec2 co){\n    return fract(sin(dot(co, vec2(12.9898, 78.233))) * 43758.5453);\n}\nvec3 applyQuaternionToVector( vec4 q, vec3 v ){\n    return v + 2.0 * cross( q.xyz, cross( q.xyz, v ) + q.w * v );\n } \nvec3 applyForce(vec3 force, float mass) {\n  vec3 acceleration = force / mass;\n  \n  return acceleration;\n}\n\nvec4 conjugate(vec4 q) {\n  return vec4(q.w, -q.x, -q.y, -q.z);\n}\n\n// Function to compute the normal of the ellipsoid at a given point\nvec3 ellipsoidNormal(vec3 p, vec3 radii) {\n  return normalize(p / (radii * radii));\n}\n\nfloat friction = .3;\n\nvoid main() {\n    vec2 vUv = gl_FragCoord.xy / resolution.xy;\n    vec3 position = texture2D( uCurrentPosition, vUv ).xyz;\n    vec3 originalPosition = texture2D( uOriginalPosition, vUv ).xyz;\n    float timeLeft = texture2D( uCurrentPosition, vUv ).w;\n    vec3 directions = texture2D( uDirections, vUv ).xyz;    \n    vec3 velocity = texture2D( uCurrentVelocity, vUv ).xyz;\n    float mass = rand(originalPosition.xy) * 0.5 + 0.5;\n    float isSpawning = texture2D( uCurrentEmissionRate, vUv ).x;        // 1. = spawning, 0. = not spawning\n    float isActive = texture2D( uCurrentEmissionRate, vUv ).y;          // 1. = active, 0. = not active\n    float collisionFlag =texture2D( uCurrentVelocity, vUv ).w;          // Indicate collision\n\n    // Randomness Mass\n    mass = (1.0 - (uRandomMassFactor * mass));\n    \n    if (isActive == 1.0) {\n      // **************************************************************\n      // FORCES NOISES\n      // **************************************************************\n      #ifdef USE_CURL_NOISE\n        if (uNoiseScale > 0.0 ) {\n          velocity = curlNoise(position * uNoiseScale * .002, uNoiseSeed) * ( uNoiseStrength + 1.0) * .05 * uSpeed;\n        }\n        // Variation of the noise Over Time\n        if (uNoiseStrength > 0.0 && uNoiseScale == 0.0 ) {\n          velocity += curlNoise( position, uNoiseSeed)  * uNoiseStrength * 0.05 * uSpeed;\n        }\n      #endif\n      // **************************************************************\n      #ifdef USE_SIMPLEX_NOISE\n        if (uNoiseScale > 0.0 ) {\n          velocity = vec3(snoise(position * uNoiseScale * .001) * ( uNoiseStrength + 1.0) * .1);\n          velocity *= uSpeed;\n        }\n        // Variation of the noise Over Time\n        if (uNoiseStrength > 0.0 && uNoiseScale == 0.0) {\n          velocity += vec3(snoise(position * uNoiseStrength * .001) * .05 * uSpeed);\n        }\n      #endif\n      // ************************************************************** \n      #ifdef USE_FBM_NOISE\n        if (uNoiseScale > 0.0 ) {\n          velocity = fbm_vec3(position * uNoiseScale * .001, ( uNoiseStrength + 1.0), uNoiseSeed);\n          velocity *= uSpeed;\n        }\n        // Variation of the noise Over Time\n        if (uNoiseStrength > 0.0 && uNoiseScale == 0.0 ) {      \n          velocity += fbm_vec3(position * uNoiseStrength * .001, ( uNoiseStrength + 1.0), uNoiseSeed) * .1 * uSpeed;\n        }\n      #endif\n\n      // COLLIDER\n      ".concat("\n  #ifdef USE_COLLIDER\n    float restitution = max(uBounce * 2., .01); // Energy Loss\n    // SPHERE COLLIDER\n    // **************************************************************\n    #ifdef USE_SPHERE_COLLIDER       \n      // Convert collider size to radii (assuming uColliderSize is the diameter in each axis)\n      vec3 radii = uColliderSize;\n      // Adjust position relative to collider\n      vec3 relPos = position - uColliderPos;\n      // Apply rotation of the collider to the relative position\n      relPos = applyQuaternionToVector(uColliderQuaternionInvert, relPos);            \n      // Scale relative position by radii (for ellipsoid collision detection)\n      vec3 scaledPos = relPos / radii;\n      // Calculate ellipsoidal distance\n      float dist = length(scaledPos); // Distance in terms of ellipsoid\n      \n      // Check for collision\n      if (dist <= 1. + particleSize / length(radii) && collisionFlag == 0.0) {\n          // Compute the normal at the collision point, accounting for particle size\n        vec3 adjustedPos = scaledPos * (1.0 + particleSize / length(radii));          \n        // Compute the normal at the collision point\n        vec3 normal = ellipsoidNormal(adjustedPos, radii);\n        // Rotate the normal back to world space\n        normal = applyQuaternionToVector(uColliderQuaternion, normal);\n        // Reflect the velocity vector off the normal\n        velocity = reflect(velocity, normal) * restitution;\n\n        collisionFlag = 1.0;\n      } else {\n        collisionFlag = 0.0;\n      }\n    #endif\n\n    // BOX COLLIDER or PLANE COLLIDER \n    // **************************************************************\n    #ifdef USE_BOX_COLLIDER\n      // Box dimensions and repulsion variables\n      vec3 boxHalfSize = uColliderSize / 2.0;\n      // Convert world position to box's local space\n      vec3 localPos = applyQuaternionToVector(uColliderQuaternionInvert, position - uColliderPos);      \n      // Collision detection\n      vec3 localDistance = abs(localPos) - boxHalfSize;\n      float distToSurface = max(localDistance.x, max(localDistance.y, localDistance.z));    \n\n      // Collision Detected\n      if (distToSurface <= particleSize * 0.5 && collisionFlag == 0.0) {      \n        // Find the nearest face normal for bounce direction\n        vec3 normal;\n        if (localDistance.x > localDistance.y && localDistance.x > localDistance.z) {\n            normal = vec3(sign(localPos.x), 0.0, 0.0);\n        } else if (localDistance.y > localDistance.z) {\n            normal = vec3(0.0, sign(localPos.y), 0.0);\n        } else {\n            normal = vec3(0.0, 0.0, sign(localPos.z));\n        }            \n        // Rotate normal back to world space\n        normal = applyQuaternionToVector(uColliderQuaternion, normal);      \n        // Reflect velocity and apply repulsion force\n        velocity = reflect(velocity, normal) * restitution;\n        \n        collisionFlag = 1.0;\n      } else {\n        collisionFlag = 0.0;\n      }\n    #endif      \n  #endif      \n  // END COLLIDER    \n","\n      // ATTRACTION\n      ").concat("\n  #ifdef USE_ATTRACTOR\n\n      #ifdef USE_SPHERE_COLLIDER      \n        // Convert collider size to radii (assuming uColliderSize is the diameter in each axis)\n        vec3 radii = uColliderSize;\n        // Adjust position relative to collider\n        vec3 relPos = position - uColliderPos;\n        // Apply rotation of the collider to the relative position\n        relPos = applyQuaternionToVector(uColliderQuaternionInvert, relPos);            \n        // Scale relative position by radii (for ellipsoid collision detection)\n        vec3 scaledPos = relPos / radii;\n        // Calculate ellipsoidal distance\n        float distToSurface = length(scaledPos); // Distance in terms of ellipsoid\n        float insideCheck = 1.0;\n\n      #endif\n\n\n      #ifdef USE_BOX_COLLIDER\n        // Box dimensions\n        vec3 boxHalfSize = uColliderSize / 2.0;\n        // Convert world position to box's local space\n        vec3 localPos = applyQuaternionToVector(uColliderQuaternionInvert, position - uColliderPos);      \n        vec3 localDistance = abs(localPos) - boxHalfSize;\n        float distToSurface = max(localDistance.x, max(localDistance.y, localDistance.z));\n        float insideCheck = particleSize;\n      #endif      \n  \n      // Apply vortex force inside the Helper\n      #ifdef USE_FORCE_LOCAL_SPACE\n        if (distToSurface <= insideCheck ) {    \n            // Define parameters for the attractor field\n            #ifdef USE_SPHERE_COLLIDER      \n              float attractorStrength = (1.0 - distToSurface ) * uForceIntensity; // Adjust as needed\n            #endif\n\n            #ifdef USE_BOX_COLLIDER\n              float attractorStrength = max((1.0 - insideCheck / distToSurface), 0.) * uForceIntensity; // Adjust as needed\n              #endif\n\n            float attractorDamping = uForceDamping;  // Adjust as needed (higher values will attenuate velocity more)\n          \n            // Use the same radii calculation code as for the collider\n            vec3 attractorRadii = uColliderSize;\n            // Adjust position relative to attractor center\n            vec3 relPos = position - uColliderPos;\n            // Apply rotation of the collider to the relative position\n            relPos = applyQuaternionToVector(uColliderQuaternionInvert, relPos);            \n            // Scale relative position by radii (for ellipsoid attraction)\n            vec3 scaledPos = relPos / attractorRadii;\n\n            // Calculate ellipsoidal distance as attractor radius\n            float attractorRadius = length(scaledPos);\n            // Calculate the distance from the attractor center\n            vec3 relativePosition = position - uColliderPos;\n            // Calculate the force vector towards the attractor center\n            vec3 attractorForce = normalize(relativePosition) * attractorStrength;\n            // Apply the attractor force to the particle\n            velocity -= attractorForce;\n            // Attenuate the particle's velocity\n            velocity *= attractorDamping;\n        }\n      #else \n            // Calculate the distance from the attractor center\n            vec3 relativePosition = position - uColliderPos;\n            // Calculate the force vector towards the attractor center\n            vec3 attractorForce = normalize(relativePosition) * uForceIntensity;\n            // Apply the attractor force to the particle\n            velocity -= attractorForce;\n            // Attenuate the particle's velocity\n            velocity *= uForceDamping;\n      #endif    \n  #endif      \n","  \n      // VORTEX\n      ").concat("\n  #ifdef USE_VORTEX\n    // Box dimensions\n    vec3 boxHalfSize = uColliderSize / 2.0;\n    // Convert world position to box's local space\n    vec3 localPos = applyQuaternionToVector(uColliderQuaternionInvert, position - uColliderPos);      \n    vec3 localDistance = abs(localPos) - boxHalfSize;\n    float distToSurface = max(localDistance.x, max(localDistance.y, localDistance.z));\n\n    // Apply vortex force inside the box\n    if (distToSurface <= particleSize) {\n      float vortexStrength = uForceIntensity;\n      vec3 localTopCenter = vec3(0.0, 0., 0.0);\n\n      // Transform the local top center to the world space\n      vec3 vortexCenter = uColliderPos + applyQuaternionToVector(uColliderQuaternion, localTopCenter);\n      // Calculate the vector from particle to vortex center\n      vec3 vortexVector = vortexCenter - position;\n\n      // Calculate the rotation axis from the inverse of the collider's quaternion and the fixed up vector\n      // Note: important to add a tiny z component to the up vector to avoid instability\n      vec3 upVector = vec3(0.0, 1.0, 0.01);\n      vec3 rotationAxis = cross(upVector, applyQuaternionToVector(uColliderQuaternion, vortexVector));\n      rotationAxis = normalize(rotationAxis);\n\n      // Add rotational component to velocity\n      float rotationSpeed = length(vortexVector * vortexStrength * 3.0) ; \n\n      vec3 rotationVelocity = rotationAxis * rotationSpeed;\n      // velocity += rotationVelocity * 0.005 ;\n      velocity = rotationVelocity * 0.005 ;\n\n      // Calculate vortex force\n      // vec3 vortexForce = normalize(vortexVector) * uSpeed * .1 ;\n      // Apply the vortex force to the particle\n      vec3 originDirection = applyQuaternionToVector(uWorldQuaternion, directions);\n      velocity += applyForce( originDirection * uSpeed * (1. - uForceDamping) , mass * .5);\n    }\n  #endif      \n","\n    } \n    // End isActive\n\n    // SPAWN BIRTH \n    // **************************************************************\n    // if (isSpawning == 1.)\n    #ifdef USE_NORMALS\n      velocity = mix(velocity, applyQuaternionToVector(uWorldQuaternion, directions) * uSpeed, isSpawning);\n    #else\n      velocity = mix(velocity, applyQuaternionToVector(uWorldQuaternion, uDirectionsAxis) * uSpeed, isSpawning);    \n    #endif\n    \n    // if (collisionFlag == 0.0)\n    velocity += applyForce(uGravity, mass * .5) * (1.0 - collisionFlag);\n\n    gl_FragColor = vec4(velocity, collisionFlag);\n}\n"),PL="\n\n  // Linear Fade In\n  float linearFadeIn(float t) {\n    return t;\n  }\n\n\n  // linear fade out\n  float linearFadeOut(float t) {\n    return 1.0 - t;\n  }\n  \n  float linearInOut(float t) {\n    return t < 0.5 ? t :  (1.0 - t);  \n  }\n\n    // lerp\n    float lerp(float a, float b, float t) {\n      return a + (b - a) * t;\n    }\n\n  // Ease In Out Quart\n  float exponentialInOut(float t) {\n    return t < 0.4 ? lerp(0.0, 1.0, t / 0.4) :\n    t > 0.6 ? lerp(1.0, 0.0, (t - 0.6) / 0.4) :\n    1.0;\n   }\n\n  // constant\n  float constant(float t) {\n    return 1.0;\n  } \n",DL="\n  uniform sampler2D uPosition;\n  uniform float uSize;\n  uniform float uSizeEnd;\n  uniform vec3 uWorldOffset;\n  uniform vec4 uWorldQuaternion;\n  // Billboard Behavior - Currently at Zero, but we can change that\n  uniform float uRotation;\n  uniform float uRotationEnd;\n  uniform vec2 center;\n\n  // Randomness\n  uniform float uRandScaleFactor;\n  uniform float uRandRotationFactor;\n\n  attribute vec2 ref;\n\n  varying float v_LifeLeft;    // normalized lifetime 1 to 0\n  varying vec2 vUv;\n  varying vec2 vRef;\n\n  ".concat("\n\nfloat rand(vec3 co){\n  return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);\n}\n\nvec3 applyQuaternionToVector( vec4 q, vec3 v ){\n  return v + 2.0 * cross( q.xyz, cross( q.xyz, v ) + q.w * v );\n}\n\nvec3 applyForce(vec3 force, float mass) {\n  vec3 acceleration = force / mass;\n    \n  return acceleration;\n}\n","\n  ").concat(PL,"\n"),OL="\n  uniform vec4 uColor;                // start color\n  uniform vec4 uColor2;               // end color\n  uniform sampler2D uTexture;         // texture\n  varying float v_LifeLeft;   // normalized lifetime 1 to 0\n  varying vec2 vUv;\n  varying vec2 vRef;\n\n  float random(vec2 co) {\n    return fract(sin(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);\n  }\n  "+PL+"  \n  ".concat("\nvec3 rgb2xyz (in vec3 rgb) {\n    float r = rgb.r;\n\tfloat g = rgb.g;\n\tfloat b = rgb.b;\n\n\tr = r > 0.04045 ? pow(((r + 0.055) / 1.055), 2.4) : (r / 12.92);\n\tg = g > 0.04045 ? pow(((g + 0.055) / 1.055), 2.4) : (g / 12.92);\n\tb = b > 0.04045 ? pow(((b + 0.055) / 1.055), 2.4) : (b / 12.92);\n\n\tfloat x = (r * 0.4124) + (g * 0.3576) + (b * 0.1805);\n\tfloat y = (r * 0.2126) + (g * 0.7152) + (b * 0.0722);\n\tfloat z = (r * 0.0193) + (g * 0.1192) + (b * 0.9505);\n    \n    vec3 xyz = vec3(\n        (r * 0.4124) + (g * 0.3576) + (b * 0.1805) * 100.0,\n        (r * 0.2126) + (g * 0.7152) + (b * 0.0722) * 100.0,\n        (r * 0.0193) + (g * 0.1192) + (b * 0.9505) * 100.0\n    );\n    return(xyz);\n}\n\nvec3 xyz2lab (in vec3 xyz) {\n\tfloat x = xyz.x / 95.047;\n\tfloat y = xyz.y / 100.0;\n\tfloat z = xyz.z / 108.883;\n\n\tx = x > 0.008856 ? pow(x, 1.0 / 3.0) : (7.787 * x) + (16.0 / 116.0);\n\ty = y > 0.008856 ? pow(y, 1.0 / 3.0) : (7.787 * y) + (16.0 / 116.0);\n\tz = z > 0.008856 ? pow(z, 1.0 / 3.0) : (7.787 * z) + (16.0 / 116.0);\n\n    vec3 lab = vec3((116.0 * y) - 16.0, 500.0 * (x - y), 200.0 * (y - z));\n    return(lab);\n}\n\nvec3 rgb2lab(in vec3 rgb) {\n    vec3 xyz = rgb2xyz(rgb);\n    vec3 lab = xyz2lab(xyz);\n    return(lab);\n}\n\nvec3 xyz2rgb (in vec3 xyz) {\n\tfloat x = xyz.x / 100.0;\n\tfloat y = xyz.y / 100.0;\n\tfloat z = xyz.z / 100.0;\n\t\n    \n\tfloat r = (x *  3.2406) + (y * -1.5372) + (z * -0.4986);\n\tfloat g = (x * -0.9689) + (y *  1.8758) + (z *  0.0415);\n\tfloat b = (x *  0.0557) + (y * -0.2040) + (z *  1.0570);\n\n\tr = r > 0.0031308 ? ((1.055 * pow(r, 1.0 / 2.4)) - 0.055) : r * 12.92;\n\tg = g > 0.0031308 ? ((1.055 * pow(g, 1.0 / 2.4)) - 0.055) : g * 12.92;\n\tb = b > 0.0031308 ? ((1.055 * pow(b, 1.0 / 2.4)) - 0.055) : b * 12.92;\n\n\tr = min(max(0.0, r), 1.0);\n\tg = min(max(0.0, g), 1.0);\n\tb = min(max(0.0, b), 1.0);\n\n\treturn(vec3(r, g, b));\n}\n\nvec3 lab2xyz (in vec3 lab) {\n    float l = lab.x;\n\tfloat a = lab.y;\n\tfloat b = lab.z;\n\n  \tfloat y = (l + 16.0) / 116.0;\n\tfloat x = a / 500.0 + y;\n\tfloat z = y - b / 200.0;\n\n\tfloat y2 = pow(y, 3.0);\n\tfloat x2 = pow(x, 3.0);\n\tfloat z2 = pow(z, 3.0);\n\n  \ty = y2 > 0.008856 ? y2 : (y - 16.0 / 116.0) / 7.787;\n\tx = x2 > 0.008856 ? x2 : (x - 16.0 / 116.0) / 7.787;\n\tz = z2 > 0.008856 ? z2 : (z - 16.0 / 116.0) / 7.787;\n\n\tx *= 95.047;\n\ty *= 100.0;\n\tz *= 108.883;\n\n\treturn(vec3(x, y, z));\n}\nvec3 lab2rgb (in vec3 lab) {\n    vec3 xyz = lab2xyz(lab);\n    vec3 rgb = xyz2rgb(xyz);\n    return(rgb);\n}\n\n","\n\n"),IL=class extends Ri{constructor(e,t){super(),this.needsJitter=!0,this.type="ParticleMaterial",this.easeOpacity="linearFadeIn",this.easeSize="linearFadeIn",this.useSizeEnd=!1,this.isColoringRandom=!1,this.init(e,t),this.context=t}reset(){}init(e,t){this.transparent=!0,this.depthTest=!0,this.depthWrite=!1,this.easeOpacity=e.ease,this.easeSize=e.easeSize,this.layers=[],VC.startContext(VC.globalContext),this.lightLayer=new vP(0,"",o(o({},Ab.defaultData("light","phong")),{},{visible:!1}),new _T,{},t.shared),VC.endContext(VC.globalContext),this.build()}updateState(e){void 0!==e.coloring&&(this.isColoringRandom="random"===e.coloring),void 0!==e.color&&(e.color instanceof Array?this.uniforms.uColor.value=e.color:this.uniforms.uColor.value=this.context.shared.color(e.color)),void 0!==e.color2&&(e.color2 instanceof Array?this.uniforms.uColor2.value=e.color2:this.uniforms.uColor2.value=this.context.shared.color(e.color2)),void 0!==e.size&&(this.uniforms.uSize.value=e.size[0],this.uniforms.uSizeEnd.value=e.size[1],e.size[0]!==e.size[1]?this.useSizeEnd=!0:this.useSizeEnd=!1),void 0!==e.ease&&(this.easeOpacity=e.ease,this.build()),void 0!==e.easeSize&&(this.easeSize=e.easeSize,this.build()),this.needsUpdate=!0}onBeforeCompile(e){this.build(),e.defines=this.defines,e.uniforms=this.uniforms,e.vertexShader=this.vertexShader,e.fragmentShader=this.fragmentShader}build(){let e=new OM;return e.needsJitter=this.needsJitter,e.addFragmentParsCode("\nlayout(location = 1) out vec4 gVelocity;\n"),e.buildShader("vertex",this.fragment),e.buildShader("fragment",this.fragment),e.addFragmentFinalCode("\n    // Discard fully transparent pixels \n    if (gl_FragColor.a <= 0.0) discard;\n\n    gVelocity = vec4(0.0, 0.0, 0.0, 1.0);\n"),this.isColoringRandom&&e.define("USE_RANDOM_COLORING"),this.useSizeEnd&&e.define("USE_SIZE_END"),e.addVertexParsCode(DL),e.addFragmentParsCode(OL),e.addVertexFinalCode((e=>{let{easeSize:t="linearFadeOut"}=e;return"\n  vUv = uv;  \n  vRef = ref;\n  // Normalized LifeTime 1 to 0\n  float lifeLeft = texture2D(uPosition, ref).w;\n  v_LifeLeft = lifeLeft;\n  // Position From DataTexture Simulation\n  vec3 pos = texture2D(uPosition, ref).rgb - uWorldOffset;\n  // Apply World Quaternion\n  pos = applyQuaternionToVector(uWorldQuaternion, pos);  \n            \n  #ifdef  USE_SIZE_END\n    // Scaled Over Time\n    float t = 1. - lifeLeft;\n    float currentSize = mix(uSize, uSizeEnd, t); // Linearly interpolate between uSize and uSizeEnd\n    vec3 scaledPosition = position * vec3(currentSize);\n  #else\n    // Change Size Behavior over LifeTime\n    float easeSize = ".concat(t,"(1. - lifeLeft);\n    // Scaled Over Time\n    vec3 scaledPosition = position * vec3(uSize * easeSize);\n  #endif\n\n  // Billboard Behavior\n  vec2 scale;\n  scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n  scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );    \n  // Randomness \n  float randRef = rand(ref);\n  scale *= (1.0 - (uRandScaleFactor * randRef));\n  // Rotation\n  float randRotation =  2.0 * PI * ( uRandRotationFactor * randRef);\n  float originalRotation = (1.0 - uRotation) * 2.0 * PI;\n  float originalRotationEnd = (1.0 - uRotationEnd) * 2.0 * PI;\n  // OverTime\n  float finalRotation = mix(originalRotation + randRotation, originalRotationEnd + randRotation, lifeLeft);\n\n  vec2 alignedPosition = ( scaledPosition.xy - ( center - vec2( 0.5 ) ) ) * scale;\n  vec2 rotatedPosition;\n  rotatedPosition.x = cos( finalRotation ) * alignedPosition.x - sin( finalRotation ) * alignedPosition.y;\n  rotatedPosition.y = sin( finalRotation ) * alignedPosition.x + cos( finalRotation ) * alignedPosition.y;\n  \n  mat4 instanceMatrix = mat4(\n    vec4(1.0, 0.0, 0.0, 0.0),\n    vec4(0.0, 1.0, 0.0, 0.0),\n    vec4(0.0, 0.0, 1.0, 0.0),\n    vec4(pos.x, pos.y, pos.z, 1.0)\n  );  \n\n  mvPosition = modelViewMatrix * instanceMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n  mvPosition.xy += rotatedPosition;\n  gl_Position = projectionMatrix  * mvPosition;   \n")})({easeSize:this.easeSize})),e.addFragmentFinalCode((e=>{let{easeOpacity:t="linearFadeOut"}=e;return"  \n  // if Particle is dead, hide it\n  if (v_LifeLeft <= 0.005 ) {\n    discard;\n  }\n\n  #ifdef USE_RANDOM_COLORING\n    float randVal = random(vRef); // Generate a random value based on the reference\n    vec4 color = mix(uColor, uColor2, randVal); // Interpolate between the two colors\n  #else\n    vec4 color = mix(uColor, uColor2, 1. - v_LifeLeft);\n  #endif\n\n  // Opacity over Life Time\n  float finalAlpha = ".concat(t,"(1. - v_LifeLeft);  \n  vec4 textureColor = texture2D(uTexture, vUv).rgba; \n  finalColor = textureColor.rgb * color.rgb;\n  finalAlpha = color.a * textureColor.a * finalAlpha;\n  \n  gl_FragColor = vec4(finalColor, finalAlpha);     \n\n")})({easeOpacity:this.easeOpacity})),this.vertexShader=e.getCode("vertex"),this.fragmentShader=e.getCode("fragment"),this.defines=e.defines,this.uniforms=o(o({},e.uniforms),this.uniforms),this.extensions=e.extensions,this}get nodeMaterial(){return this}get fragment(){return this.lightLayer.node}getDefines(){return this.defines}nodeMaterialDispose(){this.layers.forEach((e=>e.dispose())),super.dispose()}},RL=class{constructor(e,t,n,i){var r;this.type="SphereEmitterShape",this.targetMesh=void 0,this.size=e,this.type=n,this.textureSize=function(e){let t=Math.ceil(Math.sqrt(e));return Math.max(t,1)}(t);this.targetMesh="Mesh"===(null===i||void 0===i?void 0:i.type)&&i?i:this.getMesh(n,1);let{positions:s,dataTexture:a,dataTextureNormals:o}=this.createPositions(this.textureSize,null!==(r=this.targetMesh)&&void 0!==r?r:this.getMesh(n,1));this.positionsTexture=a,this.positionsAttribute=s,this.directionsTexture=o}createPositions(e,t){let{positions:n,normals:i}=function(e,t){let n=new Ci(e.geometry,e.material),i=[],r=[],s=new Bt,a=new Bt;null!==n.geometry.index&&(n.geometry=n.geometry.toNonIndexed());let o=new CL(n).build();for(let l=0;l<t;l++)o.sample(s,a),i.push(s.x,s.y,s.z),r.push(a.x,a.y,a.z);return{positions:new Float32Array(i),normals:new Float32Array(r)}}(t,e*e);return{dataTexture:ML(n,e),positions:n,dataTextureNormals:ML(i,e)}}getMesh(e,t){let n=null;switch(e){case"SphereEmitterShape":n=new tl(.5*t,32,32);break;case"TorusEmitterShape":n=new nl(.5*t,.3,15,40);break;case"ConeEmitterShape":n=new So(t,t,15);break;case"BoxEmitterShape":n=new Ti(t,t,t);break;case"PlaneEmitterShape":n=new Qi(t,t),n.rotateX(-Math.PI/2);break;default:n=new tl(t,32,32)}return new Ci(n,new Jn({color:16711680}))}applyToShader(e,t){this.size=(new Bt).fromArray(t.size),e.uEmitterSize.value=this.size}dispose(){this.positionsTexture.dispose(),this.directionsTexture.dispose(),this.positionsAttribute=new Float32Array}};function kL(e){let t=o({},e),n=hb.defaultData;t.forceFieldObjectId&&(t.colliderEntityId=t.forceFieldObjectId);let i=o(o({},n.shape),t.shape),r=o(o({},n.renderMaterial),t.renderMaterial);return o(o(o({},n),t),{},{shape:i,renderMaterial:r})}var LL=class extends Nn{constructor(e,t){var n,i,r,s;super(),this.type="ParticleEmitter",this.debugMode=!1,this.worldSpace=!0,this.rootObject=null,this.gpuCompute=null,this.positionSimRT=null,this.velocitySimRT=null,this.emissionRateSimRT=null,this.emitterShape=void 0,this.isEmitting=!1,this.hasBeenReset=!1,this.emittedParticlesAmount=0,this.lastEmitTime=0,this.globalTime=0,this.targetFPS=60,this.previousRatio=1,this.lerpFactor=.4,this.particlesAmount=0,this.noiseStrength=0,this.noiseScale=0,this.isBillboardBased=!0,this.simFeaturesDefinition={USE_COLLIDER:!1,USE_ATTRACTOR:!1,USE_VORTEX:!1,USE_SPHERE_COLLIDER:!1,USE_BOX_COLLIDER:!1,USE_FORCE_LOCAL_SPACE:!1,USE_NORMALS:!1,USE_CURL_NOISE:!0,USE_SIMPLEX_NOISE:!1,USE_FBM_NOISE:!1},this.textureLoader=new Rl,this.currentWorldPosition=new Bt,this.systemQuaternion=new Lt,this.worldGravity=new Bt(0,0,0),this.directionAxis=new Bt(0,0,0),this.colliderV3=new Bt(0,0,0),this.colliderQuaternion=new Lt(0,0,0,1),this.matrixAutoUpdate=!0,this.renderer=e,this.system=t,this.shared=t.context.shared;let a=t.data;this.material=new IL(a.renderMaterial,t.context),this.material.uniforms={uSize:{value:0},uSizeEnd:{value:0},uColor:{value:a.renderMaterial.color},uColor2:{value:a.renderMaterial.color2},uPosition:{value:new Bt(0,0,0)},uEmissionData:{value:new Bt(0,0,0)},uTexture:{value:this.defaultTexture},uWorldOffset:{value:new Bt(0,0,0)},uWorldQuaternion:{value:new Ot(0,0,0,1)},uRandScaleFactor:{value:null!==(n=a.randomScale)&&void 0!==n?n:0},uRandRotationFactor:{value:null!==(i=a.randomRotation)&&void 0!==i?i:0},uRotation:{value:null!==(r=a.renderMaterial.spriteRotation[0])&&void 0!==r?r:0},uRotationEnd:{value:null!==(s=a.renderMaterial.spriteRotation[1])&&void 0!==s?s:0}},this.setTexture(this.material.uniforms,a.renderMaterial.texture),this.init(a)}setTexture(e,t){let n=t.data;if("string"==typeof t){let n=this.shared.image(t),i=new Dt(n.img);return i.needsUpdate=!0,void(e.uTexture.value=i)}if("string"!=typeof n){let t=new Image;t.onload=()=>{let n=new Dt(t);n.needsUpdate=!0,e.uTexture.value=n};let i=new Blob([n],{type:"image/*"}),r=URL.createObjectURL(i);t.src=r}}updateGeometryAttributes(e,t){var n;let i=function(e){let t=new Float32Array(e*e*2);for(let n=0;n<e;n++)for(let i=0;i<e;i++){let r=n*e+i;t[2*r+0]=n/(e-1),t[2*r+1]=i/(e-1)}return t}(t);null===(n=this.emitterShape)||void 0===n||!n.positionsAttribute||e.geometry.setAttribute("ref",new La(i,2))}applyWorldSpace(){if(!this.system.started||!this.worldSpace||!this.positionSimRT||!this.velocitySimRT)return;let e=this.system;e.getWorldQuaternion(this.systemQuaternion),this.systemQuaternion.invert(),e.getWorldPosition(this.currentWorldPosition),this.material.uniforms.uWorldOffset.value=this.currentWorldPosition,this.material.uniforms.uWorldQuaternion.value.copy(this.systemQuaternion.normalize()),this.positionSimRT.material.uniforms.uWorldOffset.value=this.currentWorldPosition,this.systemQuaternion.invert(),this.positionSimRT.material.uniforms.uWorldQuaternion.value.copy(this.systemQuaternion.normalize()),this.velocitySimRT.material.uniforms.uWorldQuaternion.value.copy(this.systemQuaternion.normalize())}update(e,t){var n;if(!this.gpuCompute||!this.positionSimRT||!this.velocitySimRT||!this.emissionRateSimRT||this.hasBeenReset)return;if(this.checkIfAllParticlesAreDead()&&!this.hasBeenReset)return void this.reset();this.applyWorldSpace(),this.globalTime=e,this.positionSimRT.material.uniforms.uTime.value=e,this.emissionRateSimRT.material.uniforms.uTime.value=e;let i=1e3/t,r=this.targetFPS/i,s=this.previousRatio+(r-this.previousRatio)*this.lerpFactor;this.positionSimRT.material.uniforms.uFPSRatio.value=s,this.previousRatio=s;let a=this.isEmitting?this.GoEmitSomeParticles(e,this.system.data.birthRatePerSec):0;this.emissionRateSimRT.material.uniforms.uLastIndexEmitted.value=this.emittedParticlesAmount,this.emissionRateSimRT.material.uniforms.uParticlesToEmit.value=a,this.material.uniforms.uPosition.value=null===(n=this.gpuCompute.getCurrentRenderTarget(this.positionSimRT))||void 0===n?void 0:n.texture,this.system.colliderEntities.length>0&&this.renderColliders(),this.gpuCompute.compute()}renderColliders(){if(!this.velocitySimRT)return;let e=this.system.colliderEntities[0],t=this.simFeaturesDefinition.USE_COLLIDER||this.simFeaturesDefinition.USE_ATTRACTOR||this.simFeaturesDefinition.USE_VORTEX;if(e.destroyedInAction&&t&&this.init(kL(o(o({},this.system.data),{},{colliderEntityId:null}))),!e||e.destroyedInAction)return;e.getWorldPosition(this.colliderV3),0===this.colliderV3.y&&(this.colliderV3.y=1e-4),this.velocitySimRT.material.uniforms.uColliderPos.value.copy(this.colliderV3);let n=e.data.size;this.colliderV3.fromArray(n),this.velocitySimRT.material.uniforms.uColliderSize.value.copy(this.simFeaturesDefinition.USE_SPHERE_COLLIDER?this.colliderV3.multiplyScalar(.5):this.colliderV3),e.getWorldQuaternion(this.colliderQuaternion),this.velocitySimRT.material.uniforms.uColliderQuaternion.value.copy(this.colliderQuaternion.normalize()),this.velocitySimRT.material.uniforms.uColliderQuaternionInvert.value.copy(this.colliderQuaternion.normalize().invert())}updateState(e){!this.velocitySimRT||!this.positionSimRT||(e.renderMaterial&&this.updateMaterialState(e.renderMaterial),this.updateParticleState(e))}updateVariableState(e,t){if(!this.velocitySimRT||!this.positionSimRT)return;"size"===t[2]&&this.material.updateState({size:[e,this.material.uniforms.uSizeEnd.value]}),"sizeEnd"===t[2]&&this.material.updateState({size:[this.material.uniforms.uSize.value,e]});let n=(e,t)=>{let n=[...this.system.data.shape.size];n[e]=t,this.updateParticleState({shape:o(o({},this.system.data.shape),{},{size:n})})};"shape_size_0"===t[2]&&n(0,e),"shape_size_1"===t[2]&&n(1,e),"shape_size_2"===t[2]&&n(2,e),"speed"===t[2]&&(this.velocitySimRT.material.uniforms.uSpeed.value=e/10),"gravity"===t[2]&&this.worldGravity.set(0,e/100,0),"noiseStrength"===t[2]&&(this.noiseStrength=e,this.velocitySimRT.material.uniforms.uNoiseStrength.value=this.noiseStrength),"noiseScale"===t[2]&&(this.noiseScale=e,this.velocitySimRT.material.uniforms.uNoiseScale.value=this.noiseScale),"direction_x"===t[2]&&(this.directionAxis=this.getDirectionAxis([Number(e),this.system.data.direction[1],this.system.data.direction[2]])),"direction_y"===t[2]&&(this.directionAxis=this.getDirectionAxis([this.system.data.direction[0],Number(e),this.system.data.direction[2]])),"direction_z"===t[2]&&(this.directionAxis=this.getDirectionAxis([this.system.data.direction[0],this.system.data.direction[1],Number(e)]))}updateMaterialState(e){this.material.updateState(o(o({},e),{},{size:e.size?[Number(this.shared.getVariable(e.size[0],[this.uuid,"particles","size"])),Number(this.shared.getVariable(e.size[1],[this.uuid,"particles","sizeEnd"]))]:[0,0]})),e.texture&&(this.setTexture(this.material.uniforms,e.texture),this.material.needsUpdate=!0)}updateParticleState(e){if(this.positionSimRT&&this.velocitySimRT){var t,n;if(this.shouldReInitGPUCompute(e)&&this.init(kL(this.system.data)),void 0!==e.life&&(this.positionSimRT.material.uniforms.uMaxLifeTime.value=e.life),void 0!==e.speed&&(this.velocitySimRT.material.uniforms.uSpeed.value=Number(this.shared.getVariable(e.speed,[this.uuid,"particles","speed"]))/10),void 0!==e.collisionBounce&&(this.velocitySimRT.material.uniforms.uBounce.value=e.collisionBounce),void 0!==e.noiseStrength&&(this.noiseStrength=Number(this.shared.getVariable(e.noiseStrength,[this.uuid,"particles","noiseStrength"])),this.velocitySimRT.material.uniforms.uNoiseStrength.value=this.noiseStrength),void 0!==e.noiseScale&&(this.noiseScale=Number(this.shared.getVariable(e.noiseScale,[this.uuid,"particles","noiseScale"])),this.velocitySimRT.material.uniforms.uNoiseScale.value=this.noiseScale),void 0!==e.noiseSeed&&(this.velocitySimRT.material.uniforms.uNoiseSeed.value=e.noiseSeed),void 0!==e.randomMass&&(this.velocitySimRT.material.uniforms.uRandomMassFactor.value=e.randomMass),void 0!==(null===(t=e.renderMaterial)||void 0===t?void 0:t.size)){let t=this.shared.getVariable(e.renderMaterial.size[0],[this.uuid,"particles","size"]);this.velocitySimRT.material.uniforms.particleSize.value=Number(t)}if(void 0!==(null===(n=e.renderMaterial)||void 0===n?void 0:n.spriteRotation)&&(this.material.uniforms.uRotation.value=e.renderMaterial.spriteRotation[0],this.material.uniforms.uRotationEnd.value=e.renderMaterial.spriteRotation[1]),void 0!==e.shape){var i,r;let t=null!==(i=e.shape.size)&&void 0!==i?i:this.system.data.shape.size,n=[Number(this.shared.getVariable(t[0],[this.uuid,"particles","shape_size_0"])),Number(this.shared.getVariable(t[1],[this.uuid,"particles","shape_size_1"])),Number(this.shared.getVariable(t[2],[this.uuid,"particles","shape_size_2"]))],s=o(o({},kL(this.system.data).shape),{},{size:n});null===(r=this.emitterShape)||void 0===r||r.applyToShader(this.positionSimRT.material.uniforms,s)}if(void 0!==e.gravity&&(this.worldGravity.set(0,Number(this.shared.getVariable(this.system.data.gravity,[this.uuid,"particles","gravity"]))/100,0),this.velocitySimRT.material.uniforms.uGravity={value:this.worldGravity}),void 0!==e.direction){let t=this.getDirectionFromVariable(e.direction);this.directionAxis=this.getDirectionAxis(t),this.velocitySimRT.material.uniforms.uDirectionsAxis.value=this.directionAxis}void 0!==e.randomRotation&&(this.material.uniforms.uRandRotationFactor.value=e.randomRotation),void 0!==e.randomScale&&(this.material.uniforms.uRandScaleFactor.value=e.randomScale)}}updateForceFieldParameters(e){!this.velocitySimRT||(void 0!==e.forceIntensity&&(this.velocitySimRT.material.uniforms.uForceIntensity.value=e.forceIntensity),void 0!==e.forceDambing&&(this.velocitySimRT.material.uniforms.uForceDamping.value=e.forceDambing))}getDirectionAxis(e){let t=[Number(e[0])*at.DEG2RAD,Number(e[1])*at.DEG2RAD,Number(e[2])*at.DEG2RAD],n=new _n(t[0],t[1],t[2],"XYZ");return this.directionAxis.set(0,1,0).applyEuler(n).normalize(),this.velocitySimRT&&(this.velocitySimRT.material.uniforms.uDirectionsAxis.value=this.directionAxis),this.directionAxis}shouldReInitGPUCompute(e){let{birthRatePerSec:t,rootObjectType:n,colliderEntityId:i,shape:r,emitTimeDuration:s,emitTimeCycle:a,life:o,directionMode:l,noiseType:c}=e;return void 0!==t||void 0!==n||i||null===i||void 0!==a||void 0!==r||void 0!==o||void 0!==s||void 0!==l||void 0!==c}init(e){this.dispose(),this.particlesAmount=this.getMaxParticlesAmount({birthRatePerSecond:e.birthRatePerSec,particleMaxLifeTime:e.life,loopDuration:"infinity"===e.emitTimeCycle?0:e.emitTimeDuration}),this.particlesAmount>1e5&&(console.warn("The maximum number of particles is limited to ".concat(1e5,".")),this.particlesAmount=1e5),this.emitterShape=this.createShape(e.shape,this.particlesAmount);let t=setInterval((()=>{if(this.emitterShape){if(isNaN(this.emitterShape.positionsTexture.source.data.data[0]))return void this.init(e);clearInterval(t)}}),100);if(!this.emitterShape)return;let n=new _L(this.emitterShape.textureSize,this.emitterShape.textureSize,this.renderer),i=this.updateSimulationDefinition(e),r=n.addVariable("uCurrentPosition",i+"\n// uniform sampler2D uCurrentPosition; // Pass in the variable from GPGPU\n// uniform sampler2D uCurrentVelocity; // Pass in the variable from GPGPU\n// uniform sampler2D uCurrentEmissionRate; // Pass in the variable from GPGPU\nuniform sampler2D uOriginalPosition;\nuniform float uTime;\nuniform float uSpeed;     // update speed of the particles\nuniform vec3 uWorldOffset;    \nuniform vec4 uWorldQuaternion;\nuniform float uMaxLifeTime;\nuniform vec3 uEmitterSize;\nuniform float uFPSRatio;     // 1  for 60 FPS\n\nfloat random (vec2 st) {\n    return fract(sin(dot(st.xy,\n        vec2(12.9898,78.233)))*\n        43758.5453123);\n}\nvec3 applyQuaternionToVector( vec4 q, vec3 v ){\n    return v + 2.0 * cross( q.xyz, cross( q.xyz, v ) + q.w * v );\n}\n\nvec3 applyForce(vec3 force, float mass) {\n    vec3 acceleration = force / mass;\n    \n    return acceleration;\n  }\n  \n\nvoid main() {\n    vec2 vUv = gl_FragCoord.xy / resolution.xy;\n    vec3 position = texture2D( uCurrentPosition, vUv ).xyz;\n    float currentLife = texture2D( uCurrentPosition, vUv ).w;   // from 1 to 0\n    float isSpawning = texture2D( uCurrentEmissionRate, vUv ).r;        // 1. = spawning, 0. = not spawning\n    float isActive = texture2D( uCurrentEmissionRate, vUv ).g;          // 1. = active, 0. = not active\n    float timeStart = texture2D( uCurrentEmissionRate, vUv ).b;         // timeStart in seconds when the particle was emitted\n    vec3 originalPosition = ((texture2D( uOriginalPosition, vUv ).xyz) * uEmitterSize);\n    vec3 velocity = texture2D( uCurrentVelocity, vUv ).xyz;\n    float collisionFlag = texture2D( uCurrentVelocity, vUv ).w;             // 1. = collided, 0. = not collided\n    float lifeTime = uMaxLifeTime;\n\n    // Calculate the position adjustment based on collision\n    //     if (collisionFlag > .5) {  \n    float isColliding = step(0.5, collisionFlag); // 1.0 if collisionFlag > 0.5, otherwise 0.0\n    float bounceOffset = 3.0 * isColliding; // Becomes 3.0 if colliding, 0.0 otherwise\n    vec3 collisionAdjustedVelocity = velocity * (1.0 + bounceOffset);\n\n    // Update position based on collision or normal movement\n    vec3 fpsVelocity = velocity * min(uFPSRatio, 5.0);\n    position += mix(fpsVelocity, collisionAdjustedVelocity, isColliding);\n\n    // EMISSION RATE - BIRTH\n    // if (isSpawning == 1.0) {\n    // Better Approach to avoid If statement\n    vec3 newPosition = applyQuaternionToVector(uWorldQuaternion, originalPosition) + uWorldOffset;\n    originalPosition = mix(originalPosition, newPosition, isSpawning);\n    position = mix(position, originalPosition, isSpawning);;\n    timeStart = mix(timeStart, uTime, isSpawning);\n\n    // Calculate timeLeft for life normalization\n    float timeLeft = max(lifeTime - (uTime - timeStart), 0.0);\n    float life_Normalize = timeLeft / lifeTime;\n\n    // Use isActive to blend between the calculated color and black\n    vec4 activeColor = vec4(position, life_Normalize);\n    // if (isActive == 1.0) {\n    gl_FragColor = mix(vec4(0.0), activeColor, isActive);\n\n}\n",this.emitterShape.positionsTexture),s=n.addVariable("uCurrentVelocity",i+TL,this.emitterShape.directionsTexture),a=n.addVariable("uCurrentEmissionRate","\n// uniform sampler2D uCurrentPosition; // Pass in the variable from GPGPU\n// uniform sampler2D uCurrentVelocity; // Pass in the variable from GPGPU\n// uniform sampler2D uCurrentEmissionRate; // Pass in the variable from GPGPU\n\nuniform sampler2D uIndex; // Texture with corresponding index\nuniform float uLastIndexEmitted; // Last emitted index\nuniform float uParticlesToEmit; // Number of particles to emit on that frame\nuniform float uTime;\n\nvoid main() {\n    vec2 vUv = gl_FragCoord.xy / resolution.xy;\n    float particleIndex = texture(uIndex, vUv).x;\n    float timeLeft = texture2D( uCurrentPosition, vUv ).w;\n    float isActive = texture2D( uCurrentEmissionRate, vUv ).g;    // 1. = active, 0. = not active\n    float timeStart = texture2D( uCurrentEmissionRate, vUv ).b;\n\n\n    // ********** Detect Colision to Create a flag and use it in position **********\n    // We are doing this here, so\n\n    // ********** Emit Particles **********\n    // X = isSpawning 0.0 or 1.0\n    // Y = isActive 0.0 or 1.0\n    // Check if the vertex index is between the first value and the last value\n    // if (particleIndex >= uLastIndexEmitted && particleIndex < uLastIndexEmitted + uParticlesToEmit) {\n    //     // Emit a particle by writing 1 to the red channel of the color output\n    //     // r: 1. == emit the particle\n    //     // g: 1. == particle is now active\n    //     timeStart = uTime;\n    //     gl_FragColor = vec4(1.0, 1.0, timeStart, 1.0);\n    // } else {\n    //     // The Particle is either already emitted or not in the range of the particles to emit\n    //     // Do not emit a particle by writing 0 to the red channel of the color output        \n    //     gl_FragColor = vec4(0.0, isActive, timeStart, 1.0);\n    // }\n    // Determine if the particle is within the emission range\n    float emitLowerBound = step(uLastIndexEmitted, particleIndex);\n    float emitUpperBound = step(particleIndex, uLastIndexEmitted + uParticlesToEmit - 1.0);\n    float emitParticle = emitLowerBound * emitUpperBound; // 1.0 if in range, 0.0 otherwise\n\n    // Set timeStart and color\n    timeStart = mix(timeStart, uTime, emitParticle);\n    gl_FragColor = vec4(emitParticle, mix(isActive, 1.0, emitParticle), timeStart, 1.0);\n\n\n}\n",function(e){let t=new Float32Array(4*e*e);for(let i=0;i<e*e;i++)t[4*i]=0,t[4*i+1]=0,t[4*i+2]=0,t[4*i+3]=0;let n=new Oa(t,e,e,be,ge);return n.needsUpdate=!0,n}(this.emitterShape.textureSize));n.setVariableDependencies(r,[r,s,a]),n.setVariableDependencies(s,[r,s,a]),n.setVariableDependencies(a,[r,s,a]);let l=function(e){let{size:t}=e,n=new Float32Array(4*t*t);for(let r=0;r<t*t;r++)n[4*r]=r,n[4*r+1]=0,n[4*r+2]=0,n[4*r+3]=0;let i=new Oa(n,t,t,be,ge);return i.needsUpdate=!0,i}({size:this.emitterShape.textureSize}),c={uOriginalPosition:{value:this.emitterShape.positionsTexture},uWorldOffset:{value:new Bt(0,0,0)},uWorldQuaternion:{value:new Ot(0,0,0,1)},uTime:{value:0},uFPSRatio:{value:1},uMaxLifeTime:{value:e.life},uEmitterSize:{value:new Bt(Number(this.shared.getVariable(e.shape.size[0],[this.uuid,"particles","shape_size_0"])),Number(this.shared.getVariable(e.shape.size[1],[this.uuid,"particles","shape_size_1"])),Number(this.shared.getVariable(e.shape.size[2],[this.uuid,"particles","shape_size_2"])))},particleSize:{value:0}};r.material.uniforms=c;let h=this.getDirectionFromVariable(e.direction);this.directionAxis=this.getDirectionAxis(h),this.worldGravity.set(0,Number(this.shared.getVariable(this.system.data.gravity,[this.uuid,"particles","gravity"]))/100,0),this.noiseStrength=Number(this.shared.getVariable(e.noiseStrength,[this.uuid,"particles","noiseStrength"])),this.noiseScale=Number(this.shared.getVariable(e.noiseScale,[this.uuid,"particles","noiseScale"]));let u=e.colliderEntityId&&this.system.getColliderData(e.colliderEntityId),d={uOriginalPosition:{value:this.emitterShape.positionsTexture},uDirections:{value:this.emitterShape.directionsTexture},uDirectionsAxis:{value:this.directionAxis},uWorldQuaternion:{value:new Ot(0,0,0,1)},uColliderPos:{value:new Bt(0,0,0)},uColliderSize:{value:new Bt(0,0,0)},uForceIntensity:{value:u?u.forceIntensity:0},uForceDamping:{value:u?u.forceDambing:0},uColliderQuaternion:{value:new Ot(0,0,0,1)},uColliderQuaternionInvert:{value:new Ot(0,0,0,1)},particleSize:{value:0},uGravity:{value:this.worldGravity},uNoiseStrength:{value:this.noiseStrength},uNoiseScale:{value:this.noiseScale},uNoiseSeed:{value:e.noiseSeed},uRandomMassFactor:{value:e.randomMass},uBounce:{value:e.collisionBounce},uSpeed:{value:Number(this.shared.getVariable(e.speed,[this.uuid,"particles","speed"]))/10}};s.material.uniforms=d;let p={uIndex:{value:l},uTime:{value:0},uLastIndexEmitted:{value:0},uParticlesToEmit:{value:0}};a.material.uniforms=p;let f=[Number(this.shared.getVariable(e.shape.size[0],[this.uuid,"particles","shape_size_0"])),Number(this.shared.getVariable(e.shape.size[1],[this.uuid,"particles","shape_size_1"])),Number(this.shared.getVariable(e.shape.size[2],[this.uuid,"particles","shape_size_2"]))],m=o(o({},kL(this.system.data).shape),{},{size:f});this.emitterShape.applyToShader(r.material.uniforms,m),n.init(),this.gpuCompute=n,this.positionSimRT=r,this.velocitySimRT=s,this.emissionRateSimRT=a,this.rootObject=this.createPrimaryEmitter(this.emitterShape.textureSize),this.add(this.rootObject),this.material.needsUpdate=!0}getDirectionFromVariable(e){return[Number(this.shared.getVariable(e[0],[this.uuid,"particles","direction_x"])),Number(this.shared.getVariable(e[1],[this.uuid,"particles","direction_y"])),Number(this.shared.getVariable(e[2],[this.uuid,"particles","direction_z"]))]}updateSimulationDefinition(e){if(this.simFeaturesDefinition.USE_COLLIDER=!1,this.simFeaturesDefinition.USE_ATTRACTOR=!1,this.simFeaturesDefinition.USE_VORTEX=!1,this.simFeaturesDefinition.USE_SPHERE_COLLIDER=!1,this.simFeaturesDefinition.USE_BOX_COLLIDER=!1,this.simFeaturesDefinition.USE_FORCE_LOCAL_SPACE=!1,this.simFeaturesDefinition.USE_NORMALS=!1,this.simFeaturesDefinition.USE_CURL_NOISE=!1,this.simFeaturesDefinition.USE_SIMPLEX_NOISE=!1,this.simFeaturesDefinition.USE_FBM_NOISE=!1,e.colliderEntityId&&this.system.colliderEntities.length>0){let t=this.system.getColliderData(e.colliderEntityId);switch(null===t||void 0===t?void 0:t.forceType){case"attractor":this.simFeaturesDefinition.USE_ATTRACTOR=!0;break;case"collider":this.simFeaturesDefinition.USE_COLLIDER=!0;break;case"vortex":this.simFeaturesDefinition.USE_VORTEX=!0}let n=null===t||void 0===t?void 0:t.colliderType;"sphere"===n&&(this.simFeaturesDefinition.USE_SPHERE_COLLIDER=!0),"box"===n&&(this.simFeaturesDefinition.USE_BOX_COLLIDER=!0),"helper"===(null===t||void 0===t?void 0:t.forceRange)&&(this.simFeaturesDefinition.USE_FORCE_LOCAL_SPACE=!0)}"normals"===e.directionMode&&(this.simFeaturesDefinition.USE_NORMALS=!0),"curl"===e.noiseType&&(this.simFeaturesDefinition.USE_CURL_NOISE=!0),"simplex"===e.noiseType&&(this.simFeaturesDefinition.USE_SIMPLEX_NOISE=!0),"fbm"===e.noiseType&&(this.simFeaturesDefinition.USE_FBM_NOISE=!0);let t="";for(let[n,i]of Object.entries(this.simFeaturesDefinition))i&&(t+="#define ".concat(n,"\n"));return t}createShape(e,t){this.emitterShape&&this.emitterShape.dispose();let n=new Bt(Number(this.shared.getVariable(e.size[0],[this.uuid,"particles","shape_size_0"])),Number(this.shared.getVariable(e.size[1],[this.uuid,"particles","shape_size_1"])),Number(this.shared.getVariable(e.size[2],[this.uuid,"particles","shape_size_2"])));if("MeshEmitterShape"===e.type){let i=null;return this.system.context.scene.traverseEntity((t=>{t.uuid===e.fromMeshId&&(i=t)})),i?new RL(n,t,e.type,i):new RL(n,t,"SphereEmitterShape")}return new RL(n,t,e.type)}createPrimaryEmitter(e){let t,n=e*e;return t=new ja(new Qi(1,1,1),this.material,n),this.updateGeometryAttributes(t,e),this.material.needsUpdate=!0,t.onBeforeRender=()=>{this.applyWorldSpace()},t}getMaxParticlesAmount(e){let{birthRatePerSecond:t,particleMaxLifeTime:n,loopDuration:i=0}=e;return Math.ceil(t*(n+i))}dispose(){var e,t;!this.gpuCompute||(null!==(e=this.rootObject)&&void 0!==e&&null!==(e=e.parent)&&void 0!==e&&e.remove(this.rootObject),this.gpuCompute.dispose(),this.material.nodeMaterialDispose(),null===(t=this.emitterShape)||void 0===t||t.dispose())}GoEmitSomeParticles(e,t){let n=e-this.lastEmitTime,i=1/t;if(n>=i){let t=Math.max(1,Math.floor(n/i));return this.lastEmitTime=e,this.emittedParticlesAmount+t>this.particlesAmount&&(this.emittedParticlesAmount=0),this.emittedParticlesAmount+=t,t}return 0}checkIfAllParticlesAreDead(){return this.lastEmitTime+this.system.data.life+1<this.globalTime}reset(){this.hasBeenReset=!0,this.lastEmitTime=0,this.emittedParticlesAmount=0,this.gpuCompute&&this.init(kL(this.system.data))}startEmitting(e){this.isEmitting=!0,this.hasBeenReset=!1,this.lastEmitTime=e}stopEmitting(){this.isEmitting=!1}},BL=class extends UC{constructor(e,t,n){super(e,t),this.type="ParticleSystem",this.geometry=new di,this.actualTime=0,this.currentLoopTime=0,this.started=!1,this.stopped=!1,this.timeoutId=void 0,this.isFrozen=!1,this.isIdle=!0,this.emitter=null,this.colliderEntities=[],this.renderer=null,this.isPreWarm=!1,this._hasOnAfterRenderBeenCalled=!1,this.onAfterRender=e=>{this._hasOnAfterRenderBeenCalled||(this._hasOnAfterRenderBeenCalled=!0,this.init(e))},this.context=n,this.data=o(o({},t),kL(t)),this.geometry.setAttribute("position",new ri([],3)),this.material=new Jn({colorWrite:!1}),this.frustumCulled=!1}init(e){this.renderer=e,this.emitter=new LL(e,this),this.add(this.emitter),this.updateParticleState(this.data)}update(e){if(!this.isReady||!this.started||this.isFrozen||this.isIdle)return;this.actualTime+=e,this.stopped||(this.currentLoopTime+=e);let t="one_time"===this.data.emitTimeCycle;if(("loop"===this.data.emitTimeCycle||t)&&this.currentLoopTime>1e3*this.data.emitTimeDuration&&(this.stopped||(this.stop(),t||this.start(1e3*this.data.emitTimeDelay))),this.emitter&&this.started){let t=this.actualTime/1e3;this.emitter.update(t,e)}this.scale.set(1,1,1),this.updateMatrix()}isReady(){return!!this.emitter}hasCollider(e){return this.colliderEntities.some((t=>t.identity===e))}getColliderData(e){let t=this.colliderEntities.find((t=>t.identity===e));return t?t.data:null}updateByPatchedOp(e,t,n){super.updateByPatchedOp(e,t,n),qg(e.path,["renderMaterial"])&&this.updateParticleState({renderMaterial:o(o({},this.data.renderMaterial),vg.drop(e,1).props)}),qg(e.path,["shape"])&&this.updateParticleState({shape:o(o({},this.data.shape),vg.drop(e,1).props)})}updateState(e,t){super.updateState(e,t),this.updateParticleState(e)}updateParticleState(e){if(this.emitter){if(void 0!==e.colliderEntityId&&null!==e.colliderEntityId){let t=this.context.scene.find(e.colliderEntityId);this.colliderEntities=t?[t]:[]}null===e.colliderEntityId&&(this.colliderEntities=[]),this.emitter.updateState(e),e.emitTimeCycle&&this.started&&this.start()}}updateFromColliderEntity(e){!this.emitter||(this.emitter.updateForceFieldParameters(e),this.stop(),this.start())}start(){var e;let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this.currentLoopTime=0,t?this.timeoutId=window.setTimeout((()=>{this.start(0)}),t):(this.started=!0,this.stopped=!1,this.isFrozen=!1,null===(e=this.emitter)||void 0===e||e.startEmitting(this.actualTime/1e3))}froze(){this.isFrozen=!0}unFroze(){this.isFrozen=!1}stop(){var e;this.stopped=!0,this.currentLoopTime=0,null!==(e=this.emitter)&&void 0!==e&&e.stopEmitting(),clearTimeout(this.timeoutId)}reset(){var e;this.started=!1,this.stopped=!1,null===(e=this.emitter)||void 0===e||e.reset()}wakeUp(){this.isIdle=!1}sleep(){this.isIdle=!0,this.reset()}};var zL=function(){try{let e=window.location.href;if(e.includes("reducesubdiv=")){let t=e.indexOf("reducesubdiv=")+13;return parseInt(e.slice(t,t+1))}}catch(e){}}();function NL(e,t,n){return console.assert(void 0!==t.type),"Mesh"===t.type?function(e,t,n){var i,r;let s;return void 0!==zL&&(null!==(i=null===t||void 0===t||null===(r=t.geometry)||void 0===r?void 0:r.subdivisions)&&void 0!==i?i:0)>zL&&(console.log("reducing subdivisions",t.name,t.geometry.subdivisions),t.geometry.subdivisions=zL),"TextGeometry"===t.geometry.type?new cO(e,t,n):"InputGeometry"===t.geometry.type?new gL(e,t,n):(s="SubdivGeometry"===t.geometry.type?new FD(e,t,n):"PathGeometry"===t.geometry.type?new mL(e,t,n):"VectorGeometry"===t.geometry.type?new fL(e,t,n):"BooleanGeometry"===t.geometry.type?new qO(e,t,n):"ShapeBlendGeometry"===t.geometry.type?new qL(e,t,n):"UIGeometry"===t.geometry.type?new SL(e,t,n):new RD(e,t,n),s)}(e,t,n):"Empty"===t.type?new nI(e,t):"Particle"===t.type?new BL(e,t,n):"ParticleCollider"===t.type?new iI(e,t,n):"Splat"===t.type?new nI(e,t):"Bone"===t.type?new wL(e,t):"Page"===t.type?new dL(e,t,n):"PointLight"===t.type?new pL(e,t,n):"SpotLight"===t.type?new dk(e,t,n):"DirectionalLight"===t.type?new lk(e,t,n):"Component"===t.type||"Instance"===t.type?new vL(e,t,n):eb.is(t.type)?new jO(e,t):(console.error(t),new nI(e,t))}s_.createEntity=NL,s_.changeEntityProptotype=function(e,t,n){let i=NL(e.identity,t,n),r=e.children,s=e.attachedPaths,a=e.parent,o=e.component,l=e.instances,c=e.overrideData,h=e.uuid,u=e.stateSelection;e.dispose();for(let d of Object.keys(e))delete e[d];Object.setPrototypeOf(e,Object.getPrototypeOf(i));for(let d of Object.keys(i))e[d]=i[d];e.children=[...e.children,...r],e.attachedPaths=s,e.parent=a,e.component=o,e.instances=l,e.uuid=h,e.overrideData=c,e.updateState(e.data,n),u&&e.changeSelectedState(u,n),e.resetBBoxNeedsUpdate()},s_.Cloner=SO;var FL=new di;FL.setAttribute("position",new ti(new Float32Array([-1,-1,0,3,-1,0,-1,3,0]),3));var UL=class extends rl{constructor(e){super(o(o({},e),{},{depthTest:!1,depthWrite:!1,glslVersion:He,vertexShader:"\n\t\t\t\tprecision highp float;\n\t\t\t\tin vec3 position;\n\t\t\t\tvoid main() {\n\t\t\t\t\tgl_Position = vec4(position, 1);\n\t\t\t\t}\n\t\t\t"}))}customProgramCacheKey(){return""}};var jL=new ki,VL=24,GL=96,HL={shapeInput:()=>"\n\t\t\tconst float posRowCoord = ".concat(.1,";  // vec4: px py pz opType\n\t\t\tconst float quatRowCoord = ").concat(.3,";  // vec4: qx qy qz qw\n\t\t\tconst float param1RowCoord = ").concat(.5,";// vec4: type param1 param2 param3\n\t\t\tconst float param2RowCoord = ").concat(.7,";// vec4: blendRange roundness scale param4\n\t\t\tconst float colorRowCoord = ").concat(.9,"; // vec4: r g b a\n\t\t\tuniform sampler2D shapesDataTexture;\n\t\t\tvec4 shapePos(float iin) { \n\t\t\t\tvec4 r = texture(shapesDataTexture, vec2(iin, posRowCoord));\n\t\t\t\treturn r;\n\t\t\t}\n\t\t\tvec4 shapeQuat(float iin) {\n\t\t\t\tvec4 r = texture(shapesDataTexture, vec2(iin, quatRowCoord));\n\t\t\t\treturn r;\n\t\t\t}\n\t\t\tvec4 shapeParams1(float iin) {\n\t\t\t\tvec4 r = texture(shapesDataTexture, vec2(iin, param1RowCoord));\n\t\t\t\treturn r;\n\t\t\t}\n\t\t\tvec4 shapeParams2(float iin) {\n\t\t\t\tvec4 r = texture(shapesDataTexture, vec2(iin, param2RowCoord));\n\t\t\t\treturn r;\n\t\t\t}\n\t\t\tvec4 shapeColor(float iin) {\n\t\t\t\tvec4 r = texture(shapesDataTexture, vec2(iin, colorRowCoord));\n\t\t\t\treturn r;\n\t\t\t}\n\t\t"),getxyzi:"\n\t\t\t// this code must complement lookup\n\t\t\tfloat xi = mod(gl_FragCoord.x - 0.5, VOXEL_RESOLUTION);\n\t\t\tfloat yi = mod(gl_FragCoord.y - 0.5, VOXEL_RESOLUTION);\n\t\t\tfloat zi = floor((gl_FragCoord.x - 0.5) * INV_VOXEL_RESOLUTION) + floor((gl_FragCoord.y - 0.5) * INV_VOXEL_RESOLUTION) * Z_LAYERS_PER_ROW;\n\t\t",lookup:"\n\t\t\tuniform sampler2D potentialPassTexture;\n\t\t\tuniform sampler2D voxelPassTexture; // includes normal (in xyz) and key (in w)\n\t\t\t\n\t\t\t// box or marching cube lookup value in value texture, integer box coord inputs\n\t\t\t// this code must complement codebits.getxyzi\n\t\t\tvec4 look(float xi, float yi, float zi, sampler2D rt) {// range 0 .. numv etc\n\t\t\t\tvec2 uv = vec2(\n\t\t\t\t\tmod(zi, Z_LAYERS_PER_ROW) + (xi + 0.5) / VOXEL_RESOLUTION,\n\t\t\t\t\tfloor(zi / Z_LAYERS_PER_ROW) + (yi + 0.5) / VOXEL_RESOLUTION\n\t\t\t\t); \n\t\t\t\tuv /= Z_LAYERS_PER_ROW;\n\t\t\t\treturn texture(rt, uv);\n\t\t\t}\n\t\t",getpart:"\n\t\t\tfloat getpart(inout float a, float b) {\n\t\t\t\tfloat t = floor(a/b);\n\t\t\t\tfloat r = a - t*b;\n\t\t\t\ta = t;\n\t\t\t\treturn r;\n\t\t\t}\n\t\t",triTable:new Float32Array([-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,8,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,1,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,8,1,1,8,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,2,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,8,0,10,2,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,2,9,9,2,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,8,2,8,10,2,8,9,10,-1,-1,-1,-1,-1,-1,-1,2,11,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,11,0,0,11,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,9,1,11,3,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,11,1,11,9,1,11,8,9,-1,-1,-1,-1,-1,-1,-1,1,10,3,3,10,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,10,0,10,8,0,10,11,8,-1,-1,-1,-1,-1,-1,-1,0,9,3,9,11,3,9,10,11,-1,-1,-1,-1,-1,-1,-1,10,8,9,11,8,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,7,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,3,4,4,3,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,1,0,7,4,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,1,4,1,7,4,1,3,7,-1,-1,-1,-1,-1,-1,-1,10,2,1,7,4,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,4,3,4,0,3,10,2,1,-1,-1,-1,-1,-1,-1,-1,10,2,9,2,0,9,7,4,8,-1,-1,-1,-1,-1,-1,-1,9,10,2,7,9,2,3,7,2,4,9,7,-1,-1,-1,-1,7,4,8,2,11,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,4,11,4,2,11,4,0,2,-1,-1,-1,-1,-1,-1,-1,1,0,9,7,4,8,11,3,2,-1,-1,-1,-1,-1,-1,-1,11,7,4,11,4,9,2,11,9,1,2,9,-1,-1,-1,-1,1,10,3,10,11,3,4,8,7,-1,-1,-1,-1,-1,-1,-1,10,11,1,11,4,1,4,0,1,4,11,7,-1,-1,-1,-1,8,7,4,11,0,9,10,11,9,3,0,11,-1,-1,-1,-1,11,7,4,9,11,4,10,11,9,-1,-1,-1,-1,-1,-1,-1,4,5,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,5,9,3,8,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,5,0,0,5,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,5,8,5,3,8,5,1,3,-1,-1,-1,-1,-1,-1,-1,10,2,1,4,5,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,0,3,10,2,1,5,9,4,-1,-1,-1,-1,-1,-1,-1,10,2,5,2,4,5,2,0,4,-1,-1,-1,-1,-1,-1,-1,5,10,2,5,2,3,4,5,3,8,4,3,-1,-1,-1,-1,4,5,9,11,3,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,11,0,11,8,0,5,9,4,-1,-1,-1,-1,-1,-1,-1,4,5,0,5,1,0,11,3,2,-1,-1,-1,-1,-1,-1,-1,5,1,2,8,5,2,11,8,2,5,8,4,-1,-1,-1,-1,11,3,10,3,1,10,4,5,9,-1,-1,-1,-1,-1,-1,-1,5,9,4,1,8,0,1,10,8,10,11,8,-1,-1,-1,-1,0,4,5,11,0,5,10,11,5,3,0,11,-1,-1,-1,-1,8,4,5,10,8,5,11,8,10,-1,-1,-1,-1,-1,-1,-1,8,7,9,9,7,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,3,9,3,5,9,3,7,5,-1,-1,-1,-1,-1,-1,-1,8,7,0,7,1,0,7,5,1,-1,-1,-1,-1,-1,-1,-1,3,5,1,7,5,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,7,9,7,5,9,2,1,10,-1,-1,-1,-1,-1,-1,-1,2,1,10,0,5,9,0,3,5,3,7,5,-1,-1,-1,-1,2,0,8,5,2,8,7,5,8,2,5,10,-1,-1,-1,-1,5,10,2,3,5,2,7,5,3,-1,-1,-1,-1,-1,-1,-1,5,9,7,9,8,7,2,11,3,-1,-1,-1,-1,-1,-1,-1,7,5,9,2,7,9,0,2,9,11,7,2,-1,-1,-1,-1,11,3,2,8,1,0,8,7,1,7,5,1,-1,-1,-1,-1,1,2,11,7,1,11,5,1,7,-1,-1,-1,-1,-1,-1,-1,8,5,9,7,5,8,3,1,10,11,3,10,-1,-1,-1,-1,0,7,5,9,0,5,0,11,7,10,0,1,0,10,11,-1,0,10,11,3,0,11,0,5,10,7,0,8,0,7,5,-1,5,10,11,5,11,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,5,6,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,8,0,6,10,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,0,9,6,10,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,8,1,8,9,1,6,10,5,-1,-1,-1,-1,-1,-1,-1,5,6,1,1,6,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,5,6,1,6,2,1,8,0,3,-1,-1,-1,-1,-1,-1,-1,5,6,9,6,0,9,6,2,0,-1,-1,-1,-1,-1,-1,-1,8,9,5,2,8,5,6,2,5,8,2,3,-1,-1,-1,-1,11,3,2,5,6,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,0,11,0,2,11,5,6,10,-1,-1,-1,-1,-1,-1,-1,9,1,0,11,3,2,6,10,5,-1,-1,-1,-1,-1,-1,-1,6,10,5,2,9,1,2,11,9,11,8,9,-1,-1,-1,-1,11,3,6,3,5,6,3,1,5,-1,-1,-1,-1,-1,-1,-1,11,8,0,5,11,0,1,5,0,6,11,5,-1,-1,-1,-1,6,11,3,6,3,0,5,6,0,9,5,0,-1,-1,-1,-1,9,5,6,11,9,6,8,9,11,-1,-1,-1,-1,-1,-1,-1,6,10,5,8,7,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,3,4,3,7,4,10,5,6,-1,-1,-1,-1,-1,-1,-1,0,9,1,6,10,5,7,4,8,-1,-1,-1,-1,-1,-1,-1,5,6,10,7,9,1,3,7,1,4,9,7,-1,-1,-1,-1,2,1,6,1,5,6,8,7,4,-1,-1,-1,-1,-1,-1,-1,5,2,1,6,2,5,4,0,3,7,4,3,-1,-1,-1,-1,7,4,8,5,0,9,5,6,0,6,2,0,-1,-1,-1,-1,9,3,7,4,9,7,9,2,3,6,9,5,9,6,2,-1,2,11,3,4,8,7,5,6,10,-1,-1,-1,-1,-1,-1,-1,6,10,5,2,7,4,0,2,4,11,7,2,-1,-1,-1,-1,9,1,0,8,7,4,11,3,2,6,10,5,-1,-1,-1,-1,1,2,9,2,11,9,11,4,9,4,11,7,6,10,5,-1,7,4,8,5,11,3,1,5,3,6,11,5,-1,-1,-1,-1,11,1,5,6,11,5,11,0,1,4,11,7,11,4,0,-1,9,5,0,5,6,0,6,3,0,3,6,11,7,4,8,-1,9,5,6,11,9,6,9,7,4,9,11,7,-1,-1,-1,-1,9,4,10,10,4,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,6,10,4,10,9,4,3,8,0,-1,-1,-1,-1,-1,-1,-1,1,0,10,0,6,10,0,4,6,-1,-1,-1,-1,-1,-1,-1,1,3,8,6,1,8,4,6,8,10,1,6,-1,-1,-1,-1,9,4,1,4,2,1,4,6,2,-1,-1,-1,-1,-1,-1,-1,8,0,3,9,2,1,9,4,2,4,6,2,-1,-1,-1,-1,4,2,0,6,2,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,8,4,2,8,6,2,4,-1,-1,-1,-1,-1,-1,-1,9,4,10,4,6,10,3,2,11,-1,-1,-1,-1,-1,-1,-1,2,8,0,11,8,2,10,9,4,6,10,4,-1,-1,-1,-1,2,11,3,6,1,0,4,6,0,10,1,6,-1,-1,-1,-1,1,4,6,10,1,6,1,8,4,11,1,2,1,11,8,-1,4,6,9,6,3,9,3,1,9,3,6,11,-1,-1,-1,-1,1,11,8,0,1,8,1,6,11,4,1,9,1,4,6,-1,6,11,3,0,6,3,4,6,0,-1,-1,-1,-1,-1,-1,-1,8,4,6,8,6,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,6,10,7,10,8,7,10,9,8,-1,-1,-1,-1,-1,-1,-1,3,7,0,7,10,0,10,9,0,10,7,6,-1,-1,-1,-1,7,6,10,7,10,1,8,7,1,0,8,1,-1,-1,-1,-1,7,6,10,1,7,10,3,7,1,-1,-1,-1,-1,-1,-1,-1,6,2,1,8,6,1,9,8,1,7,6,8,-1,-1,-1,-1,9,6,2,1,9,2,9,7,6,3,9,0,9,3,7,-1,0,8,7,6,0,7,2,0,6,-1,-1,-1,-1,-1,-1,-1,2,3,7,2,7,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,3,2,8,6,10,9,8,10,7,6,8,-1,-1,-1,-1,7,0,2,11,7,2,7,9,0,10,7,6,7,10,9,-1,0,8,1,8,7,1,7,10,1,10,7,6,11,3,2,-1,1,2,11,7,1,11,1,6,10,1,7,6,-1,-1,-1,-1,6,9,8,7,6,8,6,1,9,3,6,11,6,3,1,-1,1,9,0,7,6,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,7,6,0,7,0,11,3,0,6,11,-1,-1,-1,-1,6,11,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,6,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,0,3,6,7,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,1,0,6,7,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,1,8,1,3,8,6,7,11,-1,-1,-1,-1,-1,-1,-1,2,1,10,7,11,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,2,1,8,0,3,7,11,6,-1,-1,-1,-1,-1,-1,-1,0,9,2,9,10,2,7,11,6,-1,-1,-1,-1,-1,-1,-1,7,11,6,3,10,2,3,8,10,8,9,10,-1,-1,-1,-1,3,2,7,7,2,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,0,7,0,6,7,0,2,6,-1,-1,-1,-1,-1,-1,-1,6,7,2,7,3,2,9,1,0,-1,-1,-1,-1,-1,-1,-1,2,6,1,6,8,1,8,9,1,6,7,8,-1,-1,-1,-1,6,7,10,7,1,10,7,3,1,-1,-1,-1,-1,-1,-1,-1,6,7,10,10,7,1,7,8,1,8,0,1,-1,-1,-1,-1,7,3,0,10,7,0,9,10,0,7,10,6,-1,-1,-1,-1,10,6,7,8,10,7,9,10,8,-1,-1,-1,-1,-1,-1,-1,4,8,6,6,8,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,6,3,6,0,3,6,4,0,-1,-1,-1,-1,-1,-1,-1,11,6,8,6,4,8,1,0,9,-1,-1,-1,-1,-1,-1,-1,6,4,9,3,6,9,1,3,9,6,3,11,-1,-1,-1,-1,4,8,6,8,11,6,1,10,2,-1,-1,-1,-1,-1,-1,-1,10,2,1,11,0,3,11,6,0,6,4,0,-1,-1,-1,-1,8,11,4,11,6,4,9,2,0,9,10,2,-1,-1,-1,-1,3,9,10,2,3,10,3,4,9,6,3,11,3,6,4,-1,3,2,8,2,4,8,2,6,4,-1,-1,-1,-1,-1,-1,-1,2,4,0,2,6,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,9,1,4,3,2,6,4,2,8,3,4,-1,-1,-1,-1,4,9,1,2,4,1,6,4,2,-1,-1,-1,-1,-1,-1,-1,3,1,8,1,6,8,6,4,8,1,10,6,-1,-1,-1,-1,0,1,10,6,0,10,4,0,6,-1,-1,-1,-1,-1,-1,-1,3,6,4,8,3,4,3,10,6,9,3,0,3,9,10,-1,4,9,10,4,10,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,5,9,4,11,6,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,8,0,5,9,4,6,7,11,-1,-1,-1,-1,-1,-1,-1,1,0,5,0,4,5,11,6,7,-1,-1,-1,-1,-1,-1,-1,6,7,11,4,3,8,4,5,3,5,1,3,-1,-1,-1,-1,4,5,9,2,1,10,11,6,7,-1,-1,-1,-1,-1,-1,-1,7,11,6,10,2,1,3,8,0,5,9,4,-1,-1,-1,-1,11,6,7,10,4,5,10,2,4,2,0,4,-1,-1,-1,-1,8,4,3,4,5,3,5,2,3,2,5,10,6,7,11,-1,3,2,7,2,6,7,9,4,5,-1,-1,-1,-1,-1,-1,-1,4,5,9,6,8,0,2,6,0,7,8,6,-1,-1,-1,-1,2,6,3,6,7,3,0,5,1,0,4,5,-1,-1,-1,-1,8,2,6,7,8,6,8,1,2,5,8,4,8,5,1,-1,4,5,9,6,1,10,6,7,1,7,3,1,-1,-1,-1,-1,10,6,1,6,7,1,7,0,1,0,7,8,4,5,9,-1,10,0,4,5,10,4,10,3,0,7,10,6,10,7,3,-1,10,6,7,8,10,7,10,4,5,10,8,4,-1,-1,-1,-1,5,9,6,9,11,6,9,8,11,-1,-1,-1,-1,-1,-1,-1,11,6,3,3,6,0,6,5,0,5,9,0,-1,-1,-1,-1,8,11,0,11,5,0,5,1,0,11,6,5,-1,-1,-1,-1,3,11,6,5,3,6,1,3,5,-1,-1,-1,-1,-1,-1,-1,10,2,1,11,5,9,8,11,9,6,5,11,-1,-1,-1,-1,3,11,0,11,6,0,6,9,0,9,6,5,10,2,1,-1,5,8,11,6,5,11,5,0,8,2,5,10,5,2,0,-1,3,11,6,5,3,6,3,10,2,3,5,10,-1,-1,-1,-1,9,8,5,8,2,5,2,6,5,2,8,3,-1,-1,-1,-1,6,5,9,0,6,9,2,6,0,-1,-1,-1,-1,-1,-1,-1,8,5,1,0,8,1,8,6,5,2,8,3,8,2,6,-1,6,5,1,6,1,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,6,3,1,10,6,1,6,8,3,9,6,5,6,9,8,-1,0,1,10,6,0,10,0,5,9,0,6,5,-1,-1,-1,-1,8,3,0,10,6,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,6,5,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,5,11,11,5,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,5,11,5,7,11,0,3,8,-1,-1,-1,-1,-1,-1,-1,7,11,5,11,10,5,0,9,1,-1,-1,-1,-1,-1,-1,-1,5,7,10,7,11,10,1,8,9,1,3,8,-1,-1,-1,-1,2,1,11,1,7,11,1,5,7,-1,-1,-1,-1,-1,-1,-1,3,8,0,7,2,1,5,7,1,11,2,7,-1,-1,-1,-1,5,7,9,7,2,9,2,0,9,7,11,2,-1,-1,-1,-1,2,5,7,11,2,7,2,9,5,8,2,3,2,8,9,-1,10,5,2,5,3,2,5,7,3,-1,-1,-1,-1,-1,-1,-1,0,2,8,2,5,8,5,7,8,5,2,10,-1,-1,-1,-1,1,0,9,3,10,5,7,3,5,2,10,3,-1,-1,-1,-1,2,8,9,1,2,9,2,7,8,5,2,10,2,5,7,-1,5,3,1,5,7,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,8,0,1,7,0,5,7,1,-1,-1,-1,-1,-1,-1,-1,3,0,9,5,3,9,7,3,5,-1,-1,-1,-1,-1,-1,-1,7,8,9,7,9,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,8,5,8,10,5,8,11,10,-1,-1,-1,-1,-1,-1,-1,4,0,5,0,11,5,11,10,5,0,3,11,-1,-1,-1,-1,9,1,0,10,4,8,11,10,8,5,4,10,-1,-1,-1,-1,4,11,10,5,4,10,4,3,11,1,4,9,4,1,3,-1,1,5,2,5,8,2,8,11,2,8,5,4,-1,-1,-1,-1,11,4,0,3,11,0,11,5,4,1,11,2,11,1,5,-1,5,2,0,9,5,0,5,11,2,8,5,4,5,8,11,-1,5,4,9,3,11,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,5,2,2,5,3,5,4,3,4,8,3,-1,-1,-1,-1,2,10,5,4,2,5,0,2,4,-1,-1,-1,-1,-1,-1,-1,2,10,3,10,5,3,5,8,3,8,5,4,9,1,0,-1,2,10,5,4,2,5,2,9,1,2,4,9,-1,-1,-1,-1,5,4,8,3,5,8,1,5,3,-1,-1,-1,-1,-1,-1,-1,5,4,0,5,0,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,5,4,8,3,5,8,5,0,9,5,3,0,-1,-1,-1,-1,5,4,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,11,4,11,9,4,11,10,9,-1,-1,-1,-1,-1,-1,-1,3,8,0,7,9,4,7,11,9,11,10,9,-1,-1,-1,-1,11,10,1,4,11,1,0,4,1,11,4,7,-1,-1,-1,-1,4,1,3,8,4,3,4,10,1,11,4,7,4,11,10,-1,7,11,4,4,11,9,11,2,9,2,1,9,-1,-1,-1,-1,4,7,9,7,11,9,11,1,9,1,11,2,3,8,0,-1,4,7,11,2,4,11,0,4,2,-1,-1,-1,-1,-1,-1,-1,4,7,11,2,4,11,4,3,8,4,2,3,-1,-1,-1,-1,10,9,2,9,7,2,7,3,2,9,4,7,-1,-1,-1,-1,7,10,9,4,7,9,7,2,10,0,7,8,7,0,2,-1,10,7,3,2,10,3,10,4,7,0,10,1,10,0,4,-1,2,10,1,4,7,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,9,4,7,1,4,3,1,7,-1,-1,-1,-1,-1,-1,-1,1,9,4,7,1,4,1,8,0,1,7,8,-1,-1,-1,-1,3,0,4,3,4,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,8,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,10,9,8,11,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,0,3,11,9,3,10,9,11,-1,-1,-1,-1,-1,-1,-1,10,1,0,8,10,0,11,10,8,-1,-1,-1,-1,-1,-1,-1,10,1,3,10,3,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,2,1,9,11,1,8,11,9,-1,-1,-1,-1,-1,-1,-1,9,0,3,11,9,3,9,2,1,9,11,2,-1,-1,-1,-1,11,2,0,11,0,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,2,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,3,2,10,8,2,9,8,10,-1,-1,-1,-1,-1,-1,-1,2,10,9,2,9,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,3,2,10,8,2,8,1,0,8,10,1,-1,-1,-1,-1,2,10,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,3,1,8,1,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,9,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,3,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1]),numTrisTable:new Float32Array([0,1,1,2,1,2,2,3,1,2,2,3,2,3,3,2,1,2,2,3,2,3,3,4,2,3,3,4,3,4,4,3,1,2,2,3,2,3,3,4,2,3,3,4,3,4,4,3,2,3,3,2,3,4,4,3,3,4,4,3,4,5,5,2,1,2,2,3,2,3,3,4,2,3,3,4,3,4,4,3,2,3,3,4,3,4,4,5,3,4,4,5,4,5,5,4,2,3,3,4,3,4,2,3,3,4,4,5,4,5,3,2,3,4,4,3,4,5,3,2,4,5,5,4,5,2,4,1,1,2,2,3,2,3,3,4,2,3,3,4,3,4,4,3,2,3,3,4,3,4,4,5,3,2,4,3,4,3,5,2,2,3,3,4,3,4,4,5,3,4,4,5,4,5,5,4,3,4,4,3,4,5,5,4,4,3,5,2,5,4,2,1,2,3,3,4,3,4,4,5,3,4,4,5,2,3,3,2,3,4,4,5,4,5,5,2,4,3,5,4,3,2,4,1,3,4,4,5,4,5,3,4,4,5,5,2,3,4,2,1,2,3,3,2,3,4,2,1,3,2,4,1,2,1,1,0])},WL=class extends RD{constructor(e,t,n){super(e,t,n),this.data=t,this.needsRebuild=!0,this.customDepthMaterialNeedsUpdate=!1,this._npart=-1,this.spatialn=1,this.drawRangeNeedsForceUpdate=!0,this._resolutionLevel=-1,this.resolution=64,this.spatialDivisions=25,this.zLayersPerRow=8,this.basePyramidSize=512,this.pyramidTexture1Width=341,this.pyramidTexture1Height=256,this.pyramidTexture2Width=170,this.pyramidTexture2Height=128,this.numLevels=9,this.pyramidLevelSizes=[1,2,4,8,16,32,64,128,256,512],this.bboxSize=0,this.bboxOffset=0,this.shapesDataTexture={value:void 0},this.spatialscene=new Ca,this.potentialPassScene=new Ca,this.voxelPassScene=new Ca,this._spatialPassRenderTargets=[],this._potentialPassRenderTargets=[],this._voxelPassRenderTargets=[],this._pyramidRenderTargets=[],this.geometry=new di,this.geometry.drawRange.count=0,this.spatialPassUniforms={span:{value:-1},shapesDataTexture:this.shapesDataTexture,npart:{value:this.npart},spatialn:{value:this.spatialn}},this.spatialMesh=new Ci(FL,this.spatialPassMaterial()),this.spatialMesh.frustumCulled=!1,this.spatialscene.add(this.spatialMesh);let i=new Oa(HL.triTable,16,256,Se,ge);i.needsUpdate=!0;let r=new Oa(HL.numTrisTable,256,1,Se,ge);r.needsUpdate=!0,this.voxelPassUniforms={potentialPassTexture:{value:void 0},numTrisTable:{value:r}},this.voxelMesh=new Ci(FL,this.voxelPassMaterial()),this.voxelMesh.frustumCulled=!1,this.voxelPassScene.add(this.voxelMesh),this.potentialPassUniforms={shapesDataTexture:this.shapesDataTexture,spatialPassTexture:{value:void 0},npart:{value:this.npart},spatialn:{value:this.spatialn}},this.potentialMesh=new Ci(FL,this.potentialPassMaterial()),this.potentialMesh.frustumCulled=!1,this.potentialPassScene.add(this.potentialMesh),this.marchPassUniforms={triTable:{value:i},potentialPassTexture:{value:void 0},voxelPassTexture:{value:void 0},pyramidTexture1:{value:void 0},pyramidTexture1Size:{value:void 0},pyramidTexture2:{value:void 0},pyramidTexture2Size:{value:void 0}},this.frustumCulled=!1,this.onBeforeShadowPass=e=>{if(tB.call(this),0===this.npart)return void(this.geometry.drawRange.count=0);let t=this.material.root;if(t.shadersPatchedForShapeBlend){if(this.customDepthMaterialNeedsUpdate){this.customDepthMaterialNeedsUpdate=!1,this.customDepthMaterial=new Ri({vertexShader:t.vertexShader,fragmentShader:"\n\t\t\t\t\t\t#include <packing>\n\t\t\t\t\t\tvoid main()\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tgl_FragColor = packDepthToRGBA(gl_FragCoord.z);\n\t\t\t\t\t\t}\n\t\t\t\t\t",uniforms:t.uniforms,defines:this.material.defines}),this.isMeshDepthMaterial=!0,this.customDistanceMaterial=new Ri({vertexShader:t.vertexShader,fragmentShader:"\n\t\t\t\t\t#include <common>\n\t\t\t\t\t#include <packing>\n\t\t\t\t\tuniform vec3 referencePosition;\n\t\t\t\t\tuniform float nearDistance;\n\t\t\t\t\tuniform float farDistance;\n\t\t\t\t\t// World-space position\n\t\t\t\t\tvarying vec3 vWPosition;\n\t\t\t\t\tvoid main()\n\t\t\t\t\t{\n\t\t\t\t\t\tfloat dist = length(vWPosition - referencePosition);\n\t\t\t\t\t\tdist = (dist - nearDistance) / (farDistance - nearDistance);\n\t\t\t\t\t\tdist = saturate(dist);\n\t\t\t\t\t\t// Required by Three.js for this to work\n\t\t\t\t\t\tgl_FragColor = packDepthToRGBA( dist );\n\t\t\t\t\t}",uniforms:o({nearDistance:{value:0},farDistance:{value:0},referencePosition:{value:new Bt},opacity:{value:0}},t.uniforms),defines:this.material.defines});let e=this.customDistanceMaterial;e.referencePosition=new Bt,e.nearDistance=0,e.farDistance=0,e.opacity=1,e.isMeshDistanceMaterial=!0}}else this.patchVertexShaderForShapeBlend(t),t.shadersPatchedForShapeBlend=!0,this.customDepthMaterialNeedsUpdate=!0;if(this.spatialPassUniforms.npart.value=this.npart,this.spatialPassUniforms.spatialn.value=this.spatialn,this.potentialPassUniforms.npart.value=this.npart,this.potentialPassUniforms.spatialn.value=this.spatialn,this.needsRebuild){this.needsRebuild=!1,this.spatialMesh.material.defines.RES=this.resolutionLevel,this.spatialMesh.material.needsUpdate=!0,this.potentialMesh.material.defines.RES=this.resolutionLevel,this.potentialPassUniforms.spatialPassTexture.value=this.spatialPassRenderTarget.texture,this.potentialMesh.material.needsUpdate=!0,this.voxelMesh.material.defines.RES=this.resolutionLevel,this.voxelMesh.material.needsUpdate=!0,this.voxelPassUniforms.potentialPassTexture.value=this.potentialPassRenderTarget.texture,this.marchPassUniforms.potentialPassTexture.value=this.potentialPassRenderTarget.texture,this.marchPassUniforms.voxelPassTexture.value=this.voxelPassRenderTarget.texture[0],this.material.defines.RES=this.resolutionLevel,this.material.defines.LEVELS=this.pyramidLevelSizes.length,this.material.defines.LOOP=this.pyramidLevelSizes.length%2===0?this.pyramidLevelSizes.length-3:this.pyramidLevelSizes.length-2,this.material.defines.HALF=this.pyramidLevelSizes.length%2===0?1:0,this.material.needsUpdate=!0;let e=this.pyramidLevelSizes.length%2===0?0:1,t=this.pyramidLevelSizes.length%2===0?1:0;this.marchPassUniforms.pyramidTexture2.value=this.pyramidRenderTarget[e].texture,this.marchPassUniforms.pyramidTexture2Size.value=new ot(this.pyramidRenderTarget[e].width,this.pyramidRenderTarget[e].height),this.marchPassUniforms.pyramidTexture1.value=this.pyramidRenderTarget[t].texture,this.marchPassUniforms.pyramidTexture1Size.value=new ot(this.pyramidRenderTarget[t].width,this.pyramidRenderTarget[t].height),Object.assign(this.material.uniforms,this.marchPassUniforms)}let n=e.shadowMap.enabled;e.shadowMap.enabled=!1;let i=e.getRenderTarget();e.setRenderTarget(this.spatialPassRenderTarget),e.render(this.spatialscene,jL),e.setRenderTarget(this.potentialPassRenderTarget),e.render(this.potentialPassScene,jL),e.setRenderTarget(this.voxelPassRenderTarget),e.render(this.voxelPassScene,jL),WL.streamCompaction.renderPyramid(this.resolutionLevel,this.pyramidLevelSizes,e,this.voxelPassRenderTarget,this.pyramidRenderTarget).then((e=>{this.material.wireframe&&(3*e>this.geometry.attributes.position.count||this.drawRangeNeedsForceUpdate)&&(this.geometry.dispose(),this.geometry=new di,this.geometry.userData.parameters={width:this.bboxSize,height:this.bboxSize,depth:this.bboxSize,centerOffset:[this.bboxOffset,this.bboxOffset,this.bboxOffset]},this.geometry.attributes.position=new ti(new Float32Array(3*e*2),3)),(3*e>this.geometry.drawRange.count||this.drawRangeNeedsForceUpdate)&&(this.geometry.drawRange.count=3*Math.floor(1.2*e)),this.drawRangeNeedsForceUpdate=!1})),e.shadowMap.enabled=n,e.setRenderTarget(i)}}set npart(e){e!==this._npart&&(this.drawRangeNeedsForceUpdate=!0,this._npart=e,this.spatialn=Math.ceil(e/96))}get npart(){return this._npart}set resolutionLevel(e){let t=Math.min(8,Math.max(5,e));if(t!==this._resolutionLevel){switch(this._resolutionLevel=t,this.resolution=Math.pow(2,t),this.resolutionLevel){case 5:this.pyramidLevelSizes=[1,2,4,6,12,24,48,96,192],this.bboxSize=496,this.bboxOffset=-8;break;case 6:this.pyramidLevelSizes=[1,2,4,8,16,32,64,128,256,512],this.bboxSize=504,this.bboxOffset=-4;break;case 7:this.pyramidLevelSizes=[1,2,4,6,12,24,48,96,192,384,768,1536],this.bboxSize=508,this.bboxOffset=-2;break;case 8:this.pyramidLevelSizes=[1,2,4,8,16,32,64,128,256,512,1024,2048,4096],this.bboxSize=510,this.bboxOffset=-1}this.pyramidTexture1Width=0,this.pyramidTexture2Width=0,this.pyramidTexture1Height=this.pyramidLevelSizes[this.pyramidLevelSizes.length-2],this.pyramidTexture2Height=this.pyramidLevelSizes[this.pyramidLevelSizes.length-3];for(let e=this.pyramidLevelSizes.length-2;e>=0;e--)(this.pyramidLevelSizes.length-2)%2===e%2?this.pyramidTexture1Width+=this.pyramidLevelSizes[e]:this.pyramidTexture2Width+=this.pyramidLevelSizes[e];this.basePyramidSize=this.pyramidLevelSizes[this.pyramidLevelSizes.length-1],this.zLayersPerRow=this.basePyramidSize/this.resolution,this.numLevels=this.pyramidLevelSizes.length-1,this.geometry.userData.parameters={width:this.bboxSize,height:this.bboxSize,depth:this.bboxSize,centerOffset:[this.bboxOffset,this.bboxOffset,this.bboxOffset]},this.needsRebuild=!0}}get resolutionLevel(){return this._resolutionLevel}get spatialPassRenderTarget(){let e=this._spatialPassRenderTargets[this.resolutionLevel];return e||(e=new It(this.spatialDivisions*this.spatialn,this.spatialDivisions**2,{format:be,type:ge,stencilBuffer:!1,depthBuffer:!1,generateMipmaps:!1,minFilter:le,magFilter:le}),this._spatialPassRenderTargets[this.resolutionLevel]=e),e}get potentialPassRenderTarget(){let e=this._potentialPassRenderTargets[this.resolutionLevel];return e||(e=new It(this.basePyramidSize,this.basePyramidSize,{format:be,type:ge,stencilBuffer:!1,depthBuffer:!1,generateMipmaps:!1,minFilter:le,magFilter:le}),this._potentialPassRenderTargets[this.resolutionLevel]=e),e}get voxelPassRenderTarget(){let e=this._voxelPassRenderTargets[this.resolutionLevel];return e||(e=new kt(this.basePyramidSize,this.basePyramidSize,2,{stencilBuffer:!1,depthBuffer:!1,generateMipmaps:!1,minFilter:le,magFilter:le}),e.texture[0].format=be,e.texture[0].type=ge,e.texture[1].format=Se,e.texture[1].type=ge,this._voxelPassRenderTargets[this.resolutionLevel]=e),e}get pyramidRenderTarget(){let e=this._pyramidRenderTargets[this.resolutionLevel];if(!e){e=[new It(this.pyramidTexture1Width,this.pyramidTexture1Height,{format:be,type:ge,stencilBuffer:!1,depthBuffer:!1,magFilter:le,minFilter:le}),new It(this.pyramidTexture2Width,this.pyramidTexture2Height,{format:be,type:ge,stencilBuffer:!1,depthBuffer:!1,magFilter:le,minFilter:le})],this._pyramidRenderTargets[this.resolutionLevel]=e}return e}updateState(e,t){let n=this.material;super.updateState(e,t),n!==this.material&&(this.needsRebuild=!0),e.geometry&&(this.resolutionLevel=e.geometry.resolutionLevel,this.geometry.userData.parameters={width:this.bboxSize,height:this.bboxSize,depth:this.bboxSize,centerOffset:[this.bboxOffset,this.bboxOffset,this.bboxOffset]}),e.wireframe&&!this.geometry.getAttribute("position")?this.geometry.setAttribute("position",new ti(new Float32Array(3*this.geometry.drawRange.count),3)):!e.wireframe&&this.geometry.getAttribute("position")&&this.geometry.deleteAttribute("position")}spatialPassMaterial(){let e="\n\t\t\tprecision highp float;\n\t\t\tout vec4 pc_FragColor;\n\t\t\tconst float spatialDivisions = ".concat(this.spatialDivisions,".;\n\t\t\tuniform float span;\n\t\t\tuniform float npart;\n\t\t\tuniform float spatialn;\n\t\t\t").concat(HL.shapeInput(),"\n\n\t\t\tvec3 low, high;     // range of current div; subset of -1 .. 1 with span border\n\n\t\t\t// lookup one element/channel's worth of spheres for current division\n\t\t\t// stating with low sphere number lowi\n\t\t\t// gives a key to which spheres from lowi..lowi+23 are active within given div (low..high)\n\t\t\tfloat spatialKey(float lowi) {\n\t\t\t\tfloat t = 0.;\n\t\t\t\tfor (float ii = ").concat(23,".; ii >= 0.; ii--) {\n\t\t\t\t\tfloat i = ii + lowi;\n\t\t\t\t\tfloat iin = (i + 0.5) / ").concat(GL,".;\n\t\t\t\t\tvec4 shape = shapePos(iin);\n\t\t\t\t\tvec3 d = shape.xyz;\n\t\t\t\t\tfloat op = shape.w;\n\t\n\t\t\t\t\tt *= 2.;\n\t\t\t\t\tt += (\n\t\t\t\t\t\tlow.x < d.x && d.x < high.x &&\n\t\t\t\t\t\tlow.y < d.y && d.y < high.y &&\n\t\t\t\t\t\tlow.z < d.z && d.z < high.z &&\n\t\t\t\t\t\ti < npart || op == -2. // always include if op is -2, which is the intersection operation\n\t\t\t\t\t) ? 1. : 0.;\n\t\t\t\t}\n\t\t\t\treturn t;\n\t\t\t}\n\n\t\t\t").concat(HL.getpart,"\n\n\t\t\tvoid main() {               // spatialial fragment shader\n\t\t\t\t// find active div\n\t\t\t\tvec3 div;                               // which div is current\n\t\t\t\t// out holds x=> x, lowi faster moving and y=> z, y faster moving\n\t\t\t\tfloat yz = float(gl_FragCoord.y - 0.5);     // contains  z, y faster moving\n\t\t\t\tdiv.y = getpart(yz, spatialDivisions);\n\t\t\t\tdiv.z = yz; // getpart(yz, spatialDivisions.z); // what's left, should be the same as getpart\n\n\t\t\t\tfloat lx = float(gl_FragCoord.x - 0.5);     // contains x, lowi faster moving\n\t\t\t\tfloat lowi = getpart(lx, spatialn) * ").concat(96,".;\n\t\t\t\tdiv.x = lx;\n\n\t\t\t\tlow = div / spatialDivisions * 2. - 1. - span;\n\t\t\t\thigh = (div+1.) / spatialDivisions * 2. - 1. + span;\n\n\t\t\t\t// find active range of spheres\n\t\t\t\tpc_FragColor.x = spatialKey(lowi);\n\t\t\t\tpc_FragColor.y = spatialKey(lowi+").concat(VL,".);\n\t\t\t\tpc_FragColor.z = spatialKey(lowi+").concat(48,".);\n\t\t\t\tpc_FragColor.w = spatialKey(lowi+").concat(72,".);\n\t\t\t}\n\t\t");return new UL({name:"Spatial Pass",fragmentShader:e,uniforms:this.spatialPassUniforms})}potentialPassMaterial(){let e="\n\t\t\tprecision highp float;\n\t\t\tout vec4 pc_FragColor;\n\n\t\t\t".concat(HL.shapeInput(),"\n\t\t\tuniform sampler2D spatialPassTexture;\n\n\t\t\tconst float res = float(RES);\n\t\t\tconst float VOXEL_RESOLUTION = pow(2., res);\n\t\t\tconst float Z_LAYERS_PER_ROW = ceil(pow(2., res / 2.));\n\t\t\tconst float VOXEL_RESOLUTION_SUB1 = VOXEL_RESOLUTION - 1.;\n\t\t\tconst float INV_VOXEL_RESOLUTION = 1.0 / VOXEL_RESOLUTION;\n\n\t\t\tuniform float npart;\n\t\t\tuniform float spatialn;\n\t\t\tconst float spatialDivisions = ").concat(this.spatialDivisions,".;\n\t\t\tconst float spatialDivisions2 = spatialDivisions * spatialDivisions;\n\t\t\tconst float spatialDivisionsSub1 = spatialDivisions - 1.;\n\n\t\t\t").concat(HL.getpart,"\n\n\t\t\tvec3 packRGBAToVec3(vec4 color) {\n\t\t\t\tuint r = uint(color.r * 255.);\n\t\t\t\tuint g = uint(color.g * 255.);\n\t\t\t\tuint combined = (r << 8) | g; \n\t\t\t\treturn vec3(float(combined) * 0.00001525902, color.b, color.a); // 1/65535\n\t\t\t}\n\n\t\t\tvoid applyQuaternionToVector(in vec4 q, inout vec3 v) {\n\t\t\t\tv += 2.0 * cross(q.xyz, cross(q.xyz, v) + q.w * v);\n\t\t\t}\n\n\t\t\t/**\n\t\t\t * SDF functions (reference: https://iquilezles.org/articles/distfunctions/)\n\t\t\t */\n\n\t\t\t// branchless version of \"Smooth Union, Subtraction and Intersection - bound, bound, bound\" in above reference\n\t\t\tfloat smoothOperation(float op, float sdf, float d, float k) {\n\t\t\t  //        union: op =  1 => signSubtract =  1, signIntersection =  1\n\t\t\t  //     subtract: op = -1 => signSubtract = -1, signIntersection =  1\n\t\t\t\t// intersection: op = -2 => signSubtract = -1, signIntersection = -1\n\n\t\t\t\tfloat signSubtract = clamp(op, -1., 1.);\n\t\t\t\tfloat signIntersection = 2. * (op - signSubtract) + 1.;\n\t\t\t\tfloat h = clamp(\n\t\t\t\t\t0.5 + signSubtract * 0.5 * (sdf - signSubtract * signIntersection * d) / k,\n\t\t\t\t\t0.0,\n\t\t\t\t\t1.0\n\t\t\t\t);\n\t\t\t\treturn mix(sdf, signSubtract * signIntersection * d, h) - \n\t\t\t\t\t\t\t signSubtract * k * h * (1.0 - h);\n\t\t\t}\n\n\t\t\tfloat sdSphere( vec3 p, float s )\n\t\t\t{\n\t\t\t\treturn length(p)-s;\n\t\t\t}\n\n\t\t\tfloat sdEllipsoid( vec3 p, vec3 r )\n\t\t\t{\n\t\t\t\tfloat k0 = length(p/r);\n\t\t\t\tfloat k1 = length(p/(r*r));\n\t\t\t\treturn k0*(k0-1.0)/k1;\n\t\t\t}\n\n\t\t\tfloat sdBox( vec3 p, vec3 b )\n\t\t\t{\n\t\t\t\tvec3 q = abs(p) - b;\n\t\t\t\treturn length(max(q,0.0)) + min(max(q.x,max(q.y,q.z)),0.0);\n\t\t\t}\n\n\t\t\tfloat sdTorus( vec3 p, vec2 t )\n\t\t\t{\n\t\t\t\tvec2 q = vec2(length(p.xy)-t.x,p.z);\n\t\t\t\treturn length(q)-t.y;\n\t\t\t}\n\n\t\t\tfloat sdCappedTorus( vec3 p, vec2 sc, float ra, float rb)\n\t\t\t{\n\t\t\t\tp.x = abs(p.x);\n\t\t\t\tfloat k = (sc.y*p.x>sc.x*p.y) ? dot(p.xy,sc) : length(p.xy);\n\t\t\t\treturn sqrt( dot(p,p) + ra*ra - 2.0*ra*k ) - rb;\n\t\t\t}\n\n\t\t\tfloat dot2( in vec2 v ) { return dot(v,v); }\n\t\t\tfloat sdCappedCone( vec3 p, float h, float r1, float r2 )\n\t\t\t{\n\t\t\t\tvec2 q = vec2( length(p.xz), p.y );\n\t\t\t\tvec2 k1 = vec2(r2,h);\n\t\t\t\tvec2 k2 = vec2(r2-r1,2.0*h);\n\t\t\t\tvec2 ca = vec2(q.x-min(q.x,(q.y<0.0)?r1:r2), abs(q.y)-h);\n\t\t\t\tvec2 cb = q - k1 + k2*clamp( dot(k1-q,k2)/dot2(k2), 0.0, 1.0 );\n\t\t\t\tfloat s = (cb.x<0.0 && ca.y<0.0) ? -1.0 : 1.0;\n\t\t\t\treturn s*sqrt( min(dot2(ca),dot2(cb)) );\n\t\t\t}\n\n\t\t\tfloat sdCappedCylinder( vec3 p, float h, float r )\n\t\t\t{\n\t\t\t\tvec2 d = abs(vec2(length(p.xz),p.y)) - vec2(r,h);\n\t\t\t\treturn min(max(d.x,d.y),0.0) + length(max(d,0.0));\n\t\t\t}\n\n\t\t\tfloat maxBlend = 0.0;\n\t\t\t// compute potential from A (=24) spheres, using the bit flags in 'activeKey'\n\t\t\t// to avoid lookup/compute for inactive spheres\n\t\t\t// return field potential, side effect updates track,\n\t\t\t// compute and return +ve and -ve values separately\n\t\t\tvoid fillSpatialInner(\n\t\t\t\tfloat ii,\n\t\t\t\tfloat activeKey,\n\t\t\t\tvec3 corner,\n\t\t\t\tinout float sdf,\n\t\t\t\tinout float colorDivisor,\n\t\t\t\tinout vec4 trackColor\n\t\t\t) {\n\t\t\t\tfor (float i = 0.; i < ").concat(VL,".; i++) {\n\t\t\t\t\tif (activeKey < 1.) break; // activeKey exhausted, no more active spheres\n\t\t\t\t\tactiveKey *= 0.5;\n\t\t\t\t\tif (fract(activeKey) < 0.5) continue;\n\n\t\t\t\t\tfloat iin = (i + ii + 0.5) * ").concat(1/GL,";\n\t\t\t\t\tvec4 shape = shapePos(iin);\n\t\t\t\t\tvec4 quat = shapeQuat(iin);\n\t\t\t\t\tvec4 params1 = shapeParams1(iin);\n\t\t\t\t\tvec4 params2 = shapeParams2(iin);\n\n\t\t\t\t\tvec3 p = corner - shape.xyz;\n\t\t\t\t\tapplyQuaternionToVector(quat, p);\n\t\t\t\t\tp /= params2.z; // scale\n\t\t\t\t\tfloat d; // d in -1..1 coordinates\n\t\t\t\t\tswitch (int(params1.x)) {\n\t\t\t\t\t\tcase 0: d = sdSphere(p, params1.y); break;\n\t\t\t\t\t\tcase 1: d = sdEllipsoid(p, params1.yzw); break;\n\t\t\t\t\t\tcase 2: d = sdBox(p, params1.yzw); break;\n\t\t\t\t\t\tcase 3: d = sdCappedCylinder(p, params1.y, params1.z); break;\n\t\t\t\t\t\tcase 4: d = sdCappedCone(p, params1.y, params1.z, params1.w); break;\n\t\t\t\t\t\tcase 5: d = sdTorus(p, params1.yz); break;\n\t\t\t\t\t\tcase 6: d = sdCappedTorus(p, params1.yz, params1.w, params2.w); break;\n\t\t\t\t\t}\n\t\t\t\t\td -= params2.y; // rounded edge\n\t\t\t\t\td *= params2.z; // scale\n\n\t\t\t\t\tfloat k = params2.x;\n\t\t\t\t\tfloat op = shape.w;\n\n\t\t\t\t\tsdf = smoothOperation(shape.w, sdf, d, k);\n\n\t\t\t\t\tfloat isNegativeOne = step(-1.5, op) * step(op, -0.5); // 1 when op == -1, 0 otherwise\n\t\t\t\t\tfloat colorCull = smoothstep(maxBlend, 0., -d);\n\t\t\t\t\tfloat cullFactor = mix(1.0, colorCull, isNegativeOne);\n\t\t\t\t\ttrackColor *= cullFactor;\n\t\t\t\t\tcolorDivisor *= cullFactor;\n\n\t\t\t\t\tmaxBlend = max(maxBlend, k);\n\n\t\t\t\t\tk += 2. * INV_VOXEL_RESOLUTION; // avoid division by zero, and other color artifacts with very small k\n\t\t\t\t\tfloat nearness = smoothstep(k, 0., d);\n\n\t\t\t\t\tvec4 color = shapeColor(iin);\n\t\t\t\t\tnearness *= float(color.a >= 0.);\n\n\t\t\t\t\tcolorDivisor += nearness;\n\t\t\t\t\ttrackColor += color * nearness;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tvec3 div;\n\t\t\t// compute potential from all spheres; collect +ve and =ve values separately\n\t\t\t// work in blocks of A*4 (=96) spheres, using the bit flags in 4 float channel 'activeKey' values\n\t\t\t// TODO check if extra vec3 output useful, not really used at present\n\t\t\tfloat fillSpatial(vec3 corner, inout vec4 trackColor) {\n\t\t\t\tfloat sdf = 1e3; // hack: initialize to large value\n\t\t\t\tfloat colorDivisor = 0.;\n\t\t\t\t// spatialPassTexture holds x=> lowi, x faster moving and y=> z, y faster moving\n\t\t\t\tfloat divyz = (div.y + div.z * spatialDivisions + 0.5) / (spatialDivisions2);\n\t\t\t\tfor (float ii = 0.; ii < spatialn; ii++) {\n\t\t\t\t\tfloat i = ii * ").concat(96,".;\n\n\t\t\t\t\tvec4 activeKey = texture(spatialPassTexture, vec2((div.x * spatialn + ii + 0.5)/(spatialn * spatialDivisions), divyz));\n\t\t\t\t\tfillSpatialInner(i, activeKey.x, corner, sdf, colorDivisor, trackColor);\n\t\t\t\t\tfillSpatialInner(i+").concat(VL,"., activeKey.y, corner, sdf, colorDivisor, trackColor);\n\t\t\t\t\tfillSpatialInner(i+").concat(48,"., activeKey.z, corner, sdf, colorDivisor, trackColor);\n\t\t\t\t\tfillSpatialInner(i+").concat(72,"., activeKey.w, corner, sdf, colorDivisor, trackColor);\n\t\t\t\t}\n\n\t\t\t\ttrackColor /= colorDivisor;\n\t\t\t\treturn mix(sdf, 0.0, step(1e20 - 0.1, sdf));\n\t\t\t}\n\n\t\t\tvoid main() {\n\t\t\t\t").concat(HL.getxyzi,"    // get xi yi zi from 2d position\n\n\t\t\t\tvec3 xyzi = vec3(xi,yi,zi);\n\t\t\t\tvec3 corner = xyzi / VOXEL_RESOLUTION_SUB1 * 2. - 1.;  // -1..1 coords\n\n\t\t\t\tdiv = floor(xyzi / VOXEL_RESOLUTION_SUB1 * spatialDivisionsSub1);\n\n\t\t\t\tvec4 c = vec4(0.);\n\t\t\t\tfloat t = fillSpatial(corner, c);\n\n\t\t\t\tpc_FragColor = vec4(t, packRGBAToVec3(c)); // RGB texture\n\t\t\t}\n\t\t");return new UL({name:"PotentialPass",fragmentShader:e,uniforms:this.potentialPassUniforms})}voxelPassMaterial(){let e="\n\t\t\tprecision highp float;\n\t\t\tlayout(location = 0) out vec4 pc_FragColor;\n\t\t\tlayout(location = 1) out vec4 numTris;\n\n\t\t\tconst float res = float(RES);\n\t\t\tconst float VOXEL_RESOLUTION = pow(2., res);\n\t\t\tconst float VOXEL_RESOLUTION_SUB1 = VOXEL_RESOLUTION - 1.; \n\t\t\tconst float Z_LAYERS_PER_ROW = ceil(pow(2., res / 2.));\n\t\t\tconst float INV_VOXEL_RESOLUTION = 1.0 / VOXEL_RESOLUTION;\n\t\t\tuniform sampler2D numTrisTable; // 256 x 1\n\n\t\t\tfloat keyi(float f000, float f100, float f010, float f110, float f001, float f101, float f011, float f111) {\n\t\t\t\treturn (float(f000 < 0.) * 1.) +\n\t\t\t\t\t\t\t (float(f100 < 0.) * 2.) +\n\t\t\t\t\t\t\t (float(f010 < 0.) * 8.) +\n\t\t\t\t\t\t\t (float(f110 < 0.) * 4.) +\n\t\t\t\t\t\t\t (float(f001 < 0.) * 16.) +\n\t\t\t\t\t\t\t (float(f101 < 0.) * 32.) +\n\t\t\t\t\t\t\t (float(f011 < 0.) * 128.) +\n\t\t\t\t\t\t\t (float(f111 < 0.) * 64.);\n\t\t\t}\n\n\t\t\t".concat(HL.lookup,"\n\n\t\t\tvec3 compNormi(float xi, float yi, float zi) {\n\t\t\t\tfloat dx = look(xi + 1., yi, zi, potentialPassTexture).r - look(xi - 1., yi, zi, potentialPassTexture).r;\n\t\t\t\tfloat dy = look(xi, yi + 1., zi, potentialPassTexture).r - look(xi, yi - 1., zi, potentialPassTexture).r;\n\t\t\t\tfloat dz = look(xi, yi, zi + 1., potentialPassTexture).r - look(xi, yi, zi - 1., potentialPassTexture).r;\n\t\t\t\t// if we allow (common) 0,0,0 case through then NaN can spread\n\t\t\t\t// eg r = vec4(compNorm i(???), 1.) will pollute r.w\n\t\t\t\tif (dx == 0.0 && dy == 0.0 && dz == 0.0) {\n\t\t\t\t\treturn vec3(0.199, 0.299, 0.399);\n\t\t\t\t}\n\t\t\t\treturn normalize(vec3(dx, dy, dz));\n\t\t\t}\n\n\t\t\tvoid main() {\n\t\t\t\t").concat(HL.getxyzi,"    // get xi yi zi from 2d\n\n\t\t\t\tvec3 normal = compNormi(xi, yi, zi);  // even if our key is -1 this may be needed by a neighbouring voxel\n\n\t\t\t\tif (xi >= VOXEL_RESOLUTION_SUB1 || yi >= VOXEL_RESOLUTION_SUB1 || zi >= VOXEL_RESOLUTION_SUB1) {\n\t\t\t\t\tpc_FragColor = vec4(normal, 0.);\n\t\t\t\t\tnumTris = vec4(0.);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tfloat\n\t\t\t\t\tf000 = look(xi, yi, zi, potentialPassTexture).r,\n\t\t\t\t\tf100 = look(xi+1., yi, zi, potentialPassTexture).r,\n\t\t\t\t\tf010 = look(xi, yi+1., zi, potentialPassTexture).r,\n\t\t\t\t\tf110 = look(xi+1., yi+1., zi, potentialPassTexture).r,\n\t\t\t\t\tf001 = look(xi, yi, zi+1., potentialPassTexture).r,\n\t\t\t\t\tf101 = look(xi+1., yi, zi+1., potentialPassTexture).r,\n\t\t\t\t\tf011 = look(xi, yi+1., zi+1., potentialPassTexture).r,\n\t\t\t\t\tf111 = look(xi+1., yi+1., zi+1., potentialPassTexture).r;\n\t\t\t\tfloat key = keyi(f000, f100, f010, f110, f001, f101, f011, f111);\n\n\t\t\t\tpc_FragColor = vec4(normal, key);\n\n\t\t\t\tnumTris = texture(numTrisTable, vec2((key + 0.5) / 256., 0.5));\n\t\t\t}\n\t\t");return new UL({name:"VoxelPass",fragmentShader:e,uniforms:this.voxelPassUniforms})}patchVertexShaderForShapeBlend(e){let t="\n\t\t#ifdef SHAPEBLEND \n\t\t\tprecision highp sampler2D;\n\n\t\t\tuniform float isol;\n\n\t\t\tuniform sampler2D triTable;     // 256 x 16\n\t\t\tuniform sampler2D pyramidTexture1;\n\t\t\tuniform vec2 pyramidTexture1Size;\n\t\t\tuniform sampler2D pyramidTexture2;\n\t\t\tuniform vec2 pyramidTexture2Size;\n\n\t\t\tconst vec2 halfPixelOffset = vec2(0.5, 0.5);\n\n\t\t\tconst vec2 rShift = vec2(0., 1.);\n\t\t\tconst vec2 gShift = vec2(1., 1.);\n\t\t\tconst vec2 bShift = vec2(1., 0.);\n\n\t\t\tconst float res = float(RES);\n\t\t\tconst float VOXEL_RESOLUTION = pow(2., res);\n\t\t\tconst float Z_LAYERS_PER_ROW = ceil(pow(2., res / 2.));\n\t\t\tconst float INV_VOXEL_RESOLUTION = 1.0 / VOXEL_RESOLUTION;\n\n\t\t\tconst float scale_factor = ".concat(2,".;\n\n\t\t\t#if SHAPEBLEND == 5\n\t\t\t\tconst float levelShiftX[7] = float[7](4., 6., 12., 24., 48., 96., 192.);\n\t\t\t\tconst float scale = 8. * scale_factor;\n\t\t\t\tconst vec3 originOffset = vec3(16.);\n\t\t\t#elif SHAPEBLEND == 7\n\t\t\t\tconst float levelShiftX[10] = float[10](4., 6., 12., 24., 48., 96., 192., 384., 768., 1536.); \n\t\t\t\tconst float scale = 2. * scale_factor;\n\t\t\t\tconst vec3 originOffset = vec3(64.);\n\t\t\t#elif SHAPEBLEND == 8\n\t\t\t\tconst float levelShiftX[11] = float[11](4., 8., 16., 32., 64., 128., 256., 512., 1024., 2048., 4096.);\n\t\t\t\tconst float scale = scale_factor;\n\t\t\t\tconst vec3 originOffset = vec3(128.);\n\t\t\t#else\n\t\t\t\tconst float levelShiftX[8] = float[8](4., 8., 16., 32., 64., 128., 256., 512.);\n\t\t\t\tconst float scale = 4. * scale_factor;\n\t\t\t\tconst vec3 originOffset = vec3(32.);\n\t\t\t#endif\n\n\t\t\t").concat(HL.lookup,"\n\n\t\t\tconst vec3 offsets[24] = vec3[](\n\t\t\t\tvec3(0., 0., 0.), vec3(1., 0., 0.),\n\t\t\t\tvec3(1., 0., 0.), vec3(1., 1., 0.),\n\t\t\t\tvec3(0., 1., 0.), vec3(1., 1., 0.),\n\t\t\t\tvec3(0., 0., 0.), vec3(0., 1., 0.),\n\t\t\t\tvec3(0., 0., 1.), vec3(1., 0., 1.),\n\t\t\t\tvec3(1., 0., 1.), vec3(1., 1., 1.),\n\t\t\t\tvec3(0., 1., 1.), vec3(1., 1., 1.),\n\t\t\t\tvec3(0., 0., 1.), vec3(0., 1., 1.),\n\t\t\t\tvec3(0., 0., 0.), vec3(0., 0., 1.),\n\t\t\t\tvec3(1., 0., 0.), vec3(1., 0., 1.),\n\t\t\t\tvec3(1., 1., 0.), vec3(1., 1., 1.),\n\t\t\t\tvec3(0., 1., 0.), vec3(0., 1., 1.)\n\t\t\t);\n\n\t\t\tvec2 computeShiftedPosition1(vec2 xy, float levelOriginX) {\n\t\t\t\tvec2 xyShifted = xy;\n\t\t\t\txyShifted.x += levelOriginX;\n\t\t\t\treturn (xyShifted + halfPixelOffset) / pyramidTexture1Size;\n\t\t\t}\n\n\t\t\tvec2 computeShiftedPosition2(vec2 xy, float levelOriginX) {\n\t\t\t\tvec2 xyShifted = xy;\n\t\t\t\txyShifted.x += levelOriginX;\n\t\t\t\treturn (xyShifted + halfPixelOffset) / pyramidTexture2Size;\n\t\t\t}\n\n\t\t\tvec4 unpackVec3ToRGBA(vec3 vec) {\n\t\t\t\tuint combined = uint(vec.x * 65535.0 + 0.5); // Add 0.5 for rounding\n\t\t\t\tfloat g = float(combined & uint(0xFF)) * 0.00392156862; // 1/255\n\t\t\t\tfloat r = float((combined >> 8) & uint(0xFF)) * 0.00392156862; \n\t\t\n\t\t\t\treturn vec4(r, g, vec.y, vec.z);\n\t\t\t}\n\n\t\t\tout vec4 marchColor;\n\t\t\t// end of marchvertPre\n\t\t#endif\n\t\t");e.vertexShader=t+e.vertexShader.replace("#include <project_vertex>","\n\t\t#ifdef SHAPEBLEND\n\t\t\tfloat triIndex = floor(float(gl_VertexID/3));\n\t\t\tfloat vertexIndex = float(gl_VertexID);\n\t\t\t\n\t\t\t// Initial pyramid lookup\n\t\t\tfloat levelOriginX1 = pyramidTexture1Size.x - 2.;\n\t\t\tfloat levelOriginX2 = pyramidTexture2Size.x - 1.;\n\t\t\tvec2 xy = vec2(0.);\n\t\t\tvec4 lookUp = texture(pyramidTexture2, computeShiftedPosition2(xy, levelOriginX2));\n\t\t\t\n\t\t\t// Early exit check\n\t\t\tif (triIndex >= lookUp.r) return;\n\t\t\t\n\t\t\t// Optimize loop variables\n\t\t\tfloat start = 0.;\n\t\t\tvec4 triIndexVec = vec4(triIndex);\n\t\t\t\n\t\t\t// Main position computation loop\n\t\t\tfor (int i = 0; i < LOOP;) {\n\t\t\t\t// Compute boundaries\n\t\t\t\tvec4 ends = lookUp + vec4(start);\n\t\t\t\tvec4 starts = vec4(ends.gba, start);\n\t\t\t\tvec4 check = vec4(greaterThanEqual(triIndexVec, starts)) * \n\t\t\t\t\t\t\t\t\t\t\tvec4(lessThan(triIndexVec, ends));\n\t\t\t\t\n\t\t\t\t// Update position\n\t\t\t\txy *= 2.;\n\t\t\t\txy += check.r * rShift + check.g * gShift + check.b * bShift;\n\t\t\t\t\n\t\t\t\t// Update loop variables\n\t\t\t\tstart = dot(check, starts);\n\t\t\t\tlevelOriginX2 -= levelShiftX[i];\n\t\t\t\t\n\t\t\t\t// Update lookup\n\t\t\t\tlookUp = texture(pyramidTexture1, computeShiftedPosition1(xy, levelOriginX1));\n\t\t\t\ti++;\n\n\t\t\t\tends = lookUp + vec4(start);\n\t\t\t\tstarts = vec4(ends.gba, start);\n\t\t\t\tcheck = vec4(greaterThanEqual(triIndexVec, starts)) * \n\t\t\t\t\t\t\t\t\t\t\tvec4(lessThan(triIndexVec, ends));\n\t\t\t\t\n\t\t\t\t// Update position\n\t\t\t\txy *= 2.;\n\t\t\t\txy += check.r * rShift + check.g * gShift + check.b * bShift;\n\t\t\t\t\n\t\t\t\t// Update loop variables\n\t\t\t\tstart = dot(check, starts);\n\t\t\t\tlevelOriginX1 -= levelShiftX[i];\n\t\t\t\t\n\t\t\t\t// Update lookup\n\t\t\t\tlookUp = texture(pyramidTexture2, computeShiftedPosition2(xy, levelOriginX2));\n\n\t\t\t\ti++;\n\t\t\t}\n\n\t\t\t#if HALF == 1\n\t\t\t\tvec4 ends = lookUp + vec4(start);\n\t\t\t\tvec4 starts = vec4(ends.gba, start);\n\t\t\t\tvec4 check = vec4(greaterThanEqual(triIndexVec, starts)) * vec4(lessThan(triIndexVec, ends));\n\t\t\t\n\t\t\t\t// Update position\n\t\t\t\txy *= 2.;\n\t\t\t\txy += check.r * rShift + check.g * gShift + check.b * bShift;\n\t\t\t\n\t\t\t\t// Update loop variables\n\t\t\t\tstart = dot(check, starts);\n\t\t\t#endif\n\t\t\t\n\t\t\t// Compute final coordinates\n\t\t\tvec3 gridPos;\n\t\t\tgridPos.x = mod(xy.x, VOXEL_RESOLUTION);\n\t\t\tgridPos.y = mod(xy.y, VOXEL_RESOLUTION);\n\t\t\tgridPos.z = floor(xy.x * INV_VOXEL_RESOLUTION) + \n\t\t\t\t\t\t\t\t\tfloor(xy.y * INV_VOXEL_RESOLUTION) * Z_LAYERS_PER_ROW;\n\t\t\t\n\t\t\t// Vertex key computation\n\t\t\tvertexIndex -= start * 3.;\n\t\t\tfloat vk = vertexIndex * 0.0625 + 0.03125; // Optimized division by 16 and addition of 1/32\n\t\t\t\n\t\t\t// Voxel lookup and edge computation\n\t\t\tvec4 voxel = look(gridPos.x, gridPos.y, gridPos.z, voxelPassTexture);\n\t\t\tfloat key = (voxel.w + 0.5) * 0.00390625; // Optimized division by 256\n\t\t\t\n\t\t\t// Edge lookup and offset computation\n\t\t\tfloat edgeNum = texture(triTable, vec2(vk, key)).x;\n\t\t\tint edgeIndex = int(edgeNum) * 2;\n\t\t\t\n\t\t\t// Compute edge positions\n\t\t\tvec3 p1 = gridPos + offsets[edgeIndex];\n\t\t\tvec3 p2 = gridPos + offsets[edgeIndex + 1];\n\t\t\t\n\t\t\t// Compute potentials and normals\n\t\t\tvec4 potential1 = look(p1.x, p1.y, p1.z, potentialPassTexture);\n\t\t\tvec4 potential2 = look(p2.x, p2.y, p2.z, potentialPassTexture);\n\t\t\t\n\t\t\t// Final position and normal computation\n\t\t\tfloat mu = potential1.r / (potential1.r - potential2.r);\n\n\t\t\tmarchColor = mix(\n\t\t\t\tunpackVec3ToRGBA(potential1.gba),\n\t\t\t\tunpackVec3ToRGBA(potential2.gba),\n\t\t\t\tmu\n\t\t\t);\n\n\t\t\ttransformed = p1 + (p2 - p1) * mu;\n\t\t\ttransformed -= originOffset;\n\t\t\ttransformed *= scale;\n\t\t\tvec4 data1 = look(p1.x, p1.y, p1.z, voxelPassTexture);\n\t\t\tvec4 data2 = look(p2.x, p2.y, p2.z, voxelPassTexture);\n\t\t\tobjectNormal = normalize(mix(data1.xyz, data2.xyz, mu));\n\t\t\ttransformedNormal = normalMatrix * objectNormal;\n\t\t\t#ifndef FLAT_SHADED\n\t\t\t\tvNormal = transformedNormal;\n\t\t\t#endif\n\t\t#endif\n\t\t\n#include <project_vertex>");let n=e.fragmentShader.match(/vec3 diffuseColor[^\n]*\n/);if(!n)return;let i="\n\t\t#ifdef SHAPEBLEND_C\n\t\t\t#if SHAPEBLEND_C == 1\n\t\t\t\t".concat(n[0].replace(/nodeU0,/g,"marchColor.rgb,").replace(/nodeU\d+(?=,g_uid\d+_calpha\))/g,"marchColor.a"),"\n\t\t\t#else\n\t\t\t\t").concat(n[0],"\n\t\t\t#endif\n\t\t#else\n\t\t\t").concat(n[0],"\n\t\t#endif\n\t\t");e.fragmentShader="in vec4 marchColor;\n"+e.fragmentShader.replace(n[0],i),Object.assign(e.uniforms,this.marchPassUniforms)}initDebugPass(e){console.log("fboToDebug.width",e.width,e.height),this.geometry=new Qi(e.width,e.height),this.geometry.userData={parameters:{width:4,height:4}};let t={inputTexture:{value:Array.isArray(e.texture)?e.texture[1]:e.texture},pyramidTextureSize:{value:void 0}},n=e=>{e.vertexShader="\n\t\t\t\tprecision highp float;\n\n\t\t\t\tvarying vec2 vUv;\n\n\t\t\t\tvoid main() {\n\t\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t\t\tvUv = uv;\n\t\t\t\t}\n\t\t\t",e.fragmentShader="\n\t\t\t\tlayout(location = 1) out vec4 gVelocity;\n\n\t\t\t\tprecision highp float;\n\t\t\t\t\n\t\t\t\tuniform sampler2D inputTexture;\n\t\t\t\tvarying vec2 vUv;\n\n\t\t\t\tuniform vec2 pyramidTextureSize;\n\n\t\t\t\tvoid main() {\n\t\t\t\t\t\t// Sample the input texture using UV coordinates\n\t\t\t\t\t\tgl_FragColor = texture(inputTexture, vUv);\n\t\t\t\t\t\tgVelocity = vec4(0.0);\n\t\t\t\t}\n\t\t\t",t.pyramidTextureSize.value=new ot(this.pyramidRenderTarget.width,this.pyramidRenderTarget.height),Object.assign(e.uniforms,t)};this.material.shapeBlendhack=n,this.material.root.shapeBlendhack=n}},qL=WL;qL.streamCompaction=new class{constructor(){this.pyramidPassScene=new Ca,this.pyramidPassMaterial=new UL({name:"PyramidPass"}),this.pyramidPassUniforms={inputTexture:{value:void 0},inputWidth:{value:0},inputHeight:{value:0},inputShiftX:{value:0},outputShiftX:{value:0}},this.pyramidTopLevelReadPixelBuffer=new Float32Array(4);this.pyramidPassMaterial.fragmentShader="\n\t\t\tprecision highp float;\n\t\t\tprecision highp sampler2D;\n\t\t\tlayout(location = 0) out vec4 pc_FragColor;\n\t\t\tuniform sampler2D inputTexture;\n\t\t\tuniform float inputWidth;\n\t\t\tuniform float inputHeight;\n\t\t\tuniform float inputShiftX;\n\t\t\tuniform float outputShiftX;\n\t\t\tconst vec2 half_unit_coord = vec2(0.5);\n\t\t\tconst vec4 one = vec4(1.0);\n\t\t\tvoid main() {\n\t\t\t\tvec2 inputSize = vec2(inputWidth, inputHeight);\n\t\t\t\tvec2 input_pixel_uv = 1. / inputSize;\n\t\t\t\tvec2 coord = gl_FragCoord.xy - half_unit_coord;\n\t\t\t\tcoord.x -= outputShiftX;\n\t\t\t\tcoord = coord * 2. + half_unit_coord;\n\t\t\t\tcoord.x += inputShiftX;\n\n\t\t\t\t// sample bottom left corner\n\t\t\t\tvec2 input_uv = coord / inputSize;\n\t\t\t\tfloat bl = texture(inputTexture, input_uv).r;\n\n\t\t\t\t// sample bottom right corner\n\t\t\t\tinput_uv.x += input_pixel_uv.x;\n\t\t\t\tfloat br = texture(inputTexture, input_uv).r;\n\n\t\t\t\t// sample top right corner\n\t\t\t\tinput_uv.y += input_pixel_uv.y;\n\t\t\t\tfloat tr = texture(inputTexture, input_uv).r;\n\n\t\t\t\t// sample top left corner\n\t\t\t\tinput_uv.x -= input_pixel_uv.x;\n\t\t\t\tfloat tl = texture(inputTexture, input_uv).r;\n\n\t\t\t\tpc_FragColor.a = bl;\n\t\t\t\tpc_FragColor.b = pc_FragColor.a + br;\n\t\t\t\tpc_FragColor.g = pc_FragColor.b + tr;\n\t\t\t\tpc_FragColor.r = pc_FragColor.g + tl; \n\t\t\t}\n\t\t",this.pyramidPassMaterial.uniforms=this.pyramidPassUniforms,this.pyramidPassMaterial.depthTest=!1,this.pyramidPassMaterial.depthWrite=!1;let e=new Ci(FL,this.pyramidPassMaterial);e.frustumCulled=!1,this.pyramidPassScene.add(e)}renderPyramid(e,t,n,i,r){(new xc).min.setScalar(0);let s=t.length-1,a=new Ot;n.getViewport(a),this.pyramidPassUniforms.inputShiftX.value=0,this.pyramidPassUniforms.outputShiftX.value=0;let o=s-1;for(let c=o;c>=0;c--){let s=c%2===o%2?r[0]:r[1],a=c===o?i:c%2===o%2?r[1]:r[0];this.pyramidPassUniforms.inputTexture.value=Array.isArray(a.texture)?a.texture[1]:a.texture,this.pyramidPassUniforms.inputWidth.value=a.width,this.pyramidPassUniforms.inputHeight.value=a.height,n.setRenderTarget(s);let l=t[c],h=n.getPixelRatio();n.setViewport(this.pyramidPassUniforms.outputShiftX.value/h,0,l/h,l/h),2===c&&e%2!==0&&n.setViewport(this.pyramidPassUniforms.outputShiftX.value/h,0,3/h,3/h),n.render(this.pyramidPassScene,jL);let u=this.pyramidPassUniforms.inputShiftX.value;this.pyramidPassUniforms.inputShiftX.value=this.pyramidPassUniforms.outputShiftX.value,this.pyramidPassUniforms.outputShiftX.value=u,c<o&&(this.pyramidPassUniforms.outputShiftX.value+=t[c+1])}n.setViewport(a);let l=t.length%2===0?0:1;return n.readRenderTargetPixelsAsync(r[l],r[l].width-1,0,1,1,this.pyramidTopLevelReadPixelBuffer).then((()=>this.pyramidTopLevelReadPixelBuffer[0]))}};var XL=new pn,YL=new pn,QL=new Lt,KL=new Bt,ZL=new Bt,JL=new Lt;function $L(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=this.children.length;for(;n--;){let i=this.children[n];US.is(i)&&eB.call(i,e,t+1)}}function eB(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!0!==e(this,t)){let n=this.children.length;for(;n--;){let i=this.children[n];US.is(i)&&eB.call(i,e,t+1)}}}function tB(){if(void 0===this.shapesDataTexture.value){let e=new Oa(new Float32Array(1920),GL,5,be,ge);this.shapesDataTexture.value=e}let e=this.shapesDataTexture.value,t=e.image.data;e.needsUpdate=!0;let n=0,i=this.data.geometry.blendRange,r=XL.copy(this.matrixWorld).invert(),s=0;$L.call(this,(e=>{var a;if(!1===e.visible)return!0;let o;if(e instanceof SO)return;if(e instanceof iI||e instanceof BL)return;o=e instanceof KS?e.object:e;let l=null===(a=e.data)||void 0===a?void 0:a.cloner;if(XS.is(e)&&l&&!l.hideBase&&"radial"!==l.type&&!0!==l.disabled||!(o instanceof RD))return;let c=o.geometry.userData.parameters,h=c.shapeBlendNode;if(void 0===h)return;if(YL.multiplyMatrices(r,e.matrixWorld).decompose(ZL,QL,KL),"TorusGeometry"===c.type&&360!==c.arc){let e=c.arc*Math.PI/180;e/=4,QL.multiply(JL.set(0,0,Math.sin(e),Math.cos(e)))}let u=h.overrideGlobalBlend?h.blendRange:i;u=u/this.bboxSize*2,t[4*s]=(ZL.x-this.bboxOffset)/this.bboxSize*2,t[4*s+1]=(ZL.y-this.bboxOffset)/this.bboxSize*2,t[4*s+2]=(ZL.z-this.bboxOffset)/this.bboxSize*2,t[4*s+3]=0===h.operation?1:2===h.operation?-1:-2,t[384+4*s]=-QL.x,t[384+4*s+1]=-QL.y,t[384+4*s+2]=-QL.z,t[384+4*s+3]=QL.w;let d=new Float32Array(4),p=0;if("SphereGeometry"===c.type)c.width===c.height&&c.width===c.depth?d[0]=0:d[0]=1,d[1]=c.width/this.bboxSize,d[2]=c.height/this.bboxSize,d[3]=c.depth/this.bboxSize,n=Math.max(n,d[1]*KL.x+u,d[2]*KL.x+u,d[3]*KL.x+u);else if("CubeGeometry"===c.type){p=c.cornerRadius;let e=c.width,t=c.height,i=c.depth;d[0]=2,d[1]=(e-2*p)/this.bboxSize,d[2]=(t-2*p)/this.bboxSize,d[3]=(i-2*p)/this.bboxSize,n=Math.max(n,Math.sqrt(e**2+t**2+i**2)/this.bboxSize*KL.x+u)}else if("CylinderGeometry"===c.type){p=c.cornerRadius;let e=c.height,t=c.radiusBottom,i=c.radiusTop;if(i>=t){let n=Math.atan2(i-t,e),r=(Math.PI/2-n)/2;i-=p/Math.tan(r),t-=p*Math.tan(r)}else if(t>i){let n=Math.atan2(t-i,e),r=(Math.PI/2-n)/2;i-=p*Math.tan(r),t-=p/Math.tan(r)}d[1]=(c.height-2*p)/this.bboxSize,t===i?(d[0]=3,d[2]=t/this.bboxSize*2):(d[0]=4,d[2]=t/this.bboxSize*2,d[3]=i/this.bboxSize*2),n=Math.max(n,4*d[1]*KL.x+u)}else if("TorusGeometry"===c.type){if(d[0]=5,d[1]=(c.width-c.depth)/this.bboxSize,d[2]=c.depth/this.bboxSize,360!==c.arc){d[0]=6,d[3]=d[1],t[1152+4*s+3]=d[2];let e=2*Math.atan2(d[2]/2,d[1]),n=c.arc*Math.PI/180/2-e;d[1]=Math.sin(n),d[2]=Math.cos(n)}n=Math.max(n,c.width*KL.x/this.bboxSize+u)}t.set(d,768+4*s),t[1152+4*s]=u,t[1152+4*s+1]=p/this.bboxSize*2,t[1152+4*s+2]=KL.x;let f=o.material,m=f.uniforms.nodeU0.node.value,g=f.uniforms.nodeU1.value;0!==h.operation&&!h.useColor&&(g=-1),t[1536+4*s]=m.r,t[1536+4*s+1]=m.g,t[1536+4*s+2]=m.b,t[1536+4*s+3]=g,g<1&&1===this.material.defines.SHAPEBLEND_C&&(this.material.transparent=!0),s++})),this.npart=s,this.spatialPassUniforms.span.value=1.4*n}function nB(e,t){let n=!1,i=512&e.layers.mask,r=t.getLayersOfType("transmission"),s=t.getLayersOfType("outline");return s.length>0&&(e.layers.set(8),r.length>0&&e.layers.enable(3),n=!0,LD(e),kD(e)),0===r.length&&0===s.length&&e.layers.set(0),i&&e.layers.set(9),e instanceof MD&&e.needsAO&&e.layers.enable(5),n}function iB(e,t){if(!t.layers)return!1;let n=512&e.layers.mask,i=!1,r=t.getLayersOfType("transmission").filter((e=>e.data.visible)),s=t.getLayersOfType("outline").filter((e=>e.data.visible));return r.length>0&&(e.layers.set(3),s.length>0&&e.layers.enable(8),i=!0),0===r.length&&0===s.length&&e.layers.set(0),n&&e.layers.set(9),e.needsAO&&e.layers.enable(5),i}var rB=new mc,sB=new pn,aB=new dn;function oB(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r=e.cloner;if(r)for(let s of r.children){let r=sB.copy(s.matrixWorld).invert(),a=aB.copy(t.ray).applyMatrix4(r),l=e.matrixWorld;a.applyMatrix4(l);let c=rB;c.set(a.origin,a.direction),c.near=t.near,c.far=t.far;let h=c.intersectObject(e,!1);h.length>0&&n.push(o(o({},h[0]),{},{object:i?s:e}))}}var lB=class{constructor(){this._constraints=new Map}setConstraint(e,t){null===t?this._constraints.delete(e):this._constraints.set(e,t)}removeDependencies(e){this._constraints.delete(e)}applyConstraints(e){let t=new Set;this._constraints.forEach(((n,i)=>{let r=[i,n],s=n;for(;this._constraints.has(s);){if(s=this._constraints.get(s),r.includes(s)){console.warn("circular dependency detected: ".concat(r.join(" -> ")));break}t.has(s)||r.push(s)}for(let a=r.length-2;a>=0;a--)if(!t.has(r[a])){let n=e.find(r[a]);n?n.applyPathSnapping(e):console.warn("missing entity ".concat(r[a])),t.add(r[a])}}))}findDependency(e,t){let n=e;for(;this._constraints.has(n);)if(n=this._constraints.get(n),n===t)return!0;return!1}},cB=class{};function hB(e){let t,n,i,r,s,a,o,l,c,h,u,d,p,f,m,g;function v(e,t,a){let o=new Float32Array(h,s,3*n);i=0;let l=new Uint32Array(h,r,n);for(let n=0;n<a.length-1;n++){let r=t[n],s=e[n].elements,c=r.filter((e=>e.enabled&&"Include"===e.mode)).map((e=>"Box"===e.type?b(e):w(e))),h=r.filter((e=>e.enabled&&"Exclude"===e.mode)).map((e=>"Box"===e.type?b(e):w(e)));for(let e=a[n];e<a[n+1];e++){let t=p[3*e],n=p[3*e+1],r=p[3*e+2];if((0===c.length||y(t,n,r,c))&&(0===h.length||!y(t,n,r,h))){let a=1/(s[3]*t+s[7]*n+s[11]*r+s[15]);o[3*i]=(s[0]*t+s[4]*n+s[8]*r+s[12])*a,o[3*i+1]=(s[1]*t+s[5]*n+s[9]*r+s[13])*a,o[3*i+2]=(s[2]*t+s[6]*n+s[10]*r+s[14])*a,l[i]=e,i++}}}}function y(e,t,n,i,r){return i["Intersect"===r?"every":"some"]((i=>{let r=function(e,t,n,i,r){let s=e-r[0],a=t-r[1],o=n-r[2],l=1/(i[3]*s+i[7]*a+i[11]*o+i[15]);return{x:(i[0]*s+i[4]*a+i[8]*o+i[12])*l+r[0],y:(i[1]*s+i[5]*a+i[9]*o+i[13])*l+r[1],z:(i[2]*s+i[6]*a+i[10]*o+i[14])*l+r[2]}}(e,t,n,i.invRotationMatrix,i.cropCenter);return Array.isArray(i)?function(e,t,n,i){return e>=i[0]&&e<=i[3]&&t>=i[1]&&t<=i[4]&&n>=i[2]&&n<=i[5]}(r.x,r.y,r.z,i):function(e,t,n,i){let r=(e-i.cropCenter[0])*i.invRadiusX,s=(t-i.cropCenter[1])*i.invRadiusY,a=(n-i.cropCenter[2])*i.invRadiusZ;return r*r+s*s+a*a<=1}(r.x,r.y,r.z,i)}))}function b(e){let t=e.cropSize[0]/2,n=e.cropSize[1]/2,i=e.cropSize[2]/2,r=[e.cropCenter[0]-t,e.cropCenter[1]-n,e.cropCenter[2]-i,e.cropCenter[0]+t,e.cropCenter[1]+n,e.cropCenter[2]+i],s=x(e.cropRotation);return Object.assign(r,{invRotationMatrix:s,cropCenter:e.cropCenter})}function x(e){let t=[],n=e[0]*Math.PI/180,i=e[1]*Math.PI/180,r=e[2]*Math.PI/180,s=Math.cos(n),a=Math.sin(n),o=Math.cos(i),l=Math.sin(i),c=Math.cos(r),h=Math.sin(r),u=s*c,d=s*h,p=a*c,f=a*h;return t[0]=o*c,t[1]=-o*h,t[2]=l,t[4]=d+p*l,t[5]=u-f*l,t[6]=-a*o,t[8]=f-u*l,t[9]=p+d*l,t[10]=s*o,t[12]=0,t[13]=0,t[14]=0,t[3]=0,t[7]=0,t[11]=0,t[15]=1,t}function w(e){let t=2/e.cropSize[0],n=2/e.cropSize[1],i=2/e.cropSize[2],r=x(e.cropRotation);return{invRadiusX:t,invRadiusY:n,invRadiusZ:i,cropCenter:e.cropCenter,invRotationMatrix:r}}e.onmessage=x=>{if(x.data.getCroppedIndexes){let t=new Uint32Array(function(e,t){let n=[],i=t.filter((e=>e.enabled&&"Include"===e.mode)).map((e=>"Box"===e.type?b(e):w(e))),r=t.filter((e=>e.enabled&&"Exclude"===e.mode)).map((e=>"Box"===e.type?b(e):w(e))),s=e.length;for(let a=0;a<s;a+=3){let t=e[a],s=e[a+1],o=e[a+2];(0===i.length||y(t,s,o,i))&&(0===r.length||!y(t,s,o,r))||n.push(a/3)}return n}(new Float32Array(x.data.positions),x.data.crops)).buffer;e.postMessage({outOfBoundsIndexes:t},[t])}else if(x.data.positions)u=x.data.positions,p=new Float32Array(u),m=x.data.meshMatrixWorlds,g=x.data.cropsArray,f=x.data.meshIndexIntervals,v(m,g,f),e.postMessage({sortSetupComplete:!0});else if(x.data.sort||x.data.newMatrixWorlds||x.data.newCropsArray)(x.data.newMatrixWorlds||x.data.newCropsArray)&&(g=x.data.newCropsArray||g,m=x.data.newMatrixWorlds||m,v(m,g,f)),function(u){let p,f=new Float64Array(h,a,16);for(let e=0;e<16;e++)f[e]=u[e];if(i>1){t.exports.sortIndexes(r,s,c,a,o,l,d.DepthMapRange,i);let e=new Uint32Array(i);p=e.buffer,e.set(new Uint32Array(h,l,i))}else if(1===i){let e=new Uint32Array(i);e[0]=new Uint32Array(h,r,n)[0],p=e.buffer}else p=new ArrayBuffer(0);e.postMessage({sortDone:!0,indexesBuffer:p},[p])}(x.data.sort.view,x.data.sort.cameraPosition);else if(x.data.init){d=x.data.init.Constants,n=x.data.init.splatCount;let i=d.BytesPerInt,u=3*d.BytesPerFloat,p=new Uint8Array(x.data.init.sorterWasmBytes),f=n*(i+u)+(n*d.BytesPerInt*2+d.DepthMapRange*d.BytesPerInt*2)+32*d.MemoryPageSize,m=Math.floor(f/d.MemoryPageSize)+1,g={module:{},env:{memory:new WebAssembly.Memory({initial:2*m,maximum:3*m,shared:!0})}};WebAssembly.compile(p).then((e=>WebAssembly.instantiate(e,g))).then((p=>{t=p,r=0,s=n*i,a=s+n*u,c=a+16*d.BytesPerFloat*2,o=c+n*d.BytesPerInt,l=o+d.DepthMapRange*d.BytesPerInt,h=g.env.memory.buffer,e.postMessage({sortSetupPhase1Complete:!0})}))}}}C(cB,"DepthMapRange",65536),C(cB,"MemoryPageSize",65536),C(cB,"BytesPerFloat",4),C(cB,"BytesPerInt",4);var uB=function(){let e=new Float32Array(1),t=new Int32Array(e.buffer);return function(n){return e[0]=n,t[0]}}(),dB=function(e,t,n,i){return e+(t<<8)+(n<<16)+(i<<24)},pB=new ot;function fB(e){let t=!1;return e.scene.objects.traverse(((e,n)=>{if(!1===n.visible)return!0;"Splat"===n.type&&(t=!0)})),t}var mB,gB,vB,yB=class extends Ci{constructor(e,t,n,i){let r=arguments.length>4&&void 0!==arguments[4]&&arguments[4],s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,a=arguments.length>6?arguments[6]:void 0,o=arguments.length>7?arguments[7]:void 0;super(n,i),this.splatCount=t,this.meshIndexIntervals=a,this.meshMatrixWorlds=o,this.splatBuffers=e,this.geometry=n,this.material=i,this.splatDataTextures=null,this.halfPrecisionCovariancesOnGPU=r,this.devicePixelRatio=s,this.resetLocalSplatDataAndTexturesFromSplatBuffer()}static buildMesh(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,r=arguments.length>4?arguments[4]:void 0,s=arguments.length>5?arguments[5]:void 0,a=yB.buildGeomtery(t),o=yB.buildMaterial(r);return new yB(e,t,a,o,n,i,r,s)}static buildMaterial(e){let t={covariancesTexture:{type:"t",value:null},centersColorsTexture:{type:"t",value:null},meshIndexIntervals:{value:e},meshMatrixWorldsTexture:{type:"t",value:null},focal:{type:"v2",value:new ot},viewport:{type:"v2",value:new ot},basisViewport:{type:"v2",value:new ot},debugColor:{type:"v3",value:new Et},covariancesTextureSize:{type:"v2",value:new ot(1024,1024)},centersColorsTextureSize:{type:"v2",value:new ot(1024,1024)},orthoZoom:{type:"f",value:-1}};return new Ri({uniforms:t,vertexShader:"\n            precision highp float;\n            #include <common>\n\n            attribute uint splatIndex;\n\n            uniform highp sampler2D covariancesTexture;\n            uniform highp usampler2D centersColorsTexture;\n            uniform vec2 focal;\n            uniform vec2 viewport;\n            uniform vec2 basisViewport;\n            uniform vec2 covariancesTextureSize;\n            uniform vec2 centersColorsTextureSize;\n\t\t\t\t\t\tuniform highp sampler2D meshMatrixWorldsTexture;\n\t\t\t\t\t\tuniform uint meshIndexIntervals[257];\n\t\t\t\t\t\tuniform float orthoZoom;\n\n            varying vec4 vColor;\n            varying vec2 vUv;\n\n            varying vec2 vPosition;\n\n            const vec4 encodeNorm4 = vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0);\n            const uvec4 mask4 = uvec4(uint(0x000000FF), uint(0x0000FF00), uint(0x00FF0000), uint(0xFF000000));\n            const uvec4 shift4 = uvec4(0, 8, 16, 24);\n            vec4 uintToRGBAVec (uint u) {\n               uvec4 urgba = mask4 & u;\n               urgba = urgba >> shift4;\n               vec4 rgba = vec4(urgba) * encodeNorm4;\n               return rgba;\n            }\n\n            vec2 getDataUV(in int stride, in int offset, in vec2 dimensions) {\n                vec2 samplerUV = vec2(0.0, 0.0);\n                float d = float(splatIndex * uint(stride) + uint(offset)) / dimensions.x;\n                samplerUV.y = float(floor(d)) / dimensions.y;\n                samplerUV.x = fract(d);\n                return samplerUV;\n            }\n\n            void main () {\n                uvec4 sampledCenterColor = texture(centersColorsTexture, getDataUV(1, 0, centersColorsTextureSize));\n                vec3 splatCenter = uintBitsToFloat(uvec3(sampledCenterColor.gba));\n                vColor = uintToRGBAVec(sampledCenterColor.r);\n\n                vPosition = position.xy * 2.0;\n\n\t\t\t\t\t\t\t\tuint meshIndex;\n\t\t\t\t\t\t\t\tfor (int i = 1; i < 257; i++) {\n\t\t\t\t\t\t\t\t\tif (splatIndex < meshIndexIntervals[i]) {\n\t\t\t\t\t\t\t\t\t\tmeshIndex = uint(i - 1);\n\t\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tfloat strideMulmeshIndex = float(4u*meshIndex);\n\t\t\t\t\t\t\t\tfloat meshMatrixWorldsTextureLength = float(256*4);\n\n\t\t\t\t\t\t\t\tmat4 modelMat = mat4(\n\t\t\t\t\t\t\t\t\ttexture(meshMatrixWorldsTexture, vec2((strideMulmeshIndex+0.0)/meshMatrixWorldsTextureLength, 0)),\n\t\t\t\t\t\t\t\t\ttexture(meshMatrixWorldsTexture, vec2((strideMulmeshIndex+1.0)/meshMatrixWorldsTextureLength, 0)),\n\t\t\t\t\t\t\t\t\ttexture(meshMatrixWorldsTexture, vec2((strideMulmeshIndex+2.0)/meshMatrixWorldsTextureLength, 0)),\n\t\t\t\t\t\t\t\t\ttexture(meshMatrixWorldsTexture, vec2((strideMulmeshIndex+3.0)/meshMatrixWorldsTextureLength, 0))\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\tmat4 modelViewMat = viewMatrix * modelMat;\n\t\t\t\t\t\t\t\tvec4 viewCenter = modelViewMat * vec4(splatCenter, 1.0); \n                vec4 clipCenter = projectionMatrix * viewCenter;\n\n                vec2 sampledCovarianceA = texture(covariancesTexture, getDataUV(3, 0, covariancesTextureSize)).rg;\n                vec2 sampledCovarianceB = texture(covariancesTexture, getDataUV(3, 1, covariancesTextureSize)).rg;\n                vec2 sampledCovarianceC = texture(covariancesTexture, getDataUV(3, 2, covariancesTextureSize)).rg;\n\n                vec3 cov3D_M11_M12_M13 = vec3(sampledCovarianceA.rg, sampledCovarianceB.r);\n                vec3 cov3D_M22_M23_M33 = vec3(sampledCovarianceB.g, sampledCovarianceC.rg);\n\n                // Compute the 2D covariance matrix from the upper-right portion of the 3D covariance matrix\n                mat3 Vrk = mat3(\n                    cov3D_M11_M12_M13.x, cov3D_M11_M12_M13.y, cov3D_M11_M12_M13.z,\n                    cov3D_M11_M12_M13.y, cov3D_M22_M23_M33.x, cov3D_M22_M23_M33.y,\n                    cov3D_M11_M12_M13.z, cov3D_M22_M23_M33.y, cov3D_M22_M23_M33.z\n                );\n                float s = 1.0 / (viewCenter.z * viewCenter.z);\n\n                mat3 W = transpose(mat3(modelViewMat));\n                mat3 T = orthoZoom > 0.0 ? W : W * mat3(\n\t\t\t\t\t\t\t\t\tfocal.x / viewCenter.z, 0., -(focal.x * viewCenter.x) * s,\n\t\t\t\t\t\t\t\t\t0., focal.y / viewCenter.z, -(focal.y * viewCenter.y) * s,\n\t\t\t\t\t\t\t\t\t0., 0., 0.\n\t\t\t\t\t\t\t\t);\n                mat3 cov2Dm = transpose(T) * Vrk * T;\n                cov2Dm[0][0] += 0.3;\n                cov2Dm[1][1] += 0.3;\n\n                // We are interested in the upper-left 2x2 portion of the projected 3D covariance matrix because\n                // we only care about the X and Y values. We want the X-diagonal, cov2Dm[0][0],\n                // the Y-diagonal, cov2Dm[1][1], and the correlation between the two cov2Dm[0][1]. We don't\n                // need cov2Dm[1][0] because it is a symetric matrix.\n                vec3 cov2Dv = vec3(cov2Dm[0][0], cov2Dm[0][1], cov2Dm[1][1]);\n\n                vec3 ndcCenter = clipCenter.xyz / clipCenter.w;\n\n                // We now need to solve for the eigen-values and eigen vectors of the 2D covariance matrix\n                // so that we can determine the 2D basis for the splat. This is done using the method described\n                // here: https://people.math.harvard.edu/~knill/teaching/math21b2004/exhibits/2dmatrices/index.html\n                //\n                // This is a different approach than in the original work at INRIA. In that work they compute the\n                // max extents of the 2D covariance matrix in screen space to form an axis aligned bounding rectangle\n                // which forms the geometry that is actually rasterized. They then use the inverse 2D covariance\n                // matrix (called 'conic') to determine fragment opacity.\n                float a = cov2Dv.x;\n                float d = cov2Dv.z;\n                float b = cov2Dv.y;\n                float D = a * d - b * b;\n                float trace = a + d;\n                float traceOver2 = 0.5 * trace;\n                float term2 = sqrt(trace * trace / 4.0 - D);\n                float eigenValue1 = traceOver2 + term2;\n\t\t\t\t\t\t\t\tfloat eigenValue2 = max(traceOver2 - term2, 0.00); // prevent negative eigen value\n\n                const float maxSplatSize = 1024.0;\n                vec2 eigenVector1 = normalize(vec2(b, eigenValue1 - a));\n                // since the eigen vectors are orthogonal, we derive the second one from the first\n                vec2 eigenVector2 = vec2(eigenVector1.y, -eigenVector1.x);\n                vec2 basisVector1 = eigenVector1 * min(sqrt(2.0 * eigenValue1), maxSplatSize);\n                vec2 basisVector2 = eigenVector2 * min(sqrt(2.0 * eigenValue2), maxSplatSize);\n\n                vec2 ndcOffset = vec2(vPosition.x * basisVector1 + vPosition.y * basisVector2) * basisViewport;\n\n\t\t\t\t\t\t\t\tif (orthoZoom > 0.0) {\n\t\t\t\t\t\t\t\t\tndcOffset *= orthoZoom;\n\t\t\t\t\t\t\t\t}\n\n                gl_Position = vec4(ndcCenter.xy + ndcOffset, ndcCenter.z, 1.0);\n            }",fragmentShader:"\n            precision highp float;\n            #include <common>\n\n            uniform vec3 debugColor;\n\n            varying vec4 vColor;\n            varying vec2 vUv;\n\n            varying vec2 vPosition;\n\t\t\t\t\t\tlayout(location = 1) out vec4 gVelocity; \n\n            void main () {\n                // compute the negative squared distance from the center of the splat to the\n                // current fragment in the splat's local space.\n                float A = -dot(vPosition, vPosition);\n                if (A < -4.0) discard;\n                vec3 color = vColor.rgb;\n                A = exp(A) * vColor.a;\n                gl_FragColor = vec4(color.rgb, A);\n\t\t\t\t\t\t\t\tgVelocity = vec4(0.0); // so it is ignored by TAA\n            }",transparent:!0,alphaTest:1,blending:1,depthTest:!0,depthWrite:!1,side:2})}static buildGeomtery(e){let t=new di;t.setIndex([0,1,2,0,2,3]);let n=new Float32Array(12),i=new ti(n,3);t.setAttribute("position",i),i.setXYZ(0,-1,-1,0),i.setXYZ(1,-1,1,0),i.setXYZ(2,1,1,0),i.setXYZ(3,1,-1,0),i.needsUpdate=!0;let r=(new Ql).copy(t),s=new Uint32Array(e),a=new La(s,1,!1);return a.setUsage(35048),r.setAttribute("splatIndex",a),r.instanceCount=e,r}resetLocalSplatDataAndTexturesFromSplatBuffer(){this.updateLocalSplatDataFromSplatBuffer(),this.allocateAndStoreLocalSplatDataInTextures()}updateLocalSplatDataFromSplatBuffer(){this.splatBuffers.forEach((e=>e.buildPreComputedBuffers())),this.covariances=new Float32Array(6*this.splatCount),this.colors=new Uint8Array(4*this.splatCount),this.centers=new Float32Array(3*this.splatCount);let e=0,t=0,n=0;for(let i of this.splatBuffers){let r=i.nsplats;this.colors.subarray(e,e+4*r).set(i.colorsA),e+=4*r,this.centers.subarray(t,t+3*r).set(i.decoded.xyz.denormDequant().data),t+=3*r,this.covariances.subarray(n,n+6*r).set(new Float32Array(i.precomputedCovarianceBufferData)),n+=6*r}}allocateAndStoreLocalSplatDataInTextures(){let e=this.splatCount,t=new ot(4096,1024);for(;t.x*t.y*2<6*e;)t.y*=2;let n,i,r=new ot(4096,1024);for(;r.x*r.y*4<4*e;)r.y*=2;if(this.halfPrecisionCovariancesOnGPU){i=new Uint16Array(t.x*t.y*2);for(let e=0;e<this.covariances.length;e++)i[e]=Nc.toHalfFloat(this.covariances[e]);n=new Oa(i,t.x,t.y,_e,ve)}else i=new Float32Array(t.x*t.y*2),i.set(this.covariances),n=new Oa(i,t.x,t.y,_e,ge);n.needsUpdate=!0,this.material.uniforms.covariancesTexture.value=n,this.material.uniforms.covariancesTextureSize.value.copy(t);let s=new Uint32Array(r.x*r.y*4);for(let c=0;c<e;c++){let e=4*c,t=3*c,n=4*c;s[n]=dB(this.colors[e],this.colors[e+1],this.colors[e+2],this.colors[e+3]),s[n+1]=uB(this.centers[t]),s[n+2]=uB(this.centers[t+1]),s[n+3]=uB(this.centers[t+2])}let a=new Oa(s,r.x,r.y,1033,me);a.internalFormat="RGBA32UI",a.needsUpdate=!0,this.material.uniforms.centersColorsTexture.value=a,this.material.uniforms.centersColorsTextureSize.value.copy(r);let o=new Float32Array(4096);for(let c=0;c<this.meshMatrixWorlds.length;c++)o.set(this.meshMatrixWorlds[c].elements,16*c);let l=new Oa(o,1024,1,be,ge);l.needsUpdate=!0,this.material.uniforms.meshMatrixWorldsTexture.value=l,this.material.uniformsNeedUpdate=!0,this.splatDataTextures={covariances:{data:i,texture:n,size:t},centerColors:{data:s,texture:a,size:r},meshMatrixWorlds:{data:o,texture:l}}}updateIndexes(e){let t=this.geometry;t.attributes.splatIndex.set(e),t.attributes.splatIndex.needsUpdate=!0,t.instanceCount=e.length}updateUniforms(e,t,n,i){this.splatCount>0&&(pB.set(e.x*this.devicePixelRatio,e.y*this.devicePixelRatio),this.material.uniforms.viewport.value.copy(pB),this.material.uniforms.basisViewport.value.set(2/pB.x,2/pB.y),this.material.uniforms.focal.value.set(t,n),this.material.uniforms.orthoZoom.value=i,this.material.uniformsNeedUpdate=!0)}getSplatDataTextures(){return this.splatDataTextures}getSplatCount(){return this.splatCount}getCenters(){return this.centers}getColors(){return this.colors}getCovariances(){return this.covariances}dispose(){this.geometry.dispose(),this.material.dispose(),this.splatDataTextures&&(this.splatDataTextures.covariances.texture.dispose(),this.splatDataTextures.centerColors.texture.dispose(),this.splatDataTextures.meshMatrixWorlds.texture.dispose()),this.removeFromParent()}},bB=new Promise((e=>{mB=e})),xB=!1;function wB(){if(!xB)return gB||(gB=async function(){let e=await n.e(23).then(n.bind(n,23));mB(e),xB=!0}(),gB)}bB.then((e=>vB=e));var SB=class{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};C(this,"updateView",function(){let e=new pn,t=[],n=new Bt(0,0,-1),i=new Bt(0,0,-1),r=new Bt,s=new Bt;return function(){let a=arguments.length>0&&void 0!==arguments[0]&&arguments[0],l=arguments.length>1?arguments[1]:void 0,c=this.updateMatrixWorldsInWorkerIfNeeded(),h=this.cropsChanged();if(!a){i.set(0,0,-1).applyQuaternion(l.quaternion);let e=!1,t=!1;if(i.dot(n)<=.95&&(e=!0),s.copy(l.position).sub(r).length()>=1&&(t=!0),!e&&!t&&!c&&!h&&!this.needsInitialRender)return}this.needsInitialRender=!1,r.copy(l.position),n.copy(i),e.copy(l.matrixWorld).invert(),e.premultiply(this.dummyPerspectiveMatrix),t[0]=l.position.x,t[1]=l.position.y,t[2]=l.position.z;let u=o(o({sort:{view:e.elements,cameraPosition:t,splatRenderCount:this.splatRenderCount,splatSortCount:this.splatRenderCount}},c?{newMatrixWorlds:this.meshMatrixWorlds}:{}),h?{newCropsArray:this.cropsArray}:{});this.sortRunning?this.queuedMessage=u:(this.queuedMessage=null,this.sortRunning=!0,this.sortWorker.postMessage(u))}}()),this.scene=e.scene,this.currentPage=null,this.devicePixelRatio=window.devicePixelRatio,this.sortWorker=null,this.splatRenderCount=0,this.splatSortCount=0,this.splatMesh=null,this.sortRunning=!1,this.meshMatrixWorlds=null,this.meshMatrixWorldsOld=null,this.cropsArray=null,this.splatEntries=null,this.queuedMessage=null,this.needsInitialRender=!0,this.dummyPerspectiveMatrix=(new pn).makePerspective(-1,1,-1,1,.1,1e3)}updateSplatMeshUniforms(e,t){let n=new ot;null!==this.splatMesh&&this.splatMesh.getSplatCount()>0&&(e.getSize(n),this.cameraFocalLengthX=t.projectionMatrix.elements[0]*this.devicePixelRatio*n.x*.45,this.cameraFocalLengthY=t.projectionMatrix.elements[5]*this.devicePixelRatio*n.y*.45,this.splatMesh.updateUniforms(n,this.cameraFocalLengthX,this.cameraFocalLengthY,t.isPerspectiveCamera?-1:t.zoom*this.devicePixelRatio))}loadSplat(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.activePage=this.scene.activePage,e.position&&(e.position=(new Bt).fromArray(e.position)),e.orientation&&(e.orientation=(new Lt).fromArray(e.orientation)),e.halfPrecisionCovariances=!!e.halfPrecisionCovariances;let t=[];if(this.splatEntries=t,this.activePage.traverseVisibleEntity((e=>{"Splat"===e.data.type&&t.push(e)})),this.splatMesh&&this.splatMesh.dispose(),0===t.length)return this.splatMesh=null,!1;this.meshMatrixWorlds=t.map((e=>e.matrixWorld)),this.meshMatrixWorldsOld=t.map((e=>e.matrixWorld.clone())),this.cropsArray=t.map((e=>e.data.crops.map((e=>e.data))));let n=t.map((e=>new vB.GSplineBuffer(new Uint8Array(e.data.buffer).buffer))),i=0,r=[0];for(let s of n)i+=s.getSplatCount(),r.push(i);return this.setupSplatMesh(n,i,e.position,e.orientation,e.halfPrecisionCovariances,this.devicePixelRatio,r,this.meshMatrixWorlds),this.setupSortWorker(i),!0}updateMatrixWorldsInWorkerIfNeeded(){let e=this.splatDataTextures.meshMatrixWorlds.data;for(let t=0;t<this.meshMatrixWorlds.length;t++)e.set(this.meshMatrixWorlds[t].elements,16*t);return this.splatDataTextures.meshMatrixWorlds.texture.needsUpdate=!0,!this.meshMatrixWorlds.every(((e,t)=>e.equals(this.meshMatrixWorldsOld[t])))&&(this.meshMatrixWorldsOld=this.meshMatrixWorlds.map((e=>e.clone())),!0)}cropsChanged(){let e=!1;return this.splatEntries.forEach(((t,n)=>{var i;t.data.crops.forEach(((t,i)=>{void 0===this.cropsArray[n][i]?(e=!0,this.cropsArray[n][i]=t.data):Object.entries(t.data).forEach((t=>{var r;let[s,a]=t;(Array.isArray(a)&&a.some(((e,t)=>e!==this.cropsArray[n][i][s][t]))||a!==(null===(r=this.cropsArray[n][i])||void 0===r?void 0:r[s]))&&(e=!0,this.cropsArray[n][i][s]=a)}))})),t.data.crops.length!==(null===(i=this.cropsArray[n])||void 0===i?void 0:i.length)&&(this.cropsArray[n].length=t.data.crops.length,e=!0)})),e}setupSplatMesh(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Bt,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new Lt,r=arguments.length>4&&void 0!==arguments[4]&&arguments[4],s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,a=arguments.length>6?arguments[6]:void 0,o=arguments.length>7?arguments[7]:void 0;this.splatMesh=yB.buildMesh(e,t,r,s,a,o),this.splatMesh.position.copy(n),this.splatMesh.quaternion.copy(i),this.splatMesh.frustumCulled=!1,this.splatMesh.renderOrder=99999,this.splatRenderCount=t,this.splatMesh.onBeforeRender=(e,t,n)=>this.update(e,n)}setupSortWorker(e){this.sortWorker=function(e){let t=new Worker(URL.createObjectURL(new Blob(["(",hB.toString(),")(self)"],{type:"application/javascript"}))),n=atob("AGFzbQEAAAAADwhkeWxpbmsuMAEEAAAAAAETA2AAAGAIf39/f39/f38AYAABfwISAQNlbnYGbWVtb3J5AgMAgIAEAwQDAAECBzkDEV9fd2FzbV9jYWxsX2N0b3JzAAALc29ydEluZGV4ZXMAARNlbXNjcmlwdGVuX3Rsc19pbml0AAIK3gMDAwABC9IDAwF/BnwBfgJAIAdFDQAgAysDUCEMIAMrAzAhDSADKwMQIQ5BACEDRP///////+9/IQtEAAAAAAAAEAAhCgNAIAIgA0ECdGoCfyAOIAEgA0EMbGoiCCoCALuiIA0gCCoCBLuioCAMIAgqAgi7oqBEAAAAAAAAsECiIgmZRAAAAAAAAOBBYwRAIAmqDAELQYCAgIB4CzYCACAJIAsgCSALYxshCyAJIAogCSAKZBshCiADQQFqIgMgB0cNAAsgB0UNACAGuCAKIAuhoyEJQQAhAwNAAn8gCSACIANBAnRqIgEoAgC3IAuhoiIKmUQAAAAAAADgQWMEQCAKqgwBC0GAgICAeAshCCABIAg2AgAgBCAIQQJ0aiIBIAEoAgBBAWo2AgAgA0EBaiIDIAdHDQALCyAGQQJPBEAgBCgCACEIQQEhAwNAIAQgA0ECdGoiASABKAIAIAhqIgg2AgAgA0EBaiIDIAZHDQALCyAHQQFrIgGtIQ8DQCAEIAIgD6dBAnQiA2ooAgBBAnRqIgcgBygCAEEBayIHNgIAIAUgASAHa0ECdGogACADaigCADYCACAPUCEDIA9CAX0hDyADRQ0ACyAGBEAgBEEAIAZBAnT8CwALCwQAQQAL"),i=new Uint8Array(n.length);for(let r=0;r<n.length;r++)i[r]=n.charCodeAt(r);return t.postMessage({init:{sorterWasmBytes:i.buffer,splatCount:e,Constants:{BytesPerFloat:cB.BytesPerFloat,BytesPerInt:cB.BytesPerInt,DepthMapRange:cB.DepthMapRange,MemoryPageSize:cB.MemoryPageSize}}}),t}(e),this.sortWorker.onmessage=e=>{var t;e.data.sortDone?(this.sortRunning=!1,null!==(t=this.splatMesh)&&void 0!==t&&t.updateIndexes(new Uint32Array(e.data.indexesBuffer)),this.lastSortTime=e.data.sortTime,this.queuedMessage&&(this.sortWorker.postMessage(this.queuedMessage),this.queuedMessage=null)):e.data.sortCanceled?this.sortRunning=!1:e.data.sortSetupPhase1Complete?this.sortWorker.postMessage({positions:this.splatMesh.getCenters().buffer,meshMatrixWorlds:this.splatMesh.meshMatrixWorlds,meshIndexIntervals:this.splatMesh.meshIndexIntervals,cropsArray:this.cropsArray}):e.data.sortSetupComplete&&(this.splatDataTextures=this.splatMesh.getSplatDataTextures(),this.scene.activePage.add(this.splatMesh),this.needsInitialRender=!0)}}update(e,t){null!==this.splatMesh&&(this.updateSplatMeshUniforms(e,t),this.updateView(!1,t))}getSplatMesh(){return this.splatMesh}},_B=new Jn;_B.wireframe=!0;var EB=new Bt,AB=class extends Ca{constructor(e,t){super(),this.data=e,this.sharedAssets=t,this.enableHelpers=!1,this.wireframeState=!1,this.needsTransmissionDirty=!0,this.needsNormalDirty=!0,this._needsTransmission=!1,this._needsNormal=!1,this.geometryCacheChanged=!1,this.splatViewer=null,this.shapeBlendIntances=[],this.entityByUuid={},this.entityIdentityToEntity={},this.toExpandCloner=new Set,this.toUpdateCloner=new Set,this.pendingCommands=[],this.pathConstraints=new lB,this.invisibleObjects=new nI("jflkdsafjasdifjaslk",o(o({},Kb.defaultData),{},{visible:!1,name:"buildin invisible"})),this.needsRecomputeInstances=!1,this.init(e,t),this.matrixAutoUpdate=!1,this.errorPage=new dL("fdasfa",o(o({},sx.defaultData),{},{name:""}),{shared:t,scene:this})}markGeometryCacheDirty(){this.geometryCacheChanged=!0}markNeedsUpdateRendererDirty(){this.needsTransmissionDirty=!0,this.needsNormalDirty=!0}needsTransmission(){return this.needsTransmissionDirty&&(this._needsTransmission=function(e){let t=!1;return e.traverseEntity((e=>{if(e instanceof MD)if(Array.isArray(e.material))for(let n=0;n<e.material.length;n++)iB(e,e.material[n])&&(t=!0);else iB(e,e.material)&&(t=!0)})),t}(this),this.needsTransmissionDirty=!1),this._needsTransmission}needsNormal(){return this.needsNormalDirty&&(this._needsNormal=function(e){let t=!1;return e.traverseEntity((e=>{if(e instanceof MD)if(Array.isArray(e.material))for(let n=0;n<e.material.length;n++)nB(e,e.material[n])&&(t=!0);else nB(e,e.material)&&(t=!0)})),t}(this),this.needsNormalDirty=!1),this._needsNormal}registerInstanceAndSetUuid(e){let t=e.identity.join("-"),n=this.entityIdentityToEntity[t];n&&(e.uuid=n.uuid),this.entityIdentityToEntity[t]=e,this.entityByUuid[e.uuid]=e}markPenumbraSizeDirty(){for(let e of this.children)e instanceof dL&&(e.penumbraSizeArrayCache=null)}findInstance(e){return this.entityIdentityToEntity[e.join("-")]}get bgColor(){return this.activePage.bgColor}get postprocessing(){return this.activePage.data.postprocessing}getWithSortKey(e){let t=this.find(e);if(void 0===t)return;let n=[],i=t;for(;i!==this;){let e=i;i=i.parent;let t=i.children.indexOf(e);n.splice(0,0,t)}return{entity:t,sortKey:n}}getAllSorted(e){let t=[];for(let n of e){let e=this.getWithSortKey(n.id);void 0!==e&&t.push(e)}return t.sort(((e,t)=>zm(e.sortKey,t.sortKey))),t.map((e=>e.entity))}nonExistOrDescendantOf(e,t){let n=this.find(e);if(void 0===n)return!0;for(;n;){if(n.uuid===t)return!0;n=n.parent}return!1}find(e){if(this.activePage&&this.activePage.personalCamera.parent){if("f23858d0-4a3b-4bd8-8173-66ed0af7f6fb-personalCamera"===e)return this.activePage.personalCamera;if(e===rb)return this.activePage.personalCamera}if(""===e||void 0===e)return;let t=this.entityByUuid[e];return void 0===t?this.getObjectByProperty("uuid",e):t}find2D(e){for(let t of this.children)if(t instanceof dL&&t.uiScene){let n=t.uiScene.find(e);if(n)return n}}findScene2DfromObject2D(e){for(let t of this.children)if(t instanceof dL&&t.uiScene&&t.uiScene.find(e))return t.uiScene}find2DInUIObjects(e){let t;return this.traverseEntity((n=>{void 0===t&&n instanceof SL&&(t=n.uiCanvas.find(e))})),t}traverse2D(e){for(let t of this.children)t instanceof dL&&t.uiScene&&t.uiScene.traverse(e)}debugEnsureEntity(e){let t=this.find(e);t?Array.isArray(t.identity)&&void 0===this.findInstance(t.identity)&&console.error("not found instance"):console.error("not found")}addPendingExpandCloner(e){this.toExpandCloner.add(e)}addPendingUpdateCloner(e){this.toUpdateCloner.add(e)}markToExpandCloner(e){this.toExpandCloner.add(e),e.traverseEntityAncestors((e=>{this.toExpandCloner.add(e)}))}doPendingExpandCloner(){this.toExpandCloner.forEach((e=>{e.expandCloner(this)})),this.toExpandCloner.clear()}doPendingUpdateCloner(){this.toUpdateCloner.forEach((e=>{var t;null===(t=e.cloner)||void 0===t||t.update()})),this.toUpdateCloner.clear()}doPendingUpdates(){this.doPendingExpandCloner(),this.doPendingUpdateCloner(),this.applyPendingCommands()}addPendingCommand(e){this.pendingCommands.push(e)}applyPendingCommands(){this.pendingCommands.forEach((e=>e())),this.pendingCommands.length=0}updateByLibOp(e,t){1===e.path.length&&"components"===e.path[0]&&1===e.type&&this.createChildrenObjects([o(o({},e.data.asset),{},{id:e.id})],this.invisibleObjects,t)}updateTreeByOp(e,t){if(0===e.path.length&&7===e.type){let n=null===e.parent?this:this.find(e.parent);if(void 0===n)throw new Error("unexpected");let i=this.createObject(e.id,e.data,e.children,n,e.localIndex,t);i.updateVisible(this),i.resetBBoxNeedsUpdate(),YO(i)&&QO(i.parent)&&(i.invalidateUpstreamBooleanData(),i.parent.invalidateDownstreamBooleanData().recomputeBoolean()),this.markNeedsRecomputeInstancesForAncessors(n),this.markNeedsRecomputeInstancesForChildren(i),this.markToExpandCloner(i),this.markPenumbraSizeDirty(),i.updatePathSnapping()}else if(0===e.path.length&&8===e.type){let t=this.find(e.id);if(void 0===t)throw new Error("unexpected");t.traverseEntity((e=>{e instanceof qL&&(this.shapeBlendIntances=this.shapeBlendIntances.filter((t=>t!==e)))})),this.markToExpandCloner(t),t.resetBBoxNeedsUpdate(),this.unregisterObject(t);let n=t.parent;this.markNeedsRecomputeInstancesForAncessors(n),this.markNeedsRecomputeInstancesForChildren(t),this.markPenumbraSizeDirty(),t.parent.remove(t),QO(t.parent)&&(t.parent.invalidateUpstreamBooleanData(),t.parent.invalidateDownstreamBooleanData().recomputeBoolean()),YO(t)&&(t.freeBooleanPointer(),n instanceof qO&&n.invalidateDownstreamBooleanData().recomputeBoolean()),t instanceof mL&&t.detachShape(),this.disposeAndUnregisterEntityRecursivelyIfNotReregistered(t),this.pathConstraints.removeDependencies(t.uuid),t.updatePathSnapping()}else if(0===e.path.length&&9===e.type){var n;let t=this.find(e.id);if(void 0===t)throw new Error("unexpected");this.markNeedsRecomputeInstancesForChildren(t);let i=t.parent;this.markNeedsRecomputeInstancesForAncessors(i),null!==(n=t.cloner)&&void 0!==n&&n.resetOnMove(),this.markToExpandCloner(t);let r=null===e.parent?this:this.find(e.parent);if(void 0===r)throw new Error("unexpected");r.add(t),this.markNeedsRecomputeInstancesForAncessors(r),this.markToExpandCloner(t),t.invalidateClonerTransform(t),t.updateVisible(this),t.resetBBoxNeedsUpdate(),this.markPenumbraSizeDirty();let s=e.localIndex;r.children.splice(s,0,r.children.pop()),YO(t)&&(t.invalidateUpstreamBooleanData(),QO(t.parent)?t.parent.invalidateDownstreamBooleanData().recomputeBoolean():i instanceof qO&&i.invalidateDownstreamBooleanData().recomputeBoolean()),t.updatePathSnapping()}this.markNeedsUpdateRendererDirty(),this.markGeometryCacheDirty()}get playPage(){var e;return null!==(e=this.find(this.data.publish.playPage))&&void 0!==e?e:this.errorPage}updatePage(e){var t;this.activePage&&this.activePage.onDeactive(),this.activePage=this.errorPage;for(let n of this.children)n instanceof dL&&(n.visible=n.uuid===e,n.visible&&(this.activePage=n,this.activePage.onActive(this)));this.activePage!==(null===(t=this.splatViewer)||void 0===t?void 0:t.activePage)&&this.reloadSplats()}updateEntityByOp(e,t,n,i){if(0===t.type){if(("overrides"in t.props||"component"in t.props)&&this.markNeedsRecomputeInstances(),"visible"in t.props&&this.markPenumbraSizeDirty(),t.path.includes("overrides")&&"states"in t.props){let{rest:e}=t.props;t=o(o({},t),{},{props:e}),this.markNeedsRecomputeInstances()}"pathSnapping"===t.path[0]&&void 0!==t.props.pathId&&this.pathConstraints.setConstraint(e,t.props.pathId)}let r=this.find(e);if(r)try{(function(e,t,n,i){e.updateByOp(t,n,i,!1)})(r,t,n,{scene:this,shared:i}),r instanceof RD&&r.updateGeometryGroupsIfNeeded()}catch(jZ){console.error(jZ)}}updateEntity2DByOp(e,t,n,i,r){let s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[];e.updateEntityByOp(t,n,i,r),this.traverseEntity((e=>{var a;(e instanceof SL||e instanceof dL)&&(s.includes(null!==(a=e.frameId)&&void 0!==a?a:"")||e.frameId===t)&&e.updateEntity2DByOp(t,n,i,r)}))}get activeCamera(){return this.activePage.activeCamera}switchActiveCamera(e){this.activePage.switchActiveCamera(e)}isInvisibleObjects(e){return e===this.invisibleObjects||e.hasAnccestor(this.invisibleObjects)}init(e,t){let n=Object.entries(t.data.lib.components).map(((e,t)=>({data:e[1].asset.data,children:e[1].asset.children,id:e[0],fi:t})));this.invisibleObjects.updateState(this.invisibleObjects.data,{scene:this,shared:t}),this.add(this.invisibleObjects),this.createChildrenObjects(n,this.invisibleObjects,t),this.createChildrenObjects(e.objects,this,t),this.updatePage(e.publish.playPage),this.activePage.switchToPlayCamera(),this.expandInstances(t,!0),this.traverseEntity((e=>{e instanceof jO&&e.updateUp()})),this.doPendingExpandCloner(),this.applyPendingCommands()}markNeedsRecomputeInstances(){this.needsRecomputeInstances=!0}markNeedsRecomputeInstancesForChildren(e){e.traverseEntity((e=>{("Component"===e.data.type||"Instance"===e.data.type)&&this.markNeedsRecomputeInstances()}))}markNeedsRecomputeInstancesForAncessors(e){XS.is(e)&&("Component"===e.data.type&&this.markNeedsRecomputeInstances(),e.traverseAncestors((e=>{XS.is(e)&&"Component"===e.data.type&&this.markNeedsRecomputeInstances()})))}relativeizeInner(e,t,n,i,r,s,a){if(e){let o=i.find(e);o&&o!==i&&r.forInstancesRec((i=>{i.data=Hg(i.data,(r=>{let o=r.events.data(a.id),l=i.goUp(s);if(l){let i=[...Bm(l.identity),e].join("-"),r=this.entityIdentityToEntity[i];if(r){let e=r.uuid;Ug.zoom(o,t)[n]=e}else console.warn("cannot find instance")}})).data}))}}rewriteActions(e,t,n,i,r,s){e.forEach((e=>{"Transition"===e.data.type||"Animation"===e.data.type?this.relativeizeInner(e.data.object,[...t,e.id],"object",n,i,r,s):"Conditional"===e.data.type&&(this.rewriteActions(e.data.ifActions,[...t,e.id,"ifActions"],n,i,r,s),this.rewriteActions(e.data.elseActions,[...t,e.id,"elseActions"],n,i,r,s))}))}rewriteEventsBeforeGoToPlayMode(){this.traverseEntity((e=>{if(e instanceof vL&&"string"==typeof e.identity&&"Component"===e.data.type)return e.traverseEntity(((t,n)=>{t.data.events.forEach((i=>{if("GameControl"===i.data.type){let r=!1;if(t.forInstancesRec((e=>{e.data=Hg(e.data,(t=>{e.isInstanceRoot||(t.events.delete(i.id),r=!0)})).data})),!1===r)for(let s of Ex.list)this.rewriteActions(i.data.gameActions[s],["gameActions",s],e,t,n,i)}else"Conditional"===i.data.type?("Distance"===i.data.condition.type?(this.relativeizeInner(i.data.condition.fromObject,["condition"],"fromObject",e,t,n,i),this.relativeizeInner(i.data.condition.toObject,["condition"],"toObject",e,t,n,i)):"State"===i.data.condition.type?this.relativeizeInner(i.data.condition.object,["condition"],"object",e,t,n,i):"Comparison"===i.data.condition.type&&("Property"===i.data.condition.lOperand.type&&this.relativeizeInner(i.data.condition.lOperand.value[0],["condition","lOperand","value"],0,e,t,n,i),"Property"===i.data.condition.rOperand.type&&this.relativeizeInner(i.data.condition.rOperand.value[0],["condition","rOperand","value"],0,e,t,n,i)),this.rewriteActions(i.data.inActions,["inActions"],e,t,n,i),this.rewriteActions(i.data.outActions,["outActions"],e,t,n,i)):"actions"in i.data&&this.rewriteActions(i.data.actions,["actions"],e,t,n,i)}))})),!0}))}expandInstances(e,t,n){let i=new Set;this.traverseEntity((r=>{if(r instanceof vL&&r.isInstanceRoot)return r.expandInstanceChildren({scene:this,shared:e,pendingDeletes:i}),t||r.resetBBoxNeedsUpdate(),n&&r.traverseEntity((e=>{n.addClip(e)})),!0}));for(let r of i)this.disposeAndUnregisterEntityRecursivelyIfNotReregistered(r),yL(r)}recomputeInstances(e,t){this.needsRecomputeInstances&&(this.needsRecomputeInstances=!1,this.traverseEntity((e=>{e instanceof vL&&e.isInstanceRoot&&(e.component=void 0)})),this.expandInstances(e,!1,t))}disposeAndUnregisterEntityRecursivelyIfNotReregistered(e){e.traverseEntity((e=>{let t="string"==typeof e.identity?e.identity:e.identity.join("-");this.entityIdentityToEntity[t]===e&&(delete this.entityByUuid[e.uuid],delete this.entityIdentityToEntity[t]),e.dispose()}))}clearScene(){for(let e of this.children)XS.is(e)&&e.disposeRecursively();this.children.length=0}resetAfterClear(e,t){this.init(e,t)}raycast(e){return this.raycast1(e,!1)}raycast1(e,t){let n=[],i=r=>{for(let s of r.children){let r=s.cloner;if(XS.is(s)&&!s.raycastLock&&(s.visible||null!==r&&void 0!==r&&r.object.data.visible))if(!0===t&&s.isInstanceRoot){let t=[];if(e.intersectObject(s,!0,t),t.length){let e=t[0];e.object=s,e.point.applyMatrix4(e.object.matrixWorld);let i=s.matrixWorld.clone().invert();e.point.applyMatrix4(i),n.push(e)}}else(YO(s)||KO(s)&&this.enableHelpers&&s.objectHelper.visible)&&(e.intersectObject(s,!1,n),oB(s,e,n)),i(s)}};return i(this.activePage),n}raycastWithClones(e){let t=[],n=i=>{for(let r of i.children){let i=r.cloner;XS.is(r)&&(r.visible||(null===i||void 0===i?void 0:i.object.data.visible))&&((YO(r)||KO(r)&&this.enableHelpers&&r.objectHelper.visible)&&(e.intersectObject(r,!1,t),oB(r,e,t,!0)),n(r))}};return n(this),t}forEachEntity(e){for(let t of this.children)XS.is(t)&&e(t)}traverseConcreteEntity(e){for(let t of this.children)XS.is(t)&&t.isConcreteEntity&&t.traverseEntity(e)}traverseEntity(e){for(let t of this.children)XS.is(t)&&t.traverseEntity(e)}updateFont(e,t){this.traverseEntity((n=>{if(n instanceof RD&&"Mesh"===n.data.type&&("TextGeometry"===n.data.geometry.type||"InputGeometry"===n.data.geometry.type)&&n.data.geometry.font===e){let i=n.geometry,r=n.data.geometry;i.updateFont(e,t).then((()=>{i.update(r);let e=n.invalidateDownstreamBooleanData();QO(e)&&e.recomputeBoolean()}))}}))}traverseObject(e){for(let t of this.children)US.is(t)&&t.traverseObject(e)}traverseVisibleEntity(e){for(let t of this.children)XS.is(t)&&t.visible&&t.traverseVisibleEntity(e)}dispose(){this.clearScene()}createChildrenObjects(e,t,n){let i=0;for(let r of e)this.createObject(r.id,r.data,r.children,t,i,n),i+=1}registerObjectCreatedInLegacy(e){this.entityByUuid[e.uuid]=e}unregisterObject(e){delete this.entityByUuid[e.uuid];for(let t of e.children)this.unregisterObject(t)}createObject(e,t,n,i,r,s){var a;let o={scene:this,shared:s},l=NL(e,t,o);return l instanceof qL&&this.shapeBlendIntances.push(l),l&&(this.entityByUuid[e]=l,i.add(l),i.children.splice(r,0,i.children.pop()),n.length>0&&(l.isInstanceRoot?console.error("instance should not have children!"):this.createChildrenObjects(n,l,s)),l.updateState(t,o),l instanceof RD&&l.updateGeometryGroupsIfNeeded(),l.updateVisible(this),l.cloner&&this.toExpandCloner.add(l),null!==(a=t.pathSnapping)&&void 0!==a&&a.pathId&&this.pathConstraints.setConstraint(e,t.pathSnapping.pathId)),"Empty"===t.type&&t.animations&&l.traverseEntity((e=>{let t=e.dataPatched;if(e instanceof RD&&t.bones&&t.boneInverses){let n=t.bones.map((e=>this.find(e))),i=t.boneInverses.map((e=>(new pn).fromArray(e))),r=new ka(n,i);e.bind(r,e.bindMatrix)}else e.matrixAutoUpdate=!0})),l}getCenter(e){let t=[];for(let i=0,r=e.length;i<r;++i){let{id:n,recursive:r}=e[i],s=this.find(n),a=r?s.recursiveBBox:s.singleBBox;t.push(...a.vertices)}let n=new Ft;return n.setFromPoints(t),n.getCenter(EB),EB}copyMatrixWorld(e,t){if(null===e)return void t.identity();let n=this.find(e);n?t.copy(n.matrixWorld):t.identity()}copyParentMatrixWorld(e,t){var n;if(null===e)return void t.identity();let i=null===(n=this.find(e))||void 0===n?void 0:n.parent;i?t.copy(i.matrixWorld):t.identity()}traverseMaterial(e){this.traverseEntity((t=>{if(t instanceof UC)if(Array.isArray(t.material))for(let n=0;n<t.material.length;n++)t.material[n]instanceof wP&&e(t.material[n]);else t.material instanceof wP&&e(t.material)}))}updateViewPlaneSize(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this.traverseConcreteEntity((i=>{i instanceof jO&&i.setViewplaneSize(e,t,n)}))}initializeSplatViewer(){this.splatViewer=new SB({scene:this}),this.reloadSplats()}reloadSplats(){var e;null===(e=this.splatViewer)||void 0===e||e.loadSplat()}},CB=(e,t)=>{let n=t.x-e.x,i=t.y-e.y;return Math.sqrt(n*n+i*i)},MB=e=>e*(Math.PI/180),TB=e=>e*(180/Math.PI),PB=new Map,DB=e=>{PB.has(e)&&clearTimeout(PB.get(e)),PB.set(e,setTimeout(e,100))},OB=(e,t,n)=>{let i,r=t.split(/[ ,]+/g);for(let s=0;s<r.length;s+=1)i=r[s],e.addEventListener?e.addEventListener(i,n,!1):e.attachEvent&&e.attachEvent(i,n)},IB=(e,t,n)=>{let i,r=t.split(/[ ,]+/g);for(let s=0;s<r.length;s+=1)i=r[s],e.removeEventListener?e.removeEventListener(i,n):e.detachEvent&&e.detachEvent(i,n)},RB=e=>(e.preventDefault(),e.type.match(/^touch/)?e.changedTouches:e),kB=()=>{if(typeof window>"u")return;return{x:void 0!==window.pageXOffset?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,y:void 0!==window.pageYOffset?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop}},LB=(e,t)=>{t.top||t.right||t.bottom||t.left?(e.style.top=t.top,e.style.right=t.right,e.style.bottom=t.bottom,e.style.left=t.left):(e.style.left=t.x+"px",e.style.top=t.y+"px")},BB=(e,t,n)=>{let i=zB(e);for(let r in i)if(i.hasOwnProperty(r))if("string"==typeof t)i[r]=t+" "+n;else{let e="";for(let i=0,r=t.length;i<r;i+=1)e+=t[i]+" "+n+", ";i[r]=e.slice(0,-2)}return i},zB=e=>{let t={};return t[e]="",["webkit","Moz","o"].forEach((function(n){t[n+e.charAt(0).toUpperCase()+e.slice(1)]=""})),t},NB=(e,t)=>{for(let n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);return e},FB=(e,t)=>{if(e.length)for(let n=0,i=e.length;n<i;n+=1)t(e[n]);else t(e)};typeof window<"u"&&(UB="ontouchstart"in window,jB=!!window.PointerEvent,VB=!!window.MSPointerEvent);var UB,jB,VB,GB,HB={start:"mousedown",move:"mousemove",end:"mouseup"},WB={};function qB(){}jB?GB={start:"pointerdown",move:"pointermove",end:"pointerup, pointercancel"}:VB?GB={start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}:UB?(GB={start:"touchstart",move:"touchmove",end:"touchend, touchcancel"},WB=HB):GB=HB,qB.prototype.on=function(e,t){var n,i=this,r=e.split(/[ ,]+/g);i._handlers_=i._handlers_||{};for(var s=0;s<r.length;s+=1)n=r[s],i._handlers_[n]=i._handlers_[n]||[],i._handlers_[n].push(t);return i},qB.prototype.off=function(e,t){var n=this;return n._handlers_=n._handlers_||{},void 0===e?n._handlers_={}:void 0===t?n._handlers_[e]=null:n._handlers_[e]&&n._handlers_[e].indexOf(t)>=0&&n._handlers_[e].splice(n._handlers_[e].indexOf(t),1),n},qB.prototype.trigger=function(e,t){var n,i=this,r=e.split(/[ ,]+/g);i._handlers_=i._handlers_||{};for(var s=0;s<r.length;s+=1)n=r[s],i._handlers_[n]&&i._handlers_[n].length&&i._handlers_[n].forEach((function(e){e.call(i,{type:n,target:i},t)}))},qB.prototype.config=function(e){var t=this;t.options=t.defaults||{},e&&(t.options=((e,t)=>{let n={};for(let i in e)e.hasOwnProperty(i)&&t.hasOwnProperty(i)?n[i]=t[i]:e.hasOwnProperty(i)&&(n[i]=e[i]);return n})(t.options,e))},qB.prototype.bindEvt=function(e,t){var n=this;return n._domHandlers_=n._domHandlers_||{},n._domHandlers_[t]=function(){"function"==typeof n["on"+t]?n["on"+t].apply(n,arguments):console.warn('[WARNING] : Missing "on'+t+'" handler.')},OB(e,GB[t],n._domHandlers_[t]),WB[t]&&OB(e,WB[t],n._domHandlers_[t]),n},qB.prototype.unbindEvt=function(e,t){var n=this;return n._domHandlers_=n._domHandlers_||{},IB(e,GB[t],n._domHandlers_[t]),WB[t]&&IB(e,WB[t],n._domHandlers_[t]),delete n._domHandlers_[t],this};var XB=qB;function YB(e,t){return this.identifier=t.identifier,this.position=t.position,this.frontPosition=t.frontPosition,this.collection=e,this.defaults={size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:1,mode:"dynamic",zone:document.body,lockX:!1,lockY:!1,shape:"circle"},this.config(t),"dynamic"===this.options.mode&&(this.options.restOpacity=0),this.id=YB.id,YB.id+=1,this.buildEl().stylize(),this.instance={el:this.ui.el,on:this.on.bind(this),off:this.off.bind(this),show:this.show.bind(this),hide:this.hide.bind(this),add:this.addToDom.bind(this),remove:this.removeFromDom.bind(this),destroy:this.destroy.bind(this),setPosition:this.setPosition.bind(this),resetDirection:this.resetDirection.bind(this),computeDirection:this.computeDirection.bind(this),trigger:this.trigger.bind(this),position:this.position,frontPosition:this.frontPosition,ui:this.ui,identifier:this.identifier,id:this.id,options:this.options},this.instance}YB.prototype=new XB,YB.constructor=YB,YB.id=0,YB.prototype.buildEl=function(e){return this.ui={},this.options.dataOnly||(this.ui.el=document.createElement("div"),this.ui.back=document.createElement("div"),this.ui.front=document.createElement("div"),this.ui.el.className="nipple collection_"+this.collection.id,this.ui.back.className="back",this.ui.front.className="front",this.ui.el.setAttribute("id","nipple_"+this.collection.id+"_"+this.id),this.ui.el.appendChild(this.ui.back),this.ui.el.appendChild(this.ui.front)),this},YB.prototype.stylize=function(){if(this.options.dataOnly)return this;var e=this.options.fadeTime+"ms",t=((e,t)=>{let n=zB(e);for(let i in n)n.hasOwnProperty(i)&&(n[i]=t);return n})("borderRadius","50%"),n=BB("transition","opacity",e),i={};return i.el={position:"absolute",opacity:this.options.restOpacity,display:"block",zIndex:999},i.back={position:"absolute",display:"block",width:this.options.size+"px",height:this.options.size+"px",marginLeft:-this.options.size/2+"px",marginTop:-this.options.size/2+"px",background:"rgba(255, 255, 255, .4)",border:"solid 2px rgba(0, 0, 0, .1)"},i.front={width:this.options.size/2+"px",height:this.options.size/2+"px",position:"absolute",display:"block",marginLeft:-this.options.size/4+"px",marginTop:-this.options.size/4+"px",background:"rgba(255, 255, 255, .8)",border:"solid 2px rgba(0, 0, 0, .1)"},NB(i.el,n),"circle"===this.options.shape&&NB(i.back,t),NB(i.front,t),this.applyStyles(i),this},YB.prototype.applyStyles=function(e){for(var t in this.ui)if(this.ui.hasOwnProperty(t))for(var n in e[t])this.ui[t].style[n]=e[t][n];return this},YB.prototype.addToDom=function(){return this.options.dataOnly||document.body.contains(this.ui.el)||this.options.zone.appendChild(this.ui.el),this},YB.prototype.removeFromDom=function(){return this.options.dataOnly||!document.body.contains(this.ui.el)||this.options.zone.removeChild(this.ui.el),this},YB.prototype.destroy=function(){clearTimeout(this.removeTimeout),clearTimeout(this.showTimeout),clearTimeout(this.restTimeout),this.trigger("destroyed",this.instance),this.removeFromDom(),this.off()},YB.prototype.show=function(e){var t=this;return t.options.dataOnly||(clearTimeout(t.removeTimeout),clearTimeout(t.showTimeout),clearTimeout(t.restTimeout),t.addToDom(),t.restCallback(),setTimeout((function(){t.ui.el.style.opacity=1}),0),t.showTimeout=setTimeout((function(){t.trigger("shown",t.instance),"function"==typeof e&&e.call(this)}),t.options.fadeTime)),t},YB.prototype.hide=function(e){var t=this;if(t.options.dataOnly)return t;if(t.ui.el.style.opacity=t.options.restOpacity,clearTimeout(t.removeTimeout),clearTimeout(t.showTimeout),clearTimeout(t.restTimeout),t.removeTimeout=setTimeout((function(){var n="dynamic"===t.options.mode?"none":"block";t.ui.el.style.display=n,"function"==typeof e&&e.call(t),t.trigger("hidden",t.instance)}),t.options.fadeTime),t.options.restJoystick){let n=t.options.restJoystick,i={};i.x=!0===n||!1!==n.x?0:t.instance.frontPosition.x,i.y=!0===n||!1!==n.y?0:t.instance.frontPosition.y,t.setPosition(e,i)}return t},YB.prototype.setPosition=function(e,t){var n=this;n.frontPosition={x:t.x,y:t.y};var i=n.options.fadeTime+"ms",r={};r.front=BB("transition",["top","left"],i);var s={front:{}};s.front={left:n.frontPosition.x+"px",top:n.frontPosition.y+"px"},n.applyStyles(r),n.applyStyles(s),n.restTimeout=setTimeout((function(){"function"==typeof e&&e.call(n),n.restCallback()}),n.options.fadeTime)},YB.prototype.restCallback=function(){var e=this,t={};t.front=BB("transition","none",""),e.applyStyles(t),e.trigger("rested",e.instance)},YB.prototype.resetDirection=function(){this.direction={x:!1,y:!1,angle:!1}},YB.prototype.computeDirection=function(e){var t,n,i,r=e.angle.radian,s=Math.PI/4,a=Math.PI/2;if(r>s&&r<3*s&&!e.lockX?t="up":r>-s&&r<=s&&!e.lockY?t="left":r>3*-s&&r<=-s&&!e.lockX?t="down":e.lockY||(t="right"),e.lockY||(n=r>-a&&r<a?"left":"right"),e.lockX||(i=r>0?"up":"down"),e.force>this.options.threshold){var o,l={};for(o in this.direction)this.direction.hasOwnProperty(o)&&(l[o]=this.direction[o]);var c={};for(o in this.direction={x:n,y:i,angle:t},e.direction=this.direction,l)l[o]===this.direction[o]&&(c[o]=!0);if(c.x&&c.y&&c.angle)return e;(!c.x||!c.y)&&this.trigger("plain",e),c.x||this.trigger("plain:"+n,e),c.y||this.trigger("plain:"+i,e),c.angle||this.trigger("dir dir:"+t,e)}else this.resetDirection();return e};var QB=YB;function KB(e,t){var n=this;n.nipples=[],n.idles=[],n.actives=[],n.ids=[],n.pressureIntervals={},n.manager=e,n.id=KB.id,KB.id+=1,n.defaults={zone:document.body,multitouch:!1,maxNumberOfNipples:10,mode:"dynamic",position:{top:0,left:0},catchDistance:200,size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:1,lockX:!1,lockY:!1,shape:"circle",dynamicPage:!1,follow:!1},n.config(t),("static"===n.options.mode||"semi"===n.options.mode)&&(n.options.multitouch=!1),n.options.multitouch||(n.options.maxNumberOfNipples=1);let i=getComputedStyle(n.options.zone.parentElement);return i&&"flex"===i.display&&(n.parentIsFlex=!0),n.updateBox(),n.prepareNipples(),n.bindings(),n.begin(),n.nipples}KB.prototype=new XB,KB.constructor=KB,KB.id=0,KB.prototype.prepareNipples=function(){var e=this,t=e.nipples;t.on=e.on.bind(e),t.off=e.off.bind(e),t.options=e.options,t.destroy=e.destroy.bind(e),t.ids=e.ids,t.id=e.id,t.processOnMove=e.processOnMove.bind(e),t.processOnEnd=e.processOnEnd.bind(e),t.get=function(e){if(void 0===e)return t[0];for(var n=0,i=t.length;n<i;n+=1)if(t[n].identifier===e)return t[n];return!1}},KB.prototype.bindings=function(){var e=this;e.bindEvt(e.options.zone,"start"),e.options.zone.style.touchAction="none",e.options.zone.style.msTouchAction="none"},KB.prototype.begin=function(){var e=this,t=e.options;if("static"===t.mode){var n=e.createNipple(t.position,e.manager.getIdentifier());n.add(),e.idles.push(n)}},KB.prototype.createNipple=function(e,t){var n=this,i=n.manager.scroll,r={},s=n.options,a=n.parentIsFlex?i.x:i.x+n.box.left,o=n.parentIsFlex?i.y:i.y+n.box.top;if(e.x&&e.y)r={x:e.x-a,y:e.y-o};else if(e.top||e.right||e.bottom||e.left){var l=document.createElement("DIV");l.style.display="hidden",l.style.top=e.top,l.style.right=e.right,l.style.bottom=e.bottom,l.style.left=e.left,l.style.position="absolute",s.zone.appendChild(l);var c=l.getBoundingClientRect();s.zone.removeChild(l),r=e,e={x:c.left+i.x,y:c.top+i.y}}var h=new QB(n,{color:s.color,size:s.size,threshold:s.threshold,fadeTime:s.fadeTime,dataOnly:s.dataOnly,restJoystick:s.restJoystick,restOpacity:s.restOpacity,mode:s.mode,identifier:t,position:e,zone:s.zone,frontPosition:{x:0,y:0},shape:s.shape});return s.dataOnly||(LB(h.ui.el,r),LB(h.ui.front,h.frontPosition)),n.nipples.push(h),n.trigger("added "+h.identifier+":added",h),n.manager.trigger("added "+h.identifier+":added",h),n.bindNipple(h),h},KB.prototype.updateBox=function(){this.box=this.options.zone.getBoundingClientRect()},KB.prototype.bindNipple=function(e){var t,n=this,i=function(e,i){t=e.type+" "+i.id+":"+e.type,n.trigger(t,i)};e.on("destroyed",n.onDestroyed.bind(n)),e.on("shown hidden rested dir plain",i),e.on("dir:up dir:right dir:down dir:left",i),e.on("plain:up plain:right plain:down plain:left",i)},KB.prototype.pressureFn=function(e,t,n){var i=this,r=0;clearInterval(i.pressureIntervals[n]),i.pressureIntervals[n]=setInterval(function(){var n=e.force||e.pressure||e.webkitForce||0;n!==r&&(t.trigger("pressure",n),i.trigger("pressure "+t.identifier+":pressure",n),r=n)}.bind(i),100)},KB.prototype.onstart=function(e){var t=this,n=t.options,i=e;e=RB(e),t.updateBox();return FB(e,(function(r){t.actives.length<n.maxNumberOfNipples?t.processOnStart(r):i.type.match(/^touch/)&&(Object.keys(t.manager.ids).forEach((function(n){if(Object.values(i.touches).findIndex((function(e){return e.identifier===n}))<0){var r=[e[0]];r.identifier=n,t.processOnEnd(r)}})),t.actives.length<n.maxNumberOfNipples&&t.processOnStart(r))})),t.manager.bindDocument(),!1},KB.prototype.processOnStart=function(e){var t,n=this,i=n.options,r=n.manager.getIdentifier(e),s=e.force||e.pressure||e.webkitForce||0,a={x:e.pageX,y:e.pageY},o=n.getOrCreate(r,a);o.identifier!==r&&n.manager.removeIdentifier(o.identifier),o.identifier=r;var l=function(t){t.trigger("start",t),n.trigger("start "+t.id+":start",t),t.show(),s>0&&n.pressureFn(e,t,t.identifier),n.processOnMove(e)};if((t=n.idles.indexOf(o))>=0&&n.idles.splice(t,1),n.actives.push(o),n.ids.push(o.identifier),"semi"!==i.mode)l(o);else{if(!(CB(a,o.position)<=i.catchDistance))return o.destroy(),void n.processOnStart(e);l(o)}return o},KB.prototype.getOrCreate=function(e,t){var n,i=this,r=i.options;return/(semi|static)/.test(r.mode)?(n=i.idles[0])?(i.idles.splice(0,1),n):"semi"===r.mode?i.createNipple(t,e):(console.warn("Coudln't find the needed nipple."),!1):n=i.createNipple(t,e)},KB.prototype.processOnMove=function(e){var t=this,n=t.options,i=t.manager.getIdentifier(e),r=t.nipples.get(i),s=t.manager.scroll;if((e=>isNaN(e.buttons)?0!==e.pressure:0!==e.buttons)(e)){if(!r)return console.error("Found zombie joystick with ID "+i),void t.manager.removeIdentifier(i);if(n.dynamicPage){var a=r.el.getBoundingClientRect();r.position={x:s.x+a.left,y:s.y+a.top}}r.identifier=i;var o=r.options.size/2,l={x:e.pageX,y:e.pageY};n.lockX&&(l.y=r.position.y),n.lockY&&(l.x=r.position.x);var c,h,u=CB(l,r.position),d=((e,t)=>{let n=t.x-e.x,i=t.y-e.y;return TB(Math.atan2(i,n))})(l,r.position),p=MB(d),f=u/o,m={distance:u,position:l};if("circle"===r.options.shape?(c=Math.min(u,o),h=((e,t,n)=>{let i={x:0,y:0};return n=MB(n),i.x=e.x-t*Math.cos(n),i.y=e.y-t*Math.sin(n),i})(r.position,c,d)):(h=((e,t,n)=>({x:Math.min(Math.max(e.x,t.x-n),t.x+n),y:Math.min(Math.max(e.y,t.y-n),t.y+n)}))(l,r.position,o),c=CB(h,r.position)),n.follow){if(u>o){let e=l.x-h.x,n=l.y-h.y;r.position.x+=e,r.position.y+=n,r.el.style.top=r.position.y-(t.box.top+s.y)+"px",r.el.style.left=r.position.x-(t.box.left+s.x)+"px",u=CB(l,r.position)}}else l=h,u=c;var g=l.x-r.position.x,v=l.y-r.position.y;r.frontPosition={x:g,y:v},n.dataOnly||LB(r.ui.front,r.frontPosition);var y={identifier:r.identifier,position:l,force:f,pressure:e.force||e.pressure||e.webkitForce||0,distance:u,angle:{radian:p,degree:d},vector:{x:g/o,y:-v/o},raw:m,instance:r,lockX:n.lockX,lockY:n.lockY};(y=r.computeDirection(y)).angle={radian:MB(180-d),degree:180-d},r.trigger("move",y),t.trigger("move "+r.id+":move",y)}else this.processOnEnd(e)},KB.prototype.processOnEnd=function(e){var t=this,n=t.options,i=t.manager.getIdentifier(e),r=t.nipples.get(i),s=t.manager.removeIdentifier(r.identifier);!r||(n.dataOnly||r.hide((function(){"dynamic"===n.mode&&(r.trigger("removed",r),t.trigger("removed "+r.id+":removed",r),t.manager.trigger("removed "+r.id+":removed",r),r.destroy())})),clearInterval(t.pressureIntervals[r.identifier]),r.resetDirection(),r.trigger("end",r),t.trigger("end "+r.id+":end",r),t.ids.indexOf(r.identifier)>=0&&t.ids.splice(t.ids.indexOf(r.identifier),1),t.actives.indexOf(r)>=0&&t.actives.splice(t.actives.indexOf(r),1),/(semi|static)/.test(n.mode)?t.idles.push(r):t.nipples.indexOf(r)>=0&&t.nipples.splice(t.nipples.indexOf(r),1),t.manager.unbindDocument(),/(semi|static)/.test(n.mode)&&(t.manager.ids[s.id]=s.identifier))},KB.prototype.onDestroyed=function(e,t){var n=this;n.nipples.indexOf(t)>=0&&n.nipples.splice(n.nipples.indexOf(t),1),n.actives.indexOf(t)>=0&&n.actives.splice(n.actives.indexOf(t),1),n.idles.indexOf(t)>=0&&n.idles.splice(n.idles.indexOf(t),1),n.ids.indexOf(t.identifier)>=0&&n.ids.splice(n.ids.indexOf(t.identifier),1),n.manager.removeIdentifier(t.identifier),n.manager.unbindDocument()},KB.prototype.destroy=function(){var e=this;for(var t in e.unbindEvt(e.options.zone,"start"),e.nipples.forEach((function(e){e.destroy()})),e.pressureIntervals)e.pressureIntervals.hasOwnProperty(t)&&clearInterval(e.pressureIntervals[t]);e.trigger("destroyed",e.nipples),e.manager.unbindDocument(),e.off()};var ZB=KB;function JB(e){var t=this;t.ids={},t.index=0,t.collections=[],t.scroll=kB(),t.config(e),t.prepareCollections();var n=function(){var e;t.collections.forEach((function(n){n.forEach((function(n){e=n.el.getBoundingClientRect(),n.position={x:t.scroll.x+e.left,y:t.scroll.y+e.top}}))}))};if(typeof window>"u")return t.collections;OB(window,"resize",(function(){DB(n)}));var i=function(){t.scroll=kB()};return OB(window,"scroll",(function(){DB(i)})),t.collections}JB.prototype=new XB,JB.constructor=JB,JB.prototype.prepareCollections=function(){var e=this;e.collections.create=e.create.bind(e),e.collections.on=e.on.bind(e),e.collections.off=e.off.bind(e),e.collections.destroy=e.destroy.bind(e),e.collections.get=function(t){var n;return e.collections.every((function(e){return!(n=e.get(t))})),n}},JB.prototype.create=function(e){return this.createCollection(e)},JB.prototype.createCollection=function(e){var t=this,n=new ZB(t,e);return t.bindCollection(n),t.collections.push(n),n},JB.prototype.bindCollection=function(e){var t,n=this,i=function(e,i){t=e.type+" "+i.id+":"+e.type,n.trigger(t,i)};e.on("destroyed",n.onDestroyed.bind(n)),e.on("shown hidden rested dir plain",i),e.on("dir:up dir:right dir:down dir:left",i),e.on("plain:up plain:right plain:down plain:left",i)},JB.prototype.bindDocument=function(){var e=this;e.binded||(e.bindEvt(document,"move").bindEvt(document,"end"),e.binded=!0)},JB.prototype.unbindDocument=function(e){var t=this;(!Object.keys(t.ids).length||!0===e)&&(t.unbindEvt(document,"move").unbindEvt(document,"end"),t.binded=!1)},JB.prototype.getIdentifier=function(e){var t;return e?void 0===(t=void 0===e.identifier?e.pointerId:e.identifier)&&(t=this.latest||0):t=this.index,void 0===this.ids[t]&&(this.ids[t]=this.index,this.index+=1),this.latest=t,this.ids[t]},JB.prototype.removeIdentifier=function(e){var t={};for(var n in this.ids)if(this.ids[n]===e){t.id=n,t.identifier=this.ids[n],delete this.ids[n];break}return t},JB.prototype.onmove=function(e){return this.onAny("move",e),!1},JB.prototype.onend=function(e){return this.onAny("end",e),!1},JB.prototype.oncancel=function(e){return this.onAny("end",e),!1},JB.prototype.onAny=function(e,t){var n,i=this,r="processOn"+e.charAt(0).toUpperCase()+e.slice(1);t=RB(t);var s=function(e,t,n){n.ids.indexOf(t)>=0&&(n[r](e),e._found_=!0)};return FB(t,(function(e){n=i.getIdentifier(e),FB(i.collections,s.bind(null,e,n)),e._found_||i.removeIdentifier(n)})),!1},JB.prototype.destroy=function(){var e=this;e.unbindDocument(!0),e.ids={},e.index=0,e.collections.forEach((function(e){e.destroy()})),e.off()},JB.prototype.onDestroyed=function(e,t){var n=this;if(n.collections.indexOf(t)<0)return!1;n.collections.splice(n.collections.indexOf(t),1)};var $B=new JB,ez=function(e){return $B.create(e)},tz=new Map,nz=new Map,iz=class{constructor(e,t,n,i){this.data=t;let{audio:r,volume:s,delay:a,loop:o}=t;if(!r)throw new Error("Missing property");let l="string"==typeof r?i.getAudio(r).src:r.data;this.audioPlayer=new BP({src:l,volume:s,delay:a,loop:o}),nz.has(n.uuid)?nz.get(n.uuid).push(this):nz.set(n.uuid,[this]),tz.set(e,this)}playByToggle(){"stop"===this.data.toggle?"playing"===this.audioPlayer.status?this.audioPlayer.stop():(this.audioPlayer.stop(),this.audioPlayer.play()):"pause"===this.data.toggle?"playing"===this.audioPlayer.status?this.audioPlayer.pause():this.audioPlayer.play():(this.audioPlayer.stop(),this.audioPlayer.play())}dispose(){this.audioPlayer.stop()}},rz=class{constructor(e){this.data=e}dispatch(){this.data.playAudio?this.pauseAudio(this.data.playAudio):this.data.object?this.pauseAllAudiosFromObject(this.data.object):this.pauseAllAudios()}pauseAudio(e){let t=tz.get(e);!t||(this.data.delay>0?(this.disposeDelay(),this.timeoutId=window.setTimeout((()=>{t.audioPlayer[this.data.interaction](),this.disposeDelay()}),this.data.delay)):t.audioPlayer[this.data.interaction]())}pauseAllAudiosFromObject(e){let t=nz.get(e);null===t||void 0===t||!t.length||(this.data.delay>0?(this.disposeDelay(),this.timeoutId=window.setTimeout((()=>{t.forEach((e=>e.audioPlayer[this.data.interaction]())),this.disposeDelay()}),this.data.delay)):t.forEach((e=>e.audioPlayer[this.data.interaction]())))}pauseAllAudios(){let e=[...nz.values()];!e.length||(this.data.delay>0?(this.disposeDelay(),this.timeoutId=window.setTimeout((()=>{e.forEach((e=>{e.forEach((e=>{e.audioPlayer[this.data.interaction]()}))})),this.disposeDelay()}),this.data.delay)):e.forEach((e=>{e.forEach((e=>{e.audioPlayer[this.data.interaction]()}))})))}disposeDelay(){clearTimeout(this.timeoutId),delete this.timeoutId}dispose(){clearTimeout(this.timeoutId),delete this.timeoutId}},sz=class{constructor(e,t,n,i,r){if(this.data=t,this.shared=i,this.condition=r,"play"===t.interaction)this.interaction=new iz(e,t,n,i);else{if("pause"!==t.interaction&&"stop"!==t.interaction)throw new Error("Missing property");this.interaction=new rz(t)}}dispatchBasic(){if(!1===uF(this.shared,this.condition))return!1;this.interaction instanceof iz?this.interaction.playByToggle():this.interaction.dispatch()}dispatchConditional(){if(!1===uF(this.shared,this.condition))return!1;this.interaction instanceof iz?this.interaction.audioPlayer.play():this.interaction.dispatch()}dispatchGameControl(e){if(!1===uF(this.shared,this.condition))return!1;this.interaction instanceof iz&&("start"===e?this.interaction.audioPlayer.play():this.interaction.audioPlayer.stop())}dispose(){this.interaction.dispose()}},az=class{constructor(e,t,n,i){this.data=e,this.page=t,this.shared=n,this.condition=i,this.delay=0,this.emission=e.emission,void 0!==e.delay&&(this.delay=e.delay),this.particleSystem=this.page.scene.find(this.data.emitterObjectId)}toggleEmitting(){this.particleSystem.started&&!this.particleSystem.stopped?this.stop(this.delay):this.start(this.delay)}toggleFroze(){this.particleSystem.started&&!this.particleSystem.isFrozen?this.freeze(this.delay):this.unFreeze(this.delay)}start(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;e?this.delayTimerId=window.setTimeout((()=>{this.start(0),this.clearDelay()}),e):this.particleSystem.start()}stop(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;e?this.delayTimerId=window.setTimeout((()=>{this.stop(0),this.clearDelay()}),e):this.particleSystem.stop()}freeze(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;e?this.delayTimerId=window.setTimeout((()=>{this.freeze(0),this.clearDelay()}),e):this.particleSystem.froze()}unFreeze(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;e?this.delayTimerId=window.setTimeout((()=>{this.unFreeze(0),this.clearDelay()}),e):this.particleSystem.unFroze()}reset(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;e?this.delayTimerId=window.setTimeout((()=>{this.reset(0),this.clearDelay()}),e):this.particleSystem.reset()}reverseFromCurrent(){switch(this.emission){case"emitToggle":this.toggleEmitting();break;case"pauseToggle":this.toggleFroze()}}dispatchBasic(){if(!1===uF(this.shared,this.condition)||!this.particleSystem)return!1;switch(this.emission){case"start":this.start(this.delay);break;case"emitToggle":this.toggleEmitting();break;case"pause":this.freeze(this.delay);break;case"pauseToggle":this.toggleFroze();break;case"stop":this.stop(this.delay);break;case"reset":this.reset(this.delay)}}dispatchConditional(){if(!1===uF(this.shared,this.condition)||!this.particleSystem)return!1;switch(this.emission){case"start":this.start(this.delay);break;case"stop":this.stop(this.delay);break;case"reset":this.reset(this.delay)}}dispatchGameControl(e){if(!1===uF(this.shared,this.condition)||!this.particleSystem)return!1;"start"===e?this.start(this.delay):this.stop(this.delay)}dispose(){!this.particleSystem||(this.particleSystem.reset(),this.clearDelay())}clearDelay(){this.delayTimerId&&(clearTimeout(this.delayTimerId),delete this.delayTimerId)}},oz=(e,t)=>t.some((t=>t instanceof RegExp?t.test(e):t===e));function lz(e,t){if(t=o({defaultProtocol:"http:",normalizeProtocol:!0,forceHttp:!1,forceHttps:!1,stripAuthentication:!0,stripHash:!1,stripTextFragment:!0,stripWWW:!0,removeQueryParameters:[/^utm_\w+/i],removeTrailingSlash:!0,removeSingleSlash:!0,removeDirectoryIndex:!1,sortQueryParameters:!0},t),e=e.trim(),/^data:/i.test(e))return((e,t)=>{let{stripHash:n}=t,i=u(/^data:([^,]*?),([^#]*?)(?:#(.*))?$/,{type:1,data:2,hash:3}).exec(e);if(!i)throw new Error("Invalid URL: ".concat(e));let{type:r,data:s,hash:a}=i.groups,o=r.split(";");a=n?"":a;let l=!1;"base64"===o[o.length-1]&&(o.pop(),l=!0);let c=(o.shift()||"").toLowerCase(),h=[...o.map((e=>{let[t,n=""]=e.split("=").map((e=>e.trim()));return"charset"===t&&(n=n.toLowerCase(),"us-ascii"===n)?"":"".concat(t).concat(n?"=".concat(n):"")})).filter(Boolean)];return l&&h.push("base64"),(h.length>0||c&&"text/plain"!==c)&&h.unshift(c),"data:".concat(h.join(";"),",").concat(l?s.trim():s).concat(a?"#".concat(a):"")})(e,t);if(/^view-source:/i.test(e))throw new Error("`view-source:` is not supported as it is a non-standard protocol");let n=e.startsWith("//");!n&&/^\.*\//.test(e)||(e=e.replace(/^(?!(?:\w+:)?\/\/)|^\/\//,t.defaultProtocol));let i=new URL(e);if(t.forceHttp&&t.forceHttps)throw new Error("The `forceHttp` and `forceHttps` options cannot be used together");if(t.forceHttp&&"https:"===i.protocol&&(i.protocol="http:"),t.forceHttps&&"http:"===i.protocol&&(i.protocol="https:"),t.stripAuthentication&&(i.username="",i.password=""),t.stripHash?i.hash="":t.stripTextFragment&&(i.hash=i.hash.replace(/#?:~:text.*?$/i,"")),i.pathname){let e=/\b[a-z][a-z\d+\-.]{1,50}:\/\//g,t=0,n="";for(;;){let r=e.exec(i.pathname);if(!r)break;let s=r[0],a=r.index;n+=i.pathname.slice(t,a).replace(/\/{2,}/g,"/"),n+=s,t=a+s.length}n+=i.pathname.slice(t,i.pathname.length).replace(/\/{2,}/g,"/"),i.pathname=n}if(i.pathname)try{i.pathname=decodeURI(i.pathname)}catch(s){}if(!0===t.removeDirectoryIndex&&(t.removeDirectoryIndex=[/^index\.[a-z]+$/]),Array.isArray(t.removeDirectoryIndex)&&t.removeDirectoryIndex.length>0){let e=i.pathname.split("/"),n=e[e.length-1];oz(n,t.removeDirectoryIndex)&&(e=e.slice(0,-1),i.pathname=e.slice(1).join("/")+"/")}if(i.hostname&&(i.hostname=i.hostname.replace(/\.$/,""),t.stripWWW&&/^www\.(?!www\.)[a-z\-\d]{1,63}\.[a-z.\-\d]{2,63}$/.test(i.hostname)&&(i.hostname=i.hostname.replace(/^www\./,""))),Array.isArray(t.removeQueryParameters))for(let o of[...i.searchParams.keys()])oz(o,t.removeQueryParameters)&&i.searchParams.delete(o);if(!0===t.removeQueryParameters&&(i.search=""),t.sortQueryParameters){i.searchParams.sort();try{i.search=decodeURIComponent(i.search)}catch(a){}}t.removeTrailingSlash&&(i.pathname=i.pathname.replace(/\/$/,""));let r=e;return e=i.toString(),!t.removeSingleSlash&&"/"===i.pathname&&!r.endsWith("/")&&""===i.hash&&(e=e.replace(/\/$/,"")),(t.removeTrailingSlash||"/"===i.pathname)&&""===i.hash&&t.removeSingleSlash&&(e=e.replace(/\/$/,"")),n&&!t.normalizeProtocol&&(e=e.replace(/^http:\/\//,"//")),t.stripProtocol&&(e=e.replace(/^(?:https?:)?\/\//,"")),e}var cz=class{constructor(e,t,n,i){let{url:r,context:s}=e;if(this.controlsManager=t,this.shared=n,this.condition=i,!r)throw new Error("Missing property");this.url=r.startsWith("mailto:")?r:lz(r,{removeTrailingSlash:!1,removeSingleSlash:!1,stripWWW:!1}),this.context=null!==s&&void 0!==s?s:"tab"}dispatch(){var e;if(!1===uF(this.shared,this.condition))return!1;Om?window.location.assign(this.url):("tab"===this.context||Pm&&"none"===this.context?window.open(this.url,"_blank"):"window"===this.context?window.open(this.url,"_blank","width=".concat(window.innerWidth,", height=").concat(window.innerHeight)):window.open(this.url,"_parent"),null!==(e=this.controlsManager.orbitControls)&&void 0!==e&&e.onPointerUp(Fm[0]),Fm.splice(0,Fm.length))}},hz=class{constructor(e,t,n,i,r){this.data=e,this.page=t,this.controlsManager=n,this.shared=i,this.condition=r,this.timeoutIdQueue=[],this.dispatchInner=()=>{this.objects.forEach(this.destroyCallback)},this.destroyCallback=e=>{var t;this.timeoutIdQueue.shift();let n=this.page.scene.find(e);if(void 0===n)return;let i=this.controlsManager.sharedGameControlGlobals.rapierWorld,r=!i||(null===(t=n.dataPatched.physics)||void 0===t?void 0:t.fusedBody);if(n.cloner){for(let e of n.cloner.children){var s;r?(e.playModeVisible=!1,e.rigidBody&&"positioned"===(null===(s=n.dataPatched.physics)||void 0===s?void 0:s.rigidBody)&&(this.controlsManager.sharedGameControlGlobals.colliderToEntity.delete(e.rigidBody.collider(0).handle),i.removeRigidBody(e.rigidBody),e.rigidBody=void 0),e.bvhGeometry&&(e.bvhGeometry=void 0)):void 0===this.clone||this.clone===e?(e.playModeVisible=!1,e.rigidBody&&(this.controlsManager.sharedGameControlGlobals.colliderToEntity.delete(e.rigidBody.collider(0).handle),i.removeRigidBody(e.rigidBody),e.rigidBody=void 0)):void 0===e.playModeVisible&&(e.playModeVisible=!0)}(r||void 0===this.clone||!1===this.clone)&&(n.visible=!1,n.rigidBody&&(this.controlsManager.sharedGameControlGlobals.colliderToEntity.delete(n.rigidBody.collider(0).handle),i.removeRigidBody(n.rigidBody),n.rigidBody=void 0),n.bvhGeometry&&(n.bvhGeometry=void 0))}else n.rigidBody&&(this.controlsManager.sharedGameControlGlobals.colliderToEntity.delete(n.rigidBody.collider(0).handle),i.removeRigidBody(n.rigidBody),n.rigidBody=void 0),n.bvhGeometry&&(n.bvhGeometry=void 0),n.visible=!1;this.controlsManager.sharedGameControlGlobals.entitiesWithTransformAnim=void 0===i?this.controlsManager.sharedGameControlGlobals.entitiesWithTransformAnim.filter((e=>void 0!==e.bvhGeometry)):this.controlsManager.sharedGameControlGlobals.entitiesWithTransformAnim.filter((e=>void 0!==e.rigidBody)),n.destroyedInAction=!0,this.controlsManager.requestRender()},this.objects=[...e.objects]}dispatch(e){if(!1===uF(this.shared,this.condition))return!1;this.clone=e,this.data.delay?this.timeoutIdQueue.push(window.setTimeout(this.dispatchInner,1e3*this.data.delay)):this.dispatchInner()}dispatchFromStart(){if(!1===uF(this.shared,this.condition))return!1;this.timeoutIdQueue.push(window.setTimeout(this.dispatchInner,1e3*this.data.delay))}dispose(){this.timeoutIdQueue.forEach((e=>window.clearTimeout(e)))}},uz=class{constructor(e,t,n,i,r){this.data=e,this.page=t,this.shared=n,this.eventManager=i,this.condition=r,this.shared=n}dispatch(){var e;if(!1===uF(this.shared,this.condition))return!1;clearTimeout(this.timeoutId),delete this.timeoutId,this.timeoutId=window.setTimeout((()=>{var e;this.shared.reset(this.shared.data,!0),HN(this.page,this.shared,!0),this.eventManager.reset(),null!==(e=this.eventManager.controlsManager.gameControl)&&void 0!==e&&e.reset(!0),this.page.switchToPlayCamera(),this.eventManager.controlsManager.requestRender(),delete this.timeoutId}),1e3*(null!==(e=this.data.delay)&&void 0!==e?e:0))}dispose(){clearTimeout(this.timeoutId),delete this.timeoutId}},dz={update:null,begin:null,loopBegin:null,changeBegin:null,change:null,changeComplete:null,timelineChangeComplete:null,loopComplete:null,complete:null,loop:1,direction:"normal",autoplay:!0,timelineOffset:0,rewind:!0},pz={duration:1e3,delay:0,endDelay:0,startOnceDelay:0,pingPongDelayCorrection:0,pingPongEndDelayCorrection:0,easing:"easeOutElastic(1, .5)",round:0},fz=["translateX","translateY","translateZ","rotate","rotateX","rotateY","rotateZ","scale","scaleX","scaleY","scaleZ","skew","skewX","skewY","perspective","matrix","matrix3d"],mz={CSS:{},springs:{}};function gz(e,t,n){return Math.min(Math.max(e,t),n)}function vz(e,t){return e.indexOf(t)>-1}function yz(e,t){return e.apply(null,t)}var bz={arr:function(e){return Array.isArray(e)},obj:function(e){return vz(Object.prototype.toString.call(e),"Object")},pth:function(e){return bz.obj(e)&&e.hasOwnProperty("totalLength")},svg:function(e){return e instanceof SVGElement},inp:function(e){return e instanceof HTMLInputElement},dom:function(e){return!("isNode"in e)&&(e.nodeType||bz.svg(e))},str:function(e){return"string"==typeof e},fnc:function(e){return"function"==typeof e},und:function(e){return typeof e>"u"},hex:function(e){return/(^#[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i.test(e)},rgb:function(e){return/^rgb/.test(e)},hsl:function(e){return/^hsl/.test(e)},col:function(e){return bz.hex(e)||bz.rgb(e)||bz.hsl(e)},key:function(e){return!dz.hasOwnProperty(e)&&!pz.hasOwnProperty(e)&&"targets"!==e&&"keyframes"!==e}};function xz(e){var t=/\(([^)]+)\)/.exec(e);return t?t[1].split(",").map((function(e){return parseFloat(e)})):[]}function wz(e,t){var n=xz(e),i=gz(bz.und(n[0])?1:n[0],.1,100),r=gz(bz.und(n[1])?100:n[1],.1,100),s=gz(bz.und(n[2])?10:n[2],.1,100),a=gz(bz.und(n[3])?0:n[3],.1,100),o=Math.sqrt(r/i),l=s/(2*Math.sqrt(r*i)),c=l<1?o*Math.sqrt(1-l*l):0,h=l<1?(l*o-a)/c:-a+o;function u(e){var n=t?t*e/1e3:e;return n=l<1?Math.exp(-n*l*o)*(1*Math.cos(c*n)+h*Math.sin(c*n)):(1+h*n)*Math.exp(-n*o),0===e||1===e?e:1-n}return t?u:function(){var t=mz.springs[e];if(t)return t;for(var n=1/6,i=0,r=0;;)if(1===u(i+=n)){if(++r>=16)break}else r=0;var s=i*n*1e3;return mz.springs[e]=s,s}}function Sz(e){return void 0===e&&(e=10),function(t){return Math.ceil(gz(t,1e-6,1)*e)*(1/e)}}var _z=function(){var e=.1;function t(e,t){return 1-3*t+3*e}function n(e,t){return 3*t-6*e}function i(e){return 3*e}function r(e,r,s){return((t(r,s)*e+n(r,s))*e+i(r))*e}function s(e,r,s){return 3*t(r,s)*e*e+2*n(r,s)*e+i(r)}return function(t,n,i,a){if(0<=t&&t<=1&&0<=i&&i<=1){var o=new Float32Array(11);if(t!==n||i!==a)for(var l=0;l<11;++l)o[l]=r(l*e,t,i);return function(e){return t===n&&i===a||0===e||1===e?e:r(c(e),n,a)}}function c(n){for(var a=0,l=1;10!==l&&o[l]<=n;++l)a+=e;--l;var c=a+(n-o[l])/(o[l+1]-o[l])*e,h=s(c,t,i);return h>=.001?function(e,t,n,i){for(var a=0;a<4;++a){var o=s(t,n,i);if(0===o)return t;t-=(r(t,n,i)-e)/o}return t}(n,c,t,i):0===h?c:function(e,t,n,i,s){var a,o,l=0;do{(a=r(o=t+(n-t)/2,i,s)-e)>0?n=o:t=o}while(Math.abs(a)>1e-7&&++l<10);return o}(n,a,a+e,t,i)}}}(),Ez=function(){var e={linear:function(){return function(e){return e}}},t={Sine:function(){return function(e){return 1-Math.cos(e*Math.PI/2)}},Circ:function(){return function(e){return 1-Math.sqrt(1-e*e)}},Back:function(){return function(e){return e*e*(3*e-2)}},Bounce:function(){return function(e){for(var t,n=4;e<((t=Math.pow(2,--n))-1)/11;);return 1/Math.pow(4,3-n)-7.5625*Math.pow((3*t-2)/22-e,2)}},Elastic:function(e,t){void 0===e&&(e=1),void 0===t&&(t=.5);var n=gz(e,1,10),i=gz(t,.1,2);return function(e){return 0===e||1===e?e:-n*Math.pow(2,10*(e-1))*Math.sin((e-1-i/(2*Math.PI)*Math.asin(1/n))*(2*Math.PI)/i)}}};return["Quad","Cubic","Quart","Quint","Expo"].forEach((function(e,n){t[e]=function(){return function(e){return Math.pow(e,n+2)}}})),Object.keys(t).forEach((function(n){var i=t[n];e["easeIn"+n]=i,e["easeOut"+n]=function(e,t){return function(n){return 1-i(e,t)(1-n)}},e["easeInOut"+n]=function(e,t){return function(n){return n<.5?i(e,t)(2*n)/2:1-i(e,t)(-2*n+2)/2}}})),e}();function Az(e,t){if(bz.fnc(e))return e;var n=e.split("(")[0],i=Ez[n],r=xz(e);switch(n){case"spring":return wz(e,t);case"cubicBezier":return yz(_z,r);case"steps":return yz(Sz,r);default:return yz(i,r)}}function Cz(e){try{return document.querySelectorAll(e)}catch(t){return}}function Mz(e,t){for(var n=e.length,i=arguments.length>=2?arguments[1]:void 0,r=[],s=0;s<n;s++)if(s in e){var a=e[s];t.call(i,a,s,e)&&r.push(a)}return r}function Tz(e){return e.reduce((function(e,t){return e.concat(bz.arr(t)?Tz(t):t)}),[])}function Pz(e){return bz.arr(e)?e:(bz.str(e)&&(e=Cz(e)||e),e instanceof NodeList||e instanceof HTMLCollection?[].slice.call(e):[e])}function Dz(e,t){return e.some((function(e){return e===t}))}function Oz(e){var t={};for(var n in e)t[n]=e[n];return t}function Iz(e,t){var n=Oz(e);for(var i in e)n[i]=t.hasOwnProperty(i)?t[i]:e[i];return n}function Rz(e,t){var n=Oz(e);for(var i in t)n[i]=bz.und(e[i])?t[i]:e[i];return n}function kz(e){return bz.rgb(e)?function(e){var t=/rgb\((\d+,\s*[\d]+,\s*[\d]+)\)/g.exec(e);return t?"rgba("+t[1]+",1)":e}(e):bz.hex(e)?function(e){var t=e.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,(function(e,t,n,i){return t+t+n+n+i+i})),n=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return"rgba("+parseInt(n[1],16)+","+parseInt(n[2],16)+","+parseInt(n[3],16)+",1)"}(e):bz.hsl(e)?function(e){var t,n,i,r=/hsl\((\d+),\s*([\d.]+)%,\s*([\d.]+)%\)/g.exec(e)||/hsla\((\d+),\s*([\d.]+)%,\s*([\d.]+)%,\s*([\d.]+)\)/g.exec(e),s=parseInt(r[1],10)/360,a=parseInt(r[2],10)/100,o=parseInt(r[3],10)/100,l=r[4]||1;function c(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+6*(t-e)*n:n<.5?t:n<2/3?e+(t-e)*(2/3-n)*6:e}if(0==a)t=n=i=o;else{var h=o<.5?o*(1+a):o+a-o*a,u=2*o-h;t=c(u,h,s+1/3),n=c(u,h,s),i=c(u,h,s-1/3)}return"rgba("+255*t+","+255*n+","+255*i+","+l+")"}(e):void 0}function Lz(e){var t=/[+-]?\d*\.?\d+(?:\.\d+)?(?:[eE][+-]?\d+)?(%|px|pt|em|rem|in|cm|mm|ex|ch|pc|vw|vh|vmin|vmax|deg|rad|turn)?$/.exec(e);if(t)return t[1]}function Bz(e,t){return bz.fnc(e)?e(t.target,t.id,t.total):e}function zz(e,t){return e.getAttribute(t)}function Nz(e,t,n){if(Dz([n,"deg","rad","turn"],Lz(t)))return t;var i=mz.CSS[t+n];if(!bz.und(i))return i;var r=document.createElement(e.tagName),s=e.parentNode&&e.parentNode!==document?e.parentNode:document.body;s.appendChild(r),r.style.position="absolute",r.style.width=100+n;var a=100/r.offsetWidth;s.removeChild(r);var o=a*parseFloat(t);return mz.CSS[t+n]=o,o}function Fz(e,t,n){if(t in e.style){var i=t.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase(),r=e.style[t]||getComputedStyle(e).getPropertyValue(i)||"0";return n?Nz(e,r,n):r}}function Uz(e,t){return bz.dom(e)&&!bz.inp(e)&&(zz(e,t)||bz.svg(e)&&e[t])?"attribute":bz.dom(e)&&Dz(fz,t)?"transform":bz.dom(e)&&"transform"!==t&&Fz(e,t)?"css":null!=e[t]?"object":void 0}function jz(e){if(bz.dom(e)){for(var t,n=e.style.transform||"",i=/(\w+)\(([^)]*)\)/g,r=new Map;t=i.exec(n);)r.set(t[1],t[2]);return r}}function Vz(e,t,n,i){var r=vz(t,"scale")?1:0+function(e){return vz(e,"translate")||"perspective"===e?"px":vz(e,"rotate")||vz(e,"skew")?"deg":void 0}(t),s=jz(e).get(t)||r;return n&&(n.transforms.list.set(t,s),n.transforms.last=t),i?Nz(e,s,i):s}function Gz(e,t,n,i){switch(Uz(e,t)){case"transform":return Vz(e,t,i,n);case"css":return Fz(e,t,n);case"attribute":return zz(e,t);default:return e[t]||0}}function Hz(e,t){var n=/^(\*=|\+=|-=)/.exec(e);if(!n)return e;var i=Lz(e)||0,r=parseFloat(t),s=parseFloat(e.replace(n[0],""));switch(n[0][0]){case"+":return r+s+i;case"-":return r-s+i;case"*":return r*s+i}}function Wz(e,t){if(bz.col(e))return kz(e);if(/\s/g.test(e))return e;var n=Lz(e),i=n?e.substr(0,e.length-n.length):e;return t?i+t:i}function qz(e,t){return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))}function Xz(e){for(var t,n=e.points,i=0,r=0;r<n.numberOfItems;r++){var s=n.getItem(r);r>0&&(i+=qz(t,s)),t=s}return i}function Yz(e){if(e.getTotalLength)return e.getTotalLength();switch(e.tagName.toLowerCase()){case"circle":return function(e){return 2*Math.PI*zz(e,"r")}(e);case"rect":return function(e){return 2*zz(e,"width")+2*zz(e,"height")}(e);case"line":return function(e){return qz({x:zz(e,"x1"),y:zz(e,"y1")},{x:zz(e,"x2"),y:zz(e,"y2")})}(e);case"polyline":return Xz(e);case"polygon":return function(e){var t=e.points;return Xz(e)+qz(t.getItem(t.numberOfItems-1),t.getItem(0))}(e)}}function Qz(e,t){var n=t||{},i=n.el||function(e){for(var t=e.parentNode;bz.svg(t)&&bz.svg(t.parentNode);)t=t.parentNode;return t}(e),r=i.getBoundingClientRect(),s=zz(i,"viewBox"),a=r.width,o=r.height,l=n.viewBox||(s?s.split(" "):[0,0,a,o]);return{el:i,viewBox:l,x:l[0]/1,y:l[1]/1,w:a/l[2],h:o/l[3]}}function Kz(e,t){function n(n){void 0===n&&(n=0);var i=t+n>=1?t+n:0;return e.el.getPointAtLength(i)}var i=Qz(e.el,e.svg),r=n(),s=n(-1),a=n(1);switch(e.property){case"x":return(r.x-i.x)*i.w;case"y":return(r.y-i.y)*i.h;case"angle":return 180*Math.atan2(a.y-s.y,a.x-s.x)/Math.PI}}function Zz(e,t){var n=/[+-]?\d*\.?\d+(?:\.\d+)?(?:[eE][+-]?\d+)?/g,i=Wz(bz.pth(e)?e.totalLength:e,t)+"";return{original:i,numbers:i.match(n)?i.match(n).map(Number):[0],strings:bz.str(e)||t?i.split(n):[]}}function Jz(e){return Mz(e?Tz(bz.arr(e)?e.map(Pz):Pz(e)):[],(function(e,t,n){return n.indexOf(e)===t}))}function $z(e){var t=Jz(e);return t.map((function(e,n){return{target:e,id:n,total:t.length,transforms:{list:jz(e)}}}))}function eN(e,t){var n=Oz(t);if(/^spring/.test(n.easing)&&(n.duration=wz(n.easing)),bz.arr(e)){var i=e.length;2===i&&!bz.obj(e[0])?e={value:e}:bz.fnc(t.duration)||(n.duration=t.duration/i)}var r=bz.arr(e)?e:[e];return r.map((function(e,n){var i=bz.obj(e)&&!bz.pth(e)?e:{value:e};return bz.und(i.delay)&&(i.delay=n?0:t.delay),bz.und(i.endDelay)&&(i.endDelay=n===r.length-1?t.endDelay:0),i})).map((function(e){return Rz(e,n)}))}function tN(e,t){var n=[],i=t.keyframes;for(var r in i&&(t=Rz(function(e){for(var t=Mz(Tz(e.map((function(e){return Object.keys(e)}))),(function(e){return bz.key(e)})).reduce((function(e,t){return e.indexOf(t)<0&&e.push(t),e}),[]),n={},i=function(i){var r=t[i];n[r]=e.map((function(e){var t={};for(var n in e)bz.key(n)?n==r&&(t.value=e[n]):t[n]=e[n];return t}))},r=0;r<t.length;r++)i(r);return n}(i),t)),t)bz.key(r)&&n.push({name:r,tweens:eN(t[r],e)});return n}function nN(e,t){var n;return e.tweens.map((function(i){var r=function(e,t){var n={};for(var i in e){var r=Bz(e[i],t);bz.arr(r)&&(r=r.map((function(e){return Bz(e,t)})),1===r.length&&(r=r[0])),n[i]=r}return n.duration=parseFloat(n.duration),n.delay=parseFloat(n.delay),n}(i,t),s=r.value,a=bz.arr(s)?s[1]:s,o=Lz(a),l=Gz(t.target,e.name,o,t),c=n?n.to.original:l,h=bz.arr(s)?s[0]:c,u=Lz(h)||Lz(l),d=o||u;return bz.und(a)&&(a=c),r.from=Zz(h,d),r.to=Zz(Hz(a,h),d),r.start=n?n.end:0,r.end=r.start+r.delay+r.duration+r.endDelay,r.easing=Az(r.easing,r.duration),r.isPath=bz.pth(s),r.isColor=bz.col(r.from.original),r.isColor&&(r.round=1),n=r,r}))}var iN={css:function(e,t,n){return e.style[t]=n},attribute:function(e,t,n){return e.setAttribute(t,n)},object:function(e,t,n){return e[t]=n},transform:function(e,t,n,i,r){if(i.list.set(t,n),t===i.last||r){var s="";i.list.forEach((function(e,t){s+=t+"("+e+") "})),e.style.transform=s}}};function rN(e,t){$z(e).forEach((function(e){for(var n in t){var i=Bz(t[n],e),r=e.target,s=Lz(i),a=Gz(r,n,s,e),o=Hz(Wz(i,s||Lz(a)),a),l=Uz(r,n);iN[l](r,n,o,e.transforms,!0)}}))}function sN(e,t){return Mz(Tz(e.map((function(e){return t.map((function(t){return function(e,t){var n=Uz(e.target,t.name);if(n){var i=nN(t,e),r=i[i.length-1];return{type:n,property:t.name,animatable:e,tweens:i,duration:r.end,delay:i[0].delay,endDelay:r.endDelay}}}(e,t)}))}))),(function(e){return!bz.und(e)}))}function aN(e,t){var n=e.length,i=function(e){return e.timelineOffset?e.timelineOffset:0},r={};return r.duration=n?Math.max.apply(Math,e.map((function(e){var t,n,r,s;let a=null!==(t=e.startOnceDelay)&&void 0!==t?t:0,o=null!==(n=e.pingPongDelayCorrection)&&void 0!==n?n:0,l=null!==(r=e.pingPongEndDelayCorrection)&&void 0!==r?r:0;return i(e)+a+o+l+e.duration*(null!==(s=e.loop)&&void 0!==s?s:1)}))):t.duration,r.delay=n?Math.min.apply(Math,e.map((function(e){var t,n;let r=null!==(t=e.startOnceDelay)&&void 0!==t?t:0,s=null!==(n=e.pingPongDelayCorrection)&&void 0!==n?n:0;return i(e)+r+s+e.delay}))):t.delay,r.endDelay=n?r.duration-Math.max.apply(Math,e.map((function(e){var t,n,r,s;let a=null!==(t=e.startOnceDelay)&&void 0!==t?t:0,o=null!==(n=e.pingPongDelayCorrection)&&void 0!==n?n:0,l=null!==(r=e.pingPongEndDelayCorrection)&&void 0!==r?r:0;return i(e)+a+o+e.duration*(null!==(s=e.loop)&&void 0!==s?s:1)-e.endDelay-l}))):t.endDelay,r}var oN=0;var lN,cN=[],hN=[],uN=function(){function e(){lN=requestAnimationFrame(t)}function t(t){var n=cN.length;if(n){for(var i=0;i<n;){var r=cN[i];r.paused?(cN.splice(i,1),n-=1):(r.tick(t),i++)}e()}else lN=cancelAnimationFrame(lN)}return e}();function dN(e){void 0===e&&(e={});var t,n,i=0,r=0,s=0,a=0,o=null;function l(e){var t=window.Promise&&new Promise((function(e){return o=e}));return e.finished=t,t}var c=function(e){var t=Iz(dz,e),n=Iz(pz,e),i=tN(n,e),r=$z(e.targets),s=sN(r,i),a=aN(s,n),o=oN;return oN++,Rz(t,{id:o,children:[],animatables:r,animations:s,duration:a.duration,delay:a.delay,endDelay:a.endDelay,startOnceDelay:n.startOnceDelay,pingPongDelayCorrection:n.pingPongDelayCorrection,pingPongEndDelayCorrection:n.pingPongEndDelayCorrection})}(e);l(c);function h(){var e=c.direction;"alternate"!==e&&(c.direction="normal"!==e?"normal":"reverse"),c.reversed=!c.reversed,n.forEach((function(e){(1===e.loop||e.loop%2===0)&&(e.reversed=c.reversed)}))}function u(e){return c.reversed?c.duration-e:e}function d(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];t&&(c.reversed?t.seek(t.duration*t.loop-(e-t.timelineOffset-t.pingPongDelayCorrection),n):t.seek(e-t.timelineOffset-t.startOnceDelay-t.pingPongDelayCorrection,n))}function p(e){var t=0,n=c.animations,i=n.length;for("alternate"!==c.direction&&"alternate"===(null===(r=c.parent)||void 0===r?void 0:r.direction)?!1===(null===(s=c.parent)||void 0===s?void 0:s.rewind)&&!0===c.reversePlayback&&!1===c.rewind&&(e=null!==(a=c.parent)&&void 0!==a&&a.reversed&&"alternate"===c.direction?c.duration-c.delay+c.endDelay-e:c.duration+c.delay-c.endDelay-e):g(!1,null===(o=c.parent)||void 0===o?void 0:o.rewind,c.rewind,null===(l=c.parent)||void 0===l?void 0:l.reversePlayback,c.reversePlayback)&&(e=null!==(h=c.parent)&&void 0!==h&&h.reversed&&"alternate"===c.direction?c.duration-c.delay+c.endDelay-e:c.duration+c.delay-c.endDelay-e);t<i;){var r,s,a,o,l,h,u,d=n[t],p=d.animatable,f=d.tweens,m=f.length-1,v=f[m];let i;m&&(v=Mz(f,(function(t){return e<t.end}))[0]||v),i=null!==(u=c.parent)&&void 0!==u&&u.reversed&&"alternate"===c.direction?gz(e-v.start-v.endDelay,0,v.duration)/v.duration:gz(e-v.start-v.delay,0,v.duration)/v.duration;for(var y=isNaN(i)?1:v.easing(i),b=v.to.strings,x=v.round,w=[],S=v.to.numbers.length,_=void 0,E=0;E<S;E++){var A,C,M,T=void 0;let e,t;"alternate"!==c.direction?!1===(null===(A=c.parent)||void 0===A?void 0:A.rewind)&&!0===c.reversePlayback&&!1===c.rewind?(e=v.to.numbers[E],t=v.from.numbers[E]||0):(t=v.to.numbers[E],e=v.from.numbers[E]||0):g(!0,null===(C=c.parent)||void 0===C?void 0:C.rewind,c.rewind,null===(M=c.parent)||void 0===M?void 0:M.reversePlayback,c.reversePlayback)?(e=v.to.numbers[E],t=v.from.numbers[E]||0):(t=v.to.numbers[E],e=v.from.numbers[E]||0),T=v.isPath?Kz(v.value,y*t):e+y*(t-e),x&&(v.isColor&&E>2||(T=Math.round(T*x)/x)),w.push(T)}var P=b.length;if(P){_=b[0];for(var D=0;D<P;D++){b[D];var O=b[D+1],I=w[D];isNaN(I)||(_+=O?I+O:I+" ")}}else _=w[0];iN[d.type](p.target,d.property,_,p.transforms),d.currentValue=_,t++}}function f(e){c[e]&&!c.passThrough&&c[e](c)}let m={0:!1,1:!0,2:!1,3:!0,4:!1,5:!1,6:!1,7:!1,8:!1,9:!0,10:!0,11:!1,12:!1,13:!1,14:!0,15:!0,16:!1,17:!0,18:!0,19:!1,20:!1,21:!1,22:!0,23:!0,24:!1,25:!0,26:!1,27:!0,28:!1,29:!1,30:!1,31:!1};function g(e,t,n,i,r){return m[e<<4|t<<3|n<<2|i<<1|r]}function v(e){var t;let r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];var s=c.duration;let m=c.delay,g=s-c.endDelay;(null===(t=c.parent)||void 0===t?void 0:t.reversed)&&"alternate"===c.direction&&(m=c.endDelay,g=s-c.delay);var v=u(e);if(c.progress=gz(v/s*100,0,100),r||(c.reversePlayback=v<c.currentTime),a&&function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(c.reversed)for(var i=a;i--;)d(e,n[i],t);else for(var r=0;r<a;r++)d(e,n[r],t)}(v,r),!c.began&&c.currentTime>=0&&(c.began=!0,f("begin")),!c.loopBegan&&c.currentTime>0&&(c.loopBegan=!0,f("loopBegin")),(c.reversed||v>=0)&&v<=m&&0!==c.currentTime&&(p(0),f("change")),(v>=g&&c.currentTime!==s+c.pingPongDelayCorrection||!s)&&(p(s),f("change")),v>m&&v<g?(c.changeBegan||(c.changeBegan=!0,c.changeCompleted=!1,f("changeBegin")),p(v),f("change")):c.changeBegan?(c.changeCompleted=!0,c.changeBegan=!1,f("change"),a&&f("timelineChangeComplete")):c.began&&v>g&&f("changeComplete"),c.currentTime=gz(v,0,s+c.pingPongDelayCorrection),c.began&&f("update"),e>=s)if(c.remaining&&!0!==c.remaining&&c.remaining--,c.remaining){i+=a?c.duration/dN.speed:c.duration;for(let e of n)e.setStartTime(0),e.remaining=e.loop;f("loopComplete"),c.loopBegan=!1,"alternate"===c.direction?h():a&&(c.direction="normal",c.reversed=!1,n.forEach((function(e){return e.reversed=!1})))}else c.paused=!0,c.completed||(c.completed=!0,f("loopComplete"),f("complete"),!c.passThrough&&"Promise"in window&&(o(),l(c)))}return c.reset=function(){var e=c.direction;c.passThrough=!1,c.currentTime=0,c.progress=0,c.paused=!0,c.began=!1,c.loopBegan=!1,c.changeBegan=!1,c.completed=!1,c.changeCompleted=!1,c.reversePlayback=!1,c.reversed="reverse"===e,c.remaining=c.loop,n=c.children;for(var t=a=n.length;t--;)c.children[t].reset();p(c.reversed?c.duration:0)},c.setStartTime=function(e){i=e},c.set=function(e,t){return rN(e,t),c},c.tick=function(e){s=e,i||(i=s),v((s+(r-i))*dN.speed)},c.seek=function(e){v(e-i,arguments.length>1&&void 0!==arguments[1]&&arguments[1])},c.pause=function(e){c.paused=!0,a&&(t=null!==e&&void 0!==e?e:performance.now())},c.play=function(e){!c.paused||(c.completed&&c.reset(),c.paused=!1,cN.push(c),a&&void 0!==t&&(i+=(null!==e&&void 0!==e?e:performance.now())-t),lN||uN())},c.reverse=function(){h(),c.completed=!c.reversed,i=0,r=u(c.currentTime)*(1/dN.speed)},c.restart=function(){c.reset(),c.play()},c.reset(),c.autoplay&&c.play(),c}function pN(e,t){for(var n=t.length;n--;)Dz(e,t[n].animatable.target)&&t.splice(n,1)}typeof document<"u"&&document.addEventListener("visibilitychange",(function(e){document.hidden?(cN.forEach((function(t){return t.pause(e.timeStamp)})),hN=cN.slice(0),dN.running=cN=[]):hN.forEach((function(t){return t.play(e.timeStamp)}))})),dN.version="3.2.0",dN.speed=1,dN.running=cN,dN.remove=function(e){for(var t=Jz(e),n=cN.length;n--;){var i=cN[n],r=i.animations,s=i.children;pN(t,r);for(var a=s.length;a--;){var o=s[a],l=o.animations;pN(t,l),!l.length&&!o.children.length&&s.splice(a,1)}!r.length&&!s.length&&i.pause()}},dN.get=Gz,dN.set=rN,dN.convertPx=Nz,dN.path=function(e,t){var n=bz.str(e)?Cz(e)[0]:e,i=t||100;return function(e){return{property:e,el:n,svg:Qz(n),totalLength:Yz(n)*(i/100)}}},dN.setDashoffset=function(e){var t=Yz(e);return e.setAttribute("stroke-dasharray",t),t},dN.stagger=function(e,t){void 0===t&&(t={});var n=t.direction||"normal",i=t.easing?Az(t.easing):null,r=t.grid,s=t.axis,a=t.from||0,o="first"===a,l="center"===a,c="last"===a,h=bz.arr(e),u=parseFloat(h?e[0]:e),d=h?parseFloat(e[1]):0,p=Lz(h?e[1]:e)||0,f=t.start||0+(h?u:0),m=[],g=0;return function(e,t,v){if(o&&(a=0),l&&(a=(v-1)/2),c&&(a=v-1),!m.length){for(var y=0;y<v;y++){if(r){var b=l?(r[0]-1)/2:a%r[0],x=l?(r[1]-1)/2:Math.floor(a/r[0]),w=b-y%r[0],S=x-Math.floor(y/r[0]),_=Math.sqrt(w*w+S*S);"x"===s&&(_=-w),"y"===s&&(_=-S),m.push(_)}else m.push(Math.abs(a-y));g=Math.max.apply(Math,m)}i&&(m=m.map((function(e){return i(e/g)*g}))),"reverse"===n&&(m=m.map((function(e){return s?e<0?-1*e:-e:Math.abs(g-e)})))}return f+(h?(d-u)/g:u)*(Math.round(100*m[t])/100)+p}},dN.timeline=function(e){void 0===e&&(e={});var t=dN(e);return t.duration=0,t.add=function(n,i){var r=cN.indexOf(t),s=t.children;function a(e){e.passThrough=!0}r>-1&&cN.splice(r,1);for(var o=0;o<s.length;o++)a(s[o]);var l=Rz(n,Iz(pz,e));l.targets=l.targets||e.targets;var c=t.duration;l.autoplay=!1,l.timelineOffset=bz.und(i)?c:Hz(i,c),a(t);var h=dN(l);a(h),s.push(h),h.parent=t;var u=aN(s,e);return t.delay=u.delay,t.endDelay=u.endDelay,t.duration=u.duration,!0===h.loop&&(t.duration=1/0),t.seek(0),t.reset(),t.autoplay&&t.play(),t},t},dN.easing=Az,dN.penner=Ez,dN.random=function(e,t){return Math.floor(Math.random()*(t-e+1))+e};var fN=dN,mN=new Bt,gN=new Bt,vN=new Lt;function yN(e,t,n,i,r,s){var a,o;let l=void 0!==n[e]?n[e]:void 0,c=i[e];if(null==c)return;let h=null!=l?"string"==typeof l?Number(null!==(a=r.getVariable(l))&&void 0!==a?a:0):l:t[e],u="string"==typeof c?Number(null!==(o=r.getVariable(c))&&void 0!==o?o:0):c;return h!==u?{update:n=>{let i=at.lerp(h,u,n);t[e]=s?Math.trunc(i):i},start:()=>{t[e]=h},end:()=>{t[e]=u}}:void 0}function bN(e,t,n,i,r,s){let a=n[e]?n[e]:void 0,o=i[e];if(!o)return;let l=t[e],c=[...null!==a&&void 0!==a?a:l].map((e=>{var t;return"string"==typeof e?Number(null!==(t=r.getVariable(e))&&void 0!==t?t:0):e})),h=[...o].map((e=>{var t;return"string"==typeof e?Number(null!==(t=r.getVariable(e))&&void 0!==t?t:0):e}));return c.length!==h.length||fm(c,h)?void 0:{update:n=>{c.forEach(((i,r)=>{let a=at.lerp(i,h[r],n);t[e][r]=s?Math.trunc(a):a}))},start:()=>{Object.assign(t[e],c)},end:()=>{Object.assign(t[e],h)}}}function xN(e,t,n){return t.forEach(((t,i)=>{var r;e.setComponent(i,"string"==typeof t?Number(null!==(r=n.getVariable(t))&&void 0!==r?r:0):t)})),e}function wN(e,t,n,i,r){let s=n[e]?n[e]:void 0,a=i[e];if(!a)return;let o=t[e],l=s?xN(new Bt,s,r):o.clone(),c=xN(new Bt,a,r);return l.equals(c)?void 0:{update:e=>{o.lerpVectors(l,c,e)},start:()=>{o.copy(l)},end:()=>{o.copy(c)}}}function SN(e,t,n){return t.forEach(((t,i)=>{var r;e.setComponent(i,"string"==typeof t?Number(null!==(r=n.getVariable(t))&&void 0!==r?r:0):t)})),e}function _N(e,t,n,i,r){let s=n[e]?n[e]:void 0,a=i[e];if(!a)return;let o=t[e],l=!(o instanceof ot),c=o instanceof ot?o:(new ot).fromArray(o),h=s?SN(new ot,s,r):c.clone(),u=SN(new ot,a,r);return h.equals(u)?void 0:{update:n=>{c.lerpVectors(h,u,n),l&&(t[e]=c.toArray())},start:()=>{c.copy(h),l&&(t[e]=c.toArray())},end:()=>{c.copy(u),l&&(t[e]=c.toArray())}}}function EN(e,t,n,i,r){let s=n[e]?n[e]:void 0,a=i[e];if(!a)return;let o=t[e],l=new QC(o.r,o.g,o.b,o.a),c=s?"string"==typeof s?r.getColor(s).clone():new QC(s.r,s.g,s.b,s.a):l.clone(),h="string"==typeof a?r.getColor(a).clone():new QC(a.r,a.g,a.b,a.a);return c.equals(h)?void 0:{update:n=>{l.lerpColors(c,h,n);let i=at.lerp(c.a,h.a,n);l.a=i,t[e]={r:l.r,g:l.g,b:l.b,a:l.a}},start:()=>{l.copy(c)},end:()=>{l.copy(h)}}}function AN(e,t,n,i,r){return"number"==typeof t[e]?yN(e,t,null!==n&&void 0!==n?n:{},i,r):Array.isArray(t[e])?bN(e,t,null!==n&&void 0!==n?n:{},i,r):void 0}function CN(e,t,n,i){let r=[];if(!("geometry"in n))return r;let s=e.geometry.userData.parameters,a="geometry"in t?t.geometry:{},l=n.geometry;if(e instanceof FD){let t=function(e,t,n,i){var r;if(void 0===n.scaleBaked)return;let s=(null!==(r=t.scaleBaked)&&void 0!==r?r:e.data.geometry.scaleBaked).map((e=>{var t;return"string"==typeof e?Number(null!==(t=i.getVariable(e))&&void 0!==t?t:0):e})),a=n.scaleBaked.map((e=>{var t;return"string"==typeof e?Number(null!==(t=i.getVariable(e))&&void 0!==t?t:0):e}));if(Hy.isEqual(s,a))return;let o=[];return o.push({update:t=>{e.updateGeometryInteractions({scaleBaked:[at.lerp(s[0],a[0],t),at.lerp(s[1],a[1],t),at.lerp(s[2],a[2],t)]},i),e.invalidateDownstreamBooleanData(),e.refreshAttachedClonersInteractions()},start:()=>{e.updateGeometryInteractions({scaleBaked:s},i),e.invalidateDownstreamBooleanData(),e.refreshAttachedClonersInteractions()},end:()=>{e.updateGeometryInteractions({scaleBaked:a},i),e.invalidateDownstreamBooleanData(),e.refreshAttachedClonersInteractions()}}),o}(e,a,l,i);t&&r.push(...t)}else{let t={};if(Object.assign(t,Am(s,Cx),Am(a,Cx)),Cx.forEach((e=>{let n=AN(e,t,a,l,i);n&&r.push(n)})),e instanceof mL){Object.assign(t,{extrusion:o({},s.extrusion)});let e=function(e,t,n,i){var r;if(!n.extrusion)return;let s=e.extrusion,a=null!==(r=t.extrusion)&&void 0!==r?r:{},o=n.extrusion,l=[];return zb.forEach((e=>{let t=AN(e,s,a,o,i);t&&l.push(t)})),l}(t,a,l,i);e&&r.push(...e)}r.length&&r.push({update:n=>{e.updateGeometryInteractions(t,i),e.updateGeometryGroupsIfNeeded(),e.refreshAttachedClonersInteractions()},start:n=>{e.updateGeometryInteractions(t,i),e.updateGeometryGroupsIfNeeded(),e.refreshAttachedClonersInteractions()},end:n=>{e.updateGeometryInteractions(t,i),e.updateGeometryGroupsIfNeeded(),e.refreshAttachedClonersInteractions()}})}return r}function MN(e,t,n,i){let r=[];if(void 0!==n.intensity){let s=yN("intensity",e,t,n,i);s&&r.push(s)}if(void 0!==n.color){let s=function(e,t,n,i,r){let s=n[e]?n[e]:void 0,a=i[e];if(!a)return;let o=t[e],l=s?"string"==typeof s?r.getColor(s).clone():(new Et).setRGB(s.r,s.g,s.b):o.clone(),c="string"==typeof a?r.getColor(a).clone():(new Et).setRGB(a.r,a.g,a.b);if(l.equals(c))return;let h=o.clone();return{update:n=>{var i,r;h.lerpColors(l,c,n),null===(i=t[e])||void 0===i||null===(r=i.copy)||void 0===r||r.call(i,h)},start:()=>{h.copy(l)},end:()=>{h.copy(c)}}}("color",e,t,n,i);s&&r.push(s)}return r}function TN(e,t,n,i){let r=[],s=xP(n,i)||!!t.layers&&xP(t,i);r.push(function(e,t){return{update:()=>{e.transparent=t}}}(e,s));for(let c of e.layers){var a,o,l;let e=null===(a=t.layers)||void 0===a?void 0:a.data(c.uuid),s=n.layers.data(c.uuid);if(!s||"light"!==c.type&&(null!==(o=c.visible)&&void 0!==o&&!o||null!==(l=s.visible)&&void 0!==l&&!l))continue;let h=c.getNames().filter((e=>!Pb.some((t=>e.includes(t)))));for(let t of h)try{let n,a=c.getValue(t);if("colors"===t)n=LN(c,e,s,t);else if(Array.isArray(a))"steps"===t&&(n=kN(c,e,s,t));else if("number"==typeof a)n=PN(c,e,s,t,i);else{if("boolean"==typeof a)continue;a instanceof ot?n=DN(c,e,s,t):a instanceof Bt?n=ON(c,e,s,t,i):a instanceof QC?n=RN(c,e,s,t,i):a instanceof Et?n=IN(c,e,s,t,i):"isTexture"in a&&(n=BN(c,e,s,t))}n&&(Array.isArray(n)?r.push(...n):r.push(n))}catch(GZ){console.error("lerpMaterial: unexpected material layer for ".concat(t),GZ)}}return r}function PN(e,t,n,i,r){var s,a;if(!e.hasValue(i)||!(i in n))return;let o=t?t[i]:e.getValue(i),l=n[i],c="string"==typeof o?Number(null!==(s=r.getVariable(o))&&void 0!==s?s:0):o,h="string"==typeof l?Number(null!==(a=r.getVariable(l))&&void 0!==a?a:0):l;return c!==h?{update:t=>{e.setValue(i,at.lerp(c,h,t))},start:()=>{e.setValue(i,c)},end:()=>{e.setValue(i,h)}}:void 0}function DN(e,t,n,i){if(!e.hasValue(i)||!(i in n))return;let r=e.getValue(i),s=t?(new ot).fromArray(t[i]):r.clone(),a=(new ot).fromArray(n[i]);return s.equals(a)?void 0:{update:e=>{r.lerpVectors(s,a,e)},start:()=>{r.copy(s)},end:()=>{r.copy(a)}}}function ON(e,t,n,i,r){if(!e.hasValue(i)||!(i in n))return;let s=e.getValue(i),a=t?t[i]:void 0,o=n[i],l=a?xN(new Bt,a,r):s.clone(),c=xN(new Bt,o,r);return l.equals(c)?void 0:{update:e=>{s.lerpVectors(l,c,e)},start:()=>{s.copy(l)},end:()=>{s.copy(c)}}}function IN(e,t,n,i,r){if(!e.hasValue(i)||!(i in n))return;let s=t?t[i]:void 0,a=n[i],o=e.getValue(i),l=s?"string"==typeof s?r.getColor(s).clone():(new Et).setRGB(s.r,s.g,s.b):o.clone(),c="string"==typeof a?r.getColor(a).clone():(new Et).setRGB(a.r,a.g,a.b);if(l.equals(c))return;let h=o.clone();return{update:t=>{e.getValue(i)!==h&&e.setValue(i,h),h.lerpColors(l,c,t)},start:()=>{h.copy(l)},end:()=>{h.copy(c)}}}function RN(e,t,n,i,r){if(!e.hasValue(i)||!(i in n))return;let s=t?t[i]:void 0,a=n[i],o=e.getValue(i),l=s?"string"==typeof s?r.getColor(s).clone():(new Et).setRGB(s.r,s.g,s.b):o.clone(),c="string"==typeof a?r.getColor(a).clone():new QC(a.r,a.g,a.b,a.a);if(l.equals(c))return;let h=o.clone();return{update:t=>{e.getValue(i)!==h&&e.setValue(i,h),h.lerpColors(l,c,t)},start:()=>{h.copy(l)},end:()=>{h.copy(c)}}}function kN(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"steps";if(!e.hasValue(i)||!(i in n))return;let r=[],s=e.getValue(i),a=t?t[i]:s,o=n[i];return fm(a,o)||r.push({update:t=>{let n=[...s];for(let e=0;e<s.length;++e){let i=a[e],r=o[e];n[e]=at.lerp(i,r,t)}e.setValue(i,n)},start:()=>{e.setValue(i,a)},end:()=>{e.setValue(i,o)}}),r.length?r:void 0}function LN(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"colors";if(!e.hasValue(i)||!(i in n))return;let r=[],s=e.getValue(i),a=t?t[i]:s.map((e=>e.toArray())),o=n[i];for(let l=0;l<s.length;++l){let e=[...a[l]],t=[...o[l]];Wy.isEqual(e,t)||r.push({update:n=>{s[l].fromArray(Wy.lerp(e,t,n))},start:()=>{s[l].fromArray(e)},end:()=>{s[l].fromArray(t)}})}return r.length?r:void 0}function BN(e,t,n){var i,r,s,a,o,l;let c=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"texture";if(!e.hasValue(c)||!(c in n))return;let h=e.getNode("rotation"),u=null!==(i=null===t||void 0===t||null===(r=t[c])||void 0===r?void 0:r.rotation)&&void 0!==i?i:0,d=null!==(s=null===(a=n[c])||void 0===a?void 0:a.rotation)&&void 0!==s?s:0;if(h&&u!==d)return{update:e=>{h.value=at.lerp(u,d,e)*at.DEG2RAD},start:()=>{h.value=u*at.DEG2RAD},end:()=>{h.value=d*at.DEG2RAD}};let p=e.getNode("mat");if(!p)return;let f=t?t[c]:p,m=n[c],g=[...f.repeat],v=[...f.offset],y=[...m.repeat],b=[...m.offset],x=null!==(o=f.rotation)&&void 0!==o?o:0,w=null!==(l=m.rotation)&&void 0!==l?l:0;return Gy.isEqual(g,y)&&Gy.isEqual(v,b)&&x===w?void 0:{update:e=>{p.repeat=Gy.lerp(g,y,e),p.offset=Gy.lerp(v,b,e),p.rotation=at.lerp(x,w,e),p.updateMatrix()},start:()=>{p.repeat=[...g],p.offset=[...v],p.rotation=x,p.updateMatrix()},end:()=>{p.repeat=[...y],p.offset=[...b],p.rotation=w,p.updateMatrix()}}}var zN=new Bt,NN=new _n;function FN(e,t,n,i,r){var s,a,o,l,c,h,u,d,p,f,m,g,v,y,b,x,w,S;let _,E,A,C,M,T,P,D,O=[];if(e instanceof vk?(_=_N("position",e,t,n,r),_&&O.push(_),A=yN("rotation",e,t,n,r),A&&O.push(A),C=_N("shear",e,t,n,r),C&&O.push(C)):(D={slide:null!==(s=null!==(a=null!==(o=null===(l=t.pathSnapping)||void 0===l?void 0:l.slide)&&void 0!==o?o:null===(c=e.updatedPathSnapping)||void 0===c?void 0:c.slide)&&void 0!==a?a:null===(h=e.dataPatched.pathSnapping)||void 0===h?void 0:h.slide)&&void 0!==s?s:0,offset:null!==(u=null!==(d=null!==(p=null===(f=t.pathSnapping)||void 0===f?void 0:f.offset)&&void 0!==p?p:null===(m=e.updatedPathSnapping)||void 0===m?void 0:m.offset)&&void 0!==d?d:null===(g=e.dataPatched.pathSnapping)||void 0===g?void 0:g.offset)&&void 0!==u?u:0},T=yN("slide",D,null!==(v=null!==(y=t.pathSnapping)&&void 0!==y?y:e.updatedPathSnapping)&&void 0!==v?v:e.dataPatched.pathSnapping,null!==(b=n.pathSnapping)&&void 0!==b?b:e.dataPatched.pathSnapping,r),T&&O.push(T),P=yN("offset",D,null!==(x=null!==(w=t.pathSnapping)&&void 0!==w?w:e.updatedPathSnapping)&&void 0!==x?x:e.dataPatched.pathSnapping,null!==(S=n.pathSnapping)&&void 0!==S?S:e.dataPatched.pathSnapping,r),P&&O.push(P),!T&&!P&&(_=wN("position",e,t,n,r),_&&O.push(_),E=wN("scale",e,t,n,r),E&&O.push(E),A=function(e,t,n,i,r){var s;let a=null!==t&&void 0!==t&&t.rotation?t.rotation.map((e=>{var t;return("string"==typeof e?Number(null!==(t=r.getVariable(e))&&void 0!==t?t:0):e)*at.DEG2RAD})):void 0,o=null===(s=n.rotation)||void 0===s?void 0:s.map((e=>{var t;return("string"==typeof e?Number(null!==(t=r.getVariable(e))&&void 0!==t?t:0):e)*at.DEG2RAD}));if(!o)return;let l=a?(new Bt).fromArray(a):(new Bt).setFromEuler(e.rotation),c=(new Bt).fromArray(o);if(l.equals(c))return;let h=zN.subVectors(c,l);if(i&&h.toArray().every((e=>Math.abs(e)<2*Math.PI))){let t=(new Lt).setFromEuler(NN.setFromVector3(l)),n=(new Lt).setFromEuler(NN.setFromVector3(c));return{update:i=>{!function(e,t,n,i){if(0===i)return n.copy(e);if(1===i)return n.copy(t);let r=e.w*t.w+e.x*t.x+e.y*t.y+e.z*t.z;if(r>=1)return n.copy(e);let s=1-r*r;if(s<=Number.EPSILON){let r=1-i;return n.w=r*e.w+i*t.w,n.x=r*e.x+i*t.x,n.y=r*e.y+i*t.y,n.z=r*e.z+i*t.z,n.normalize(),n}let a=Math.sqrt(s),o=Math.atan2(a,r),l=Math.sin((1-i)*o)/a,c=Math.sin(i*o)/a;n.w=e.w*l+t.w*c,n.x=e.x*l+t.x*c,n.y=e.y*l+t.y*c,n.z=e.z*l+t.z*c}(t,n,e.quaternion,i)},start:()=>{e.rotation.setFromVector3(l)},end:()=>{e.rotation.setFromVector3(c)}}}return{update:t=>{zN.lerpVectors(l,c,t),e.rotation.setFromVector3(zN)},start:()=>{e.rotation.setFromVector3(l)},end:()=>{e.rotation.setFromVector3(c)}}}(e,t,n,i,r),A&&O.push(A),M=function(e,t,n,i){let r=n[e]?n[e]:void 0,s=i[e];if(!s)return;let a=t[e],o=r?(new pn).fromArray(r):a.clone(),l=new Bt,c=new Lt,h=new Bt;o.decompose(l,c,h);let u=(new pn).fromArray(s),d=new Bt,p=new Lt,f=new Bt;return u.decompose(d,p,f),o.equals(u)?void 0:{update:e=>{vN.slerpQuaternions(c,p,e),mN.lerpVectors(l,d,e),gN.lerpVectors(h,f,e),a.compose(mN,vN,gN)},start:()=>{a.compose(l,c,h)},end:()=>{a.compose(d,p,f)}}}("hiddenMatrix",e,t,n),M&&O.push(M))),_||E||A||M||T||P){let n=e instanceof vk?()=>{e.updateWorldMatrix(!0,!1,!0),e.resetBBoxNeedsUpdate()}:()=>{var n;e.updateMatrix(),e.hasNonUniformScale&&(e.updateMatrixWorld(),e.updateMatrixWorldSVD()),null!==(n=e.parent)&&void 0!==n&&n.matrixWorldFusedFalse&&(e.matrixWorld.multiplyMatrices(e.parent.matrixWorldFusedFalse,e.matrix),e.matrixWorldNeedsUpdate=!1),YO(e)&&QO(e.parent)&&e.invalidateDownstreamBooleanData(!0),e.updatePathSnapping(Object.assign({},t.pathSnapping,D))};O.push({update:n,start:n,end:n})}return O}function UN(e,t,n,i){let r=[];if(!("cloner"in n)||!e.cloner)return r;let s=e.cloner,a="cloner"in t?t.cloner:{},o=n.cloner;bb.forEach((e=>{let t;t="count"===e?yN("count",s.parameters,a,o,i,!0):AN(e,s.parameters,null!==a&&void 0!==a?a:{},o,i),t&&r.push(t)}));let l=function(e,t,n,i){if("radial"!==e.parameters.type)return;let r=t.radial,s=n.radial;if(!s)return;let a=e.parameters.radial,o=[];return xb.forEach((e=>{let t=AN(e,a,null!==r&&void 0!==r?r:{},s,i);t&&o.push(t)})),o}(s,a,o,i);(null===l||void 0===l?void 0:l.length)&&r.push(...l);let c=function(e,t,n,i){if("linear"!==e.parameters.type)return;let r=t.linear,s=n.linear;if(!s)return;let a=[],o=e.parameters.linear;return wb.forEach((e=>{let t=AN(e,o,null!==r&&void 0!==r?r:{},s,i);t&&a.push(t)})),a}(s,a,o,i);(null===c||void 0===c?void 0:c.length)&&r.push(...c);let h=function(e,t,n,i){if("grid"!==e.parameters.type)return;let r=t.grid,s=n.grid;if(!s)return;let a=[],o=e.parameters.grid;return Sb.forEach((e=>{let t;t="count"===e?bN(e,o,null!==r&&void 0!==r?r:{},s,i,!0):AN(e,o,null!==r&&void 0!==r?r:{},s,i),t&&a.push(t)})),a}(s,a,o,i);(null===h||void 0===h?void 0:h.length)&&r.push(...h);let u=function(e,t,n,i){if("toObject"!==e.parameters.type)return;let r=t.toObject,s=n.toObject;if(!s)return;let a=[],o=e.parameters.toObject;return _b.forEach((e=>{let t;t="count"===e?yN(e,o,null!==r&&void 0!==r?r:{},s,i,!0):AN(e,o,null!==r&&void 0!==r?r:{},s,i),t&&a.push(t)})),a}(s,a,o,i);(null===u||void 0===u?void 0:u.length)&&r.push(...u);let d=function(e,t,n,i){if(!e.parameters.randomness)return;let r=t.randomnessObject,s=n.randomnessObject;if(!s)return;let a=[],o=e.parameters.randomnessObject;return Eb.forEach((e=>{let t=AN(e,o,null!==r&&void 0!==r?r:{},s,i);t&&a.push(t)})),a}(s,a,o,i);return null!==d&&void 0!==d&&d.length&&r.push(...d),r.length&&r.push({update:()=>{s.update()}}),r}function jN(e,t,n,i,r){let s,a,l,c,h,u,d,p,f,m,g,v,y,b,x,w=[];if("width"in e&&(s=yN("width",e,t,n,r),s&&w.push(s)),"height"in e&&(a=yN("height",e,t,n,r),a&&w.push(a)),e instanceof Gk||e instanceof Yk){let i=o({},t.fill),s=o({},n.fill);void 0!==i.enabled&&i.enabled!==s.enabled&&(w.push(function(e,t){return{update:()=>{e instanceof Gk&&(e.fill.enabled=t)}}}(e,!0)),i.enabled||Object.assign(i,{enabled:!0,color:o(o({},i.color),{},{a:0})}),s.enabled||Object.assign(s,{enabled:!0,color:o(o({},s.color),{},{a:0})})),l=EN("color",e.fill,i,s,r),l&&w.push(l)}if(e instanceof Gk){let i=o({},t.stroke),s=o({},n.stroke);(i.enabled||s.enabled)&&(w.push(function(e,t){return{update:()=>{e instanceof Gk&&(e.stroke.enabled=t)}}}(e,!0)),i.enabled||Object.assign(i,{enabled:!0,color:o(o({},i.color),{},{a:0})}),s.enabled||Object.assign(s,{enabled:!0,color:o(o({},s.color),{},{a:0})})),c=EN("color",e.stroke,i,s,r),c&&w.push(c),h=yN("thickness",e.stroke,i,s,r),h&&w.push(h)}if(e instanceof Gk){let i=o({},t.dropShadow),s=o({},n.dropShadow);(i.enabled||s.enabled)&&(w.push(function(e,t){return{update:()=>{e instanceof Gk&&(e.dropShadow.enabled=t)}}}(e,!0)),i.enabled||Object.assign(i,{enabled:!0,color:o(o({},i.color),{},{a:0})}),s.enabled||Object.assign(s,{enabled:!0,color:o(o({},s.color),{},{a:0})})),u=EN("color",e.dropShadow,i,s,r),u&&w.push(u),d=yN("blurRadius",e.dropShadow,i,s,r),d&&w.push(d),f=yN("spread",e.dropShadow,i,s,r),f&&w.push(f),p=_N("offset",e.dropShadow,i,s,r),p&&w.push(p)}if(e instanceof Gk){let i=o({},t.innerShadow),s=o({},n.innerShadow);(i.enabled||s.enabled)&&(w.push(function(e,t){return{update:()=>{e instanceof Gk&&(e.innerShadow.enabled=t)}}}(e,!0)),i.enabled||Object.assign(i,{enabled:!0,color:o(o({},i.color),{},{a:0})}),s.enabled||Object.assign(s,{enabled:!0,color:o(o({},s.color),{},{a:0})})),m=EN("color",e.innerShadow,i,s,r),m&&w.push(m),g=yN("blurRadius",e.innerShadow,i,s,r),g&&w.push(g),y=yN("spread",e.innerShadow,i,s,r),y&&w.push(y),v=_N("offset",e.innerShadow,i,s,r),v&&w.push(v)}if(e instanceof Gk||e instanceof Yk){let i=o({},t.backgroundBlur),s=o({},n.backgroundBlur);(i.enabled||s.enabled)&&(w.push(function(e,t){return{update:()=>{e instanceof Gk&&(e.backgroundBlur.enabled=t)}}}(e,!0)),i.enabled||Object.assign(i,{enabled:!0,radius:0}),s.enabled||Object.assign(s,{enabled:!0,radius:0})),b=yN("radius",e.backgroundBlur,i,s,r),b&&w.push(b)}if(e instanceof Gk){let i=o({},t.layerBlur),s=o({},n.layerBlur);(i.enabled||s.enabled)&&(w.push(function(e,t){return{update:()=>{e instanceof Gk&&(e.layerBlur.enabled=t)}}}(e,!0)),i.enabled||Object.assign(i,{enabled:!0,radius:0}),s.enabled||Object.assign(s,{enabled:!0,radius:0})),x=yN("radius",e.layerBlur,i,s,r),x&&w.push(x)}if(e instanceof Yk||e instanceof Wk){let i=bN("cornerRadius",e,t,n,r);i&&w.push(i)}return w}function VN(e,t,n,i,r){let s=[];return e.data.visible&&s.push(...FN(e,t,n,r,i)),e instanceof vk?s.push(...jN(e,t,n,0,i)):(e.data.visible&&s.push(...UN(e,t,n,i)),YO(e)?(e instanceof RD&&e.data.visible&&s.push(...CN(e,t,n,i)),e.data.visible&&s.push(...function(e,t,n,i){let r=[];if(Array.isArray(e.material)){if(!("materials"in n)||!n.materials)return r;let s="materials"in t&&t.materials?t.materials:[],a=n.materials;e.material.forEach(((e,t)=>{var n;if(!a[t])return;let o=null!==(n=s[t])&&void 0!==n?n:{},l=a[t];"string"==typeof o||"string"==typeof l||r.push(...TN(e,o,l,i))}))}else{if(!("material"in n)||!n.material)return r;let s="material"in t&&t.material?t.material:{},a=n.material;if("string"==typeof s||"string"==typeof a)return r;r.push(...TN(e.material,s,a,i))}return r}(e,t,n,i))):(e=>WO.is(e))(e)?e.data.visible&&s.push(...MN(e,t,n,i)):(e=>e instanceof jO)(e)&&s.push(...function(e,t,n,i){var r,s,a,o;let l=[],c="OrthographicCamera"===e.cameraType?null===(r=t.orthographic)||void 0===r?void 0:r.zoom:null===(s=t.perspective)||void 0===s?void 0:s.zoom,h="OrthographicCamera"===e.cameraType?null===(a=n.orthographic)||void 0===a?void 0:a.zoom:null===(o=n.perspective)||void 0===o?void 0:o.zoom;if(void 0!==h){let t=null!==c&&void 0!==c?c:e.zoom,n=h;t!==n&&l.push({update:i=>{e.zoom=at.lerp(t,n,i),e.updateProjectionMatrix()},start:()=>{e.zoom=t,e.updateProjectionMatrix()},end:()=>{e.zoom=n,e.updateProjectionMatrix()}})}if(void 0!==n.targetOffset){let r=yN("targetOffset",e,t,n,i);r&&l.push(r)}return l}(e,t,n,i))),s.length?{update:e=>{s.forEach((t=>t.update(e)))},start:e=>{s.forEach((t=>{var n;return null===(n=t.start)||void 0===n?void 0:n.call(t,e)}))},end:e=>{s.forEach((t=>{var n;return null===(n=t.end)||void 0===n?void 0:n.call(t,e)}))}}:void 0}var GN=new Bt;function HN(e,t){var n;let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=[],s=n=>{let i=n.data;delete n.states,n.currentState=null,n.reversibleToState=null,n.currentTransitionEvent=null;for(let e of i.states){let t=o({},e.data);n.states||(n.states={}),n.states[e.id]=Zx.patch(i,t)}qN(e.scene,n,null,t,void 0!==i.events.find((e=>"Follow"===e.data.type||"LookAt"===e.data.type))),WN(e)};e.scene.traverse2D(s),e.traverseChildren((n=>{var a,l,c,h,u,d;if(i&&(null!==(a=n.rigidBody)&&void 0!==a&&a.setTranslation(n.position0,!0),null!==(l=n.rigidBody)&&void 0!==l&&l.setRotation(n.rotation0,!0),null!==(c=n.rigidBody)&&void 0!==c&&c.setLinvel(GN,!0),null!==(h=n.rigidBody)&&void 0!==h&&h.setAngvel(GN,!0)),!XS.is(n))return;let p=n.uuid,f=n.data;if(delete n.states,n.uuid===rb)return;let m=!1;r.some((t=>{var n;return null===(n=e.scene.find(p))||void 0===n?void 0:n.isDescendantOf(t)}))?m=!0:!0===(null===(u=f.physics)||void 0===u?void 0:u.fusedBody)&&"dynamic"===f.physics.rigidBody&&r.push(p),n.data=f,n.currentState=null,n.reversibleToState=null,n.currentTransitionEvent=null;for(let t of f.states){let i=o({},t.data);!0===e.data.globalPhysics.usePhysics&&f.physics&&("dynamic"===f.physics.rigidBody||m)&&(void 0!==t.data.position&&delete i.position,void 0!==t.data.rotation&&delete i.rotation,void 0!==t.data.hiddenMatrix&&delete i.hiddenMatrix),n.states||(n.states={}),n.states[t.id]=ox.patch(f,i)}qN(e.scene,n,null,t,void 0!==f.events.find((e=>"Follow"===e.data.type||"LookAt"===e.data.type))),n instanceof SL&&n.frame&&(n.frame.traverse((e=>s(e))),null===(d=n.uiCanvas)||void 0===d||d.applySize())})),WN(e),e.frame&&(e.frame.traverse((e=>s(e))),null===(n=e.uiCanvas)||void 0===n||n.applySize())}function WN(e){e.traverseEntity((t=>{for(let n of t.data.events){let t=[];switch(n.data.type){case"Follow":case"MouseHover":case"Scroll":case"MouseDown":case"MouseUp":case"MousePress":case"KeyUp":case"KeyDown":case"KeyPress":case"Collision":t.push(...n.data.actions);break;case"GameControl":for(let e of Object.values(n.data.gameActions))t.push(...e);break;case"DragDrop":t.push(...n.data.dragDropActions.drag,...n.data.dragDropActions.drop);break;case"Conditional":t.push(...n.data.inActions,...n.data.outActions)}for(let n of t)if("Create"===n.data.type&&"Yes"===n.data.hideBase){let t=e.scene.find(n.data.object);t&&(t.visible=!1)}}}))}function qN(e,t,n,i){let r=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(t instanceof RD&&!(t instanceof qL)&&t.removeInteractionGeometry(i),t instanceof vk?t.changeSelectedState(n,{shared:i},r):t.changeSelectedState(n,{scene:e,shared:i},r),t instanceof RD&&t.updateGeometryGroupsIfNeeded(),t instanceof jO&&t.updateCameraState(t.dataPatched,{scene:e,shared:i}),!(t instanceof vk)){if(t.cloner)for(let e of t.cloner.children)e.playModeVisible=void 0;t.updateVisible()}}function XN(e){let t;if(5===e.easing){let{control1:n,control2:i}=e;t="cubicBezier(\n\t\t\t".concat(n[0],", ").concat(n[1],", ").concat(i[0],", ").concat(i[1],"\n\t\t)")}else if(6===e.easing){let{mass:n,stiffness:i,damping:r,velocity:s}=e;t="spring( ".concat(n,", ").concat(i,", ").concat(r,", ").concat(s," )")}else{let n;switch(e.easing){case 0:default:n=$y.linear;break;case 1:n=$y.ease;break;case 2:n=$y.easeIn;break;case 3:n=$y.easeOut;break;case 4:n=$y.easeInOut}let[i,r,s,a]=n;t="cubicBezier( ".concat(i,", ").concat(r,", ").concat(s,", ").concat(a," )")}return{duration:Math.max(e.duration,1e-4),easing:t}}function YN(e){let t={delay:0,loop:-1===e.repeat||e.repeat+1};if(0===e.repeat)t.direction="normal",t.rewind=!1;else switch(e.direction){case"pingpong":t.direction="alternate",t.rewind=!1;break;case"pingpong-rewind":t.direction="alternate",t.rewind=!0;break;default:t.direction="normal",t.rewind=!1}switch(t.delay=0,t.endDelay=0,t.startOnceDelay=0,t.pingPongDelayCorrection=0,t.pingPongEndDelayCorrection=0,e.delayDirection){case"start-once":t.startOnceDelay=e.delay;break;case"start":t.delay=e.delay;break;case"end":t.endDelay=e.delay;break;case"start-end":case void 0:t.delay=e.delay,t.endDelay=e.delay}return"alternate"===t.direction&&(t.delay/=2,t.endDelay/=2,"start"===e.delayDirection?(t.pingPongDelayCorrection=t.delay,"number"==typeof t.loop&&t.loop%2===0&&(t.pingPongEndDelayCorrection=t.delay)):"end"===e.delayDirection?"number"==typeof t.loop&&t.loop%2!==0&&(t.pingPongEndDelayCorrection=t.endDelay):"start-end"===e.delayDirection&&(t.pingPongDelayCorrection=t.delay,t.pingPongEndDelayCorrection=t.endDelay)),t}var QN={type:"beginState"},KN={type:"completeState",isfromEntity:!1},ZN=class{constructor(e,t,n,i,r,s){if(this.object=e,this.data=i,this.sharedAssets=r,this.allowSlerp=s,this.targets={t:0},this.firstLoop=!0,this._changeBegan=!1,this._changeCompleted=!0,this.onChange=()=>{this.callback&&(this.callback.update(this.targets.t),this.object.requestRender()),0===this.targets.t||1===this.targets.t?this._changeCompleted||(this._changeCompleted=!0,this._changeBegan=!1,this.onChangeComplete()):(this._changeCompleted&&(this._changeCompleted=!1),this._changeBegan||(this._changeBegan=!0,this.onChangeBegin()))},this.onChangeBegin=()=>{this.object.reversibleToState=this.to.id;let e=this.targets.t>.5?this.from.id:this.to.id;this.object.prevState!==this.object.currentState&&(this.object.prevState=this.object.currentState),this.object.currentState=e,this.object.dispatchEvent({type:"beginState",state:e}),this.object instanceof vk||this.object.traverseEntity((e=>{e!==this.object&&e instanceof jO&&e.dispatchEvent(QN)}))},this.onChangeComplete=()=>{this.firstLoop&&(this.onFirstLoop(),this.firstLoop=!1),this.object.reversibleToState=this.to.id;let e=this.targets.t<.5?this.from.id:this.to.id;this.object.prevState!==this.object.currentState&&(this.object.prevState=this.object.currentState),this.object.currentState=e,this.object.dispatchEvent({type:"completeState",state:e}),this.object instanceof vk||this.object.traverseEntity((e=>{e!==this.object&&e instanceof jO&&e.dispatchEvent(KN)}))},this.onFirstLoop=()=>{this.useCurrentState&&(this.callback=VN(this.object,this.from.data,this.to.data,this.sharedAssets,this.allowSlerp))},void 0===t){let e=$N(this.object,this.object.currentState===n?this.object.prevState:this.object.currentState);if(!e)throw new Error("Missing property");this.from=e}else{let e=$N(this.object,t);if(!e)throw new Error("Missing property");this.from=e}if(void 0===n)throw new Error("Missing property");{let e=$N(this.object,n);if(!e)throw new Error("Missing property");this.to=e}this.useCurrentState=void 0===t||void 0===n,this.params=o(o(o({targets:this.targets,t:1,autoplay:!1},YN(i)),XN(i)),{},{change:this.onChange}),this.callback=VN(this.object,void 0===t?{}:this.from.data,void 0===n?{}:this.to.data,this.sharedAssets,this.allowSlerp)}get changeBegan(){return this._changeBegan}get changeCompleted(){return this._changeCompleted}},JN=class extends qe{constructor(e,t,n,i,r){var s,a,o;if(super(),this.eventType=e,this.data=t,this.page=n,this.shared=i,this.condition=r,this.toggleIsForward=!1,this.timelineNeedsRebuild=!1,this.hasPlayedOnce=!1,this.onTimelineChangeComplete=()=>{var e;"normal"!==this.data.tweens[0].data.direction&&(this.toggleIsForward=!this.toggleIsForward),!1!==this.timelineNeedsRebuild&&(null!==(e=this.timeline)&&void 0!==e&&e.pause(),this.buildTimeline({isForward:this.toggleIsForward,needsRebuild:!1,isRebuild:!0}),this.timeline.play())},!t.object)throw new Error("Missing property");let l=null!==(s=null!==(a=this.page.scene.find(t.object))&&void 0!==a?a:null===(o=this.page.uiCanvas)||void 0===o?void 0:o.find(t.object))&&void 0!==s?s:this.page.scene.find2DInUIObjects(t.object);if(!l)throw new Error("Missing property");if(!l.states)throw new Error("Missing property");if(this.object=l,t.tweens.length<2)throw new Error("Missing property");this.tweens=Array(this.data.tweens.length-1),this.startOnceDelay="start-once"===t.tweens[0].data.delayDirection?t.tweens[0].data.delay:0,this.init()}get playing(){var e;return!1===(null===(e=this.timeline)||void 0===e?void 0:e.paused)}get changeBegan(){var e;return null!==(e=this.tweens.some((e=>e.changeBegan)))&&void 0!==e&&e}init(){this.initialCurrentState=$N(this.object,this.object.currentState).id,this.toggleIsForward=!1}get currentState(){return"Toggle"===this.data.runMode&&Sy(this.eventType)?this.initialCurrentState:this.object.currentState}buildTimeline(){var e;let{isForward:t=!0,needsRebuild:n=!1,isRebuild:i=!1}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{var r;let e=YN(this.data.tweens[0].data);i&&"number"==typeof e.loop&&e.loop--,null!==(r=this.timeline)&&void 0!==r&&r.pause(),this.timeline=fN.timeline(o(o({autoplay:!1},e),!0===e.loop||e.loop>1?{timelineChangeComplete:this.onTimelineChangeComplete}:{}));let h=this.tweens.findIndex((e=>null===e||void 0===e?void 0:e.changeBegan));if(!0===n&&(this.timelineNeedsRebuild=!0),t){let t=-1===h?0:h;for(let n=t;n<this.data.tweens.length-1;n++){var s,a;let i,r=this.data.tweens[n],o=this.data.tweens[n+1];n!==t||!0!==this.object.wasMovedByUser&&!0!==(null===(s=this.object.previousAction)||void 0===s?void 0:s.changeBegan)?i=void 0===r.data.state?this.currentState:r.data.state:(i=void 0,this.object instanceof jO&&(this.object.wasMovedByUser=!1));let l=new ZN(this.object,i,void 0===o.data.state?this.currentState:o.data.state,o.data,this.shared,null!==(a=this.data.allowSlerp)&&void 0!==a&&a);-1!==h&&n===t&&Object.assign(l.params,{startOnceDelay:0}),this.tweens[n]=l,this.timeline.add(l.params,this.timeline.duration+(n===t?e.delay:0))}this.timeline.duration+=e.endDelay}else{let t=-1===h?this.data.tweens.length-1:h+1;for(let n=t;n>0;n--){var l,c;let i,r=this.data.tweens[n],s=this.data.tweens[n-1];n!==t||!0!==this.object.wasMovedByUser&&!0!==(null===(l=this.object.previousAction)||void 0===l?void 0:l.changeBegan)?i=void 0===r.data.state?this.currentState:r.data.state:(i=void 0,this.object instanceof jO&&(this.object.wasMovedByUser=!1));let a=new ZN(this.object,i,void 0===s.data.state?this.currentState:s.data.state,r.data,this.shared,null!==(c=this.data.allowSlerp)&&void 0!==c&&c);-1!==h&&n===t&&Object.assign(a.params,{startOnceDelay:0}),this.tweens[n-1]=a,this.timeline.add(a.params,this.timeline.duration+(n===t?e.endDelay:0))}this.timeline.duration+=e.delay}}catch(FZ){FZ instanceof Error&&console.error(FZ.message)}!0===(null===(e=this.object.previousAction)||void 0===e?void 0:e.playing)&&this.object.previousAction.pause(),this.object.previousAction=this}play(){if(!1===uF(this.shared,this.condition)||Sy(this.eventType)&&"Once"===this.data.runMode&&this.hasPlayedOnce||(this.hasPlayedOnce=!0,this.playing))return!1;clearTimeout(this.timeoutId);let e=YN(this.data.tweens[0].data).pingPongDelayCorrection;this.timeoutId=window.setTimeout((()=>{try{this.buildTimeline(),this.timeline.play()}catch(zZ){zZ instanceof Error&&console.error(zZ.message)}}),this.startOnceDelay+e)}pause(){var e;null!==(e=this.timeline)&&void 0!==e&&e.pause(),clearTimeout(this.timeoutId),this.tweens=Array(this.data.tweens.length-1),delete this.timeoutId}stop(){this.pause();let e=void 0===this.data.tweens[0].data.state?this.initialCurrentState:this.data.tweens[0].data.state;this.object instanceof vk?this.object.changeSelectedState(e,{shared:this.shared}):this.object.changeSelectedState(e,{scene:this.page.scene,shared:this.shared}),this.object.currentState=e}seek(e){var t;if(!1===uF(this.shared,this.condition))return!1;void 0===this.timeline&&this.buildTimeline(),null===(t=this.timeline)||void 0===t||t.seek(e*this.timeline.duration,!0)}toggle(e){var t;if(!1===uF(this.shared,this.condition))return!1;clearTimeout(this.timeoutId),this.toggleIsForward=null!==e&&void 0!==e?e:!this.toggleIsForward,this.playing?(null!==(t=this.timeline)&&void 0!==t&&t.pause(),this.buildTimeline({isForward:this.toggleIsForward,needsRebuild:!0}),this.timeline.play()):this.timeoutId=window.setTimeout((()=>{var e;null!==(e=this.timeline)&&void 0!==e&&e.pause(),this.buildTimeline({isForward:this.toggleIsForward}),this.timeline.play()}),this.startOnceDelay)}playFromCurrent(){this.toggle(!0)}reverseFromCurrent(){this.toggle(!1)}dispose(){this.pause()}};function $N(e,t){var n;let i,r;if("string"==typeof t?(i=t,r=null===(n=e.states)||void 0===n?void 0:n[i]):null===t&&(i=null,r=e.data),void 0!==i&&void 0!==r)return{id:i,data:r}}var eF={type:"beginState"},tF={type:"completeState",isfromEntity:!1},nF={type:"requestRender"},iF=class extends qe{constructor(e,t,n,i){super(),this.data=e,this.page=t,this.shared=n,this.condition=i,this.toggleIsForward=!1,this.posStart=new Bt,this.posEnd=new Bt,this.qStart=new Lt,this.qEnd=new Lt,this.zoomStart=1,this.zoomEnd=1}init(){}get playing(){return this.animation&&this.animation.began&&!this.animation.completed}buildAnimation(){if(!this.data.animate)return;let e=this.page.scene.find(this.data.targetCamera);if(!e||!e.visible)throw new ReferenceError("Target camera not founded or not visible");let t={t:0};this.posStart.copy(this.page.activeCamera.position),this.qStart.copy(this.page.activeCamera.quaternion),this.zoomStart=this.page.activeCamera.zoom,this.animation=fN(o(o({targets:t,t:1},XN(this.data)),{},{update:()=>{0===t.t&&("Toggle"!==this.data.runMode||this.toggleIsForward?(this.posEnd.copy(e.position),this.qEnd.copy(e.quaternion),this.zoomEnd=e.zoom,this.fromCamera=this.page.activeCamera,this.switchCamera(e.uuid)):this.fromCamera&&(this.posEnd.copy(this.fromCamera.position),this.qEnd.copy(this.fromCamera.quaternion),this.zoomEnd=this.fromCamera.zoom,this.switchCamera(this.fromCamera.uuid)),this.page.activeCamera.dispatchEvent(eF));let n=this.page.activeCamera;n.position.lerpVectors(this.posStart,this.posEnd,t.t),n.quaternion.slerpQuaternions(this.qStart,this.qEnd,t.t),n.zoom=this.zoomStart+(this.zoomEnd-this.zoomStart)*t.t,n.wasMovedBySwitchCameraAction=!0,n.updateMatrix(),n.updateMatrixWorld(),n.updateProjectionMatrix(),n.dispatchEvent(nF),1===t.t&&n.dispatchEvent(tF)}}))}switchCamera(e){let t=this.page.activeCamera,n=this.page.scene.find(e);if(!n||!n.visible)throw new ReferenceError("Target camera not founded or not visible");this.page.switchActiveCamera(n),t.dispatchEvent({type:"cameraChange",camera:n})}play(){if(!1===uF(this.shared,this.condition))return!1;if(!this.playing&&this.page.activeCamera.uuid!==this.data.targetCamera)try{clearTimeout(this.timeoutId),this.timeoutId=window.setTimeout((()=>{var e;delete this.timeoutId,this.data.animate?(this.buildAnimation(),null===(e=this.animation)||void 0===e||e.play()):this.switchCamera(this.data.targetCamera)}),1e3*this.data.delay)}catch(e){}}pause(){var e;null!==(e=this.animation)&&void 0!==e&&e.pause(),clearTimeout(this.timeoutId),delete this.timeoutId}toggle(e){if(!1===uF(this.shared,this.condition))return!1;if(window.clearTimeout(this.timeoutId),delete this.timeoutId,e!==this.toggleIsForward)try{var t,n;this.playing?(null!==(t=this.animation)&&void 0!==t&&t.pause(),this.toggleIsForward=null!==e&&void 0!==e?e:!this.toggleIsForward,this.buildAnimation(!0),null===(n=this.animation)||void 0===n||n.play()):this.timeoutId=window.setTimeout((()=>{var t,n;this.toggleIsForward=null!==e&&void 0!==e?e:!this.toggleIsForward,this.data.animate?(null!==(t=this.animation)&&void 0!==t&&t.pause(),this.buildAnimation(),null===(n=this.animation)||void 0===n||n.play()):(this.toggleIsForward?(this.fromCamera=this.page.activeCamera,this.switchCamera(this.data.targetCamera)):this.fromCamera&&this.switchCamera(this.fromCamera.uuid),this.page.activeCamera.dispatchEvent(tF),this.page.activeCamera.dispatchEvent(nF))}),1e3*this.data.delay)}catch(i){}}playFromCurrent(){this.toggle(!0)}reverseFromCurrent(){this.toggle(!1)}dispose(){this.pause(),this.toggleIsForward=!1}};function rF(e){let t=null===e||void 0===e?void 0:e.tracks.filter((e=>"vector"===e.ValueTypeName||"quaternion"===e.ValueTypeName)).map((e=>e.times.length));if(null!==t&&void 0!==t&&t.length){let e=gm(t);return e&&e>2?e:2}return 2}var sF=class extends qe{constructor(e,t,n,i,r){var s,a;super(),this.data=e,this.page=t,this.animationControls=n,this.shared=i,this.condition=r,this.startOnceDelay=0,this.toggleIsForward=!1;let l=e.object,c=t.scene.find(e.object);c&&Array.isArray(c.identity)&&(l=c.identity[0]),this.data=o(o({},e),{},{object:l});let h=this.animationControls.clipIdToAction[e.clipId+"/"+l];if(this.duration=null!==(s=null===h||void 0===h||null===(a=h.getClip())||void 0===a?void 0:a.duration)&&void 0!==s?s:1,this.data.crop2){let e=rF(null===h||void 0===h?void 0:h.getClip());this.leftFrameTime=this.data.crop2[0]/(e-1)*this.duration,this.rightFrameTime=this.data.crop2[1]/(e-1)*this.duration}else{var u;let e=null===h||void 0===h||null===(u=h.getClip())||void 0===u||null===(u=u.tracks[0])||void 0===u?void 0:u.times.length;e&&e>1?(this.leftFrameTime=this.data.crop[0]/e*this.duration,this.rightFrameTime=this.data.crop[1]/e*this.duration):(this.leftFrameTime=0,this.rightFrameTime=this.duration)}this.startOnceDelay=e.delay}get playing(){var e,t;return null!==(e=null===(t=this.threeAnimAction)||void 0===t?void 0:t.isRunning())&&void 0!==e&&e}play(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!1===uF(this.shared,this.condition))return!1;window.clearTimeout(this.timeoutId),this.timeoutId=window.setTimeout((()=>{var t;if(this.threeAnimAction=this.animationControls.play(this.data),!this.threeAnimAction)return;this.threeAnimAction.reset(),this.threeAnimAction.time=this.leftFrameTime,this.threeAnimAction._clip.start=this.leftFrameTime,this.threeAnimAction._clip.duration=this.rightFrameTime;let n=this.data.object;Object.entries(this.animationControls.clipIdToAction).forEach((t=>{let[i,r]=t,s=i.split("/")[1];this.threeAnimAction!==r&&s===n&&r.isRunning()&&(e?r.fadeOut(.2):r.stop())})),e&&(null===(t=this.threeAnimAction)||void 0===t||t.fadeIn(.2))}),this.startOnceDelay)}pause(){this.threeAnimAction&&(this.threeAnimAction.paused=!0),window.clearTimeout(this.timeoutId),delete this.timeoutId}stop(){var e;null===(e=this.threeAnimAction)||void 0===e||e.fadeOut(.2)}seek(e){this.threeAnimAction=this.animationControls.play(this.data),this.threeAnimAction&&(this.threeAnimAction.paused=!0,this.threeAnimAction.time=at.clamp(this.threeAnimAction.time+1/60*e,this.leftFrameTime,this.rightFrameTime-16e-5),this.animationControls.needsUpdate=!0,this.animationControls.requestRender())}toggle(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!1===uF(this.shared,this.condition))return!1;this.toggleIsForward=null!==e&&void 0!==e?e:!this.toggleIsForward,this.threeAnimAction&&(this.threeAnimAction._loopCount=0),this.playing?this.threeAnimAction&&(this.threeAnimAction.timeScale=this.toggleIsForward?1:-1,this.toggleIsForward?(this.threeAnimAction._clip.start=this.leftFrameTime,this.threeAnimAction._clip.duration=this.rightFrameTime):(this.threeAnimAction._clip.start=this.rightFrameTime,this.threeAnimAction._clip.duration=this.leftFrameTime)):this.timeoutId=window.setTimeout((()=>{if(this.threeAnimAction=this.animationControls.play(this.data),this.threeAnimAction){var e;this.toggleIsForward?(this.threeAnimAction.time=this.leftFrameTime,this.threeAnimAction._clip.start=this.leftFrameTime,this.threeAnimAction._clip.duration=this.rightFrameTime):(this.threeAnimAction.time=this.rightFrameTime,this.threeAnimAction._clip.start=this.rightFrameTime,this.threeAnimAction._clip.duration=this.leftFrameTime),this.threeAnimAction.paused=!1,this.threeAnimAction.timeScale=this.toggleIsForward?1:-1;let n=this.data.clipId.split("/")[1];Object.entries(this.animationControls.clipIdToAction).forEach((e=>{let[i,r]=e,s=i.split("/")[1];this.threeAnimAction!==r&&s===n&&r.isRunning()&&(t?r.fadeOut(.2):r.stop())})),t&&(null===(e=this.threeAnimAction)||void 0===e||e.fadeIn(.2))}}),this.startOnceDelay)}playFromCurrent(){this.toggle(!0)}reverseFromCurrent(){this.toggle(!1)}dispose(){var e;let t=null===(e=this.animationControls.clipIdToAction[this.data.clipId+"/"+this.data.object])||void 0===e?void 0:e.getClip();t&&(t.duration=this.duration),this.pause()}},aF=class{constructor(e,t,n,i,r){this.data=e,this.page=t,this.eventManager=n,this.shared=i,this.condition=r,this.timeOutId=-1,this.scene=t.scene}dispatch(){if(!1===uF(this.shared,this.condition))return!1;this.data.target!==this.page.uuid&&(window.clearTimeout(this.timeOutId),this.timeOutId=window.setTimeout((()=>{this.play()}),1e3*this.data.delay))}dispose(){window.clearTimeout(this.timeOutId)}play(){if(this.scene.children.every((e=>e.uuid!==this.data.target||e.data.uiScene)))return;"fade"===this.data.transition&&this.data.duration>0&&this.eventManager.eventContext.renderer.renderFromSceneForSceneTransitionPass(this.scene,this.scene.activeCamera,1e3*this.data.duration),this.eventManager.deactivate(),this.eventManager.controlsManager.deactivate();let e=this.scene.activeCamera;this.scene.updatePage(this.data.target),this.scene.traverseVisibleEntity((e=>{"ParticleSystem"===e.type&&(e.sleep(),e.wakeUp(),e.data.autoPlay?e.start():e.stop())})),this.scene.activePage.switchToPlayCamera(),this.scene.activeCamera.copyViewPlaneSize(e),HN(this.scene.activePage,this.shared),this.eventManager.activate(),this.eventManager.controlsManager.activate(this.eventManager)}},oF=class{constructor(e,t,n,i){this.data=e,this.page=t,this.shared=n,this.condition=i,this.evaluatedCondition=!1}checkConditions(){this.evaluatedCondition=uF(this.shared,this.condition)}dispatch(){if(!1===this.evaluatedCondition)return!1;let e=this.shared.getVariable(this.data.variableId),t=UA(this.data.expression,this.shared,yx.typeOfVariable(e));void 0!==t&&this.shared.updateVariable(this.data.variableId,"string"==typeof t?{textValue:t}:t)}dispose(){}},lF=class{constructor(e,t,n,i){this.data=e,this.page=t,this.shared=n,this.condition=i,this.timeoutId=null}dispatchInner(){if(!1===uF(this.shared,this.condition))return!1;let e=this.shared.getDynamicVariablePlayState(this.data.variableId);if("PlayPause"===this.data.mode)void 0===this.shared.getDynamicVariableToggleIsForward(this.data.variableId)&&this.shared.setDynamicVariableToggleIsForward(this.data.variableId,!0),this.shared.setDynamicVariablePlayState(this.data.variableId,"Playing"===e?"Paused":"Playing");else if("Play"===this.data.mode&&"Playing"!==e)void 0===this.shared.getDynamicVariableToggleIsForward(this.data.variableId)&&this.shared.setDynamicVariableToggleIsForward(this.data.variableId,!0),this.shared.setDynamicVariablePlayState(this.data.variableId,"Playing");else if("Stop"===this.data.mode&&"Stopped"!==e)this.shared.setDynamicVariablePlayState(this.data.variableId,"Stopped");else if("Pause"===this.data.mode&&"Paused"!==e)this.shared.setDynamicVariablePlayState(this.data.variableId,"Paused");else if("Restart"===this.data.mode)this.shared.setDynamicVariablePlayState(this.data.variableId,"Restarted");else if("Toggle"===this.data.mode){let t=this.shared.getDynamicVariableToggleIsForward(this.data.variableId);"Playing"===e?this.shared.setDynamicVariableToggleIsForward(this.data.variableId,void 0!==t&&!t):(this.shared.setDynamicVariableToggleIsForward(this.data.variableId,!t),this.shared.setDynamicVariablePlayState(this.data.variableId,"Playing"))}}dispatch(){let e=this.data.delay,t=this.shared.getDynamicVariablePlayState(this.data.variableId);"PlayPause"===this.data.mode&&"Playing"===t&&(e=this.data.pauseDelay),0!==e?(this.timeoutId&&window.clearTimeout(this.timeoutId),this.timeoutId=window.setTimeout((()=>{this.timeoutId=null,this.dispatchInner()}),e)):this.dispatchInner()}dispose(){this.timeoutId&&window.clearTimeout(this.timeoutId)}},cF=class{constructor(e,t,n,i){this.data=e,this.page=t,this.shared=n,this.condition=i}dispatch(){if(!1===uF(this.shared,this.condition))return!1;("single"===this.data.target?this.data.variableId?[this.data.variableId]:[]:Object.keys(this.shared.getVariables())).forEach((e=>{var t;this.shared.getVariable(e);let n=null===(t=this.shared.data.variables.data(e))||void 0===t?void 0:t.value;void 0!==n&&this.shared.updateVariable(e,n),this.shared.enableLocalStorageForPersistentVariables&&localStorage.removeItem(ED(e))}))}dispose(){}},hF=class{constructor(e,t,n,i){this.data=e,this.page=t,this.shared=n,this.condition=i}dispatch(){var e;if(!1===uF(this.shared,this.condition))return!1;this.data.userAPIId&&(null===(e=this.shared.getUserAPI(this.data.userAPIId))||void 0===e||e.callUserAPI(this.shared))}dispose(){}};function uF(e,t){if(void 0===t)return!0;if(0===t.expression.length)return!1;let n=UA(t.expression,e,"boolean");return t.negate?!n:!!n}function dF(e,t,n,i,r,s){let a={Audio:[],Video:[],Particles:[],Link:[],Destroy:[],Create:[],Reset:[],Transition:[],SwitchCamera:[],Animation:[],SceneTransition:[],SetVariable:[],DynamicVariablePlay:[],ClearLocalStorage:[],UserAPI:[]},o=t=>l=>{let{id:c,data:h}=l;try{"Audio"===h.type?Vy[e.type].includes("Audio")&&a.Audio.push(new sz(c,h,s,i,t)):"Video"!==h.type||s instanceof vk?"Particles"===h.type?Vy[e.type].includes("Particles")&&a.Particles.push(new az(h,n,i,t)):"Link"===h.type?Vy[e.type].includes("Link")&&a.Link.push(new cz(h,r.controlsManager,i,t)):"Create"===h.type?Vy[e.type].includes("Create")&&a.Create.push(new EF(h,n,r.controlsManager,i,t)):"Destroy"===h.type?Vy[e.type].includes("Destroy")&&a.Destroy.push(new hz(h,n,r.controlsManager,i,t)):"Reset"===h.type?Vy[e.type].includes("Reset")&&a.Reset.push(new uz(h,n,i,r,t)):"Transition"===h.type?Vy[e.type].includes("Transition")&&a.Transition.push(new JN(e.type,h,n,i,t)):"SwitchCamera"===h.type?Vy[e.type].includes("SwitchCamera")&&a.SwitchCamera.push(new iF(h,n,i,t)):"SceneTransition"===h.type?Vy[e.type].includes("SceneTransition")&&a.SceneTransition.push(new aF(h,n,r,i,t)):"Animation"===h.type?Vy[e.type].includes("Animation")&&a.Animation.push(new sF(h,n,r.animationControls,i,t)):"SetVariable"===h.type?Vy[e.type].includes("SetVariable")&&a.SetVariable.push(new oF(h,n,i,t)):"DynamicVariablePlay"===h.type?Vy[e.type].includes("DynamicVariablePlay")&&a.DynamicVariablePlay.push(new lF(h,n,i,t)):"Conditional"===h.type?Vy[e.type].includes("Conditional")&&(h.ifActions.forEach(o({expression:h.condition,negate:!1})),h.elseActions.forEach(o({expression:h.condition,negate:!0}))):"ClearLocalStorage"===h.type?Vy[e.type].includes("ClearLocalStorage")&&a.ClearLocalStorage.push(new cF(h,n,i,t)):"UserAPI"===h.type&&Vy[e.type].includes("UserAPI")&&a.UserAPI.push(new hF(h,n,i,t)):Vy[e.type].includes("Video")&&a.Video.push(new yF(c,h,s,i,t))}catch(GZ){}};return t.forEach(o()),a}function pF(e){Object.values(e).forEach((e=>{e.forEach((e=>{(e instanceof sz||e instanceof yF||e instanceof az||e instanceof sF||e instanceof JN||e instanceof EF||e instanceof hz||e instanceof iF||e instanceof aF||e instanceof uz||e instanceof oF||e instanceof lF)&&e.dispose()}))}))}var fF=new Map,mF=new Map,gF=class{constructor(e,t,n){this.data=t,this.delay=0,this.status="stopped";let{layerId:i,loop:r,volume:s,delay:a}=t;if(this.object=n,void 0===i)throw new Error("Missing property");let o=function(e,t){let n;if("material"in e){let i=e.material;n=Array.isArray(i)?e.material[0].layers.find((e=>e.uuid===t)):e.material.layers.find((e=>e.uuid===t))}if(n)return n.color.texture.image.img instanceof HTMLVideoElement?n.color.texture.image.img:void 0}(n,i);o&&(this.videoElement=o,this.videoElement.loop=r===1/0,Om&&(this.videoElement.autoplay=!0),void 0!==s&&(this.videoElement.volume=s)),void 0!==a&&(this.delay=a),mF.has(n.uuid)?mF.get(n.uuid).push(this):mF.set(n.uuid,[this]),fF.set(e,this),this.pause()}mute(){!this.videoElement||(this.videoElement.muted=!0)}unMute(){!this.videoElement||(this.videoElement.muted=!1)}play(e){if(!this.videoElement)return;let t=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);e?(this.mute(),this.delay+=150):t?(this.mute(),window.setTimeout((()=>{this.unMute()}),100)):this.unMute(),this.delayTimerId=window.setTimeout((()=>{if(!this.videoElement)return;let e=this.videoElement.play();void 0!==e&&e.then((e=>{})).catch((e=>{this.play()})),this.clearDelay()}),this.delay),this.status="playing"}clearDelay(){this.delayTimerId&&(clearTimeout(this.delayTimerId),delete this.delayTimerId)}pause(){!this.videoElement||(this.videoElement.pause(),this.status="paused")}stop(){!this.videoElement||(this.videoElement.pause(),this.videoElement.currentTime=0,this.status="stopped",this.clearDelay())}playByToggle(){"stop"===this.data.toggle?"playing"===this.status?this.stop():(this.stop(),this.play()):"pause"===this.data.toggle?"playing"===this.status?this.pause():this.play():(this.stop(),this.play())}dispose(){!this.videoElement||(this.stop(),this.videoElement.muted=!0)}},vF=class{constructor(e){this.data=e}dispatch(){this.data.playVideo?this.pauseVideo(this.data.playVideo):this.data.object?this.pauseAllVideosFromObject(this.data.object):this.pauseAllVideos()}pauseVideo(e){let t=fF.get(e);!t||(this.data.delay>0?(this.disposeDelay(),this.timeoutId=window.setTimeout((()=>{t[this.data.interaction](),this.disposeDelay()}),this.data.delay)):t[this.data.interaction]())}pauseAllVideosFromObject(e){let t=mF.get(e);null===t||void 0===t||!t.length||(this.data.delay>0?(this.disposeDelay(),this.timeoutId=window.setTimeout((()=>{t.forEach((e=>e[this.data.interaction]())),this.disposeDelay()}),this.data.delay)):t.forEach((e=>e[this.data.interaction]())))}pauseAllVideos(){let e=[...mF.values()];!e.length||(this.data.delay>0?(this.disposeDelay(),this.timeoutId=window.setTimeout((()=>{e.forEach((e=>{e.forEach((e=>{e[this.data.interaction]()}))})),this.disposeDelay()}),this.data.delay)):e.forEach((e=>{e.forEach((e=>{e[this.data.interaction]()}))})))}disposeDelay(){clearTimeout(this.timeoutId),delete this.timeoutId}dispose(){clearTimeout(this.timeoutId),delete this.timeoutId}},yF=class{constructor(e,t,n,i,r){if(this.data=t,this.shared=i,this.condition=r,"play"===t.interaction)this.interaction=new gF(e,t,n);else{if("pause"!==t.interaction&&"stop"!==t.interaction)throw new Error("Missing property");this.interaction=new vF(t)}}dispatchBasic(){if(!1===uF(this.shared,this.condition))return!1;this.interaction instanceof gF?this.interaction.playByToggle():this.interaction.dispatch()}dispatchConditional(){if(!1===uF(this.shared,this.condition))return!1;this.interaction instanceof gF?this.interaction.play():this.interaction.dispatch()}dispose(){this.interaction.dispose()}},bF=(()=>{let e,t,n,i;function r(n){var r;!e&&!xF()&&(null===(r=t)||void 0===r?void 0:r.sharedGameControlGlobals.createdObjects.length)>0&&(e=requestAnimationFrame(s)),n&&(t=n,i=n.requestRender)}function s(r){let a=n?r-n:0,o=t.sharedGameControlGlobals.createdObjects,l=t.sharedGameControlGlobals.nCreatedPerAction,c=o.length,h=0;for(;h<c;){let e=o[h];void 0===e.userData.createdTime&&(e.userData.createdTime=r),void 0===e.userData.lifetime&&void 0===e.userData.quantity||e.userData.lifetime&&r-e.userData.createdTime<e.userData.lifetime||e.userData.quantity&&l[e.userData.actionId]<=e.userData.quantity?(e.userData.velocity&&(e.position.addScaledVector(e.userData.velocity,a/1e3),e.updateMatrix(),i()),h++):(l[e.userData.actionId]>e.userData.quantity&&l[e.userData.actionId]--,o.splice(h,1),e.removeFromParent(),t.sharedGameControlGlobals.rapierWorld&&e.rigidBody?(t.sharedGameControlGlobals.colliderToEntity.delete(e.rigidBody.collider(0).handle),t.sharedGameControlGlobals.rapierWorld.removeRigidBody(e.rigidBody)):(e.bvhGeometry=void 0,t.sharedGameControlGlobals.entitiesWithTransformAnim=t.sharedGameControlGlobals.entitiesWithTransformAnim.filter((e=>void 0!==e.bvhGeometry))),c--,i())}e=h>0?requestAnimationFrame(s):void 0,n=h>0?r:void 0}return typeof document<"u"&&document.addEventListener("visibilitychange",(function(){xF()?e&&(cancelAnimationFrame(e),e=void 0,n=void 0):r()})),r})();function xF(){return!!document&&document.hidden}var wF=new Lt,SF=new Bt,_F=new Bt,EF=class{constructor(e,t,n,i,r){this.data=e,this.page=t,this.controlsManager=n,this.shared=i,this.condition=r,this.intervalId=null,this.timeoutIdQueue=[],this.uniqueId=at.generateUUID(),this.dispatch=()=>{if(!1===uF(this.shared,this.condition))return!1;this.data.delay?this.timeoutIdQueue.push(window.setTimeout(this.dispatchInner,1e3*this.data.delay)):this.dispatchInner()},this.dispatchFromStart=()=>{if(!1===uF(this.shared,this.condition))return!1;this.timeoutIdQueue.push(window.setTimeout(this.dispatchInner,1e3*this.data.delay))},this.dispatchThrottled=Cm(this.dispatch,1e3/this.data.creationSpeed),this.dispatchStart=()=>{null===this.intervalId&&(this.intervalId=window.setInterval(this.dispatch,1e3/this.data.creationSpeed))},this.dispatchStop=()=>{null!==this.intervalId&&(window.clearInterval(this.intervalId),this.intervalId=null)},this.dispatchInner=()=>{this.timeoutIdQueue.shift();let e=new KS(this.object);if(e.playModeVisible=!0,e.expand(),"world"!==this.data.coordinateSystem){let t=this.data.coordinateSystem,n=this.page.scene.find(t);n&&(n.updateMatrixWorldSVD(),e.hiddenMatrix.copy(n.matrixWorldRigid))}e.scale.copy(this.object.scale),e.position.fromArray(this.data.position),e.rotation.fromArray(this.data.rotation),e.updateMatrix(),this.page.add(e);let t=this.controlsManager.sharedGameControlGlobals;t.createdObjects.push(e),void 0===t.nCreatedPerAction[this.uniqueId]?t.nCreatedPerAction[this.uniqueId]=1:t.nCreatedPerAction[this.uniqueId]++,e.updateWorldMatrix(!0,!0),e.traverseObject(this.traverseObjectCB),bF(),this.controlsManager.requestRender()},this.traverseObjectCB=e=>{var t,n,i;let r;if(e.hasNonUniformScale&&e.updateMatrixWorldSVD(),this.controlsManager.sharedGameControlGlobals.rapierWorld){var s;if(e instanceof SO){if(!e.objectForSample)return!0===e.object.dataPatched.physics.fusedBody&&"dynamic"===e.object.dataPatched.physics.rigidBody||void 0;if(e.objectForSample.dataPatched.physics.fusedBody)return;r=e.object}else if(e instanceof KS)r=e.object;else if(r=e,null!==(s=r.dataPatched.cloner)&&void 0!==s&&s.hideBase)return!0}else{if(e instanceof SO)return;r=e instanceof KS?e.object:e}"Time"===this.data.destroy?e.userData.lifetime=1e3*this.data.lifetime:"Quantity"===this.data.destroy&&(e.userData.quantity=this.data.destroyAfterQuantity,e.userData.actionId=this.uniqueId);let a=(new Bt).fromArray(this.data.velocity),o=r.dataPatched;if(!("visibility"===o.physics.enabled?!o.visible:!o.physics.enabled)&&(this.controlsManager.sharedGameControlGlobals.rapierWorld?(this.controlsManager.addRigidBody(e,r,{fromCreate:!0,dynamic:this.data.dynamic}),"Collision"===this.data.destroy&&(null!==(t=e.rigidBody)&&void 0!==t&&t.collider(0).setActiveEvents(1),e.userData.hasCollisionDestroy=!0),e.matrixWorld.decompose(SF,wF,_F),a.applyQuaternion(wF),this.data.velocity.some((e=>0!==e))&&this.data.dynamic&&(null===(n=e.rigidBody)||void 0===n||n.setLinvel(a.divideScalar(this.controlsManager.pixelsPerMeter),!0))):("geometry"in e.object&&this.controlsManager.addBoundsTree(e),this.data.velocity.some((e=>0!==e))&&this.data.dynamic&&(e.userData.velocity=a)),!0===(null===(i=r.dataPatched.physics)||void 0===i?void 0:i.fusedBody)))return!0};let s=this.page.scene.find(this.data.object);if(!s)throw new Error("Missing Property");if(this.object=s,"world"!==this.data.coordinateSystem&&!this.page.scene.find(this.data.coordinateSystem))throw new Error("Missing Property");bF(n)}dispose(){null!==this.intervalId&&(window.clearInterval(this.intervalId),this.intervalId=null),this.timeoutIdQueue.forEach((e=>window.clearTimeout(e))),this.dispatchThrottled.cancel(),this.page.remove(...this.controlsManager.sharedGameControlGlobals.createdObjects),this.controlsManager.sharedGameControlGlobals.createdObjects=[]}},AF=.02,CF=(new Bt,new Bt),MF=new Bt,TF=new Bt,PF=new Bt,DF=new Bt,OF=new Bt,IF=new pn,RF=new pn,kF=new pn,LF=(new pn,new Lt),BF=new Lt,zF=new _n(0,0,0,"YXZ"),NF=new Bt(1,0,0),FF=new Bt(0,1,0),UF=new Bt(0,0,1),jF=new Bt(1,1,1),VF=(new rn,new _c),GF=new Ft,HF={type:"requestRender"},WF={type:"updateMatrix"},qF=Math.PI/6,XF=class extends qe{constructor(e,t,n,i,r,s,a,l,c){var h,u,d,p,f,m,g,v,y,b,x,w,S,_,E,A,C,M,T;super(),this.object=e,this.domElement=t,this.data=n,this.gloabalPhysics=i,this.controlsManager=r,this.cameraFollow=s,this.camera=a,this.page=l,this.sharedAssets=c,this.enableDamping=!0,this.hiddenMatrix0=new pn,this.target0=new Bt,this.zoom0=1,this.rotForce=1,this.moveForce=1,this.pixelsPerMeter=200,this.euler0=new _n(0,0,0,"YXZ"),this.position0Cam=new Bt,this.quat0Cam=new Lt,this.scale0Cam=new Bt,this.hiddenMatrix0Cam=new pn,this.threshEndTranslate=.01,this.threshEndRotate=1e-8,this.threshEndRotVel=.005,this.collider={type:"capsule",radius:40,segment:new _c(new Bt(0,-40,0),new Bt(0,40,0)),matrix:new pn,position:new Bt,rotation:new Lt},this.euler=new _n(0,0,0,"YXZ"),this.eulerDelta=new Bt,this.lastPosition=new Bt,this.lastCameraQuaternion=new Lt,this.lastCameraPosition=new Bt,this.PI_2=Math.PI/2,this.prevMouse=new ot,this.velocityTarget=new Bt,this.velocity=new Bt,this.directionXZ=new Bt,this.rotVelocityStick=new Bt,this.rotVelocityTarget=new Bt,this.rotVelocity=new Bt,this.rotDirection=new Bt,this.nonColliderRotOffset=new pn,this.nonColliderPosOffset=new pn,this.firstPointerId=-1,this.rot=new Bt,this.path=[],this.movementState={moveNegZ:0,movePosZ:0,moveNegX:0,movePosX:0,moveNegY:0,movePosY:0,rotPosX:0,rotNegX:0,rotPosY:0,rotNegY:0,jump:0,run:0},this.vrEulerYOffset=0,this.onObject=!1,this.actionState={},this.keyAssignments=[["moveNegZ","W"],["moveNegX","A"],["movePosZ","S"],["movePosX","D"],["rotPosX","ArrowUp"],["rotPosY","ArrowLeft"],["rotNegX","ArrowDown"],["rotNegY","ArrowRight"],["jump"," "]],this.collisionEnabled=!0,this.offsetMatrix=new pn,this.objectToTarget=new Bt,this.objectToTarget0=new Bt,this.objectToCamXZ=new Bt,this.objectToCamXZ0=new Bt,this.targetToCamera=new Bt,this.targetToCamera0=new Bt,this.cameraPolarAxis0=new Bt,this.targetPos=new Bt,this.targetQuat=new Lt,this.lerpFactorPos=(new Bt).setScalar(.3),this.lerpFactorPosStart=.3,this.lerpFactorPosEnd=.3,this.lerpFactorRotStart=.3,this.lerpFactorRotEnd=.3,this.lerpFactorPosCamera=.3,this.lerpFactorRotCamera=.3,this.objXZQuat=new Lt,this.objXZQuatInv=new Lt,this.objXZRotMat=new pn,this.isFirstPerson=!1,this.didHit=!1,this.groundVelocity=new Bt,this.pushedVelocity=new Bt,this.groundYRotation=0,this.objectRealQuat=new Lt,this.colliderWorldQuat=new Lt,this.groundNormal=new Bt,this.groundTilt=new Lt,this.groundTiltInv=new Lt,this.lastHitObj=null,this.isFirstFrame=!0,this.rotationAccumWhenOrientWithCamera=0,this.navMeshPathDest=null,this.position=new Bt,this.quaternion=new Lt,this.scale=new Bt,this.initialAction=!0,this.onPointerDown=e=>{var t;!(e.target===this.domElement||e.target instanceof HTMLElement&&"SPLINE-VIEWER"===e.target.tagName&&null!==(t=e.target.shadowRoot)&&void 0!==t&&t.contains(this.domElement))||-1!==this.firstPointerId||(this.firstPointerId=e.pointerId,this.domElement.ownerDocument.addEventListener("pointermove",this.onPointerMove),this.domElement.ownerDocument.addEventListener("pointerup",this.onPointerUp),"keys"!==this.rotBy&&!Rm&&!km&&this.domElement.requestPointerLock(),this.prevMouse.set(e.clientX,e.clientY))},this.onPointerUp=e=>{this.firstPointerId=-1,this.domElement.ownerDocument.removeEventListener("pointermove",this.onPointerMove),this.domElement.ownerDocument.removeEventListener("pointerup",this.onPointerUp),"mouse"===e.pointerType&&this.domElement.ownerDocument.exitPointerLock()},this.onPointerMove=e=>{if(e.pointerId!==this.firstPointerId)return;let t=e.clientX-this.prevMouse.x,n=e.clientY-this.prevMouse.y;this.prevMouse.set(e.clientX,e.clientY),"mouse"===e.pointerType&&"keys"!==this.rotBy&&(km&&Lm<15.5&&!Rm?(this.eulerDelta.y=-t*this.mouseOrbitSensitivity,this.eulerDelta.x=-n*this.mouseOrbitSensitivity):(this.eulerDelta.y=-e.movementX*this.mouseOrbitSensitivity,this.eulerDelta.x=-e.movementY*this.mouseOrbitSensitivity)),"mouse"!==e.pointerType&&"drag"===this.rotByTouch&&(this.eulerDelta.y=-t*this.mouseOrbitSensitivity*5,this.eulerDelta.x=-n*this.mouseOrbitSensitivity*5),this.controlsManager.requestRender()},this.onPointerlockChange=e=>{this.domElement.ownerDocument.pointerLockElement===this.domElement?XF.isLocked=!0:XF.isLocked=!1},this.onPointerlockError=()=>{console.error("SPE.GameControls: Unable to use Pointer Lock API")},this.handleVisibilityChange=()=>{var e;if(null!==(e=document)&&void 0!==e&&e.hidden)for(let t in this.movementState)this.movementState[t]=0},this.onKeyDown=e=>{!(e.target instanceof HTMLInputElement)&&("ArrowLeft"===e.code||"ArrowUp"===e.code||"ArrowRight"===e.code||"ArrowDown"===e.code||"Space"===e.code)&&e.preventDefault();for(let t of this.keyAssignments)if(e.key.toUpperCase()===t[1]||e.key===t[1]){this.movementState[t[0]]=1;break}this.controlsManager.requestRender()},this.onKeyUp=e=>{for(let t of this.keyAssignments)if(e.key.toUpperCase()===t[1]||e.key===t[1]||e.code.slice(3,e.code.length).toUpperCase()===t[1]){this.movementState[t[0]]=0;break}},this.copyVRGamePadValues=(e,t)=>{for(let n=2;n<4;n++){let i=e.axes[n];0===t?2===n?this.movementState.movePosX=i:this.movementState.movePosZ=i:(e.buttons[3].pressed?this.movementState.jump=1:this.movementState.jump=0,2===n?(Math.abs(this.movementState.rotPosY)<.3&&Math.abs(i)>=.3&&(this.vrEulerYOffset+=i<0?1:-1),this.movementState.rotPosY=i):"fly"===this.moveMode&&(this.movementState.moveNegY=i))}},this.sharedGameControlGlobals=r.sharedGameControlGlobals,e===a&&(this.isFirstPerson=!0),this.hiddenMatrix0.copy(this.object.hiddenMatrix),this.object.parent?this.object.hiddenMatrix.copy(this.object.parent.matrixWorld).invert():this.object.hiddenMatrix.identity(),this.object.matrix.copy(this.object.matrixWorld),this.object.matrix.decompose(this.position,this.quaternion,this.scale),this.euler0.setFromQuaternion(this.quaternion,"YXZ");let P=this.euler0.clone(),D=P.y;if(this.objectRealQuat.copy(this.quaternion),P.y=0,this.quaternion.setFromEuler(P),this.objXZQuat.copy(this.quaternion),this.objXZQuatInv.copy(this.objXZQuat).invert(),this.objXZRotMat.makeRotationFromQuaternion(this.quaternion),P.set(0,D,0),this.quaternion.setFromEuler(P),this.rot.setFromEuler(P),this.object.matrixAutoUpdate=!1,(this.isFirstPerson||!0===this.cameraFollow)&&(this.target0.copy(this.camera.getTarget()),this.zoom0=this.camera.zoom),!0===this.cameraFollow){var O;this.position0Cam.copy(this.camera.position),this.quat0Cam.copy(this.camera.quaternion),this.scale0Cam.copy(this.camera.scale),this.hiddenMatrix0Cam.copy(this.camera.hiddenMatrix),this.camera.parent?(this.camera.hiddenMatrix.copy(null===(O=this.camera)||void 0===O?void 0:O.parent.matrixWorld),this.camera.matrix.copy(this.camera.matrixWorld)):this.camera.hiddenMatrix.identity(),this.camera.matrix.copy(this.camera.matrixWorld),this.camera.matrix.decompose(this.camera.position,this.camera.quaternion,this.camera.scale),this.camera.matrixAutoUpdate=!1,this.offsetMatrix.copy(this.object.matrix).invert().multiply(this.camera.matrix);let e,t,n=new Bt(0,0,-1).applyQuaternion(this.camera.quaternion),i=(new Bt).subVectors(this.position,this.camera.position);this.objectToCamXZ.copy(i),this.objectToCamXZ.y=0,this.objectToCamXZ0.copy(this.objectToCamXZ),Math.abs(n.y)<1e-6?(i.y=0,n.y=0,t=i.projectOnVector(n)):t=i.y/n.y>0?n.multiplyScalar(i.y/n.y):n.multiplyScalar(i.length()),this.targetToCamera0.copy(t).negate(),e=this.camera.position.clone().add(t),this.objectToTarget0.subVectors(e,this.position);let r=(new _n).setFromQuaternion(this.camera.quaternion,"YXZ");this.cameraPolarOffset=-r.x,r.x=0,r.z=0,r.y-=Math.PI/2,this.cameraPolarAxis0.set(0,0,-1).applyEuler(r)}if(this.object instanceof jO&&(this.object.matrixAutoUpdate=!1),this.euler.setFromQuaternion(this.quaternion,"YXZ"),this.rotByTouch=null!==(h=n.rotByTouch)&&void 0!==h?h:"joystick",this.rotBy=null!==(u=n.rotBy)&&void 0!==u?u:"keys",this.rotationMode=null!==(d=n.rotationMode)&&void 0!==d?d:"normal",this.moveMode=null!==(p=n.moveMode)&&void 0!==p?p:"walk",this.collisionEnabled=n.collisionEnabled,this.speedTranslate=1*(null!==(f=n.speedTranslate)&&void 0!==f?f:250),this.speedOrbit=.025*(null!==(m=n.speedRotate)&&void 0!==m?m:100),this.mouseOrbitSensitivity=16e-6*(null!==(g=n.speedRotate)&&void 0!==g?g:100),this.keyAssignments=n.keyAssignments.map((e=>{let t=[e[0],e[1]];return"\u25b2"===t[1]?t[1]="ArrowUp":"\u25c0"===t[1]?t[1]="ArrowLeft":"\u25bc"===t[1]?t[1]="ArrowDown":"\u25b6"===t[1]?t[1]="ArrowRight":"\u21e7"===t[1]?t[1]="Shift":"\u21b5"===t[1]?t[1]="Enter":"Space"===t[1]?t[1]=" ":"\u2318"===t[1]?t[1]="Meta":"Ctrl"===t[1]?t[1]="Control":"Esc"===t[1]&&(t[1]="Escape"),t})),"mouse"===n.rotBy){let e;e=this.keyAssignments.findIndex((e=>"rotNegX"===e[0])),-1!==e&&(this.keyAssignments[e][1]=""),e=this.keyAssignments.findIndex((e=>"rotPosX"===e[0])),-1!==e&&(this.keyAssignments[e][1]=""),e=this.keyAssignments.findIndex((e=>"rotPosY"===e[0])),-1!==e&&(this.keyAssignments[e][1]=""),e=this.keyAssignments.findIndex((e=>"rotNegY"===e[0])),-1!==e&&(this.keyAssignments[e][1]="")}this.lerpFactorPosStart=1-.02**(1/(60*(null!==(v=n.delayPos[0])&&void 0!==v?v:.3))),this.lerpFactorPosEnd=1-.02**(1/(60*(null!==(y=n.delayPos[1])&&void 0!==y?y:.3))),this.lerpFactorPos.setScalar(this.lerpFactorPosStart),this.lerpFactorRotStart=1-.02**(1/(60*(null!==(b=n.delayRot[0])&&void 0!==b?b:.3))),this.lerpFactorRotEnd=1-.02**(1/(60*(null!==(x=n.delayRot[1])&&void 0!==x?x:.3))),this.lerpFactorPosCamera=1-.02**(1/(60*(null!==(w=n.delayPosCamera)&&void 0!==w?w:.3))),this.lerpFactorRotCamera=1-.02**(1/(60*(null!==(S=n.delayRotCamera)&&void 0!==S?S:.3))),this.gravity=12*(null!==(_=this.gloabalPhysics.gravity)&&void 0!==_?_:Gb.defaultData.gravity),this.usePhysics=null!==(E=this.gloabalPhysics.usePhysics)&&void 0!==E?E:Gb.defaultData.usePhysics,this.jumpPower=20*n.jumpPower,this.resetYPosition=this.position.y+Math.abs(n.resetYPosition)*(this.gravity>0?1:-1),this.alignToGround=null!==(A=n.alignToGround)&&void 0!==A&&A,this.orientMode=n.autoOrientMove?n.orientMode:"none",this.orientWith=null!==(C=n.orientWith)&&void 0!==C?C:Ax.defaultDataThirdPerson.orientWith,this.slopeThresh=65*Math.PI/180,"capsule"===n.collider.type?(this.collider.radius=n.collider.radius,this.collider.segment.start.y=n.collider.height/2-n.collider.radius,this.collider.segment.end.y=-this.collider.segment.start.y,this.offset=n.collider.height*AF/this.pixelsPerMeter,this.stepThresh=.3*n.collider.height/this.pixelsPerMeter,this.colliderHeight=n.collider.height):"sphere"===n.collider.type?(this.collider.radius=n.collider.radius,this.collider.segment.start.y=0,this.collider.segment.end.y=0,this.offset=2*n.collider.radius*AF/this.pixelsPerMeter,this.stepThresh=2*n.collider.radius*.3/this.pixelsPerMeter,this.colliderHeight=2*n.collider.radius):(this.offset=n.collider.height*AF/this.pixelsPerMeter,this.stepThresh=.3*n.collider.height/this.pixelsPerMeter,this.colliderHeight=n.collider.height),this.collider.type=n.collider.type;let I=(new Bt).fromArray(n.collider.position),R=(new Lt).setFromEuler((new _n).fromArray([...n.collider.rotation,"XYZ"]));this.collider.position.copy(I).multiply(this.scale),this.collider.rotation.copy(R),this.collider.matrix.compose(I,R,jF),void 0!==n.cameraXAxis&&(this.cameraXAxis=n.cameraXAxis,this.cameraYAxis=n.cameraYAxis,this.minPolarAngle=n.cameraRotXLimits[0],this.maxPolarAngle=n.cameraRotXLimits[1],this.minAzimuthAngleRel=n.cameraRotYLimits[0],this.maxAzimuthAngleRel=n.cameraRotYLimits[1]),this.forwardDir=null!==(M=n.forwardDirection)&&void 0!==M?M:"-z",this.isFirstPerson&&(this.forwardDir="-z"),this.runMultiplier=null!==(T=n.runMultiplier)&&void 0!==T?T:2;let k=2*n.navmesh.destinationHelperRadius;if(k>0){let e=new pg;e.push({fi:0,data:o(o({},Ab.defaultData("light","phong")),{},{alpha:0}),id:"layer1"}),e.push({fi:0,data:o(o({},Ab.defaultData("color")),{},{color:n.navmesh.destinationHelperColor,alpha:n.navmesh.destinationHelperColor.a}),id:"layer2"});let t=new _P({layers:e},{scene:this.page.scene,shared:this.sharedAssets});this.navMeshPathDest=new Ci(v_.create({parameters:{width:k,height:k/10,hollow:.7}}),t),this.navMeshPathDest.material.userData.opacity0=n.navmesh.destinationHelperColor.a}this.activate()}reset(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.object.hiddenMatrix.copy(this.hiddenMatrix0),e){this.object.updateMatrix(),this.object.updateMatrixWorld(),this.object.matrix.copy(this.object.matrixWorld),this.object.matrix.decompose(this.position,this.quaternion,this.scale),this.object.parent?this.object.hiddenMatrix.copy(this.object.parent.matrixWorld).invert():this.object.hiddenMatrix.identity();let e=(new _n).setFromQuaternion(this.quaternion,"YXZ"),t=e.y;this.objectRealQuat.copy(this.quaternion),e.y=0,this.quaternion.setFromEuler(e),this.objXZQuat.copy(this.quaternion),this.objXZQuatInv.copy(this.objXZQuat).invert(),this.objXZRotMat.makeRotationFromQuaternion(this.quaternion),e.set(0,t,0),this.quaternion.setFromEuler(e),this.rot.setFromEuler(e),this.euler.setFromQuaternion(this.quaternion,"YXZ"),this.velocityTarget.set(0,0,0),this.velocity.set(0,0,0)}else this.object instanceof jO?this.object.matrixAutoUpdate=!0:this.object.updateMatrix();!0===this.cameraFollow&&(this.camera.quaternion.copy(this.quat0Cam),this.camera.position.copy(this.position0Cam),this.camera.scale.copy(this.scale0Cam),this.camera.hiddenMatrix.copy(this.hiddenMatrix0Cam),this.camera.matrixAutoUpdate=!0),this.controlsManager.requestRender()}activate(){this.instantiateActions(),this.domElement.ownerDocument.addEventListener("pointerdown",this.onPointerDown),this.domElement.ownerDocument.addEventListener("keydown",this.onKeyDown),this.domElement.ownerDocument.addEventListener("keyup",this.onKeyUp),this.domElement.ownerDocument.addEventListener("pointerlockchange",this.onPointerlockChange),this.domElement.ownerDocument.addEventListener("pointerlockerror",this.onPointerlockError),this.domElement.ownerDocument.addEventListener("visibilitychange",this.handleVisibilityChange)}deactivate(){this.disposeActions(),this.domElement.ownerDocument.removeEventListener("pointerdown",this.onPointerDown),this.domElement.ownerDocument.removeEventListener("keydown",this.onKeyDown),this.domElement.ownerDocument.removeEventListener("keyup",this.onKeyUp),this.domElement.ownerDocument.removeEventListener("pointerlockchange",this.onPointerlockChange),this.domElement.ownerDocument.removeEventListener("pointerlockerror",this.onPointerlockError),this.domElement.ownerDocument.removeEventListener("visibilitychange",this.handleVisibilityChange)}dispose(){var e;this.deactivate(),(null===(e=this.navMeshPathDest)||void 0===e?void 0:e.parent)&&this.page.remove(this.navMeshPathDest)}instantiateActions(){let e=this.data,t=this.sharedAssets;void 0!==e.gameActions&&(this.actions={},Ex.list.forEach((n=>{this.actions[n]=dF(o(o({},e),{},{disabled:!1,type:"GameControl"}),e.gameActions[n],this.page,t,this.controlsManager.eventManager,this.object)}))),this.dispatchStopEvent("move"),this.dispatchStopEvent("run"),this.dispatchStopEvent("jump"),this.dispatchStartEvent("idle"),this.initialAction&&(this.initialAction=!1)}disposeActions(){this.initialAction=!1,this.dispatchStopEvent("idle"),this.dispatchStopEvent("move"),this.dispatchStopEvent("run"),this.dispatchStopEvent("jump"),pF(this.actions.idle),pF(this.actions.move),pF(this.actions.run),pF(this.actions.jump)}dispatchStartEvent(e){void 0!==this.actions[e]&&(this.actionState[e]||(this.actionState[e]=!0,this.actions[e].Transition.forEach((e=>{e.play()})),this.actions[e].Animation.forEach((e=>{e.play(!1===this.initialAction)})),this.actions[e].Create.forEach((e=>{e.dispatchStart()})),this.actions[e].Audio.forEach((e=>{e.dispatchGameControl("start")})),this.actions[e].Particles.forEach((e=>{e.dispatchGameControl("start")}))))}dispatchStopEvent(e){void 0!==this.actions[e]&&(!this.actionState[e]||(this.actionState[e]=!1,this.actions[e].Transition.forEach((e=>{e.stop(),null!==e.object.currentState&&e.object.changeSelectedState(null,{scene:this.page.scene,shared:this.sharedAssets})})),this.actions[e].Create.forEach((e=>{e.dispatchStop()})),this.actions[e].Audio.forEach((e=>{e.dispatchGameControl("stop")})),this.actions[e].Particles.forEach((e=>{e.dispatchGameControl("stop")}))))}get colliderWorldPosition(){return PF.copy(this.collider.position).applyQuaternion(this.objectRealQuat).add(this.position)}update(e,t,n){var i;if(this.gravity<0?this.position.y<this.resetYPosition:this.position.y>this.resetYPosition)return this.reset(!0),!0;this.sharedGameControlGlobals.gamePads.forEach(this.copyVRGamePadValues);let r=(this.isFirstFrame?16.6:e)/1e3;this.isFirstFrame&&(this.isFirstFrame=!1);let s=60*r,a=!1;if(this.usePhysics&&this.collisionEnabled){var o;let e=DF.set(0,(0===this.velocity.y?this.pixelsPerMeter*Math.max(Math.abs(this.gravity)/120,1)*(this.gravity>0?1:-1):this.velocity.y)*r,0).divideScalar(this.pixelsPerMeter),t=this.sharedGameControlGlobals.rapierWorld.castShape(this.colliderWorldPosition.divideScalar(this.pixelsPerMeter),this.colliderWorldQuat,e,null===(o=this.object.rigidBody)||void 0===o?void 0:o.collider(0).shape,1,!1,16,void 0,void 0,this.object.rigidBody);if(t){var l;this.onObject=!0,this.groundNormal.set(t.normal2.x,t.normal2.y,t.normal2.z).applyQuaternion(this.colliderWorldQuat).negate(),this.alignToGround&&this.groundTiltAdjustment(this.groundNormal),Math.acos(this.groundNormal.y)<this.slopeThresh&&(a=!0),0===(null===(l=t.collider.parent())||void 0===l?void 0:l.bodyType())&&Math.acos(this.groundNormal.y)*(180/Math.PI)>45&&(this.onObject=!1);let e=t.collider.parent();this.groundYRotation=0,this.groundVelocity.set(0,0,0);for(let t of this.sharedGameControlGlobals.entitiesWithTransformAnim)if(t.rigidBody===e&&t.userData.isFollowingObj!==this.object.uuid){(t.hasNonUniformScale?t.matrixWorldRigid:t.matrixWorld).decompose(PF,BF,DF),this.groundVelocity.subVectors(PF,t.prevT),this.object.getWorldPosition(DF).add(this.collider.position).sub(PF),this.groundYRotation=zF.setFromQuaternion(BF).y-t.prevR.y,OF.copy(DF).applyAxisAngle(FF,this.groundYRotation),this.groundVelocity.add(OF.sub(DF)).divideScalar(r);break}}else this.onObject=!1}if("walk"===this.moveMode&&this.collisionEnabled&&(1===this.movementState.jump&&this.onObject&&(this.velocityTarget.y=this.jumpPower,this.movementState.jump=0,this.dispatchStopEvent("idle"),this.dispatchStopEvent("move"),this.dispatchStopEvent("run"),this.dispatchStopEvent("jump"),this.dispatchStartEvent("jump"),this.onObject=!1),this.onObject?this.velocityTarget.y/=2:this.velocityTarget.y+=this.gravity*s),"fly"===this.moveMode&&(this.velocityTarget.y=(this.movementState.movePosY-this.movementState.moveNegY)*this.speedTranslate),this.directionXZ.z=this.movementState.movePosZ-this.movementState.moveNegZ,this.directionXZ.x=this.movementState.movePosX-this.movementState.moveNegX,"+z"===this.forwardDir&&this.directionXZ.multiplyScalar(-1),this.directionXZ.manhattanLength()>0&&(this.path=[]),this.navMeshPathDest){let e=this.navMeshPathDest.material;if("walk"===this.moveMode&&this.path.length>1){this.navMeshPathDest.position.copy(this.path[this.path.length-1]),this.navMeshPathDest.parent||this.page.add(this.navMeshPathDest);let t=PF.subVectors(this.path[1],this.position),n=DF.subVectors(this.path[1],this.path[0]);t.dot(n)<0?this.path.shift():(this.directionXZ.x=n.x,this.directionXZ.z=n.z),e.opacity=e.userData.opacity0}else e.opacity-=.05*e.userData.opacity0,this.navMeshPathDest.material.opacity<=0&&this.navMeshPathDest.parent&&this.page.remove(this.navMeshPathDest)}this.directionXZ.normalize(),this.movementState.run?this.moveForce=this.runMultiplier:this.moveForce=1,this.velocityTarget.z=this.directionXZ.z*this.speedTranslate*this.moveForce,this.velocityTarget.x=this.directionXZ.x*this.speedTranslate*this.moveForce,("walk"===this.moveMode?this.velocityTarget.x+this.velocityTarget.z===0:0===this.velocityTarget.manhattanLength())?this.lerpFactorPos.setScalar(this.lerpFactorPosEnd):this.lerpFactorPos.setScalar(this.lerpFactorPosStart),"walk"===this.moveMode&&(this.lerpFactorPos.y=1),!1===this.didHit&&0===this.pushedVelocity.manhattanLength()||!1===this.usePhysics?(this.velocity.x+=(this.velocityTarget.x-this.velocity.x)*(1-(1-this.lerpFactorPos.x)**s),this.velocity.y+=(this.velocityTarget.y-this.velocity.y)*(1-(1-this.lerpFactorPos.y)**s),this.velocity.z+=(this.velocityTarget.z-this.velocity.z)*(1-(1-this.lerpFactorPos.z)**s)):this.velocity.copy(this.velocityTarget),("walk"===this.moveMode?this.velocity.x**2+this.velocity.z**2<this.speedTranslate:this.velocity.lengthSq()<this.speedTranslate)?(this.dispatchStopEvent("move"),this.dispatchStopEvent("run"),this.onObject&&(this.dispatchStopEvent("jump"),this.dispatchStartEvent("idle"))):(this.dispatchStopEvent("idle"),this.onObject&&(this.dispatchStopEvent("jump"),this.movementState.run?(this.dispatchStopEvent("move"),this.dispatchStartEvent("run")):(this.dispatchStopEvent("run"),this.dispatchStartEvent("move"))));let c=TF.copy(this.velocity);if("none"!==this.orientMode&&!1===this.isFirstPerson){let e=DF.copy(c);e.y=0,c.set(0,c.y,e.length()*("+z"===this.forwardDir?1:-1))}if(this.directionXZ.manhattanLength()>0&&"none"!==this.orientMode&&!1===this.isFirstPerson)if("camera"===this.orientWith&&this.path.length<=1){let e=PF;this.camera.getWorldDirection(e);let t=OF.copy(FF).multiplyScalar(e.dot(FF));e.sub(t);let n=DF.copy(this.directionXZ);n.x*=-1,this.rot.y=e.angleTo(n)*(e.cross(n).y>0?-1:1)+this.rotationAccumWhenOrientWithCamera}else this.rot.y=(this.path.length>1?0:this.euler.y)+Math.atan2(-this.directionXZ.z,this.directionXZ.x)+Math.PI/2*("+z"===this.forwardDir?1:-1);if(zF.setFromVector3(this.rot),"walk"===this.moveMode&&(zF.x=0),c.applyEuler(zF),a&&(BF.setFromUnitVectors(FF,this.groundNormal),c.applyQuaternion(BF)),n){let e=zF.set(0,this.vrEulerYOffset*qF,0);n.applyEuler(e),c.x+=n.x,c.z+=n.z,this.nonColliderPosOffset.elements[13]+=n.y*r}if(!0===this.usePhysics){let e=DF;this.pushedVelocity.set(0,0,0);for(let t of this.sharedGameControlGlobals.entitiesWithTransformAnim){let n=OF.setFromMatrixPosition(t.matrixWorld).sub(t.prevT).divideScalar(r).divideScalar(this.pixelsPerMeter),i=t.rigidBody.collider(0).castCollider(n,this.object.rigidBody.collider(0),PF.copy(c).divideScalar(this.pixelsPerMeter),r,!1);n.multiplyScalar(this.pixelsPerMeter);let s=XS.is(t)?t:t.object;if(null!==i&&this.lastHitObj!==s){let e;t instanceof KS&&(e=t);let n=this.sharedGameControlGlobals.entityToCollisionEvents[s.uuid];if(n)for(let t of n)"character"===t.data.target&&(t.dispatch(e),s.dispatchEvent(yV));this.lastHitObj=s}if(null!==i){this.pushedVelocity.copy(n),e.copy(i.normal1).applyQuaternion(t.quaternion);break}}if(0!==this.pushedVelocity.manhattanLength()){let t=e.dot(c);t<0&&c.addScaledVector(e,-t),c.add(this.pushedVelocity)}else c.add(this.groundVelocity)}if(this.rotDirection.y=Number(this.movementState.rotPosY)-Number(this.movementState.rotNegY),this.rotDirection.x=Number(this.movementState.rotPosX)-Number(this.movementState.rotNegX),this.rotDirection.normalize(),"normal"===this.rotationMode&&(this.movementState.rotPosX||this.movementState.rotNegX)||"steer"===this.rotationMode&&(this.movementState.rotPosX||this.movementState.rotNegX)&&(this.movementState.movePosZ||this.movementState.moveNegZ||"walk"===this.moveMode)?this.rotVelocityStick.x=-this.rotDirection.x*this.speedOrbit*this.rotForce:this.rotVelocityStick.x=0,"normal"===this.rotationMode&&(this.movementState.rotPosY||this.movementState.rotNegY)||"steer"===this.rotationMode&&(this.movementState.rotPosY||this.movementState.rotNegY)&&(this.movementState.movePosZ||this.movementState.moveNegZ)?this.rotVelocityStick.y=-this.rotDirection.y*this.speedOrbit*this.rotForce:this.rotVelocityStick.y=0,this.rotVelocityTarget.subVectors(this.eulerDelta.divideScalar(r),this.rotVelocityStick),0===this.rotVelocityTarget.manhattanLength()?this.rotVelocity.lerp(this.rotVelocityTarget,1-(1-this.lerpFactorRotEnd)**s):this.rotVelocity.lerp(this.rotVelocityTarget,1-(1-this.lerpFactorRotStart)**s),this.euler.x+=this.rotVelocity.x*r,this.euler.y+=this.rotVelocity.y*r+this.groundYRotation,0===this.rotVelocityTarget.y&&0===this.directionXZ.manhattanLength()?this.rotationAccumWhenOrientWithCamera=0:(!1===this.cameraFollow||"Locked"===this.cameraYAxis)&&(this.rotationAccumWhenOrientWithCamera+=this.rotVelocity.y*r),!1===this.isFirstPerson&&"none"!==this.orientMode&&this.directionXZ.manhattanLength()>0){if("radial"===this.orientMode){this.objectToCamXZ.copy(this.objectToCamXZ0).applyAxisAngle(FF,this.euler.y-this.euler0.y);let e=DF.copy(this.objectToCamXZ).normalize(),t=OF.copy(c).multiplyScalar(r);t.y=0;let n=t.sub(PF.copy(e).multiplyScalar(t.dot(e))).cross(e).y;this.euler.y-=Math.atan2(n,this.objectToCamXZ.length())}}else this.rot.y+=this.rotVelocity.y*r+this.groundYRotation,0!==this.rotVelocityTarget.y&&(!1===this.cameraFollow||"Locked"===this.cameraYAxis)&&(this.euler.y=this.rot.y);if(!0===this.cameraFollow&&("walk"===this.moveMode?"Limit"===this.cameraXAxis?this.euler.x=at.clamp(this.euler.x,-this.maxPolarAngle+this.cameraPolarOffset+1e-6,-this.minPolarAngle+this.cameraPolarOffset-1e-6):this.euler.x=at.clamp(this.euler.x,-this.PI_2+this.cameraPolarOffset,this.PI_2+this.cameraPolarOffset):"Limit"===this.cameraXAxis&&(this.euler.x=at.clamp(this.euler.x,-this.PI_2,this.PI_2))),"fly"===this.moveMode?this.rot.x=this.euler.x:this.isFirstPerson&&(t?(zF.copy(t),zF.y=0):(zF.copy(this.euler),zF.y=0),this.nonColliderRotOffset.makeRotationFromEuler(zF)),t&&("walk"===this.moveMode?(this.rot.y=t.y,this.rot.x=0,this.rot.z=0):this.rot.setFromEuler(t),this.rot.y+=this.vrEulerYOffset*qF),LF.setFromAxisAngle(NF,this.rot.x),BF.setFromAxisAngle(FF,this.rot.y),BF.multiply(LF),LF.setFromAxisAngle(UF,this.rot.z),BF.multiply(LF),this.quaternion.copy(BF),this.objectRealQuat.multiplyQuaternions(this.quaternion,this.objXZQuat),this.colliderWorldQuat.copy(this.objectRealQuat).multiply(this.collider.rotation),this.collisionEnabled)if(this.usePhysics){var h,u;let e=DF.copy(c).multiplyScalar(r/this.pixelsPerMeter),t=null;this.didHit=!1;let n=new Bt;for(let i=0;i<5;i++){var d;let r=e.length(),s=OF.copy(e).normalize();if(t=this.sharedGameControlGlobals.rapierWorld.castShape(this.colliderWorldPosition.divideScalar(this.pixelsPerMeter).add(n),this.colliderWorldQuat,s,null===(d=this.object.rigidBody)||void 0===d?void 0:d.collider(0).shape,r,!1,24,void 0,void 0,this.object.rigidBody),null===t){0===i&&0!==this.directionXZ.manhattanLength()&&(this.lastHitObj=null),n.add(e);break}{this.didHit=!0;let a=this.sharedGameControlGlobals.colliderToEntity.get(t.collider.handle);if(a!==this.lastHitObj&&0===i){this.lastHitObj=a;let e=this.sharedGameControlGlobals.entityToCollisionEvents[null===a||void 0===a?void 0:a.uuid];if(e)for(let n of e)if("character"===n.data.target){var p;let e,i=(null===(p=this.sharedGameControlGlobals.rapierWorld)||void 0===p?void 0:p.getCollider(t.collider.handle))._parent;if(a.cloner)for(let t of a.cloner.children)if(t.rigidBody===i){e=t;break}n.dispatch(e),a.dispatchEvent(yV)}}let o=CF.set(t.normal2.x,t.normal2.y,t.normal2.z).applyQuaternion(this.colliderWorldQuat),l=MF.copy(s).multiplyScalar(t.toi).dot(o),c=t.toi;if(0===c&&(this.position.y+=this.offset*this.pixelsPerMeter),l>this.offset&&(c=t.toi*(l-this.offset)/l,n.addScaledVector(s,c)),e.copy(s).multiplyScalar(r-c),Math.acos(-o.y)>this.slopeThresh){var f;let i=this.colliderWorldPosition.divideScalar(this.pixelsPerMeter).add(n),r=OF.copy(t.witness2).applyQuaternion(this.colliderWorldQuat);r.y=0;let s=i.add(r);s.y+=this.stepThresh;let a=this.sharedGameControlGlobals.rapierWorld.castShape(s,this.colliderWorldQuat,e,null===(f=this.object.rigidBody)||void 0===f?void 0:f.collider(0).shape,1,!1,24,void 0,void 0,this.object.rigidBody);null!==a&&0===a.toi&&(o.y=0,o.normalize())}e.addScaledVector(o,-e.dot(o))}}this.position.addScaledVector(n,this.pixelsPerMeter),null!==(h=this.object.rigidBody)&&void 0!==h&&h.setTranslation(PF.copy(this.position).divideScalar(this.pixelsPerMeter),!0),null===(u=this.object.rigidBody)||void 0===u||u.setRotation(LF.copy(this.quaternion).premultiply(this.groundTilt).multiply(this.objXZQuat),!0)}else{let e=this.onObject?1:5,t=c.multiplyScalar(r/e);for(let n=0;n<e;n++)this.position.add(t),this.collisionAdjustment(r/e)}else this.position.addScaledVector(c,r);if("walk"===this.moveMode&&this.onObject&&(this.velocityTarget.y=0,this.velocity.y=0),this.quaternion.premultiply(this.groundTilt).multiply(this.objXZQuat),this.object.matrix.compose(this.position,this.quaternion,this.scale),this.object.matrixWorldNeedsUpdate=!0,this.object.matrix.multiply(this.nonColliderPosOffset).multiply(this.nonColliderRotOffset),this.quaternion.premultiply(this.groundTiltInv).multiply(this.objXZQuatInv),!0===this.cameraFollow){this.updateFollowArms();let e=this.objectToTarget.add(this.position),t=this.targetToCamera.add(e);IF.lookAt(t,e,FF).setPosition(t),IF.decompose(this.targetPos,this.targetQuat,PF),this.camera.quaternion.slerp(this.targetQuat,1-(1-this.lerpFactorRotCamera)**s),this.camera.position.lerp(this.targetPos,1-(1-this.lerpFactorPosCamera)**s),this.camera.updateMatrix(),this.camera.updateMatrixWorld(),"Limit"===this.cameraYAxis&&"cartesian"===this.orientMode&&(this.euler.y=at.clamp(this.euler.y,this.minAzimuthAngleRel,this.maxAzimuthAngleRel)),this.euler.x=at.clamp(this.euler.x,-this.PI_2+(this.cameraPolarOffset<0?this.cameraPolarOffset:0),this.PI_2+(this.cameraPolarOffset>0?this.cameraPolarOffset:0))}return this.eulerDelta.set(0,0,0),this.object.dispatchEvent(WF),(!(this.path.length<2&&this.lastPosition.distanceToSquared(this.position)<this.threshEndTranslate&&Math.abs(this.rotVelocity.x)<this.threshEndRotVel&&Math.abs(this.rotVelocity.y)<this.threshEndRotVel&&(void 0===this.camera||this.isFirstPerson||this.lastCameraPosition.distanceToSquared(this.camera.position)<this.threshEndTranslate&&8*(1-this.lastCameraQuaternion.dot(this.camera.quaternion))<this.threshEndRotate))||"fly"!==this.moveMode&&!0!==this.onObject&&!1!==this.collisionEnabled||!(null===this.navMeshPathDest||this.navMeshPathDest.material.opacity<-.04*(null===(i=this.navMeshPathDest)||void 0===i||null===(i=i.material)||void 0===i?void 0:i.userData.opacity0)))&&(this.camera&&(this.lastCameraPosition.copy(this.camera.position),this.lastCameraQuaternion.copy(this.camera.quaternion)),this.lastPosition.copy(this.position),this.object.dispatchEvent(HF),!0)}updateFollowArms(){this.objectToTarget.copy(this.objectToTarget0),this.targetToCamera.copy(this.targetToCamera0);let e,t=LF.setFromAxisAngle(FF,"Limit"===this.cameraYAxis&&"radial"!==this.orientMode?at.clamp(this.euler.y-this.euler0.y,this.minAzimuthAngleRel,this.maxAzimuthAngleRel):this.euler.y-this.euler0.y);("Locked"!==this.cameraYAxis||"radial"===this.orientMode)&&this.objectToTarget.applyQuaternion(t),e="Limit"===this.cameraXAxis?at.clamp(this.euler.x,-this.maxPolarAngle+this.cameraPolarOffset+1e-6,-this.minPolarAngle+this.cameraPolarOffset-1e-6):at.clamp(this.euler.x,-this.PI_2+this.cameraPolarOffset+1e-6,this.PI_2+this.cameraPolarOffset-1e-6);let n=PF.copy(this.cameraPolarAxis0);("Locked"!==this.cameraYAxis||"radial"===this.orientMode)&&n.applyQuaternion(t);let i=BF.setFromAxisAngle(n,e);"Locked"!==this.cameraYAxis&&this.targetToCamera.applyQuaternion(t),"Locked"!==this.cameraXAxis&&this.targetToCamera.applyQuaternion(i)}groundTiltAdjustment(e){180*FF.angleTo(e)/Math.PI<15||180*FF.angleTo(e)/Math.PI>85?LF.identity():LF.setFromUnitVectors(FF,e),this.groundTilt.slerp(LF,.06),this.groundTiltInv.copy(this.groundTilt).invert()}collisionAdjustment(e){var t;let n=MF.set(0,0,0);this.object.matrix.compose(this.position,this.quaternion,this.scale);let i=IF.multiplyMatrices(this.object.matrix,this.objXZRotMat).multiply(this.collider.matrix).decompose(PF,LF,DF).compose(PF,LF,jF);this.sharedGameControlGlobals.entitiesWithTransformAnim.forEach((e=>{if(e===this.object||e.isDescendantOf(this.object))return;GF.makeEmpty(),e.updateMatrixWorldSVD();let t=e.matrixWorldRigid,r=RF.copy(t).invert(),s=kF.copy(RF).multiply(i);VF.copy(this.collider.segment),VF.start.applyMatrix4(s),VF.end.applyMatrix4(s);let a=CF.copy(this.position).applyMatrix4(r);GF.expandByPoint(VF.start),GF.expandByPoint(VF.end),GF.min.addScalar(-this.collider.radius),GF.max.addScalar(this.collider.radius),e.bvhGeometry.boundsTree.shapecast({traverseBoundsOrder:e=>e.distanceToPoint(VF.end),intersectsBounds:e=>e.intersectsBox(GF),intersectsTriangle:e=>{let i=PF,r=DF,s=e.closestPointToSegment(VF,i,r);if(s<this.collider.radius){let e=this.collider.radius-s,o=r.sub(i).normalize(),l=OF.copy(a);l.addScaledVector(o,e);let c=l.applyMatrix4(t).sub(this.position);n.add(c),VF.start.addScaledVector(o,e),VF.end.addScaledVector(o,e)}}})})),GF.makeEmpty(),VF.copy(this.collider.segment),VF.start.applyMatrix4(i),VF.end.applyMatrix4(i),GF.expandByPoint(VF.start),GF.expandByPoint(VF.end),GF.min.addScalar(-this.collider.radius),GF.max.addScalar(this.collider.radius),null!==(t=this.sharedGameControlGlobals.staticMeshBVH)&&void 0!==t&&t.shapecast({traverseBoundsOrder:e=>e.distanceToPoint(VF.end),intersectsBounds:e=>e.intersectsBox(GF),intersectsTriangle:e=>{let t=PF,i=DF,r=e.closestPointToSegment(VF,t,i);if(r<this.collider.radius){let e=this.collider.radius-r,s=i.sub(t).normalize();this.alignToGround&&this.groundTiltAdjustment(s),n.addScaledVector(s,e),VF.start.addScaledVector(s,e),VF.end.addScaledVector(s,e)}}}),this.onObject=Math.abs(n.y)>Math.abs(e*this.velocity.y*.25),this.onObject&&this.dispatchStopEvent("jump");let r=Math.max(0,n.length()-1e-5);n.normalize().multiplyScalar(r),this.position.add(n)}},YF=XF;YF.isLocked=!1;var QF=A(T());function KF(e){let t=e.elements,n=t[0]**2+t[1]**2+t[2]**2,i=t[4]**2+t[5]**2+t[6]**2,r=t[8]**2+t[9]**2+t[10]**2,s=t[0]**2+t[4]**2+t[8]**2,a=t[1]**2+t[5]**2+t[9]**2,o=t[2]**2+t[6]**2+t[10]**2,l=1e-8;return n<l||i<l||r<l||s<l||a<l||o<l}function ZF(e,t){let n=new di;if(t&&KF(t))return n.setAttribute("position",new ri([],3)),n.setIndex([]),n;if(!e.getAttribute("position"))return n.setAttribute("position",new ri([],3)),n.setIndex([]),n;let{positions:i,triIndices:r}=uC(e.getAttribute("position"),e.getIndex());return n.setAttribute("position",new ri(i,3)),n.setIndex(r),t&&n.applyMatrix4(t),n}var JF=new pn,$F=new pn,eU=[[0,0,0],[0,0,0],[0,0,0]];function tU(e){let t=e.elements;eU[0][0]=t[0],eU[0][1]=t[4],eU[0][2]=t[8],eU[1][0]=t[1],eU[1][1]=t[5],eU[1][2]=t[9],eU[2][0]=t[2],eU[2][1]=t[6],eU[2][2]=t[10];let{u:n,v:i}=(0,QF.SVD)(eU),r=JF.set(n[0][0],n[0][1],n[0][2],0,n[1][0],n[1][1],n[1][2],0,n[2][0],n[2][1],n[2][2],0,0,0,0,1),s=$F.set(i[0][0],i[0][1],i[0][2],0,i[1][0],i[1][1],i[1][2],0,i[2][0],i[2][1],i[2][2],0,0,0,0,1);return r.multiply(s.transpose())}var nU=class extends mc{constructor(){super(),this.layers.enable(3),this.layers.enable(8),this.layers.enable(9)}setFromCamera(e,t){t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,-1).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):t.isPerspectiveCamera?(this.ray.origin.set(e.x,e.y,-1).unproject(t),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):console.error("Raycaster: Unsupported camera type.")}intersectVisibleObjects(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];return e.forEach((e=>{e.visible&&this.intersectObject(e,t,n)})),n}createRaycastLineHelper(){let e=new Va({color:65280,linewidth:10}),t=new Bt(this.ray.origin.x,this.ray.origin.y,this.ray.origin.z),n=new Bt(this.ray.direction.x,this.ray.direction.y,this.ray.direction.z),i=this.camera.far-this.camera.near,r=(new Bt).addVectors(t,n.multiplyScalar(i)),s=new di;return s.setFromPoints([t,r]),new Ya(s,e)}},iU=e=>e instanceof nI||e instanceof vL;function rU(e,t){return e.distance-t.distance}function sU(e,t,n){if(u_(t)&&t.visible){YO(t)&&t.raycast(e,n);for(let i of t.children)sU(e,i,n)}}function aU(e,t,n){if(!(arguments.length>3&&void 0!==arguments[3]&&arguments[3])&&!n.some((t=>void 0!==cU(e,t))))return[];let i=[];return t.children.forEach((t=>sU(e,t,i))),i.sort(rU),i}function oU(e){let t=[];if(e.length){let n=e[0].object;u_(n)&&t.push(n);let i=n.parent;for(;i;)iU(i)&&t.push(i),i=i.parent}return t}function lU(e,t,n,i){let r=e.frame;if(r){let e=t[0]*r.width,s=(1-t[1])*r.height;for(let t of n){let n=t===r.uuid?r:r.find(t);if(null!==n&&void 0!==n&&n.intersects(e,s))return i(n),!0}}return!1}function cU(e,t){if(YO(t)){if(t.visible){let n=[];return t.raycast(e,n),n.length?n[0]:void 0}}else if(iU(t))return hU(e,t)}function hU(e,t){if(u_(t)&&t.visible){if(YO(t)){let n=[];if(t.raycast(e,n),n.length)return n[0]}for(let n of t.children){let t=hU(e,n);if(t)return t}}}var uU=class{constructor(e,t,n,i,r,s,a,o){this.renderer=e,this.publish=t,this.scene=n,this.getCamera=i,this.sharedAssets=r,this.requestRender=s,this.isExport=a,this.frame=o,this.raycaster=new nU,this._useWindowEvents=!1,this.pointerWorld={x:0,y:0},this.pointerScreen={x:0,y:0},this._useWindowEvents="window"===t.mouseEventTarget,this.domElement=e.domElement,this.eventElement=this._useWindowEvents?window:e.domElement,this._domRect=this.domElement.getBoundingClientRect()}get stopRaycast(){return this.publish.stopRaycast}get page(){return this.scene.activePage}set useWindowEvents(e){this._useWindowEvents=e,this.eventElement=e?window:this.renderer.domElement}get useWindowEvents(){return this._useWindowEvents}set domRect(e){this._domRect=e}get domRect(){return this._domRect}updateRaycaster(e){var t;let{pageX:n,pageY:i}=(null===(t=e.touches)||void 0===t?void 0:t.length)>0?e.touches[0]:e;this.pointerWorld=function(e,t,n){return{x:(e-(n.left+window.scrollX))/n.width*2-1,y:-(t-(n.top+window.scrollY))/n.height*2+1}}(n,i,this._domRect),this.pointerScreen=function(e,t,n){return{x:(e-(n.left+window.scrollX))/n.width,y:1-(t-(n.top+window.scrollY))/n.height}}(n,i,this._domRect),this.raycaster.setFromCamera(this.pointerWorld,this.getCamera())}},dU=class{constructor(e){this.eventContext=e,this.domEventsNeeded=new Set,this.hasVideoAction=!1}connect(){}disconnect(){}},pU=[["start","Start"],["keyDown","KeyDown"],["keyUp","KeyUp"],["mouseDown","MouseDown"],["mouseUp","MouseUp"],["mouseHover","MouseHover"],["collision","Collision"],["lookAt","LookAt"],["follow","Follow"],["scroll","Scroll"]],fU=e=>{var t;return null===(t=pU.find((t=>{let[n,i]=t;return i===e})))||void 0===t?void 0:t[0]},mU=e=>{var t;return null===(t=pU.find((t=>{let[n]=t;return n===e})))||void 0===t?void 0:t[1]},gU=(e,t)=>{let n=fU(e);if(n){let e=new CustomEvent(n,{bubbles:!0});return Object.defineProperty(e,"target",{writable:!1,value:t}),e}},vU=class extends dU{constructor(){super(...arguments),this.objectsPerEvents=new Map,this.splineEvents={},this.onBeginEvent=e=>{var t;if(!e.eventName||!e.target||"Scroll"===e.eventName)return;let n=null===(t=this.splineEvents[fU(e.eventName)])||void 0===t?void 0:t[e.target.uuid];if(!n)return;"Scroll"===e.eventName&&void 0!==e.deltaY&&Object.assign(n,{deltaY:e.deltaY});let{domElement:i}=this.eventContext;i.dispatchEvent(n)}}connect(){let{page:e}=this.eventContext;e.traverseEntity((e=>{var t;if(null!==(t=e.data)&&void 0!==t&&t.events.length)for(let[i,r]of pU)if(e.data.events.some((e=>e.data.type===r&&!e.data.disabled))){var n;this.objectsPerEvents.has(i)?null===(n=this.objectsPerEvents.get(i))||void 0===n||n.push(e):this.objectsPerEvents.set(i,[e]);let t={id:e.uuid,name:e.name},s=gU(r,t),a=this.splineEvents[i];a?a[e.uuid]=s:this.splineEvents[i]={[e.uuid]:s}}})),this.objectsPerEvents.forEach((e=>{e.forEach((e=>{e.addEventListener("beginEvent",this.onBeginEvent)}))}))}disconnect(){this.objectsPerEvents.forEach((e=>{e.forEach((e=>{e.removeEventListener("beginEvent",this.onBeginEvent)}))}))}},yU=class{constructor(e,t,n,i,r,s){if(this.id=e,this.data=t,this.object=n,this.entered=!1,("KeyDown"===t.type||"KeyUp"===t.type||"KeyPress"===t.type)&&!t.key)throw new Error("Missing property");this.actions=dF(t,t.actions,i,r,s,n)}disconnect(){pF(this.actions)}dispatchHeld(e){this.actions.Create.forEach((t=>{e&&t.dispatchThrottled.cancel(),t.dispatchThrottled()}))}dispatch(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.actions.Transition.forEach((e=>{e.object.currentTransitionEvent!==this&&(e.object.currentTransitionEvent=this,e.init())})),"MousePress"===this.data.type||"KeyPress"===this.data.type?this.entered||(this.entered=!0,this.actions.Transition.forEach((e=>e.playFromCurrent())),this.actions.Animation.forEach((e=>e.playFromCurrent())),this.actions.SwitchCamera.forEach((e=>e.playFromCurrent())),this.actions.Create.forEach((e=>e.dispatchStart()))):(this.actions.Transition.some((e=>e.playing&&"Toggle"!==e.data.runMode))||this.actions.Transition.forEach((e=>{"Toggle"===e.data.runMode?e.toggle():e.play()})),this.actions.SwitchCamera.some((e=>e.playing&&"Toggle"!==e.data.runMode))||this.actions.SwitchCamera.forEach((e=>{"Toggle"===e.data.runMode?e.toggle():e.play()})),this.actions.Animation.forEach((e=>{"Toggle"===e.data.runMode?e.toggle():e.play()}))),this.actions.Link.forEach((e=>{e.dispatch()})),this.actions.SceneTransition.forEach((e=>{e.dispatch()})),!1===e&&this.actions.Create.forEach((e=>{e.dispatch()})),this.actions.Destroy.forEach((e=>{e.dispatch()})),this.actions.Reset.forEach((e=>{e.dispatch()})),this.actions.Audio.forEach((e=>{e.dispatchBasic()})),this.actions.Video.forEach((e=>{e.dispatchBasic()})),this.actions.Particles.forEach((e=>{e.dispatchBasic()})),this.actions.SetVariable.forEach((e=>e.checkConditions())),this.actions.SetVariable.forEach((e=>e.dispatch())),this.actions.DynamicVariablePlay.forEach((e=>e.dispatch())),this.actions.ClearLocalStorage.forEach((e=>e.dispatch())),this.actions.UserAPI.forEach((e=>e.dispatch()))}dispatchRelease(){this.entered&&(this.entered=!1,this.actions.Transition.forEach((e=>e.reverseFromCurrent())),this.actions.Particles.forEach((e=>e.reverseFromCurrent())),this.actions.Animation.forEach((e=>e.reverseFromCurrent())),this.actions.SwitchCamera.forEach((e=>e.reverseFromCurrent())),this.actions.Create.forEach((e=>e.dispatchStop())))}dispatchUserEvent(e){this.actions.Transition.forEach((e=>{e.object.currentTransitionEvent!==this&&(e.object.currentTransitionEvent=this,e.init())})),e?(this.actions.Transition.forEach((e=>e.reverseFromCurrent())),this.actions.Animation.forEach((e=>e.reverseFromCurrent())),this.actions.SwitchCamera.forEach((e=>e.reverseFromCurrent()))):(this.actions.Transition.forEach((e=>e.playFromCurrent())),this.actions.Animation.forEach((e=>e.playFromCurrent())),this.actions.SwitchCamera.forEach((e=>e.playFromCurrent()))),this.actions.Link.forEach((e=>{e.dispatch()})),this.actions.SceneTransition.forEach((e=>{e.dispatch()})),this.actions.Create.forEach((e=>{e.dispatch()})),this.actions.Destroy.forEach((e=>{e.dispatch()})),this.actions.Reset.forEach((e=>{e.dispatch()})),this.actions.Audio.forEach((e=>{e.dispatchBasic()})),this.actions.Video.forEach((e=>{e.dispatchBasic()})),this.actions.Particles.forEach((e=>{e.dispatchBasic()})),this.actions.SetVariable.forEach((e=>e.checkConditions())),this.actions.SetVariable.forEach((e=>e.dispatch())),this.actions.DynamicVariablePlay.forEach((e=>e.dispatch())),this.actions.ClearLocalStorage.forEach((e=>e.dispatch())),this.actions.UserAPI.forEach((e=>e.dispatch()))}},bU=class extends dU{constructor(e,t,n){super(e),this.eventManager=t,this.useForRaycastProperty=n,this.objectsPerTypes={MouseDown:[],MouseUp:[],MousePress:[],KeyDown:[],KeyUp:[],KeyPress:[]},this.canvasMouseEvents=[],this.eventsPerObjects={MouseDown:{},MouseUp:{},MousePress:{},KeyDown:{},KeyUp:{},KeyPress:{}},this.heldKeys={},this.heldKeysPress={},this._prevObjects=[],this.sceneInterects=null,this.onCanvasRaycast=e=>{if(!0===this.useForRaycastProperty&&null===this.sceneInterects){this.eventContext.updateRaycaster(e);let{raycaster:t,page:n}=this.eventContext,i=aU(t,n,[],!0);this.sceneInterects=i,i.length&&(this.eventContext.sharedAssets.raycastProperty={x:i[0].point.x,y:i[0].point.y,z:i[0].point.z,objX:i[0].object.matrixWorld.elements[12],objY:i[0].object.matrixWorld.elements[13],objZ:i[0].object.matrixWorld.elements[14]})}},this.onCanvasMouseDown=e=>{(e.target===this.eventContext.domElement||"SPLINE-VIEWER"===e.target.tagName)&&this.canvasMouseEvents.forEach((t=>{("MouseDown"===t.data.type||"MousePress"===t.data.type)&&(this.onCanvasRaycast(e),t.dispatch())}))},this.onCanvasMouseUp=e=>{(e.target===this.eventContext.domElement||"SPLINE-VIEWER"===e.target.tagName)&&this.canvasMouseEvents.forEach((t=>{"MouseUp"===t.data.type?(this.onCanvasRaycast(e),t.dispatch()):"MousePress"===t.data.type&&t.dispatchRelease()}))},this.onMouseDown=e=>{Fm.length>1||(this.eventContext.updateRaycaster(e),this.handleMouseEvent("MouseDown"))},this.onMouseUp=e=>{Fm.length>1||(this.eventContext.updateRaycaster(e),this.handleMouseEvent("MouseUp"))},this.onMousePressDown=e=>{Fm.length>1||(this.eventContext.updateRaycaster(e),this.handleMousePressEvent())},this.onMousePressRelease=e=>{Fm.length>1||(this.eventContext.updateRaycaster(e),this.handleMousePressEvent(!0))},this.onKeyDown=e=>{this.heldKeys[e.key]||(this.handleKeyEvent(e,"KeyDown"),this.handleKeyEventHeld(e,"KeyDown",!0)),this.heldKeys[e.key]=!0},this.onKeyUp=e=>{this.handleKeyEvent(e,"KeyUp"),this.handleKeyEventHeld(e,"KeyUp",!0)},this.onKeyPressDown=e=>{this.heldKeysPress[e.key]?this.handleKeyEventHeld(e,"KeyPress"):(this.handleKeyEvent(e,"KeyPress"),this.handleKeyEventHeld(e,"KeyPress",!0)),this.heldKeysPress[e.key]=!0},this.onKeyPressUp=e=>{this.handleKeyEvent(e,"KeyPress",!0)},this.releaseHeldKey=e=>{delete this.heldKeys[e.key]},this.releaseHeldKeyPress=e=>{delete this.heldKeysPress[e.key]},this._onUserEvent=e=>{var t,n;let{eventName:i,target:r,reverse:s}=e;if(!i||!r)return;let a=mU(i);a&&("MouseDown"===a||"MouseUp"===a||"MousePress"===a?(r.dispatchEvent({type:"beginEvent",eventName:a}),null===(t=this.eventsPerObjects[a])||void 0===t||null===(t=t[r.uuid])||void 0===t||t.forEach((e=>{e.dispatchUserEvent(s)}))):("KeyDown"===a||"KeyUp"===a||"KeyPress"===a)&&(r.dispatchEvent({type:"beginEvent",eventName:a}),null===(n=this.eventsPerObjects[a])||void 0===n||null===(n=n[r.uuid])||void 0===n||n.forEach((e=>{e.dispatchUserEvent()}))))}}connect(){var e,t,n,i,r,s;let{page:a,sharedAssets:o,domElement:l}=this.eventContext,c=(e,t)=>{var n;if(null===(n=e.data)||void 0===n||!n.events.length)return;let i=["MouseDown","MouseUp","MousePress","KeyDown","KeyUp","KeyPress"];for(let s of i){var r;let n=this.eventsPerObjects[s];if(e.data.events.filter((e=>{let{data:t}=e;return t.type===s&&!0!==t.disabled})).forEach((t=>{let{id:i,data:r}=t;try{let t=new yU(i,r,e,a,o,this.eventManager);t.actions.Video.length&&(this.hasVideoAction=!0),"MouseDown"!==r.type&&"MouseUp"!==r.type&&"MousePress"!==r.type||"Canvas"!==r.mode&&"Window"!==r.mode?(n[e.uuid]?n[e.uuid].some((e=>e.id===t.id))||n[e.uuid].push(t):n[e.uuid]=[t],e instanceof qL&&e.traverseChildren((e=>{var i;if(!e.visible)return!0;e instanceof RD&&2!==(null===(i=e.data.geometry.shapeBlendNode)||void 0===i?void 0:i.operation)&&(n[e.uuid]?n[e.uuid].push(t):n[e.uuid]=[t])}))):this.canvasMouseEvents.push(t)}catch(XZ){}})),null!==(r=n[e.uuid])&&void 0!==r&&r.length&&(this.objectsPerTypes[s].push(e instanceof vk&&("MouseDown"===s||"MouseUp"===s||"MousePress"===s)?t:e),e instanceof qL)){let t=this.objectsPerTypes[s];e.traverseChildren((e=>{if(!e.visible)return!0;e instanceof RD&&-1===t.indexOf(e)&&t.push(e)}))}}};a.traverseEntity((e=>{var t;(e instanceof SL||e instanceof dL)&&null!==(t=e.frame)&&void 0!==t&&t.traverse((t=>{c(t,e)})),c(e)})),this.heldKeys={},this.heldKeysPress={},this.domEventsNeeded.clear(),l.addEventListener("pointerdown",this.onCanvasMouseDown),l.addEventListener("pointerup",this.onCanvasMouseUp),(null!==(e=this.objectsPerTypes.MouseDown)&&void 0!==e&&e.length||this.useForRaycastProperty)&&(this.domEventsNeeded.add("pointerdown"),l.addEventListener("pointerdown",this.onMouseDown)),null!==(t=this.objectsPerTypes.MouseUp)&&void 0!==t&&t.length&&(this.domEventsNeeded.add("pointerup"),l.addEventListener("pointerup",this.onMouseUp)),null!==(n=this.objectsPerTypes.MousePress)&&void 0!==n&&n.length&&(this.domEventsNeeded.add("pointerdown"),l.addEventListener("pointerdown",this.onMousePressDown),this.domEventsNeeded.add("pointerup"),l.addEventListener("pointerup",this.onMousePressRelease)),null!==(i=this.objectsPerTypes.KeyDown)&&void 0!==i&&i.length&&(this.domEventsNeeded.add("keydown"),document.addEventListener("keydown",this.onKeyDown),document.addEventListener("keyup",this.releaseHeldKey)),null!==(r=this.objectsPerTypes.KeyUp)&&void 0!==r&&r.length&&(this.domEventsNeeded.add("keyup"),document.addEventListener("keyup",this.onKeyUp)),null!==(s=this.objectsPerTypes.KeyPress)&&void 0!==s&&s.length&&(this.domEventsNeeded.add("keydown"),document.addEventListener("keydown",this.onKeyPressDown),document.addEventListener("keyup",this.releaseHeldKeyPress),this.domEventsNeeded.add("keyup"),document.addEventListener("keyup",this.onKeyPressUp)),Object.entries(this.objectsPerTypes).forEach((e=>{let[t,n]=e;n.forEach((e=>{e.addEventListener("userEvent",this._onUserEvent)}))}))}disconnect(){let{domElement:e}=this.eventContext;this.domEventsNeeded.clear(),this.heldKeys={},this.heldKeysPress={},e.removeEventListener("pointerdown",this.onCanvasMouseDown),e.removeEventListener("pointerup",this.onCanvasMouseUp),e.removeEventListener("pointerdown",this.onMouseDown),e.removeEventListener("pointerdown",this.onMousePressDown),e.removeEventListener("pointerup",this.onMouseUp),e.removeEventListener("pointerup",this.onMousePressRelease),document.removeEventListener("keydown",this.onKeyDown),document.removeEventListener("keyup",this.onKeyUp),document.removeEventListener("keydown",this.onKeyPressDown),document.removeEventListener("keyup",this.onKeyPressUp),document.removeEventListener("keyup",this.releaseHeldKey),Object.values(this.eventsPerObjects).forEach((e=>{Object.values(e).forEach((e=>{e.forEach((e=>{e.disconnect()}))}))})),this.canvasMouseEvents.forEach((e=>{e.disconnect()})),Object.entries(this.objectsPerTypes).forEach((e=>{let[t,n]=e;n.forEach((e=>{e.removeEventListener("userEvent",this._onUserEvent)}))}))}handleMouseEvent(e){let{stopRaycast:t,raycaster:n,page:i,pointerScreen:r}=this.eventContext,s=this.objectsPerTypes[e],a=s.filter((e=>!(e instanceof vk)));if((s.length||this.useForRaycastProperty)&&(!i.uiCanvas||!lU(i,[r.x,r.y],Object.keys(this.eventsPerObjects[e]),(t=>{this.handleObjectMouseEventDispatch(t,e)})))){if(t||this.useForRaycastProperty){let r;if(null===this.sceneInterects?r=aU(n,i,a,this.useForRaycastProperty):(r=this.sceneInterects,this.sceneInterects=null),this.useForRaycastProperty&&r.length&&(this.eventContext.sharedAssets.raycastProperty={x:r[0].point.x,y:r[0].point.y,z:r[0].point.z,objX:r[0].object.matrixWorld.elements[12],objY:r[0].object.matrixWorld.elements[13],objZ:r[0].object.matrixWorld.elements[14]}),t){var o,l,c,h;let t=[null!==(o=null===(l=r[0])||void 0===l||null===(l=l.uv)||void 0===l?void 0:l.x)&&void 0!==o?o:0,null!==(c=null===(h=r[0])||void 0===h||null===(h=h.uv)||void 0===h?void 0:h.y)&&void 0!==c?c:0];oU(r).forEach((n=>{n instanceof SL&&lU(n,t,Object.keys(this.eventsPerObjects[e]),(t=>{this.handleObjectMouseEventDispatch(t,e)})),this.eventsPerObjects[e][n.uuid]&&this.handleObjectMouseEventDispatch(n,e)}))}}t||a.forEach((t=>{var i,r,s,a;let o=cU(n,t);o&&(this.handleObjectMouseEventDispatch(t,e),t instanceof SL&&lU(t,[null!==(i=null===o||void 0===o||null===(r=o.uv)||void 0===r?void 0:r.x)&&void 0!==i?i:0,null!==(s=null===o||void 0===o||null===(a=o.uv)||void 0===a?void 0:a.y)&&void 0!==s?s:0],Object.keys(this.eventsPerObjects[e]),(t=>{this.handleObjectMouseEventDispatch(t,e)})))}))}}handleMousePressEvent(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t="MousePress",n=this.objectsPerTypes[t],i=n.filter((e=>!(e instanceof vk))),r=[];if(n.length){if(!e){let{stopRaycast:e,raycaster:n,page:s,pointerScreen:a}=this.eventContext,o=!1;if(s.uiCanvas&&(o=lU(s,[a.x,a.y],Object.keys(this.eventsPerObjects[t]),(e=>{r.push(e)}))),e&&!o){let e=aU(n,s,i);r=oU(e),e.forEach((e=>{var n,i,s,a;e.object instanceof SL&&lU(e.object,[null!==(n=null===e||void 0===e||null===(i=e.uv)||void 0===i?void 0:i.x)&&void 0!==n?n:0,null!==(s=null===e||void 0===e||null===(a=e.uv)||void 0===a?void 0:a.y)&&void 0!==s?s:0],Object.keys(this.eventsPerObjects[t]),(e=>{r.push(e)}))}))}else i.forEach((e=>{var i,s,a,o;let l=cU(n,e);l&&(r.push(e),e instanceof SL&&lU(e,[null!==(i=null===l||void 0===l||null===(s=l.uv)||void 0===s?void 0:s.x)&&void 0!==i?i:0,null!==(a=null===l||void 0===l||null===(o=l.uv)||void 0===o?void 0:o.y)&&void 0!==a?a:0],Object.keys(this.eventsPerObjects[t]),(e=>{r.push(e)})))}))}this._prevObjects.length&&this._prevObjects.forEach((e=>{r.includes(e)||this.handleObjectMouseEventDispatchRelease(e,t)})),r.length&&r.forEach((e=>{this.handleObjectMouseEventDispatch(e,t)})),this._prevObjects=r}}handleObjectMouseEventDispatch(e,t){var n;e.dispatchEvent({type:"beginEvent",eventName:t}),null===(n=this.eventsPerObjects[t])||void 0===n||null===(n=n[e.uuid])||void 0===n||n.forEach((e=>{e.dispatch()}))}handleObjectMouseEventDispatchRelease(e,t){var n;e.dispatchEvent({type:"beginEvent",eventName:t}),null===(n=this.eventsPerObjects[t])||void 0===n||null===(n=n[e.uuid])||void 0===n||n.forEach((e=>{e.dispatchRelease()}))}handleKeyEvent(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this.objectsPerTypes[t].forEach((i=>{let r=this.eventsPerObjects[t][i.uuid];r.some((t=>{let{data:n}=t;return"key"in n&&n.key===e.key}))&&i.dispatchEvent({type:"beginEvent",eventName:t}),r.forEach((t=>{"key"in t.data&&t.data.key===e.key&&(n?t.dispatchRelease():t.dispatch(!0))}))}))}handleKeyEventHeld(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this.objectsPerTypes[t].forEach((i=>{this.eventsPerObjects[t][i.uuid].forEach((t=>{"key"in t.data&&t.data.key===e.key&&t.dispatchHeld(n)}))}))}},xU=new Bt,wU=new Bt,SU=class{constructor(e,t,n,i,r){this.actionsIn=dF(e,e.inActions,n,i,r,t),this.actionsOut=dF(e,e.outActions,n,i,r,t)}disconnect(){pF(this.actionsIn),pF(this.actionsOut)}},_U=class extends SU{constructor(e,t,n,i,r,s){super(t,n,i,r,s),this.id=e,this.data=t,this.object=n,this.stage="out",this.objects=[],this.onUpdateMatrixWorld=()=>{for(let i of this.objects)if(!i.visible)return;let e=xU.setFromMatrixPosition(this.objects[0].matrixWorld),t=wU.setFromMatrixPosition(this.objects[1].matrixWorld),n=e.distanceTo(t)<=this.distance?"in":"out";if(this.stage!==n){this.stage=n;let e="in"===n?this.actionsIn:this.actionsOut;e.Audio.forEach((e=>e.dispatchConditional())),e.Particles.forEach((e=>e.dispatchConditional())),e.Video.forEach((e=>e.dispatchConditional())),e.Link.forEach((e=>e.dispatch())),e.Create.forEach((e=>e.dispatch())),e.Destroy.forEach((e=>e.dispatch())),e.Reset.forEach((e=>e.dispatch())),e.Transition.forEach((e=>{e.object.currentTransitionEvent!==this&&(e.object.currentTransitionEvent=this),e.init()})),e.Transition.forEach((e=>e.play())),e.Animation.forEach((e=>e.play())),e.SwitchCamera.forEach((e=>e.play())),e.SceneTransition.forEach((e=>e.dispatch())),e.SetVariable.forEach((e=>e.checkConditions())),e.SetVariable.forEach((e=>e.dispatch())),e.DynamicVariablePlay.forEach((e=>e.dispatch())),e.ClearLocalStorage.forEach((e=>e.dispatch())),e.UserAPI.forEach((e=>e.dispatch()))}};let{distance:a,fromObject:o,toObject:l}=t.condition;this.distance=a;for(let c of[o,l]){if(!c)throw new Error("Missing property");let e=i.find(c);if(!e)throw new Error("Missing property");this.objects.push(e)}}connect(){window.setTimeout((()=>{this.objects.forEach((e=>{e.addEventListener("updateMatrixWorld",this.onUpdateMatrixWorld)})),this.onUpdateMatrixWorld()}),0)}disconnect(){super.disconnect(),this.stage="out",this.objects.forEach((e=>{e.removeEventListener("updateMatrixWorld",this.onUpdateMatrixWorld)}))}},EU=class extends SU{constructor(e,t,n,i,r,s){var a,o;super(t,n,i,r,s),this.id=e,this.data=t,this.object=n,this.onBegin=e=>{let{target:t,state:n}=e;this.toState!==n&&(this.actionsOut.Audio.forEach((e=>e.dispatchConditional())),this.actionsOut.Particles.forEach((e=>e.dispatchConditional())),this.actionsOut.Video.forEach((e=>e.dispatchConditional())),this.actionsOut.Link.forEach((e=>e.dispatch())),this.actionsOut.Create.forEach((e=>e.dispatch())),this.actionsOut.Destroy.forEach((e=>e.dispatch())),this.actionsOut.Reset.forEach((e=>e.dispatch())),this.actionsIn.Transition.forEach((e=>e.pause())),this.object.currentTransitionEvent=this,this.actionsOut.Transition.forEach((e=>e.play())),this.actionsOut.Animation.forEach((e=>e.play())),this.actionsIn.SwitchCamera.forEach((e=>e.pause())),this.actionsOut.SwitchCamera.forEach((e=>e.play())),this.actionsOut.SceneTransition.forEach((e=>e.dispatch())),this.actionsOut.SetVariable.forEach((e=>e.checkConditions())),this.actionsOut.SetVariable.forEach((e=>e.dispatch())),this.actionsOut.DynamicVariablePlay.forEach((e=>e.dispatch())),this.actionsOut.ClearLocalStorage.forEach((e=>e.dispatch())),this.actionsOut.UserAPI.forEach((e=>e.dispatch())))},this.onComplete=e=>{let{target:t,state:n}=e;this.toState===n&&(this.actionsIn.Audio.forEach((e=>e.dispatchConditional())),this.actionsIn.Particles.forEach((e=>e.dispatchConditional())),this.actionsIn.Video.forEach((e=>e.dispatchConditional())),this.actionsIn.Link.forEach((e=>e.dispatch())),this.actionsIn.Create.forEach((e=>e.dispatch())),this.actionsIn.Destroy.forEach((e=>e.dispatch())),this.actionsIn.Reset.forEach((e=>e.dispatch())),this.actionsOut.Transition.forEach((e=>e.pause())),this.actionsOut.Transition.forEach((e=>e.pause())),this.object.currentTransitionEvent=this,this.actionsIn.Transition.forEach((e=>e.play())),this.actionsIn.Animation.forEach((e=>e.play())),this.actionsOut.SwitchCamera.forEach((e=>e.pause())),this.actionsIn.SwitchCamera.forEach((e=>e.play())),this.actionsIn.SceneTransition.forEach((e=>e.dispatch())),this.actionsIn.SetVariable.forEach((e=>e.checkConditions())),this.actionsIn.SetVariable.forEach((e=>e.dispatch())),this.actionsIn.DynamicVariablePlay.forEach((e=>e.dispatch())),this.actionsOut.ClearLocalStorage.forEach((e=>e.dispatch())),this.actionsOut.UserAPI.forEach((e=>e.dispatch())))};let{condition:l}=t;if(!l.object)throw new Error("Missing property");let c=null!==(a=i.find(l.object))&&void 0!==a?a:i.scene.find2D(l.object);if(!c)throw new Error("Missing property");if(this.toObject=c,l.state&&(null===(o=this.toObject.states)||void 0===o||!o[l.state]))throw new Error("Missing property");this.toState=l.state}connect(){bd(this.actionsOut).forEach((e=>{var t;(null===(t=this.actionsOut[e])||void 0===t?void 0:t.length)&&this.toObject.addEventListener("beginState",this.onBegin)})),bd(this.actionsIn).forEach((e=>{var t;(null===(t=this.actionsIn[e])||void 0===t?void 0:t.length)&&this.toObject.addEventListener("completeState",this.onComplete)}))}disconnect(){super.disconnect(),bd(this.actionsOut).forEach((e=>{var t;(null===(t=this.actionsIn[e])||void 0===t?void 0:t.length)&&this.toObject.removeEventListener("beginState",this.onBegin)})),bd(this.actionsIn).forEach((e=>{var t;(null===(t=this.actionsIn[e])||void 0===t?void 0:t.length)&&this.toObject.removeEventListener("completeState",this.onComplete)}))}},AU=class extends dU{constructor(e,t){super(e),this.eventManager=t,this.eventsPerConditions={Comparison:[],Distance:[],State:[]},this.hasVideoAction=!1}connect(){super.connect();let{page:e,sharedAssets:t}=this.eventContext;e.traverseEntity((n=>{var i;if(null!==(i=n.data)&&void 0!==i&&i.events.length)for(let{id:r,data:s}of n.data.events)if(!s.disabled&&"Conditional"===s.type)try{let i;"Comparison"===s.condition.type||("Distance"===s.condition.type?i=new _U(r,s,n,e,t,this.eventManager):"State"===s.condition.type&&(i=new EU(r,s,n,e,t,this.eventManager))),i&&(this.eventsPerConditions[s.condition.type].push(i),(i.actionsIn.Video.length||i.actionsOut.Video.length)&&(this.hasVideoAction=!0))}catch(jZ){}})),Object.values(this.eventsPerConditions).forEach((e=>e.forEach((e=>e.connect()))))}disconnect(){super.disconnect(),Object.values(this.eventsPerConditions).forEach((e=>e.forEach((e=>e.disconnect()))))}},CU=new Bt,MU=new Bt,TU=new Bt,PU=new Gi,DU=new Bt,OU=new Bt,IU=new Bt,RU=new Lt,kU=new _n,LU=new pn,BU=new lt,zU=new Bt,NU=new Bt,FU=.2;function UU(e,t){!t||(t[0]<t[1]&&(e.x=Math.min(Math.max(e.x,t[0]),t[1])),t[2]<t[3]&&(e.y=Math.min(Math.max(e.y,t[2]),t[3])),t[4]<t[5]&&(e.z=Math.min(Math.max(e.z,t[4]),t[5])))}var jU=function(){let e=new pn;return(t,n,i)=>{let r=t.obj;e.copy(r.hiddenMatrix),null!==r.parent&&e.premultiply(r.parent.matrixWorld),e.invert(),r.position.copy(n),"global"===t.reference&&UU(r.position,t.limits),r.position.applyMatrix4(e),"parent"===t.reference?UU(r.position,t.limits):"local"===t.reference&&(RU.copy(t.quat0).invert(),r.position.sub(t.position0),r.position.applyQuaternion(RU),UU(r.position,t.limits),RU.invert(),r.position.applyQuaternion(RU),r.position.add(t.position0)),e.multiply(null!==i&&void 0!==i?i:r.matrixWorld).decompose(DU,r.quaternion,OU),r.updateMatrix(),r.hasNonUniformScale&&(r.updateMatrixWorld(),r.updateMatrixWorldSVD()),r instanceof UC&&QO(r.parent)&&r.invalidateDownstreamBooleanData(!0)}}(),VU=class{constructor(e,t,n,i,r,s,a){this.object=e,this.id=t,this.data=n,this.dropDestIds=[],this.activeIdx=null,this.wasDragEventTriggered=!1,this.resetDampingFactor=0===this.data.resetSpeed?1:8/this.data.resetSpeed+1,this.snapDampingFactor=0===this.data.snapSpeed?1:8/this.data.snapSpeed+1,this.actionsDrag=dF(n,n.dragDropActions.drag,i,r,s,this.object),this.actionsDrop=dF(n,n.dragDropActions.drop,i,r,s,this.object);let o=[];this.data.objects.forEach((e=>{let t=i.find(e);!t||!1!==t.data.visible&&(o.push(t),a[t.uuid]&&a[t.uuid].forEach((e=>{let t=i.find(e);!t||!1!==t.data.visible&&o.push(t)})))})),this.data.dropDestinations.forEach((e=>{let t=i.find(e);!t||!1!==t.data.visible&&(this.dropDestIds.push(t.uuid),a[t.uuid]&&a[t.uuid].forEach((e=>{let t=i.find(e);!t||!1!==t.data.visible&&this.dropDestIds.push(t.uuid)})))})),this.dragItems=o.map((e=>("locked"===this.data.planeMode&&(e.userData.lockedPlane=!0),e.userData.worldPosition0=(new Bt).setFromMatrixPosition(e.matrixWorld),{obj:e,fromPosition:(new Bt).setFromMatrixPosition(e.matrixWorld),pointStart:new Bt,pointEnd:new Bt,paused:!0,currentDampingFactor:this.data.dampingFactor,reset:!1,position0:(new Bt).copy(e.position),quat0:(new Lt).copy(e.quaternion),snapped:!1,orientationMatrix:new pn,limits:this.data.limits,reference:this.data.referenceFrame})))}get activeDragItem(){return null!==this.activeIdx?this.dragItems[this.activeIdx]:null}dispose(){pF(this.actionsDrag),pF(this.actionsDrop),this.dragItems.forEach((e=>{e.fromPosition.copy(e.obj.userData.worldPosition0),e.pointStart.copy(e.fromPosition),e.pointEnd.copy(e.pointStart),e.obj.recursiveBBoxNeedsUpdate=!0,e.obj.userData.lockedPlane=void 0,e.obj.position.copy(e.position0),e.obj.quaternion.copy(e.quat0),e.obj.updateMatrix()}))}},GU=class extends dU{constructor(e,t){super(e),this.eventManager=t,this.events=[],this.lastDropDestination=null,this.dragTimeout=null,this.onPointerDown=e=>{if(Fm.length>1)return;this.eventContext.updateRaycaster(e);let{raycaster:t,page:n}=this.eventContext,i=n.raycastWithClones(t);if(this.lastDropDestination=null,0!==i.length){for(let e of this.events){let t=0;for(let{obj:n,pointEnd:s,pointStart:a}of e.dragItems){if(n===i[0].object||n===i[0].object.object||XS.is(n)&&n.isAncestorOf(i[0].object.uuid)){var r;if(e.activeIdx=t,e.activeDragItem.reset=!1,e.activeDragItem.currentDampingFactor=e.data.dampingFactor,e.activeDragItem.snapped=!1,"hand"===e.data.cursor&&this.setCursor("grabbing"),this.eventManager.controlsManager.usePhysics){e.activeDragItem.obj.rigidBody&&e.activeDragItem.obj.rigidBody.setBodyType(2,!0);let t=e.activeDragItem.obj;n.hasNonUniformScale&&n.updateMatrixWorldSVD(),(t.hasNonUniformScale?t.matrixWorldRigid:t.matrixWorld).decompose(DU,RU,OU),kU.setFromQuaternion(RU),void 0===t.prevR?(t.prevR=kU.clone(),t.prevT=DU.clone()):(t.prevR.copy(kU),t.prevT.copy(DU)),this.eventManager.controlsManager.sharedGameControlGlobals.entitiesWithTransformAnim.push(e.activeDragItem.obj)}return this.calcPlaneIntersectPos(n,a,e.data.plane,e.data.referenceFrame),s.copy(a),(this.eventManager.controlsManager.usePhysics&&"dynamic"===(null===(r=n.data.physics)||void 0===r?void 0:r.rigidBody)||!1===e.data.drop||!1===e.data.resetOnSnapFail)&&e.activeDragItem.fromPosition.setFromMatrixPosition(e.activeDragItem.obj.matrixWorld),this.activeEvent=e,void(this.eventManager.controlsManager.orbitControls&&(this.eventManager.controlsManager.orbitControls.enabled=!1))}t++}}this.activeEvent=null}else this.activeEvent=null},this.onPointerMove=e=>{if(Fm.length>1)return;this.eventContext.updateRaycaster(e);let{raycaster:t,page:n}=this.eventContext,i=n.raycastWithClones(t);if(0!==Fm.length){if(this.activeEvent&&this.activeEvent.activeDragItem){let e,t=this.activeEvent.activeDragItem;if(t.snapped=!1,this.activeEvent.data.drop&&(e=i.filter((e=>t.obj!==e.object&&!t.obj.isAncestorOf(e.object.uuid)&&!(e.object instanceof nI)&&("all"===this.activeEvent.data.dropOn||this.activeEvent.dropDestIds.some((t=>t===e.object.uuid||n.scene.find(t).isAncestorOf(e.object.uuid))))))[0]),e){let n=IU.copy(e.face.normal).applyMatrix3(BU.getNormalMatrix(e.object.matrixWorld));if("center"===this.activeEvent.data.snapTo)t.fromPosition.setFromMatrixPosition(e.object.matrixWorld);else if("surface"===this.activeEvent.data.snapTo){if(t.fromPosition.copy(e.point),"bbox"===this.activeEvent.data.snapSurfaceMode){DU.copy(n).applyMatrix3(BU.setFromMatrix4(t.obj.matrixWorld).transpose());let e=t.obj;DU.x>FU?OU.x=-e.recursiveBBox.min.x:DU.x<-FU&&(OU.x=-e.recursiveBBox.max.x),DU.y>FU?OU.y=-e.recursiveBBox.min.y:DU.y<-FU&&(OU.y=-e.recursiveBBox.max.y),DU.z>FU?OU.z=-e.recursiveBBox.min.z:DU.z<-FU&&(OU.z=-e.recursiveBBox.max.z),OU.applyMatrix3(BU.invert())}else OU.copy(n).multiplyScalar(this.activeEvent.data.snapSurfaceOffset);t.fromPosition.add(OU)}this.activeEvent.data.autoOrient&&(DU.set(0,1,0).cross(n),DU.length()<1e-4&&DU.set(-1,0,0).cross(n),OU.crossVectors(IU,DU),t.orientationMatrix.makeBasis(DU,OU,n)),t.pointStart.copy(t.fromPosition),t.pointEnd.copy(t.pointStart),t.currentDampingFactor=this.activeEvent.snapDampingFactor,t.snapped=!0,this.lastDropDestination!==e.object&&(this.lastDropDestination=e.object,this.activeEvent.actionsDrop.Transition.forEach((e=>{e.play()})),this.activeEvent.actionsDrop.Animation.forEach((e=>{e.play()})),this.activeEvent.actionsDrop.Audio.forEach((e=>{e.dispatchGameControl("start")})),this.activeEvent.actionsDrop.Particles.forEach((e=>{e.dispatchGameControl("start")})),this.activeEvent.actionsDrop.Create.forEach((e=>{e.dispatchThrottled()})))}else t.orientationMatrix.makeRotationFromQuaternion(t.quat0),this.lastDropDestination=null,t.currentDampingFactor=this.activeEvent.data.dampingFactor,this.calcPlaneIntersectPos(t.obj,t.pointEnd,this.activeEvent.data.plane,this.activeEvent.data.referenceFrame),this.activeEvent.actionsDrop.Transition.forEach((e=>{e.stop(),null!==e.object.currentState&&e.object.changeSelectedState(null,{scene:this.eventContext.page.scene,shared:this.eventContext.sharedAssets})})),this.activeEvent.actionsDrop.Animation.forEach((e=>{e.stop()})),this.activeEvent.actionsDrop.Audio.forEach((e=>{e.dispatchGameControl("stop")})),this.activeEvent.actionsDrop.Particles.forEach((e=>{e.dispatchGameControl("stop")}));this.activeEvent.actionsDrag.Create.forEach((e=>{e.dispatchThrottled()})),this.activeEvent.actionsDrag.SetVariable.forEach((e=>e.checkConditions())),this.activeEvent.actionsDrag.SetVariable.forEach((e=>e.dispatch())),this.activeEvent.actionsDrag.DynamicVariablePlay.forEach((e=>e.dispatch())),this.activeEvent.actionsDrag.ClearLocalStorage.forEach((e=>e.dispatch())),this.activeEvent.actionsDrag.UserAPI.forEach((e=>e.dispatch())),!1===this.activeEvent.wasDragEventTriggered&&(this.activeEvent.wasDragEventTriggered=!0,this.activeEvent.actionsDrag.Transition.forEach((e=>{e.play()})),this.activeEvent.actionsDrag.Animation.forEach((e=>{e.play()})),this.activeEvent.actionsDrag.Audio.forEach((e=>{e.dispatchGameControl("start")})),this.activeEvent.actionsDrag.Particles.forEach((e=>{e.dispatchGameControl("start")}))),this.dragTimeout&&window.clearTimeout(this.dragTimeout),this.dragTimeout=window.setTimeout((()=>{!this.activeEvent||(this.activeEvent.wasDragEventTriggered=!1,this.activeEvent.actionsDrag.Audio.forEach((e=>{e.dispatchGameControl("stop")})),this.activeEvent.actionsDrag.Particles.forEach((e=>{e.dispatchGameControl("stop")})),this.activeEvent.actionsDrag.Transition.forEach((e=>{e.stop(),null!==e.object.currentState&&e.object.changeSelectedState(null,{scene:this.eventContext.page.scene,shared:this.eventContext.sharedAssets})})),this.activeEvent.actionsDrag.Animation.forEach((e=>{e.stop()})))}),500),this.updateDragItem(t),t.obj.dispatchEvent({type:"requestRender"})}}else{let e=!1;for(let t of this.events){for(let{obj:n}of t.dragItems){var r,s,a;if(n===(null===(r=i[0])||void 0===r?void 0:r.object)||n===(null===(s=i[0])||void 0===s||null===(s=s.object)||void 0===s?void 0:s.object)||XS.is(n)&&n.isAncestorOf(null===(a=i[0])||void 0===a?void 0:a.object.uuid)){switch(e=!0,t.data.cursor){case"hand":this.setCursor("grab");break;case"move":this.setCursor("move")}break}}if(e)break}e||this.setCursor("default")}},this.onPointerUp=e=>{if(this.activeEvent&&this.activeEvent.activeDragItem){var t;"hand"===this.activeEvent.data.cursor&&this.setCursor("grab");let e="dynamic"===(null===(t=this.activeEvent.activeDragItem.obj.data.physics)||void 0===t?void 0:t.rigidBody);!1===this.activeEvent.activeDragItem.snapped&&this.activeEvent.data.drop&&this.activeEvent.data.resetOnSnapFail&&(!1===this.eventManager.controlsManager.usePhysics||!e)&&(this.activeEvent.activeDragItem.reset=this.activeEvent.data.resetOnSnapFail,this.activeEvent.activeDragItem.paused=!1,this.activeEvent.activeDragItem.currentDampingFactor=this.activeEvent.resetDampingFactor),this.eventManager.controlsManager.usePhysics&&e&&(this.eventManager.controlsManager.sharedGameControlGlobals.entitiesWithTransformAnim.pop(),this.activeEvent.activeDragItem.obj.rigidBody.setBodyType(0,!0),this.activeEvent.activeDragItem.paused=!0),!0===this.activeEvent.wasDragEventTriggered&&(this.activeEvent.wasDragEventTriggered=!1,this.activeEvent.actionsDrag.Transition.forEach((e=>{e.stop(),null!==e.object.currentState&&e.object.changeSelectedState(null,{scene:this.eventContext.page.scene,shared:this.eventContext.sharedAssets})})),this.activeEvent.actionsDrag.Animation.forEach((e=>{e.stop()})),this.activeEvent.actionsDrag.Audio.forEach((e=>{e.dispatchGameControl("stop")})),this.activeEvent.actionsDrag.Particles.forEach((e=>{e.dispatchGameControl("stop")})),this.activeEvent.actionsDrop.SetVariable.forEach((e=>e.checkConditions())),this.activeEvent.actionsDrop.SetVariable.forEach((e=>e.dispatch())),this.activeEvent.actionsDrop.DynamicVariablePlay.forEach((e=>e.dispatch())),this.activeEvent.actionsDrop.ClearLocalStorage.forEach((e=>e.dispatch())),this.activeEvent.actionsDrop.UserAPI.forEach((e=>e.dispatch()))),this.eventManager.controlsManager.orbitControls&&(this.eventManager.controlsManager.orbitControls.enabled=!0)}}}connect(){let e={};if(this.eventContext.page.traverseEntity((t=>{t.component&&(e[t.component.uuid]?e[t.component.uuid].push(t.uuid):e[t.component.uuid]=[t.uuid])})),this.eventContext.page.traverseEntity((t=>{var n;null===(n=t.data)||void 0===n||n.events.filter((e=>"DragDrop"===e.data.type&&!e.data.disabled)).forEach((n=>{this.events.push(new VU(t,n.id,n.data,this.eventContext.page,this.eventContext.sharedAssets,this.eventManager,e))}))})),!this.events.length)return;this.domEventsNeeded.clear(),this.domEventsNeeded.add("pointerdown");let t=this.eventContext.domElement;t.addEventListener("pointerdown",this.onPointerDown),t.addEventListener("pointermove",this.onPointerMove),t.addEventListener("pointerup",this.onPointerUp),this.domEventsNeeded.add("pointermove")}disconnect(){if(!this.events.length)return;this.domEventsNeeded.clear();let e=this.eventContext.domElement;e.removeEventListener("pointerdown",this.onPointerDown),e.removeEventListener("pointermove",this.onPointerMove),e.removeEventListener("pointerup",this.onPointerUp),this.events.forEach((e=>e.dispose()))}setCursor(e){this.eventContext.domElement.style.cursor=e}onAnimationFrameDamping(){for(let e of this.events)for(let t of e.dragItems)t.paused||this.updateDragItem(t,!0)}calcPlaneIntersectPos(e,t,n,i){let{getCamera:r,raycaster:s}=this.eventContext;r().getWorldDirection(MU),MU.negate();let a=RU.identity();switch("parent"===i?LU.multiplyMatrices(e.parent.matrixWorld,e.hiddenMatrix).decompose(DU,a,OU):"local"===i&&e.matrixWorld.decompose(DU,a,OU),n){case"x":DU.set(1,0,0).applyQuaternion(a),zU.copy(MU).cross(DU),NU.copy(DU).cross(zU);break;case"y":DU.set(0,1,0).applyQuaternion(a),zU.copy(MU).cross(DU),NU.copy(DU).cross(zU);break;case"z":DU.set(0,0,1).applyQuaternion(a),zU.copy(MU).cross(DU),NU.copy(DU).cross(zU);break;case"xy":NU.set(0,0,1).applyQuaternion(a);break;case"yz":NU.set(1,0,0).applyQuaternion(a);break;case"xz":NU.set(0,1,0).applyQuaternion(a);break;case"adaptive":MU.angleTo(OU.set(0,1,0))>Math.PI/6?(DU.crossVectors(OU.set(0,1,0),MU),NU.crossVectors(DU,OU)):NU.set(0,1,0);break;default:NU.copy(MU)}TU.setFromMatrixPosition(e.matrixWorld);let o=e.userData.lockedPlane?e.userData.worldPosition0:TU;if(PU.setFromNormalAndCoplanarPoint(NU,o),s.ray.intersectPlane(PU,t)&&("x"===n||"y"===n||"z"===n)){let e=OU.subVectors(t,o).dot(DU);t.copy(o).addScaledVector(DU,e)}}updateDragItem(e){var t,n;let i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];TU.setFromMatrixPosition(e.obj.matrixWorld),"current"===e.reset?CU.subVectors(e.fromPosition,TU).divideScalar(e.currentDampingFactor):"original"===e.reset?(CU.subVectors(e.obj.userData.worldPosition0,TU).divideScalar(e.currentDampingFactor),e.fromPosition.copy(e.obj.userData.worldPosition0),e.pointStart.copy(e.fromPosition),e.pointEnd.copy(e.pointStart)):CU.subVectors(e.pointEnd,e.pointStart).add(e.fromPosition).sub(TU).divideScalar(e.currentDampingFactor),e.paused=!(e.currentDampingFactor>1)||CU.length()<.01,(this.activeEvent&&1===this.activeEvent.data.dampingFactor||i)&&jU(e,CU.add(TU),null!==(t=this.activeEvent)&&void 0!==t&&t.data.drop&&null!==(n=this.activeEvent)&&void 0!==n&&n.data.autoOrient?e.orientationMatrix:null),e.obj.dispatchEvent({type:"beginEvent",eventName:"DragDrop"}),this.eventManager.requestRender()}},HU=new Bt,WU=new Bt,qU=new Bt,XU=new Bt,YU=new Gi,QU={type:"requestRender"},KU=function(){let e=new Bt,t=new Bt;return(n,i,r)=>r>0?(e.subVectors(n,i),e.length()<=r?n:t.copy(i).add(e.normalize().multiplyScalar(r))):i}(),ZU=function(){let e=new pn;return(t,n)=>{t.position.copy(n),null!==t.parent&&(e.copy(t.parent.matrixWorld).invert(),t.position.applyMatrix4(e)),e.copy(t.hiddenMatrix).invert(),t.position.applyMatrix4(e),t.updateMatrix(),t.hasNonUniformScale&&(t.updateMatrixWorld(),t.updateMatrixWorldSVD()),t instanceof UC&&QO(t.parent)&&t.invalidateDownstreamBooleanData(!0)}}(),JU=class{constructor(e,t,n,i,r,s){this.data=e,this.id=t,this.object=n,this.paused=!1,this.currentDampingFactor=1,this.snapComplete=!1,this.isReset=!1,this.worldPosition0=new Bt,this.timeoutId=null,this.delayFinished=!0,this.wasOutside=!1,this.data=o(o(o({},Py.defaultData),e),void 0===e.resetOnPointerLeave&&{resetOnPointerLeave:!1}),void 0===e.target||"cursor"===e.target||(this.target=i.find(e.target)),this.data.dampingFactor&&(this.currentDampingFactor=this.data.dampingFactor),this.resetDampingFactor=80/this.data.resetSpeed+1,this.object.getWorldPosition(this.worldPosition0),this.actions=dF(e,e.actions,i,r,s,n)}},$U=class extends dU{constructor(e,t){super(e),this.eventManager=t,this.events=[],this.pairOfEventListeners=[],this.onMouseMove=e=>{if(!(Fm.length>1)){this.eventContext.updateRaycaster(e);for(let e of this.events)void 0===e.target&&this.updateSingleEvent(e)}},this.onMouseEnter=e=>{for(let t of this.events)void 0===t.target&&(t.isReset=!1,t.currentDampingFactor=t.data.dampingFactor)},this.onMouseLeave=e=>{for(let t of this.events)void 0===t.target&&(t.data.resetOnPointerLeave&&(t.isReset=!0,t.currentDampingFactor=t.resetDampingFactor),this.updateSingleEvent(t))},this.onTargetChange=e=>()=>{this.updateSingleEvent(e)}}connect(){let{page:e}=this.eventContext;if(e.traverseEntity((t=>{var n,i;let r=null===(n=t.data)||void 0===n?void 0:n.events.find((e=>"Follow"===e.data.type&&!e.data.disabled));r&&(!e.data.globalPhysics.usePhysics||"dynamic"!==(null===(i=t.dataPatched.physics)||void 0===i?void 0:i.rigidBody))&&this.events.push(new JU(r.data,r.id,t,e,this.eventContext.sharedAssets,this.eventManager))})),!this.events.length)return;let{domElement:t,eventElement:n}=this.eventContext;this.domEventsNeeded.clear(),Rm&&(this.domEventsNeeded.add("pointerdown"),t.addEventListener("pointerdown",this.onMouseMove)),this.domEventsNeeded.add("pointermove"),n.addEventListener("pointermove",this.onMouseMove),this.eventContext.useWindowEvents||(t.addEventListener("pointerenter",this.onMouseEnter),t.addEventListener("pointerleave",this.onMouseLeave));for(let i of this.events)if(void 0!==i.target){let e=i.target,t=this.onTargetChange(i);this.pairOfEventListeners.push([e,t]),e.addEventListener("requestRender",t)}}disconnect(){if(!this.events.length)return;let{domElement:e,eventElement:t}=this.eventContext;this.domEventsNeeded.clear(),Rm&&e.removeEventListener("pointerdown",this.onMouseMove),t.removeEventListener("pointermove",this.onMouseMove),e.removeEventListener("pointerenter",this.onMouseEnter),e.removeEventListener("pointerleave",this.onMouseLeave);for(let[n,i]of this.pairOfEventListeners)n.removeEventListener("requestRender",i);for(let n of this.events)n.paused=!0,n.isReset=!1,pF(n.actions)}onAnimationFrameDamping(){for(let e of this.events)e.paused||this.updateSingleEvent(e,!0)}updateSingleEvent(e){var t;let n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.events.forEach((e=>{e.actions.Create.forEach((e=>{e.dispatchThrottled()}))}));let{plane:i,limitDistance:r,limitDistanceEnabled:s}=e.data;if(e.object.getWorldPosition(qU),e.isReset)XU.copy(e.worldPosition0);else if(e.target)e.target.getWorldPosition(XU);else{let{getCamera:e,raycaster:t}=this.eventContext;if("custom"===i?(e().getWorldDirection(WU),WU.negate(),HU.copy(WU)):"xy"===i?HU.set(0,0,1):"xz"===i?HU.set(0,1,0):"yz"===i&&HU.set(1,0,0),YU.setFromNormalAndCoplanarPoint(HU,qU),!t.ray.intersectPlane(YU,XU))return}if(!e.isReset)if(XU.distanceTo(e.worldPosition0)>r&&s&&e.target){if(e.snapComplete=!1,e.data.snapDelay&&(e.delayFinished=!1,typeof window<"u"&&null!==e.timeoutId&&(window.clearTimeout(e.timeoutId),e.timeoutId=null)),e.wasOutside=!0,!e.data.resetAfterDistanceLimit)return;XU.copy(e.worldPosition0),e.currentDampingFactor=e.resetDampingFactor}else if(e.wasOutside&&(e.data.snapDelay&&typeof window<"u"&&(e.timeoutId=window.setTimeout((()=>{e.delayFinished=!0,e.paused=!1,this.updateSingleEvent(e)}),1e3*e.data.snapDelay)),e.currentDampingFactor=e.data.dampingFactor,e.wasOutside=!1),!1===e.delayFinished)return;!1===e.data.enabledTranslation[0]&&(XU.x=qU.x),!1===e.data.enabledTranslation[1]&&(XU.y=qU.y),!1===e.data.enabledTranslation[2]&&(XU.z=qU.z);let a=KU(qU,XU,e.wasOutside?0:e.data.maxDelta);if(e.currentDampingFactor>1){let t=HU.subVectors(a,qU).divideScalar(e.currentDampingFactor);qU.add(t),n&&ZU(e.object,qU),e.paused=t.length()<.01}else ZU(e.object,a),e.paused=!0;null!==(t=e.object)&&void 0!==t&&t.dispatchEvent({type:"beginEvent",eventName:"Follow"}),e.object.dispatchEvent(QU)}},ej=new Bt,tj=new Bt,nj=new pn,ij=new Lt,rj=new Lt,sj=new Bt,aj=new Bt,oj=new Bt,lj=new Bt,cj=new Gi,hj={type:"requestRender"},uj={type:"changeRotation"},dj=function(){let e=new pn;return function(t,n){null!==t.parent?e.multiplyMatrices(t.parent.matrixWorld,t.hiddenMatrix):e.copy(t.hiddenMatrix),n.premultiply(tU(e).invert()),t.rotation.setFromRotationMatrix(n),t.updateMatrix(),t instanceof UC&&QO(t.parent)&&t.invalidateDownstreamBooleanData(!0)}}(),pj=class{constructor(e,t,n,i){this.id=t,this.object=n,this.paused=!1,this.currentDampingFactor=1,this.isReset=!1,this.worldQuaternion0=new Lt,this.timeoutId=null,this.delayFinished=!0,this.wasOutside=!1,this.data=o(o(o({},Dy.defaultData),e),void 0===e.resetOnPointerLeave&&{resetOnPointerLeave:!1}),void 0===e.target||"cursor"===e.target||(this.target=i.find(e.target)),this.data.dampingFactor&&(this.currentDampingFactor=this.data.dampingFactor),this.object.getWorldQuaternion(this.worldQuaternion0),this.resetDampingFactor=80/this.data.resetSpeed+1}},fj=class extends dU{constructor(){super(...arguments),this.events=[],this.pairOfEventListeners=[],this.pairOfUserEventListeners=[],this.onMouseMove=e=>{if(!(Fm.length>1)){this._lastMouseEvent=e,this.eventContext.updateRaycaster(e);for(let e of this.events)void 0===e.target&&this.updateSingleEvent(e)}},this.onMouseEnter=e=>{for(let t of this.events)void 0===t.target&&(t.isReset=!1,t.currentDampingFactor=t.data.dampingFactor)},this.onMouseLeave=e=>{for(let t of this.events)void 0===t.target&&(t.data.resetOnPointerLeave&&(t.isReset=!0,t.currentDampingFactor=t.resetDampingFactor),this.updateSingleEvent(t))},this.onScroll=e=>{if(this._lastMouseEvent){let e=new PointerEvent("pointermove",{clientX:this._lastMouseEvent.clientX,clientY:this._lastMouseEvent.clientY,bubbles:!0,cancelable:!0,view:window});this.eventContext.eventElement.dispatchEvent(e)}},this.onTargetChange=e=>()=>{this.updateSingleEvent(e)},this.createUserEventListener=e=>t=>{let{eventName:n,target:i}=t;if(!n||!i)return;let r=mU(n);r&&"LookAt"===r&&this.updateSingleEvent(e)}}connect(){let{page:e}=this.eventContext;if(e.traverseEntity((t=>{var n,i;let r=null===(n=t.data)||void 0===n?void 0:n.events.find((e=>"LookAt"===e.data.type&&!e.data.disabled));r&&(!e.data.globalPhysics.usePhysics||"dynamic"!==(null===(i=t.dataPatched.physics)||void 0===i?void 0:i.rigidBody))&&this.events.push(new pj(r.data,r.id,t,e))})),!this.events.length)return;let{domElement:t,eventElement:n}=this.eventContext;this.domEventsNeeded.clear(),Rm&&(this.domEventsNeeded.add("pointerdown"),t.addEventListener("pointerdown",this.onMouseMove)),this.domEventsNeeded.add("pointermove"),n.addEventListener("pointermove",this.onMouseMove),this.eventContext.useWindowEvents?n.addEventListener("scroll",this.onScroll):(t.addEventListener("pointerenter",this.onMouseEnter),t.addEventListener("pointerleave",this.onMouseLeave));for(let i of this.events){if(void 0!==i.target){let e=this.onTargetChange(i),t=i.target;this.pairOfEventListeners.push([t,e]),t.addEventListener("requestRender",e)}let e=this.createUserEventListener(i),t=i.object;this.pairOfUserEventListeners.push([t,e]),t.addEventListener("userEvent",e)}}disconnect(){if(!this.events.length)return;let{domElement:e,eventElement:t}=this.eventContext;this.domEventsNeeded.clear(),Rm&&e.removeEventListener("pointerdown",this.onMouseMove),t.removeEventListener("pointermove",this.onMouseMove),e.removeEventListener("pointerenter",this.onMouseEnter),e.removeEventListener("pointerleave",this.onMouseLeave),t.removeEventListener("scroll",this.onScroll);for(let[n,i]of this.pairOfEventListeners)n.removeEventListener("requestRender",i);for(let[n,i]of this.pairOfUserEventListeners)n.removeEventListener("userEvent",i);for(let n of this.events)n.paused=!0,n.isReset=!1}onAnimationFrameDamping(){for(let e of this.events)e.paused||this.updateSingleEvent(e)}updateSingleEvent(e){var t;let{tilt:n,axis:i,distance:r,plane:s,limitDistance:a,enabledRotation:o,limitDistanceEnabled:l}=e.data,{getCamera:c,raycaster:h}=this.eventContext,{object:u,target:d}=e;if(u.getWorldPosition(sj),!e.isReset)if(e.target)e.target.getWorldPosition(aj);else{if("custom"===s?(c().getWorldDirection(tj),tj.negate(),cj.setFromNormalAndCoplanarPoint(tj,sj)):("xy"===s?ej.set(0,0,1):"xz"===s?ej.set(0,1,0):"yz"===s&&ej.set(1,0,0),cj.setFromNormalAndCoplanarPoint(ej,sj)),!h.ray.intersectPlane(cj,aj))return;r>0&&("custom"===s||void 0===s)&&aj.addScaledVector(tj,r)}if(e.isReset||(d?"target"===n?oj.copy(d.up).applyMatrix4(nj.extractRotation(d.matrixWorld)).normalize():o.some((e=>!1===e))?("x"===i?(lj.set(0,0,1),!1===o[2]&&lj.set(0,1,0)):"y"===i?(lj.set(1,0,0),!1===o[0]&&lj.set(0,0,1)):(lj.set(0,1,0),!1===o[1]&&lj.set(1,0,0)),oj.copy(lj).applyQuaternion(e.worldQuaternion0).normalize()):oj.set(0,1,0):"custom"===s?oj.set(0,1,0):oj.copy(ej)),e.isReset)rj.copy(e.worldQuaternion0);else if(sj.distanceTo(aj)>a&&l&&d){if(e.data.snapDelay&&(e.delayFinished=!1,typeof window<"u"&&null!==e.timeoutId&&(window.clearTimeout(e.timeoutId),e.timeoutId=null)),e.wasOutside=!0,!e.data.resetAfterDistanceLimit)return;rj.copy(e.worldQuaternion0),e.currentDampingFactor=e.resetDampingFactor}else{if(e.wasOutside&&(e.data.snapDelay&&typeof window<"u"&&(e.timeoutId=window.setTimeout((()=>{e.delayFinished=!0,e.paused=!1,this.updateSingleEvent(e)}),1e3*e.data.snapDelay)),e.currentDampingFactor=e.data.dampingFactor,e.wasOutside=!1),!1===e.delayFinished)return;(function(e,t,n,i,r,s){let a=e.elements;vj.subVectors(t,n),0===vj.lengthSq()&&(vj.z=1),vj.normalize(),gj.crossVectors(i,vj),0===gj.lengthSq()&&(1===Math.abs(i.z)?vj.x+=1e-4:vj.z+=1e-4,vj.normalize(),gj.crossVectors(i,vj)),gj.normalize(),mj.crossVectors(vj,gj),"x"===r?1===s.z?[gj,mj,vj]=[vj,gj,mj]:(gj.negate(),[gj,vj]=[vj,gj]):"y"===r?1===s.x?[gj,mj,vj]=[mj,vj,gj]:(gj.negate(),[mj,vj]=[vj,mj]):1===s.x&&(gj.negate(),[gj,mj]=[mj,gj]),a[0]=gj.x,a[4]=mj.x,a[8]=vj.x,a[1]=gj.y,a[5]=mj.y,a[9]=vj.y,a[2]=gj.z,a[6]=mj.z,a[10]=vj.z})(nj,aj,sj,oj,i,lj),rj.setFromRotationMatrix(nj),ij.setFromUnitVectors(lj.applyQuaternion(rj),oj),o.some((e=>!1===e))&&"target"!==n&&rj.premultiply(ij).normalize()}e.currentDampingFactor>1?(u.updateWorldMatrix(!0,!1),ij.setFromRotationMatrix(tU(u.matrixWorld)),ij.slerp(rj,1/e.currentDampingFactor),dj(u,nj.makeRotationFromQuaternion(ij)),e.paused=8*(1-ij.dot(rj))<1e-6):(dj(u,nj.makeRotationFromQuaternion(rj)),e.paused=!0),null!==(t=e.object)&&void 0!==t&&t.dispatchEvent({type:"beginEvent",eventName:"LookAt"}),u.dispatchEvent(hj),u.dispatchEvent(uj)}},mj=new Bt,gj=new Bt,vj=new Bt;var yj=class{constructor(e,t,n,i,r,s){this.id=e,this.data=t,this.object=n,this.entered=!1,this.actions=dF(t,t.actions,i,r,s,n)}disconnect(){pF(this.actions)}dispatchEnter(){this.actions.Transition.forEach((e=>{e.object.currentTransitionEvent!==this&&(e.object.currentTransitionEvent=this,e.init())})),this.entered||(this.entered=!0,this.actions.Transition.forEach((e=>e.playFromCurrent())),this.actions.Animation.forEach((e=>e.play())),this.actions.Create.forEach((e=>e.dispatchStart())),this.actions.Particles.forEach((e=>e.dispatchBasic())),this.actions.Destroy.forEach((e=>e.dispatch())),this.actions.SwitchCamera.forEach((e=>e.playFromCurrent())),this.actions.SceneTransition.forEach((e=>e.dispatch())),this.actions.SetVariable.forEach((e=>e.checkConditions())),this.actions.SetVariable.forEach((e=>e.dispatch())),this.actions.DynamicVariablePlay.forEach((e=>e.dispatch())),this.actions.ClearLocalStorage.forEach((e=>e.dispatch())),this.actions.UserAPI.forEach((e=>e.dispatch())))}dispatchLeave(){this.actions.Transition.forEach((e=>{e.object.currentTransitionEvent!==this&&(e.object.currentTransitionEvent=this,e.init())})),this.entered&&(this.entered=!1,this.actions.Create.forEach((e=>e.dispatchStop())),this.actions.Transition.forEach((e=>e.reverseFromCurrent())),this.actions.Particles.forEach((e=>e.reverseFromCurrent())),this.actions.SwitchCamera.forEach((e=>e.reverseFromCurrent())))}dispatchUserEvent(e){this.actions.Transition.forEach((e=>{e.object.currentTransitionEvent!==this&&(e.object.currentTransitionEvent=this,e.init())})),e?(this.actions.Transition.forEach((e=>e.reverseFromCurrent())),this.actions.Particles.forEach((e=>e.reverseFromCurrent())),this.actions.Animation.forEach((e=>e.reverseFromCurrent())),this.actions.SwitchCamera.forEach((e=>e.reverseFromCurrent()))):(this.actions.Transition.forEach((e=>e.playFromCurrent())),this.actions.Animation.forEach((e=>e.playFromCurrent())),this.actions.Create.forEach((e=>e.dispatch())),this.actions.Particles.forEach((e=>e.dispatchBasic())),this.actions.Destroy.forEach((e=>e.dispatch())),this.actions.SwitchCamera.forEach((e=>e.playFromCurrent()))),this.actions.SceneTransition.forEach((e=>e.dispatch())),this.actions.SetVariable.forEach((e=>e.checkConditions())),this.actions.SetVariable.forEach((e=>e.dispatch())),this.actions.DynamicVariablePlay.forEach((e=>e.dispatch())),this.actions.ClearLocalStorage.forEach((e=>e.dispatch())),this.actions.UserAPI.forEach((e=>e.dispatch()))}},bj=class extends dU{constructor(e,t){super(e),this.eventManager=t,this.eventsPerObjects={},this.objects=[],this.objects2D=[],this._prevObjects=[],this.onMouseDown=e=>{Fm.length>1||(this.eventContext.updateRaycaster(e),this.handleMouseHoverEvent())},this.onMouseUp=e=>{Fm.length>1||this.handleMouseHoverEvent(!0)},this.onMouseMove=e=>{Fm.length>1||(this.eventContext.updateRaycaster(e),this.handleMouseHoverEvent())},this.onUserEvent=e=>{var t;let{eventName:n,target:i,reverse:r}=e;if(!n||!i)return;let s=mU(n);s&&"MouseHover"===s&&(i.dispatchEvent({type:"beginEvent",eventName:"MouseHover"}),null===(t=this.eventsPerObjects[i.uuid])||void 0===t||t.forEach((e=>e.dispatchUserEvent(r))))}}connect(){let{page:e,sharedAssets:t}=this.eventContext,n=(n,i)=>{var r;if(n.visible&&null!==(r=n.data)&&void 0!==r&&r.events.length){var s;for(let{id:i,data:r}of n.data.events)if(!r.disabled&&"MouseHover"===r.type)try{let s=new yj(i,r,n,e,t,this.eventManager);this.eventsPerObjects[n.uuid]?this.eventsPerObjects[n.uuid].push(s):this.eventsPerObjects[n.uuid]=[s]}catch(HZ){}(null===(s=this.eventsPerObjects[n.uuid])||void 0===s?void 0:s.length)&&this.objects.push(n instanceof vk?i:n)}};if(e.traverseEntity((e=>{var t;(e instanceof SL||e instanceof dL)&&null!==(t=e.frame)&&void 0!==t&&t.traverse((t=>{n(t,e)})),n(e)})),!this.objects.length)return;let{domElement:i}=this.eventContext;this.domEventsNeeded.clear(),Rm&&(this.domEventsNeeded.add("pointerdown"),i.addEventListener("pointerdown",this.onMouseDown),this.domEventsNeeded.add("pointerup"),i.addEventListener("pointerup",this.onMouseUp)),this.domEventsNeeded.add("pointermove"),i.addEventListener("pointermove",this.onMouseMove),this.objects.forEach((e=>{e.addEventListener("userEvent",this.onUserEvent)}))}disconnect(){if(!this.objects.length)return;let{domElement:e}=this.eventContext;this.domEventsNeeded.clear(),Rm&&(e.removeEventListener("pointerdown",this.onMouseDown),e.removeEventListener("pointerup",this.onMouseUp)),e.removeEventListener("pointermove",this.onMouseMove),Object.values(this.eventsPerObjects).forEach((e=>{e.forEach((e=>{e.disconnect()}))})),this.objects.forEach((e=>{e.removeEventListener("userEvent",this.onUserEvent)}))}handleMouseHoverEvent(){let e=[];if(!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])){let{stopRaycast:t,raycaster:n,page:i,pointerScreen:r}=this.eventContext,s=!1;if(i.uiCanvas&&(s=lU(i,[r.x,r.y],Object.keys(this.eventsPerObjects),(t=>{e.push(t)}))),t&&!s){let t=aU(n,i,this.objects);e=oU(t),t.forEach((t=>{var n,i,r,s;t.object instanceof SL&&lU(t.object,[null!==(n=null===t||void 0===t||null===(i=t.uv)||void 0===i?void 0:i.x)&&void 0!==n?n:0,null!==(r=null===t||void 0===t||null===(s=t.uv)||void 0===s?void 0:s.y)&&void 0!==r?r:0],Object.keys(this.eventsPerObjects),(t=>{e.push(t)}))}))}else this.objects.forEach((t=>{var i,r,s,a;let o=cU(n,t);o&&(e.push(t),t instanceof SL&&lU(t,[null!==(i=null===o||void 0===o||null===(r=o.uv)||void 0===r?void 0:r.x)&&void 0!==i?i:0,null!==(s=null===o||void 0===o||null===(a=o.uv)||void 0===a?void 0:a.y)&&void 0!==s?s:0],Object.keys(this.eventsPerObjects),(t=>{e.push(t)})))}))}this._prevObjects.length&&this._prevObjects.forEach((t=>{var n;e.includes(t)||(t.dispatchEvent({type:"beginEvent",eventName:"MouseHover"}),null===(n=this.eventsPerObjects[t.uuid])||void 0===n||n.forEach((e=>e.dispatchLeave())))})),e.length&&e.forEach((e=>{var t;e.dispatchEvent({type:"beginEvent",eventName:"MouseHover"}),null===(t=this.eventsPerObjects[e.uuid])||void 0===t||t.forEach((e=>e.dispatchEnter()))})),this._prevObjects=e}},xj=class{constructor(e,t,n,i,r,s){this.id=e,this.data=t,this.object=n,this.scrollCounter=0,this.actions=dF(t,t.actions,i,r,s,n)}connect(){this.scrollCounter=0}disconnect(){pF(this.actions)}dispatch(e){this.actions.Transition.forEach((e=>{e.object.currentTransitionEvent!==this&&(e.object.currentTransitionEvent=this,e.init())}));let t=e>0?1:-1;this.scrollCounter+=t,this.scrollCounter=Math.min(Math.max(this.scrollCounter,0),this.data.steps);let n=this.scrollCounter/this.data.steps;this.actions.Transition.forEach((e=>e.seek(n))),this.actions.Animation.forEach((e=>e.seek(t))),this.actions.Create.forEach((e=>e.dispatchThrottled())),this.actions.SetVariable.forEach((e=>e.checkConditions())),this.actions.SetVariable.forEach((e=>e.dispatch())),this.actions.DynamicVariablePlay.forEach((e=>e.dispatch())),this.actions.ClearLocalStorage.forEach((e=>e.dispatch())),this.actions.UserAPI.forEach((e=>e.dispatch()))}dispatchUserEvent(e){this.actions.Transition.forEach((e=>{e.object.currentTransitionEvent!==this&&(e.object.currentTransitionEvent=this,e.init())})),e?(this.actions.Transition.forEach((e=>e.reverseFromCurrent())),this.actions.Animation.forEach((e=>e.reverseFromCurrent()))):(this.actions.Transition.forEach((e=>{e.playFromCurrent()})),this.actions.Animation.forEach((e=>{e.playFromCurrent()}))),this.actions.Create.forEach((e=>e.dispatchThrottled())),this.actions.SetVariable.forEach((e=>e.checkConditions())),this.actions.SetVariable.forEach((e=>e.dispatch())),this.actions.DynamicVariablePlay.forEach((e=>e.dispatch())),this.actions.ClearLocalStorage.forEach((e=>e.dispatch())),this.actions.UserAPI.forEach((e=>e.dispatch()))}},wj=class{constructor(e,t,n,i,r,s,a){this.id=e,this.data=t,this.object=n,this.domElement=s,this.eventManager=a,this.scrollStart=0,this.scrollEnd=0,this.actions=dF(t,t.actions,i,r,a,n)}getStickyParentElement(){let e=this.domElement;for(;e;){if("sticky"===window.getComputedStyle(e).position)return e;e=e.parentElement}return null}computeScrollBounds(){var e,t;let n=this.getStickyParentElement(),i=null===n||void 0===n?void 0:n.parentElement,r=this.domElement.getBoundingClientRect(),s={top:r.top,bottom:r.bottom,left:r.left,right:r.right,width:r.width,height:r.height};if(i){let e=i.getBoundingClientRect(),t=window.getComputedStyle(n),l=parseFloat(t.marginTop)+parseFloat(t.marginBottom),c=parseFloat(t.top),h=parseFloat(t.bottom),u=e.height-l;if(isNaN(c)){if(!isNaN(h)){var a,o;let t=null!==(a=document.body.clientHeight)&&void 0!==a?a:window.innerHeight,n=window.innerWidth-(null!==(o=document.documentElement.clientWidth)&&void 0!==o?o:window.innerWidth);r.bottom===t-h?(s.top+=e.top-r.height+h+n,s.bottom+=e.top-r.height+h+n):r.bottom<t-h&&(s.top-=u-r.height,s.bottom-=u-r.height)}}else r.top===c?(s.top+=e.top-c,s.bottom+=e.top-c):r.top<0&&(s.top-=u-r.height,s.bottom-=u-r.height)}let l=document.body,c=document.documentElement,h=window.pageYOffset||c.scrollTop||l.scrollTop,u=c.clientTop||l.clientTop||0,d=Math.round(s.top+h-u);if("enter"===this.data.startFrom){let e=window.innerHeight,t=s.height,n=this.data.enterAnchor,i="top"===n?e:"bottom"===n?e-t:e-.5*t;this.scrollStart=d-i}else this.scrollStart=0;this.scrollStart+=null!==(e=this.data.startOffset)&&void 0!==e?e:0,this.scrollEnd=this.scrollStart+(null!==(t=this.data.endAfter)&&void 0!==t?t:400),this.box=s,this.computeScroll({x:window.scrollX,y:window.scrollY})}connect(){this.computeScrollBounds()}disconnect(){pF(this.actions)}handleResize(){this.computeScrollBounds()}get isInvalidBox(){return void 0===this.box||0===this.box.width&&0===this.box.height&&0===this.box.top&&0===this.box.bottom}computeScroll(e){let{x:t,y:n}=e;this.actions.Transition.forEach((e=>{e.object.currentTransitionEvent!==this&&(e.object.currentTransitionEvent=this,e.init())}));let i=this.scrollEnd-this.scrollStart,r=Math.min(1,Math.max(0,(n-this.scrollStart)/i));this.actions.Transition.forEach((e=>e.seek(r))),this.actions.Animation.forEach((e=>e.seek(r))),this.actions.Create.forEach((e=>e.dispatchThrottled())),this.actions.SetVariable.forEach((e=>e.checkConditions())),this.actions.SetVariable.forEach((e=>e.dispatch())),this.actions.DynamicVariablePlay.forEach((e=>e.dispatch())),this.actions.ClearLocalStorage.forEach((e=>e.dispatch())),this.actions.UserAPI.forEach((e=>e.dispatch()))}dispatch(e){this.isInvalidBox&&this.computeScrollBounds(),this.computeScroll(e)}dispatchUserEvent(e){this.actions.Transition.forEach((e=>{e.object.currentTransitionEvent!==this&&(e.object.currentTransitionEvent=this,e.init())})),e?(this.actions.Transition.forEach((e=>e.reverseFromCurrent())),this.actions.Animation.forEach((e=>e.reverseFromCurrent()))):(this.actions.Transition.forEach((e=>{e.playFromCurrent()})),this.actions.Animation.forEach((e=>{e.playFromCurrent()}))),this.actions.Create.forEach((e=>e.dispatchThrottled())),this.actions.SetVariable.forEach((e=>e.checkConditions())),this.actions.SetVariable.forEach((e=>e.dispatch())),this.actions.DynamicVariablePlay.forEach((e=>e.dispatch())),this.actions.ClearLocalStorage.forEach((e=>e.dispatch())),this.actions.UserAPI.forEach((e=>e.dispatch()))}},Sj=class extends dU{constructor(e,t){super(e),this.managers=t,this.wheelEventsPerObject=new Map,this.scrollEventsPerObject=new Map,this.isInview=!0,this.handleResize=()=>{[...this.scrollEventsPerObject.entries()].forEach((e=>{let[t,n]=e;n.forEach((e=>e.handleResize()))}))},this.onScroll=e=>{if(!this.isInview)return;let t={y:window.scrollY,x:window.scrollX};[...this.scrollEventsPerObject.entries()].forEach((e=>{let[n,i]=e;n.dispatchEvent({type:"beginEvent",eventName:"Scroll",scroll:t}),i.forEach((e=>e.dispatch(t)))}))},this.onWheel=e=>{!this.isInview||e.ctrlKey||[...this.wheelEventsPerObject.entries()].forEach((t=>{let[n,i]=t;n.dispatchEvent({type:"beginEvent",eventName:"Scroll",deltaY:e.deltaY}),i.forEach((t=>t.dispatch(e.deltaY)))}))},this.onUserEvent=e=>{var t;let{eventName:n,target:i,reverse:r}=e;if(!n||!i)return;let s=mU(n);s&&"Scroll"===s&&(i.dispatchEvent({type:"beginEvent",eventName:"Scroll"}),null===(t=this.wheelEventsPerObject.get(i))||void 0===t||t.forEach((e=>{e.dispatchUserEvent(r)})))}}connect(){let{page:e,sharedAssets:t,domElement:n,isExport:i}=this.eventContext,r=r=>{var s;if(null!==(s=r.data)&&void 0!==s&&s.events.length)for(let{id:l,data:c}of r.data.events)if(!c.disabled&&"Scroll"===c.type)if("load"!==c.trigger&&i){var a;let i=new wj(l,c,r,e,t,n,this.managers);this.scrollEventsPerObject.has(r)?null===(a=this.scrollEventsPerObject.get(r))||void 0===a||a.push(i):this.scrollEventsPerObject.set(r,[i])}else{var o;let n=new xj(l,c,r,e,t,this.managers);this.wheelEventsPerObject.has(r)?null===(o=this.wheelEventsPerObject.get(r))||void 0===o||o.push(n):this.wheelEventsPerObject.set(r,[n])}};e.traverseEntity((e=>{var t;(e instanceof SL||e instanceof dL)&&null!==(t=e.frame)&&void 0!==t&&t.traverse((e=>{r(e)})),r(e)})),this.intersectionObserver=new IntersectionObserver((e=>{let t=e[0];t&&(this.isInview=t.isIntersecting)}),{root:null}),this.intersectionObserver.observe(this.eventContext.domElement),[...this.wheelEventsPerObject.entries()].forEach((e=>{let[t,n]=e;n.forEach((e=>e.connect())),t.addEventListener("userEvent",this.onUserEvent)})),[...this.scrollEventsPerObject.entries()].forEach((e=>{let[t,n]=e;n.forEach((e=>e.connect())),t.addEventListener("userEvent",this.onUserEvent)})),[...this.wheelEventsPerObject.values()].some((e=>e.length))&&(this.domEventsNeeded.add("wheel"),window.addEventListener("wheel",this.onWheel)),[...this.scrollEventsPerObject.values()].some((e=>e.length))&&(this.domEventsNeeded.add("scroll"),window.addEventListener("scroll",this.onScroll),window.addEventListener("resize",this.handleResize))}disconnect(){window.removeEventListener("wheel",this.onWheel),window.removeEventListener("scroll",this.onScroll),window.removeEventListener("resize",this.handleResize),this.intersectionObserver.unobserve(this.eventContext.domElement),this.domEventsNeeded.clear(),[...this.wheelEventsPerObject.entries()].forEach((e=>{let[t,n]=e;n.forEach((e=>e.disconnect())),t.removeEventListener("userEvent",this.onUserEvent)})),[...this.scrollEventsPerObject.entries()].forEach((e=>{let[t,n]=e;n.forEach((e=>e.disconnect())),t.removeEventListener("userEvent",this.onUserEvent)}))}},_j=class{constructor(e,t,n,i,r,s){this.id=e,this.data=t,this.object=n,this.actions=dF(t,t.actions,i,r,s,n)}disconnect(){pF(this.actions)}dispatch(){this.actions.Transition.forEach((e=>{e.play()})),this.actions.Animation.forEach((e=>{e.play()})),this.actions.SwitchCamera.forEach((e=>{e.play()})),this.actions.SceneTransition.forEach((e=>{e.dispatch()})),this.actions.Reset.forEach((e=>e.dispatch())),this.actions.SetVariable.forEach((e=>e.checkConditions())),this.actions.SetVariable.forEach((e=>e.dispatch())),this.actions.DynamicVariablePlay.forEach((e=>e.dispatch())),this.actions.ClearLocalStorage.forEach((e=>e.dispatch())),this.actions.UserAPI.forEach((e=>e.dispatch())),this.actions.Create.forEach((e=>{e.dispatchFromStart()})),this.actions.Destroy.forEach((e=>{e.dispatchFromStart()}))}dispatchAfter(e){this.actions.Audio.forEach((t=>{var n;(null!==(n=t.interaction.data.triggerAfter)&&void 0!==n?n:"any")===e&&(t.interaction instanceof iz?t.interaction.audioPlayer.play():t.interaction instanceof rz&&t.interaction.dispatch())})),this.actions.Video.forEach((t=>{var n;let i=null!==(n=t.interaction.data.triggerAfter)&&void 0!==n?n:"autoplay";i===e&&(t.interaction instanceof gF?t.interaction.play("autoplay"===i):t.interaction instanceof vF&&t.interaction.dispatch())})),this.actions.Particles.forEach((t=>{var n;(null!==(n=t.data.triggerAfter)&&void 0!==n?n:"any")===e&&t.dispatchBasic()}))}dispatchUserEvent(e){this.actions.Transition.forEach((e=>{e.object.currentTransitionEvent!==this&&(e.object.currentTransitionEvent=this,e.init())})),e?(this.actions.Transition.forEach((e=>e.reverseFromCurrent())),this.actions.Animation.forEach((e=>e.reverseFromCurrent())),this.actions.SwitchCamera.forEach((e=>e.reverseFromCurrent()))):(this.actions.Transition.forEach((e=>e.playFromCurrent())),this.actions.Animation.forEach((e=>e.playFromCurrent())),this.actions.SwitchCamera.forEach((e=>e.playFromCurrent()))),this.actions.SceneTransition.forEach((e=>e.dispatch())),this.actions.Reset.forEach((e=>e.dispatch())),this.actions.SetVariable.forEach((e=>e.checkConditions())),this.actions.SetVariable.forEach((e=>e.dispatch())),this.actions.DynamicVariablePlay.forEach((e=>e.dispatch())),this.actions.ClearLocalStorage.forEach((e=>e.dispatch())),this.actions.UserAPI.forEach((e=>e.dispatch())),this.actions.Create.forEach((e=>{e.dispatch()})),this.actions.Destroy.forEach((e=>{e.dispatch()})),this.actions.Audio.forEach((e=>{e.interaction instanceof iz?e.interaction.audioPlayer.play():e.interaction instanceof rz&&e.interaction.dispatch()})),this.actions.Video.forEach((e=>{e.interaction instanceof gF?e.interaction.play():e.interaction instanceof vF&&e.interaction.dispatch()})),this.actions.Particles.forEach((e=>{e.dispatchBasic()}))}},Ej=class extends dU{constructor(e,t){super(e),this.eventManager=t,this.eventsPerObject=new Map,this.eventsAfterPerObject=new Map,this.onMouseDown=()=>{[...this.eventsAfterPerObject.entries()].forEach((e=>{let[t,n]=e;t.dispatchEvent({type:"beginEvent",eventName:"Start"}),n.forEach((e=>{e.dispatchAfter("mouseDown")}))}))},this.onKeyDown=()=>{[...this.eventsAfterPerObject.entries()].forEach((e=>{let[t,n]=e;t.dispatchEvent({type:"beginEvent",eventName:"Start"}),n.forEach((e=>{e.dispatchAfter("keyDown")}))}))},this.onAny=()=>{let{domElement:e,isExport:t}=this.eventContext,n=t?document:e;n.removeEventListener("pointerdown",this.onAny),n.removeEventListener("mousedown",this.onAny),document.removeEventListener("keydown",this.onAny),[...this.eventsAfterPerObject.entries()].forEach((e=>{let[t,n]=e;t.dispatchEvent({type:"beginEvent",eventName:"Start"}),n.forEach((e=>{e.dispatchAfter("any")}))}))},this.onSceneTransitionAudioVideoPlay=()=>{[...this.eventsAfterPerObject.entries()].forEach((e=>{let[t,n]=e;t.dispatchEvent({type:"beginEvent",eventName:"Start"}),n.forEach((e=>{e.actions.Audio.forEach((e=>{e.interaction instanceof iz&&e.interaction.audioPlayer.play()})),e.actions.Video.forEach((e=>{var t;let n=null!==(t=e.interaction.data.triggerAfter)&&void 0!==t?t:"autoplay";e.interaction instanceof gF&&e.interaction.play("autoplay"===n)})),e.actions.Particles.forEach((e=>{e.dispatchBasic()}))}))}))},this.onPlay=()=>{[...this.eventsAfterPerObject.entries()].forEach((e=>{let[t,n]=e;t.dispatchEvent({type:"beginEvent",eventName:"Start"}),n.forEach((e=>{e.dispatchAfter("autoplay")}))}))},this.onUserEvent=e=>{var t,n;let{eventName:i,target:r,reverse:s}=e;if(!i||!r)return;let a=mU(i);a&&"Start"===a&&(r instanceof vk||r.dispatchEvent({type:"beginEvent",eventName:"Start"}),null!==(t=this.eventsPerObject.get(r))&&void 0!==t&&t.forEach((e=>{e.dispatchUserEvent(s)})),null===(n=this.eventsAfterPerObject.get(r))||void 0===n||n.forEach((e=>{e.dispatchUserEvent(s)})))}}connect(){let{sharedAssets:e,page:t}=this.eventContext,n=n=>{var i;if(null!==(i=n.data)&&void 0!==i&&i.events.length)for(let{id:l,data:c}of n.data.events){var r,s,a,o;if(c.disabled||"Start"!==c.type)continue;let i=new _j(l,c,n,t,e,this.eventManager);(i.actions.Transition.length||i.actions.Animation.length||i.actions.SwitchCamera.length||i.actions.Create.length||i.actions.Destroy.length||i.actions.SceneTransition.length||i.actions.Reset.length||i.actions.SetVariable.length||i.actions.DynamicVariablePlay.length||i.actions.ClearLocalStorage.length||i.actions.UserAPI.length)&&(this.eventsPerObject.has(n)?null===(r=this.eventsPerObject.get(n))||void 0===r||r.push(i):this.eventsPerObject.set(n,[i])),i.actions.Audio.length&&(this.eventsAfterPerObject.has(n)?null===(s=this.eventsAfterPerObject.get(n))||void 0===s||s.push(i):this.eventsAfterPerObject.set(n,[i])),i.actions.Video.length&&(this.hasVideoAction=!0,this.eventsAfterPerObject.has(n)?null===(a=this.eventsAfterPerObject.get(n))||void 0===a||a.push(i):this.eventsAfterPerObject.set(n,[i])),i.actions.Particles.length&&(this.eventsAfterPerObject.has(n)?null===(o=this.eventsAfterPerObject.get(n))||void 0===o||o.push(i):this.eventsAfterPerObject.set(n,[i]))}};if(t.traverseEntity((e=>{var t;(e instanceof SL||e instanceof dL)&&null!==(t=e.frame)&&void 0!==t&&t.traverse((e=>{n(e)})),n(e)})),[...this.eventsAfterPerObject.values()].some((e=>e.length))){if(0===this.eventManager.activateCount){let{domElement:e,isExport:t}=this.eventContext,n=t?document:e;n.addEventListener("pointerdown",this.onMouseDown,{once:!0}),n.addEventListener("mousedown",this.onMouseDown,{once:!0}),document.addEventListener("keydown",this.onKeyDown,{once:!0}),n.addEventListener("pointerdown",this.onAny),n.addEventListener("mousedown",this.onAny),document.addEventListener("keydown",this.onAny),[...this.eventsAfterPerObject.entries()].forEach((e=>{let[t,n]=e;t.addEventListener("userEvent",this.onUserEvent)}))}else this.onSceneTransitionAudioVideoPlay();this.onPlay()}[...this.eventsPerObject.entries()].forEach((e=>{let[t,n]=e;t.dispatchEvent({type:"beginEvent",eventName:"Start"}),n.forEach((e=>e.dispatch())),t.addEventListener("userEvent",this.onUserEvent)}))}disconnect(){if([...this.eventsAfterPerObject.values()].some((e=>e.length))){let{domElement:e,isExport:t}=this.eventContext,n=t?document:e;n.removeEventListener("pointerdown",this.onMouseDown),n.removeEventListener("mousedown",this.onMouseDown),document.removeEventListener("keydown",this.onKeyDown),n.removeEventListener("pointerdown",this.onAny),n.removeEventListener("mousedown",this.onAny),document.removeEventListener("keydown",this.onAny),[...this.eventsAfterPerObject.entries()].forEach((e=>{let[t,n]=e;t.removeEventListener("userEvent",this.onUserEvent),n.forEach((e=>e.disconnect()))}))}[...this.eventsPerObject.entries()].forEach((e=>{let[t,n]=e;t.removeEventListener("userEvent",this.onUserEvent),n.forEach((e=>e.disconnect()))})),this.eventsPerObject.clear(),this.eventsAfterPerObject.clear()}},Aj=class{constructor(e,t,n,i,r,s){this.id=e,this.data=t,this.object=n,this.initialDisabled=!1,this.actions=dF(t,t.actions,i,r,s,n),this.target=t.target}disconnect(){pF(this.actions)}dispatch(e){this.initialDisabled||(this.actions.Transition.forEach((e=>{e.object.currentTransitionEvent!==this&&(e.object.currentTransitionEvent=this,e.init())})),this.object.dispatchEvent({type:"beginEvent",eventName:"Collision"}),this.actions.Transition.forEach((e=>{"Toggle"===e.data.runMode?e.toggle():e.play()})),this.actions.Animation.forEach((e=>{"Toggle"===e.data.runMode?e.toggle():e.play()})),this.actions.Reset.forEach((e=>{e.dispatch()})),this.actions.Link.forEach((e=>{e.dispatch()})),this.actions.Reset.forEach((e=>{e.dispatch()})),this.actions.Create.forEach((e=>{e.dispatch()})),this.actions.Destroy.forEach((t=>{t.dispatch(null!==e&&void 0!==e&&e)})),this.actions.SetVariable.forEach((e=>e.checkConditions())),this.actions.SetVariable.forEach((e=>e.dispatch())),this.actions.DynamicVariablePlay.forEach((e=>e.dispatch())),this.actions.Audio.forEach((e=>{e.dispatchBasic()})),this.actions.Particles.forEach((e=>{e.dispatchBasic()})),this.actions.Video.forEach((e=>{e.dispatchBasic()})),this.actions.ClearLocalStorage.forEach((e=>e.dispatch())),this.actions.UserAPI.forEach((e=>e.dispatch())))}},Cj=class extends dU{constructor(e,t,n,i,r){super(e),this.sharedVariables=t,this.eventManager=n,this.needsMouse=i,this.needsRaycast=r,this.dynamicVars=[],this.variablesToWatch=[],this.prevMouseProperty=null,this.prevRaycastProperty=null,this.pauseTime=0,this.isOutOfFocus=!1,this.events=[],this.onFrame=e=>{let t=this.eventContext.sharedAssets;if(this.rafId=window.requestAnimationFrame(this.onFrame),this.isOutOfFocus)return;let n=new Date,i=[],r=[];for(let c=0;c<this.propertiesToWatch.length;c++){let{objectId:e,property:t,prevValue:n}=this.propertiesToWatch[c],i=this.eventContext.scene.find(e),s=zy.propertyPaths[t];if("width"===s[0]||"height"===s[0]||"depth"===s[0])i=i.geometry.userData.parameters[s[0]];else for(let r=0;r<s.length;r++)i=i[s[r]];null===n?this.propertiesToWatch[c].prevValue=i instanceof Bt?i.clone():i:(i instanceof Bt?!i.equals(n):n!==i)&&(r.push({objId:e,property:t}),i instanceof Bt?this.propertiesToWatch[c].prevValue.copy(i):this.propertiesToWatch[c].prevValue=i)}for(let c=0;c<this.variablesToWatch.length;c++){let{id:e,prevValue:n}=this.variablesToWatch[c],r=t.getVariable(e);r!==n&&(i.push(e),this.variablesToWatch[c].prevValue=r)}for(let c=0;c<this.dynamicVars.length;c++){let{id:r,expectedTime:o,last:l,data:h,timerSeconds:u,startValue:d}=this.dynamicVars[c],p=1e3;if("timer"!==h.dynamicVariableType&&"stopwatch"!==h.dynamicVariableType||"number3decimal"!==h.format?"counter"===h.dynamicVariableType?p=h.updateInterval:"random"===h.dynamicVariableType&&(p=h.isStatic?1/0:h.updateInterval):p=1,-1!==o){if("Stopped"!==t.getDynamicVariablePlayState(r)&&"Restarted"!==t.getDynamicVariablePlayState(r)||(this.dynamicVars[c].last=e,this.dynamicVars[c].expectedTime=e+p,"counter"===h.dynamicVariableType&&t.getVariable(r)!==d&&(t.updateVariable(r,d),this.eventManager.requestRender()),("timer"===h.dynamicVariableType||"stopwatch"===h.dynamicVariableType)&&this.dynamicVars[c].timerSeconds!==d&&(this.dynamicVars[c].timerSeconds=d,t.updateVariable(r,_x.getFormattedTimerTime(d,h)),this.eventManager.requestRender()),"Restarted"===t.getDynamicVariablePlayState(r)&&t.setDynamicVariablePlayState(r,"Playing"),"Stopped"!==t.getDynamicVariablePlayState(r))){if("Paused"===t.getDynamicVariablePlayState(r)){void 0===this.dynamicVars[c].deltaToExpectedTime&&(this.dynamicVars[c].deltaToExpectedTime=Math.max(this.dynamicVars[c].expectedTime-e,0)),this.dynamicVars[c].last=e-(p-this.dynamicVars[c].deltaToExpectedTime),this.dynamicVars[c].expectedTime=e+this.dynamicVars[c].deltaToExpectedTime;continue}if(this.dynamicVars[c].deltaToExpectedTime=void 0,e>=o)if(this.dynamicVars[c].last=e,this.dynamicVars[c].expectedTime+=p,"random"===h.dynamicVariableType){let e=h.min+Math.random()*(h.max-h.min),n=h.decimals;e=Math.round(e*Math.pow(10,n))/Math.pow(10,n),t.updateVariable(r,e),i.push(r),this.eventManager.requestRender()}else if("counter"===h.dynamicVariableType){var s;let e=t.getVariable(r),n=null===(s=t.getDynamicVariableToggleIsForward(r))||void 0===s||s,a=t.getVariable(r)+h.increment*(n?1:-1);h.hasEnd&&(a=h.increment>0?at.clamp(a,d,h.endValue):at.clamp(a,h.endValue,d),a===d&&t.setDynamicVariableToggleIsForward(r,void 0),h.repeat?a===h.endValue&&(a=d):(a===d||a===h.endValue)&&t.setDynamicVariablePlayState(r,"Paused")),a!==e&&(i.push(r),t.updateVariable(r,a),this.eventManager.requestRender())}else if("time"===h.dynamicVariableType){let e=t.getVariable(r),s=sP(n,h);if("object"==typeof e&&"textValue"in e&&"object"==typeof s&&"textValue"in s){if(Array.isArray(e.textValue)&&Array.isArray(s.textValue)){if(e.textValue.every(((e,t)=>e===s.textValue[t])))continue}else if(e.textValue===s.textValue)continue}else if(e===s)continue;t.updateVariable(r,s),i.push(r),this.eventManager.requestRender()}else{var a;let n=yx.isTextValue(h.endValue)?Tj(h.endValue.textValue):h.endValue,s=null===(a=t.getDynamicVariableToggleIsForward(r))||void 0===a||a,o=u+(e-l)/1e3*("timer"===h.dynamicVariableType?-1:1)*(s?1:-1);o=Math.max(o,0),h.hasEnd&&(o="stopwatch"===h.dynamicVariableType?at.clamp(o,d,n):at.clamp(o,n,d),o===d&&t.setDynamicVariableToggleIsForward(r,void 0),h.repeat?Math.abs(o-n)<("number3decimal"===h.format?1e-4:.1)&&(o=d):(Math.abs(o-d)<("number3decimal"===h.format?1e-4:.1)||Math.abs(o-n)<("number3decimal"===h.format?1e-4:.1))&&t.setDynamicVariablePlayState(r,"Paused")),o!==u&&(i.push(r),this.dynamicVars[c].timerSeconds=o,t.updateVariable(r,_x.getFormattedTimerTime(o,h)),this.eventManager.requestRender())}}}else this.dynamicVars[c].last=e,this.dynamicVars[c].expectedTime=e+p}let o=!1;t.mouseProperty!==this.prevMouseProperty&&(this.prevMouseProperty=t.mouseProperty,o=!0);let l=!1;t.raycastProperty!==this.prevRaycastProperty&&(this.prevRaycastProperty=t.raycastProperty,l=!0),this.events.forEach((e=>{(i.includes(e.data.variableId)||r.find((t=>t.objId===e.data.objectId&&t.property===e.data.property))||"mouseProperty"===e.data.variableId&&o||"raycastProperty"===e.data.variableId&&l)&&(e.dispatch(),this.eventManager.requestRender())}))},this.onBlur=()=>{this.pause()},this.onFocus=()=>{this.resume()}}pause(){this.isOutOfFocus||(this.isOutOfFocus=!0,this.pauseTime=Date.now())}resume(){if(!this.isOutOfFocus)return;this.isOutOfFocus=!1;let e=Date.now()-this.pauseTime;for(let t=0;t<this.dynamicVars.length;t++)this.dynamicVars[t].last+=e,this.dynamicVars[t].expectedTime+=e}connect(){this.eventContext.page.traverseEntity((e=>{var t;null===(t=e.data)||void 0===t||t.events.filter((e=>"VariableChange"===e.data.type&&!e.data.disabled)).forEach((t=>{this.events.push(new Mj(t.id,t.data,e,this.eventContext.page,this.eventContext.sharedAssets,this.eventManager))}))})),this.propertiesToWatch=this.events.filter((e=>"objectProperty"===e.data.variableId&&null!==e.data.objectId)).map((e=>({objectId:e.data.objectId,property:e.data.property,prevValue:null})));let e=this.eventContext.sharedAssets;this.sharedVariables.forEach((t=>{let n,{id:i,data:r}=t;if("dynamicVariableType"in r)if("timer"===r.dynamicVariableType||"stopwatch"===r.dynamicVariableType){let e;if(yx.isTextValue(r.value)&&Array.isArray(r.value.textValue)){let t=r.value.textValue;e=3===t.length?t[2]+60*t[1]+3600*t[0]:t[1]+60*t[0]}else e=r.value;n=e,this.dynamicVars.push({id:i,last:-1,expectedTime:-1,data:r,timerSeconds:e,startValue:n})}else"time"===r.dynamicVariableType&&e.updateVariable(i,sP(new Date,r)),"counter"===r.dynamicVariableType&&(n=yx.isTextValue(r.value)?Tj(r.value.textValue):r.value),this.dynamicVars.push({id:i,last:-1,expectedTime:-1,data:r,startValue:n});else this.events.find((e=>e.data.variableId===i))&&this.variablesToWatch.push({id:i,prevValue:e.getVariable(i)})})),this.rafId=window.requestAnimationFrame(this.onFrame),window.addEventListener("blur",this.onBlur),window.addEventListener("focus",this.onFocus)}disconnect(){window.removeEventListener("blur",this.onBlur),window.removeEventListener("focus",this.onFocus),this.rafId&&(window.cancelAnimationFrame(this.rafId),this.rafId=void 0),this.events.forEach((e=>e.dispose()))}},Mj=class{constructor(e,t,n,i,r,s){this.id=e,this.data=t,this.object=n,this.actions=dF(t,t.actions,i,r,s,n)}dispatch(){let e=this.actions;e.Audio.forEach((e=>e.dispatchConditional())),e.Particles.forEach((e=>e.dispatchConditional())),e.Video.forEach((e=>e.dispatchConditional())),e.Create.forEach((e=>e.dispatch())),e.Destroy.forEach((e=>e.dispatch())),e.Reset.forEach((e=>e.dispatch())),e.Transition.forEach((e=>{e.object.currentTransitionEvent!==this&&(e.object.currentTransitionEvent=this),e.init()})),e.Transition.forEach((e=>e.play())),e.Animation.forEach((e=>e.play())),e.SwitchCamera.forEach((e=>e.play())),e.SceneTransition.forEach((e=>e.dispatch())),e.SetVariable.forEach((e=>e.checkConditions())),e.SetVariable.forEach((e=>e.dispatch())),e.DynamicVariablePlay.forEach((e=>e.dispatch())),e.ClearLocalStorage.forEach((e=>e.dispatch())),e.UserAPI.forEach((e=>e.dispatch()))}dispose(){pF(this.actions)}};function Tj(e){return 3===e.length?e[2]+60*e[1]+3600*e[0]:e[1]+60*e[0]}var Pj,Dj,Oj,Ij="\n(async function() {\n\tconst [wasmImport, wasmBinary] = await Promise.all([\n\t\timport('".concat("https://unpkg.com/@splinetool/runtime@1.9.63/build/","' + 'navmesh.js'),\n\t\tfetch('").concat("https://unpkg.com/@splinetool/navmesh-wasm@1.9.63/build/","' + 'navmesh.wasm').then((res) => res.arrayBuffer()),\n\t]);\n\tconst wasmModule = wasmImport.default;\n\tself.module = await wasmModule({ wasmBinary });\n\tpostMessage('ready');\n})();\n"),Rj={cs:6,ch:2,walkableSlopeAngle:90,walkableHeight:20,walkableClimb:5,walkableRadius:0,maxEdgeLen:12,maxSimplificationError:1.3,minRegionArea:8,mergeRegionArea:20,maxVertsPerPoly:6,detailSampleDist:6,detailSampleMaxError:1};Zm.then((e=>{Pj=e,Dj=new e.Vec3,Oj=new e.Vec3}));var kj=new Bt,Lj=class{constructor(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.usePhysics=e,this.isExport=t,this.onPointerDown=e=>{if(1!==Fm.length)return;let{raycaster:t,page:n}=this.eventContext;this.eventContext.updateRaycaster(e);let i=n.raycastWithClones(t);if(0!==i.length){if(this.gameControl){let e=kj.copy(this.gameControl.colliderWorldPosition);e.y-=this.gameControl.colliderHeight/2,this.gameControl.path=this.computePath(e,i[0].point)}this.eventContext.requestRender()}},this.traverseWithPhysics=(e,t)=>n=>{var i,r,s,a,o,l;let c;if(n instanceof SO){if(!n.objectForSample)return!0===n.object.dataPatched.physics.fusedBody&&"dynamic"===n.object.dataPatched.physics.rigidBody||void 0;if(n.objectForSample.dataPatched.physics.fusedBody)return;c=n.object}else if(n instanceof KS)c=n.object;else if(c=n,!1===(null===(i=c.dataPatched.cloner)||void 0===i?void 0:i.disabled)&&null!==(r=c.dataPatched.cloner)&&void 0!==r&&r.hideBase&&!0!==(null===(s=c.dataPatched.physics)||void 0===s?void 0:s.fusedBody))return!0;if(t&&!c.userData.navmesh)return;let h=c.dataPatched;if(!h.visible&&!0!==(null===(a=h.physics)||void 0===a?void 0:a.enabled))return!0;n.updateMatrixWorldSVD();let u=xV(h),d=c.userData.hasDestroy,p=c.userData.hasDrag,f=!1,m=!1;for(let e of h.events)!0!==e.data.disabled&&("GameControl"===e.data.type?f=!0:"Follow"===e.data.type&&(m=!0));if(f||u||m||d||p)return!0;var g;if(this.usePhysics&&"dynamic"===(null===(o=h.physics)||void 0===o?void 0:o.rigidBody)){if(this.usePhysics&&null!==(g=h.physics)&&void 0!==g&&g.fusedBody)return!0}else if("geometry"in n&&n.geometry&&e.push(ZF(n.geometry,n.matrixWorld)),this.usePhysics&&null!==(l=h.physics)&&void 0!==l&&l.fusedBody)return n.traverseObject(((t,n)=>{var i,r;if(0===n)return;let s;if(t instanceof SO){if(!t.objectForSample)return!0===t.object.dataPatched.physics.fusedBody&&"dynamic"===t.object.dataPatched.physics.rigidBody||void 0;if(t.objectForSample.dataPatched.physics.fusedBody)return;s=t.object}else if(t instanceof KS)s=t.object;else if(s=t,null!==(i=t.dataPatched.cloner)&&void 0!==i&&i.hideBase)return!0;let a=s.dataPatched;if(!a.visible&&!0!==(null===(r=a.physics)||void 0===r?void 0:r.enabled))return!0;"geometry"in t&&t.geometry&&e.push(ZF(t.geometry,t.matrixWorld))})),!0},this.traverseNoPhysics=(e,t)=>n=>{let i;if(n instanceof SO)return;i=n instanceof KS?n.object:n;let r=i.dataPatched;if("visibility"===r.physics.enabled?!r.visible:!r.physics.enabled)return!0;if(t&&!i.userData.navmesh)return;let s=n.geometry,a=!0===i.userData.hasDestroy,o=!0===i.userData.hasDrag;if(xV(r)||a||o||i.dataPatched.events.some((e=>!0!==e.data.disabled&&"GameControl"===e.data.type)))return!0;s&&e.push(ZF(s,n.matrixWorld))},this.navmeshWasm=Pj,this.navMesh=new this.navmeshWasm.NavMesh,this._workerURL=URL.createObjectURL(new Blob([(t?Ij:"\n(async function() {\n\tconst [wasmImport, wasmBinary] = await Promise.all([\n\t\timport(self.location.origin + '/_libraries/navmesh.js'),\n\t\tfetch(self.location.origin + '/_libraries/navmesh.wasm').then((res) => res.arrayBuffer()),\n\t]);\n\tconst wasmModule = wasmImport.default;\n\tself.module = await wasmModule({ wasmBinary });\n\tpostMessage('ready');\n})();\n")+"\n\nonmessage = function(messageEvent) {\n\tconst meshData = messageEvent.data;\n\tconst positions = meshData[0];\n\tconst offset = meshData[1];\n\tconst indices = meshData[2];\n\tconst indicesLength = meshData[3];\n\tconst parameters = meshData[4];\n\n\tconst module = self.module;\n\tconst rc = new module.rcConfig();\n\trc.cs = parameters.cs;\n\trc.ch = parameters.ch;\n\trc.borderSize = parameters.borderSize ? parameters.borderSize : 0;\n\trc.tileSize = parameters.tileSize ? parameters.tileSize : 0;\n\trc.walkableSlopeAngle = parameters.walkableSlopeAngle;\n\trc.walkableHeight = parameters.walkableHeight;\n\trc.walkableClimb = parameters.walkableClimb;\n\trc.walkableRadius = parameters.walkableRadius;\n\trc.maxEdgeLen = parameters.maxEdgeLen;\n\trc.maxSimplificationError = parameters.maxSimplificationError;\n\trc.minRegionArea = parameters.minRegionArea;\n\trc.mergeRegionArea = parameters.mergeRegionArea;\n\trc.maxVertsPerPoly = parameters.maxVertsPerPoly;\n\trc.detailSampleDist = parameters.detailSampleDist;\n\trc.detailSampleMaxError = parameters.detailSampleMaxError;\n\n\tif (!self.navMesh) {\n\t\tself.navMesh = new module.NavMesh();\n\t}\n\tself.navMesh.build(positions, offset, indices, indicesLength, rc);\n\n\tconst navmeshData = navMesh.getNavmeshData();\n\tconst arrView = new Uint8Array(module.HEAPU8.buffer, navmeshData.dataPointer, navmeshData.size);\n\tconst ret = new Uint8Array(navmeshData.size);\n\tret.set(arrView);\n\tnavMesh.freeNavmeshData(navmeshData);\n\n\tpostMessage(ret);\n}\n"])),this._worker=new Worker(this._workerURL)}init(e,t,n){this.gameControl=t,this.eventContext=n,this.setDefaultQueryExtent((new Bt).setScalar(e.ch*e.walkableRadius*1.2)),this._worker.onmessage=()=>{this.createNavMesh(n.page,e,(e=>{this.buildFromNavmeshData(e.data)}))},this.eventContext.renderer.domElement.addEventListener("pointerdown",this.onPointerDown)}createNavMesh(e,t,n){t.objects.forEach((t=>{var n;let i=e.scene.find(t);i.traverseEntity((e=>{e.userData.navmesh=!0})),null===(n=i.cloner)||void 0===n||n.traverseObject((e=>{e.userData.navmesh=!0}))}));let i=[],r=(this.usePhysics?this.traverseWithPhysics:this.traverseNoPhysics)(i,"custom"===t.zones);if(e.traverseChildren(r),t.objects.forEach((t=>{var n;let i=e.scene.find(t);i.traverseEntity((e=>{e.userData.navmesh=void 0})),null===(n=i.cloner)||void 0===n||n.traverseObject((e=>{e.userData.navmesh=void 0}))})),0===i.length)return!1;let s=fw(i),{positions:a,triIndices:l}=uC(s.getAttribute("position"),s.getIndex());return this._worker.postMessage([a,a.length/3,l,l.length,o(o({},Rj),t)]),this._worker.onmessage=n,!0}createDebugNavGeometry(){let e,t,n=this.navMesh.getDebugNavMesh(),i=n.getTriangleCount(),r=new Uint32Array(3*i),s=new Float32Array(3*i*3);for(e=0;e<3*i;e++)r[e]=e;for(e=0;e<i;e++)for(t=0;t<3;t++){let i=n.getTriangle(e).getPoint(t);s[9*e+3*t+0]=i.x,s[9*e+3*t+1]=i.y,s[9*e+3*t+2]=i.z}let a=new di;return a.setIndex(new ti(r,1)),a.setAttribute("position",new ti(s,3)),a}getClosestPoint(e){return Dj.x=e.x,Dj.y=e.y,Dj.z=e.z,this.navMesh.getClosestPoint(Dj)}getClosestPointToRef(e,t){Dj.x=e.x,Dj.y=e.y,Dj.z=e.z;let n=this.navMesh.getClosestPoint(Dj);t.set(n.x,n.y,n.z)}getRandomPointAround(e,t){return Dj.x=e.x,Dj.y=e.y,Dj.z=e.z,this.navMesh.getRandomPointAround(Dj,t)}getRandomPointAroundToRef(e,t,n){Dj.x=e.x,Dj.y=e.y,Dj.z=e.z;let i=this.navMesh.getRandomPointAround(Dj,t);n.set(i.x,i.y,i.z)}moveAlong(e,t){return Dj.x=e.x,Dj.y=e.y,Dj.z=e.z,Oj.x=t.x,Oj.y=t.y,Oj.z=t.z,this.navMesh.moveAlong(Dj,Oj)}moveAlongToRef(e,t,n){return Dj.x=e.x,Dj.y=e.y,Dj.z=e.z,Oj.x=t.x,Oj.y=t.y,Oj.z=t.z,this.navMesh.moveAlong(Dj,Oj)}computePath(e,t){let n=this.getClosestPoint(t);if(Oj.x=n.x,Oj.y=n.y,Oj.z=n.z,Math.sqrt(Math.pow(t.x-n.x,2)+Math.pow(t.y-n.y,2)+Math.pow(t.z-n.z,2))>this.getDefaultQueryExtent().y)return[];this.getClosestPoint(e);let i=this.navMesh.computePath(Dj,Oj),r=i.getPointCount(),s=[];for(let a=0;a<r;a++){let e=i.getPoint(a);s.push(new Bt(e.x,e.y,e.z))}return s}createCrowd(e,t){return new Bj(this,e,t)}setDefaultQueryExtent(e){Dj.x=e.x,Dj.y=e.y,Dj.z=e.z,this.navMesh.setDefaultQueryExtent(Dj)}getDefaultQueryExtent(){return this.navMesh.getDefaultQueryExtent()}buildFromNavmeshData(e){let t=e.length*e.BYTES_PER_ELEMENT,n=this.navmeshWasm._malloc(t),i=new Uint8Array(this.navmeshWasm.HEAPU8.buffer,n,t);i.set(e);let r=new this.navmeshWasm.NavmeshData;r.dataPointer=i.byteOffset,r.size=e.length,this.navMesh.buildFromNavmeshData(r),this.navmeshWasm._free(i.byteOffset)}getNavmeshData(){let e=this.navMesh.getNavmeshData(),t=new Uint8Array(this.navmeshWasm.HEAPU8.buffer,e.dataPointer,e.size),n=new Uint8Array(e.size);return n.set(t),this.navMesh.freeNavmeshData(e),n}getDefaultQueryExtentToRef(e){let t=this.navMesh.getDefaultQueryExtent();e.set(t.x,t.y,t.z)}dispose(){var e;this.navMesh.destroy(),this._worker.terminate(),URL.revokeObjectURL(this._workerURL),null===(e=this.eventContext)||void 0===e||e.renderer.domElement.removeEventListener("pointerdown",this.onPointerDown)}addCylinderObstacle(e,t,n){return Dj.x=e.x,Dj.y=e.y,Dj.z=e.z,this.navMesh.addCylinderObstacle(Dj,t,n)}addBoxObstacle(e,t,n){return Dj.x=e.x,Dj.y=e.y,Dj.z=e.z,Oj.x=t.x,Oj.y=t.y,Oj.z=t.z,this.navMesh.addBoxObstacle(Dj,Oj,n)}removeObstacle(e){this.navMesh.removeObstacle(e)}isSupported(){return void 0!==this.navmeshWasm}},Bj=class{constructor(e,t,n){this.navmeshWasmWrapper=e,this.transforms=[],this.agents=new Array,this.reachRadii=new Array,this._agentDestinationArmed=new Array,this._agentDestination=new Array,this.crowd=new this.navmeshWasmWrapper.navmeshWasm.Crowd(t,n,this.navmeshWasmWrapper.navMesh.getNavMesh())}onReachTarget(e,t){}addAgent(e,t,n){let i=new this.navmeshWasmWrapper.navmeshWasm.dtCrowdAgentParams;i.radius=t.radius,i.height=t.height,i.maxAcceleration=t.maxAcceleration,i.maxSpeed=t.maxSpeed,i.collisionQueryRange=t.collisionQueryRange,i.pathOptimizationRange=t.pathOptimizationRange,i.separationWeight=t.separationWeight,i.updateFlags=7,i.obstacleAvoidanceType=0,i.queryFilterType=0,i.userData=0;let r=this.crowd.addAgent(new this.navmeshWasmWrapper.navmeshWasm.Vec3(e.x,e.y,e.z),i);return this.transforms.push(n),this.agents.push(r),this.reachRadii.push(t.reachRadius?t.reachRadius:t.radius),this._agentDestinationArmed.push(!1),this._agentDestination.push(new Bt(0,0,0)),r}getAgentPosition(e){return this.crowd.getAgentPosition(e)}getAgentPositionToRef(e,t){let n=this.crowd.getAgentPosition(e);t.set(n.x,n.y,n.z)}getAgentVelocity(e){return this.crowd.getAgentVelocity(e)}getAgentVelocityToRef(e,t){let n=this.crowd.getAgentVelocity(e);t.set(n.x,n.y,n.z)}getAgentNextTargetPath(e){return this.crowd.getAgentNextTargetPath(e)}getAgentNextTargetPathToRef(e,t){let n=this.crowd.getAgentNextTargetPath(e);t.set(n.x,n.y,n.z)}getAgentState(e){return this.crowd.getAgentState(e)}overOffmeshConnection(e){return this.crowd.overOffmeshConnection(e)}agentGoto(e,t){this.crowd.agentGoto(e,new this.navmeshWasmWrapper.navmeshWasm.Vec3(t.x,t.y,t.z));let n=this.agents.indexOf(e);n>-1&&(this._agentDestinationArmed[n]=!0,this._agentDestination[n].set(t.x,t.y,t.z))}agentTeleport(e,t){this.crowd.agentTeleport(e,new this.navmeshWasmWrapper.navmeshWasm.Vec3(t.x,t.y,t.z))}updateAgentParameters(e,t){let n=this.crowd.getAgentParameters(e);void 0!==t.radius&&(n.radius=t.radius),void 0!==t.height&&(n.height=t.height),void 0!==t.maxAcceleration&&(n.maxAcceleration=t.maxAcceleration),void 0!==t.maxSpeed&&(n.maxSpeed=t.maxSpeed),void 0!==t.collisionQueryRange&&(n.collisionQueryRange=t.collisionQueryRange),void 0!==t.pathOptimizationRange&&(n.pathOptimizationRange=t.pathOptimizationRange),void 0!==t.separationWeight&&(n.separationWeight=t.separationWeight),this.crowd.setAgentParameters(e,n)}removeAgent(e){this.crowd.removeAgent(e);let t=this.agents.indexOf(e);t>-1&&(this.agents.splice(t,1),this.transforms.splice(t,1),this.reachRadii.splice(t,1),this._agentDestinationArmed.splice(t,1),this._agentDestination.splice(t,1))}getAgents(){return this.agents}update(e){if(this.navmeshWasmWrapper.navMesh.update(),e<=.001)return;let t=1/60;{let n=Math.floor(e/t);n>10&&(n=10),n<1&&(n=1);let i=e/n;for(let e=0;e<n;e++)this.crowd.update(i)}for(let n=0;n<this.agents.length;n++){let e=this.agents[n],t=this.getAgentPosition(e);if(this.transforms[n].copy(t),this._agentDestinationArmed[n]){let i=t.x-this._agentDestination[n].x,r=t.z-this._agentDestination[n].z,s=this.reachRadii[n],a=this._agentDestination[n].y-this.reachRadii[n],o=this._agentDestination[n].y+this.reachRadii[n],l=i*i+r*r;t.y>a&&t.y<o&&l<s*s&&(this.onReachTarget(e,this._agentDestination[n]),this._agentDestinationArmed[n]=!1)}}}setDefaultQueryExtent(e){let t=new this.navmeshWasmWrapper.navmeshWasm.Vec3(e.x,e.y,e.z);this.crowd.setDefaultQueryExtent(t)}getDefaultQueryExtent(){return this.crowd.getDefaultQueryExtent()}getDefaultQueryExtentToRef(e){let t=this.crowd.getDefaultQueryExtent();e.set(t.x,t.y,t.z)}getCorners(e){let t,n=this.crowd.getCorners(e),i=n.getPointCount(),r=[];for(t=0;t<i;t++){let e=n.getPoint(t);r.push(new Bt(e.x,e.y,e.z))}return r}dispose(){this.crowd.destroy()}};function zj(e){let t=!1;return e.scene.objects.forEach((n=>{"Page"===n.data.type&&!t&&n.data.publish.gameControlObject&&px.traverseModuleInstances(e,n.id,((e,n,i)=>{for(let r of i)"GameControl"===r.data.type&&r.data.navmesh.enabled&&(t=!0)}))})),t}var Nj={type:"change"},Fj={type:"changeZoom"},Uj={type:"changePan"},jj={type:"start"},Vj={type:"end",changed:!0},Gj={type:"end",changed:!1},Hj=new Lt,Wj=new ot,qj=2*Math.PI,Xj=new Bt,Yj=new ot,Qj=new Bt,Kj=new Lt,Zj=new pn,Jj={type:"requestRender"},$j=class extends qe{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{isPlayMode:!1,isExport:!1};super(),this.object=e,this.domElement=t,this.options=n,this.enabled=!0,this.useKeyEvents=!0,this.enableDamping=!1,this.enableZoom=!0,this.enableRotate=!0,this.enablePan=!0,this.autoRotate=!1,this.rotationLimitsMode=0,this.panLimitsMode=0,this.rotationSoftLimit=2,this.panSoftLimit=2,this.hoverRotatePanMode=0,this.zoomLimitsEnabled=!1,this.mouseButtons=[0,5],this.mouseButtonsPlay=[3,4,5],this.touches=[null,N,B],this.offset=new Bt,this.eye=new Bt,this.lastPosition=new Bt,this.lastQuaternion=new Lt,this.current=new ot,this.overShoot=new ot,this.overRatio=new ot,this.spherical=new yc,this.sphericalDelta=new yc,this.panOffset=new Bt,this.panLeftV=new Bt,this.panUpV=new Bt,this.panV=new Bt,this.rotateStart=new ot,this.rotateEnd=new ot,this.rotateDelta=new ot,this.panStart=new ot,this.panEnd=new ot,this.panDelta=new ot,this.dollyStart=new ot,this.dollyEnd=new ot,this.dollyDelta=new ot,this.rotationRangeFactor=new ot,this.panRangeFactor=new ot,this.state=-1,this.zoomChanged=!1,this.isPointerDown=!1,this.isThetaFlipped=!1,this.prevScale=0,this.scale=1,this.gesture=!1,this.timer=-1,this.timerHover=-1,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPhi=0,this.maxPhi=Math.PI,this.minTheta=-1/0,this.maxTheta=1/0,this.minH=0,this.maxH=Math.PI,this.minV=-1/0,this.maxV=1/0,this.autoRotateClockwise=!0,this.isPanOverShoot=!1,this.isRotateOverShoot=!1,this.resetHoverEffectOnPointerLeave=!1,this.hasChange=!1,this.useWindowEvents=!1,this.isTouchZoom=!0,this.autoRotateSpeed=2,this.dampingFactor=.125,this.zoomSpeed=2,this.rotateSpeed=1,this.panSpeed=1,this.hoverRotatePanStrength=.1,this.hoverRotateDamping=this.dampingFactor,this.thetaIsFree=!1,this.phiIsFree=!1,this.needsUpdate=!0,this.onCameraChange=e=>{this.object.removeEventListener("beginState",this.onBeginState),this.object.removeEventListener("completeState",this.onCompleteState),this.object.removeEventListener("cameraChange",this.onCameraChange),this.object=e.camera,this.object.addEventListener("beginState",this.onBeginState),this.object.addEventListener("completeState",this.onCompleteState),this.object.addEventListener("cameraChange",this.onCameraChange)},this.update=()=>{this.object.updateWorldMatrix(!0,!1),this.object.matrixWorld.decompose(Qj,Kj,Xj),this.offset.copy(Qj).sub(this.target),this.spherical.setFromVector3(this.offset),this.object.isUpVectorFlipped&&(this.spherical.phi*=-1,this.spherical.theta-=Math.PI),this.autoRotate&&-1===this.state&&this.rotateLeft((!0===this.autoRotateClockwise?1:-1)*this.getAutoRotationAngle()),0!==this.rotationLimitsMode&&this.applyLimits(this.sphericalDelta,this.rotationLimitsMode,this.rotationSoftLimit,this.maxTheta,this.minTheta,this.maxPhi,this.minPhi,this.rotationRangeFactor),2!==this.rotationLimitsMode&&(this.spherical.phi+=this.sphericalDelta.phi),(1!==this.rotationLimitsMode||!0===this.autoRotate)&&(this.spherical.theta+=this.sphericalDelta.theta),this.spherical.radius*=this.scale,this.zoomLimitsEnabled&&this.object.isPerspectiveCamera&&(this.spherical.radius=Math.max(this.minDistance,Math.min(this.maxDistance,this.spherical.radius))),0!==this.panLimitsMode&&(this.target.applyQuaternion(Hj.copy(Kj).invert()),this.panOffset.applyQuaternion(Hj),this.applyLimits(this.panOffset,this.panLimitsMode,this.panSoftLimit,this.maxH,this.minH,this.maxV,this.minV,this.panRangeFactor),this.target.applyQuaternion(Kj),this.panOffset.applyQuaternion(Kj)),2===this.panLimitsMode&&(this.panOffset.y=0),1===this.panLimitsMode&&(this.panOffset.x=0),-1!==this.state||this.gesture?(this.target.add(this.panOffset),this.panOffset.set(0,0,0)):(this.panOffset.multiplyScalar(1-this.dampingFactor),this.target.add(this.panOffset)),this.offset.setFromSpherical(this.spherical),Qj.copy(this.target).add(this.offset),this.object.position.copy(this.target).add(this.offset),this.object.parent&&(Zj.copy(this.object.parent.matrixWorld).invert(),this.object.position.applyMatrix4(Zj));let e=this.spherical.phi%qj;if(this.eye.copy(this.offset).normalize(),this.object.up.copy(Nn.DEFAULT_UP).applyAxisAngle(this.eye,this.object.angleOffsetFromUp),e>0&&e>Math.PI||e<0&&e>-Math.PI?(this.object.up.negate(),this.object.lookAt(this.target),this.object.isUpVectorFlipped=!0):(this.object.lookAt(this.target),this.object.isUpVectorFlipped=!1),-1===this.state||!0===this.enableDamping){let e=1===this.hoverRotatePanMode?this.hoverRotateDamping:this.dampingFactor;this.sphericalDelta.theta*=1-e,this.sphericalDelta.phi*=1-e}else this.sphericalDelta.set(0,0,0);return this.scale=1,this.zoomChanged||this.lastPosition.distanceToSquared(this.object.position)>.01||8*(1-this.lastQuaternion.dot(this.object.quaternion))>1e-8?(this.dispatchEvent(Nj),this.object.dispatchEvent(Jj),this.lastPosition.copy(this.object.position),this.lastQuaternion.copy(this.object.quaternion),this.zoomChanged=!1,!0):(this.isPanOverShoot=!1,this.isRotateOverShoot=!1,this.object.wasMovedBySwitchCameraAction=!1,this.sphericalDelta.set(0,0,0),this.panOffset.set(0,0,0),!1)},this.onPointerDown=e=>{!1!==this.enabled&&("touch"===e.pointerType||"pen"===e.pointerType&&Rm?this.onPointerDownTouch(e):this.onPointerDownMouse(e),-1!==this.state&&(this.isPointerDown=!0,this.dispatchEvent(jj),this.domElement.addEventListener("pointermove",this.onPointerMove),this.domElement.addEventListener("pointerup",this.onPointerUp),e.stopPropagation(),"touch"===e.pointerType||"pen"===e.pointerType&&Rm||this.domElement.setPointerCapture(e.pointerId)))},this.onPointerLeave=e=>{this.resetHoverEffectOnPointerLeave&&!this.useWindowEvents?(1===this.hoverRotatePanMode?(this.sphericalDelta.theta=-this.spherical.theta,this.sphericalDelta.phi=-this.spherical.phi,Xj.subVectors(this.position0,this.target0),this.spherical.setFromVector3(Xj),this.sphericalDelta.theta+=this.spherical.theta,this.sphericalDelta.phi+=this.spherical.phi,this.sphericalDelta.theta/=8,this.sphericalDelta.phi/=8):2===this.hoverRotatePanMode&&this.panOffset.subVectors(this.target0,this.target).divideScalar(8),this.update()):this.pointerLeaveEvent=e},this.onPointerEnter=e=>{this.resetHoverEffectOnPointerLeave||void 0===this.pointerLeaveEvent?Yj.set(e.clientX-this.domElement.clientWidth/2,e.clientY-this.domElement.clientHeight/2):Yj.set(e.clientX-this.pointerLeaveEvent.clientX,e.clientY-this.pointerLeaveEvent.clientY),1===this.hoverRotatePanMode?(this.rotateDelta.copy(Yj).multiplyScalar(this.rotateSpeed*this.hoverRotatePanStrength).rotateAround(Wj,-this.object.angleOffsetFromUp),this.rotateLeft(2*Math.PI*this.rotateDelta.x/this.domElement.clientHeight),this.rotateUp(2*Math.PI*this.rotateDelta.y/this.domElement.clientHeight),this.rotateStart.set(e.clientX,e.clientY)):2===this.hoverRotatePanMode&&(this.panDelta.copy(Yj).multiplyScalar(this.panSpeed*this.hoverRotatePanStrength),this.pan(this.panDelta.x,this.panDelta.y),this.panStart.set(e.clientX,e.clientY)),this.update()},this.onPointerMove=e=>{!1!==this.enabled&&(this.checkRaycastLock()||("touch"===e.pointerType||"pen"===e.pointerType&&Rm?this.onPointerMoveTouch(e):this.onPointerMoveMouse(e),e.stopPropagation()))},this.onPointerUp=e=>{this.isPointerDown=!1,0===Fm.length&&(this.domElement.removeEventListener("pointermove",this.onPointerMove),this.domElement.removeEventListener("pointerup",this.onPointerUp)),Fm.length>1&&e.preventDefault(),this.hasChange?this.dispatchEvent(Vj):this.dispatchEvent(Gj),this.state=-1,e&&(e.stopPropagation(),"touch"===e.pointerType||"pen"===e.pointerType&&Rm||this.domElement.releasePointerCapture(e.pointerId))},this.onPointerDownMouse=e=>{let t;switch(t=this.useKeyEvents?this.mouseButtons[e.button]:this.mouseButtonsPlay[e.button],t){case 0:if(!0!==e.altKey||e.shiftKey||Nm(e)){if(" "===this.key){if(!1===this.enablePan)return;this.handleMouseDownPan(e),this.state=2}}else{if(!1===this.enableRotate)return;this.handleMouseDownRotate(e),this.state=0}break;case 4:if(!1===this.enablePan)return;this.handleMouseDownPan(e),this.state=2;break;case 3:if(Nm(e)||e.shiftKey){if(!1===this.enablePan)return;this.handleMouseDownPan(e),this.state=2}else{if(!1===this.enableRotate)return;this.handleMouseDownRotate(e),this.state=0}break;case 5:if(Nm(e)||e.shiftKey){if(!1===this.enableRotate)return;this.handleMouseDownRotate(e),this.state=0}else{if(!1===this.enablePan)return;this.handleMouseDownPan(e),this.state=2}break;default:this.state=-1}},this.onPointerMoveMouse=e=>{switch(this.state){case 0:if(!1===this.enableRotate)return;this.handleMouseMoveRotate(e);break;case 1:if(!1===this.enableZoom)return;this.handleMouseMoveDolly(e);break;case 2:if(!1===this.enablePan)return;this.handleMouseMovePan(e)}this.object.wasMovedByUser=!0},this.onPointerDownTouch=e=>{switch(Fm.length>1&&e.preventDefault(),this.touches[Fm.length-1]){case L:if(!1===this.enableRotate)return void(this.state=-1);this.handleTouchStartRotate(),this.state=3;break;case B:if(!1===this.enablePan)return void(this.state=-1);this.handleTouchStartPan(),this.state=4;break;case z:if(!1===this.enableZoom&&!1===this.enablePan)return;this.handleTouchStartDollyPan(),this.state=5;break;case N:if(!1===this.enableZoom&&!1===this.enableRotate)return;this.handleTouchStartDollyRotate(),this.state=6;break;default:this.state=-1}},this.onPointerMoveTouch=e=>{switch(Fm.length>1&&e.preventDefault(),this.state){case 3:if(!1===this.enableRotate)return;this.handleTouchMoveRotate(e),this.update();break;case 4:if(!1===this.enablePan)return;this.handleTouchMovePan(e),this.update();break;case 5:if(!1===this.enableZoom&&!1===this.enablePan)return;this.handleTouchMoveDollyPan(e),this.update();break;case 6:if(!1===this.enableZoom&&!1===this.enableRotate)return;this.handleTouchMoveDollyRotate(e),this.update();break;default:this.state=-1}this.object.wasMovedByUser=!0},this.dispatchEndDebounced=hm((()=>this.dispatchEvent(Vj)),33),this.onMouseWheel=e=>{!1===this.enabled||!1===this.enableZoom&&!1===this.enablePan||this.checkRaycastLock()||(!this.options.isExport&&this.domElement.clientHeight===document.body.clientHeight&&this.domElement.clientWidth===document.body.clientWidth&&e.preventDefault(),this.dispatchEvent(jj),this.handleMouseWheel(e),this.dispatchEndDebounced(),this.object.wasMovedByUser=!0)},this.onGesture=e=>{if(e.preventDefault(),!1!==this.enabled&&!this.checkRaycastLock()&&!Om)if("gesturechange"===e.type){if(!1===this.enableZoom||!1===this.isTouchZoom)return;this.dispatchEvent(jj),e.scale>this.prevScale?this.dollyIn(this.getZoomScale()):e.scale<this.prevScale&&this.dollyOut(this.getZoomScale()),this.prevScale=e.scale,this.update(),this.object.wasMovedByUser=!0}else this.dispatchEvent(Vj)},this.onContextMenu=e=>{e.preventDefault()},this.onTouchEnd=e=>{e.preventDefault()},this.onKeyDown=e=>{!1!==this.enabled&&(this.key=e.key," "===e.key&&this.dispatchEvent(jj))},this.onKeyUp=e=>{!1!==this.enabled&&(this.key=void 0,-1!==this.state&&"Alt"===e.key&&this.onPointerUp(Fm[0])," "===e.key&&this.dispatchEvent(Vj))},this.onPointerHover=e=>{"mouse"!==e.pointerType||!1===this.enabled||-1!==this.state||2===this.hoverRotatePanMode&&this.isPanOverShoot||1===this.hoverRotatePanMode&&this.isRotateOverShoot||(this.isPointerDown=!0,2===this.hoverRotatePanMode?this.handleMouseMovePan(e,this.hoverRotatePanStrength):1===this.hoverRotatePanMode&&this.handleMouseMoveRotate(e,this.hoverRotatePanStrength))},this.onBeginState=()=>{this.enabled=!1,this.needsUpdate=!1},this.onCompleteState=e=>{e.isfromEntity&&this.options.isPlayMode||(this.enabled=!0,this.needsUpdate=!0,this.object.updateUp(),this.object.getTarget(this.target))},this.target=this.object.getTarget(),this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.quat0=this.object.quaternion.clone(),this.isUpVectorFlipped0=this.object.isUpVectorFlipped,this.offset.copy(this.object.position).sub(this.target),this.spherical.setFromVector3(this.offset),this.object.isUpVectorFlipped&&(this.spherical.phi*=-1,this.spherical.theta-=Math.PI),this.initialSphericalRadius=this.spherical.radius,this.addEventListenersToCamera()}dispatchEvent(e){"start"===e.type?this.hasChange=!1:this.hasChange=!0,super.dispatchEvent(e)}addEventListenersToCamera(){this.object.addEventListener("beginState",this.onBeginState),this.object.addEventListener("completeState",this.onCompleteState),this.object.addEventListener("cameraChange",this.onCameraChange)}removeEventListenersFromCamera(){this.object.removeEventListener("beginState",this.onBeginState),this.object.removeEventListener("completeState",this.onCompleteState),this.object.removeEventListener("cameraChange",this.onCameraChange)}updateUseWindowEvents(e){if(window.removeEventListener("pointermove",this.onPointerHover),this.domElement.removeEventListener("pointermove",this.onPointerHover),this.useWindowEvents=e,0!==this.hoverRotatePanMode&&(this.useWindowEvents?window.addEventListener("pointermove",this.onPointerHover):this.domElement.addEventListener("pointermove",this.onPointerHover)),this.domElement.removeEventListener("pointerleave",this.onPointerLeave),this.domElement.removeEventListener("pointerenter",this.onPointerEnter),window.removeEventListener("pointerleave",this.onPointerLeave),window.removeEventListener("pointerenter",this.onPointerEnter),0!==this.hoverRotatePanMode&&!this.useWindowEvents){let e=this.useWindowEvents?window:this.domElement;e.addEventListener("pointerleave",this.onPointerLeave),e.addEventListener("pointerenter",this.onPointerEnter)}}fromJSON(e,t){var n,i;this.setEnableDampingSpeed(e.enableDamping),this.enablePan=e.enablePan,this.enableZoom=e.enableZoom,this.enableRotate=e.enableRotate,this.rotationLimitsMode=e.rotationLimitsMode,this.thetaIsFree=e.rotationHorizontalOffset.min===e.rotationHorizontalOffset.max&&e.rotationHorizontalOffset.min===Math.PI,this.phiIsFree=e.rotationVerticalOffset.min===e.rotationVerticalOffset.max&&e.rotationVerticalOffset.min===Math.PI,this.panLimitsMode=e.panLimitsMode,this.panSoftLimit=e.panSoftLimit,this.rotationSoftLimit=e.rotationSoftLimit,this.hoverRotatePanMode=e.hoverRotatePanMode,this.hoverRotateDamping=null!==(n=e.hoverRotateDamping)&&void 0!==n?n:this.dampingFactor,this.useWindowEvents="window"===t,0!==this.hoverRotatePanMode&&(this.useWindowEvents?window.addEventListener("pointermove",this.onPointerHover):this.domElement.addEventListener("pointermove",this.onPointerHover));let r=e.hoverRotatePanStrength/100;this.hoverRotatePanStrength=r**2,this.zoomLimitsEnabled=e.zoomLimitsEnabled,this.minZoom=e.zoomLimits.min,this.maxZoom=Math.max(e.zoomLimits.min,e.zoomLimits.max),this.minDistance=1e3/this.maxZoom,this.maxDistance=Math.max(this.minDistance,1e3/e.zoomLimits.min),this.autoRotate=e.autoRotate,this.autoRotateSpeed=e.autoRotateSpeed,this.autoRotateClockwise=e.autoRotateClockwise;let s=this.object.getTarget().applyQuaternion(Hj.copy(this.object.quaternion).invert());this.minV=-e.panVerticalOffset.min+s.y,this.maxV=e.panVerticalOffset.max+s.y,this.minH=-e.panHorizontalOffset.min+s.x,this.maxH=e.panHorizontalOffset.max+s.x,this.panRangeFactor.set(this.maxH-this.minH,this.maxV-this.minV).divideScalar(2),this.rotationRangeFactor.setScalar(Math.PI).divideScalar(4),this.minPhi=eV(this.spherical.phi-e.rotationVerticalOffset.min),this.maxPhi=eV(this.spherical.phi+e.rotationVerticalOffset.max),this.minTheta=eV(eV(this.spherical.theta)-e.rotationHorizontalOffset.min),this.maxTheta=eV(eV(this.spherical.theta)+e.rotationHorizontalOffset.max),this.isThetaFlipped=this.minTheta>this.maxTheta,1===e.orbitTouches&&(this.touches[0]=L),1===e.panTouches&&(this.touches[0]=B),2===e.orbitTouches&&(this.touches[1]=N),2===e.panTouches&&(this.touches[1]=z),3===e.orbitTouches&&(this.touches[2]=L),3===e.panTouches&&(this.touches[2]=B),this.isTouchZoom=e.isTouchZoom,this.resetHoverEffectOnPointerLeave=null!==(i=e.resetHoverEffectOnPointerLeave)&&void 0!==i&&i}connect(){if(this.domElement.addEventListener("contextmenu",this.onContextMenu),this.domElement.addEventListener("pointerdown",this.onPointerDown),this.domElement.addEventListener("wheel",this.onMouseWheel),window.addEventListener("keydown",this.onKeyDown,!1),window.addEventListener("keyup",this.onKeyUp,!1),this.domElement.addEventListener("gesturestart",this.onGesture),this.domElement.addEventListener("gesturechange",this.onGesture),this.domElement.addEventListener("gestureend",this.onGesture),this.domElement.addEventListener("touchend",this.onTouchEnd),0!==this.hoverRotatePanMode&&!this.useWindowEvents){let e=this.useWindowEvents?window:this.domElement;e.addEventListener("pointerleave",this.onPointerLeave),e.addEventListener("pointerenter",this.onPointerEnter)}this.pointerLeaveEvent=void 0}dispose(){this.removeEventListenersFromCamera(),this.domElement.removeEventListener("contextmenu",this.onContextMenu),this.domElement.removeEventListener("pointerdown",this.onPointerDown),this.domElement.removeEventListener("wheel",this.onMouseWheel),window.removeEventListener("keydown",this.onKeyDown,!1),window.removeEventListener("keyup",this.onKeyUp,!1),this.domElement.removeEventListener("pointermove",this.onPointerHover),window.removeEventListener("pointermove",this.onPointerHover),this.domElement.removeEventListener("gesturestart",this.onGesture),this.domElement.removeEventListener("gesturechange",this.onGesture),this.domElement.removeEventListener("gestureend",this.onGesture),this.domElement.removeEventListener("touchend",this.onTouchEnd),this.domElement.removeEventListener("pointerleave",this.onPointerLeave),this.domElement.removeEventListener("pointerenter",this.onPointerEnter),window.removeEventListener("pointerleave",this.onPointerLeave),window.removeEventListener("pointerenter",this.onPointerEnter),this.domElement.removeEventListener("pointermove",this.onPointerMove),this.domElement.removeEventListener("pointerup",this.onPointerUp)}applyLimits(e,t,n,i,r,s,a,o){let l,c,h;this.overShoot.set(0,0),e instanceof Bt?(l=e.x,c=e.y,this.current.set(this.target.x,this.target.y),h=!0):(l=e.theta,c=e.phi,this.current.set(eV(this.spherical.theta),eV(this.spherical.phi)),h=!1),0===n&&(this.current.x+=l,this.current.y+=c),(3===t||2===t)&&(!h&&this.isThetaFlipped?this.current.x>i&&this.current.x<0?this.overShoot.x=i-this.current.x:this.current.x<r&&this.current.x>0&&(this.overShoot.x=r-this.current.x):this.current.x>i?this.overShoot.x=i-this.current.x:this.current.x<r&&(this.overShoot.x=r-this.current.x)),(3===t||1===t)&&(this.current.y>s?this.overShoot.y=s-this.current.y:this.current.y<a&&(this.overShoot.y=a-this.current.y)),h||(this.overShoot.x=eV(this.overShoot.x),this.overShoot.y=eV(this.overShoot.y)),0!==n?(this.overRatio.copy(this.overShoot).divide(o),this.overRatio.x=Math.min(Math.abs(this.overRatio.x),1),this.overRatio.y=Math.min(Math.abs(this.overRatio.y),1),1===n&&(this.overRatio.x=tV(Math.abs(this.overRatio.x)),this.overRatio.y=tV(Math.abs(this.overRatio.y))),this.isPointerDown||1===n?2===n&&(this.overRatio.x>.9&&!this.thetaIsFree||this.overRatio.y>.9&&!this.phiIsFree)?this.isPointerDown=!1:(l*this.overShoot.x<0&&!this.thetaIsFree&&(l*=1-this.overRatio.x),c*this.overShoot.y<0&&!this.phiIsFree&&(c*=1-this.overRatio.y)):2===n&&(!h&&(this.overRatio.x>.002&&!this.thetaIsFree||this.overRatio.y>.002&&!this.phiIsFree)||h&&(Math.abs(this.overShoot.x)>2||Math.abs(this.overShoot.y)>2)?(this.thetaIsFree||(l=.05*this.overShoot.x),this.phiIsFree||(c=.05*this.overShoot.y),h?this.isPanOverShoot=!0:this.isRotateOverShoot=!0):h?this.isPanOverShoot=!1:this.isRotateOverShoot=!1)):(l+=this.overShoot.x,c+=this.overShoot.y),e instanceof Bt?(e.x=l,e.y=c):(this.thetaIsFree||(e.theta=l),this.phiIsFree||(e.phi=c))}setEnableDampingSpeed(e){this.enableDamping=e,this.rotateSpeed=!0===e?.2:1}stopDamping(){this.sphericalDelta.theta=0,this.sphericalDelta.phi=0}getAutoRotationAngle(){return 2*Math.PI/60/60*this.autoRotateSpeed}getZoomScale(){return Math.pow(.95,this.zoomSpeed)}rotateLeft(e){this.sphericalDelta.theta-=e}rotateUp(e){this.sphericalDelta.phi-=e}panLeft(e,t){this.panLeftV.setFromMatrixColumn(t,0),this.panLeftV.multiplyScalar(-e),this.panOffset.add(this.panLeftV)}panUp(e,t){this.panUpV.setFromMatrixColumn(t,1),this.panUpV.multiplyScalar(e),this.panOffset.add(this.panUpV)}pan(e,t){let n=this.domElement;if(n&&this.object.isPerspectiveCamera){let i=this.object.position;this.panV.copy(i).sub(this.target);let r=this.panV.length();r*=Math.tan(this.object.fov/2*Math.PI/180),this.panLeft(2*e*r/n.clientHeight,this.object.matrixWorld),this.panUp(2*t*r/n.clientHeight,this.object.matrixWorld)}else n&&this.object.isOrthographicCamera&&(this.panLeft(e*(this.object.right-this.object.left)/this.object.zoom/n.clientWidth,this.object.matrixWorld),this.panUp(t*(this.object.top-this.object.bottom)/this.object.zoom/n.clientHeight,this.object.matrixWorld));this.dispatchEvent(Uj)}dollyOut(e){this.object.isPerspectiveCamera?this.scale/=e:this.object.isOrthographicCamera&&(this.object.zoom*=e,this.zoomLimitsEnabled&&(this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom))),this.object.updateProjectionMatrix(),this.zoomChanged=!0),this.dispatchEvent(Fj)}dollyIn(e){this.object.isPerspectiveCamera?this.scale*=e:this.object.isOrthographicCamera&&(this.object.zoom/=e,this.zoomLimitsEnabled&&(this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom))),this.object.updateProjectionMatrix(),this.zoomChanged=!0),this.dispatchEvent(Fj)}zoomOut(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.getZoomScale();this.dispatchEvent(jj),this.dollyOut(e),this.dispatchEvent(Vj)}zoomIn(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.getZoomScale();this.dispatchEvent(jj),this.dollyIn(e),this.dispatchEvent(Vj)}setZoom(e){if(this.dispatchEvent(jj),this.object.isPerspectiveCamera){let t=this.initialSphericalRadius/e/this.spherical.radius;this.scale=t}else this.object.isOrthographicCamera&&(this.object.zoom=e,this.zoomLimitsEnabled&&(this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom))),this.object.updateProjectionMatrix(),this.zoomChanged=!0);this.dispatchEvent(Vj)}handleMouseDownRotate(e){this.rotateStart.set(e.clientX,e.clientY)}handleMouseDownDolly(e){this.dollyStart.set(e.clientX,e.clientY)}handleMouseDownPan(e){this.panStart.set(e.clientX,e.clientY)}handleMouseMoveRotate(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;void 0!==e.movementX?this.rotateDelta.set(e.movementX,e.movementY):(this.rotateEnd.set(e.clientX,e.clientY),this.rotateDelta.subVectors(this.rotateEnd,this.rotateStart),this.rotateStart.copy(this.rotateEnd)),this.rotateDelta.multiplyScalar(this.rotateSpeed*t).rotateAround(Wj,-this.object.angleOffsetFromUp);let n=this.domElement,i=this.useWindowEvents?window.innerHeight:n.clientHeight,r=2*Math.PI*this.rotateDelta.x/i,s=2*Math.PI*this.rotateDelta.y/i;this.rotateLeft(r),this.rotateUp(s),this.update()}handleMouseMoveDolly(e){this.dollyEnd.set(e.clientX,e.clientY),this.dollyDelta.subVectors(this.dollyEnd,this.dollyStart),this.dollyDelta.y>0?this.dollyOut(this.getZoomScale()):this.dollyDelta.y<0&&this.dollyIn(this.getZoomScale()),this.dollyStart.copy(this.dollyEnd),this.update()}handleMouseMovePan(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;void 0!==e.movementX?this.panDelta.set(e.movementX,e.movementY):(this.panEnd.set(e.clientX,e.clientY),this.panDelta.subVectors(this.panEnd,this.panStart),this.panStart.copy(this.panEnd)),this.panDelta.multiplyScalar(this.panSpeed*t),this.pan(this.panDelta.x,this.panDelta.y),this.update()}handleMouseWheel(e){if(!1===Im&&!1===Nm(e)&&!0===function(e){return 0===e.wheelDeltaY||0===e.deltaY?!(Dm&&e.shiftKey&&Math.abs(e.wheelDeltaX)>=120)&&(e.wheelDeltaX?e.wheelDeltaX===-3*e.deltaX||e.wheelDeltaX===-3*window.devicePixelRatio*e.deltaX:0===e.deltaMode):e.wheelDeltaY?e.wheelDeltaY===-3*e.deltaY||e.wheelDeltaY===-3*window.devicePixelRatio*e.deltaY:0===e.deltaMode}(e)){if(!1===this.enablePan)return;this.gesture?(this.panDelta.set(-e.deltaX,-e.deltaY).multiplyScalar(this.panSpeed),this.panDelta.x=Math.min(Math.abs(this.panDelta.x),100)*(this.panDelta.x<0?-1:1),this.panDelta.y=Math.min(Math.abs(this.panDelta.y),100)*(this.panDelta.y<0?-1:1),e.altKey?this.pan(0,this.panDelta.y):e.shiftKey?this.pan(this.panDelta.x,0):this.pan(this.panDelta.x,this.panDelta.y),this.update()):(this.gesture=!0,this.isPointerDown=!0),window.clearTimeout(this.timer),this.timer=window.setTimeout((()=>{this.gesture=!1,this.isPointerDown=!1}),30)}else{if(!1===this.enableZoom||this.gesture)return;0===e.deltaY?e.deltaX<0?this.dollyIn(this.getZoomScale()):e.deltaX>0&&this.dollyOut(this.getZoomScale()):e.deltaY<0?this.dollyIn(this.getZoomScale()):e.deltaY>0&&this.dollyOut(this.getZoomScale()),this.update(),this.gesture=!1,this.isPointerDown=!1}}handleTouchStartRotate(){if(2===Fm.length){let e=.5*(Fm[0].pageX+Fm[1].pageX),t=.5*(Fm[0].pageY+Fm[1].pageY);this.rotateStart.set(e,t)}else this.rotateStart.set(Fm[0].pageX,Fm[0].pageY)}handleTouchStartPan(){if(2===Fm.length){let e=.5*(Fm[0].pageX+Fm[1].pageX),t=.5*(Fm[0].pageY+Fm[1].pageY);this.panStart.set(e,t)}else this.panStart.set(Fm[0].pageX,Fm[0].pageY)}handleTouchStartDolly(){let e=Fm[0].pageX-Fm[1].pageX,t=Fm[0].pageY-Fm[1].pageY,n=Math.sqrt(e*e+t*t);this.dollyStart.set(0,n)}handleTouchStartDollyPan(){this.enableZoom&&!0===this.isTouchZoom&&this.handleTouchStartDolly(),this.enablePan&&this.handleTouchStartPan()}handleTouchStartDollyRotate(){this.enableZoom&&!0===this.isTouchZoom&&this.handleTouchStartDolly(),this.enableRotate&&this.handleTouchStartRotate()}handleTouchMoveRotate(e){if(2===Fm.length){let t=qm(e),n=.5*(e.pageX+t.x),i=.5*(e.pageY+t.y);this.rotateEnd.set(n,i)}else{if(e.pointerId!==Fm[0].pointerId)return;this.rotateEnd.set(e.pageX,e.pageY)}this.rotateDelta.subVectors(this.rotateEnd,this.rotateStart).multiplyScalar(this.rotateSpeed);let t=this.domElement;t&&(this.rotateLeft(2*Math.PI*this.rotateDelta.x/t.clientHeight),this.rotateUp(2*Math.PI*this.rotateDelta.y/t.clientHeight)),this.rotateStart.copy(this.rotateEnd)}handleTouchMovePan(e){if(2===Fm.length){let t=qm(e),n=.5*(e.pageX+t.x),i=.5*(e.pageY+t.y);this.panEnd.set(n,i)}else{if(e.pointerId!==Fm[0].pointerId)return;this.panEnd.set(e.pageX,e.pageY)}this.panDelta.subVectors(this.panEnd,this.panStart).multiplyScalar(this.panSpeed),this.pan(this.panDelta.x,this.panDelta.y),this.panStart.copy(this.panEnd)}handleTouchMoveDolly(e){let t=qm(e),n=e.pageX-t.x,i=e.pageY-t.y,r=Math.sqrt(n*n+i*i);this.dollyEnd.set(0,r),this.dollyDelta.set(0,Math.pow(this.dollyEnd.y/this.dollyStart.y,this.zoomSpeed)),this.dollyOut(this.dollyDelta.y),this.dollyStart.copy(this.dollyEnd)}handleTouchMoveDollyPan(e){this.enableZoom&&!0===this.isTouchZoom&&this.handleTouchMoveDolly(e),this.enablePan&&this.handleTouchMovePan(e)}handleTouchMoveDollyRotate(e){this.enableZoom&&!0===this.isTouchZoom&&this.handleTouchMoveDolly(e),this.enableRotate&&this.handleTouchMoveRotate(e)}checkRaycastLock(){if(this.object.data.raycastLock){if(this.options.isPlayMode)return!1;{var e;let t=null===(e=this.options)||void 0===e?void 0:e.showCameraLock;return t&&t(),!0}}return!1}};function eV(e){let t=2*Math.PI;for(;e<=-Math.PI;)e+=t;for(;e>Math.PI;)e-=t;return e}function tV(e){return 1-Math.pow(1-e,4)}var nV,iV=class{constructor(e,t,n,i,r,s){this.id=e,this.data=t,this.object=n,this.page=i,this.currentIntersectedObjects=[],this.actions=dF(t,t.actions,i,r,s,n),this.target=t.target,this.triggeringObjects=[];for(let a of t.triggeringObjects){let e=i.scene.find(a);e&&this.triggeringObjects.push(e)}}isValidTriggeringObject(e){return"all"===this.target||this.triggeringObjects.some((t=>t===e||t.isAncestorOf(e.uuid)||e.isAncestorOf(t.uuid)))}disconnect(){pF(this.actions)}dispatch(){this.object.destroyedInAction||(this.actions.Transition.forEach((e=>{e.object.currentTransitionEvent!==this&&(e.object.currentTransitionEvent=this,e.init())})),this.object.dispatchEvent({type:"beginEvent",eventName:"Trigger"}),this.actions.Transition.forEach((e=>{"Toggle"===e.data.runMode?e.toggle():e.play()})),this.actions.SwitchCamera.forEach((e=>{"Toggle"===e.data.runMode?e.toggle():e.play()})),this.actions.Link.forEach((e=>{e.dispatch()})),this.actions.Reset.forEach((e=>{e.dispatch()})),this.actions.Create.forEach((e=>{e.dispatch()})),this.actions.Destroy.forEach((e=>{e.dispatch(!1)})),this.actions.Audio.forEach((e=>{e.dispatchBasic()})),this.actions.Particles.forEach((e=>{e.dispatchBasic()})),this.actions.Video.forEach((e=>{e.dispatchBasic()})),this.actions.SceneTransition.forEach((e=>{e.dispatch()})),this.actions.SetVariable.forEach((e=>e.checkConditions())),this.actions.SetVariable.forEach((e=>e.dispatch())),this.actions.DynamicVariablePlay.forEach((e=>e.dispatch())),this.actions.ClearLocalStorage.forEach((e=>e.dispatch())),this.actions.UserAPI.forEach((e=>e.dispatch())))}};tg.then((e=>nV=e));var rV=new Bt,sV=new Lt,aV=new Bt,oV=new _n(0,0,0,"YXZ"),lV=new _n(0,0,0,"XYZ"),cV=new Bt,hV=new Bt,uV=new Bt(1,1,1),dV=new Lt,pV=new pn,fV=new pn,mV={type:"updateMatrix"},gV=new Lt,vV=new rn,yV={type:"beginEvent",eventName:"Collision"},bV={type:"beginEvent",eventName:"Trigger"};var xV=e=>e.states.some((e=>void 0!==e.data.position||void 0!==e.data.rotation||void 0!==e.data.hiddenMatrix||void 0!==e.data.cloner||void 0!==e.data.pathSnapping)),wV=class{constructor(e){this.eventContext=e,this.isEnabled=!1,this.gameControl=null,this.joysticks=[],this.joystickToGameControls=[],this.sharedGameControlGlobals={entitiesWithTransformAnim:[],entityToCollisionEvents:{},colliderToEntity:new Map,triggers:[],gamePads:[],createdObjects:[],nCreatedPerAction:{}},this.sensorToTriggerEvent={},this.eventManager=void 0,this.needsCollisionDetection=!1,this.initializationCounter=-1,this.rigidBodyToMesh=new Map,this.nActiveRigidBodies=0,this.collisionEvents=[],this.isExport=!1,this.processRigidBody=e=>{if(e.bodyType()!==nV.RigidBodyType.Dynamic)return;e.isSleeping()||this.nActiveRigidBodies++;let[t,n,i]=this.rigidBodyToMesh.get(e.handle);if(rV.copy(e.translation()).multiplyScalar(this.pixelsPerMeter),sV.copy(e.rotation()),t.matrixWorld.compose(rV,sV,n),t.hasNonUniformScale&&t.matrixWorld.multiply(t.shearScale),t.dispatchEvent(mV),i){let e=t.cloner;if(e&&void 0===e.objectForSample){e.matrixWorld.copy(t.matrixWorld);for(let t of e.children)t.updateMatrixWorld(!0)}for(let n of t.children)n.updateMatrixWorld(!0)}},this.accumulator=0,this.handleCollisionEvents=(e,t,n)=>{var i,r;if(!1===n)return;let s,a;if(this.sensorToTriggerEvent[e]?(s=this.sensorToTriggerEvent[e],a=this.sharedGameControlGlobals.colliderToEntity.get(t)):this.sensorToTriggerEvent[t]&&(s=this.sensorToTriggerEvent[t],a=this.sharedGameControlGlobals.colliderToEntity.get(e)),s&&a&&s.isValidTriggeringObject(a))s.dispatch();else{for(let n=this.sharedGameControlGlobals.createdObjects.length-1;n>=0;n--){var o,l;let i=this.sharedGameControlGlobals.createdObjects[n];if(i.userData.hasCollisionDestroy&&((null===(o=i.rigidBody)||void 0===o?void 0:o.collider(0).handle)===e||(null===(l=i.rigidBody)||void 0===l?void 0:l.collider(0).handle)===t)){this.sharedGameControlGlobals.createdObjects.splice(n,1),i.removeFromParent(),requestAnimationFrame((()=>{var e;return null===(e=this.sharedGameControlGlobals.rapierWorld)||void 0===e?void 0:e.removeRigidBody(i.rigidBody)}));break}}if(void 0!==(null===(i=this.gameControl)||void 0===i?void 0:i.object)&&this.gameControl.object===this.sharedGameControlGlobals.colliderToEntity.get(e)){let e=this.sharedGameControlGlobals.colliderToEntity.get(t),n=this.sharedGameControlGlobals.entityToCollisionEvents[e.uuid];if(void 0===n)return;for(let i of n)"character"===i.data.target&&this.dispatchCollisionEvent(i,e,t)}else if(void 0!==(null===(r=this.gameControl)||void 0===r?void 0:r.object)&&this.gameControl.object===this.sharedGameControlGlobals.colliderToEntity.get(t)){let t=this.sharedGameControlGlobals.colliderToEntity.get(e),n=this.sharedGameControlGlobals.entityToCollisionEvents[t.uuid];if(void 0===n)return;for(let i of n)"character"===i.data.target&&this.dispatchCollisionEvent(i,t,e)}else{let n=this.sharedGameControlGlobals.colliderToEntity.get(e),i=this.sharedGameControlGlobals.entityToCollisionEvents[n.uuid];if(void 0!==i)for(let t of i)"scene"===t.data.target&&this.dispatchCollisionEvent(t,n,e);let r=this.sharedGameControlGlobals.colliderToEntity.get(t),s=this.sharedGameControlGlobals.entityToCollisionEvents[null===r||void 0===r?void 0:r.uuid];if(void 0!==s)for(let e of s)"scene"===e.data.target&&this.dispatchCollisionEvent(e,r,t)}}},this.isExport=e.isExport,this.sharedAssets=e.sharedAssets,this.renderer=e.renderer,this.requestRender=e.requestRender,this.domElement=this.renderer.domElement,this.pixelsPerMeter=200,this.gravity=this.page.data.globalPhysics.gravity}get page(){return this.eventContext.page}attachVRControllers(e){e.forEach((e=>{e.addEventListener("connected",(e=>{"gamepad"in e.data&&"axes"in e.data.gamepad&&this.sharedGameControlGlobals.gamePads.push(e.data.gamepad)}))}))}markIsDestroyTarget(){this.page.traverseVisibleEntity((e=>{let t=e.dataPatched;for(let i of t.events){var n;if(!0===i.data.disabled)continue;let e=null===(n=i.data.actions)||void 0===n||null===(n=n.find((e=>"Destroy"===e.data.type)))||void 0===n?void 0:n.data;if(e)for(let t of e.objects){let e=this.page.scene.find(t);e&&(e.userData.hasDestroy=!0)}}}))}markIsDragObject(){this.page.traverseVisibleEntity((e=>{let t=e.dataPatched;for(let n of t.events)if(!0!==n.data.disabled&&"DragDrop"===n.data.type)for(let e of n.data.objects){let t=this.page.scene.find(e);t&&(t.userData.hasDrag=!0)}}))}initBVH(){let e=[];if(this.page.traverseChildren((t=>{var n,i;let r;if(t instanceof SO||t instanceof iI||t instanceof BL)return;r=t instanceof KS?t.object:t;let s=r.dataPatched;if("visibility"===(null===(n=s.physics)||void 0===n?void 0:n.enabled)?!s.visible:null===(i=s.physics)||void 0===i||!i.enabled)return!0;let a=t.geometry,o=!0===r.userData.hasDestroy,l=!0===r.userData.hasDrag;if(xV(s)||o||l||r.dataPatched.events.some((e=>!0!==e.data.disabled&&("GameControl"===e.data.type||"Follow"===e.data.type))))return t.updateMatrixWorldSVD(),this.addBoundsTree(t),!0;a&&e.push(ZF(a,t.matrixWorld))})),e.length>0){let t=fw(e,!1);this.sharedGameControlGlobals.staticMeshBVH=new DS(t)}}addRigidBody(e,t,n){if(KF(e.matrixWorld))return;let i=[],r="geometry"in e?e.geometry:void 0,s=t.dataPatched;if(void 0!==(null===r||void 0===r?void 0:r.getAttribute("position"))&&i.push(ZF(r,e.shearScale)),s.physics.fusedBody){let t=this.gatherChildrenGeom(e,i);e.traverseObject(t),e.children.forEach((e=>e.updateMatrixWorld(!0)));let n=e.cloner;n&&void 0===n.objectForSample&&"dynamic"===s.physics.rigidBody&&(n.traverseObject(t),n.children.forEach((e=>e.updateMatrixWorld(!0))))}if(i.length>0){let o,l=!n.fromCreate&&"dynamic"===s.physics.rigidBody||n.fromCreate&&n.dynamic;l?(o=nV.RigidBodyDesc.dynamic(),o.setLinearDamping(s.physics.damping).setAngularDamping(s.physics.damping).setAdditionalMass(1e-9).setGravityScale(s.physics.gravityScale).enabledRotations(...s.physics.enabledRotation).enabledTranslations(...s.physics.enabledTranslation)):(n.hasTransformAnim||n.hasFollow||n.hasDrag)&&!n.fromCreate?(o=nV.RigidBodyDesc.kinematicPositionBased(),this.sharedGameControlGlobals.entitiesWithTransformAnim.push(e)):o=nV.RigidBodyDesc.fixed();let c=fw(i);(e.hasNonUniformScale?e.matrixWorldRigid:e.matrixWorld).decompose(rV,sV,aV),e.position0=rV.clone().divideScalar(this.pixelsPerMeter),e.rotation0=sV.clone(),rV.divideScalar(this.pixelsPerMeter),o.setTranslation(rV.x,rV.y,rV.z).setRotation(sV),r?null===c||void 0===c||c.scale(1/this.pixelsPerMeter,1/this.pixelsPerMeter,1/this.pixelsPerMeter):null===c||void 0===c||c.scale(aV.x/this.pixelsPerMeter,aV.y/this.pixelsPerMeter,aV.z/this.pixelsPerMeter);let h=this.sharedGameControlGlobals.rapierWorld.createRigidBody(o);l&&this.rigidBodyToMesh.set(h.handle,[e,aV.clone(),s.physics.fusedBody]);let u=!(void 0===s.geometry||"SubdivGeometry"===s.geometry.type||"NonParametricGeometry"===s.geometry.type||"BooleanGeometry"===s.geometry.type||"VectorGeometry"===s.geometry.type||"StarGeometry"===s.geometry.type||"RectangleGeometry"===s.geometry.type||"EllipseGeometry"===s.geometry.type||"TriangleGeometry"===s.geometry.type||"TorusGeometry"===s.geometry.type||"HelixGeometry"===s.geometry.type);try{this.addCollider(h,s.physics,c,t,u)}catch(a){try{this.addCollider(h,s.physics,c,t,!1)}catch(XZ){console.error(XZ)}}e.rigidBody=h}}addBoundsTree(e){var t,n;let i=[];if(void 0!==(null===(t=e.geometry)||void 0===t?void 0:t.getAttribute("position"))&&(null===(n=e.geometry)||void 0===n?void 0:n.getAttribute("position").count)>0&&i.push(ZF(e.geometry,e.shearScale)),e.traverseObject(this.gatherChildrenGeom(e,i)),e.children.forEach((e=>e.updateMatrixWorld(!0))),i.length>0){let t=fw(i,!1);e.bvhGeometry=t,t.getAttribute("position").count>0&&(e.bvhGeometry.boundsTree=new DS(t),this.sharedGameControlGlobals.entitiesWithTransformAnim.push(e))}}addCollider(e,t,n,i){var r,s;let a,o=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];if(0===(null===n||void 0===n?void 0:n.getAttribute("position").count)||0===(null===n||void 0===n||null===(r=n.getIndex())||void 0===r?void 0:r.count))return;n&&(a="trimesh"===t.colliderType?nV.ColliderDesc.trimesh(n.getAttribute("position").array,n.getIndex().array):nV.ColliderDesc.convexMesh(n.getAttribute("position").array,o?n.getIndex().array:void 0)),a.setFrictionCombineRule(nV.CoefficientCombineRule.Average).setRestitutionCombineRule(nV.CoefficientCombineRule.Average).setDensity(t.density).setFriction(t.friction).setRestitution(t.restitution);let l=this.sharedGameControlGlobals.rapierWorld.createCollider(a,e);this.sharedGameControlGlobals.colliderToEntity.set(l.handle,i),(null===(s=this.sharedGameControlGlobals.entityToCollisionEvents[i.uuid])||void 0===s?void 0:s.some((e=>"scene"===e.target)))&&l.setActiveEvents(nV.ActiveEvents.COLLISION_EVENTS)}gatherChildrenGeom(e,t){return(n,i)=>{var r;if(0===i)return;let s;if(n instanceof SO){if(!n.objectForSample)return!0===n.object.dataPatched.physics.fusedBody&&"dynamic"===n.object.dataPatched.physics.rigidBody||void 0;if(n.objectForSample.dataPatched.physics.fusedBody)return;s=n.object}else if(n instanceof KS)s=n.object;else if(s=n,null!==(r=s.dataPatched.cloner)&&void 0!==r&&r.hideBase)return!0;let a=s.dataPatched;if("visibility"===a.physics.enabled?!a.visible:!a.physics.enabled)return!0;1===i?e.hasNonUniformScale?n.matrixWorld.multiplyMatrices(e.shearScale,n.hiddenMatrix):n.matrixWorld.copy(n.hiddenMatrix):n.matrixWorld.multiplyMatrices(n.parent.matrixWorld,n.hiddenMatrix),n.matrixWorld.multiply(n.matrix);let o=n.geometry;void 0!==(null===o||void 0===o?void 0:o.getAttribute("position"))&&t.push(ZF(o,n.matrixWorld))}}activate(e){if(this.isEnabled)return;this.isEnabled=!0,this.eventManager=e,this.usePhysics=this.page.data.globalPhysics.usePhysics;let t=this.page.playCamera,n=!1,i=5,r=8,s=9,a="drag",l=this.page.data.publish.gameControlObject,c=null!==l?this.page.find(l):null,h=null;if(c)for(let o of c.data.events){if(o.data.disabled||"GameControl"!==o.data.type)continue;let e=c;for(;this.usePhysics&&null!==(null===(u=e=e.parent)||void 0===u?void 0:u.parent);){var u,d;null===(d=e.data.physics)||void 0===d||d.fusedBody}o.data.collisionEnabled&&(this.needsCollisionDetection=!0),null===h&&(h=o.data)}if(this.page.traverseEntity((e=>{for(let t of e.dataPatched.events)if(!1===t.data.disabled&&"Trigger"===t.data.type)return this.needsCollisionDetection=!0,!0})),c&&h&&(!0===c.data.visible||!0===c.data.physics.enabled)){n=n||h.camera===t.uuid||c.uuid===t.uuid;let e=new YF(c,this.renderer.domElement,h,this.eventContext.page.data.globalPhysics,this,c.uuid!==t.uuid&&h.camera===t.uuid,t,this.page,this.sharedAssets);this.gameControl=e,i=h.joystickPosLoc,r=h.joystickRotLoc,s=h.jumpTouchButtonLoc,a=h.rotByTouch,Rm&&h.touchControl&&(this.joystickToGameControls[i]="pos","walk"===h.moveMode&&(this.joystickToGameControls[s]="jmp"),"joystick"===a&&(this.joystickToGameControls[r]="rot"))}if(this.gameControl&&this.gameControl.data.navmesh.enabled){let e=this.gameControl.data;if(!this.navigationMeshWrapper){let t;this.navigationMeshWrapper=new Lj(this.usePhysics,this.isExport),t="sphere"===e.collider.type?2*e.collider.radius:e.collider.height,t=Math.floor(t/e.navmesh.ch-1),this.navigationMeshWrapper.init(o(o({},e.navmesh),{},{walkableHeight:t}),this.gameControl,this.eventContext)}}if(!1===n){let{enableRotate:e,enablePan:n,enableZoom:i,autoRotate:r,hoverRotatePanMode:s}=this.eventManager.publish.orbitControls;(e||n||i||r||0!==s)&&(this.orbitControls=new $j(t,this.renderer.domElement,{isExport:this.isExport,isPlayMode:!0}),this.orbitControls.addEventListener("change",this.requestRender),this.orbitControls.addEventListener("end",this.requestRender),this.orbitControls.addEventListener("start",this.requestRender),this.orbitControls.fromJSON(this.eventManager.publish.orbitControls,this.eventManager.publish.mouseEventTarget),this.orbitControls.useKeyEvents=!1,this.orbitControls.addEventListenersToCamera(),this.orbitControls.connect(),this.orbitControls.update())}let p=this.renderer.domElement.width/this.renderer.getPixelRatio(),f=this.renderer.domElement.height/this.renderer.getPixelRatio();this.joystickToGameControls.forEach(((e,t)=>{let n=document.body.appendChild(document.createElement("div")),[i,r,s]=this.eventManager.eventContext.publish.joystickSizeAndXYOffset[t],a=(p-5*i)/4+i,o={},l="jmp"===e,c=l?0:i;t<10?(t<5?o.top=c/2:o.bottom=c/2,o.left=c/2+t%5*a):10===t?(o.left=c/2,o.top=f/2):(o.right=c/2,o.top=f/2),o.top?o.top-=r[1]:o.bottom+=r[1],o.left?o.left+=r[0]:o.right-=r[0];for(let d in o)o[d]+="px";if(l){let e=n.appendChild(document.createElement("div"));Object.assign(e.style,o,{position:"absolute",width:i+"px",height:i+"px",backgroundColor:"rgba(255,255,255,".concat("show"===s?.4:0,")"),zIndex:"9999",borderRadius:i+"px",border:"show"===s?"solid 2px rgba(0, 0, 0, .1)":"none",display:"flex",alignItems:"center",justifyContent:"center",touchAction:"none"});let r=i/16*16*.4;return"show"===s&&(e.innerHTML='\n\t\t\t\t\t\t<svg width="'.concat(r,'" height="').concat(.4*i,'" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">\n\t\t\t\t\t\t\t<path d="M2 10L8 4L14 10" stroke="black" stroke-opacity="40%" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>\n\t\t\t\t\t\t</svg>\n\t\t\t\t\t')),e.addEventListener("pointerdown",(()=>{this.gameControl.movementState.jump=1,this.requestRender()})),e.addEventListener("touchend",(e=>e.preventDefault())),void(this.joysticks[t]=[void 0,n])}let h={zone:n,mode:"static",position:o,size:i};"hide"===s&&(h.restOpacity=0);let u=ez(h);u.on("move",((t,n)=>{let i=this.gameControl;"pos"===e?n.force<.2?i.moveForce=0:(i.movementState.movePosZ=Math.sin(-n.angle.radian),i.movementState.movePosX=Math.cos(-n.angle.radian),n.force>1.2?i.movementState.run=1:i.movementState.run=0,n.force<.3?i.moveForce=(n.force-.2)/.1:i.moveForce=1):"rot"===e&&(n.force<.2?i.rotForce=0:(i.movementState.rotPosX=n.vector.y,i.movementState.rotPosY=-n.vector.x,n.force<.3?i.rotForce=(n.force-.2)/.1:i.rotForce=1)),this.requestRender()})),u.on("end",((t,n)=>{let i=this.gameControl;"pos"===e?(i.movementState.movePosZ=0,i.movementState.movePosX=0,i.moveForce=1):"rot"===e&&(i.movementState.rotPosX=0,i.movementState.rotPosY=0,i.rotForce=1)})),this.joysticks[t]=[u,n]})),this.markIsDestroyTarget(),this.markIsDragObject(),this.rebuildBVH(),this.initializationCounter++,window.setTimeout((()=>{this.collisionEvents.forEach((e=>e.initialDisabled=!1))}),80)}initPhysics(){var e;null!==(e=this.sharedGameControlGlobals.rapierWorld)&&void 0!==e&&e.free(),this.sharedGameControlGlobals.rapierWorld=new nV.World(new nV.Vector3(0,this.gravity,0)),this.events=new nV.EventQueue(!0);let t=[],n=[];if(this.page.traverseChildren((e=>{var i;let r;if(e instanceof SO){if(!e.objectForSample)return!0===e.object.dataPatched.physics.fusedBody&&"dynamic"===e.object.dataPatched.physics.rigidBody||void 0;if(e.objectForSample.dataPatched.physics.fusedBody)return;r=e.object}else if(e instanceof KS)r=e.object;else{var s,a,o;if(e instanceof BL||e instanceof iI)return;if(r=e,!1===(null===(s=r.dataPatched.cloner)||void 0===s?void 0:s.disabled)&&null!==(a=r.dataPatched.cloner)&&void 0!==a&&a.hideBase&&!0!==(null===(o=r.dataPatched.physics)||void 0===o?void 0:o.fusedBody))return!0}let l,c=r.dataPatched;for(let t of c.events)!0!==t.data.disabled&&"GameControl"===t.data.type&&(l=t.data);if(!c.physics||("visibility"===c.physics.enabled?!c.visible:!c.physics.enabled))return!0;e.updateMatrixWorldSVD();let h=xV(c),u=!1,d=r.userData.hasDestroy,p=r.userData.hasDrag,f=!1;for(let t of c.events)if(!0!==t.data.disabled)if("Collision"===t.data.type){u=!0;let e=new Aj(t.id,t.data,r,this.page,this.sharedAssets,this.eventManager);e.initialDisabled=!0,this.collisionEvents.push(e),this.sharedGameControlGlobals.entityToCollisionEvents[r.uuid]&&this.sharedGameControlGlobals.entityToCollisionEvents[r.uuid].every((e=>e.id!==t.id))?this.sharedGameControlGlobals.entityToCollisionEvents[r.uuid].push(e):this.sharedGameControlGlobals.entityToCollisionEvents[r.uuid]=[e]}else if("Follow"===t.data.type){f=!0;let n=t.data.target;e.traverseVisible((e=>{e.userData.isFollowingObj=n}))}"dynamic"===c.physics.rigidBody&&!1===c.physics.fusedBody&&(e.matrixWorldFusedFalse=e.matrixWorld.clone());let m=e.geometry;if(void 0!==l){let t=nV.RigidBodyDesc.kinematicPositionBased();(e.hasNonUniformScale?e.matrixWorldRigid:e.matrixWorld).decompose(rV,sV,aV),e.position0=rV.clone().divideScalar(this.pixelsPerMeter),e.rotation0=sV.clone(),rV.divideScalar(this.pixelsPerMeter),t.setTranslation(rV.x,rV.y,rV.z).setRotation(sV);let n,i=this.sharedGameControlGlobals.rapierWorld.createRigidBody(t);e.rigidBody=i,n="sphere"===l.collider.type?nV.ColliderDesc.ball(l.collider.radius/this.pixelsPerMeter):"capsule"===l.collider.type?nV.ColliderDesc.capsule((l.collider.height/2-l.collider.radius)/this.pixelsPerMeter,l.collider.radius/this.pixelsPerMeter):nV.ColliderDesc.cuboid(l.collider.width/this.pixelsPerMeter/2,l.collider.height/this.pixelsPerMeter/2,l.collider.depth/this.pixelsPerMeter/2),n.setFrictionCombineRule(nV.CoefficientCombineRule.Average).setRestitutionCombineRule(nV.CoefficientCombineRule.Average).setDensity(c.physics.density).setFriction(c.physics.friction).setRestitution(c.physics.restitution);let s=this.sharedGameControlGlobals.rapierWorld.createCollider(n,i);this.sharedGameControlGlobals.colliderToEntity.set(s.handle,r),rV.fromArray(l.collider.position).multiply(aV.setFromMatrixScale(r.matrixWorld)).divideScalar(this.pixelsPerMeter),s.setTranslationWrtParent(rV);let a=(new Lt).setFromEuler((new _n).setFromVector3((new Bt).fromArray(l.collider.rotation)));s.setRotationWrtParent(a),s.setActiveEvents(nV.ActiveEvents.COLLISION_EVENTS),this.generateSensorColliderDescs(r,!0)}else"dynamic"===c.physics.rigidBody||h||f||d||p||u?(this.addRigidBody(e,r,{hasFollow:f,hasTransformAnim:h,hasDrag:p}),this.generateSensorColliderDescs(r,c.physics.fusedBody)):(m&&t.push(ZF(m,e.matrixWorld)),c.physics.fusedBody&&e.traverseObject(((e,n)=>{if(0===n)return;let i;if(e instanceof SO){if(!e.objectForSample)return!0===e.object.dataPatched.physics.fusedBody&&"dynamic"===e.object.dataPatched.physics.rigidBody||void 0;if(e.objectForSample.dataPatched.physics.fusedBody)return;i=e.object}else{var r;if(e instanceof BL||e instanceof iI)return;if(e instanceof KS)i=e.object;else if(i=e,null!==(r=i.dataPatched.cloner)&&void 0!==r&&r.hideBase)return!0}let s=i.dataPatched;if("visibility"===s.physics.enabled?!s.visible:!s.physics.enabled)return!0;let a=e.geometry;void 0!==(null===a||void 0===a?void 0:a.getAttribute("position"))&&t.push(ZF(a,e.matrixWorld))})),this.generateSensorColliderDescs(r,c.physics.fusedBody,n));return!(!0!==(null===(i=c.physics)||void 0===i?void 0:i.fusedBody)&&!l)||void 0})),0===t.length)return;let i=fw(t);i.scale(1/this.pixelsPerMeter,1/this.pixelsPerMeter,1/this.pixelsPerMeter);let r=nV.RigidBodyDesc.fixed(),s=this.sharedGameControlGlobals.rapierWorld.createRigidBody(r),a=nV.ColliderDesc.trimesh(i.getAttribute("position").array,i.getIndex().array).setFrictionCombineRule(nV.CoefficientCombineRule.Multiply).setRestitutionCombineRule(nV.CoefficientCombineRule.Multiply).setFriction(1).setRestitution(1);this.sharedGameControlGlobals.rapierWorld.createCollider(a,s);for(let[o,l]of n){let e=this.sharedGameControlGlobals.rapierWorld.createCollider(o,s);this.sensorToTriggerEvent[e.handle]=l}}updatePositions(){return this.nActiveRigidBodies=0,this.sharedGameControlGlobals.rapierWorld.forEachRigidBody(this.processRigidBody),this.nActiveRigidBodies>0}rebuildBVH(){this.usePhysics?this.initPhysics():(this.page.traverseEntity((e=>{for(let t of e.dataPatched.events)if("Trigger"===t.data.type&&!0!==t.data.disabled){let n=new iV(t.id,t.data,e,this.page,this.sharedAssets,this.eventManager),i=(new pn).compose(cV.fromArray(t.data.position),dV.setFromEuler(lV.fromArray(t.data.rotation)),uV);if("box"===t.data.triggerZone){let r=new Ft;r.min.fromArray(t.data.size).multiplyScalar(-.5),r.max.fromArray(t.data.size).multiplyScalar(.5),this.sharedGameControlGlobals.triggers.push([r,i,e,n])}else this.sharedGameControlGlobals.triggers.push([t.data.radius,i,e,n])}})),this.needsCollisionDetection&&this.initBVH())}disconnectEvents(){this.collisionEvents.forEach((e=>e.disconnect())),this.sharedGameControlGlobals.triggers.forEach((e=>e[3].disconnect())),this.sharedGameControlGlobals.triggers.length=0}deactivate(){if(this.isEnabled){var e,t,n,i;this.isEnabled=!1,this.page.traverse((e=>{let t=e;t.matrixWorldFusedFalse&&(t.matrixWorldFusedFalse=void 0),t.rigidBody&&(t.rigidBody=void 0),t.position0&&(t.position0=void 0),t.rotation0&&(t.rotation0=void 0)})),null!==(e=this.sharedGameControlGlobals.rapierWorld)&&void 0!==e&&e.free(),this.sharedGameControlGlobals.rapierWorld=void 0,this.sharedGameControlGlobals.staticMeshBVH=void 0,this.accumulator=0,this.sharedGameControlGlobals.entitiesWithTransformAnim=[],this.disconnectEvents(),null!==(t=this.gameControl)&&void 0!==t&&t.reset(),null!==(n=this.gameControl)&&void 0!==n&&n.dispose(),this.gameControl=null,this.initializationCounter=-1,this.joysticks.forEach((e=>{let[t,n]=e;null!==t&&void 0!==t&&t.destroy(),n.remove()})),this.joystickToGameControls=[],this.joysticks=[],this.orbitControls&&(this.orbitControls.dispose(),this.orbitControls=void 0),null!==(i=this.navigationMeshWrapper)&&void 0!==i&&i.dispose(),this.navigationMeshWrapper=void 0;for(let e of Object.values(this.sharedGameControlGlobals.entityToCollisionEvents))e.forEach((e=>e.disconnect()));this.sharedGameControlGlobals.entityToCollisionEvents={},this.page.updateMatrixWorld(!0)}}update(e,t,n){if(!this.isEnabled)return!0;let i=!0;if(void 0!==this.orbitControls&&this.orbitControls.needsUpdate&&(i=!this.orbitControls.update()),this.initializationCounter>=0&&this.initializationCounter<2?(this.initializationCounter++,i=!1):2===this.initializationCounter&&this.gameControl&&(i=!this.gameControl.update(e,t,n)&&i),!1===this.usePhysics&&this.checkTrigger(),this.usePhysics){let t=.016666666666666666;if(0===e)i=this.stepPhysics()&&i;else{let n=e/1e3;n<t&&n>.55*t&&(n=t),this.accumulator+=n;let r=performance.now(),s=0,a=6;for(;this.accumulator>=t&&s<a&&(i=this.stepPhysics()&&i,this.accumulator-=t,s++,!(performance.now()-r>1e3*t)););this.accumulator=this.accumulator%t}}return i}stepPhysics(){var e;for(let t of this.sharedGameControlGlobals.entitiesWithTransformAnim){(t.hasNonUniformScale?t.matrixWorldRigid:t.matrixWorld).decompose(rV,sV,aV),oV.setFromQuaternion(sV);let e=t;void 0===e.prevR?(e.prevR=oV.clone(),e.prevT=rV.clone()):(e.prevR.copy(oV),e.prevT.copy(rV)),t.rigidBody&&(t.rigidBody.setNextKinematicTranslation(rV.divideScalar(this.pixelsPerMeter)),t.rigidBody.setNextKinematicRotation(sV))}return this.sharedGameControlGlobals.rapierWorld.step(this.events),null!==(e=this.events)&&void 0!==e&&e.drainCollisionEvents(this.handleCollisionEvents),!this.updatePositions()}dispatchCollisionEvent(e,t,n){var i;let r,s=(null===(i=this.sharedGameControlGlobals.rapierWorld)||void 0===i?void 0:i.getCollider(n))._parent;if(t.cloner)for(let a of t.cloner.children)if(a.rigidBody===s){r=a;break}e.dispatch(r),t.dispatchEvent(yV)}updateUseWindowEvents(e){var t;null===(t=this.orbitControls)||void 0===t||t.updateUseWindowEvents(e)}generateSensorColliderDescs(e,t,n){let i=fV.copy(e.matrixWorld).invert();e.traverseEntity(((r,s)=>{if(!1===t&&1===s)return!0;for(let t of r.dataPatched.events)if("Trigger"===t.data.type&&!0!==t.data.disabled){let s,a=new iV(t.id,t.data,r,this.page,this.sharedAssets,this.eventManager);if(s="box"===t.data.triggerZone?nV.ColliderDesc.cuboid(...t.data.size.map((e=>e/(2*this.pixelsPerMeter)))):nV.ColliderDesc.ball(t.data.radius/this.pixelsPerMeter),s.setDensity(0).setSensor(!0).setActiveEvents(nV.ActiveEvents.COLLISION_EVENTS),cV.fromArray(t.data.position),dV.setFromEuler(lV.fromArray(t.data.rotation)),pV.compose(cV,dV,uV).premultiply(r.matrixWorld),n?(pV.decompose(cV,dV,hV),s.setActiveCollisionTypes(nV.ActiveCollisionTypes.KINEMATIC_FIXED|nV.ActiveCollisionTypes.DYNAMIC_FIXED)):(pV.premultiply(i).decompose(cV,dV,hV),e.rigidBody.bodyType()===nV.RigidBodyType.Dynamic||(e.rigidBody.bodyType()===nV.RigidBodyType.Fixed?s.setActiveCollisionTypes(nV.ActiveCollisionTypes.KINEMATIC_FIXED|nV.ActiveCollisionTypes.DYNAMIC_FIXED):s.setActiveCollisionTypes(nV.ActiveCollisionTypes.KINEMATIC_KINEMATIC|nV.ActiveCollisionTypes.DYNAMIC_KINEMATIC))),cV.divideScalar(this.pixelsPerMeter),s.setTranslation(cV.x,cV.y,cV.z),s.setRotation(dV),n)n.push([s,a]);else{let t=this.sharedGameControlGlobals.rapierWorld.createCollider(s,e.rigidBody);this.sensorToTriggerEvent[t.handle]=a}}}))}checkTrigger(){let e;for(let t=0;t<this.sharedGameControlGlobals.triggers.length;t++){let[n,i,r,s]=this.sharedGameControlGlobals.triggers[t];for(let t=0;t<this.sharedGameControlGlobals.entitiesWithTransformAnim.length;t++){let a=this.sharedGameControlGlobals.entitiesWithTransformAnim[t];if(r===a||!1===s.isValidTriggeringObject(XS.is(a)?a:a.object))continue;let o=fV.copy(r.matrixWorld).decompose(cV,gV,hV).compose(cV,gV,uV).multiply(i),l=pV.copy(a.matrixWorld).invert().multiply(o);n instanceof Ft?e=a.bvhGeometry.boundsTree.intersectsBox(n,l):(vV.radius=n,vV.center.setFromMatrixPosition(l),e=a.bvhGeometry.boundsTree.intersectsSphere(vV)),e?-1===s.currentIntersectedObjects.indexOf(a)&&(s.currentIntersectedObjects.push(a),s.dispatch(),r.dispatchEvent(bV)):s.currentIntersectedObjects=s.currentIntersectedObjects.filter((e=>e!==a))}}}};function SV(e){var t;let n=this._clip.duration,i=null!==(t=this._clip.start)&&void 0!==t?t:0,r=this.loop,s=this.time+e,a=this._loopCount,o=r===Pe;if(0===e)return-1===a?s:o&&1===(1&a)?n-(s-i):s;if(2200===r){-1===a&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(s>=n)s=n;else{if(!(s<0)){this.time=s;break e}s=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=s,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(-1===a&&(e>=0?(a=0,this._setEndings(!0,0===this.repetitions,o)):this._setEndings(0===this.repetitions,!0,o)),s>=n||s<i){let t=Math.floor((s-i)/(n-i));s-=(n-i)*t,a+=Math.abs(t);let r=this.repetitions-a;if(r<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,o||(s=e>0?n:i,1===this.repetitions&&(s=n)),this.time=s,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(1===r){let t=e<0;this._setEndings(t,!t,o)}else this._setEndings(!1,!1,o);this._loopCount=a,this.time=s,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:t})}}else this.time=s;if(o&&1===(1&a))return n-(s-i)}return s}var _V,EV=!1,AV=class{constructor(e,t,n,i){this.scene=e,this.requestRender=t,this.updateDisplayProgress=n,this.animationInspectorState=i,this.clipIdToAction={},this.activeClip=null,this.needsUpdate=!1,this.addClip=e=>{"Empty"===e.data.type&&e.data.animations&&e.data.animations.forEach(((t,n)=>{let i=t[0]+"/";if(Array.isArray(e.identity)?i+=e.identity[0]:i+=e.uuid,this.clipIdToAction[i])return;let r=_l.parse(JSON.parse(t[2]));e.animations[n]=r;let s=this.mixer.clipAction(r,e);!1===EV&&(Object.getPrototypeOf(s)._updateTime=SV,EV=!0),s.clampWhenFinished=!0,this.clipIdToAction[i]=s}))},this.mixer=new pc(e),this.scene.traverseEntity(this.addClip)}deleteClip(e,t){let n=this.scene.find(t);if(!n)return;let i=n.animations.find((t=>t.uuid===e));if(!i)return;let r=this.clipIdToAction[e];!r||(r.stop(),this.mixer.uncacheClip(i),delete this.clipIdToAction[e],n.animations=n.animations.filter((t=>t.uuid!==e)))}get isPlaying(){return Object.values(this.clipIdToAction).some((e=>e.isRunning()))}playFromInspector(e){this.mixer.stopAllAction();let t=this.clipIdToAction[e];!t||(t.play(),this.activeClip=t.getClip(),this.requestRender())}onExitPlayMode(){Object.values(this.clipIdToAction).forEach((e=>{e.repetitions=1/0,e.loop=2201})),this.mixer.stopAllAction(),this.requestRender()}play(e){let t=e.clipId+"/"+e.object,n=this.clipIdToAction[t];if(n)return e&&(e.repeat>=0&&(n.repetitions=e.repeat+1),"pingpong"===e.direction&&0!==e.repeat&&(n.loop=Pe)),n.play(),n.paused=!1,this.requestRender(),n}resumeFromInspector(e){let t=this.clipIdToAction[e];!t||(t.play(),t.paused=!1,this.requestRender())}pauseFromInspector(e){let t=this.clipIdToAction[e];!t||(t.paused=!0)}stop(){this.mixer.stopAllAction(),this.requestRender()}update(e){var t;if(this.needsUpdate)this.needsUpdate=!1;else if(!1===this.isPlaying||null!==(t=this.animationInspectorState)&&void 0!==t&&t.isScrubbing)return;this.mixer.update(e/1e3),this.activeClip&&this.updateDisplayProgress(Math.round(this.mixer.time/this.activeClip.duration*(this.maxFrames-1)%(this.maxFrames-1))),this.requestRender()}get maxFrames(){var e;return rF(null!==(e=this.activeClip)&&void 0!==e?e:void 0)}setProgressFromInspector(e,t){if(!this.clipIdToAction[t])return;this.activeClip!==this.clipIdToAction[t].getClip()&&this.playFromInspector(t);let n=this.clipIdToAction[t].paused;this.clipIdToAction[t].paused=!1,this.mixer.setTime(Math.min(e/(this.maxFrames-1),.9999)*this.activeClip.duration),this.requestRender(),n&&(this.clipIdToAction[t].paused=!0)}},CV=new WeakMap,MV=class extends Tl{constructor(e){super(e),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}}setDecoderPath(e){return this.decoderPath=e,this}setDecoderConfig(e){return this.decoderConfig=e,this}setWorkerLimit(e){return this.workerLimit=e,this}load(e,t,n,i){let r=new Ol(this.manager);r.setPath(this.path),r.setResponseType("arraybuffer"),r.setRequestHeader(this.requestHeader),r.setWithCredentials(this.withCredentials),r.load(e,(e=>{this.decodeDracoFile(e,t).catch(i)}),n,i)}decodeDracoFile(e,t,n,i){let r={attributeIDs:n||this.defaultAttributeIDs,attributeTypes:i||this.defaultAttributeTypes,useUniqueIDs:!!n};return this.decodeGeometry(e,r).then(t)}decodeGeometry(e,t){let n=JSON.stringify(t);if(CV.has(e)){let t=CV.get(e);if(t.key===n)return t.promise;if(0===e.byteLength)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}let i,r=this.workerNextTaskID++,s=e.byteLength,a=this._getWorker(r,s).then((n=>(i=n,new Promise(((n,s)=>{i._callbacks[r]={resolve:n,reject:s},i.postMessage({type:"decode",id:r,taskConfig:t,buffer:e},[e])}))))).then((e=>this._createGeometry(e.geometry)));return a.catch((()=>!0)).then((()=>{i&&r&&this._releaseTask(i,r)})),CV.set(e,{key:n,promise:a}),a}_createGeometry(e){let t=new di;e.index&&t.setIndex(new ti(e.index.array,1));for(let n=0;n<e.attributes.length;n++){let i=e.attributes[n],r=i.name,s=i.array,a=i.itemSize;t.setAttribute(r,new ti(s,a))}return t}_loadLibrary(e,t){let n=new Ol(this.manager);return n.setPath(this.decoderPath),n.setResponseType(t),n.setWithCredentials(this.withCredentials),new Promise(((t,i)=>{n.load(e,t,void 0,i)}))}preload(){return this._initDecoder(),this}_initDecoder(){if(this.decoderPending)return this.decoderPending;let e="object"!=typeof WebAssembly||"js"===this.decoderConfig.type,t=[];return e?t.push(this._loadLibrary("draco_decoder.js","text")):(t.push(this._loadLibrary("draco_wasm_wrapper.js","text")),t.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(t).then((t=>{let n=t[0];e||(this.decoderConfig.wasmBinary=t[1]);let i=TV.toString(),r=["/* draco decoder */",n,"","/* worker */",i.substring(i.indexOf("{")+1,i.lastIndexOf("}"))].join("\n");this.workerSourceURL=URL.createObjectURL(new Blob([r]))})),this.decoderPending}_getWorker(e,t){return this._initDecoder().then((()=>{if(this.workerPool.length<this.workerLimit){let e=new Worker(this.workerSourceURL);e._callbacks={},e._taskCosts={},e._taskLoad=0,e.postMessage({type:"init",decoderConfig:this.decoderConfig}),e.onmessage=function(t){let n=t.data;switch(n.type){case"decode":e._callbacks[n.id].resolve(n);break;case"error":e._callbacks[n.id].reject(n);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+n.type+'"')}},this.workerPool.push(e)}else this.workerPool.sort((function(e,t){return e._taskLoad>t._taskLoad?-1:1}));let n=this.workerPool[this.workerPool.length-1];return n._taskCosts[e]=t,n._taskLoad+=t,n}))}_releaseTask(e,t){e._taskLoad-=e._taskCosts[t],delete e._callbacks[t],delete e._taskCosts[t]}debug(){console.log("Task load: ",this.workerPool.map((e=>e._taskLoad)))}dispose(){for(let e=0;e<this.workerPool.length;++e)this.workerPool[e].terminate();return this.workerPool.length=0,""!==this.workerSourceURL&&URL.revokeObjectURL(this.workerSourceURL),this}};function TV(){let e,t;function n(e,t,n,i,r,s){let a=s.num_components(),o=n.num_points()*a,l=o*r.BYTES_PER_ELEMENT,c=function(e,t){switch(t){case Float32Array:return e.DT_FLOAT32;case Int8Array:return e.DT_INT8;case Int16Array:return e.DT_INT16;case Int32Array:return e.DT_INT32;case Uint8Array:return e.DT_UINT8;case Uint16Array:return e.DT_UINT16;case Uint32Array:return e.DT_UINT32}}(e,r),h=e._malloc(l);t.GetAttributeDataArrayForAllPoints(n,s,c,l,h);let u=new r(e.HEAPF32.buffer,h,o).slice();return e._free(h),{name:i,array:u,itemSize:a}}onmessage=function(i){let r=i.data;switch(r.type){case"init":e=r.decoderConfig,t=new Promise((function(t){e.onModuleLoaded=function(e){t({draco:e})},DracoDecoderModule(e)}));break;case"decode":let i=r.buffer,s=r.taskConfig;t.then((e=>{let t=e.draco,a=new t.Decoder,o=new t.DecoderBuffer;o.Init(new Int8Array(i),i.byteLength);try{let e=function(e,t,i,r){let s,a,o=r.attributeIDs,l=r.attributeTypes,c=t.GetEncodedGeometryType(i);if(c===e.TRIANGULAR_MESH)s=new e.Mesh,a=t.DecodeBufferToMesh(i,s);else{if(c!==e.POINT_CLOUD)throw new Error("THREE.DRACOLoader: Unexpected geometry type.");s=new e.PointCloud,a=t.DecodeBufferToPointCloud(i,s)}if(!a.ok()||0===s.ptr)throw new Error("THREE.DRACOLoader: Decoding failed: "+a.error_msg());let h={index:null,attributes:[]};for(let u in o){let i,a,c=self[l[u]];if(r.useUniqueIDs)a=o[u],i=t.GetAttributeByUniqueId(s,a);else{if(a=t.GetAttributeId(s,e[o[u]]),-1===a)continue;i=t.GetAttribute(s,a)}h.attributes.push(n(e,t,s,u,c,i))}return c===e.TRIANGULAR_MESH&&(h.index=function(e,t,n){let i=3*n.num_faces(),r=4*i,s=e._malloc(r);t.GetTrianglesUInt32Array(n,r,s);let a=new Uint32Array(e.HEAPF32.buffer,s,i).slice();return e._free(s),{array:a,itemSize:1}}(e,t,s)),e.destroy(s),h}(t,a,o,s),i=e.attributes.map((e=>e.array.buffer));e.index&&i.push(e.index.array.buffer),self.postMessage({type:"decode",id:r.id,geometry:e},i)}catch(YZ){console.error(YZ),self.postMessage({type:"error",id:r.id,error:YZ.message})}finally{t.destroy(o),t.destroy(a)}}))}}}async function PV(e){if(_V){let t,n={attributeIDs:_V.defaultAttributeIDs,attributeTypes:_V.defaultAttributeTypes,useUniqueIDs:!1};try{t=await _V.decodeGeometry(new Int8Array(e).buffer,n)}catch(zZ){console.error(zZ)}if(t)return{index:t.index?{array:t.index.array}:void 0,attributes:Object.entries(t.attributes).map((e=>{let[t,n]=e;return{name:t,itemSize:n.itemSize,array:n.array}}))}}return null}var DV=class{constructor(){this._clickCount=0,this._lastTime=0,this._lastPosition=[0,0],this._delay=500,this._distance=2,this._onMouseDown=e=>{let t=[e.clientX,e.clientY],n=(new Date).getTime();if(this._clickCount>0){let e=t[0]-this._lastPosition[0],n=t[1]-this._lastPosition[1];Math.sqrt(e*e+n*n)>this._distance&&(this._clickCount=0)}this._lastPosition=t,this._clickCount=n-this._lastTime>this._delay?1:this._clickCount+1,this._lastTime=n},this._onMouseUp=e=>{}}start(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;this._target&&this.stop(),this.reset(),this._delay=t,this._distance=n,this._target=e,this._target.addEventListener("pointerdown",this._onMouseDown,!1),this._target.addEventListener("pointerup",this._onMouseUp,!1)}stop(){this._target&&(this._target.removeEventListener("pointerdown",this._onMouseDown,!1),this._target.removeEventListener("pointerup",this._onMouseUp,!1),this._target=void 0)}get clickCount(){return this._clickCount}reset(){this._clickCount=0,this._lastTime=0,this._lastPosition=[0,0]}},OV=class{constructor(e,t,n,i,r,s,a,o){this.eventId=e,this.id=t,this.data=n,this.dataEvent=i,this.object=r,this.stage=!1,this.actions=dF(i,n.actions,s,a,o,r)}disconnect(){pF(this.actions)}dispatchIn(){this.actions.Audio.forEach((e=>e.dispatchBasic())),this.actions.Particles.forEach((e=>e.dispatchBasic())),this.actions.Video.forEach((e=>e.dispatchBasic())),this.actions.Create.forEach((e=>e.dispatch())),this.actions.Destroy.forEach((e=>e.dispatch())),this.actions.Reset.forEach((e=>e.dispatch())),this.actions.Link.forEach((e=>e.dispatch())),this.actions.Transition.forEach((e=>{e.object.currentTransitionEvent!==this&&(e.object.currentTransitionEvent=this,e.init())})),this.actions.Transition.forEach((e=>e.toggle())),this.actions.Animation.forEach((e=>e.play())),this.actions.SwitchCamera.forEach((e=>e.play())),this.actions.SceneTransition.forEach((e=>e.dispatch())),this.actions.SetVariable.forEach((e=>e.checkConditions())),this.actions.SetVariable.forEach((e=>e.dispatch())),this.actions.DynamicVariablePlay.forEach((e=>e.dispatch())),this.actions.ClearLocalStorage.forEach((e=>e.dispatch())),this.actions.UserAPI.forEach((e=>e.dispatch()))}dispatchOut(){this.actions.Transition.forEach((e=>{e.toggle()}))}},IV=class extends dU{constructor(e,t){super(e),this.eventManager=t,this.breakpoints=[],this.resize=(e,t)=>{this.breakpoints.forEach((n=>{let i,r=By.deviceToSize(n.data.size),s="horizontal"===n.dataEvent.orientation?e:t;switch(n.data.operator){case"<":i=s<r[0];break;case">":i=s>r[0];break;case"<>":i=s>r[0]&&s<r[1]}n.stage!==i&&(n.stage=i,n.stage?n.dispatchIn():n.dispatchOut())}))},this.onResizeObserver=new ResizeObserver((e=>{for(let t of e){let{width:e,height:n}=t.contentRect;this.resize(e,n)}}))}connect(){let{page:e,sharedAssets:t,domElement:n}=this.eventContext;this.onResizeObserver.observe(n);let i=n=>{var i;if(n.visible&&null!==(i=n.data)&&void 0!==i&&i.events.length)for(let{data:r,id:s}of n.data.events)r.disabled||"Resize"===r.type&&r.breakpoints.forEach((i=>{let{data:a,id:o}=i;try{let i=new OV(s,o,a,r,n,e,t,this.eventManager);this.breakpoints.push(i)}catch(GZ){}}))};e.traverseEntity((e=>{var t;(e instanceof SL||e instanceof dL)&&null!==(t=e.frame)&&void 0!==t&&t.traverse((e=>{i(e)})),i(e)}))}disconnect(){this.onResizeObserver.disconnect(),this.breakpoints.forEach((e=>{e.disconnect()})),this.breakpoints=[]}},RV=class extends dU{constructor(e,t){super(e),this.eventManager=t,this.userAPIs={},this.events=[],this.onSuccess=e=>{let{userAPIId:t}=e;this.events.forEach((e=>{e.data.userAPIId===t&&e.dispatchSuccess()}))},this.onError=e=>{let{userAPIId:t}=e;this.events.forEach((e=>{e.data.userAPIId===t&&e.dispatchError()}))},this.userAPIs=e.sharedAssets.getUserAPIs()}connect(){this.eventContext.page.traverseEntity((e=>{var t;null===(t=e.data)||void 0===t||t.events.filter((e=>"API"===e.data.type&&!e.data.disabled)).forEach((t=>{this.events.push(new kV(t.id,t.data,e,this.eventContext.page,this.eventContext.sharedAssets,this.eventManager))}))})),Object.entries(this.userAPIs).forEach((e=>{let[t,n]=e;n.on("success",this.onSuccess),n.on("error",this.onError),n.autostart&&n.callUserAPI(this.eventContext.sharedAssets)}))}disconnect(){Object.entries(this.userAPIs).forEach((e=>{let[t,n]=e;n.off("success",this.onSuccess),n.off("error",this.onError)}))}},kV=class{constructor(e,t,n,i,r,s){this.id=e,this.data=t,this.object=n,this.successActions=dF(t,t.successActions,i,r,s,n),this.errorActions=dF(t,t.errorActions,i,r,s,n)}dispatchSuccess(){this.dispatchActions(this.successActions)}dispatchError(){this.dispatchActions(this.errorActions)}dispatchActions(e){e.Audio.forEach((e=>e.dispatchConditional())),e.Particles.forEach((e=>e.dispatchConditional())),e.Video.forEach((e=>e.dispatchConditional())),e.Create.forEach((e=>e.dispatch())),e.Destroy.forEach((e=>e.dispatch())),e.Reset.forEach((e=>e.dispatch())),e.Transition.forEach((e=>{e.object.currentTransitionEvent!==this&&(e.object.currentTransitionEvent=this),e.init()})),e.Transition.forEach((e=>e.play())),e.Animation.forEach((e=>e.play())),e.SwitchCamera.forEach((e=>e.play())),e.SceneTransition.forEach((e=>e.dispatch())),e.SetVariable.forEach((e=>e.checkConditions())),e.SetVariable.forEach((e=>e.dispatch())),e.DynamicVariablePlay.forEach((e=>e.dispatch())),e.ClearLocalStorage.forEach((e=>e.dispatch())),e.UserAPI.forEach((e=>e.dispatch()))}},LV=class extends dU{constructor(e,t){super(e),this.eventManager=t,this.userWebhooks={},this.events=[],this.onMessage=e=>{let{userWebhookId:t}=e;this.events.forEach((e=>{e.data.userWebhookId===t&&e.dispatch()}))},this.userWebhooks=e.sharedAssets.getUserWebhooks()}connect(){this.eventContext.page.traverseEntity((e=>{var t;null===(t=e.data)||void 0===t||t.events.filter((e=>"WEBHOOK"===e.data.type&&!e.data.disabled)).forEach((t=>{this.events.push(new BV(t.id,t.data,e,this.eventContext.page,this.eventContext.sharedAssets,this.eventManager))}))})),Object.entries(this.userWebhooks).forEach((e=>{let[t,n]=e;n.connect(),n.on("message",this.onMessage)}))}disconnect(){Object.entries(this.userWebhooks).forEach((e=>{let[t,n]=e;n.off("message",this.onMessage),n.disconnect()}))}},BV=class{constructor(e,t,n,i,r,s){this.id=e,this.data=t,this.object=n,this.actions=dF(t,t.actions,i,r,s,n)}dispatch(){let e=this.actions;e.Audio.forEach((e=>e.dispatchConditional())),e.Particles.forEach((e=>e.dispatchConditional())),e.Video.forEach((e=>e.dispatchConditional())),e.Create.forEach((e=>e.dispatch())),e.Destroy.forEach((e=>e.dispatch())),e.Reset.forEach((e=>e.dispatch())),e.Transition.forEach((e=>{e.object.currentTransitionEvent!==this&&(e.object.currentTransitionEvent=this),e.init()})),e.Transition.forEach((e=>e.play())),e.Animation.forEach((e=>e.play())),e.SwitchCamera.forEach((e=>e.play())),e.SceneTransition.forEach((e=>e.dispatch())),e.SetVariable.forEach((e=>e.checkConditions())),e.SetVariable.forEach((e=>e.dispatch())),e.DynamicVariablePlay.forEach((e=>e.dispatch())),e.ClearLocalStorage.forEach((e=>e.dispatch())),e.UserAPI.forEach((e=>e.dispatch()))}};var zV=new Bt(0,0,1),NV=new Bt,FV=new Bt,UV=new lt,jV=class{constructor(e,t,n,i,r){this.containerScene=e,this.raycaster=t,this.sharedAssets=n,this.requestRender=i,this.onExit=r,this.htmlInput=null,this.virtualInput=null,this.helper=new nk,this.doubleClickHandler=new DV,this.isDragging=!1,this.plane=new Gi,this.caretInterval=0,this.planeIntersection=new Bt,this.projected=new ot,this._lastIndex=0,this._isFirstDragMove=!1,this.selectionOnDragStart=0,this.onTextMaterialChanged=()=>{var e;let t=null===(e=this.virtualInput)||void 0===e?void 0:e.data;if(void 0!==this.virtualInput&&t){let e=t.material,n=function(e,t){let n=Yy.fromHex(3223857),i=.8;for(let r of e.layers){if("light"===r.data.type||"displace"===r.data.type||"fresnel"===r.data.type||"matcap"===r.data.type||"texture"===r.data.type||"toon"===r.data.type||"outline"===r.data.type||"transmission"===r.data.type||"noise"===r.data.type)continue;let e="string"==typeof r.data.alpha?Number(t.getVariable(r.data.alpha)):r.data.alpha;if("color"===r.data.type&&e>.3){n=sk(r.data.color,t),i=e;break}if(("depth"===r.data.type||"gradient"===r.data.type)&&e>.3){let e=ak(r.data);n={r:e[0],g:e[1],b:e[2]},i="string"==typeof r.data.alpha?1:r.data.alpha;break}}return o(o({},n),{},{a:i})}("string"==typeof e?this.sharedAssets.data.materials[e]:e,this.sharedAssets);this.helper.setCaretColor(n)}},this.stopAnimateTextCursor=()=>{clearInterval(this.caretInterval),this.helper&&(this.helper.caretMesh.visible=!1)},this.startAnimateTextCursor=()=>{this.stopAnimateTextCursor(),this.helper&&(this.helper.caretMesh.visible=!0,this.caretInterval=setInterval((()=>{this.helper&&(this.helper.caretMesh.visible=!this.helper.caretMesh.visible),this.requestRender()}),600))},this.handleCaretUpdate=e=>{if(!this.htmlInput||!this.virtualInput)return;let t=this.helper,n="ArrowLeft"===(null===e||void 0===e?void 0:e.key)||"ArrowRight"===(null===e||void 0===e?void 0:e.key),i="ArrowUp"===(null===e||void 0===e?void 0:e.key)||"ArrowDown"===(null===e||void 0===e?void 0:e.key);this.htmlInput.selectionStart===this.htmlInput.selectionEnd?(t.setCaretPosition(this.htmlInput.selectionStart,{horizontalKeyMove:n,verticalKeyMove:i}),this.startAnimateTextCursor()):t.setSelection(this.htmlInput.selectionStart,this.htmlInput.selectionEnd),this.requestRender()},this.containerScene.add(this.helper)}createInput(){return this.htmlInput=function(){let e=document.createElement("textarea");return e.style.position="fixed",e.style.top="200px",e.style.left="400px",e.style.zIndex="-1",e.style.border="1px solid rgba(255,0,0,0.5)",e.style.width="10px",e.style.height="500px",e.style.color="white",e.style.opacity="0.5",e.style.background="transparent",e.style.display="none",e.style.margin="0px",e.style.padding="0px",e.style.boxSizing="content-box",e.style.pointerEvents="none",e}(),this.htmlInput}connect(){}disconnect(){var e;this.stopAnimateTextCursor(),this.helper.hide(),null!==(e=this.htmlInput)&&void 0!==e&&e.remove(),this.doubleClickHandler.stop()}handleMouseDown(){var e,t;if(!this.htmlInput||!this.virtualInput)return!0;this.getPointOnPlane();let n=this.doubleClickHandler.clickCount,{index:i,lineIndex:r,characterIndex:s}=null!==(e=this.helper.getSelectionFromPosition(this.projected.x,this.projected.y,n>1?"inside":"previous"))&&void 0!==e?e:{index:0,lineIndex:0,characterIndex:0};null!==(t=this.virtualInput)&&void 0!==t&&null!==(t=t.wrappedText)&&void 0!==t&&t.length&&"\n"===this.virtualInput.wrappedText[r][Math.max(0,s-1)]&&(i--,s--),this._lastIndex=i,this._isFirstDragMove=!0;let a=this.checkClickedObject();if(1===n){if(null===a)return this.onExit(this.virtualInput),!0;this.selectionOnDragStart=i,this.isDragging=!0,this.setInputSelection(i)}else a===this.virtualInput&&(2===n?this.selectClosestWord(r,s):n>2&&(this.setInputSelection(0,this.htmlInput.value.length),this.doubleClickHandler.reset()))}handleMouseUp(){this.applyRangeToTextInput(),this.isDragging=!1,this._isFirstDragMove=!1}handleMouseMove(){!this.virtualInput||(this._isFirstDragMove&&this.doubleClickHandler.clickCount>1&&(this.selectionOnDragStart=this._lastIndex,this.isDragging=!0,this.setInputSelection(this._lastIndex)),this._isFirstDragMove=!1,this.getPointOnPlane(),this.applyRangeToTextInput())}focus(e){if(this.virtualInput=e,this.updateTextInputStyles(),this.htmlInput)if(e){var t,n;let e=null===(t=this.data)||void 0===t?void 0:t.geometry.text;this.htmlInput.value="string"==typeof e?"":null!==(n=null===e||void 0===e?void 0:e.textValue.toString())&&void 0!==n?n:""}else this.htmlInput.value=""}blur(){}get data(){let{virtualInput:e}=this;if(e)return e.dataPatched}applyRangeToTextInput(){var e,t;if(!this.isDragging||!this.virtualInput||!this.htmlInput)return;let n=this.selectionOnDragStart,{index:i,lineIndex:r,characterIndex:s}=null!==(e=this.helper.getSelectionFromPosition(this.projected.x,this.projected.y,this.doubleClickHandler.clickCount>2?"inside":"previous"))&&void 0!==e?e:{index:0};void 0!==r&&void 0!==s&&"\n"===(null===(t=this.virtualInput)||void 0===t?void 0:t.wrappedText[r][s-1])&&i--,this.htmlInput.setSelectionRange(Math.min(n,i),Math.max(n,i))}checkClickedObject(){if(this.virtualInput){let e=this.raycaster.intersectObject(this.virtualInput,!1);if(e.length>0){let t=e[0];if(t.object instanceof gL)return t.object}}return null}selectClosestWord(e,t){if(!this.virtualInput)return;let n=this.virtualInput.wrappedText,i=n[e],r=t+1,s=t;" "!==i[t]&&(r=this.findNextCharOccurence(i,t,"forward"," "),s=this.findNextCharOccurence(i,t,"backward"," "),s>0&&s++,r>=i.length-1&&e===n.length-1&&r++);let a=this.helper,o=a.getGlobalIndexFromLineAndCharIndexes(n,e,s),l=a.getGlobalIndexFromLineAndCharIndexes(n,e,r);this.setInputSelection(o,l)}findNextCharOccurence(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:" ",r=Math.max(0,e.length-1),s="forward"===n?r:0,a="forward"===n?1:-1,o=Math.max(Math.min(t,r),0);for(;o!==s;)if(o+=a,e.charAt(o)===i)return o;return s}getPointOnPlane(){var e;let t=null===(e=this.virtualInput)||void 0===e?void 0:e.data;if(this.virtualInput&&t&&this.raycaster.ray.intersectsPlane(this.plane)){null===this.planeIntersection&&(this.planeIntersection=new Bt);let e=this.raycaster.ray.intersectPlane(this.plane,this.planeIntersection);if(e){this.planeIntersection.copy(this.virtualInput.worldToLocal(e));let n="number"==typeof t.geometry.width?t.geometry.width:1,i="number"==typeof t.geometry.height?t.geometry.height:1;this.projected.set(e.x+.5*n,e.y-.5*i)}}}updatePlane(){var e;let t=null===(e=this.virtualInput)||void 0===e?void 0:e.data;this.virtualInput&&t&&(UV.getNormalMatrix(this.virtualInput.matrixWorld),NV.copy(zV).applyMatrix3(UV).normalize(),this.virtualInput.localToWorld(FV.set(0,0,t.geometry.depth)),this.plane.setFromNormalAndCoplanarPoint(NV,FV))}setInputSelection(e){var t;let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e;null!==(t=this.htmlInput)&&void 0!==t&&t.setSelectionRange(e,n),setTimeout((()=>{var e;null===(e=this.htmlInput)||void 0===e||e.focus()}))}updateTextInputStyles(){var e;let t=null===(e=this.virtualInput)||void 0===e?void 0:e.data;this.virtualInput&&t&&this.htmlInput&&(this.htmlInput.style.fontSize=t.geometry.fontSize+"px",this.htmlInput.style.letterSpacing=t.geometry.letterSpacing*t.geometry.fontSize+"px",this.htmlInput.style.lineHeight=t.geometry.fontSize*t.geometry.lineHeight+"px",this.htmlInput.style.width=t.geometry.width+"px",this.htmlInput.style.height=t.geometry.height+"px",this.htmlInput.style.textAlign=function(e){return 4===e?"justify":2===e?"right":3===e?"center":"left"}(t.geometry.horizontalAlign))}};var VV=(e,t)=>{if("string"==typeof e){let n=t.data(e);if(n)return VV(n.value,t)}return yx.getDisplayedValue(e)};function GV(e,t){let n=e.text,i="";if("string"==typeof n){let e=t.variables.data(i);e&&(i=VV(e.value,t.variables))}else i=n.textValue.toString();return i}var HV=class extends dU{constructor(e,t){super(e),this.eventManager=t,this._textInputs=[],this.sceneHelpers=new Ca,this.helper=new nk,this._onMouseDownFocusIn=e=>{if(Fm.length>1)return;this.eventContext.updateRaycaster(e);let t=null;if(this.eventContext.raycaster)for(let n of this._textInputs)if(this.eventContext.raycaster.intersectObject(n,!0).length>0){t=n;break}this.focusOnTextInput(t),this._onCaretUpdate(),this._onMouseUp(),this.textInputManager.doubleClickHandler.start(this.eventContext.domElement),this.textInputManager.doubleClickHandler._onMouseDown(e),this._onMouseDown(e)},this.onExit=()=>{let{virtualInput:e}=this.textInputManager;if(null===e)return;let t=this.textInputManager.htmlInput;this.helper.hide(),null!==t&&void 0!==t&&t.setSelectionRange(t.value.length,t.value.length),this.eventManager.controlsManager.orbitControls&&(this.eventManager.controlsManager.orbitControls.enabled=!0);let{domElement:n}=this.eventContext;n.removeEventListener("pointerdown",this._onMouseDown,!1),n.removeEventListener("pointerup",this._onMouseUp,!1),n.removeEventListener("pointermove",this._onMouseMove,!1),window.removeEventListener("keydown",this._onKeyPress),this.textInputManager.doubleClickHandler.reset(),n.addEventListener("pointerdown",this._onMouseDownFocusIn),this.eventContext.renderer.sceneHelpersOnTop=void 0,this.eventContext.renderer.pipeline.disableHelpers()},this._onMouseDown=e=>{this.eventContext.updateRaycaster(e),this.textInputManager.handleMouseDown(),this.textInputManager.virtualInput&&this.eventContext.raycaster.intersectObject(this.textInputManager.virtualInput,!0).length>0&&this.eventManager.controlsManager.orbitControls&&(this.eventManager.controlsManager.orbitControls.enabled=!1)},this._onMouseUp=()=>{this.textInputManager.handleMouseUp(),this.eventManager.controlsManager.orbitControls&&!this.eventManager.controlsManager.orbitControls.enabled&&(this.eventManager.controlsManager.orbitControls.enabled=!0)},this._onMouseMove=e=>{this.eventContext.updateRaycaster(e),this.textInputManager.handleMouseMove()},this._onTextEdit=e=>{let{htmlInput:t,virtualInput:n,helper:i}=this.textInputManager;if(!t||!n)return;let r=t.value;n.textGeometry.setText(r).then((()=>{this.eventContext.requestRender()}));let s=n.data;i.update();let a=s.geometry.text;if("string"==typeof a){let e=a;this.eventContext.sharedAssets.updateVariable(e,{textValue:r})}this.textInputManager.updateTextInputStyles(),this._onCaretUpdate()},this._onCaretUpdate=e=>{this.textInputManager.handleCaretUpdate(e)},this._onKeyPress=e=>{"Escape"===e.key&&this.onExit()},this.textInputManager=new jV(this.sceneHelpers,e.raycaster,e.sharedAssets,e.requestRender,this.onExit)}connect(){let e=[];if(this.eventContext.scene.traverseEntity((t=>{t instanceof gL&&e.push(t)})),this._textInputs=e,0===e.length)return;let{domElement:t}=this.eventContext;t.addEventListener("pointerdown",this._onMouseDownFocusIn),this.textInputManager.connect();let n=this.textInputManager.createInput();document.body.appendChild(n),n.style.display="none",n.addEventListener("keyup",this._onCaretUpdate),n.addEventListener("keydown",this._onCaretUpdate),n.addEventListener("beforeinput",this._onCaretUpdate),n.addEventListener("paste",this._onCaretUpdate),n.addEventListener("cut",this._onCaretUpdate),n.addEventListener("select",this._onCaretUpdate),n.addEventListener("selectstart",this._onCaretUpdate)}disconnect(){let e=this.textInputManager.htmlInput,{domElement:t}=this.eventContext;t.removeEventListener("pointerdown",this._onMouseDownFocusIn),null!==e&&void 0!==e&&e.removeEventListener("keyup",this._onCaretUpdate),null!==e&&void 0!==e&&e.removeEventListener("keydown",this._onCaretUpdate),null!==e&&void 0!==e&&e.removeEventListener("beforeinput",this._onCaretUpdate),null!==e&&void 0!==e&&e.removeEventListener("paste",this._onCaretUpdate),null!==e&&void 0!==e&&e.removeEventListener("cut",this._onCaretUpdate),null!==e&&void 0!==e&&e.removeEventListener("select",this._onCaretUpdate),null!==e&&void 0!==e&&e.removeEventListener("selectstart",this._onCaretUpdate),this._textInputs.forEach((e=>{let t=GV(e.data.geometry,this.eventContext.sharedAssets.data);e.textGeometry.setText(t)})),t.removeEventListener("pointerdown",this._onMouseDown,!1),t.removeEventListener("pointerup",this._onMouseUp,!1),t.removeEventListener("pointermove",this._onMouseMove,!1),window.addEventListener("keydown",this._onKeyPress),this.eventContext.renderer.sceneHelpersOnTop=void 0,this.eventContext.renderer.pipeline.disableHelpers(),this.textInputManager.disconnect()}focusOnTextInput(e){this.textInputManager.focus(e),this.textInputManager.onTextMaterialChanged();let t=this.textInputManager.htmlInput;if(!t||null===e)return;this.textInputManager.updateTextInputStyles(),this.eventContext.renderer.sceneHelpersOnTop=this.sceneHelpers,this.eventContext.renderer.pipeline.enableHelpers(),this.textInputManager.isDragging=!1;let n=GV(e.textGeometry.userData.parameters,this.eventContext.sharedAssets.data);t.value=n,t.setSelectionRange(0,0),this.textInputManager.helper.show(e),t.style.display="block",t.addEventListener("input",this._onTextEdit),this.textInputManager.updatePlane();let{domElement:i}=this.eventContext;i.removeEventListener("pointerdown",this._onMouseDownFocusIn),i.addEventListener("pointerdown",this._onMouseDown,!1),i.addEventListener("pointerup",this._onMouseUp,!1),i.addEventListener("pointermove",this._onMouseMove,!1),window.addEventListener("keydown",this._onKeyPress)}},WV=class extends dU{constructor(e,t){super(e),this.eventManager=t,this.events=[],this.onVoice=e=>{let{value:t,frequencies:n}=e;this.events.forEach((e=>{e.dispatch()}))}}connect(){this.openAIRealtime=this.eventContext.sharedAssets.openAIRealtime,this.openAIRealtime&&(this.eventContext.page.traverseEntity((e=>{var t;null===(t=e.data)||void 0===t||t.events.filter((e=>"AIAssistantListener"===e.data.type&&!e.data.disabled)).forEach((t=>{this.events.push(new qV(t.id,t.data,e,this.eventContext.page,this.eventContext.sharedAssets,this.eventManager))}))})),this.openAIRealtime.on("voice",this.onVoice))}disconnect(){var e;null===(e=this.openAIRealtime)||void 0===e||e.off("voice",this.onVoice)}},qV=class{constructor(e,t,n,i,r,s){this.id=e,this.data=t,this.object=n,this.actions=dF(t,t.actions,i,r,s,n)}dispatch(){this.dispatchActions(this.actions)}dispatchActions(e){e.Audio.forEach((e=>e.dispatchConditional())),e.Particles.forEach((e=>e.dispatchConditional())),e.Video.forEach((e=>e.dispatchConditional())),e.Create.forEach((e=>e.dispatch())),e.Destroy.forEach((e=>e.dispatch())),e.Reset.forEach((e=>e.dispatch())),e.Transition.forEach((e=>{e.object.currentTransitionEvent!==this&&(e.object.currentTransitionEvent=this),e.init()})),e.Transition.forEach((e=>e.play())),e.Animation.forEach((e=>e.play())),e.SwitchCamera.forEach((e=>e.play())),e.SceneTransition.forEach((e=>e.dispatch())),e.SetVariable.forEach((e=>e.checkConditions())),e.SetVariable.forEach((e=>e.dispatch())),e.DynamicVariablePlay.forEach((e=>e.dispatch())),e.ClearLocalStorage.forEach((e=>e.dispatch())),e.UserAPI.forEach((e=>e.dispatch()))}},XV=class extends dU{constructor(e,t){super(e),this.eventManager=t,this.events=[],this.onTriggerEvent=e=>{let{description:t,direction:n}=e,i=this.events.find((e=>e.data.description===t));i&&("backward"===n?i.dispatchReverse():i.dispatch())}}connect(){this.openAIRealtime=this.eventContext.sharedAssets.openAIRealtime,this.openAIRealtime&&(this.eventContext.page.traverseEntity((e=>{var t;null===(t=e.data)||void 0===t||t.events.filter((e=>"AIAssistantTrigger"===e.data.type&&!e.data.disabled)).forEach((t=>{this.events.push(new YV(t.id,t.data,e,this.eventContext.page,this.eventContext.sharedAssets,this.eventManager))}))})),this.openAIRealtime.on("trigger_event",this.onTriggerEvent))}disconnect(){var e;null===(e=this.openAIRealtime)||void 0===e||e.off("trigger_event",this.onTriggerEvent)}},YV=class{constructor(e,t,n,i,r,s){this.id=e,this.data=t,this.object=n,this.actions=dF(t,t.actions,i,r,s,n)}dispatch(){let e=this.actions;e.Audio.forEach((e=>e.dispatchConditional())),e.Particles.forEach((e=>e.dispatchConditional())),e.Video.forEach((e=>e.dispatchConditional())),e.Create.forEach((e=>e.dispatch())),e.Destroy.forEach((e=>e.dispatch())),e.Reset.forEach((e=>e.dispatch())),e.Transition.forEach((e=>{e.object.currentTransitionEvent!==this&&(e.object.currentTransitionEvent=this),e.init()})),e.Transition.forEach((e=>e.play())),e.Animation.forEach((e=>e.play())),e.SwitchCamera.forEach((e=>e.play())),e.SceneTransition.forEach((e=>e.dispatch())),e.SetVariable.forEach((e=>e.checkConditions())),e.SetVariable.forEach((e=>e.dispatch())),e.DynamicVariablePlay.forEach((e=>e.dispatch())),e.ClearLocalStorage.forEach((e=>e.dispatch())),e.UserAPI.forEach((e=>e.dispatch()))}dispatchReverse(){let e=this.actions;e.Transition.forEach((e=>e.reverseFromCurrent())),e.Particles.forEach((e=>e.reverseFromCurrent())),e.Animation.forEach((e=>e.reverseFromCurrent())),e.SwitchCamera.forEach((e=>e.reverseFromCurrent())),e.Create.forEach((e=>e.dispatchStop()))}},QV=class{constructor(e,t,n,i,r){this.publish=e,this.controlsManager=t,this.animationControls=n,this.eventContext=i,this.sharedVariables=r,this.isEnabled=!1,this.activateCount=0,this.needsMouse=!1,this.needsRaycast=!1,this.onTouchMovePreventScroll=e=>{let t=window.parent!==window,n=document.documentElement.scrollHeight>document.documentElement.clientHeight||document.documentElement.scrollWidth>document.documentElement.clientWidth;(e.touches.length>1||this.preventTouchScroll||!1===t&&!1===n)&&e.preventDefault()},this.onMouseWheelPreventScroll=e=>{this.preventScroll&&e.preventDefault()},this.onMouseMove=e=>{this.eventContext.sharedAssets.mouseProperty=o(o({},this.getMousePosition(e)),{},{pressed:e.buttons>0})},this.onMouseDown=e=>{this.eventContext.sharedAssets.mouseProperty=o(o({},this.getMousePosition(e)),{},{pressed:!0})},this.onMouseUp=e=>{this.eventContext.sharedAssets.mouseProperty=o(o({},this.getMousePosition(e)),{},{pressed:!1})},this.getMousePosition=e=>{var t;let{domRect:n}=this.eventContext,{pageX:i,pageY:r}=(null===(t=e.touches)||void 0===t?void 0:t.length)>0?e.touches[0]:e;return{x:i-(n.left+window.scrollX),y:r-(n.top+window.scrollY)}},this.stopRaycast=e.stopRaycast,this.preventScroll=e.preventScroll,this.preventTouchScroll=e.preventTouchScroll,this.hideCursor=e.hideCursor,this.requestRender=i.requestRender}activate(){var e,t;let n=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.isEnabled)return;this.isEnabled=!0,this.initializeActionsDependentStates(),this.needsMouse&&(this.eventContext.domElement.addEventListener("pointermove",this.onMouseMove),this.eventContext.domElement.addEventListener("pointerdown",this.onMouseDown)),this.handlers={Spline:new vU(this.eventContext),VariableChange:new Cj(this.eventContext,this.sharedVariables,this,this.needsMouse,this.needsRaycast),API:new RV(this.eventContext,this),WEBHOOK:new LV(this.eventContext,this),AIAssistantListener:new WV(this.eventContext,this),AIAssistantTrigger:new XV(this.eventContext,this),Conditional:new AU(this.eventContext,this),Start:new Ej(this.eventContext,this),Basic:new bU(this.eventContext,this,this.needsRaycast),MouseHover:new bj(this.eventContext,this),Scroll:new Sj(this.eventContext,this),Follow:new $U(this.eventContext,this),DragDrop:new GU(this.eventContext,this),LookAt:new fj(this.eventContext),Resize:new IV(this.eventContext,this),Textfields:new HV(this.eventContext,this)};let{page:i,domElement:r}=this.eventContext;this.hideCursor&&(r.style.cursor="none"),i.traverseEntity((e=>{e.addEventListener("requestRender",this.requestRender)})),Object.values(this.handlers).forEach((e=>e.connect())),r.addEventListener("wheel",this.onMouseWheelPreventScroll),r.addEventListener("touchmove",this.onTouchMovePreventScroll),this.activateCount++,n||(null!==(e=this.eventContext.sharedAssets.openAIRealtime)&&void 0!==e&&e.connect(),null===(t=this.eventContext.sharedAssets.openAIRealtime)||void 0===t||t.start())}deactivate(){var e;let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.isEnabled)return;this.isEnabled=!1,this.eventContext.domElement.removeEventListener("pointermove",this.onMouseMove),this.eventContext.domElement.removeEventListener("pointerdown",this.onMouseDown),this.eventContext.domElement.removeEventListener("pointerup",this.onMouseUp),this.eventContext.sharedAssets.mouseProperty=null,this.eventContext.sharedAssets.raycastProperty=null;let{page:n,domElement:i}=this.eventContext;if(i.style.cursor="",Object.values(this.handlers).forEach((e=>e.disconnect())),null!==(e=this.controlsManager.gameControl)&&void 0!==e&&e.disposeActions(),this.controlsManager.disconnectEvents(),n.traverseEntity((e=>{e.removeEventListener("requestRender",this.requestRender),e.destroyedInAction=!1})),i.removeEventListener("touchmove",this.onTouchMovePreventScroll),i.removeEventListener("wheel",this.onMouseWheelPreventScroll),this.animationControls.onExitPlayMode(),!t){let e=this.eventContext.sharedAssets.openAIRealtime;null!==e&&void 0!==e&&e.disconnect(),null===e||void 0===e||e.stop().then((()=>{null===e||void 0===e||e.disconnect()}))}}get isPaused(){return this.isEnabled}pause(){this.deactivate()}resume(){this.activate()}reset(){this.deactivate(!0),this.activate(!0),this.controlsManager.deactivate(),this.controlsManager.activate(this),this.controlsManager.page.updateMatrixWorld(!0),this.controlsManager.rebuildBVH()}updateUseWindowEvents(e){let t=this.isEnabled;t&&this.deactivate(),this.eventContext.useWindowEvents=e,t&&this.activate()}initializeActionsDependentStates(){let e=this.eventContext.sharedAssets;e.resetDynamicVariablePlayState();let t=n=>{if("Conditional"===n.data.type&&(n.data.ifActions.forEach(t),n.data.elseActions.forEach(t)),"Conditional"===n.data.type||"SetVariable"===n.data.type)for(let e of"Conditional"===n.data.type?n.data.condition:n.data.expression)"id"in e&&Array.isArray(e.id)&&("mouse"===e.id[0]&&(this.needsMouse=!0),"raycast"===e.id[0]&&(this.needsRaycast=!0));"DynamicVariablePlay"===n.data.type&&""!==n.data.variableId&&("Play"===n.data.mode||"PlayPause"===n.data.mode||"Toggle"===n.data.mode)&&e.setDynamicVariablePlayState(n.data.variableId,"Stopped")};this.eventContext.page.traverseEntity((e=>{var n;if(null!==(n=e.data)&&void 0!==n&&n.events.length)for(let i of e.data.events)if("VariableChange"===i.data.type&&("mouseProperty"===i.data.variableId&&(this.needsMouse=!0),"raycastProperty"===i.data.variableId&&(this.needsRaycast=!0)),"Conditional"===i.data.type)for(let e of["inActions","outActions"])i.data[e].forEach(t);else if("DragDrop"===i.data.type)for(let e of["drag","drop"])i.data.dragDropActions[e].forEach(t);else if("GameControl"===i.data.type)for(let e of["idle","move","jump","run"])i.data.gameActions[e].forEach(t);else if("Resize"===i.data.type)for(let e of i.data.breakpoints)e.data.actions.forEach(t);else"LookAt"===i.data.type||"API"===i.data.type||i.data.actions.forEach(t)}))}},KV=class{constructor(e,t,n,i,r){this._aspect=1,this.enableResponsive=!1,this._renderer=e,this._camera=t,this._frameSize=(new ot).copy(n),this._editorSize=(new ot).copy(i),this._aspect=t.aspect,this._fov=null!==r&&void 0!==r?r:t.fov}set frameSize(e){this._frameSize.copy(e)}updateRenderer(){!this._renderer||this._renderer.setSize(this._frameSize.x,this._frameSize.y)}updateViewport(){if(!this._renderer||!this._camera||"PerspectiveCamera"!==this._camera.cameraType)return;let e=this._frameSize.x,t=this._frameSize.y,n=this._editorSize.y;this._aspect=e/t,t<=n&&(this._camera.zoom*=n/t),this._renderer.setViewport(0,0,e,t)}updateCamera(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(this._camera)if("PerspectiveCamera"===this._camera.cameraType){let t=this._frameSize.y,n=this._editorSize.y,i=this._fov;if(e&&t>n){let e=function(e,t,n,i,r){return(e-t)/(n-t)*(r-i)+i}(t,1080,2160,1,15)/100;i*=t/n,i*=1-e}this._camera.aspect=this._aspect,this._camera.fov=i,this._camera.updateProjectionMatrix()}else this._camera.setViewplaneSize(this._frameSize.x,this._frameSize.y,this.enableResponsive)}setCamera(e){this._camera=e,this._aspect=e.aspect,this._fov=e.fov}revert(){let e=window.innerWidth,t=window.innerHeight;this._renderer&&(this._renderer.setViewport(0,0,e,t),this._renderer.setSize(e,t)),this._camera&&(this._camera.aspect=e/t,this._camera.fov=this._fov,this._camera.setViewplaneSize(e,t,this.enableResponsive),this._camera.updateProjectionMatrix())}};var ZV=class{get sharedAssets(){return this.shared}constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this.shared=new CD(e.shared,t,!0,n),this.scene=new AB(e.scene,this.sharedAssets),this.shared.setEntityOpContext({scene:this.scene,shared:this.shared})}reset(e,t){this.scene.clearScene(),this.sharedAssets.reset(e.shared),this.scene.resetAfterClear(e.scene,this.sharedAssets)}resetPersonalCameraFromDocumentData(){for(let e of this.scene.children)e instanceof dL&&!e.uiScene&&e.personalCamera.updateState(e.data.camera,{scene:this.scene,shared:this.shared})}dispose(){this.scene.dispose(),this.shared.dispose()}gc(){this.shared.geometryCache.startGc(),this.shared.geometryCache2.startGc(),this.scene.traverseEntity((e=>{e instanceof RD&&e.markGeometryAsReachable(this.shared)})),this.shared.geometryCache.endGc(),this.shared.geometryCache2.endGc()}},JV=class{constructor(e){let{x:t=10,y:n=10}=e;this._startTime=0;let i=document.getElementById("spe-perfs");i?this.element=i:(this.element=document.createElement("div"),document.body.appendChild(this.element),this.element.style.position="absolute",this.element.style.zIndex="10000",this.element.style.fontFamily="monospace",this.element.style.background="black",this.element.style.color="white",this.element.style.padding="10px",this.element.style.opacity="0.5",this.element.style.fontSize="11px",this.element.setAttribute("id","spe-perfs")),this.element.style.left="".concat(t,"px"),this.element.style.top="".concat(n,"px")}dispose(){var e;null===(e=this.element.parentElement)||void 0===e||e.removeChild(this.element)}start(){this._startTime=performance.now()}end(){let e=performance.now()-this._startTime;this.element.innerHTML=e.toFixed(3)+" ms"}};function $V(e){let t;if(e.index)for(let n=0;n<e.index.array.length;n+=3)t=e.index.array[n],e.index.array[n]=e.index.array[n+2],e.index.array[n+2]=t}function eG(e){return e instanceof FD?"SubdivObject":"NonParametricGeometry"===e.geometry.type?"NonParametric":"Mesh"}function tG(e,t){let n=function(e,t){let n={};return e.traverseEntity((e=>{if(!e.visible||!(e instanceof UC)||"Mesh"!==e.type||Array.isArray(e.material)||e.states&&Object.keys(e.states).length)return;let i=e.parent;for(;i;){if(i instanceof UC&&e.states&&Object.keys(e.states).length)return;i=i.parent}let r=e.material.uuid,s=t.shared.materials[r];if(s){if(!Cb.isMergable(s))return}else{var a;let n=null===(a=t.scene.objects.get(e.uuid))||void 0===a?void 0:a.data;if(n&&"material"in n&&"string"!=typeof n.material){if(!Cb.isMergable(n.material))return;r=Cb.getHash(n.material)}}n[r]||(n[r]={});let o=n[r][eG(e)];if(o){if(o.push(e),e.cloner)for(let t of e.cloner.children)o.push(t)}else if(n[r][eG(e)]=[e],e.cloner)for(let t of e.cloner.children)n[r][eG(e)].push(t)})),n}(t,e),i=function(e){let t=0;return Object.values(e).forEach((e=>{Object.values(e).forEach((e=>{let n=e.length;n>t&&(t=n)}))})),t}(n),r=new Array(i),s=0,a=new Array(i),o=0,l=new Array(i),c=0,h=new Array(i),u=0;for(let[d,p]of Object.entries(n))for(let e of Object.values(p)){if(o=0,c=0,e.forEach((e=>{e instanceof UC&&(a[o++]=e.geometry.clone(),l[c++]=e)})),c<2)continue;for(let e=0;e<c;e++)l[e].updateWorldMatrix(!0,!1),a[e].applyMatrix4(l[e].matrixWorld),l[e].matrixWorld.determinant()<0&&$V(a[e]);let i=fw(a.slice(0,o),!1);if(i){let e;if("SubdivObject"===d)console.warn("Turning subdiv object into mesh"),e=new Ci(i,l[0].material);else e=new Ci(i,l[0].material);e.castShadow=l[0].castShadow,e.receiveShadow=l[0].receiveShadow,t.add(e);let a=e=>{u=0;for(let t of e)t.children&&a(t.children),t instanceof UC&&(Array.isArray(t.material)||n[t.material.uuid]&&n[t.material.uuid][eG(t)]&&n[t.material.uuid][eG(t)].length>1||(h[u++]=t));for(let n=0;n<u;n++)t.attach(h[n])};for(let t=0;t<c;t++){let e=l[t];a(e.children),r[s++]=e}}}for(let d=0;d<s;d++)r[d].removeFromParent()}var nG=A(R(),1),iG=new ot;var rG=class{constructor(e){let{renderOnDemand:t,renderMode:n="auto"}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this._viewportMode=1,this._viewportWidth=window.innerWidth,this._viewportHeight=window.innerHeight,this._proxyObjectCache=new Map,this._variablesCache=new Map,this._isPaused=!1,this._renderRequested=!1,this._skipRender=!1,this.time=performance.now(),this.dt=0,this.currentTAAFrame=0,this.disposed=!1,this._requestRenderAutoMode=()=>{this._skipRender=!1},this.requestRender=()=>{this._renderRequested=!0},this.render=e=>{var t,n,i,r,s,a,o,l,c,h,u,d;if(this.time=e,this._lastTime&&(this.dt=this.time-this._lastTime),this._lastTime=this.time,null!==(t=this._perfs)&&void 0!==t&&t.start(),this._renderer)if(this._isPaused||!("manual"===this.renderMode&&!this._renderRequested||"auto"===this.renderMode&&this._skipRender)){if(this._renderRequested=!1,this._skipRender=!0,this._controls&&(this._skipRender=this._controls.update(this.dt)),this._eventManager&&(null!==(n=this._eventManager.handlers)&&void 0!==n&&n.Start.hasVideoAction||null!==(i=this._eventManager.handlers)&&void 0!==i&&i.Basic.hasVideoAction||null!==(r=this._eventManager.handlers)&&void 0!==r&&r.Conditional.hasVideoAction)&&(this._skipRender=!1),null!==(s=this._animationControls)&&void 0!==s&&s.update(this.dt),this._skipRender?(this.currentTAAFrame++,this.currentTAAFrame<32?this._skipRender=!1:this.currentTAAFrame=0):this.currentTAAFrame=0,null!==(a=this._scene)&&void 0!==a&&a.traverseVisibleEntity((e=>{"ParticleSystem"===e.type&&(e.update(this.dt),this._skipRender=!1)})),this._scene&&this._scene.activeCamera!==this._camera&&(this._camera=this._scene.activeCamera),null!==(o=this._eventManager)&&void 0!==o&&o.isEnabled&&((null===(l=this._eventManager.handlers)||void 0===l?void 0:l.Follow).onAnimationFrameDamping(),(null===(c=this._eventManager.handlers)||void 0===c?void 0:c.LookAt).onAnimationFrameDamping(),(null===(h=this._eventManager.handlers)||void 0===h?void 0:h.DragDrop).onAnimationFrameDamping()),this._scene&&this._camera){if(this._scene.pathConstraints.applyConstraints(this._scene),this._renderer.sceneTransitionTimeRemaining>0){this._renderer.sceneTransitionTimeRemaining-=this.dt;let e=1-this._renderer.sceneTransitionTimeRemaining/this._renderer.sceneTransitionDuration;this._renderer.pipeline.sceneTransitionPass.uniforms.mixRatio.value=e,this._skipRender=!1}else this._renderer.pipeline.sceneTransitionFromTexture=null;this._renderer.renderSplineScene(this._scene,this._camera)}this.canvas.dispatchEvent(this._renderedEvent),null===(u=this._perfs)||void 0===u||u.end()}else{var p;null===(p=this._perfs)||void 0===p||p.end()}else null===(d=this._perfs)||void 0===d||d.end()},this._resize=e=>{if(this._renderer){var t,n,i,r,s,a,o,l;if(1===this._viewportMode&&this._frameView&&(this._frameView.frameSize=iG.set(this._viewportWidth,this._viewportHeight)),e){let e=this._viewportWidth,t=this._viewportHeight;this._renderer.setSize(e-1,t-1,!1),this._renderer.setSize(e,t,!1)}else this._renderer.setSize(this._viewportWidth,this._viewportHeight,!1);if(this._camera=null===(t=this._scene)||void 0===t?void 0:t.activeCamera,null!==(n=this._scene)&&void 0!==n&&n.updateViewPlaneSize(null!==(i=null===(r=this._frameView)||void 0===r||null===(r=r.frameSize)||void 0===r?void 0:r.x)&&void 0!==i?i:this._viewportWidth,null!==(s=null===(a=this._frameView)||void 0===a||null===(a=a.frameSize)||void 0===a?void 0:a.y)&&void 0!==s?s:this._viewportHeight,null!==(o=null===(l=this._frameView)||void 0===l?void 0:l.enableResponsive)&&void 0!==o&&o),this._camera){var c,h,u,d,p;let e=null!==(c=Object.values(null!==(h=null===(u=this._data)||void 0===u?void 0:u.frames)&&void 0!==h?h:{})[0].preset)&&void 0!==c?c:"fullscreen";null!==(d=this._frameView)&&void 0!==d&&d.setCamera(this._camera),null!==(p=this._frameView)&&void 0!==p&&p.updateCamera("fullscreen"!==e),"PerspectiveCamera"===this._camera.cameraType&&(this._camera.aspect=this._viewportWidth/this._viewportHeight),this._camera.updateProjectionMatrix()}this.eventManager&&(this.eventManager.eventContext.domRect=this.canvas.getBoundingClientRect()),this._requestRenderAutoMode()}},this._debouncedResize=hm(this._resize,10),this._onScroll=e=>{this.eventManager&&(this.eventManager.eventContext.domRect=this.canvas.getBoundingClientRect())},this.canvas=e,this.renderMode=t?"auto":n,this._renderedEvent=new CustomEvent("rendered",{bubbles:!0}),Object.defineProperty(this._renderedEvent,"target",{writable:!1,value:this}),window.location.search.includes("perfs")&&(this._perfs=new JV({x:10,y:10})),function(e){e.addEventListener("pointerdown",Gm,!0),e.addEventListener("pointerdown",Wm,!0),e.addEventListener("pointermove",Wm,!0),e.addEventListener("pointerup",Hm,!0),e.addEventListener("pointercancel",Hm,!0),e.addEventListener("pointerleave",Hm,!0),window.addEventListener("keydown",Xm,!0),window.addEventListener("keyup",Ym,!0)}(e)}async load(e,t,n){(function(e){let t="The Spline Runtime only accepts .splinecode files that are generated from Spline export panel.";e.endsWith(".spline")?console.warn(t+" The .spline files are only meant to be used by the Editor."):e.endsWith(".splinecode")||console.warn(t)})(e),this.disposed=!1;let i=await(await fetch(e,n)).arrayBuffer();await this.start(i,{variables:t})}async start(e){var t,n,i,r,s;let{interactive:a=!0,variables:o}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(this.disposed)return;let l=await async function(e,t){let[n,i]=Gg(uy.deserialize(new Uint8Array(e)));return pw(n),t&&t(n),i.result().data}(e);this._data=l;let c=function(e){let t=[];return e.scene.objects.traverse(((e,n)=>{"Mesh"===n.type&&"NonParametricGeometry"===n.geometry.type&&void 0!==n.geometry.data.draco&&t.push(n)})),t}(l);l.version&&(0,nG.default)(l.version,"1.9.63")>0&&console.warn("Your .splinecode file is more recent than the library. Please upgrade @splinetool/runtime to the latest version."),await Promise.all([c.length&&(_V||(_V=new MV).setDecoderPath("https://www.gstatic.com/draco/versioned/decoders/1.5.2/").preload(),_V.decoderPending),HO(l)&&_C(),ND(l)&&JA(),px.physicsEnabled(l.scene.objects)&&ng(),rO(l)&&jP(),fB(l)&&wB(),RP(l)&&IP(),Ok(l)&&Dk(),zj(l)&&Jm()].filter(Boolean)),c.length&&await async function(e){for(let t of e){let e=await PV(t.geometry.data.draco);if(e){let n=t.geometry.data;e.index&&(n.index={array:e.index.array,itemSize:1,normalized:!1,type:"Uint32Array"});let i={};e.attributes.forEach((e=>{let{name:t,array:n,itemSize:r}=e;i[t]={array:n,itemSize:r,type:"Float32Array",normalized:!1}})),n.attributes=i,n.draco=void 0}}}(c),null!==(t=this._eventManager)&&void 0!==t&&t.deactivate(),null!==(n=this._controls)&&void 0!==n&&n.deactivate(),null===(i=this._scene)||void 0===i||i.dispose();let h=new ZV(l);if(h.resetPersonalCameraFromDocumentData(),this._scene=h.scene,this._sharedAssetsManager=h.sharedAssets,this._camera=this._scene.activeCamera,window.location.search.includes("merge-geometries")){let e=performance.now();tG(l,h.scene);let t=performance.now();console.log("Merged geometries in ",t-e," ms")}HO(l)&&this._scene.traverse((e=>{QO(e)&&e.recomputeBoolean()})),this._sharedAssetsManager.setRequestRender((()=>{var e;this._requestRenderAutoMode(),null===(e=this._scene)||void 0===e||e.traverse((e=>{e instanceof SO&&e.pendingMediaLoad&&e.update()}))})),null===(r=this._scene)||void 0===r||r.traverse((e=>{"ParticleSystem"===e.type&&(e.wakeUp(),e.data.autoPlay?e.start():e.stop())}));let u=Object.keys(l.shared.fonts).map((e=>this._sharedAssetsManager.getFont(e).loadingPromise));if(Promise.all(u).then((()=>{h.scene.markNeedsUpdateRendererDirty(),this._requestRenderAutoMode()})),rO(l)&&function(e){if(px.physicsEnabled(e.scene.objects))return!0;let t=!1;return e.scene.objects.traverse(((e,n)=>{if(n.events)if(Array.isArray(n.events)){for(let i of n.events)if(!0!==i.data.disabled&&"GameControl"===i.data.type&&i.data.collisionEnabled){t=!0;break}}else for(let i of Object.values(n.events))if(!0!==i.disabled&&"GameControl"===i.type&&i.collisionEnabled){t=!0;break}})),t}(l)&&await Promise.all(u),Ok(l)){let e=[];this._scene.traverseEntity((t=>{(t instanceof SL||t instanceof dL)&&t.uiCanvas&&e.push(t.uiCanvas)})),await Promise.all(e.map((e=>e.promise)))}if(this._scene.rewriteEventsBeforeGoToPlayMode(),HN(this._scene.activePage,this._sharedAssetsManager),!this._renderer&&(this._renderer=new ZR({canvas:this.canvas,antialias:!1,alpha:!0,stencil:!1,depth:!1,powerPreference:"high-performance"}),this._renderer.hdTransmission=!0===l.scene.publish.hdTransmission,this._renderer.setPixelRatio(window.devicePixelRatio),this._renderer.pipeline.enableUIOverlay(),this._renderer.pipeline.addEventListener("smaaloaded",this._requestRenderAutoMode),l.shared.images.SplineWatermark)){let e=this._sharedAssetsManager.getImage("SplineWatermark");await e.loadPromise;let t=e.getTexture(1001);this._renderer.pipeline.setWatermark(t)}fB(l)&&this._scene.initializeSplatViewer(),void 0!==l.scene.blueNoiseTextureData&&this._renderer.pipeline.updateBlueNoiseTexture(l.scene.blueNoiseTextureData);let d=Object.values(l.frames)[0];if(this._frameView?this._frameView.setCamera(this._camera):("fullscreen"===d.preset?(this._viewportMode=1,this.canvas.style.display="block",this.canvas.parentElement&&(this._viewportWidth=this.canvas.parentElement.clientWidth||300,this.canvas.style.width="100%"),this.canvas.parentElement&&(this._viewportHeight=this.canvas.parentElement.clientHeight||150,this.canvas.style.height="100%")):(this._viewportMode=2,this._viewportWidth=d.size[0],this._viewportHeight=d.size[1],this.canvas.style.width="".concat(this._viewportWidth,"px"),this.canvas.style.height="".concat(this._viewportHeight,"px")),this._renderer.setSize(this._viewportWidth,this._viewportHeight,!1),this._frameView=new KV(this._renderer,this._camera,new ot(this._viewportWidth,this._viewportHeight),new ot(window.innerWidth,window.innerHeight)),this._frameView.enableResponsive=null!==(s=d.allowResponsive)&&void 0!==s&&s&&"fullscreen"===d.preset),a){let e=new uU(this._renderer,this.data.scene.publish,this._scene,(()=>this._scene.activeCamera),this._sharedAssetsManager,this._requestRenderAutoMode,!0,d);this._scene.updateMatrixWorld(!0),this._controls=new wV(e),this._animationControls=new AV(this._scene,this._requestRenderAutoMode),this._eventManager=new QV(l.scene.publish,this._controls,this._animationControls,e,l.shared.variables),this._eventManager.activate(),this._controls.activate(this._eventManager)}this._resize(),this._scene.activePage.data.postprocessing.depthOfField.enabled&&Promise.all(this._sharedAssetsManager.getImageLoadPromises()).then((()=>{this._resize(!0)})),void 0!==o&&this.setVariables(o),0===this.dt&&(this.render(performance.now()),setTimeout((()=>{var e;null===(e=this._renderer)||void 0===e||e.setAnimationLoop(this.render)}),0)),this._resizeObserverTimeout=setTimeout((()=>{!this._resizeObserver&&this.canvas.parentElement&&(this._resizeObserver=new ResizeObserver((()=>{this._viewportWidth=this.canvas.clientWidth,this._viewportHeight=this.canvas.clientHeight,this._debouncedResize()})),this._resizeObserver.observe(this.canvas.parentElement))}),300),document.addEventListener("scroll",this._onScroll)}setVariables(e){if(void 0!==this._data){let t=Object.entries(e);for(let[e,n]of t)this.setVariable(e,n)}}setVariable(e,t){let n=this._getVariableByName(e);if(n&&!("dynamicVariableType"in n.data)){var i;let e=t;"number"==typeof n.data.value?e="number"==typeof t?t:"boolean"==typeof t?!0===t?1:0:parseFloat(t):"boolean"==typeof n.data.value?e="number"==typeof t?!!t:"boolean"==typeof t?t:"false"!==t.toLocaleLowerCase()&&!!t:"string"!=typeof n.data.value&&void 0!==n.data.value.textValue&&(e=t.toString());let r="string"==typeof e?{textValue:e}:e;null!==(i=this._sharedAssetsManager)&&void 0!==i&&i.updateVariable(n.id,r),this.requestRender(),this._requestRenderAutoMode()}else void 0===n?console.warn("No variable named ".concat(e," was found in your Spline file. Make sure to create it from Spline editor.")):"dynamicVariableType"in n.data&&console.warn("Dynamic variables like ".concat(e," cannot be updated from code."))}getVariables(){let e={};return this._data&&this._data.shared.variables.forEach((t=>{void 0===e[t.data.name]&&(e[t.data.name]=this._getVariableValue(this._sharedAssetsManager.getVariable(t.id)))})),e}getVariable(e){let t=this._getVariableByName(e);if(t){let e=this._sharedAssetsManager.getVariable(t.id);return this._getVariableValue(e)}}_getVariableValue(e){return"string"!=typeof e&&yx.isTextValue(e)?yx.getDisplayedValue(e):e}_getVariableByName(e){if(this._data){if(this._variablesCache.has(e))return this._variablesCache.get(e);let t=this._data.shared.variables.find((t=>t.data.name===e));return t&&this._variablesCache.set(e,t),t}}findObjectById(e){var t;let n=null===(t=this._scene)||void 0===t?void 0:t.getObjectByProperty("uuid",e);return this._createProxyObject(n)}findObjectByName(e){var t;let n=null===(t=this._scene)||void 0===t?void 0:t.getObjectByName(e);return this._createProxyObject(n)}getAllObjects(){var e;let t=[];return null!==(e=this._scene)&&void 0!==e&&e.traverseEntity((e=>{if(e.uuid!==rb&&!this._scene.isInvisibleObjects(e)&&!(e instanceof dL)){let n=this._createProxyObject(e);n&&t.push(n)}})),t}getSplineEvents(){var e;return(null===(e=this._eventManager)||void 0===e||null===(e=e.handlers)||void 0===e?void 0:e.Spline).splineEvents}emitEvent(e,t){var n;null===(n=this.findObjectById(t)||this.findObjectByName(t))||void 0===n||n.emitEvent(e)}emitEventReverse(e,t){var n;null===(n=this.findObjectById(t)||this.findObjectByName(t))||void 0===n||n.emitEventReverse(e)}addEventListener(e,t){this.canvas.addEventListener(e,t)}removeEventListener(e,t){this.canvas.removeEventListener(e,t)}setZoom(e){var t,n;(null===(t=this._controls)||void 0===t?void 0:t.orbitControls)instanceof $j&&(null===(n=this._controls)||void 0===n||n.orbitControls.setZoom(e))}get eventManager(){return this._eventManager}get controls(){return this._controls}setSize(e,t){this._viewportWidth=e,this._viewportHeight=t,this._viewportMode=2,this._resize()}setBackgroundColor(e){var t;let{r:n,g:i,b:r,a:s}={r:0,g:0,b:0,a:1},a=new QC(n,i,r,s);try{a.setStyle(e)}catch(o){console.error("This is not a valid css color",e)}null!==(t=this._scene)&&void 0!==t&&t.activePage.setBackgroundColor(a),this._requestRenderAutoMode()}dispose(){var e,t,n,i,r,s,a;this.disposed=!0,null!==(e=this._eventManager)&&void 0!==e&&e.deactivate(),null!==(t=this._scene)&&void 0!==t&&t.dispose(),null!==(n=this._sharedAssetsManager)&&void 0!==n&&n.dispose(),this._proxyObjectCache.forEach((e=>{wh.unsubscribe(e)})),this._variablesCache.clear(),null!==(i=this._renderer)&&void 0!==i&&i.setAnimationLoop(null),null!==(r=this._renderer)&&void 0!==r&&r.dispose(),this._renderer=void 0,null!==(s=this._sharedAssetsManager)&&void 0!==s&&s.dispose(),this._resizeObserver&&(this._resizeObserver.disconnect(),this._resizeObserver=void 0),void 0!==this._resizeObserverTimeout&&clearTimeout(this._resizeObserverTimeout),this.canvas.style.width="",this.canvas.style.height="",this.canvas.removeAttribute("width"),this.canvas.removeAttribute("height"),this._frameView&&(this._frameView=void 0),null!==(a=this._controls)&&void 0!==a&&a.deactivate(),this.dt=0,function(e){e.removeEventListener("pointerdown",Gm,!0),e.removeEventListener("pointerdown",Wm,!0),e.removeEventListener("pointermove",Wm,!0),e.removeEventListener("pointerup",Hm,!0),e.removeEventListener("pointercancel",Hm,!0),e.removeEventListener("pointerleave",Hm,!0),window.removeEventListener("keydown",Xm,!0),window.removeEventListener("keyup",Ym,!0)}(this.canvas),document.removeEventListener("scroll",this._onScroll)}get isStopped(){return this._isPaused}stop(){var e,t,n;this._isPaused||(null!==(e=this._renderer)&&void 0!==e&&e.setAnimationLoop(null),this._isPaused=!0,null!==(t=this._eventManager)&&void 0!==t&&t.pause(),(null===(n=this._controls)||void 0===n?void 0:n.orbitControls)&&(this._controls.orbitControls.enabled=!1))}play(){var e,t,n;!this._isPaused||(this._isPaused=!1,null!==(e=this._eventManager)&&void 0!==e&&e.resume(),null!==(t=this._controls)&&void 0!==t&&t.orbitControls&&(this._controls.orbitControls.enabled=!0),null===(n=this._renderer)||void 0===n||n.setAnimationLoop(this.render))}setGlobalEvents(e){var t;null===(t=this._eventManager)||void 0===t||t.updateUseWindowEvents(e)}get data(){return this._data}_createProxyObject(e){var t;if(null==e)return;if(this._proxyObjectCache.has(e.uuid))return this._proxyObjectCache.get(e.uuid);let n;e.traverseAncestors((e=>{e instanceof dL&&(n=e.name)}));let i={name:e.name,uuid:e.uuid,visible:e.visible,intensity:e.intensity,position:e.position,rotation:e.rotation,scale:e.scale,type:e.data.type,page:n,parentUuid:e.parent instanceof dL||e instanceof AB||null===(t=e.parent)||void 0===t?void 0:t.uuid,emitEvent(t){e.dispatchEvent({type:"userEvent",eventName:t})},emitEventReverse(t){e.dispatchEvent({type:"userEvent",eventName:t,reverse:!0})}},r=wh(i,((t,n)=>{var i;"object"!=typeof e[t]&&null!==(i=Object.getOwnPropertyDescriptor(e,t))&&void 0!==i&&i.writable&&(e[t]=n),this._requestRenderAutoMode(),e.updateMatrix()}));return this._proxyObjectCache.set(e.uuid,r),r}setUIWasmUrl(e){ST.skiaWasmUrl=e}},sG=n(446);function aG(e){return t=>{e.forEach((e=>{"function"==typeof e?e(t):null!=e&&(e.current=t)}))}}const oG=["className","children","debounceTime","ignoreDimensions","parentSizeStyles","enableDebounceLeadingCall","resizeObserverPolyfill"],lG=[],cG={width:"100%",height:"100%"},hG=(0,e.forwardRef)((function(t,n){let{className:i,children:r,debounceTime:s=300,ignoreDimensions:a=lG,parentSizeStyles:h,enableDebounceLeadingCall:u=!0,resizeObserverPolyfill:d}=t,p=l(t,oG);const f=(0,e.useRef)(null),m=(0,e.useRef)(0),[g,v]=(0,e.useState)({width:0,height:0,top:0,left:0}),y=(0,e.useMemo)((()=>{const e=Array.isArray(a)?a:[a];return sG((t=>{v((n=>Object.keys(n).filter((e=>n[e]!==t[e])).every((t=>e.includes(t)))?n:t))}),s,{leading:u})}),[s,u,a]);return(0,e.useEffect)((()=>{const e=new(d||window.ResizeObserver)((e=>{e.forEach((e=>{var t;const{left:n,top:i,width:r,height:s}=null!==(t=null==e?void 0:e.contentRect)&&void 0!==t?t:{};m.current=window.requestAnimationFrame((()=>{y({width:r,height:s,top:i,left:n})}))}))}));return f.current&&e.observe(f.current),()=>{window.cancelAnimationFrame(m.current),e.disconnect(),y.cancel()}}),[y,d]),(0,c.jsx)("div",o(o({style:o(o({},cG),h),ref:aG([n,f]),className:i},p),{},{children:r(o(o({},g),{},{ref:f.current,resize:y}))}))})),uG=["scene","style","onSplineMouseDown","onSplineMouseUp","onSplineMouseHover","onSplineKeyDown","onSplineKeyUp","onSplineStart","onSplineLookAt","onSplineFollow","onSplineScroll","onLoad","renderOnDemand","children"],dG=(0,e.forwardRef)(((t,n)=>{let{scene:i,style:r,onSplineMouseDown:s,onSplineMouseUp:a,onSplineMouseHover:h,onSplineKeyDown:u,onSplineKeyUp:d,onSplineStart:p,onSplineLookAt:f,onSplineFollow:m,onSplineScroll:g,onLoad:v,renderOnDemand:y=!0,children:b}=t,x=l(t,uG);const w=(0,e.useRef)(null),[S,_]=(0,e.useState)(!0),[E,A]=(0,e.useState)();if(E)throw E;return(0,e.useEffect)((()=>{let e;_(!0);const t=[{name:"mouseDown",cb:s},{name:"mouseUp",cb:a},{name:"mouseHover",cb:h},{name:"keyDown",cb:u},{name:"keyUp",cb:d},{name:"start",cb:p},{name:"lookAt",cb:f},{name:"follow",cb:m},{name:"scroll",cb:g}];if(w.current){async function n(){await e.load(i);for(let n of t)n.cb&&e.addEventListener(n.name,n.cb);_(!1),null==v||v(e)}e=new rG(w.current,{renderOnDemand:y}),n().catch((e=>{A(e)}))}return()=>{for(let n of t)n.cb&&e.removeEventListener(n.name,n.cb);e.dispose()}}),[i]),(0,c.jsx)(hG,o(o({ref:n,parentSizeStyles:o({overflow:"hidden"},r),debounceTime:50},x),{},{children:()=>(0,c.jsxs)(c.Fragment,{children:[S&&b,(0,c.jsx)("canvas",{ref:w,style:{display:S?"none":"block"}})]})}))}));function pG(e){if("string"===typeof e||"number"===typeof e)return""+e;let t="";if(Array.isArray(e))for(let n,i=0;i<e.length;i++)""!==(n=pG(e[i]))&&(t+=(t&&" ")+n);else for(let n in e)e[n]&&(t+=(t&&" ")+n);return t}var fG=n(443);const mG=e=>{let t;const n=new Set,i=(e,i)=>{const r="function"===typeof e?e(t):e;if(!Object.is(r,t)){const e=t;t=(null!=i?i:"object"!==typeof r||null===r)?r:Object.assign({},t,r),n.forEach((n=>n(t,e)))}},r=()=>t,s={setState:i,getState:r,getInitialState:()=>a,subscribe:e=>(n.add(e),()=>n.delete(e)),destroy:()=>{console.warn("[DEPRECATED] The `destroy` method will be unsupported in a future version. Instead use unsubscribe function returned by subscribe. Everything will be garbage-collected if store is garbage-collected."),n.clear()}},a=t=e(i,r,s);return s},gG=e=>e?mG(e):mG;const{useDebugValue:vG}=e,{useSyncExternalStoreWithSelector:yG}=fG,bG=e=>e;function xG(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:bG,n=arguments.length>2?arguments[2]:void 0;const i=yG(e.subscribe,e.getState,e.getServerState||e.getInitialState,t,n);return vG(i),i}const wG=(e,t)=>{const n=gG(e),i=function(e){return xG(n,e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:t)};return Object.assign(i,n),i};function SG(e,t){if(Object.is(e,t))return!0;if("object"!==typeof e||null===e||"object"!==typeof t||null===t)return!1;if(e instanceof Map&&t instanceof Map){if(e.size!==t.size)return!1;for(const[n,i]of e)if(!Object.is(i,t.get(n)))return!1;return!0}if(e instanceof Set&&t instanceof Set){if(e.size!==t.size)return!1;for(const n of e)if(!t.has(n))return!1;return!0}const n=Object.keys(e);if(n.length!==Object.keys(t).length)return!1;for(const i of n)if(!Object.prototype.hasOwnProperty.call(t,i)||!Object.is(e[i],t[i]))return!1;return!0}var _G={value:()=>{}};function EG(){for(var e,t=0,n=arguments.length,i={};t<n;++t){if(!(e=arguments[t]+"")||e in i||/[\s.]/.test(e))throw new Error("illegal type: "+e);i[e]=[]}return new AG(i)}function AG(e){this._=e}function CG(e,t){for(var n,i=0,r=e.length;i<r;++i)if((n=e[i]).name===t)return n.value}function MG(e,t,n){for(var i=0,r=e.length;i<r;++i)if(e[i].name===t){e[i]=_G,e=e.slice(0,i).concat(e.slice(i+1));break}return null!=n&&e.push({name:t,value:n}),e}AG.prototype=EG.prototype={constructor:AG,on:function(e,t){var n,i,r=this._,s=(i=r,(e+"").trim().split(/^|\s+/).map((function(e){var t="",n=e.indexOf(".");if(n>=0&&(t=e.slice(n+1),e=e.slice(0,n)),e&&!i.hasOwnProperty(e))throw new Error("unknown type: "+e);return{type:e,name:t}}))),a=-1,o=s.length;if(!(arguments.length<2)){if(null!=t&&"function"!==typeof t)throw new Error("invalid callback: "+t);for(;++a<o;)if(n=(e=s[a]).type)r[n]=MG(r[n],e.name,t);else if(null==t)for(n in r)r[n]=MG(r[n],e.name,null);return this}for(;++a<o;)if((n=(e=s[a]).type)&&(n=CG(r[n],e.name)))return n},copy:function(){var e={},t=this._;for(var n in t)e[n]=t[n].slice();return new AG(e)},call:function(e,t){if((n=arguments.length-2)>0)for(var n,i,r=new Array(n),s=0;s<n;++s)r[s]=arguments[s+2];if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(s=0,n=(i=this._[e]).length;s<n;++s)i[s].value.apply(t,r)},apply:function(e,t,n){if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(var i=this._[e],r=0,s=i.length;r<s;++r)i[r].value.apply(t,n)}};const TG=EG;function PG(){}function DG(e){return null==e?PG:function(){return this.querySelector(e)}}function OG(){return[]}function IG(e){return null==e?OG:function(){return this.querySelectorAll(e)}}function RG(e){return function(){return function(e){return null==e?[]:Array.isArray(e)?e:Array.from(e)}(e.apply(this,arguments))}}function kG(e){return function(){return this.matches(e)}}function LG(e){return function(t){return t.matches(e)}}var BG=Array.prototype.find;function zG(){return this.firstElementChild}var NG=Array.prototype.filter;function FG(){return Array.from(this.children)}function UG(e){return new Array(e.length)}function jG(e,t){this.ownerDocument=e.ownerDocument,this.namespaceURI=e.namespaceURI,this._next=null,this._parent=e,this.__data__=t}function VG(e,t,n,i,r,s){for(var a,o=0,l=t.length,c=s.length;o<c;++o)(a=t[o])?(a.__data__=s[o],i[o]=a):n[o]=new jG(e,s[o]);for(;o<l;++o)(a=t[o])&&(r[o]=a)}function GG(e,t,n,i,r,s,a){var o,l,c,h=new Map,u=t.length,d=s.length,p=new Array(u);for(o=0;o<u;++o)(l=t[o])&&(p[o]=c=a.call(l,l.__data__,o,t)+"",h.has(c)?r[o]=l:h.set(c,l));for(o=0;o<d;++o)c=a.call(e,s[o],o,s)+"",(l=h.get(c))?(i[o]=l,l.__data__=s[o],h.delete(c)):n[o]=new jG(e,s[o]);for(o=0;o<u;++o)(l=t[o])&&h.get(p[o])===l&&(r[o]=l)}function HG(e){return e.__data__}function WG(e){return"object"===typeof e&&"length"in e?e:Array.from(e)}function qG(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}jG.prototype={constructor:jG,appendChild:function(e){return this._parent.insertBefore(e,this._next)},insertBefore:function(e,t){return this._parent.insertBefore(e,t)},querySelector:function(e){return this._parent.querySelector(e)},querySelectorAll:function(e){return this._parent.querySelectorAll(e)}};var XG="http://www.w3.org/1999/xhtml";const YG={svg:"http://www.w3.org/2000/svg",xhtml:XG,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function QG(e){var t=e+="",n=t.indexOf(":");return n>=0&&"xmlns"!==(t=e.slice(0,n))&&(e=e.slice(n+1)),YG.hasOwnProperty(t)?{space:YG[t],local:e}:e}function KG(e){return function(){this.removeAttribute(e)}}function ZG(e){return function(){this.removeAttributeNS(e.space,e.local)}}function JG(e,t){return function(){this.setAttribute(e,t)}}function $G(e,t){return function(){this.setAttributeNS(e.space,e.local,t)}}function eH(e,t){return function(){var n=t.apply(this,arguments);null==n?this.removeAttribute(e):this.setAttribute(e,n)}}function tH(e,t){return function(){var n=t.apply(this,arguments);null==n?this.removeAttributeNS(e.space,e.local):this.setAttributeNS(e.space,e.local,n)}}function nH(e){return e.ownerDocument&&e.ownerDocument.defaultView||e.document&&e||e.defaultView}function iH(e){return function(){this.style.removeProperty(e)}}function rH(e,t,n){return function(){this.style.setProperty(e,t,n)}}function sH(e,t,n){return function(){var i=t.apply(this,arguments);null==i?this.style.removeProperty(e):this.style.setProperty(e,i,n)}}function aH(e,t){return e.style.getPropertyValue(t)||nH(e).getComputedStyle(e,null).getPropertyValue(t)}function oH(e){return function(){delete this[e]}}function lH(e,t){return function(){this[e]=t}}function cH(e,t){return function(){var n=t.apply(this,arguments);null==n?delete this[e]:this[e]=n}}function hH(e){return e.trim().split(/^|\s+/)}function uH(e){return e.classList||new dH(e)}function dH(e){this._node=e,this._names=hH(e.getAttribute("class")||"")}function pH(e,t){for(var n=uH(e),i=-1,r=t.length;++i<r;)n.add(t[i])}function fH(e,t){for(var n=uH(e),i=-1,r=t.length;++i<r;)n.remove(t[i])}function mH(e){return function(){pH(this,e)}}function gH(e){return function(){fH(this,e)}}function vH(e,t){return function(){(t.apply(this,arguments)?pH:fH)(this,e)}}function yH(){this.textContent=""}function bH(e){return function(){this.textContent=e}}function xH(e){return function(){var t=e.apply(this,arguments);this.textContent=null==t?"":t}}function wH(){this.innerHTML=""}function SH(e){return function(){this.innerHTML=e}}function _H(e){return function(){var t=e.apply(this,arguments);this.innerHTML=null==t?"":t}}function EH(){this.nextSibling&&this.parentNode.appendChild(this)}function AH(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function CH(e){return function(){var t=this.ownerDocument,n=this.namespaceURI;return n===XG&&t.documentElement.namespaceURI===XG?t.createElement(e):t.createElementNS(n,e)}}function MH(e){return function(){return this.ownerDocument.createElementNS(e.space,e.local)}}function TH(e){var t=QG(e);return(t.local?MH:CH)(t)}function PH(){return null}function DH(){var e=this.parentNode;e&&e.removeChild(this)}function OH(){var e=this.cloneNode(!1),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function IH(){var e=this.cloneNode(!0),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function RH(e){return function(){var t=this.__on;if(t){for(var n,i=0,r=-1,s=t.length;i<s;++i)n=t[i],e.type&&n.type!==e.type||n.name!==e.name?t[++r]=n:this.removeEventListener(n.type,n.listener,n.options);++r?t.length=r:delete this.__on}}}function kH(e,t,n){return function(){var i,r=this.__on,s=function(e){return function(t){e.call(this,t,this.__data__)}}(t);if(r)for(var a=0,o=r.length;a<o;++a)if((i=r[a]).type===e.type&&i.name===e.name)return this.removeEventListener(i.type,i.listener,i.options),this.addEventListener(i.type,i.listener=s,i.options=n),void(i.value=t);this.addEventListener(e.type,s,n),i={type:e.type,name:e.name,value:t,listener:s,options:n},r?r.push(i):this.__on=[i]}}function LH(e,t,n){var i=nH(e),r=i.CustomEvent;"function"===typeof r?r=new r(t,n):(r=i.document.createEvent("Event"),n?(r.initEvent(t,n.bubbles,n.cancelable),r.detail=n.detail):r.initEvent(t,!1,!1)),e.dispatchEvent(r)}function BH(e,t){return function(){return LH(this,e,t)}}function zH(e,t){return function(){return LH(this,e,t.apply(this,arguments))}}dH.prototype={add:function(e){this._names.indexOf(e)<0&&(this._names.push(e),this._node.setAttribute("class",this._names.join(" ")))},remove:function(e){var t=this._names.indexOf(e);t>=0&&(this._names.splice(t,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(e){return this._names.indexOf(e)>=0}};var NH=[null];function FH(e,t){this._groups=e,this._parents=t}function UH(){return new FH([[document.documentElement]],NH)}FH.prototype=UH.prototype={constructor:FH,select:function(e){"function"!==typeof e&&(e=DG(e));for(var t=this._groups,n=t.length,i=new Array(n),r=0;r<n;++r)for(var s,a,o=t[r],l=o.length,c=i[r]=new Array(l),h=0;h<l;++h)(s=o[h])&&(a=e.call(s,s.__data__,h,o))&&("__data__"in s&&(a.__data__=s.__data__),c[h]=a);return new FH(i,this._parents)},selectAll:function(e){e="function"===typeof e?RG(e):IG(e);for(var t=this._groups,n=t.length,i=[],r=[],s=0;s<n;++s)for(var a,o=t[s],l=o.length,c=0;c<l;++c)(a=o[c])&&(i.push(e.call(a,a.__data__,c,o)),r.push(a));return new FH(i,r)},selectChild:function(e){return this.select(null==e?zG:function(e){return function(){return BG.call(this.children,e)}}("function"===typeof e?e:LG(e)))},selectChildren:function(e){return this.selectAll(null==e?FG:function(e){return function(){return NG.call(this.children,e)}}("function"===typeof e?e:LG(e)))},filter:function(e){"function"!==typeof e&&(e=kG(e));for(var t=this._groups,n=t.length,i=new Array(n),r=0;r<n;++r)for(var s,a=t[r],o=a.length,l=i[r]=[],c=0;c<o;++c)(s=a[c])&&e.call(s,s.__data__,c,a)&&l.push(s);return new FH(i,this._parents)},data:function(e,t){if(!arguments.length)return Array.from(this,HG);var n=t?GG:VG,i=this._parents,r=this._groups;"function"!==typeof e&&(e=function(e){return function(){return e}}(e));for(var s=r.length,a=new Array(s),o=new Array(s),l=new Array(s),c=0;c<s;++c){var h=i[c],u=r[c],d=u.length,p=WG(e.call(h,h&&h.__data__,c,i)),f=p.length,m=o[c]=new Array(f),g=a[c]=new Array(f);n(h,u,m,g,l[c]=new Array(d),p,t);for(var v,y,b=0,x=0;b<f;++b)if(v=m[b]){for(b>=x&&(x=b+1);!(y=g[x])&&++x<f;);v._next=y||null}}return(a=new FH(a,i))._enter=o,a._exit=l,a},enter:function(){return new FH(this._enter||this._groups.map(UG),this._parents)},exit:function(){return new FH(this._exit||this._groups.map(UG),this._parents)},join:function(e,t,n){var i=this.enter(),r=this,s=this.exit();return"function"===typeof e?(i=e(i))&&(i=i.selection()):i=i.append(e+""),null!=t&&(r=t(r))&&(r=r.selection()),null==n?s.remove():n(s),i&&r?i.merge(r).order():r},merge:function(e){for(var t=e.selection?e.selection():e,n=this._groups,i=t._groups,r=n.length,s=i.length,a=Math.min(r,s),o=new Array(r),l=0;l<a;++l)for(var c,h=n[l],u=i[l],d=h.length,p=o[l]=new Array(d),f=0;f<d;++f)(c=h[f]||u[f])&&(p[f]=c);for(;l<r;++l)o[l]=n[l];return new FH(o,this._parents)},selection:function(){return this},order:function(){for(var e=this._groups,t=-1,n=e.length;++t<n;)for(var i,r=e[t],s=r.length-1,a=r[s];--s>=0;)(i=r[s])&&(a&&4^i.compareDocumentPosition(a)&&a.parentNode.insertBefore(i,a),a=i);return this},sort:function(e){function t(t,n){return t&&n?e(t.__data__,n.__data__):!t-!n}e||(e=qG);for(var n=this._groups,i=n.length,r=new Array(i),s=0;s<i;++s){for(var a,o=n[s],l=o.length,c=r[s]=new Array(l),h=0;h<l;++h)(a=o[h])&&(c[h]=a);c.sort(t)}return new FH(r,this._parents).order()},call:function(){var e=arguments[0];return arguments[0]=this,e.apply(null,arguments),this},nodes:function(){return Array.from(this)},node:function(){for(var e=this._groups,t=0,n=e.length;t<n;++t)for(var i=e[t],r=0,s=i.length;r<s;++r){var a=i[r];if(a)return a}return null},size:function(){let e=0;for(const t of this)++e;return e},empty:function(){return!this.node()},each:function(e){for(var t=this._groups,n=0,i=t.length;n<i;++n)for(var r,s=t[n],a=0,o=s.length;a<o;++a)(r=s[a])&&e.call(r,r.__data__,a,s);return this},attr:function(e,t){var n=QG(e);if(arguments.length<2){var i=this.node();return n.local?i.getAttributeNS(n.space,n.local):i.getAttribute(n)}return this.each((null==t?n.local?ZG:KG:"function"===typeof t?n.local?tH:eH:n.local?$G:JG)(n,t))},style:function(e,t,n){return arguments.length>1?this.each((null==t?iH:"function"===typeof t?sH:rH)(e,t,null==n?"":n)):aH(this.node(),e)},property:function(e,t){return arguments.length>1?this.each((null==t?oH:"function"===typeof t?cH:lH)(e,t)):this.node()[e]},classed:function(e,t){var n=hH(e+"");if(arguments.length<2){for(var i=uH(this.node()),r=-1,s=n.length;++r<s;)if(!i.contains(n[r]))return!1;return!0}return this.each(("function"===typeof t?vH:t?mH:gH)(n,t))},text:function(e){return arguments.length?this.each(null==e?yH:("function"===typeof e?xH:bH)(e)):this.node().textContent},html:function(e){return arguments.length?this.each(null==e?wH:("function"===typeof e?_H:SH)(e)):this.node().innerHTML},raise:function(){return this.each(EH)},lower:function(){return this.each(AH)},append:function(e){var t="function"===typeof e?e:TH(e);return this.select((function(){return this.appendChild(t.apply(this,arguments))}))},insert:function(e,t){var n="function"===typeof e?e:TH(e),i=null==t?PH:"function"===typeof t?t:DG(t);return this.select((function(){return this.insertBefore(n.apply(this,arguments),i.apply(this,arguments)||null)}))},remove:function(){return this.each(DH)},clone:function(e){return this.select(e?IH:OH)},datum:function(e){return arguments.length?this.property("__data__",e):this.node().__data__},on:function(e,t,n){var i,r,s=function(e){return e.trim().split(/^|\s+/).map((function(e){var t="",n=e.indexOf(".");return n>=0&&(t=e.slice(n+1),e=e.slice(0,n)),{type:e,name:t}}))}(e+""),a=s.length;if(!(arguments.length<2)){for(o=t?kH:RH,i=0;i<a;++i)this.each(o(s[i],t,n));return this}var o=this.node().__on;if(o)for(var l,c=0,h=o.length;c<h;++c)for(i=0,l=o[c];i<a;++i)if((r=s[i]).type===l.type&&r.name===l.name)return l.value},dispatch:function(e,t){return this.each(("function"===typeof t?zH:BH)(e,t))},[Symbol.iterator]:function*(){for(var e=this._groups,t=0,n=e.length;t<n;++t)for(var i,r=e[t],s=0,a=r.length;s<a;++s)(i=r[s])&&(yield i)}};const jH=UH;function VH(e){return"string"===typeof e?new FH([[document.querySelector(e)]],[document.documentElement]):new FH([[e]],NH)}const GH={passive:!1},HH={capture:!0,passive:!1};function WH(e){e.stopImmediatePropagation()}function qH(e){e.preventDefault(),e.stopImmediatePropagation()}function XH(e){var t=e.document.documentElement,n=VH(e).on("dragstart.drag",qH,HH);"onselectstart"in t?n.on("selectstart.drag",qH,HH):(t.__noselect=t.style.MozUserSelect,t.style.MozUserSelect="none")}function YH(e,t){var n=e.document.documentElement,i=VH(e).on("dragstart.drag",null);t&&(i.on("click.drag",qH,HH),setTimeout((function(){i.on("click.drag",null)}),0)),"onselectstart"in n?i.on("selectstart.drag",null):(n.style.MozUserSelect=n.__noselect,delete n.__noselect)}function QH(e){return((e=Math.exp(e))+1/e)/2}const KH=function e(t,n,i){function r(e,r){var s,a,o=e[0],l=e[1],c=e[2],h=r[0],u=r[1],d=r[2],p=h-o,f=u-l,m=p*p+f*f;if(m<1e-12)a=Math.log(d/c)/t,s=function(e){return[o+e*p,l+e*f,c*Math.exp(t*e*a)]};else{var g=Math.sqrt(m),v=(d*d-c*c+i*m)/(2*c*n*g),y=(d*d-c*c-i*m)/(2*d*n*g),b=Math.log(Math.sqrt(v*v+1)-v),x=Math.log(Math.sqrt(y*y+1)-y);a=(x-b)/t,s=function(e){var i=e*a,r=QH(b),s=c/(n*g)*(r*function(e){return((e=Math.exp(2*e))-1)/(e+1)}(t*i+b)-function(e){return((e=Math.exp(e))-1/e)/2}(b));return[o+s*p,l+s*f,c*r/QH(t*i+b)]}}return s.duration=1e3*a*t/Math.SQRT2,s}return r.rho=function(t){var n=Math.max(.001,+t),i=n*n;return e(n,i,i*i)},r}(Math.SQRT2,2,4);function ZH(e,t){if(e=function(e){let t;for(;t=e.sourceEvent;)e=t;return e}(e),void 0===t&&(t=e.currentTarget),t){var n=t.ownerSVGElement||t;if(n.createSVGPoint){var i=n.createSVGPoint();return i.x=e.clientX,i.y=e.clientY,[(i=i.matrixTransform(t.getScreenCTM().inverse())).x,i.y]}if(t.getBoundingClientRect){var r=t.getBoundingClientRect();return[e.clientX-r.left-t.clientLeft,e.clientY-r.top-t.clientTop]}}return[e.pageX,e.pageY]}var JH,$H,eW=0,tW=0,nW=0,iW=0,rW=0,sW=0,aW="object"===typeof performance&&performance.now?performance:Date,oW="object"===typeof window&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(e){setTimeout(e,17)};function lW(){return rW||(oW(cW),rW=aW.now()+sW)}function cW(){rW=0}function hW(){this._call=this._time=this._next=null}function uW(e,t,n){var i=new hW;return i.restart(e,t,n),i}function dW(){rW=(iW=aW.now())+sW,eW=tW=0;try{!function(){lW(),++eW;for(var e,t=JH;t;)(e=rW-t._time)>=0&&t._call.call(void 0,e),t=t._next;--eW}()}finally{eW=0,function(){var e,t,n=JH,i=1/0;for(;n;)n._call?(i>n._time&&(i=n._time),e=n,n=n._next):(t=n._next,n._next=null,n=e?e._next=t:JH=t);$H=e,fW(i)}(),rW=0}}function pW(){var e=aW.now(),t=e-iW;t>1e3&&(sW-=t,iW=e)}function fW(e){eW||(tW&&(tW=clearTimeout(tW)),e-rW>24?(e<1/0&&(tW=setTimeout(dW,e-aW.now()-sW)),nW&&(nW=clearInterval(nW))):(nW||(iW=aW.now(),nW=setInterval(pW,1e3)),eW=1,oW(dW)))}function mW(e,t,n){var i=new hW;return t=null==t?0:+t,i.restart((n=>{i.stop(),e(n+t)}),t,n),i}hW.prototype=uW.prototype={constructor:hW,restart:function(e,t,n){if("function"!==typeof e)throw new TypeError("callback is not a function");n=(null==n?lW():+n)+(null==t?0:+t),this._next||$H===this||($H?$H._next=this:JH=this,$H=this),this._call=e,this._time=n,fW()},stop:function(){this._call&&(this._call=null,this._time=1/0,fW())}};var gW=TG("start","end","cancel","interrupt"),vW=[];function yW(e,t,n,i,r,s){var a=e.__transition;if(a){if(n in a)return}else e.__transition={};!function(e,t,n){var i,r=e.__transition;function s(e){n.state=1,n.timer.restart(a,n.delay,n.time),n.delay<=e&&a(e-n.delay)}function a(s){var c,h,u,d;if(1!==n.state)return l();for(c in r)if((d=r[c]).name===n.name){if(3===d.state)return mW(a);4===d.state?(d.state=6,d.timer.stop(),d.on.call("interrupt",e,e.__data__,d.index,d.group),delete r[c]):+c<t&&(d.state=6,d.timer.stop(),d.on.call("cancel",e,e.__data__,d.index,d.group),delete r[c])}if(mW((function(){3===n.state&&(n.state=4,n.timer.restart(o,n.delay,n.time),o(s))})),n.state=2,n.on.call("start",e,e.__data__,n.index,n.group),2===n.state){for(n.state=3,i=new Array(u=n.tween.length),c=0,h=-1;c<u;++c)(d=n.tween[c].value.call(e,e.__data__,n.index,n.group))&&(i[++h]=d);i.length=h+1}}function o(t){for(var r=t<n.duration?n.ease.call(null,t/n.duration):(n.timer.restart(l),n.state=5,1),s=-1,a=i.length;++s<a;)i[s].call(e,r);5===n.state&&(n.on.call("end",e,e.__data__,n.index,n.group),l())}function l(){for(var i in n.state=6,n.timer.stop(),delete r[t],r)return;delete e.__transition}r[t]=n,n.timer=uW(s,0,n.time)}(e,n,{name:t,index:i,group:r,on:gW,tween:vW,time:s.time,delay:s.delay,duration:s.duration,ease:s.ease,timer:null,state:0})}function bW(e,t){var n=wW(e,t);if(n.state>0)throw new Error("too late; already scheduled");return n}function xW(e,t){var n=wW(e,t);if(n.state>3)throw new Error("too late; already running");return n}function wW(e,t){var n=e.__transition;if(!n||!(n=n[t]))throw new Error("transition not found");return n}function SW(e,t){var n,i,r,s=e.__transition,a=!0;if(s){for(r in t=null==t?null:t+"",s)(n=s[r]).name===t?(i=n.state>2&&n.state<5,n.state=6,n.timer.stop(),n.on.call(i?"interrupt":"cancel",e,e.__data__,n.index,n.group),delete s[r]):a=!1;a&&delete e.__transition}}function _W(e,t){return e=+e,t=+t,function(n){return e*(1-n)+t*n}}var EW,AW=180/Math.PI,CW={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function MW(e,t,n,i,r,s){var a,o,l;return(a=Math.sqrt(e*e+t*t))&&(e/=a,t/=a),(l=e*n+t*i)&&(n-=e*l,i-=t*l),(o=Math.sqrt(n*n+i*i))&&(n/=o,i/=o,l/=o),e*i<t*n&&(e=-e,t=-t,l=-l,a=-a),{translateX:r,translateY:s,rotate:Math.atan2(t,e)*AW,skewX:Math.atan(l)*AW,scaleX:a,scaleY:o}}function TW(e,t,n,i){function r(e){return e.length?e.pop()+" ":""}return function(s,a){var o=[],l=[];return s=e(s),a=e(a),function(e,i,r,s,a,o){if(e!==r||i!==s){var l=a.push("translate(",null,t,null,n);o.push({i:l-4,x:_W(e,r)},{i:l-2,x:_W(i,s)})}else(r||s)&&a.push("translate("+r+t+s+n)}(s.translateX,s.translateY,a.translateX,a.translateY,o,l),function(e,t,n,s){e!==t?(e-t>180?t+=360:t-e>180&&(e+=360),s.push({i:n.push(r(n)+"rotate(",null,i)-2,x:_W(e,t)})):t&&n.push(r(n)+"rotate("+t+i)}(s.rotate,a.rotate,o,l),function(e,t,n,s){e!==t?s.push({i:n.push(r(n)+"skewX(",null,i)-2,x:_W(e,t)}):t&&n.push(r(n)+"skewX("+t+i)}(s.skewX,a.skewX,o,l),function(e,t,n,i,s,a){if(e!==n||t!==i){var o=s.push(r(s)+"scale(",null,",",null,")");a.push({i:o-4,x:_W(e,n)},{i:o-2,x:_W(t,i)})}else 1===n&&1===i||s.push(r(s)+"scale("+n+","+i+")")}(s.scaleX,s.scaleY,a.scaleX,a.scaleY,o,l),s=a=null,function(e){for(var t,n=-1,i=l.length;++n<i;)o[(t=l[n]).i]=t.x(e);return o.join("")}}}var PW=TW((function(e){const t=new("function"===typeof DOMMatrix?DOMMatrix:WebKitCSSMatrix)(e+"");return t.isIdentity?CW:MW(t.a,t.b,t.c,t.d,t.e,t.f)}),"px, ","px)","deg)"),DW=TW((function(e){return null==e?CW:(EW||(EW=document.createElementNS("http://www.w3.org/2000/svg","g")),EW.setAttribute("transform",e),(e=EW.transform.baseVal.consolidate())?MW((e=e.matrix).a,e.b,e.c,e.d,e.e,e.f):CW)}),", ",")",")");function OW(e,t){var n,i;return function(){var r=xW(this,e),s=r.tween;if(s!==n)for(var a=0,o=(i=n=s).length;a<o;++a)if(i[a].name===t){(i=i.slice()).splice(a,1);break}r.tween=i}}function IW(e,t,n){var i,r;if("function"!==typeof n)throw new Error;return function(){var s=xW(this,e),a=s.tween;if(a!==i){r=(i=a).slice();for(var o={name:t,value:n},l=0,c=r.length;l<c;++l)if(r[l].name===t){r[l]=o;break}l===c&&r.push(o)}s.tween=r}}function RW(e,t,n){var i=e._id;return e.each((function(){var e=xW(this,i);(e.value||(e.value={}))[t]=n.apply(this,arguments)})),function(e){return wW(e,i).value[t]}}function kW(e,t,n){e.prototype=t.prototype=n,n.constructor=e}function LW(e,t){var n=Object.create(e.prototype);for(var i in t)n[i]=t[i];return n}function BW(){}var zW=.7,NW=1/zW,FW="\\s*([+-]?\\d+)\\s*",UW="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",jW="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",VW=/^#([0-9a-f]{3,8})$/,GW=new RegExp("^rgb\\(".concat(FW,",").concat(FW,",").concat(FW,"\\)$")),HW=new RegExp("^rgb\\(".concat(jW,",").concat(jW,",").concat(jW,"\\)$")),WW=new RegExp("^rgba\\(".concat(FW,",").concat(FW,",").concat(FW,",").concat(UW,"\\)$")),qW=new RegExp("^rgba\\(".concat(jW,",").concat(jW,",").concat(jW,",").concat(UW,"\\)$")),XW=new RegExp("^hsl\\(".concat(UW,",").concat(jW,",").concat(jW,"\\)$")),YW=new RegExp("^hsla\\(".concat(UW,",").concat(jW,",").concat(jW,",").concat(UW,"\\)$")),QW={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function KW(){return this.rgb().formatHex()}function ZW(){return this.rgb().formatRgb()}function JW(e){var t,n;return e=(e+"").trim().toLowerCase(),(t=VW.exec(e))?(n=t[1].length,t=parseInt(t[1],16),6===n?$W(t):3===n?new nq(t>>8&15|t>>4&240,t>>4&15|240&t,(15&t)<<4|15&t,1):8===n?eq(t>>24&255,t>>16&255,t>>8&255,(255&t)/255):4===n?eq(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|240&t,((15&t)<<4|15&t)/255):null):(t=GW.exec(e))?new nq(t[1],t[2],t[3],1):(t=HW.exec(e))?new nq(255*t[1]/100,255*t[2]/100,255*t[3]/100,1):(t=WW.exec(e))?eq(t[1],t[2],t[3],t[4]):(t=qW.exec(e))?eq(255*t[1]/100,255*t[2]/100,255*t[3]/100,t[4]):(t=XW.exec(e))?lq(t[1],t[2]/100,t[3]/100,1):(t=YW.exec(e))?lq(t[1],t[2]/100,t[3]/100,t[4]):QW.hasOwnProperty(e)?$W(QW[e]):"transparent"===e?new nq(NaN,NaN,NaN,0):null}function $W(e){return new nq(e>>16&255,e>>8&255,255&e,1)}function eq(e,t,n,i){return i<=0&&(e=t=n=NaN),new nq(e,t,n,i)}function tq(e,t,n,i){return 1===arguments.length?function(e){return e instanceof BW||(e=JW(e)),e?new nq((e=e.rgb()).r,e.g,e.b,e.opacity):new nq}(e):new nq(e,t,n,null==i?1:i)}function nq(e,t,n,i){this.r=+e,this.g=+t,this.b=+n,this.opacity=+i}function iq(){return"#".concat(oq(this.r)).concat(oq(this.g)).concat(oq(this.b))}function rq(){const e=sq(this.opacity);return"".concat(1===e?"rgb(":"rgba(").concat(aq(this.r),", ").concat(aq(this.g),", ").concat(aq(this.b)).concat(1===e?")":", ".concat(e,")"))}function sq(e){return isNaN(e)?1:Math.max(0,Math.min(1,e))}function aq(e){return Math.max(0,Math.min(255,Math.round(e)||0))}function oq(e){return((e=aq(e))<16?"0":"")+e.toString(16)}function lq(e,t,n,i){return i<=0?e=t=n=NaN:n<=0||n>=1?e=t=NaN:t<=0&&(e=NaN),new hq(e,t,n,i)}function cq(e){if(e instanceof hq)return new hq(e.h,e.s,e.l,e.opacity);if(e instanceof BW||(e=JW(e)),!e)return new hq;if(e instanceof hq)return e;var t=(e=e.rgb()).r/255,n=e.g/255,i=e.b/255,r=Math.min(t,n,i),s=Math.max(t,n,i),a=NaN,o=s-r,l=(s+r)/2;return o?(a=t===s?(n-i)/o+6*(n<i):n===s?(i-t)/o+2:(t-n)/o+4,o/=l<.5?s+r:2-s-r,a*=60):o=l>0&&l<1?0:a,new hq(a,o,l,e.opacity)}function hq(e,t,n,i){this.h=+e,this.s=+t,this.l=+n,this.opacity=+i}function uq(e){return(e=(e||0)%360)<0?e+360:e}function dq(e){return Math.max(0,Math.min(1,e||0))}function pq(e,t,n){return 255*(e<60?t+(n-t)*e/60:e<180?n:e<240?t+(n-t)*(240-e)/60:t)}function fq(e,t,n,i,r){var s=e*e,a=s*e;return((1-3*e+3*s-a)*t+(4-6*s+3*a)*n+(1+3*e+3*s-3*a)*i+a*r)/6}kW(BW,JW,{copy(e){return Object.assign(new this.constructor,this,e)},displayable(){return this.rgb().displayable()},hex:KW,formatHex:KW,formatHex8:function(){return this.rgb().formatHex8()},formatHsl:function(){return cq(this).formatHsl()},formatRgb:ZW,toString:ZW}),kW(nq,tq,LW(BW,{brighter(e){return e=null==e?NW:Math.pow(NW,e),new nq(this.r*e,this.g*e,this.b*e,this.opacity)},darker(e){return e=null==e?zW:Math.pow(zW,e),new nq(this.r*e,this.g*e,this.b*e,this.opacity)},rgb(){return this},clamp(){return new nq(aq(this.r),aq(this.g),aq(this.b),sq(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:iq,formatHex:iq,formatHex8:function(){return"#".concat(oq(this.r)).concat(oq(this.g)).concat(oq(this.b)).concat(oq(255*(isNaN(this.opacity)?1:this.opacity)))},formatRgb:rq,toString:rq})),kW(hq,(function(e,t,n,i){return 1===arguments.length?cq(e):new hq(e,t,n,null==i?1:i)}),LW(BW,{brighter(e){return e=null==e?NW:Math.pow(NW,e),new hq(this.h,this.s,this.l*e,this.opacity)},darker(e){return e=null==e?zW:Math.pow(zW,e),new hq(this.h,this.s,this.l*e,this.opacity)},rgb(){var e=this.h%360+360*(this.h<0),t=isNaN(e)||isNaN(this.s)?0:this.s,n=this.l,i=n+(n<.5?n:1-n)*t,r=2*n-i;return new nq(pq(e>=240?e-240:e+120,r,i),pq(e,r,i),pq(e<120?e+240:e-120,r,i),this.opacity)},clamp(){return new hq(uq(this.h),dq(this.s),dq(this.l),sq(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const e=sq(this.opacity);return"".concat(1===e?"hsl(":"hsla(").concat(uq(this.h),", ").concat(100*dq(this.s),"%, ").concat(100*dq(this.l),"%").concat(1===e?")":", ".concat(e,")"))}}));const mq=e=>()=>e;function gq(e,t){return function(n){return e+n*t}}function vq(e){return 1===(e=+e)?yq:function(t,n){return n-t?function(e,t,n){return e=Math.pow(e,n),t=Math.pow(t,n)-e,n=1/n,function(i){return Math.pow(e+i*t,n)}}(t,n,e):mq(isNaN(t)?n:t)}}function yq(e,t){var n=t-e;return n?gq(e,n):mq(isNaN(e)?t:e)}const bq=function e(t){var n=vq(t);function i(e,t){var i=n((e=tq(e)).r,(t=tq(t)).r),r=n(e.g,t.g),s=n(e.b,t.b),a=yq(e.opacity,t.opacity);return function(t){return e.r=i(t),e.g=r(t),e.b=s(t),e.opacity=a(t),e+""}}return i.gamma=e,i}(1);function xq(e){return function(t){var n,i,r=t.length,s=new Array(r),a=new Array(r),o=new Array(r);for(n=0;n<r;++n)i=tq(t[n]),s[n]=i.r||0,a[n]=i.g||0,o[n]=i.b||0;return s=e(s),a=e(a),o=e(o),i.opacity=1,function(e){return i.r=s(e),i.g=a(e),i.b=o(e),i+""}}}xq((function(e){var t=e.length-1;return function(n){var i=n<=0?n=0:n>=1?(n=1,t-1):Math.floor(n*t),r=e[i],s=e[i+1],a=i>0?e[i-1]:2*r-s,o=i<t-1?e[i+2]:2*s-r;return fq((n-i/t)*t,a,r,s,o)}})),xq((function(e){var t=e.length;return function(n){var i=Math.floor(((n%=1)<0?++n:n)*t),r=e[(i+t-1)%t],s=e[i%t],a=e[(i+1)%t],o=e[(i+2)%t];return fq((n-i/t)*t,r,s,a,o)}}));var wq=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,Sq=new RegExp(wq.source,"g");function _q(e,t){var n,i,r,s=wq.lastIndex=Sq.lastIndex=0,a=-1,o=[],l=[];for(e+="",t+="";(n=wq.exec(e))&&(i=Sq.exec(t));)(r=i.index)>s&&(r=t.slice(s,r),o[a]?o[a]+=r:o[++a]=r),(n=n[0])===(i=i[0])?o[a]?o[a]+=i:o[++a]=i:(o[++a]=null,l.push({i:a,x:_W(n,i)})),s=Sq.lastIndex;return s<t.length&&(r=t.slice(s),o[a]?o[a]+=r:o[++a]=r),o.length<2?l[0]?function(e){return function(t){return e(t)+""}}(l[0].x):function(e){return function(){return e}}(t):(t=l.length,function(e){for(var n,i=0;i<t;++i)o[(n=l[i]).i]=n.x(e);return o.join("")})}function Eq(e,t){var n;return("number"===typeof t?_W:t instanceof JW?bq:(n=JW(t))?(t=n,bq):_q)(e,t)}function Aq(e){return function(){this.removeAttribute(e)}}function Cq(e){return function(){this.removeAttributeNS(e.space,e.local)}}function Mq(e,t,n){var i,r,s=n+"";return function(){var a=this.getAttribute(e);return a===s?null:a===i?r:r=t(i=a,n)}}function Tq(e,t,n){var i,r,s=n+"";return function(){var a=this.getAttributeNS(e.space,e.local);return a===s?null:a===i?r:r=t(i=a,n)}}function Pq(e,t,n){var i,r,s;return function(){var a,o,l=n(this);if(null!=l)return(a=this.getAttribute(e))===(o=l+"")?null:a===i&&o===r?s:(r=o,s=t(i=a,l));this.removeAttribute(e)}}function Dq(e,t,n){var i,r,s;return function(){var a,o,l=n(this);if(null!=l)return(a=this.getAttributeNS(e.space,e.local))===(o=l+"")?null:a===i&&o===r?s:(r=o,s=t(i=a,l));this.removeAttributeNS(e.space,e.local)}}function Oq(e,t){var n,i;function r(){var r=t.apply(this,arguments);return r!==i&&(n=(i=r)&&function(e,t){return function(n){this.setAttributeNS(e.space,e.local,t.call(this,n))}}(e,r)),n}return r._value=t,r}function Iq(e,t){var n,i;function r(){var r=t.apply(this,arguments);return r!==i&&(n=(i=r)&&function(e,t){return function(n){this.setAttribute(e,t.call(this,n))}}(e,r)),n}return r._value=t,r}function Rq(e,t){return function(){bW(this,e).delay=+t.apply(this,arguments)}}function kq(e,t){return t=+t,function(){bW(this,e).delay=t}}function Lq(e,t){return function(){xW(this,e).duration=+t.apply(this,arguments)}}function Bq(e,t){return t=+t,function(){xW(this,e).duration=t}}var zq=jH.prototype.constructor;function Nq(e){return function(){this.style.removeProperty(e)}}var Fq=0;function Uq(e,t,n,i){this._groups=e,this._parents=t,this._name=n,this._id=i}function jq(){return++Fq}var Vq=jH.prototype;Uq.prototype=function(e){return jH().transition(e)}.prototype={constructor:Uq,select:function(e){var t=this._name,n=this._id;"function"!==typeof e&&(e=DG(e));for(var i=this._groups,r=i.length,s=new Array(r),a=0;a<r;++a)for(var o,l,c=i[a],h=c.length,u=s[a]=new Array(h),d=0;d<h;++d)(o=c[d])&&(l=e.call(o,o.__data__,d,c))&&("__data__"in o&&(l.__data__=o.__data__),u[d]=l,yW(u[d],t,n,d,u,wW(o,n)));return new Uq(s,this._parents,t,n)},selectAll:function(e){var t=this._name,n=this._id;"function"!==typeof e&&(e=IG(e));for(var i=this._groups,r=i.length,s=[],a=[],o=0;o<r;++o)for(var l,c=i[o],h=c.length,u=0;u<h;++u)if(l=c[u]){for(var d,p=e.call(l,l.__data__,u,c),f=wW(l,n),m=0,g=p.length;m<g;++m)(d=p[m])&&yW(d,t,n,m,p,f);s.push(p),a.push(l)}return new Uq(s,a,t,n)},selectChild:Vq.selectChild,selectChildren:Vq.selectChildren,filter:function(e){"function"!==typeof e&&(e=kG(e));for(var t=this._groups,n=t.length,i=new Array(n),r=0;r<n;++r)for(var s,a=t[r],o=a.length,l=i[r]=[],c=0;c<o;++c)(s=a[c])&&e.call(s,s.__data__,c,a)&&l.push(s);return new Uq(i,this._parents,this._name,this._id)},merge:function(e){if(e._id!==this._id)throw new Error;for(var t=this._groups,n=e._groups,i=t.length,r=n.length,s=Math.min(i,r),a=new Array(i),o=0;o<s;++o)for(var l,c=t[o],h=n[o],u=c.length,d=a[o]=new Array(u),p=0;p<u;++p)(l=c[p]||h[p])&&(d[p]=l);for(;o<i;++o)a[o]=t[o];return new Uq(a,this._parents,this._name,this._id)},selection:function(){return new zq(this._groups,this._parents)},transition:function(){for(var e=this._name,t=this._id,n=jq(),i=this._groups,r=i.length,s=0;s<r;++s)for(var a,o=i[s],l=o.length,c=0;c<l;++c)if(a=o[c]){var h=wW(a,t);yW(a,e,n,c,o,{time:h.time+h.delay+h.duration,delay:0,duration:h.duration,ease:h.ease})}return new Uq(i,this._parents,e,n)},call:Vq.call,nodes:Vq.nodes,node:Vq.node,size:Vq.size,empty:Vq.empty,each:Vq.each,on:function(e,t){var n=this._id;return arguments.length<2?wW(this.node(),n).on.on(e):this.each(function(e,t,n){var i,r,s=function(e){return(e+"").trim().split(/^|\s+/).every((function(e){var t=e.indexOf(".");return t>=0&&(e=e.slice(0,t)),!e||"start"===e}))}(t)?bW:xW;return function(){var a=s(this,e),o=a.on;o!==i&&(r=(i=o).copy()).on(t,n),a.on=r}}(n,e,t))},attr:function(e,t){var n=QG(e),i="transform"===n?DW:Eq;return this.attrTween(e,"function"===typeof t?(n.local?Dq:Pq)(n,i,RW(this,"attr."+e,t)):null==t?(n.local?Cq:Aq)(n):(n.local?Tq:Mq)(n,i,t))},attrTween:function(e,t){var n="attr."+e;if(arguments.length<2)return(n=this.tween(n))&&n._value;if(null==t)return this.tween(n,null);if("function"!==typeof t)throw new Error;var i=QG(e);return this.tween(n,(i.local?Oq:Iq)(i,t))},style:function(e,t,n){var i="transform"===(e+="")?PW:Eq;return null==t?this.styleTween(e,function(e,t){var n,i,r;return function(){var s=aH(this,e),a=(this.style.removeProperty(e),aH(this,e));return s===a?null:s===n&&a===i?r:r=t(n=s,i=a)}}(e,i)).on("end.style."+e,Nq(e)):"function"===typeof t?this.styleTween(e,function(e,t,n){var i,r,s;return function(){var a=aH(this,e),o=n(this),l=o+"";return null==o&&(this.style.removeProperty(e),l=o=aH(this,e)),a===l?null:a===i&&l===r?s:(r=l,s=t(i=a,o))}}(e,i,RW(this,"style."+e,t))).each(function(e,t){var n,i,r,s,a="style."+t,o="end."+a;return function(){var l=xW(this,e),c=l.on,h=null==l.value[a]?s||(s=Nq(t)):void 0;c===n&&r===h||(i=(n=c).copy()).on(o,r=h),l.on=i}}(this._id,e)):this.styleTween(e,function(e,t,n){var i,r,s=n+"";return function(){var a=aH(this,e);return a===s?null:a===i?r:r=t(i=a,n)}}(e,i,t),n).on("end.style."+e,null)},styleTween:function(e,t,n){var i="style."+(e+="");if(arguments.length<2)return(i=this.tween(i))&&i._value;if(null==t)return this.tween(i,null);if("function"!==typeof t)throw new Error;return this.tween(i,function(e,t,n){var i,r;function s(){var s=t.apply(this,arguments);return s!==r&&(i=(r=s)&&function(e,t,n){return function(i){this.style.setProperty(e,t.call(this,i),n)}}(e,s,n)),i}return s._value=t,s}(e,t,null==n?"":n))},text:function(e){return this.tween("text","function"===typeof e?function(e){return function(){var t=e(this);this.textContent=null==t?"":t}}(RW(this,"text",e)):function(e){return function(){this.textContent=e}}(null==e?"":e+""))},textTween:function(e){var t="text";if(arguments.length<1)return(t=this.tween(t))&&t._value;if(null==e)return this.tween(t,null);if("function"!==typeof e)throw new Error;return this.tween(t,function(e){var t,n;function i(){var i=e.apply(this,arguments);return i!==n&&(t=(n=i)&&function(e){return function(t){this.textContent=e.call(this,t)}}(i)),t}return i._value=e,i}(e))},remove:function(){return this.on("end.remove",function(e){return function(){var t=this.parentNode;for(var n in this.__transition)if(+n!==e)return;t&&t.removeChild(this)}}(this._id))},tween:function(e,t){var n=this._id;if(e+="",arguments.length<2){for(var i,r=wW(this.node(),n).tween,s=0,a=r.length;s<a;++s)if((i=r[s]).name===e)return i.value;return null}return this.each((null==t?OW:IW)(n,e,t))},delay:function(e){var t=this._id;return arguments.length?this.each(("function"===typeof e?Rq:kq)(t,e)):wW(this.node(),t).delay},duration:function(e){var t=this._id;return arguments.length?this.each(("function"===typeof e?Lq:Bq)(t,e)):wW(this.node(),t).duration},ease:function(e){var t=this._id;return arguments.length?this.each(function(e,t){if("function"!==typeof t)throw new Error;return function(){xW(this,e).ease=t}}(t,e)):wW(this.node(),t).ease},easeVarying:function(e){if("function"!==typeof e)throw new Error;return this.each(function(e,t){return function(){var n=t.apply(this,arguments);if("function"!==typeof n)throw new Error;xW(this,e).ease=n}}(this._id,e))},end:function(){var e,t,n=this,i=n._id,r=n.size();return new Promise((function(s,a){var o={value:a},l={value:function(){0===--r&&s()}};n.each((function(){var n=xW(this,i),r=n.on;r!==e&&((t=(e=r).copy())._.cancel.push(o),t._.interrupt.push(o),t._.end.push(l)),n.on=t})),0===r&&s()}))},[Symbol.iterator]:Vq[Symbol.iterator]};var Gq={time:null,delay:0,duration:250,ease:function(e){return((e*=2)<=1?e*e*e:(e-=2)*e*e+2)/2}};function Hq(e,t){for(var n;!(n=e.__transition)||!(n=n[t]);)if(!(e=e.parentNode))throw new Error("transition ".concat(t," not found"));return n}jH.prototype.interrupt=function(e){return this.each((function(){SW(this,e)}))},jH.prototype.transition=function(e){var t,n;e instanceof Uq?(t=e._id,e=e._name):(t=jq(),(n=Gq).time=lW(),e=null==e?null:e+"");for(var i=this._groups,r=i.length,s=0;s<r;++s)for(var a,o=i[s],l=o.length,c=0;c<l;++c)(a=o[c])&&yW(a,e,t,c,o,n||Hq(a,t));return new Uq(i,this._parents,e,t)};const Wq=e=>()=>e;function qq(e,t){let{sourceEvent:n,target:i,transform:r,dispatch:s}=t;Object.defineProperties(this,{type:{value:e,enumerable:!0,configurable:!0},sourceEvent:{value:n,enumerable:!0,configurable:!0},target:{value:i,enumerable:!0,configurable:!0},transform:{value:r,enumerable:!0,configurable:!0},_:{value:s}})}function Xq(e,t,n){this.k=e,this.x=t,this.y=n}Xq.prototype={constructor:Xq,scale:function(e){return 1===e?this:new Xq(this.k*e,this.x,this.y)},translate:function(e,t){return 0===e&0===t?this:new Xq(this.k,this.x+this.k*e,this.y+this.k*t)},apply:function(e){return[e[0]*this.k+this.x,e[1]*this.k+this.y]},applyX:function(e){return e*this.k+this.x},applyY:function(e){return e*this.k+this.y},invert:function(e){return[(e[0]-this.x)/this.k,(e[1]-this.y)/this.k]},invertX:function(e){return(e-this.x)/this.k},invertY:function(e){return(e-this.y)/this.k},rescaleX:function(e){return e.copy().domain(e.range().map(this.invertX,this).map(e.invert,e))},rescaleY:function(e){return e.copy().domain(e.range().map(this.invertY,this).map(e.invert,e))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};var Yq=new Xq(1,0,0);function Qq(e){e.stopImmediatePropagation()}function Kq(e){e.preventDefault(),e.stopImmediatePropagation()}function Zq(e){return(!e.ctrlKey||"wheel"===e.type)&&!e.button}function Jq(){var e=this;return e instanceof SVGElement?(e=e.ownerSVGElement||e).hasAttribute("viewBox")?[[(e=e.viewBox.baseVal).x,e.y],[e.x+e.width,e.y+e.height]]:[[0,0],[e.width.baseVal.value,e.height.baseVal.value]]:[[0,0],[e.clientWidth,e.clientHeight]]}function $q(){return this.__zoom||Yq}function eX(e){return-e.deltaY*(1===e.deltaMode?.05:e.deltaMode?1:.002)*(e.ctrlKey?10:1)}function tX(){return navigator.maxTouchPoints||"ontouchstart"in this}function nX(e,t,n){var i=e.invertX(t[0][0])-n[0][0],r=e.invertX(t[1][0])-n[1][0],s=e.invertY(t[0][1])-n[0][1],a=e.invertY(t[1][1])-n[1][1];return e.translate(r>i?(i+r)/2:Math.min(0,i)||Math.max(0,r),a>s?(s+a)/2:Math.min(0,s)||Math.max(0,a))}Xq.prototype;const iX=e=>()=>e;function rX(e,t){let{sourceEvent:n,subject:i,target:r,identifier:s,active:a,x:o,y:l,dx:c,dy:h,dispatch:u}=t;Object.defineProperties(this,{type:{value:e,enumerable:!0,configurable:!0},sourceEvent:{value:n,enumerable:!0,configurable:!0},subject:{value:i,enumerable:!0,configurable:!0},target:{value:r,enumerable:!0,configurable:!0},identifier:{value:s,enumerable:!0,configurable:!0},active:{value:a,enumerable:!0,configurable:!0},x:{value:o,enumerable:!0,configurable:!0},y:{value:l,enumerable:!0,configurable:!0},dx:{value:c,enumerable:!0,configurable:!0},dy:{value:h,enumerable:!0,configurable:!0},_:{value:u}})}function sX(e){return!e.ctrlKey&&!e.button}function aX(){return this.parentNode}function oX(e,t){return null==t?{x:e.x,y:e.y}:t}function lX(){return navigator.maxTouchPoints||"ontouchstart"in this}rX.prototype.on=function(){var e=this._.on.apply(this._,arguments);return e===this._?this:e};n(950);const cX=["position","children","className","style"],hX=["x","y","label","labelStyle","labelShowBg","labelBgStyle","labelBgPadding","labelBgBorderRadius","children","className"],uX=["type","position","isValidConnection","isConnectable","isConnectableStart","isConnectableEnd","id","onConnect","children","className","onMouseDown","onTouchStart"],dX=["nodes","edges","defaultNodes","defaultEdges","className","nodeTypes","edgeTypes","onNodeClick","onEdgeClick","onInit","onMove","onMoveStart","onMoveEnd","onConnect","onConnectStart","onConnectEnd","onClickConnectStart","onClickConnectEnd","onNodeMouseEnter","onNodeMouseMove","onNodeMouseLeave","onNodeContextMenu","onNodeDoubleClick","onNodeDragStart","onNodeDrag","onNodeDragStop","onNodesDelete","onEdgesDelete","onSelectionChange","onSelectionDragStart","onSelectionDrag","onSelectionDragStop","onSelectionContextMenu","onSelectionStart","onSelectionEnd","connectionMode","connectionLineType","connectionLineStyle","connectionLineComponent","connectionLineContainerStyle","deleteKeyCode","selectionKeyCode","selectionOnDrag","selectionMode","panActivationKeyCode","multiSelectionKeyCode","zoomActivationKeyCode","snapToGrid","snapGrid","onlyRenderVisibleElements","selectNodesOnDrag","nodesDraggable","nodesConnectable","nodesFocusable","nodeOrigin","edgesFocusable","edgesUpdatable","elementsSelectable","defaultViewport","minZoom","maxZoom","translateExtent","preventScrolling","nodeExtent","defaultMarkerColor","zoomOnScroll","zoomOnPinch","panOnScroll","panOnScrollSpeed","panOnScrollMode","zoomOnDoubleClick","panOnDrag","onPaneClick","onPaneMouseEnter","onPaneMouseMove","onPaneMouseLeave","onPaneScroll","onPaneContextMenu","children","onEdgeContextMenu","onEdgeDoubleClick","onEdgeMouseEnter","onEdgeMouseMove","onEdgeMouseLeave","onEdgeUpdate","onEdgeUpdateStart","onEdgeUpdateEnd","onReconnect","onReconnectStart","onReconnectEnd","reconnectRadius","edgeUpdaterRadius","onNodesChange","onEdgesChange","noDragClassName","noWheelClassName","noPanClassName","fitView","fitViewOptions","connectOnClick","attributionPosition","proOptions","defaultEdgeOptions","elevateNodesOnSelect","elevateEdgesOnSelect","disableKeyboardA11y","autoPanOnConnect","autoPanOnNodeDrag","connectionRadius","isValidConnection","onError","style","id","nodeDragThreshold"],pX=(0,e.createContext)(null),fX=pX.Provider,mX=e=>'Node type "'.concat(e,'" not found. Using fallback type "default".'),gX=()=>"The React Flow parent container needs a width and a height to render the graph.",vX=()=>"Only child nodes can use a parent extent.",yX=()=>"Can't create edge. An edge needs a source and a target.",bX=e=>'Marker type "'.concat(e,"\" doesn't exist."),xX=(e,t)=>"Couldn't create edge for ".concat(e?"target":"source",' handle id: "').concat(e?t.targetHandle:t.sourceHandle,'", edge id: ').concat(t.id,"."),wX=()=>"Handle: No node id found. Make sure to only use a Handle inside a custom Node.",SX=e=>'Edge type "'.concat(e,'" not found. Using fallback type "default".'),_X=e=>'Node with id "'.concat(e,'" does not exist, it may have been removed. This can happen when a node is deleted before the "onNodeClick" handler is called.'),EX=(()=>"[React Flow]: Seems like you have not used zustand provider as an ancestor. Help: https://reactflow.dev/error#001")();function AX(t,n){const i=(0,e.useContext)(pX);if(null===i)throw new Error(EX);return xG(i,t,n)}const CX=()=>{const t=(0,e.useContext)(pX);if(null===t)throw new Error(EX);return(0,e.useMemo)((()=>({getState:t.getState,setState:t.setState,subscribe:t.subscribe,destroy:t.destroy})),[t])},MX=e=>e.userSelectionActive?"none":"all";function TX(t){let{position:n,children:i,className:r,style:s}=t,a=l(t,cX);const c=AX(MX),h="".concat(n).split("-");return e.createElement("div",o({className:pG(["react-flow__panel",r,...h]),style:o(o({},s),{},{pointerEvents:c})},a),i)}function PX(t){let{proOptions:n,position:i="bottom-right"}=t;return null!==n&&void 0!==n&&n.hideAttribution?null:e.createElement(TX,{position:i,className:"react-flow__attribution","data-message":"Please only hide this attribution when you are subscribed to React Flow Pro: https://reactflow.dev/pro"},e.createElement("a",{href:"https://reactflow.dev",target:"_blank",rel:"noopener noreferrer","aria-label":"React Flow attribution"},"React Flow"))}var DX=(0,e.memo)((t=>{let{x:n,y:i,label:r,labelStyle:s={},labelShowBg:a=!0,labelBgStyle:c={},labelBgPadding:h=[2,4],labelBgBorderRadius:u=2,children:d,className:p}=t,f=l(t,hX);const m=(0,e.useRef)(null),[g,v]=(0,e.useState)({x:0,y:0,width:0,height:0}),y=pG(["react-flow__edge-textwrapper",p]);return(0,e.useEffect)((()=>{if(m.current){const e=m.current.getBBox();v({x:e.x,y:e.y,width:e.width,height:e.height})}}),[r]),"undefined"!==typeof r&&r?e.createElement("g",o({transform:"translate(".concat(n-g.width/2," ").concat(i-g.height/2,")"),className:y,visibility:g.width?"visible":"hidden"},f),a&&e.createElement("rect",{width:g.width+2*h[0],x:-h[0],y:-h[1],height:g.height+2*h[1],className:"react-flow__edge-textbg",style:c,rx:u,ry:u}),e.createElement("text",{className:"react-flow__edge-text",y:g.height/2,dy:"0.3em",ref:m,style:s},r),d):null}));const OX=e=>({width:e.offsetWidth,height:e.offsetHeight}),IX=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return Math.min(Math.max(e,t),n)},RX=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{x:0,y:0},t=arguments.length>1?arguments[1]:void 0;return{x:IX(e.x,t[0][0],t[1][0]),y:IX(e.y,t[0][1],t[1][1])}},kX=(e,t,n)=>e<t?IX(Math.abs(e-t),1,50)/50:e>n?-IX(Math.abs(e-n),1,50)/50:0,LX=(e,t)=>[20*kX(e.x,35,t.width-35),20*kX(e.y,35,t.height-35)],BX=e=>{var t,n;return(null===(t=e.getRootNode)||void 0===t?void 0:t.call(e))||(null===(n=window)||void 0===n?void 0:n.document)},zX=(e,t)=>({x:Math.min(e.x,t.x),y:Math.min(e.y,t.y),x2:Math.max(e.x2,t.x2),y2:Math.max(e.y2,t.y2)}),NX=e=>{let{x:t,y:n,width:i,height:r}=e;return{x:t,y:n,x2:t+i,y2:n+r}},FX=e=>{let{x:t,y:n,x2:i,y2:r}=e;return{x:t,y:n,width:i-t,height:r-n}},UX=e=>o(o({},e.positionAbsolute||{x:0,y:0}),{},{width:e.width||0,height:e.height||0}),jX=(e,t)=>{const n=Math.max(0,Math.min(e.x+e.width,t.x+t.width)-Math.max(e.x,t.x)),i=Math.max(0,Math.min(e.y+e.height,t.y+t.height)-Math.max(e.y,t.y));return Math.ceil(n*i)},VX=e=>!isNaN(e)&&isFinite(e),GX=Symbol.for("internals"),HX=["Enter"," ","Escape"],WX=(e,t)=>{0};function qX(e){var t;const n=(e=>"nativeEvent"in e)(e)?e.nativeEvent:e,i=(null===(t=n.composedPath)||void 0===t||null===(t=t.call(n))||void 0===t?void 0:t[0])||e.target;return["INPUT","SELECT","TEXTAREA"].includes(null===i||void 0===i?void 0:i.nodeName)||(null===i||void 0===i?void 0:i.hasAttribute("contenteditable"))||!(null===i||void 0===i||!i.closest(".nokey"))}const XX=e=>"clientX"in e,YX=(e,t)=>{var n,i,r,s;const a=XX(e),o=a?e.clientX:null===(n=e.touches)||void 0===n?void 0:n[0].clientX,l=a?e.clientY:null===(i=e.touches)||void 0===i?void 0:i[0].clientY;return{x:o-(null!==(r=null===t||void 0===t?void 0:t.left)&&void 0!==r?r:0),y:l-(null!==(s=null===t||void 0===t?void 0:t.top)&&void 0!==s?s:0)}},QX=()=>{var e;return"undefined"!==typeof navigator&&(null===(e=navigator)||void 0===e||null===(e=e.userAgent)||void 0===e?void 0:e.indexOf("Mac"))>=0},KX=t=>{let{id:n,path:i,labelX:r,labelY:s,label:a,labelStyle:o,labelShowBg:l,labelBgStyle:c,labelBgPadding:h,labelBgBorderRadius:u,style:d,markerEnd:p,markerStart:f,interactionWidth:m=20}=t;return e.createElement(e.Fragment,null,e.createElement("path",{id:n,style:d,d:i,fill:"none",className:"react-flow__edge-path",markerEnd:p,markerStart:f}),m&&e.createElement("path",{d:i,fill:"none",strokeOpacity:0,strokeWidth:m,className:"react-flow__edge-interaction"}),a&&VX(r)&&VX(s)?e.createElement(DX,{x:r,y:s,label:a,labelStyle:o,labelShowBg:l,labelBgStyle:c,labelBgPadding:h,labelBgBorderRadius:u}):null)};KX.displayName="BaseEdge";function ZX(e,t,n){return void 0===n?n:i=>{const r=t().edges.find((t=>t.id===e));r&&n(i,o({},r))}}function JX(e){let{sourceX:t,sourceY:n,targetX:i,targetY:r}=e;const s=Math.abs(i-t)/2,a=i<t?i+s:i-s,o=Math.abs(r-n)/2;return[a,r<n?r+o:r-o,s,o]}function $X(e){let{sourceX:t,sourceY:n,targetX:i,targetY:r,sourceControlX:s,sourceControlY:a,targetControlX:o,targetControlY:l}=e;const c=.125*t+.375*s+.375*o+.125*i,h=.125*n+.375*a+.375*l+.125*r;return[c,h,Math.abs(c-t),Math.abs(h-n)]}var eY,tY,nY,iY,rY,sY;function aY(e){let{pos:t,x1:n,y1:i,x2:r,y2:s}=e;return t===sY.Left||t===sY.Right?[.5*(n+r),i]:[n,.5*(i+s)]}function oY(e){let{sourceX:t,sourceY:n,sourcePosition:i=sY.Bottom,targetX:r,targetY:s,targetPosition:a=sY.Top}=e;const[o,l]=aY({pos:i,x1:t,y1:n,x2:r,y2:s}),[c,h]=aY({pos:a,x1:r,y1:s,x2:t,y2:n}),[u,d,p,f]=$X({sourceX:t,sourceY:n,targetX:r,targetY:s,sourceControlX:o,sourceControlY:l,targetControlX:c,targetControlY:h});return["M".concat(t,",").concat(n," C").concat(o,",").concat(l," ").concat(c,",").concat(h," ").concat(r,",").concat(s),u,d,p,f]}!function(e){e.Strict="strict",e.Loose="loose"}(eY||(eY={})),function(e){e.Free="free",e.Vertical="vertical",e.Horizontal="horizontal"}(tY||(tY={})),function(e){e.Partial="partial",e.Full="full"}(nY||(nY={})),function(e){e.Bezier="default",e.Straight="straight",e.Step="step",e.SmoothStep="smoothstep",e.SimpleBezier="simplebezier"}(iY||(iY={})),function(e){e.Arrow="arrow",e.ArrowClosed="arrowclosed"}(rY||(rY={})),function(e){e.Left="left",e.Top="top",e.Right="right",e.Bottom="bottom"}(sY||(sY={}));const lY=(0,e.memo)((t=>{let{sourceX:n,sourceY:i,targetX:r,targetY:s,sourcePosition:a=sY.Bottom,targetPosition:o=sY.Top,label:l,labelStyle:c,labelShowBg:h,labelBgStyle:u,labelBgPadding:d,labelBgBorderRadius:p,style:f,markerEnd:m,markerStart:g,interactionWidth:v}=t;const[y,b,x]=oY({sourceX:n,sourceY:i,sourcePosition:a,targetX:r,targetY:s,targetPosition:o});return e.createElement(KX,{path:y,labelX:b,labelY:x,label:l,labelStyle:c,labelShowBg:h,labelBgStyle:u,labelBgPadding:d,labelBgBorderRadius:p,style:f,markerEnd:m,markerStart:g,interactionWidth:v})}));lY.displayName="SimpleBezierEdge";const cY={[sY.Left]:{x:-1,y:0},[sY.Right]:{x:1,y:0},[sY.Top]:{x:0,y:-1},[sY.Bottom]:{x:0,y:1}},hY=(e,t)=>Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2));function uY(e){let{source:t,sourcePosition:n=sY.Bottom,target:i,targetPosition:r=sY.Top,center:s,offset:a}=e;const o=cY[n],l=cY[r],c={x:t.x+o.x*a,y:t.y+o.y*a},h={x:i.x+l.x*a,y:i.y+l.y*a},u=(e=>{let{source:t,sourcePosition:n=sY.Bottom,target:i}=e;return n===sY.Left||n===sY.Right?t.x<i.x?{x:1,y:0}:{x:-1,y:0}:t.y<i.y?{x:0,y:1}:{x:0,y:-1}})({source:c,sourcePosition:n,target:h}),d=0!==u.x?"x":"y",p=u[d];let f,m,g=[];const v={x:0,y:0},y={x:0,y:0},[b,x,w,S]=JX({sourceX:t.x,sourceY:t.y,targetX:i.x,targetY:i.y});if(o[d]*l[d]===-1){var _,E;f=null!==(_=s.x)&&void 0!==_?_:b,m=null!==(E=s.y)&&void 0!==E?E:x;const e=[{x:f,y:c.y},{x:f,y:h.y}],t=[{x:c.x,y:m},{x:h.x,y:m}];g=o[d]===p?"x"===d?e:t:"x"===d?t:e}else{const e=[{x:c.x,y:h.y}],s=[{x:h.x,y:c.y}];if(g="x"===d?o.x===p?s:e:o.y===p?e:s,n===r){const e=Math.abs(t[d]-i[d]);if(e<=a){const n=Math.min(a-1,a-e);o[d]===p?v[d]=(c[d]>t[d]?-1:1)*n:y[d]=(h[d]>i[d]?-1:1)*n}}if(n!==r){const t="x"===d?"y":"x",n=o[d]===l[t],i=c[t]>h[t],r=c[t]<h[t];(1===o[d]&&(!n&&i||n&&r)||1!==o[d]&&(!n&&r||n&&i))&&(g="x"===d?e:s)}const u={x:c.x+v.x,y:c.y+v.y},b={x:h.x+y.x,y:h.y+y.y};Math.max(Math.abs(u.x-g[0].x),Math.abs(b.x-g[0].x))>=Math.max(Math.abs(u.y-g[0].y),Math.abs(b.y-g[0].y))?(f=(u.x+b.x)/2,m=g[0].y):(f=g[0].x,m=(u.y+b.y)/2)}return[[t,{x:c.x+v.x,y:c.y+v.y},...g,{x:h.x+y.x,y:h.y+y.y},i],f,m,w,S]}function dY(e){let{sourceX:t,sourceY:n,sourcePosition:i=sY.Bottom,targetX:r,targetY:s,targetPosition:a=sY.Top,borderRadius:o=5,centerX:l,centerY:c,offset:h=20}=e;const[u,d,p,f,m]=uY({source:{x:t,y:n},sourcePosition:i,target:{x:r,y:s},targetPosition:a,center:{x:l,y:c},offset:h}),g=u.reduce(((e,t,n)=>{let i="";return i=n>0&&n<u.length-1?function(e,t,n,i){const r=Math.min(hY(e,t)/2,hY(t,n)/2,i),{x:s,y:a}=t;if(e.x===s&&s===n.x||e.y===a&&a===n.y)return"L".concat(s," ").concat(a);if(e.y===a){const t=e.x<n.x?-1:1,i=e.y<n.y?1:-1;return"L ".concat(s+r*t,",").concat(a,"Q ").concat(s,",").concat(a," ").concat(s,",").concat(a+r*i)}const o=e.x<n.x?1:-1,l=e.y<n.y?-1:1;return"L ".concat(s,",").concat(a+r*l,"Q ").concat(s,",").concat(a," ").concat(s+r*o,",").concat(a)}(u[n-1],t,u[n+1],o):"".concat(0===n?"M":"L").concat(t.x," ").concat(t.y),e+=i}),"");return[g,d,p,f,m]}const pY=(0,e.memo)((t=>{let{sourceX:n,sourceY:i,targetX:r,targetY:s,label:a,labelStyle:o,labelShowBg:l,labelBgStyle:c,labelBgPadding:h,labelBgBorderRadius:u,style:d,sourcePosition:p=sY.Bottom,targetPosition:f=sY.Top,markerEnd:m,markerStart:g,pathOptions:v,interactionWidth:y}=t;const[b,x,w]=dY({sourceX:n,sourceY:i,sourcePosition:p,targetX:r,targetY:s,targetPosition:f,borderRadius:null===v||void 0===v?void 0:v.borderRadius,offset:null===v||void 0===v?void 0:v.offset});return e.createElement(KX,{path:b,labelX:x,labelY:w,label:a,labelStyle:o,labelShowBg:l,labelBgStyle:c,labelBgPadding:h,labelBgBorderRadius:u,style:d,markerEnd:m,markerStart:g,interactionWidth:y})}));pY.displayName="SmoothStepEdge";const fY=(0,e.memo)((t=>{var n;return e.createElement(pY,o(o({},t),{},{pathOptions:(0,e.useMemo)((()=>{var e;return{borderRadius:0,offset:null===(e=t.pathOptions)||void 0===e?void 0:e.offset}}),[null===(n=t.pathOptions)||void 0===n?void 0:n.offset])}))}));fY.displayName="StepEdge";const mY=(0,e.memo)((t=>{let{sourceX:n,sourceY:i,targetX:r,targetY:s,label:a,labelStyle:o,labelShowBg:l,labelBgStyle:c,labelBgPadding:h,labelBgBorderRadius:u,style:d,markerEnd:p,markerStart:f,interactionWidth:m}=t;const[g,v,y]=function(e){let{sourceX:t,sourceY:n,targetX:i,targetY:r}=e;const[s,a,o,l]=JX({sourceX:t,sourceY:n,targetX:i,targetY:r});return["M ".concat(t,",").concat(n,"L ").concat(i,",").concat(r),s,a,o,l]}({sourceX:n,sourceY:i,targetX:r,targetY:s});return e.createElement(KX,{path:g,labelX:v,labelY:y,label:a,labelStyle:o,labelShowBg:l,labelBgStyle:c,labelBgPadding:h,labelBgBorderRadius:u,style:d,markerEnd:p,markerStart:f,interactionWidth:m})}));function gY(e,t){return e>=0?.5*e:25*t*Math.sqrt(-e)}function vY(e){let{pos:t,x1:n,y1:i,x2:r,y2:s,c:a}=e;switch(t){case sY.Left:return[n-gY(n-r,a),i];case sY.Right:return[n+gY(r-n,a),i];case sY.Top:return[n,i-gY(i-s,a)];case sY.Bottom:return[n,i+gY(s-i,a)]}}function yY(e){let{sourceX:t,sourceY:n,sourcePosition:i=sY.Bottom,targetX:r,targetY:s,targetPosition:a=sY.Top,curvature:o=.25}=e;const[l,c]=vY({pos:i,x1:t,y1:n,x2:r,y2:s,c:o}),[h,u]=vY({pos:a,x1:r,y1:s,x2:t,y2:n,c:o}),[d,p,f,m]=$X({sourceX:t,sourceY:n,targetX:r,targetY:s,sourceControlX:l,sourceControlY:c,targetControlX:h,targetControlY:u});return["M".concat(t,",").concat(n," C").concat(l,",").concat(c," ").concat(h,",").concat(u," ").concat(r,",").concat(s),d,p,f,m]}mY.displayName="StraightEdge";const bY=(0,e.memo)((t=>{let{sourceX:n,sourceY:i,targetX:r,targetY:s,sourcePosition:a=sY.Bottom,targetPosition:o=sY.Top,label:l,labelStyle:c,labelShowBg:h,labelBgStyle:u,labelBgPadding:d,labelBgBorderRadius:p,style:f,markerEnd:m,markerStart:g,pathOptions:v,interactionWidth:y}=t;const[b,x,w]=yY({sourceX:n,sourceY:i,sourcePosition:a,targetX:r,targetY:s,targetPosition:o,curvature:null===v||void 0===v?void 0:v.curvature});return e.createElement(KX,{path:b,labelX:x,labelY:w,label:l,labelStyle:c,labelShowBg:h,labelBgStyle:u,labelBgPadding:d,labelBgBorderRadius:p,style:f,markerEnd:m,markerStart:g,interactionWidth:y})}));bY.displayName="BezierEdge";const xY=(0,e.createContext)(null),wY=xY.Provider;xY.Consumer;const SY=e=>{let{source:t,sourceHandle:n,target:i,targetHandle:r}=e;return"reactflow__edge-".concat(t).concat(n||"","-").concat(i).concat(r||"")},_Y=(e,t)=>{if("undefined"===typeof e)return"";if("string"===typeof e)return e;const n=t?"".concat(t,"__"):"";return"".concat(n).concat(Object.keys(e).sort().map((t=>"".concat(t,"=").concat(e[t]))).join("&"))},EY=(e,t)=>{if(!e.source||!e.target)return WX(0,yX()),t;let n;var i;return n="id"in(i=e)&&"source"in i&&"target"in i?o({},e):o(o({},e),{},{id:SY(e)}),((e,t)=>t.some((t=>t.source===e.source&&t.target===e.target&&(t.sourceHandle===e.sourceHandle||!t.sourceHandle&&!e.sourceHandle)&&(t.targetHandle===e.targetHandle||!t.targetHandle&&!e.targetHandle))))(n,t)?t:t.concat(n)},AY=(e,t,n,i)=>{let{x:r,y:s}=e,[a,o,l]=t,[c,h]=i;const u={x:(r-a)/l,y:(s-o)/l};return n?{x:c*Math.round(u.x/c),y:h*Math.round(u.y/h)}:u},CY=(e,t)=>{let{x:n,y:i}=e,[r,s,a]=t;return{x:n*a+r,y:i*a+s}},MY=function(e){var t,n;let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0];if(!e)return{x:0,y:0,positionAbsolute:{x:0,y:0}};const r=(null!==(t=e.width)&&void 0!==t?t:0)*i[0],s=(null!==(n=e.height)&&void 0!==n?n:0)*i[1],a={x:e.position.x-r,y:e.position.y-s};return o(o({},a),{},{positionAbsolute:e.positionAbsolute?{x:e.positionAbsolute.x-r,y:e.positionAbsolute.y-s}:a})},TY=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0];if(0===e.length)return{x:0,y:0,width:0,height:0};const n=e.reduce(((e,n)=>{const{x:i,y:r}=MY(n,t).positionAbsolute;return zX(e,NX({x:i,y:r,width:n.width||0,height:n.height||0}))}),{x:1/0,y:1/0,x2:-1/0,y2:-1/0});return FX(n)},PY=function(e,t){let[n,i,r]=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[0,0,1],s=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=arguments.length>4&&void 0!==arguments[4]&&arguments[4],o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[0,0];const l={x:(t.x-n)/r,y:(t.y-i)/r,width:t.width/r,height:t.height/r},c=[];return e.forEach((e=>{const{width:t,height:n,selectable:i=!0,hidden:r=!1}=e;if(a&&!i||r)return!1;const{positionAbsolute:h}=MY(e,o),u={x:h.x,y:h.y,width:t||0,height:n||0},d=jX(l,u);("undefined"===typeof t||"undefined"===typeof n||null===t||null===n||s&&d>0||d>=(t||0)*(n||0)||e.dragging)&&c.push(e)})),c},DY=(e,t)=>{const n=e.map((e=>e.id));return t.filter((e=>n.includes(e.source)||n.includes(e.target)))},OY=function(e,t,n,i,r){let s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:.1;const a=t/(e.width*(1+s)),o=n/(e.height*(1+s)),l=Math.min(a,o),c=IX(l,i,r);return{x:t/2-(e.x+e.width/2)*c,y:n/2-(e.y+e.height/2)*c,zoom:c}},IY=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e.transition().duration(t)};function RY(e,t,n,i){return(t[n]||[]).reduce(((t,r)=>{var s,a,o,l;"".concat(e.id,"-").concat(r.id,"-").concat(n)!==i&&t.push({id:r.id||null,type:n,nodeId:e.id,x:(null!==(s=null===(a=e.positionAbsolute)||void 0===a?void 0:a.x)&&void 0!==s?s:0)+r.x+r.width/2,y:(null!==(o=null===(l=e.positionAbsolute)||void 0===l?void 0:l.y)&&void 0!==o?o:0)+r.y+r.height/2});return t}),[])}const kY={source:null,target:null,sourceHandle:null,targetHandle:null},LY=()=>({handleDomNode:null,isValid:!1,connection:kY,endHandle:null});function BY(e,t,n,i,r,s,a){const l="target"===r,c=a.querySelector('.react-flow__handle[data-id="'.concat(null===e||void 0===e?void 0:e.nodeId,"-").concat(null===e||void 0===e?void 0:e.id,"-").concat(null===e||void 0===e?void 0:e.type,'"]')),h=o(o({},LY()),{},{handleDomNode:c});if(c){const e=zY(void 0,c),r=c.getAttribute("data-nodeid"),a=c.getAttribute("data-handleid"),o=c.classList.contains("connectable"),u=c.classList.contains("connectableend"),d={source:l?r:n,sourceHandle:l?a:i,target:l?n:r,targetHandle:l?i:a};h.connection=d;o&&u&&(t===eY.Strict?l&&"source"===e||!l&&"target"===e:r!==n||a!==i)&&(h.endHandle={nodeId:r,handleId:a,type:e},h.isValid=s(d))}return h}function zY(e,t){return e||(null!==t&&void 0!==t&&t.classList.contains("target")?"target":null!==t&&void 0!==t&&t.classList.contains("source")?"source":null)}function NY(e){null===e||void 0===e||e.classList.remove("valid","connecting","react-flow__handle-valid","react-flow__handle-connecting")}function FY(e,t){let n=null;return t?n="valid":e&&!t&&(n="invalid"),n}function UY(e){let{event:t,handleId:n,nodeId:i,onConnect:r,isTarget:s,getState:a,setState:o,isValidConnection:l,edgeUpdaterType:c,onReconnectEnd:h}=e;const u=BX(t.target),{connectionMode:d,domNode:p,autoPanOnConnect:f,connectionRadius:m,onConnectStart:g,panBy:v,getNodes:y,cancelConnection:b}=a();let x,w=0;const{x:S,y:_}=YX(t),E=null===u||void 0===u?void 0:u.elementFromPoint(S,_),A=zY(c,E),C=null===p||void 0===p?void 0:p.getBoundingClientRect();if(!C||!A)return;let M,T=YX(t,C),P=!1,D=null,O=!1,I=null;const R=function(e){let{nodes:t,nodeId:n,handleId:i,handleType:r}=e;return t.reduce(((e,t)=>{if(t[GX]){const{handleBounds:s}=t[GX];let a=[],o=[];s&&(a=RY(t,s,"source","".concat(n,"-").concat(i,"-").concat(r)),o=RY(t,s,"target","".concat(n,"-").concat(i,"-").concat(r))),e.push(...a,...o)}return e}),[])}({nodes:y(),nodeId:i,handleId:n,handleType:A}),k=()=>{if(!f)return;const[e,t]=LX(T,C);v({x:e,y:t}),w=requestAnimationFrame(k)};function L(e){const{transform:t}=a();T=YX(e,C);const{handle:r,validHandleResult:c}=function(e,t,n,i,r,s){const{x:a,y:o}=YX(e),l=t.elementsFromPoint(a,o).find((e=>e.classList.contains("react-flow__handle")));if(l){const e=l.getAttribute("data-nodeid");if(e){const t=zY(void 0,l),i=l.getAttribute("data-handleid"),a=s({nodeId:e,id:i,type:t});if(a){const s=r.find((n=>n.nodeId===e&&n.type===t&&n.id===i));return{handle:{id:i,type:t,nodeId:e,x:(null===s||void 0===s?void 0:s.x)||n.x,y:(null===s||void 0===s?void 0:s.y)||n.y},validHandleResult:a}}}}let c=[],h=1/0;if(r.forEach((e=>{const t=Math.sqrt((e.x-n.x)**2+(e.y-n.y)**2);if(t<=i){const n=s(e);t<=h&&(t<h?c=[{handle:e,validHandleResult:n}]:t===h&&c.push({handle:e,validHandleResult:n}),h=t)}})),!c.length)return{handle:null,validHandleResult:LY()};if(1===c.length)return c[0];const u=c.some((e=>{let{validHandleResult:t}=e;return t.isValid})),d=c.some((e=>{let{handle:t}=e;return"target"===t.type}));return c.find((e=>{let{handle:t,validHandleResult:n}=e;return d?"target"===t.type:!u||n.isValid}))||c[0]}(e,u,AY(T,t,!1,[1,1]),m,R,(e=>BY(e,d,i,n,s?"target":"source",l,u)));if(x=r,P||(k(),P=!0),I=c.handleDomNode,D=c.connection,O=c.isValid,o({connectionPosition:x&&O?CY({x:x.x,y:x.y},t):T,connectionStatus:FY(!!x,O),connectionEndHandle:c.endHandle}),!x&&!O&&!I)return NY(M);D.source!==D.target&&I&&(NY(M),M=I,I.classList.add("connecting","react-flow__handle-connecting"),I.classList.toggle("valid",O),I.classList.toggle("react-flow__handle-valid",O))}function B(e){var t,n;(x||I)&&D&&O&&(null===r||void 0===r||r(D)),null===(t=(n=a()).onConnectEnd)||void 0===t||t.call(n,e),c&&(null===h||void 0===h||h(e)),NY(M),b(),cancelAnimationFrame(w),P=!1,O=!1,D=null,I=null,u.removeEventListener("mousemove",L),u.removeEventListener("mouseup",B),u.removeEventListener("touchmove",L),u.removeEventListener("touchend",B)}o({connectionPosition:T,connectionStatus:null,connectionNodeId:i,connectionHandleId:n,connectionHandleType:A,connectionStartHandle:{nodeId:i,handleId:n,type:A},connectionEndHandle:null}),null===g||void 0===g||g(t,{nodeId:i,handleId:n,handleType:A}),u.addEventListener("mousemove",L),u.addEventListener("mouseup",B),u.addEventListener("touchmove",L),u.addEventListener("touchend",B)}const jY=()=>!0,VY=e=>({connectionStartHandle:e.connectionStartHandle,connectOnClick:e.connectOnClick,noPanClassName:e.noPanClassName}),GY=(0,e.forwardRef)(((t,n)=>{let{type:i="source",position:r=sY.Top,isValidConnection:s,isConnectable:a=!0,isConnectableStart:c=!0,isConnectableEnd:h=!0,id:u,onConnect:d,children:p,className:f,onMouseDown:m,onTouchStart:g}=t,v=l(t,uX);const y=u||null,b="target"===i,x=CX(),w=(0,e.useContext)(xY),{connectOnClick:S,noPanClassName:_}=AX(VY,SG),{connecting:E,clickConnecting:A}=AX(((e,t,n)=>i=>{const{connectionStartHandle:r,connectionEndHandle:s,connectionClickStartHandle:a}=i;return{connecting:(null===r||void 0===r?void 0:r.nodeId)===e&&(null===r||void 0===r?void 0:r.handleId)===t&&(null===r||void 0===r?void 0:r.type)===n||(null===s||void 0===s?void 0:s.nodeId)===e&&(null===s||void 0===s?void 0:s.handleId)===t&&(null===s||void 0===s?void 0:s.type)===n,clickConnecting:(null===a||void 0===a?void 0:a.nodeId)===e&&(null===a||void 0===a?void 0:a.handleId)===t&&(null===a||void 0===a?void 0:a.type)===n}})(w,y,i),SG);var C,M;w||(null===(C=(M=x.getState()).onError)||void 0===C||C.call(M,"010",wX()));const T=e=>{const{defaultEdgeOptions:t,onConnect:n,hasDefaultEdges:i}=x.getState(),r=o(o({},t),e);if(i){const{edges:e,setEdges:t}=x.getState();t(EY(r,e))}null===n||void 0===n||n(r),null===d||void 0===d||d(r)},P=e=>{if(!w)return;const t=XX(e);c&&(t&&0===e.button||!t)&&UY({event:e,handleId:y,nodeId:w,onConnect:T,isTarget:b,getState:x.getState,setState:x.setState,isValidConnection:s||x.getState().isValidConnection||jY}),t?null===m||void 0===m||m(e):null===g||void 0===g||g(e)};return e.createElement("div",o({"data-handleid":y,"data-nodeid":w,"data-handlepos":r,"data-id":"".concat(w,"-").concat(y,"-").concat(i),className:pG(["react-flow__handle","react-flow__handle-".concat(r),"nodrag",_,f,{source:!b,target:b,connectable:a,connectablestart:c,connectableend:h,connecting:A,connectionindicator:a&&(c&&!E||h&&E)}]),onMouseDown:P,onTouchStart:P,onClick:S?e=>{const{onClickConnectStart:t,onClickConnectEnd:n,connectionClickStartHandle:r,connectionMode:a,isValidConnection:o}=x.getState();if(!w||!r&&!c)return;if(!r)return null===t||void 0===t||t(e,{nodeId:w,handleId:y,handleType:i}),void x.setState({connectionClickStartHandle:{nodeId:w,type:i,handleId:y}});const l=BX(e.target),h=s||o||jY,{connection:u,isValid:d}=BY({nodeId:w,id:y,type:i},a,r.nodeId,r.handleId||null,r.type,h,l);d&&T(u),null===n||void 0===n||n(e),x.setState({connectionClickStartHandle:null})}:void 0,ref:n},v),p)}));GY.displayName="Handle";var HY=(0,e.memo)(GY);const WY=t=>{let{data:n,isConnectable:i,targetPosition:r=sY.Top,sourcePosition:s=sY.Bottom}=t;return e.createElement(e.Fragment,null,e.createElement(HY,{type:"target",position:r,isConnectable:i}),null===n||void 0===n?void 0:n.label,e.createElement(HY,{type:"source",position:s,isConnectable:i}))};WY.displayName="DefaultNode";var qY=(0,e.memo)(WY);const XY=t=>{let{data:n,isConnectable:i,sourcePosition:r=sY.Bottom}=t;return e.createElement(e.Fragment,null,null===n||void 0===n?void 0:n.label,e.createElement(HY,{type:"source",position:r,isConnectable:i}))};XY.displayName="InputNode";var YY=(0,e.memo)(XY);const QY=t=>{let{data:n,isConnectable:i,targetPosition:r=sY.Top}=t;return e.createElement(e.Fragment,null,e.createElement(HY,{type:"target",position:r,isConnectable:i}),null===n||void 0===n?void 0:n.label)};QY.displayName="OutputNode";var KY=(0,e.memo)(QY);const ZY=()=>null;ZY.displayName="GroupNode";const JY=e=>({selectedNodes:e.getNodes().filter((e=>e.selected)),selectedEdges:e.edges.filter((e=>e.selected)).map((e=>o({},e)))}),$Y=e=>e.id;function eQ(e,t){return SG(e.selectedNodes.map($Y),t.selectedNodes.map($Y))&&SG(e.selectedEdges.map($Y),t.selectedEdges.map($Y))}const tQ=(0,e.memo)((t=>{let{onSelectionChange:n}=t;const i=CX(),{selectedNodes:r,selectedEdges:s}=AX(JY,eQ);return(0,e.useEffect)((()=>{const e={nodes:r,edges:s};null===n||void 0===n||n(e),i.getState().onSelectionChange.forEach((t=>t(e)))}),[r,s,n]),null}));tQ.displayName="SelectionListener";const nQ=e=>!!e.onSelectionChange;function iQ(t){let{onSelectionChange:n}=t;const i=AX(nQ);return n||i?e.createElement(tQ,{onSelectionChange:n}):null}const rQ=e=>({setNodes:e.setNodes,setEdges:e.setEdges,setDefaultNodesAndEdges:e.setDefaultNodesAndEdges,setMinZoom:e.setMinZoom,setMaxZoom:e.setMaxZoom,setTranslateExtent:e.setTranslateExtent,setNodeExtent:e.setNodeExtent,reset:e.reset});function sQ(t,n){(0,e.useEffect)((()=>{"undefined"!==typeof t&&n(t)}),[t])}function aQ(t,n,i){(0,e.useEffect)((()=>{"undefined"!==typeof n&&i({[t]:n})}),[n])}const oQ=t=>{let{nodes:n,edges:i,defaultNodes:r,defaultEdges:s,onConnect:a,onConnectStart:l,onConnectEnd:c,onClickConnectStart:h,onClickConnectEnd:u,nodesDraggable:d,nodesConnectable:p,nodesFocusable:f,edgesFocusable:m,edgesUpdatable:g,elevateNodesOnSelect:v,minZoom:y,maxZoom:b,nodeExtent:x,onNodesChange:w,onEdgesChange:S,elementsSelectable:_,connectionMode:E,snapGrid:A,snapToGrid:C,translateExtent:M,connectOnClick:T,defaultEdgeOptions:P,fitView:D,fitViewOptions:O,onNodesDelete:I,onEdgesDelete:R,onNodeDrag:k,onNodeDragStart:L,onNodeDragStop:B,onSelectionDrag:z,onSelectionDragStart:N,onSelectionDragStop:F,noPanClassName:U,nodeOrigin:j,rfId:V,autoPanOnConnect:G,autoPanOnNodeDrag:H,onError:W,connectionRadius:q,isValidConnection:X,nodeDragThreshold:Y}=t;const{setNodes:Q,setEdges:K,setDefaultNodesAndEdges:Z,setMinZoom:J,setMaxZoom:$,setTranslateExtent:ee,setNodeExtent:te,reset:ne}=AX(rQ,SG),ie=CX();return(0,e.useEffect)((()=>{const e=null===s||void 0===s?void 0:s.map((e=>o(o({},e),P)));return Z(r,e),()=>{ne()}}),[]),aQ("defaultEdgeOptions",P,ie.setState),aQ("connectionMode",E,ie.setState),aQ("onConnect",a,ie.setState),aQ("onConnectStart",l,ie.setState),aQ("onConnectEnd",c,ie.setState),aQ("onClickConnectStart",h,ie.setState),aQ("onClickConnectEnd",u,ie.setState),aQ("nodesDraggable",d,ie.setState),aQ("nodesConnectable",p,ie.setState),aQ("nodesFocusable",f,ie.setState),aQ("edgesFocusable",m,ie.setState),aQ("edgesUpdatable",g,ie.setState),aQ("elementsSelectable",_,ie.setState),aQ("elevateNodesOnSelect",v,ie.setState),aQ("snapToGrid",C,ie.setState),aQ("snapGrid",A,ie.setState),aQ("onNodesChange",w,ie.setState),aQ("onEdgesChange",S,ie.setState),aQ("connectOnClick",T,ie.setState),aQ("fitViewOnInit",D,ie.setState),aQ("fitViewOnInitOptions",O,ie.setState),aQ("onNodesDelete",I,ie.setState),aQ("onEdgesDelete",R,ie.setState),aQ("onNodeDrag",k,ie.setState),aQ("onNodeDragStart",L,ie.setState),aQ("onNodeDragStop",B,ie.setState),aQ("onSelectionDrag",z,ie.setState),aQ("onSelectionDragStart",N,ie.setState),aQ("onSelectionDragStop",F,ie.setState),aQ("noPanClassName",U,ie.setState),aQ("nodeOrigin",j,ie.setState),aQ("rfId",V,ie.setState),aQ("autoPanOnConnect",G,ie.setState),aQ("autoPanOnNodeDrag",H,ie.setState),aQ("onError",W,ie.setState),aQ("connectionRadius",q,ie.setState),aQ("isValidConnection",X,ie.setState),aQ("nodeDragThreshold",Y,ie.setState),sQ(n,Q),sQ(i,K),sQ(y,J),sQ(b,$),sQ(M,ee),sQ(x,te),null},lQ={display:"none"},cQ={position:"absolute",width:1,height:1,margin:-1,border:0,padding:0,overflow:"hidden",clip:"rect(0px, 0px, 0px, 0px)",clipPath:"inset(100%)"},hQ="react-flow__node-desc",uQ="react-flow__edge-desc",dQ=e=>e.ariaLiveMessage;function pQ(t){let{rfId:n}=t;const i=AX(dQ);return e.createElement("div",{id:"".concat("react-flow__aria-live","-").concat(n),"aria-live":"assertive","aria-atomic":"true",style:cQ},i)}function fQ(t){let{rfId:n,disableKeyboardA11y:i}=t;return e.createElement(e.Fragment,null,e.createElement("div",{id:"".concat(hQ,"-").concat(n),style:lQ},"Press enter or space to select a node.",!i&&"You can then use the arrow keys to move the node around."," Press delete to remove it and escape to cancel."," "),e.createElement("div",{id:"".concat(uQ,"-").concat(n),style:lQ},"Press enter or space to select an edge. You can then press delete to remove it or escape to cancel."),!i&&e.createElement(pQ,{rfId:n}))}var mQ=function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{actInsideInputWithModifier:!0};const[i,r]=(0,e.useState)(!1),s=(0,e.useRef)(!1),a=(0,e.useRef)(new Set([])),[o,l]=(0,e.useMemo)((()=>{if(null!==t){const e=(Array.isArray(t)?t:[t]).filter((e=>"string"===typeof e)).map((e=>e.split("+"))),n=e.reduce(((e,t)=>e.concat(...t)),[]);return[e,n]}return[[],[]]}),[t]);return(0,e.useEffect)((()=>{const e="undefined"!==typeof document?document:null,i=(null===n||void 0===n?void 0:n.target)||e;if(null!==t){const e=e=>{s.current=e.ctrlKey||e.metaKey||e.shiftKey;if((!s.current||s.current&&!n.actInsideInputWithModifier)&&qX(e))return!1;const t=vQ(e.code,l);a.current.add(e[t]),gQ(o,a.current,!1)&&(e.preventDefault(),r(!0))},t=e=>{if((!s.current||s.current&&!n.actInsideInputWithModifier)&&qX(e))return!1;const t=vQ(e.code,l);gQ(o,a.current,!0)?(r(!1),a.current.clear()):a.current.delete(e[t]),"Meta"===e.key&&a.current.clear(),s.current=!1},c=()=>{a.current.clear(),r(!1)};return null===i||void 0===i||i.addEventListener("keydown",e),null===i||void 0===i||i.addEventListener("keyup",t),window.addEventListener("blur",c),()=>{null===i||void 0===i||i.removeEventListener("keydown",e),null===i||void 0===i||i.removeEventListener("keyup",t),window.removeEventListener("blur",c)}}}),[t,r]),i};function gQ(e,t,n){return e.filter((e=>n||e.length===t.size)).some((e=>e.every((e=>t.has(e)))))}function vQ(e,t){return t.includes(e)?"code":"key"}function yQ(e,t,n,i){var r,s,a,o,l,c,h,u;const d=e.parentNode||e.parentId;if(!d)return n;const p=t.get(d),f=MY(p,i);return yQ(p,t,{x:(null!==(r=n.x)&&void 0!==r?r:0)+f.x,y:(null!==(s=n.y)&&void 0!==s?s:0)+f.y,z:(null!==(a=null===(o=p[GX])||void 0===o?void 0:o.z)&&void 0!==a?a:0)>(null!==(l=n.z)&&void 0!==l?l:0)?null!==(c=null===(h=p[GX])||void 0===h?void 0:h.z)&&void 0!==c?c:0:null!==(u=n.z)&&void 0!==u?u:0},i)}function bQ(e,t,n){e.forEach((i=>{const r=i.parentNode||i.parentId;if(r&&!e.has(r))throw new Error("Parent node ".concat(r," not found"));if(r||null!==n&&void 0!==n&&n[i.id]){var s,a;const{x:r,y:l,z:c}=yQ(i,e,o(o({},i.position),{},{z:null!==(s=null===(a=i[GX])||void 0===a?void 0:a.z)&&void 0!==s?s:0}),t);i.positionAbsolute={x:r,y:l},i[GX].z=c,null!==n&&void 0!==n&&n[i.id]&&(i[GX].isParent=!0)}}))}function xQ(e,t,n,i){const r=new Map,s={},a=i?1e3:0;return e.forEach((e=>{var n;const i=(VX(e.zIndex)?e.zIndex:0)+(e.selected?a:0),l=t.get(e.id),c=o(o({},e),{},{positionAbsolute:{x:e.position.x,y:e.position.y}}),h=e.parentNode||e.parentId;h&&(s[h]=!0);const u=(null===l||void 0===l?void 0:l.type)&&(null===l||void 0===l?void 0:l.type)!==e.type;Object.defineProperty(c,GX,{enumerable:!1,value:{handleBounds:u||null===l||void 0===l||null===(n=l[GX])||void 0===n?void 0:n.handleBounds,z:i}}),r.set(e.id,c)})),bQ(r,n,s),r}function wQ(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{getNodes:n,width:i,height:r,minZoom:s,maxZoom:a,d3Zoom:o,d3Selection:l,fitViewOnInitDone:c,fitViewOnInit:h,nodeOrigin:u}=e(),d=t.initial&&!c&&h;if(o&&l&&(d||!t.initial)){const e=n().filter((e=>{var n;const i=t.includeHiddenNodes?e.width&&e.height:!e.hidden;return null!==(n=t.nodes)&&void 0!==n&&n.length?i&&t.nodes.some((t=>t.id===e.id)):i})),c=e.every((e=>e.width&&e.height));if(e.length>0&&c){var p,f,m;const n=TY(e,u),{x:c,y:h,zoom:d}=OY(n,i,r,null!==(p=t.minZoom)&&void 0!==p?p:s,null!==(f=t.maxZoom)&&void 0!==f?f:a,null!==(m=t.padding)&&void 0!==m?m:.1),g=Yq.translate(c,h).scale(d);return"number"===typeof t.duration&&t.duration>0?o.transform(IY(l,t.duration),g):o.transform(l,g),!0}}return!1}function SQ(e,t){return e.forEach((e=>{const n=t.get(e.id);n&&t.set(n.id,o(o({},n),{},{[GX]:n[GX],selected:e.selected}))})),new Map(t)}function _Q(e,t){return t.map((t=>{const n=e.find((e=>e.id===t.id));return n&&(t.selected=n.selected),t}))}function EQ(e){let{changedNodes:t,changedEdges:n,get:i,set:r}=e;const{nodeInternals:s,edges:a,onNodesChange:o,onEdgesChange:l,hasDefaultNodes:c,hasDefaultEdges:h}=i();null!==t&&void 0!==t&&t.length&&(c&&r({nodeInternals:SQ(t,s)}),null===o||void 0===o||o(t)),null!==n&&void 0!==n&&n.length&&(h&&r({edges:_Q(n,a)}),null===l||void 0===l||l(n))}const AQ=()=>{},CQ={zoomIn:AQ,zoomOut:AQ,zoomTo:AQ,getZoom:()=>1,setViewport:AQ,getViewport:()=>({x:0,y:0,zoom:1}),fitView:()=>!1,setCenter:AQ,fitBounds:AQ,project:e=>e,screenToFlowPosition:e=>e,flowToScreenPosition:e=>e,viewportInitialized:!1},MQ=e=>({d3Zoom:e.d3Zoom,d3Selection:e.d3Selection});function TQ(){const t=(()=>{const t=CX(),{d3Zoom:n,d3Selection:i}=AX(MQ,SG),r=(0,e.useMemo)((()=>i&&n?{zoomIn:e=>n.scaleBy(IY(i,null===e||void 0===e?void 0:e.duration),1.2),zoomOut:e=>n.scaleBy(IY(i,null===e||void 0===e?void 0:e.duration),1/1.2),zoomTo:(e,t)=>n.scaleTo(IY(i,null===t||void 0===t?void 0:t.duration),e),getZoom:()=>t.getState().transform[2],setViewport:(e,r)=>{var s,a,o;const[l,c,h]=t.getState().transform,u=Yq.translate(null!==(s=e.x)&&void 0!==s?s:l,null!==(a=e.y)&&void 0!==a?a:c).scale(null!==(o=e.zoom)&&void 0!==o?o:h);n.transform(IY(i,null===r||void 0===r?void 0:r.duration),u)},getViewport:()=>{const[e,n,i]=t.getState().transform;return{x:e,y:n,zoom:i}},fitView:e=>wQ(t.getState,e),setCenter:(e,r,s)=>{const{width:a,height:o,maxZoom:l}=t.getState(),c="undefined"!==typeof(null===s||void 0===s?void 0:s.zoom)?s.zoom:l,h=a/2-e*c,u=o/2-r*c,d=Yq.translate(h,u).scale(c);n.transform(IY(i,null===s||void 0===s?void 0:s.duration),d)},fitBounds:(e,r)=>{var s;const{width:a,height:o,minZoom:l,maxZoom:c}=t.getState(),{x:h,y:u,zoom:d}=OY(e,a,o,l,c,null!==(s=null===r||void 0===r?void 0:r.padding)&&void 0!==s?s:.1),p=Yq.translate(h,u).scale(d);n.transform(IY(i,null===r||void 0===r?void 0:r.duration),p)},project:e=>{const{transform:n,snapToGrid:i,snapGrid:r}=t.getState();return console.warn("[DEPRECATED] `project` is deprecated. Instead use `screenToFlowPosition`. There is no need to subtract the react flow bounds anymore! https://reactflow.dev/api-reference/types/react-flow-instance#screen-to-flow-position"),AY(e,n,i,r)},screenToFlowPosition:e=>{const{transform:n,snapToGrid:i,snapGrid:r,domNode:s}=t.getState();if(!s)return e;const{x:a,y:o}=s.getBoundingClientRect(),l={x:e.x-a,y:e.y-o};return AY(l,n,i,r)},flowToScreenPosition:e=>{const{transform:n,domNode:i}=t.getState();if(!i)return e;const{x:r,y:s}=i.getBoundingClientRect(),a=CY(e,n);return{x:a.x+r,y:a.y+s}},viewportInitialized:!0}:CQ),[n,i]);return r})(),n=CX(),i=(0,e.useCallback)((()=>n.getState().getNodes().map((e=>o({},e)))),[]),r=(0,e.useCallback)((e=>n.getState().nodeInternals.get(e)),[]),s=(0,e.useCallback)((()=>{const{edges:e=[]}=n.getState();return e.map((e=>o({},e)))}),[]),a=(0,e.useCallback)((e=>{const{edges:t=[]}=n.getState();return t.find((t=>t.id===e))}),[]),l=(0,e.useCallback)((e=>{const{getNodes:t,setNodes:i,hasDefaultNodes:r,onNodesChange:s}=n.getState(),a=t(),o="function"===typeof e?e(a):e;if(r)i(o);else if(s){const e=0===o.length?a.map((e=>({type:"remove",id:e.id}))):o.map((e=>({item:e,type:"reset"})));s(e)}}),[]),c=(0,e.useCallback)((e=>{const{edges:t=[],setEdges:i,hasDefaultEdges:r,onEdgesChange:s}=n.getState(),a="function"===typeof e?e(t):e;if(r)i(a);else if(s){s(0===a.length?t.map((e=>({type:"remove",id:e.id}))):a.map((e=>({item:e,type:"reset"}))))}}),[]),h=(0,e.useCallback)((e=>{const t=Array.isArray(e)?e:[e],{getNodes:i,setNodes:r,hasDefaultNodes:s,onNodesChange:a}=n.getState();if(s){r([...i(),...t])}else if(a){const e=t.map((e=>({item:e,type:"add"})));a(e)}}),[]),u=(0,e.useCallback)((e=>{const t=Array.isArray(e)?e:[e],{edges:i=[],setEdges:r,hasDefaultEdges:s,onEdgesChange:a}=n.getState();if(s)r([...i,...t]);else if(a){a(t.map((e=>({item:e,type:"add"}))))}}),[]),d=(0,e.useCallback)((()=>{const{getNodes:e,edges:t=[],transform:i}=n.getState(),[r,s,a]=i;return{nodes:e().map((e=>o({},e))),edges:t.map((e=>o({},e))),viewport:{x:r,y:s,zoom:a}}}),[]),p=(0,e.useCallback)((e=>{let{nodes:t,edges:i}=e;const{nodeInternals:r,getNodes:s,edges:a,hasDefaultNodes:o,hasDefaultEdges:l,onNodesDelete:c,onEdgesDelete:h,onNodesChange:u,onEdgesChange:d}=n.getState(),p=(t||[]).map((e=>e.id)),f=(i||[]).map((e=>e.id)),m=s().reduce(((e,t)=>{const n=t.parentNode||t.parentId,i=!p.includes(t.id)&&n&&e.find((e=>e.id===n));return("boolean"!==typeof t.deletable||t.deletable)&&(p.includes(t.id)||i)&&e.push(t),e}),[]),g=a.filter((e=>"boolean"!==typeof e.deletable||e.deletable)),v=g.filter((e=>f.includes(e.id)));if(m||v){const e=DY(m,g),t=[...v,...e],i=t.reduce(((e,t)=>(e.includes(t.id)||e.push(t.id),e)),[]);if((l||o)&&(l&&n.setState({edges:a.filter((e=>!i.includes(e.id)))}),o&&(m.forEach((e=>{r.delete(e.id)})),n.setState({nodeInternals:new Map(r)}))),i.length>0&&(null===h||void 0===h||h(t),d&&d(i.map((e=>({id:e,type:"remove"}))))),m.length>0&&(null===c||void 0===c||c(m),u)){const e=m.map((e=>({id:e.id,type:"remove"})));u(e)}}}),[]),f=(0,e.useCallback)((e=>{const t=VX((i=e).width)&&VX(i.height)&&VX(i.x)&&VX(i.y);var i;const r=t?null:n.getState().nodeInternals.get(e.id);if(!t&&!r)return[null,null,t];return[t?e:UX(r),r,t]}),[]),m=(0,e.useCallback)((function(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=arguments.length>2?arguments[2]:void 0;const[r,s,a]=f(e);return r?(i||n.getState().getNodes()).filter((e=>{if(!a&&(e.id===s.id||!e.positionAbsolute))return!1;const n=UX(e),i=jX(n,r);return t&&i>0||i>=r.width*r.height})):[]}),[]),g=(0,e.useCallback)((function(e,t){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const[i]=f(e);if(!i)return!1;const r=jX(i,t);return n&&r>0||r>=i.width*i.height}),[]);return(0,e.useMemo)((()=>o(o({},t),{},{getNodes:i,getNode:r,getEdges:s,getEdge:a,setNodes:l,setEdges:c,addNodes:h,addEdges:u,toObject:d,deleteElements:p,getIntersectingNodes:m,isNodeIntersecting:g})),[t,i,r,s,a,l,c,h,u,d,p,m,g])}const PQ={actInsideInputWithModifier:!1};const DQ={position:"absolute",width:"100%",height:"100%",top:0,left:0},OQ=e=>({x:e.x,y:e.y,zoom:e.k}),IQ=(e,t)=>e.target.closest(".".concat(t)),RQ=(e,t)=>2===t&&Array.isArray(e)&&e.includes(2),kQ=e=>{const t=e.ctrlKey&&QX()?10:1;return-e.deltaY*(1===e.deltaMode?.05:e.deltaMode?1:.002)*t},LQ=e=>({d3Zoom:e.d3Zoom,d3Selection:e.d3Selection,d3ZoomHandler:e.d3ZoomHandler,userSelectionActive:e.userSelectionActive}),BQ=t=>{let{onMove:n,onMoveStart:i,onMoveEnd:r,onPaneContextMenu:s,zoomOnScroll:a=!0,zoomOnPinch:o=!0,panOnScroll:l=!1,panOnScrollSpeed:c=.5,panOnScrollMode:h=tY.Free,zoomOnDoubleClick:u=!0,elementsSelectable:d,panOnDrag:p=!0,defaultViewport:f,translateExtent:m,minZoom:g,maxZoom:v,zoomActivationKeyCode:y,preventScrolling:b=!0,children:x,noWheelClassName:w,noPanClassName:S}=t;const _=(0,e.useRef)(),E=CX(),A=(0,e.useRef)(!1),C=(0,e.useRef)(!1),M=(0,e.useRef)(null),T=(0,e.useRef)({x:0,y:0,zoom:0}),{d3Zoom:P,d3Selection:D,d3ZoomHandler:O,userSelectionActive:I}=AX(LQ,SG),R=mQ(y),k=(0,e.useRef)(0),L=(0,e.useRef)(!1),B=(0,e.useRef)();return function(t){const n=CX();(0,e.useEffect)((()=>{let e;const i=()=>{if(!t.current)return;const e=OX(t.current);var i,r;0!==e.height&&0!==e.width||null===(i=(r=n.getState()).onError)||void 0===i||i.call(r,"004",gX()),n.setState({width:e.width||500,height:e.height||500})};return i(),window.addEventListener("resize",i),t.current&&(e=new ResizeObserver((()=>i())),e.observe(t.current)),()=>{window.removeEventListener("resize",i),e&&t.current&&e.unobserve(t.current)}}),[])}(M),(0,e.useEffect)((()=>{if(M.current){const e=M.current.getBoundingClientRect(),t=function(){var e,t,n,i=Zq,r=Jq,s=nX,a=eX,o=tX,l=[0,1/0],c=[[-1/0,-1/0],[1/0,1/0]],h=250,u=KH,d=TG("start","zoom","end"),p=0,f=10;function m(e){e.property("__zoom",$q).on("wheel.zoom",S,{passive:!1}).on("mousedown.zoom",_).on("dblclick.zoom",E).filter(o).on("touchstart.zoom",A).on("touchmove.zoom",C).on("touchend.zoom touchcancel.zoom",M).style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function g(e,t){return(t=Math.max(l[0],Math.min(l[1],t)))===e.k?e:new Xq(t,e.x,e.y)}function v(e,t,n){var i=t[0]-n[0]*e.k,r=t[1]-n[1]*e.k;return i===e.x&&r===e.y?e:new Xq(e.k,i,r)}function y(e){return[(+e[0][0]+ +e[1][0])/2,(+e[0][1]+ +e[1][1])/2]}function b(e,t,n,i){e.on("start.zoom",(function(){x(this,arguments).event(i).start()})).on("interrupt.zoom end.zoom",(function(){x(this,arguments).event(i).end()})).tween("zoom",(function(){var e=this,s=arguments,a=x(e,s).event(i),o=r.apply(e,s),l=null==n?y(o):"function"===typeof n?n.apply(e,s):n,c=Math.max(o[1][0]-o[0][0],o[1][1]-o[0][1]),h=e.__zoom,d="function"===typeof t?t.apply(e,s):t,p=u(h.invert(l).concat(c/h.k),d.invert(l).concat(c/d.k));return function(e){if(1===e)e=d;else{var t=p(e),n=c/t[2];e=new Xq(n,l[0]-t[0]*n,l[1]-t[1]*n)}a.zoom(null,e)}}))}function x(e,t,n){return!n&&e.__zooming||new w(e,t)}function w(e,t){this.that=e,this.args=t,this.active=0,this.sourceEvent=null,this.extent=r.apply(e,t),this.taps=0}function S(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];if(i.apply(this,arguments)){var o=x(this,n).event(e),h=this.__zoom,u=Math.max(l[0],Math.min(l[1],h.k*Math.pow(2,a.apply(this,arguments)))),d=ZH(e);if(o.wheel)o.mouse[0][0]===d[0]&&o.mouse[0][1]===d[1]||(o.mouse[1]=h.invert(o.mouse[0]=d)),clearTimeout(o.wheel);else{if(h.k===u)return;o.mouse=[d,h.invert(d)],SW(this),o.start()}Kq(e),o.wheel=setTimeout((function(){o.wheel=null,o.end()}),150),o.zoom("mouse",s(v(g(h,u),o.mouse[0],o.mouse[1]),o.extent,c))}}function _(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),a=1;a<t;a++)r[a-1]=arguments[a];if(!n&&i.apply(this,arguments)){var o=e.currentTarget,l=x(this,r,!0).event(e),h=VH(e.view).on("mousemove.zoom",(function(e){if(Kq(e),!l.moved){var t=e.clientX-d,n=e.clientY-f;l.moved=t*t+n*n>p}l.event(e).zoom("mouse",s(v(l.that.__zoom,l.mouse[0]=ZH(e,o),l.mouse[1]),l.extent,c))}),!0).on("mouseup.zoom",(function(e){h.on("mousemove.zoom mouseup.zoom",null),YH(e.view,l.moved),Kq(e),l.event(e).end()}),!0),u=ZH(e,o),d=e.clientX,f=e.clientY;XH(e.view),Qq(e),l.mouse=[u,this.__zoom.invert(u)],SW(this),l.start()}}function E(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),a=1;a<t;a++)n[a-1]=arguments[a];if(i.apply(this,arguments)){var o=this.__zoom,l=ZH(e.changedTouches?e.changedTouches[0]:e,this),u=o.invert(l),d=o.k*(e.shiftKey?.5:2),p=s(v(g(o,d),l,u),r.apply(this,n),c);Kq(e),h>0?VH(this).transition().duration(h).call(b,p,l,e):VH(this).call(m.transform,p,l,e)}}function A(n){for(var r=arguments.length,s=new Array(r>1?r-1:0),a=1;a<r;a++)s[a-1]=arguments[a];if(i.apply(this,arguments)){var o,l,c,h,u=n.touches,d=u.length,p=x(this,s,n.changedTouches.length===d).event(n);for(Qq(n),l=0;l<d;++l)h=[h=ZH(c=u[l],this),this.__zoom.invert(h),c.identifier],p.touch0?p.touch1||p.touch0[2]===h[2]||(p.touch1=h,p.taps=0):(p.touch0=h,o=!0,p.taps=1+!!e);e&&(e=clearTimeout(e)),o&&(p.taps<2&&(t=h[0],e=setTimeout((function(){e=null}),500)),SW(this),p.start())}}function C(e){if(this.__zooming){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];var r,a,o,l,h=x(this,n).event(e),u=e.changedTouches,d=u.length;for(Kq(e),r=0;r<d;++r)o=ZH(a=u[r],this),h.touch0&&h.touch0[2]===a.identifier?h.touch0[0]=o:h.touch1&&h.touch1[2]===a.identifier&&(h.touch1[0]=o);if(a=h.that.__zoom,h.touch1){var p=h.touch0[0],f=h.touch0[1],m=h.touch1[0],y=h.touch1[1],b=(b=m[0]-p[0])*b+(b=m[1]-p[1])*b,w=(w=y[0]-f[0])*w+(w=y[1]-f[1])*w;a=g(a,Math.sqrt(b/w)),o=[(p[0]+m[0])/2,(p[1]+m[1])/2],l=[(f[0]+y[0])/2,(f[1]+y[1])/2]}else{if(!h.touch0)return;o=h.touch0[0],l=h.touch0[1]}h.zoom("touch",s(v(a,o,l),h.extent,c))}}function M(e){for(var i=arguments.length,r=new Array(i>1?i-1:0),s=1;s<i;s++)r[s-1]=arguments[s];if(this.__zooming){var a,o,l=x(this,r).event(e),c=e.changedTouches,h=c.length;for(Qq(e),n&&clearTimeout(n),n=setTimeout((function(){n=null}),500),a=0;a<h;++a)o=c[a],l.touch0&&l.touch0[2]===o.identifier?delete l.touch0:l.touch1&&l.touch1[2]===o.identifier&&delete l.touch1;if(l.touch1&&!l.touch0&&(l.touch0=l.touch1,delete l.touch1),l.touch0)l.touch0[1]=this.__zoom.invert(l.touch0[0]);else if(l.end(),2===l.taps&&(o=ZH(o,this),Math.hypot(t[0]-o[0],t[1]-o[1])<f)){var u=VH(this).on("dblclick.zoom");u&&u.apply(this,arguments)}}}return m.transform=function(e,t,n,i){var r=e.selection?e.selection():e;r.property("__zoom",$q),e!==r?b(e,t,n,i):r.interrupt().each((function(){x(this,arguments).event(i).start().zoom(null,"function"===typeof t?t.apply(this,arguments):t).end()}))},m.scaleBy=function(e,t,n,i){m.scaleTo(e,(function(){return this.__zoom.k*("function"===typeof t?t.apply(this,arguments):t)}),n,i)},m.scaleTo=function(e,t,n,i){m.transform(e,(function(){var e=r.apply(this,arguments),i=this.__zoom,a=null==n?y(e):"function"===typeof n?n.apply(this,arguments):n,o=i.invert(a),l="function"===typeof t?t.apply(this,arguments):t;return s(v(g(i,l),a,o),e,c)}),n,i)},m.translateBy=function(e,t,n,i){m.transform(e,(function(){return s(this.__zoom.translate("function"===typeof t?t.apply(this,arguments):t,"function"===typeof n?n.apply(this,arguments):n),r.apply(this,arguments),c)}),null,i)},m.translateTo=function(e,t,n,i,a){m.transform(e,(function(){var e=r.apply(this,arguments),a=this.__zoom,o=null==i?y(e):"function"===typeof i?i.apply(this,arguments):i;return s(Yq.translate(o[0],o[1]).scale(a.k).translate("function"===typeof t?-t.apply(this,arguments):-t,"function"===typeof n?-n.apply(this,arguments):-n),e,c)}),i,a)},w.prototype={event:function(e){return e&&(this.sourceEvent=e),this},start:function(){return 1===++this.active&&(this.that.__zooming=this,this.emit("start")),this},zoom:function(e,t){return this.mouse&&"mouse"!==e&&(this.mouse[1]=t.invert(this.mouse[0])),this.touch0&&"touch"!==e&&(this.touch0[1]=t.invert(this.touch0[0])),this.touch1&&"touch"!==e&&(this.touch1[1]=t.invert(this.touch1[0])),this.that.__zoom=t,this.emit("zoom"),this},end:function(){return 0===--this.active&&(delete this.that.__zooming,this.emit("end")),this},emit:function(e){var t=VH(this.that).datum();d.call(e,this.that,new qq(e,{sourceEvent:this.sourceEvent,target:m,type:e,transform:this.that.__zoom,dispatch:d}),t)}},m.wheelDelta=function(e){return arguments.length?(a="function"===typeof e?e:Wq(+e),m):a},m.filter=function(e){return arguments.length?(i="function"===typeof e?e:Wq(!!e),m):i},m.touchable=function(e){return arguments.length?(o="function"===typeof e?e:Wq(!!e),m):o},m.extent=function(e){return arguments.length?(r="function"===typeof e?e:Wq([[+e[0][0],+e[0][1]],[+e[1][0],+e[1][1]]]),m):r},m.scaleExtent=function(e){return arguments.length?(l[0]=+e[0],l[1]=+e[1],m):[l[0],l[1]]},m.translateExtent=function(e){return arguments.length?(c[0][0]=+e[0][0],c[1][0]=+e[1][0],c[0][1]=+e[0][1],c[1][1]=+e[1][1],m):[[c[0][0],c[0][1]],[c[1][0],c[1][1]]]},m.constrain=function(e){return arguments.length?(s=e,m):s},m.duration=function(e){return arguments.length?(h=+e,m):h},m.interpolate=function(e){return arguments.length?(u=e,m):u},m.on=function(){var e=d.on.apply(d,arguments);return e===d?m:e},m.clickDistance=function(e){return arguments.length?(p=(e=+e)*e,m):Math.sqrt(p)},m.tapDistance=function(e){return arguments.length?(f=+e,m):f},m}().scaleExtent([g,v]).translateExtent(m),n=VH(M.current).call(t),i=Yq.translate(f.x,f.y).scale(IX(f.zoom,g,v)),r=[[0,0],[e.width,e.height]],s=t.constrain()(i,r,m);t.transform(n,s),t.wheelDelta(kQ),E.setState({d3Zoom:t,d3Selection:n,d3ZoomHandler:n.on("wheel.zoom"),transform:[s.x,s.y,s.k],domNode:M.current.closest(".react-flow")})}}),[]),(0,e.useEffect)((()=>{D&&P&&(!l||R||I?"undefined"!==typeof O&&D.on("wheel.zoom",(function(e,t){if(!b&&"wheel"===e.type&&!e.ctrlKey||IQ(e,w))return null;e.preventDefault(),O.call(this,e,t)}),{passive:!1}):D.on("wheel.zoom",(e=>{if(IQ(e,w))return!1;e.preventDefault(),e.stopImmediatePropagation();const t=D.property("__zoom").k||1;if(e.ctrlKey&&o){const n=ZH(e),i=kQ(e),r=t*Math.pow(2,i);return void P.scaleTo(D,r,n,e)}const s=1===e.deltaMode?20:1;let a=h===tY.Vertical?0:e.deltaX*s,l=h===tY.Horizontal?0:e.deltaY*s;!QX()&&e.shiftKey&&h!==tY.Vertical&&(a=e.deltaY*s,l=0),P.translateBy(D,-a/t*c,-l/t*c,{internal:!0});const u=OQ(D.property("__zoom")),{onViewportChangeStart:d,onViewportChange:p,onViewportChangeEnd:f}=E.getState();clearTimeout(B.current),L.current||(L.current=!0,null===i||void 0===i||i(e,u),null===d||void 0===d||d(u)),L.current&&(null===n||void 0===n||n(e,u),null===p||void 0===p||p(u),B.current=setTimeout((()=>{null===r||void 0===r||r(e,u),null===f||void 0===f||f(u),L.current=!1}),150))}),{passive:!1}))}),[I,l,h,D,P,O,R,o,b,w,i,n,r]),(0,e.useEffect)((()=>{P&&P.on("start",(e=>{var t,n;if(!e.sourceEvent||e.sourceEvent.internal)return null;k.current=null===(t=e.sourceEvent)||void 0===t?void 0:t.button;const{onViewportChangeStart:r}=E.getState(),s=OQ(e.transform);A.current=!0,T.current=s,"mousedown"===(null===(n=e.sourceEvent)||void 0===n?void 0:n.type)&&E.setState({paneDragging:!0}),null===r||void 0===r||r(s),null===i||void 0===i||i(e.sourceEvent,s)}))}),[P,i]),(0,e.useEffect)((()=>{P&&(I&&!A.current?P.on("zoom",null):I||P.on("zoom",(e=>{var t,i;const{onViewportChange:r}=E.getState();if(E.setState({transform:[e.transform.x,e.transform.y,e.transform.k]}),C.current=!(!s||!RQ(p,null!==(t=k.current)&&void 0!==t?t:0)),(n||r)&&(null===(i=e.sourceEvent)||void 0===i||!i.internal)){const t=OQ(e.transform);null===r||void 0===r||r(t),null===n||void 0===n||n(e.sourceEvent,t)}})))}),[I,P,n,p,s]),(0,e.useEffect)((()=>{P&&P.on("end",(e=>{var t;if(!e.sourceEvent||e.sourceEvent.internal)return null;const{onViewportChangeEnd:n}=E.getState();if(A.current=!1,E.setState({paneDragging:!1}),s&&RQ(p,null!==(t=k.current)&&void 0!==t?t:0)&&!C.current&&s(e.sourceEvent),C.current=!1,(r||n)&&(i=T.current,a=e.transform,i.x!==a.x||i.y!==a.y||i.zoom!==a.k)){const t=OQ(e.transform);T.current=t,clearTimeout(_.current),_.current=setTimeout((()=>{null===n||void 0===n||n(t),null===r||void 0===r||r(e.sourceEvent,t)}),l?150:0)}var i,a}))}),[P,l,p,r,s]),(0,e.useEffect)((()=>{P&&P.filter((e=>{const t=R||a,n=o&&e.ctrlKey;if((!0===p||Array.isArray(p)&&p.includes(1))&&1===e.button&&"mousedown"===e.type&&(IQ(e,"react-flow__node")||IQ(e,"react-flow__edge")))return!0;if(!p&&!t&&!l&&!u&&!o)return!1;if(I)return!1;if(!u&&"dblclick"===e.type)return!1;if(IQ(e,w)&&"wheel"===e.type)return!1;if(IQ(e,S)&&("wheel"!==e.type||l&&"wheel"===e.type&&!R))return!1;if(!o&&e.ctrlKey&&"wheel"===e.type)return!1;if(!t&&!l&&!n&&"wheel"===e.type)return!1;if(!p&&("mousedown"===e.type||"touchstart"===e.type))return!1;if(Array.isArray(p)&&!p.includes(e.button)&&"mousedown"===e.type)return!1;const i=Array.isArray(p)&&p.includes(e.button)||!e.button||e.button<=1;return(!e.ctrlKey||"wheel"===e.type)&&i}))}),[I,P,a,o,l,u,p,d,R]),e.createElement("div",{className:"react-flow__renderer",ref:M,style:DQ},x)},zQ=e=>({userSelectionActive:e.userSelectionActive,userSelectionRect:e.userSelectionRect});function NQ(){const{userSelectionActive:t,userSelectionRect:n}=AX(zQ,SG);return t&&n?e.createElement("div",{className:"react-flow__selection react-flow__container",style:{width:n.width,height:n.height,transform:"translate(".concat(n.x,"px, ").concat(n.y,"px)")}}):null}function FQ(e,t){const n=t.parentNode||t.parentId,i=e.find((e=>e.id===n));if(i){const e=t.position.x+t.width-i.width,n=t.position.y+t.height-i.height;if(e>0||n>0||t.position.x<0||t.position.y<0){var r,s;if(i.style=o({},i.style)||{},i.style.width=null!==(r=i.style.width)&&void 0!==r?r:i.width,i.style.height=null!==(s=i.style.height)&&void 0!==s?s:i.height,e>0&&(i.style.width+=e),n>0&&(i.style.height+=n),t.position.x<0){const e=Math.abs(t.position.x);i.position.x=i.position.x-e,i.style.width+=e,t.position.x=0}if(t.position.y<0){const e=Math.abs(t.position.y);i.position.y=i.position.y-e,i.style.height+=e,t.position.y=0}i.width=i.style.width,i.height=i.style.height}}}function UQ(e,t){if(e.some((e=>"reset"===e.type)))return e.filter((e=>"reset"===e.type)).map((e=>e.item));const n=e.filter((e=>"add"===e.type)).map((e=>e.item));return t.reduce(((t,n)=>{const i=e.filter((e=>e.id===n.id));if(0===i.length)return t.push(n),t;const r=o({},n);for(const e of i)if(e)switch(e.type){case"select":r.selected=e.selected;break;case"position":"undefined"!==typeof e.position&&(r.position=e.position),"undefined"!==typeof e.positionAbsolute&&(r.positionAbsolute=e.positionAbsolute),"undefined"!==typeof e.dragging&&(r.dragging=e.dragging),r.expandParent&&FQ(t,r);break;case"dimensions":"undefined"!==typeof e.dimensions&&(r.width=e.dimensions.width,r.height=e.dimensions.height),"undefined"!==typeof e.updateStyle&&(r.style=o(o({},r.style||{}),e.dimensions)),"boolean"===typeof e.resizing&&(r.resizing=e.resizing),r.expandParent&&FQ(t,r);break;case"remove":return t}return t.push(r),t}),n)}function jQ(e,t){return UQ(e,t)}const VQ=(e,t)=>({id:e,type:"select",selected:t});function GQ(e,t){return e.reduce(((e,n)=>{const i=t.includes(n.id);return!n.selected&&i?(n.selected=!0,e.push(VQ(n.id,!0))):n.selected&&!i&&(n.selected=!1,e.push(VQ(n.id,!1))),e}),[])}const HQ=(e,t)=>n=>{n.target===t.current&&(null===e||void 0===e||e(n))},WQ=e=>({userSelectionActive:e.userSelectionActive,elementsSelectable:e.elementsSelectable,dragging:e.paneDragging}),qQ=(0,e.memo)((t=>{let{isSelecting:n,selectionMode:i=nY.Full,panOnDrag:r,onSelectionStart:s,onSelectionEnd:a,onPaneClick:l,onPaneContextMenu:c,onPaneScroll:h,onPaneMouseEnter:u,onPaneMouseMove:d,onPaneMouseLeave:p,children:f}=t;const m=(0,e.useRef)(null),g=CX(),v=(0,e.useRef)(0),y=(0,e.useRef)(0),b=(0,e.useRef)(),{userSelectionActive:x,elementsSelectable:w,dragging:S}=AX(WQ,SG),_=()=>{g.setState({userSelectionActive:!1,userSelectionRect:null}),v.current=0,y.current=0},E=e=>{null===l||void 0===l||l(e),g.getState().resetSelectedElements(),g.setState({nodesSelectionActive:!1})},A=h?e=>h(e):void 0,C=w&&(n||x);return e.createElement("div",{className:pG(["react-flow__pane",{dragging:S,selection:n}]),onClick:C?void 0:HQ(E,m),onContextMenu:HQ((e=>{Array.isArray(r)&&null!==r&&void 0!==r&&r.includes(2)?e.preventDefault():null===c||void 0===c||c(e)}),m),onWheel:HQ(A,m),onMouseEnter:C?void 0:u,onMouseDown:C?e=>{const{resetSelectedElements:t,domNode:i}=g.getState();if(b.current=null===i||void 0===i?void 0:i.getBoundingClientRect(),!w||!n||0!==e.button||e.target!==m.current||!b.current)return;const{x:r,y:a}=YX(e,b.current);t(),g.setState({userSelectionRect:{width:0,height:0,startX:r,startY:a,x:r,y:a}}),null===s||void 0===s||s(e)}:void 0,onMouseMove:C?e=>{var t,r;const{userSelectionRect:s,nodeInternals:a,edges:l,transform:c,onNodesChange:h,onEdgesChange:u,nodeOrigin:d,getNodes:p}=g.getState();if(!n||!b.current||!s)return;g.setState({userSelectionActive:!0,nodesSelectionActive:!1});const f=YX(e,b.current),m=null!==(t=s.startX)&&void 0!==t?t:0,x=null!==(r=s.startY)&&void 0!==r?r:0,w=o(o({},s),{},{x:f.x<m?f.x:m,y:f.y<x?f.y:x,width:Math.abs(f.x-m),height:Math.abs(f.y-x)}),S=p(),_=PY(a,w,c,i===nY.Partial,!0,d),E=DY(_,l).map((e=>e.id)),A=_.map((e=>e.id));if(v.current!==A.length){v.current=A.length;const e=GQ(S,A);e.length&&(null===h||void 0===h||h(e))}if(y.current!==E.length){y.current=E.length;const e=GQ(l,E);e.length&&(null===u||void 0===u||u(e))}g.setState({userSelectionRect:w})}:d,onMouseUp:C?e=>{if(0!==e.button)return;const{userSelectionRect:t}=g.getState();!x&&t&&e.target===m.current&&(null===E||void 0===E||E(e)),g.setState({nodesSelectionActive:v.current>0}),_(),null===a||void 0===a||a(e)}:void 0,onMouseLeave:C?e=>{x&&(g.setState({nodesSelectionActive:v.current>0}),null===a||void 0===a||a(e)),_()}:p,ref:m,style:DQ},f,e.createElement(NQ,null))}));function XQ(e,t){const n=e.parentNode||e.parentId;if(!n)return!1;const i=t.get(n);return!!i&&(!!i.selected||XQ(i,t))}function YQ(e,t,n){let i=e;do{var r;if(null!==(r=i)&&void 0!==r&&r.matches(t))return!0;if(i===n.current)return!1;i=i.parentElement}while(i);return!1}function QQ(e,t,n,i){return Array.from(e.values()).filter((n=>(n.selected||n.id===i)&&(!n.parentNode||n.parentId||!XQ(n,e))&&(n.draggable||t&&"undefined"===typeof n.draggable))).map((e=>{var t,i,r,s;return{id:e.id,position:e.position||{x:0,y:0},positionAbsolute:e.positionAbsolute||{x:0,y:0},distance:{x:n.x-(null!==(t=null===(i=e.positionAbsolute)||void 0===i?void 0:i.x)&&void 0!==t?t:0),y:n.y-(null!==(r=null===(s=e.positionAbsolute)||void 0===s?void 0:s.y)&&void 0!==r?r:0)},delta:{x:0,y:0},extent:e.extent,parentNode:e.parentNode||e.parentId,parentId:e.parentNode||e.parentId,width:e.width,height:e.height,expandParent:e.expandParent}}))}function KQ(e,t,n,i){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[0,0],s=arguments.length>5?arguments[5]:void 0;const a=function(e,t){return t&&"parent"!==t?[t[0],[t[1][0]-(e.width||0),t[1][1]-(e.height||0)]]:t}(e,e.extent||i);let o=a;const l=e.parentNode||e.parentId;if("parent"!==e.extent||e.expandParent){if(e.extent&&l&&"parent"!==e.extent){const t=n.get(l),{x:i,y:s}=MY(t,r).positionAbsolute;o=[[e.extent[0][0]+i,e.extent[0][1]+s],[e.extent[1][0]+i,e.extent[1][1]+s]]}}else if(l&&e.width&&e.height){const t=n.get(l),{x:i,y:s}=MY(t,r).positionAbsolute;o=t&&VX(i)&&VX(s)&&VX(t.width)&&VX(t.height)?[[i+e.width*r[0],s+e.height*r[1]],[i+t.width-e.width+e.width*r[0],s+t.height-e.height+e.height*r[1]]]:o}else null===s||void 0===s||s("005",vX()),o=a;let c={x:0,y:0};if(l){const e=n.get(l);c=MY(e,r).positionAbsolute}const h=o&&"parent"!==o?RX(t,o):t;return{position:{x:h.x-c.x,y:h.y-c.y},positionAbsolute:h}}function ZQ(e){let{nodeId:t,dragItems:n,nodeInternals:i}=e;const r=n.map((e=>o(o({},i.get(e.id)),{},{position:e.position,positionAbsolute:e.positionAbsolute})));return[t?r.find((e=>e.id===t)):r[0],r]}qQ.displayName="Pane";const JQ=(e,t,n,i)=>{const r=t.querySelectorAll(e);if(!r||!r.length)return null;const s=Array.from(r),a=t.getBoundingClientRect(),l=a.width*i[0],c=a.height*i[1];return s.map((e=>{const t=e.getBoundingClientRect();return o({id:e.getAttribute("data-handleid"),position:e.getAttribute("data-handlepos"),x:(t.left-a.left-l)/n,y:(t.top-a.top-c)/n},OX(e))}))};function $Q(e,t,n){return void 0===n?n:i=>{const r=t().nodeInternals.get(e);r&&n(i,o({},r))}}function eK(e){let{id:t,store:n,unselect:i=!1,nodeRef:r}=e;const{addSelectedNodes:s,unselectNodesAndEdges:a,multiSelectionActive:o,nodeInternals:l,onError:c}=n.getState(),h=l.get(t);h?(n.setState({nodesSelectionActive:!1}),h.selected?(i||h.selected&&o)&&(a({nodes:[h],edges:[]}),requestAnimationFrame((()=>{var e;return null===r||void 0===r||null===(e=r.current)||void 0===e?void 0:e.blur()}))):s([t])):null===c||void 0===c||c("012",_X(t))}function tK(e){return(t,n,i)=>null===e||void 0===e?void 0:e(t,i)}function nK(t){let{nodeRef:n,disabled:i=!1,noDragClassName:r,handleSelector:s,nodeId:a,isSelectable:l,selectNodesOnDrag:c}=t;const h=CX(),[u,d]=(0,e.useState)(!1),p=(0,e.useRef)([]),f=(0,e.useRef)({x:null,y:null}),m=(0,e.useRef)(0),g=(0,e.useRef)(null),v=(0,e.useRef)({x:0,y:0}),y=(0,e.useRef)(null),b=(0,e.useRef)(!1),x=(0,e.useRef)(!1),w=(0,e.useRef)(!1),S=function(){const t=CX(),n=(0,e.useCallback)((e=>{let{sourceEvent:n}=e;const{transform:i,snapGrid:r,snapToGrid:s}=t.getState(),a=n.touches?n.touches[0].clientX:n.clientX,l=n.touches?n.touches[0].clientY:n.clientY,c={x:(a-i[0])/i[2],y:(l-i[1])/i[2]};return o({xSnapped:s?r[0]*Math.round(c.x/r[0]):c.x,ySnapped:s?r[1]*Math.round(c.y/r[1]):c.y},c)}),[]);return n}();return(0,e.useEffect)((()=>{if(null!==n&&void 0!==n&&n.current){const e=VH(n.current),t=e=>{let{x:t,y:n}=e;const{nodeInternals:i,onNodeDrag:r,onSelectionDrag:s,updateNodePositions:o,nodeExtent:l,snapGrid:c,snapToGrid:u,nodeOrigin:m,onError:g}=h.getState();f.current={x:t,y:n};let v=!1,b={x:0,y:0,x2:0,y2:0};if(p.current.length>1&&l){const e=TY(p.current,m);b=NX(e)}if(p.current=p.current.map((e=>{const r={x:t-e.distance.x,y:n-e.distance.y};u&&(r.x=c[0]*Math.round(r.x/c[0]),r.y=c[1]*Math.round(r.y/c[1]));const s=[[l[0][0],l[0][1]],[l[1][0],l[1][1]]];var a,o;p.current.length>1&&l&&!e.extent&&(s[0][0]=e.positionAbsolute.x-b.x+l[0][0],s[1][0]=e.positionAbsolute.x+(null!==(a=e.width)&&void 0!==a?a:0)-b.x2+l[1][0],s[0][1]=e.positionAbsolute.y-b.y+l[0][1],s[1][1]=e.positionAbsolute.y+(null!==(o=e.height)&&void 0!==o?o:0)-b.y2+l[1][1]);const h=KQ(e,r,i,s,m,g);return v=v||e.position.x!==h.position.x||e.position.y!==h.position.y,e.position=h.position,e.positionAbsolute=h.positionAbsolute,e})),!v)return;o(p.current,!0,!0),d(!0);const x=a?r:tK(s);if(x&&y.current){const[e,t]=ZQ({nodeId:a,dragItems:p.current,nodeInternals:i});x(y.current,e,t)}},o=()=>{if(!g.current)return;const[e,n]=LX(v.current,g.current);if(0!==e||0!==n){var i,r;const{transform:s,panBy:a}=h.getState();f.current.x=(null!==(i=f.current.x)&&void 0!==i?i:0)-e/s[2],f.current.y=(null!==(r=f.current.y)&&void 0!==r?r:0)-n/s[2],a({x:e,y:n})&&t(f.current)}m.current=requestAnimationFrame(o)},u=e=>{const{nodeInternals:t,multiSelectionActive:i,nodesDraggable:r,unselectNodesAndEdges:s,onNodeDragStart:o,onSelectionDragStart:u}=h.getState();x.current=!0;const d=a?o:tK(u);var m;c&&l||i||!a||(null!==(m=t.get(a))&&void 0!==m&&m.selected||s());a&&l&&c&&eK({id:a,store:h,nodeRef:n});const g=S(e);if(f.current=g,p.current=QQ(t,r,g,a),d&&p.current){const[n,i]=ZQ({nodeId:a,dragItems:p.current,nodeInternals:t});d(e.sourceEvent,n,i)}};if(!i){const i=function(){var e,t,n,i,r=sX,s=aX,a=oX,o=lX,l={},c=TG("start","drag","end"),h=0,u=0;function d(e){e.on("mousedown.drag",p).filter(o).on("touchstart.drag",g).on("touchmove.drag",v,GH).on("touchend.drag touchcancel.drag",y).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function p(a,o){if(!i&&r.call(this,a,o)){var l=b(this,s.call(this,a,o),a,o,"mouse");l&&(VH(a.view).on("mousemove.drag",f,HH).on("mouseup.drag",m,HH),XH(a.view),WH(a),n=!1,e=a.clientX,t=a.clientY,l("start",a))}}function f(i){if(qH(i),!n){var r=i.clientX-e,s=i.clientY-t;n=r*r+s*s>u}l.mouse("drag",i)}function m(e){VH(e.view).on("mousemove.drag mouseup.drag",null),YH(e.view,n),qH(e),l.mouse("end",e)}function g(e,t){if(r.call(this,e,t)){var n,i,a=e.changedTouches,o=s.call(this,e,t),l=a.length;for(n=0;n<l;++n)(i=b(this,o,e,t,a[n].identifier,a[n]))&&(WH(e),i("start",e,a[n]))}}function v(e){var t,n,i=e.changedTouches,r=i.length;for(t=0;t<r;++t)(n=l[i[t].identifier])&&(qH(e),n("drag",e,i[t]))}function y(e){var t,n,r=e.changedTouches,s=r.length;for(i&&clearTimeout(i),i=setTimeout((function(){i=null}),500),t=0;t<s;++t)(n=l[r[t].identifier])&&(WH(e),n("end",e,r[t]))}function b(e,t,n,i,r,s){var o,u,p,f=c.copy(),m=ZH(s||n,t);if(null!=(p=a.call(e,new rX("beforestart",{sourceEvent:n,target:d,identifier:r,active:h,x:m[0],y:m[1],dx:0,dy:0,dispatch:f}),i)))return o=p.x-m[0]||0,u=p.y-m[1]||0,function n(s,a,c){var g,v=m;switch(s){case"start":l[r]=n,g=h++;break;case"end":delete l[r],--h;case"drag":m=ZH(c||a,t),g=h}f.call(s,e,new rX(s,{sourceEvent:a,subject:p,target:d,identifier:r,active:g,x:m[0]+o,y:m[1]+u,dx:m[0]-v[0],dy:m[1]-v[1],dispatch:f}),i)}}return d.filter=function(e){return arguments.length?(r="function"===typeof e?e:iX(!!e),d):r},d.container=function(e){return arguments.length?(s="function"===typeof e?e:iX(e),d):s},d.subject=function(e){return arguments.length?(a="function"===typeof e?e:iX(e),d):a},d.touchable=function(e){return arguments.length?(o="function"===typeof e?e:iX(!!e),d):o},d.on=function(){var e=c.on.apply(c,arguments);return e===c?d:e},d.clickDistance=function(e){return arguments.length?(u=(e=+e)*e,d):Math.sqrt(u)},d}().on("start",(e=>{const{domNode:t,nodeDragThreshold:n}=h.getState();0===n&&u(e),w.current=!1;const i=S(e);f.current=i,g.current=(null===t||void 0===t?void 0:t.getBoundingClientRect())||null,v.current=YX(e.sourceEvent,g.current)})).on("drag",(e=>{const n=S(e),{autoPanOnNodeDrag:i,nodeDragThreshold:r}=h.getState();if("touchmove"===e.sourceEvent.type&&e.sourceEvent.touches.length>1&&(w.current=!0),!w.current){if(!b.current&&x.current&&i&&(b.current=!0,o()),!x.current){var s,a,l,c;const t=n.xSnapped-(null!==(s=null===f||void 0===f||null===(a=f.current)||void 0===a?void 0:a.x)&&void 0!==s?s:0),i=n.ySnapped-(null!==(l=null===f||void 0===f||null===(c=f.current)||void 0===c?void 0:c.y)&&void 0!==l?l:0);Math.sqrt(t*t+i*i)>r&&u(e)}(f.current.x!==n.xSnapped||f.current.y!==n.ySnapped)&&p.current&&x.current&&(y.current=e.sourceEvent,v.current=YX(e.sourceEvent,g.current),t(n))}})).on("end",(e=>{if(x.current&&!w.current&&(d(!1),b.current=!1,x.current=!1,cancelAnimationFrame(m.current),p.current)){const{updateNodePositions:t,nodeInternals:n,onNodeDragStop:i,onSelectionDragStop:r}=h.getState(),s=a?i:tK(r);if(t(p.current,!1,!1),s){const[t,i]=ZQ({nodeId:a,dragItems:p.current,nodeInternals:n});s(e.sourceEvent,t,i)}}})).filter((e=>{const t=e.target;return!e.button&&(!r||!YQ(t,".".concat(r),n))&&(!s||YQ(t,s,n))}));return e.call(i),()=>{e.on(".drag",null)}}e.on(".drag",null)}}),[n,i,r,s,l,h,a,c,S]),u}function iK(){const t=CX(),n=(0,e.useCallback)((e=>{const{nodeInternals:n,nodeExtent:i,updateNodePositions:r,getNodes:s,snapToGrid:a,snapGrid:o,onError:l,nodesDraggable:c}=t.getState(),h=s().filter((e=>e.selected&&(e.draggable||c&&"undefined"===typeof e.draggable))),u=a?o[0]:5,d=a?o[1]:5,p=e.isShiftPressed?4:1,f=e.x*u*p,m=e.y*d*p,g=h.map((e=>{if(e.positionAbsolute){const t={x:e.positionAbsolute.x+f,y:e.positionAbsolute.y+m};a&&(t.x=o[0]*Math.round(t.x/o[0]),t.y=o[1]*Math.round(t.y/o[1]));const{positionAbsolute:r,position:s}=KQ(e,t,n,i,void 0,l);e.position=s,e.positionAbsolute=r}return e}));r(g,!0,!1)}),[]);return n}const rK={ArrowUp:{x:0,y:-1},ArrowDown:{x:0,y:1},ArrowLeft:{x:-1,y:0},ArrowRight:{x:1,y:0}};var sK=t=>{const n=n=>{let{id:i,type:r,data:s,xPos:a,yPos:l,xPosOrigin:c,yPosOrigin:h,selected:u,onClick:d,onMouseEnter:p,onMouseMove:f,onMouseLeave:m,onContextMenu:g,onDoubleClick:v,style:y,className:b,isDraggable:x,isSelectable:w,isConnectable:S,isFocusable:_,selectNodesOnDrag:E,sourcePosition:A,targetPosition:C,hidden:M,resizeObserver:T,dragHandle:P,zIndex:D,isParent:O,noDragClassName:I,noPanClassName:R,initialized:k,disableKeyboardA11y:L,ariaLabel:B,rfId:z,hasHandleBounds:N}=n;const F=CX(),U=(0,e.useRef)(null),j=(0,e.useRef)(null),V=(0,e.useRef)(A),G=(0,e.useRef)(C),H=(0,e.useRef)(r),W=w||x||d||p||f||m,q=iK(),X=$Q(i,F.getState,p),Y=$Q(i,F.getState,f),Q=$Q(i,F.getState,m),K=$Q(i,F.getState,g),Z=$Q(i,F.getState,v);(0,e.useEffect)((()=>()=>{j.current&&(null===T||void 0===T||T.unobserve(j.current),j.current=null)}),[]),(0,e.useEffect)((()=>{if(U.current&&!M){const e=U.current;k&&N&&j.current===e||(j.current&&(null===T||void 0===T||T.unobserve(j.current)),null===T||void 0===T||T.observe(e),j.current=e)}}),[M,k,N]),(0,e.useEffect)((()=>{const e=H.current!==r,t=V.current!==A,n=G.current!==C;U.current&&(e||t||n)&&(e&&(H.current=r),t&&(V.current=A),n&&(G.current=C),F.getState().updateNodeDimensions([{id:i,nodeElement:U.current,forceUpdate:!0}]))}),[i,r,A,C]);const J=nK({nodeRef:U,disabled:M||!x,noDragClassName:I,handleSelector:P,nodeId:i,isSelectable:w,selectNodesOnDrag:E});return M?null:e.createElement("div",{className:pG(["react-flow__node","react-flow__node-".concat(r),{[R]:x},b,{selected:u,selectable:w,parent:O,dragging:J}]),ref:U,style:o({zIndex:D,transform:"translate(".concat(c,"px,").concat(h,"px)"),pointerEvents:W?"all":"none",visibility:k?"visible":"hidden"},y),"data-id":i,"data-testid":"rf__node-".concat(i),onMouseEnter:X,onMouseMove:Y,onMouseLeave:Q,onContextMenu:K,onClick:e=>{const{nodeDragThreshold:t}=F.getState();if(w&&(!E||!x||t>0)&&eK({id:i,store:F,nodeRef:U}),d){const t=F.getState().nodeInternals.get(i);t&&d(e,o({},t))}},onDoubleClick:Z,onKeyDown:_?e=>{if(!qX(e)&&!L)if(HX.includes(e.key)&&w){const t="Escape"===e.key;eK({id:i,store:F,unselect:t,nodeRef:U})}else x&&u&&Object.prototype.hasOwnProperty.call(rK,e.key)&&(F.setState({ariaLiveMessage:"Moved selected node ".concat(e.key.replace("Arrow","").toLowerCase(),". New position, x: ").concat(~~a,", y: ").concat(~~l)}),q({x:rK[e.key].x,y:rK[e.key].y,isShiftPressed:e.shiftKey}))}:void 0,tabIndex:_?0:void 0,role:_?"button":void 0,"aria-describedby":L?void 0:"".concat(hQ,"-").concat(z),"aria-label":B},e.createElement(wY,{value:i},e.createElement(t,{id:i,data:s,type:r,xPos:a,yPos:l,selected:u,isConnectable:S,sourcePosition:A,targetPosition:C,dragging:J,dragHandle:P,zIndex:D})))};return n.displayName="NodeWrapper",(0,e.memo)(n)};const aK=e=>{const t=e.getNodes().filter((e=>e.selected));return o(o({},TY(t,e.nodeOrigin)),{},{transformString:"translate(".concat(e.transform[0],"px,").concat(e.transform[1],"px) scale(").concat(e.transform[2],")"),userSelectionActive:e.userSelectionActive})};var oK=(0,e.memo)((function(t){let{onSelectionContextMenu:n,noPanClassName:i,disableKeyboardA11y:r}=t;const s=CX(),{width:a,height:o,x:l,y:c,transformString:h,userSelectionActive:u}=AX(aK,SG),d=iK(),p=(0,e.useRef)(null);if((0,e.useEffect)((()=>{var e;r||(null===(e=p.current)||void 0===e||e.focus({preventScroll:!0}))}),[r]),nK({nodeRef:p}),u||!a||!o)return null;const f=n?e=>{const t=s.getState().getNodes().filter((e=>e.selected));n(e,t)}:void 0;return e.createElement("div",{className:pG(["react-flow__nodesselection","react-flow__container",i]),style:{transform:h}},e.createElement("div",{ref:p,className:"react-flow__nodesselection-rect",onContextMenu:f,tabIndex:r?void 0:-1,onKeyDown:r?void 0:e=>{Object.prototype.hasOwnProperty.call(rK,e.key)&&d({x:rK[e.key].x,y:rK[e.key].y,isShiftPressed:e.shiftKey})},style:{width:a,height:o,top:c,left:l}}))}));const lK=e=>e.nodesSelectionActive,cK=t=>{let{children:n,onPaneClick:i,onPaneMouseEnter:r,onPaneMouseMove:s,onPaneMouseLeave:a,onPaneContextMenu:o,onPaneScroll:l,deleteKeyCode:c,onMove:h,onMoveStart:u,onMoveEnd:d,selectionKeyCode:p,selectionOnDrag:f,selectionMode:m,onSelectionStart:g,onSelectionEnd:v,multiSelectionKeyCode:y,panActivationKeyCode:b,zoomActivationKeyCode:x,elementsSelectable:w,zoomOnScroll:S,zoomOnPinch:_,panOnScroll:E,panOnScrollSpeed:A,panOnScrollMode:C,zoomOnDoubleClick:M,panOnDrag:T,defaultViewport:P,translateExtent:D,minZoom:O,maxZoom:I,preventScrolling:R,onSelectionContextMenu:k,noWheelClassName:L,noPanClassName:B,disableKeyboardA11y:z}=t;const N=AX(lK),F=mQ(p),U=mQ(b),j=U||T,V=U||E,G=F||f&&!0!==j;return(t=>{let{deleteKeyCode:n,multiSelectionKeyCode:i}=t;const r=CX(),{deleteElements:s}=TQ(),a=mQ(n,PQ),o=mQ(i);(0,e.useEffect)((()=>{if(a){const{edges:e,getNodes:t}=r.getState(),n=t().filter((e=>e.selected)),i=e.filter((e=>e.selected));s({nodes:n,edges:i}),r.setState({nodesSelectionActive:!1})}}),[a]),(0,e.useEffect)((()=>{r.setState({multiSelectionActive:o})}),[o])})({deleteKeyCode:c,multiSelectionKeyCode:y}),e.createElement(BQ,{onMove:h,onMoveStart:u,onMoveEnd:d,onPaneContextMenu:o,elementsSelectable:w,zoomOnScroll:S,zoomOnPinch:_,panOnScroll:V,panOnScrollSpeed:A,panOnScrollMode:C,zoomOnDoubleClick:M,panOnDrag:!F&&j,defaultViewport:P,translateExtent:D,minZoom:O,maxZoom:I,zoomActivationKeyCode:x,preventScrolling:R,noWheelClassName:L,noPanClassName:B},e.createElement(qQ,{onSelectionStart:g,onSelectionEnd:v,onPaneClick:i,onPaneMouseEnter:r,onPaneMouseMove:s,onPaneMouseLeave:a,onPaneContextMenu:o,onPaneScroll:l,panOnDrag:j,isSelecting:!!G,selectionMode:m},n,N&&e.createElement(oK,{onSelectionContextMenu:k,noPanClassName:B,disableKeyboardA11y:z})))};cK.displayName="FlowRenderer";var hK=(0,e.memo)(cK);function uK(e){const t={input:sK(e.input||YY),default:sK(e.default||qY),output:sK(e.output||KY),group:sK(e.group||ZY)},n=Object.keys(e).filter((e=>!["input","default","output","group"].includes(e))).reduce(((t,n)=>(t[n]=sK(e[n]||qY),t)),{});return o(o({},t),n)}const dK=e=>({nodesDraggable:e.nodesDraggable,nodesConnectable:e.nodesConnectable,nodesFocusable:e.nodesFocusable,elementsSelectable:e.elementsSelectable,updateNodeDimensions:e.updateNodeDimensions,onError:e.onError}),pK=t=>{const{nodesDraggable:n,nodesConnectable:i,nodesFocusable:r,elementsSelectable:s,updateNodeDimensions:a,onError:o}=AX(dK,SG),l=function(t){const n=AX((0,e.useCallback)((e=>t?PY(e.nodeInternals,{x:0,y:0,width:e.width,height:e.height},e.transform,!0):e.getNodes()),[t]));return n}(t.onlyRenderVisibleElements),c=(0,e.useRef)(),h=(0,e.useMemo)((()=>{if("undefined"===typeof ResizeObserver)return null;const e=new ResizeObserver((e=>{const t=e.map((e=>({id:e.target.getAttribute("data-id"),nodeElement:e.target,forceUpdate:!0})));a(t)}));return c.current=e,e}),[]);return(0,e.useEffect)((()=>()=>{var e;null===c||void 0===c||null===(e=c.current)||void 0===e||e.disconnect()}),[]),e.createElement("div",{className:"react-flow__nodes",style:DQ},l.map((a=>{var l,c,u,d,p,f,m,g;let v=a.type||"default";t.nodeTypes[v]||(null===o||void 0===o||o("003",mX(v)),v="default");const y=t.nodeTypes[v]||t.nodeTypes.default,b=!!(a.draggable||n&&"undefined"===typeof a.draggable),x=!!(a.selectable||s&&"undefined"===typeof a.selectable),w=!!(a.connectable||i&&"undefined"===typeof a.connectable),S=!!(a.focusable||r&&"undefined"===typeof a.focusable),_=t.nodeExtent?RX(a.positionAbsolute,t.nodeExtent):a.positionAbsolute,E=null!==(l=null===_||void 0===_?void 0:_.x)&&void 0!==l?l:0,A=null!==(c=null===_||void 0===_?void 0:_.y)&&void 0!==c?c:0,C=(e=>{let{x:t,y:n,width:i,height:r,origin:s}=e;return i&&r?s[0]<0||s[1]<0||s[0]>1||s[1]>1?{x:t,y:n}:{x:t-i*s[0],y:n-r*s[1]}:{x:t,y:n}})({x:E,y:A,width:null!==(u=a.width)&&void 0!==u?u:0,height:null!==(d=a.height)&&void 0!==d?d:0,origin:t.nodeOrigin});return e.createElement(y,{key:a.id,id:a.id,className:a.className,style:a.style,type:v,data:a.data,sourcePosition:a.sourcePosition||sY.Bottom,targetPosition:a.targetPosition||sY.Top,hidden:a.hidden,xPos:E,yPos:A,xPosOrigin:C.x,yPosOrigin:C.y,selectNodesOnDrag:t.selectNodesOnDrag,onClick:t.onNodeClick,onMouseEnter:t.onNodeMouseEnter,onMouseMove:t.onNodeMouseMove,onMouseLeave:t.onNodeMouseLeave,onContextMenu:t.onNodeContextMenu,onDoubleClick:t.onNodeDoubleClick,selected:!!a.selected,isDraggable:b,isSelectable:x,isConnectable:w,isFocusable:S,resizeObserver:h,dragHandle:a.dragHandle,zIndex:null!==(p=null===(f=a[GX])||void 0===f?void 0:f.z)&&void 0!==p?p:0,isParent:!(null===(m=a[GX])||void 0===m||!m.isParent),noDragClassName:t.noDragClassName,noPanClassName:t.noPanClassName,initialized:!!a.width&&!!a.height,rfId:t.rfId,disableKeyboardA11y:t.disableKeyboardA11y,ariaLabel:a.ariaLabel,hasHandleBounds:!(null===(g=a[GX])||void 0===g||!g.handleBounds)})})))};pK.displayName="NodeRenderer";var fK=(0,e.memo)(pK);const mK=(e,t,n)=>n===sY.Left?e-t:n===sY.Right?e+t:e,gK=(e,t,n)=>n===sY.Top?e-t:n===sY.Bottom?e+t:e,vK="react-flow__edgeupdater",yK=t=>{let{position:n,centerX:i,centerY:r,radius:s=10,onMouseDown:a,onMouseEnter:o,onMouseOut:l,type:c}=t;return e.createElement("circle",{onMouseDown:a,onMouseEnter:o,onMouseOut:l,className:pG([vK,"".concat(vK,"-").concat(c)]),cx:mK(i,s,n),cy:gK(r,s,n),r:s,stroke:"transparent",fill:"transparent"})},bK=()=>!0;var xK=t=>{const n=n=>{let{id:i,className:r,type:s,data:a,onClick:o,onEdgeDoubleClick:l,selected:c,animated:h,label:u,labelStyle:d,labelShowBg:p,labelBgStyle:f,labelBgPadding:m,labelBgBorderRadius:g,style:v,source:y,target:b,sourceX:x,sourceY:w,targetX:S,targetY:_,sourcePosition:E,targetPosition:A,elementsSelectable:C,hidden:M,sourceHandleId:T,targetHandleId:P,onContextMenu:D,onMouseEnter:O,onMouseMove:I,onMouseLeave:R,reconnectRadius:k,onReconnect:L,onReconnectStart:B,onReconnectEnd:z,markerEnd:N,markerStart:F,rfId:U,ariaLabel:j,isFocusable:V,isReconnectable:G,pathOptions:H,interactionWidth:W,disableKeyboardA11y:q}=n;const X=(0,e.useRef)(null),[Y,Q]=(0,e.useState)(!1),[K,Z]=(0,e.useState)(!1),J=CX(),$=(0,e.useMemo)((()=>"url('#".concat(_Y(F,U),"')")),[F,U]),ee=(0,e.useMemo)((()=>"url('#".concat(_Y(N,U),"')")),[N,U]);if(M)return null;const te=ZX(i,J.getState,l),ne=ZX(i,J.getState,D),ie=ZX(i,J.getState,O),re=ZX(i,J.getState,I),se=ZX(i,J.getState,R),ae=(e,t)=>{if(0!==e.button)return;const{edges:n,isValidConnection:r}=J.getState(),s=t?b:y,a=(t?P:T)||null,o=t?"target":"source",l=r||bK,c=t,h=n.find((e=>e.id===i));Z(!0),null===B||void 0===B||B(e,h,o);UY({event:e,handleId:a,nodeId:s,onConnect:e=>null===L||void 0===L?void 0:L(h,e),isTarget:c,getState:J.getState,setState:J.setState,isValidConnection:l,edgeUpdaterType:o,onReconnectEnd:e=>{Z(!1),null===z||void 0===z||z(e,h,o)}})},oe=()=>Q(!0),le=()=>Q(!1),ce=!C&&!o;return e.createElement("g",{className:pG(["react-flow__edge","react-flow__edge-".concat(s),r,{selected:c,animated:h,inactive:ce,updating:Y}]),onClick:e=>{const{edges:t,addSelectedEdges:n,unselectNodesAndEdges:r,multiSelectionActive:s}=J.getState(),a=t.find((e=>e.id===i));if(a){var l;if(C)if(J.setState({nodesSelectionActive:!1}),a.selected&&s)r({nodes:[],edges:[a]}),null===(l=X.current)||void 0===l||l.blur();else n([i]);o&&o(e,a)}},onDoubleClick:te,onContextMenu:ne,onMouseEnter:ie,onMouseMove:re,onMouseLeave:se,onKeyDown:V?e=>{if(!q&&HX.includes(e.key)&&C){const{unselectNodesAndEdges:n,addSelectedEdges:r,edges:s}=J.getState();var t;if("Escape"===e.key)null===(t=X.current)||void 0===t||t.blur(),n({edges:[s.find((e=>e.id===i))]});else r([i])}}:void 0,tabIndex:V?0:void 0,role:V?"button":"img","data-testid":"rf__edge-".concat(i),"aria-label":null===j?void 0:j||"Edge from ".concat(y," to ").concat(b),"aria-describedby":V?"".concat(uQ,"-").concat(U):void 0,ref:X},!K&&e.createElement(t,{id:i,source:y,target:b,selected:c,animated:h,label:u,labelStyle:d,labelShowBg:p,labelBgStyle:f,labelBgPadding:m,labelBgBorderRadius:g,data:a,style:v,sourceX:x,sourceY:w,targetX:S,targetY:_,sourcePosition:E,targetPosition:A,sourceHandleId:T,targetHandleId:P,markerStart:$,markerEnd:ee,pathOptions:H,interactionWidth:W}),G&&e.createElement(e.Fragment,null,("source"===G||!0===G)&&e.createElement(yK,{position:E,centerX:x,centerY:w,radius:k,onMouseDown:e=>ae(e,!0),onMouseEnter:oe,onMouseOut:le,type:"source"}),("target"===G||!0===G)&&e.createElement(yK,{position:A,centerX:S,centerY:_,radius:k,onMouseDown:e=>ae(e,!1),onMouseEnter:oe,onMouseOut:le,type:"target"})))};return n.displayName="EdgeWrapper",(0,e.memo)(n)};function wK(e){const t={default:xK(e.default||bY),straight:xK(e.bezier||mY),step:xK(e.step||fY),smoothstep:xK(e.step||pY),simplebezier:xK(e.simplebezier||lY)},n=Object.keys(e).filter((e=>!["default","bezier"].includes(e))).reduce(((t,n)=>(t[n]=xK(e[n]||bY),t)),{});return o(o({},t),n)}function SK(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const i=((null===n||void 0===n?void 0:n.x)||0)+t.x,r=((null===n||void 0===n?void 0:n.y)||0)+t.y,s=(null===n||void 0===n?void 0:n.width)||t.width,a=(null===n||void 0===n?void 0:n.height)||t.height;switch(e){case sY.Top:return{x:i+s/2,y:r};case sY.Right:return{x:i+s,y:r+a/2};case sY.Bottom:return{x:i+s/2,y:r+a};case sY.Left:return{x:i,y:r+a/2}}}function _K(e,t){return e?1!==e.length&&t?t&&e.find((e=>e.id===t))||null:e[0]:null}function EK(e){var t,n,i,r,s;const a=(null===e||void 0===e||null===(t=e[GX])||void 0===t?void 0:t.handleBounds)||null,o=a&&(null===e||void 0===e?void 0:e.width)&&(null===e||void 0===e?void 0:e.height)&&"undefined"!==typeof(null===e||void 0===e||null===(n=e.positionAbsolute)||void 0===n?void 0:n.x)&&"undefined"!==typeof(null===e||void 0===e||null===(i=e.positionAbsolute)||void 0===i?void 0:i.y);return[{x:(null===e||void 0===e||null===(r=e.positionAbsolute)||void 0===r?void 0:r.x)||0,y:(null===e||void 0===e||null===(s=e.positionAbsolute)||void 0===s?void 0:s.y)||0,width:(null===e||void 0===e?void 0:e.width)||0,height:(null===e||void 0===e?void 0:e.height)||0},a,!!o]}const AK=[{level:0,isMaxLevel:!0,edges:[]}];function CK(t,n,i){const r=AX((0,e.useCallback)((e=>t?e.edges.filter((t=>{const i=n.get(t.source),r=n.get(t.target);return(null===i||void 0===i?void 0:i.width)&&(null===i||void 0===i?void 0:i.height)&&(null===r||void 0===r?void 0:r.width)&&(null===r||void 0===r?void 0:r.height)&&function(e){let{sourcePos:t,targetPos:n,sourceWidth:i,sourceHeight:r,targetWidth:s,targetHeight:a,width:o,height:l,transform:c}=e;const h={x:Math.min(t.x,n.x),y:Math.min(t.y,n.y),x2:Math.max(t.x+i,n.x+s),y2:Math.max(t.y+r,n.y+a)};h.x===h.x2&&(h.x2+=1),h.y===h.y2&&(h.y2+=1);const u=NX({x:(0-c[0])/c[2],y:(0-c[1])/c[2],width:o/c[2],height:l/c[2]}),d=Math.max(0,Math.min(u.x2,h.x2)-Math.max(u.x,h.x)),p=Math.max(0,Math.min(u.y2,h.y2)-Math.max(u.y,h.y));return Math.ceil(d*p)>0}({sourcePos:i.positionAbsolute||{x:0,y:0},targetPos:r.positionAbsolute||{x:0,y:0},sourceWidth:i.width,sourceHeight:i.height,targetWidth:r.width,targetHeight:r.height,width:e.width,height:e.height,transform:e.transform})})):e.edges),[t,n]));return function(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=-1;const r=e.reduce(((e,r)=>{const s=VX(r.zIndex);let a=s?r.zIndex:0;if(n){var o,l;const e=t.get(r.target),n=t.get(r.source),i=r.selected||(null===e||void 0===e?void 0:e.selected)||(null===n||void 0===n?void 0:n.selected),c=Math.max((null===n||void 0===n||null===(o=n[GX])||void 0===o?void 0:o.z)||0,(null===e||void 0===e||null===(l=e[GX])||void 0===l?void 0:l.z)||0,1e3);a=(s?r.zIndex:0)+(i?c:0)}return e[a]?e[a].push(r):e[a]=[r],i=a>i?a:i,e}),{}),s=Object.entries(r).map((e=>{let[t,n]=e;const r=+t;return{edges:n,level:r,isMaxLevel:r===i}}));return 0===s.length?AK:s}(r,n,i)}const MK={[rY.Arrow]:t=>{let{color:n="none",strokeWidth:i=1}=t;return e.createElement("polyline",{style:{stroke:n,strokeWidth:i},strokeLinecap:"round",strokeLinejoin:"round",fill:"none",points:"-5,-4 0,0 -5,4"})},[rY.ArrowClosed]:t=>{let{color:n="none",strokeWidth:i=1}=t;return e.createElement("polyline",{style:{stroke:n,fill:n,strokeWidth:i},strokeLinecap:"round",strokeLinejoin:"round",points:"-5,-4 0,0 -5,4 -5,-4"})}};const TK=t=>{let{id:n,type:i,color:r,width:s=12.5,height:a=12.5,markerUnits:o="strokeWidth",strokeWidth:l,orient:c="auto-start-reverse"}=t;const h=function(t){const n=CX();return(0,e.useMemo)((()=>{var e,i;return Object.prototype.hasOwnProperty.call(MK,t)?MK[t]:(null===(e=(i=n.getState()).onError)||void 0===e||e.call(i,"009",bX(t)),null)}),[t])}(i);return h?e.createElement("marker",{className:"react-flow__arrowhead",id:n,markerWidth:"".concat(s),markerHeight:"".concat(a),viewBox:"-10 -10 20 20",markerUnits:o,orient:c,refX:"0",refY:"0"},e.createElement(h,{color:r,strokeWidth:l})):null},PK=t=>{let{defaultColor:n,rfId:i}=t;const r=AX((0,e.useCallback)((e=>{let{defaultColor:t,rfId:n}=e;return e=>{const i=[];return e.edges.reduce(((e,r)=>([r.markerStart,r.markerEnd].forEach((r=>{if(r&&"object"===typeof r){const s=_Y(r,n);i.includes(s)||(e.push(o({id:s,color:r.color||t},r)),i.push(s))}})),e)),[]).sort(((e,t)=>e.id.localeCompare(t.id)))}})({defaultColor:n,rfId:i}),[n,i]),((e,t)=>!(e.length!==t.length||e.some(((e,n)=>e.id!==t[n].id)))));return e.createElement("defs",null,r.map((t=>e.createElement(TK,{id:t.id,key:t.id,type:t.type,color:t.color,width:t.width,height:t.height,markerUnits:t.markerUnits,strokeWidth:t.strokeWidth,orient:t.orient}))))};PK.displayName="MarkerDefinitions";var DK=(0,e.memo)(PK);const OK=e=>({nodesConnectable:e.nodesConnectable,edgesFocusable:e.edgesFocusable,edgesUpdatable:e.edgesUpdatable,elementsSelectable:e.elementsSelectable,width:e.width,height:e.height,connectionMode:e.connectionMode,nodeInternals:e.nodeInternals,onError:e.onError}),IK=t=>{let{defaultMarkerColor:n,onlyRenderVisibleElements:i,elevateEdgesOnSelect:r,rfId:s,edgeTypes:a,noPanClassName:o,onEdgeContextMenu:l,onEdgeMouseEnter:c,onEdgeMouseMove:h,onEdgeMouseLeave:u,onEdgeClick:d,onEdgeDoubleClick:p,onReconnect:f,onReconnectStart:m,onReconnectEnd:g,reconnectRadius:v,children:y,disableKeyboardA11y:b}=t;const{edgesFocusable:x,edgesUpdatable:w,elementsSelectable:S,width:_,height:E,connectionMode:A,nodeInternals:C,onError:M}=AX(OK,SG),T=CK(i,C,r);return _?e.createElement(e.Fragment,null,T.map((t=>{let{level:i,edges:r,isMaxLevel:y}=t;return e.createElement("svg",{key:i,style:{zIndex:i},width:_,height:E,className:"react-flow__edges react-flow__container"},y&&e.createElement(DK,{defaultColor:n,rfId:s}),e.createElement("g",null,r.map((t=>{var n,i;const[r,y,_]=EK(C.get(t.source)),[E,T,P]=EK(C.get(t.target));if(!_||!P)return null;let D=t.type||"default";a[D]||(null===M||void 0===M||M("011",SX(D)),D="default");const O=a[D]||a.default,I=A===eY.Strict?T.target:(null!==(n=T.target)&&void 0!==n?n:[]).concat(null!==(i=T.source)&&void 0!==i?i:[]),R=_K(y.source,t.sourceHandle),k=_K(I,t.targetHandle),L=(null===R||void 0===R?void 0:R.position)||sY.Bottom,B=(null===k||void 0===k?void 0:k.position)||sY.Top,z=!!(t.focusable||x&&"undefined"===typeof t.focusable),N=t.reconnectable||t.updatable,F="undefined"!==typeof f&&(N||w&&"undefined"===typeof N);if(!R||!k)return null===M||void 0===M||M("008",xX(R,t)),null;const{sourceX:U,sourceY:j,targetX:V,targetY:G}=((e,t,n,i,r,s)=>{const a=SK(n,e,t),o=SK(s,i,r);return{sourceX:a.x,sourceY:a.y,targetX:o.x,targetY:o.y}})(r,R,L,E,k,B);return e.createElement(O,{key:t.id,id:t.id,className:pG([t.className,o]),type:D,data:t.data,selected:!!t.selected,animated:!!t.animated,hidden:!!t.hidden,label:t.label,labelStyle:t.labelStyle,labelShowBg:t.labelShowBg,labelBgStyle:t.labelBgStyle,labelBgPadding:t.labelBgPadding,labelBgBorderRadius:t.labelBgBorderRadius,style:t.style,source:t.source,target:t.target,sourceHandleId:t.sourceHandle,targetHandleId:t.targetHandle,markerEnd:t.markerEnd,markerStart:t.markerStart,sourceX:U,sourceY:j,targetX:V,targetY:G,sourcePosition:L,targetPosition:B,elementsSelectable:S,onContextMenu:l,onMouseEnter:c,onMouseMove:h,onMouseLeave:u,onClick:d,onEdgeDoubleClick:p,onReconnect:f,onReconnectStart:m,onReconnectEnd:g,reconnectRadius:v,rfId:s,ariaLabel:t.ariaLabel,isFocusable:z,isReconnectable:F,pathOptions:"pathOptions"in t?t.pathOptions:void 0,interactionWidth:t.interactionWidth,disableKeyboardA11y:b})}))))})),y):null};IK.displayName="EdgeRenderer";var RK=(0,e.memo)(IK);const kK=e=>"translate(".concat(e.transform[0],"px,").concat(e.transform[1],"px) scale(").concat(e.transform[2],")");function LK(t){let{children:n}=t;const i=AX(kK);return e.createElement("div",{className:"react-flow__viewport react-flow__container",style:{transform:i}},n)}const BK={[sY.Left]:sY.Right,[sY.Right]:sY.Left,[sY.Top]:sY.Bottom,[sY.Bottom]:sY.Top},zK=t=>{var n,i,r,s,a,l,c;let{nodeId:h,handleType:u,style:d,type:p=iY.Bezier,CustomComponent:f,connectionStatus:m}=t;const{fromNode:g,handleId:v,toX:y,toY:b,connectionMode:x}=AX((0,e.useCallback)((e=>({fromNode:e.nodeInternals.get(h),handleId:e.connectionHandleId,toX:(e.connectionPosition.x-e.transform[0])/e.transform[2],toY:(e.connectionPosition.y-e.transform[1])/e.transform[2],connectionMode:e.connectionMode})),[h]),SG),w=null===g||void 0===g||null===(n=g[GX])||void 0===n?void 0:n.handleBounds;let S=null===w||void 0===w?void 0:w[u];if(x===eY.Loose&&(S=S||(null===w||void 0===w?void 0:w["source"===u?"target":"source"])),!g||!S)return null;const _=v?S.find((e=>e.id===v)):S[0],E=_?_.x+_.width/2:(null!==(i=g.width)&&void 0!==i?i:0)/2,A=_?_.y+_.height/2:null!==(r=g.height)&&void 0!==r?r:0,C=(null!==(s=null===(a=g.positionAbsolute)||void 0===a?void 0:a.x)&&void 0!==s?s:0)+E,M=(null!==(l=null===(c=g.positionAbsolute)||void 0===c?void 0:c.y)&&void 0!==l?l:0)+A,T=null===_||void 0===_?void 0:_.position,P=T?BK[T]:null;if(!T||!P)return null;if(f)return e.createElement(f,{connectionLineType:p,connectionLineStyle:d,fromNode:g,fromHandle:_,fromX:C,fromY:M,toX:y,toY:b,fromPosition:T,toPosition:P,connectionStatus:m});let D="";const O={sourceX:C,sourceY:M,sourcePosition:T,targetX:y,targetY:b,targetPosition:P};return p===iY.Bezier?[D]=yY(O):p===iY.Step?[D]=dY(o(o({},O),{},{borderRadius:0})):p===iY.SmoothStep?[D]=dY(O):p===iY.SimpleBezier?[D]=oY(O):D="M".concat(C,",").concat(M," ").concat(y,",").concat(b),e.createElement("path",{d:D,fill:"none",className:"react-flow__connection-path",style:d})};zK.displayName="ConnectionLine";const NK=e=>({nodeId:e.connectionNodeId,handleType:e.connectionHandleType,nodesConnectable:e.nodesConnectable,connectionStatus:e.connectionStatus,width:e.width,height:e.height});function FK(t){let{containerStyle:n,style:i,type:r,component:s}=t;const{nodeId:a,handleType:o,nodesConnectable:l,width:c,height:h,connectionStatus:u}=AX(NK,SG);return!!(a&&o&&c&&l)?e.createElement("svg",{style:n,width:c,height:h,className:"react-flow__edges react-flow__connectionline react-flow__container"},e.createElement("g",{className:pG(["react-flow__connection",u])},e.createElement(zK,{nodeId:a,handleType:o,style:i,type:r,CustomComponent:s,connectionStatus:u}))):null}function UK(t,n){(0,e.useRef)(null),CX();return(0,e.useMemo)((()=>n(t)),[t])}const jK=t=>{let{nodeTypes:n,edgeTypes:i,onMove:r,onMoveStart:s,onMoveEnd:a,onInit:o,onNodeClick:l,onEdgeClick:c,onNodeDoubleClick:h,onEdgeDoubleClick:u,onNodeMouseEnter:d,onNodeMouseMove:p,onNodeMouseLeave:f,onNodeContextMenu:m,onSelectionContextMenu:g,onSelectionStart:v,onSelectionEnd:y,connectionLineType:b,connectionLineStyle:x,connectionLineComponent:w,connectionLineContainerStyle:S,selectionKeyCode:_,selectionOnDrag:E,selectionMode:A,multiSelectionKeyCode:C,panActivationKeyCode:M,zoomActivationKeyCode:T,deleteKeyCode:P,onlyRenderVisibleElements:D,elementsSelectable:O,selectNodesOnDrag:I,defaultViewport:R,translateExtent:k,minZoom:L,maxZoom:B,preventScrolling:z,defaultMarkerColor:N,zoomOnScroll:F,zoomOnPinch:U,panOnScroll:j,panOnScrollSpeed:V,panOnScrollMode:G,zoomOnDoubleClick:H,panOnDrag:W,onPaneClick:q,onPaneMouseEnter:X,onPaneMouseMove:Y,onPaneMouseLeave:Q,onPaneScroll:K,onPaneContextMenu:Z,onEdgeContextMenu:J,onEdgeMouseEnter:$,onEdgeMouseMove:ee,onEdgeMouseLeave:te,onReconnect:ne,onReconnectStart:ie,onReconnectEnd:re,reconnectRadius:se,noDragClassName:ae,noWheelClassName:oe,noPanClassName:le,elevateEdgesOnSelect:ce,disableKeyboardA11y:he,nodeOrigin:ue,nodeExtent:de,rfId:pe}=t;const fe=UK(n,uK),me=UK(i,wK);return function(t){const n=TQ(),i=(0,e.useRef)(!1);(0,e.useEffect)((()=>{!i.current&&n.viewportInitialized&&t&&(setTimeout((()=>t(n)),1),i.current=!0)}),[t,n.viewportInitialized])}(o),e.createElement(hK,{onPaneClick:q,onPaneMouseEnter:X,onPaneMouseMove:Y,onPaneMouseLeave:Q,onPaneContextMenu:Z,onPaneScroll:K,deleteKeyCode:P,selectionKeyCode:_,selectionOnDrag:E,selectionMode:A,onSelectionStart:v,onSelectionEnd:y,multiSelectionKeyCode:C,panActivationKeyCode:M,zoomActivationKeyCode:T,elementsSelectable:O,onMove:r,onMoveStart:s,onMoveEnd:a,zoomOnScroll:F,zoomOnPinch:U,zoomOnDoubleClick:H,panOnScroll:j,panOnScrollSpeed:V,panOnScrollMode:G,panOnDrag:W,defaultViewport:R,translateExtent:k,minZoom:L,maxZoom:B,onSelectionContextMenu:g,preventScrolling:z,noDragClassName:ae,noWheelClassName:oe,noPanClassName:le,disableKeyboardA11y:he},e.createElement(LK,null,e.createElement(RK,{edgeTypes:me,onEdgeClick:c,onEdgeDoubleClick:u,onlyRenderVisibleElements:D,onEdgeContextMenu:J,onEdgeMouseEnter:$,onEdgeMouseMove:ee,onEdgeMouseLeave:te,onReconnect:ne,onReconnectStart:ie,onReconnectEnd:re,reconnectRadius:se,defaultMarkerColor:N,noPanClassName:le,elevateEdgesOnSelect:!!ce,disableKeyboardA11y:he,rfId:pe},e.createElement(FK,{style:x,type:b,component:w,containerStyle:S})),e.createElement("div",{className:"react-flow__edgelabel-renderer"}),e.createElement(fK,{nodeTypes:fe,onNodeClick:l,onNodeDoubleClick:h,onNodeMouseEnter:d,onNodeMouseMove:p,onNodeMouseLeave:f,onNodeContextMenu:m,selectNodesOnDrag:I,onlyRenderVisibleElements:D,noPanClassName:le,noDragClassName:ae,disableKeyboardA11y:he,nodeOrigin:ue,nodeExtent:de,rfId:pe})))};jK.displayName="GraphView";var VK=(0,e.memo)(jK);const GK=[[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY],[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY]],HK={rfId:"1",width:0,height:0,transform:[0,0,1],nodeInternals:new Map,edges:[],onNodesChange:null,onEdgesChange:null,hasDefaultNodes:!1,hasDefaultEdges:!1,d3Zoom:null,d3Selection:null,d3ZoomHandler:void 0,minZoom:.5,maxZoom:2,translateExtent:GK,nodeExtent:GK,nodesSelectionActive:!1,userSelectionActive:!1,userSelectionRect:null,connectionNodeId:null,connectionHandleId:null,connectionHandleType:"source",connectionPosition:{x:0,y:0},connectionStatus:null,connectionMode:eY.Strict,domNode:null,paneDragging:!1,noPanClassName:"nopan",nodeOrigin:[0,0],nodeDragThreshold:0,snapGrid:[15,15],snapToGrid:!1,nodesDraggable:!0,nodesConnectable:!0,nodesFocusable:!0,edgesFocusable:!0,edgesUpdatable:!0,elementsSelectable:!0,elevateNodesOnSelect:!0,fitViewOnInit:!1,fitViewOnInitDone:!1,fitViewOnInitOptions:void 0,onSelectionChange:[],multiSelectionActive:!1,connectionStartHandle:null,connectionEndHandle:null,connectionClickStartHandle:null,connectOnClick:!0,ariaLiveMessage:"",autoPanOnConnect:!0,autoPanOnNodeDrag:!0,connectionRadius:20,onError:WX,isValidConnection:void 0},WK=()=>{return e=(e,t)=>o(o({},HK),{},{setNodes:n=>{const{nodeInternals:i,nodeOrigin:r,elevateNodesOnSelect:s}=t();e({nodeInternals:xQ(n,i,r,s)})},getNodes:()=>Array.from(t().nodeInternals.values()),setEdges:n=>{const{defaultEdgeOptions:i={}}=t();e({edges:n.map((e=>o(o({},i),e)))})},setDefaultNodesAndEdges:(n,i)=>{const r="undefined"!==typeof n,s="undefined"!==typeof i,a=r?xQ(n,new Map,t().nodeOrigin,t().elevateNodesOnSelect):new Map;e({nodeInternals:a,edges:s?i:[],hasDefaultNodes:r,hasDefaultEdges:s})},updateNodeDimensions:n=>{const{onNodesChange:i,nodeInternals:r,fitViewOnInit:s,fitViewOnInitDone:a,fitViewOnInitOptions:l,domNode:c,nodeOrigin:h}=t(),u=null===c||void 0===c?void 0:c.querySelector(".react-flow__viewport");if(!u)return;const d=window.getComputedStyle(u),{m22:p}=new window.DOMMatrixReadOnly(d.transform),f=n.reduce(((e,t)=>{const n=r.get(t.id);if(null!==n&&void 0!==n&&n.hidden)r.set(n.id,o(o({},n),{},{[GX]:o(o({},n[GX]),{},{handleBounds:void 0})}));else if(n){const i=OX(t.nodeElement);i.width&&i.height&&(n.width!==i.width||n.height!==i.height||t.forceUpdate)&&(r.set(n.id,o(o({},n),{},{[GX]:o(o({},n[GX]),{},{handleBounds:{source:JQ(".source",t.nodeElement,p,h),target:JQ(".target",t.nodeElement,p,h)}})},i)),e.push({id:n.id,type:"dimensions",dimensions:i}))}return e}),[]);bQ(r,h);const m=a||s&&!a&&wQ(t,o({initial:!0},l));e({nodeInternals:new Map(r),fitViewOnInitDone:m}),(null===f||void 0===f?void 0:f.length)>0&&(null===i||void 0===i||i(f))},updateNodePositions:function(e){let n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const{triggerNodeChanges:r}=t(),s=e.map((e=>{const t={id:e.id,type:"position",dragging:i};return n&&(t.positionAbsolute=e.positionAbsolute,t.position=e.position),t}));r(s)},triggerNodeChanges:n=>{const{onNodesChange:i,nodeInternals:r,hasDefaultNodes:s,nodeOrigin:a,getNodes:o,elevateNodesOnSelect:l}=t();if(null!==n&&void 0!==n&&n.length){if(s){const t=xQ(jQ(n,o()),r,a,l);e({nodeInternals:t})}null===i||void 0===i||i(n)}},addSelectedNodes:n=>{const{multiSelectionActive:i,edges:r,getNodes:s}=t();let a,o=null;i?a=n.map((e=>VQ(e,!0))):(a=GQ(s(),n),o=GQ(r,[])),EQ({changedNodes:a,changedEdges:o,get:t,set:e})},addSelectedEdges:n=>{const{multiSelectionActive:i,edges:r,getNodes:s}=t();let a,o=null;i?a=n.map((e=>VQ(e,!0))):(a=GQ(r,n),o=GQ(s(),[])),EQ({changedNodes:o,changedEdges:a,get:t,set:e})},unselectNodesAndEdges:function(){let{nodes:n,edges:i}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{edges:r,getNodes:s}=t(),a=i||r,o=(n||s()).map((e=>(e.selected=!1,VQ(e.id,!1))));EQ({changedNodes:o,changedEdges:a.map((e=>VQ(e.id,!1))),get:t,set:e})},setMinZoom:n=>{const{d3Zoom:i,maxZoom:r}=t();null===i||void 0===i||i.scaleExtent([n,r]),e({minZoom:n})},setMaxZoom:n=>{const{d3Zoom:i,minZoom:r}=t();null===i||void 0===i||i.scaleExtent([r,n]),e({maxZoom:n})},setTranslateExtent:n=>{var i;null===(i=t().d3Zoom)||void 0===i||i.translateExtent(n),e({translateExtent:n})},resetSelectedElements:()=>{const{edges:n,getNodes:i}=t(),r=i().filter((e=>e.selected)).map((e=>VQ(e.id,!1))),s=n.filter((e=>e.selected)).map((e=>VQ(e.id,!1)));EQ({changedNodes:r,changedEdges:s,get:t,set:e})},setNodeExtent:n=>{const{nodeInternals:i}=t();i.forEach((e=>{e.positionAbsolute=RX(e.position,n)})),e({nodeExtent:n,nodeInternals:new Map(i)})},panBy:e=>{const{transform:n,width:i,height:r,d3Zoom:s,d3Selection:a,translateExtent:o}=t();if(!s||!a||!e.x&&!e.y)return!1;const l=Yq.translate(n[0]+e.x,n[1]+e.y).scale(n[2]),c=[[0,0],[i,r]],h=null===s||void 0===s?void 0:s.constrain()(l,c,o);return s.transform(a,h),n[0]!==h.x||n[1]!==h.y||n[2]!==h.k},cancelConnection:()=>e({connectionNodeId:HK.connectionNodeId,connectionHandleId:HK.connectionHandleId,connectionHandleType:HK.connectionHandleType,connectionStatus:HK.connectionStatus,connectionStartHandle:HK.connectionStartHandle,connectionEndHandle:HK.connectionEndHandle}),reset:()=>e(o({},HK))}),t=Object.is,e?wG(e,t):wG;var e,t},qK=t=>{let{children:n}=t;const i=(0,e.useRef)(null);return i.current||(i.current=WK()),e.createElement(fX,{value:i.current},n)};qK.displayName="ReactFlowProvider";const XK=t=>{let{children:n}=t;return(0,e.useContext)(pX)?e.createElement(e.Fragment,null,n):e.createElement(qK,null,n)};XK.displayName="ReactFlowWrapper";const YK={input:YY,default:qY,output:KY,group:ZY},QK={default:bY,straight:mY,step:fY,smoothstep:pY,simplebezier:lY},KK=[0,0],ZK=[15,15],JK={x:0,y:0,zoom:1},$K={width:"100%",height:"100%",overflow:"hidden",position:"relative",zIndex:0},eZ=(0,e.forwardRef)(((t,n)=>{let{nodes:i,edges:r,defaultNodes:s,defaultEdges:a,className:c,nodeTypes:h=YK,edgeTypes:u=QK,onNodeClick:d,onEdgeClick:p,onInit:f,onMove:m,onMoveStart:g,onMoveEnd:v,onConnect:y,onConnectStart:b,onConnectEnd:x,onClickConnectStart:w,onClickConnectEnd:S,onNodeMouseEnter:_,onNodeMouseMove:E,onNodeMouseLeave:A,onNodeContextMenu:C,onNodeDoubleClick:M,onNodeDragStart:T,onNodeDrag:P,onNodeDragStop:D,onNodesDelete:O,onEdgesDelete:I,onSelectionChange:R,onSelectionDragStart:k,onSelectionDrag:L,onSelectionDragStop:B,onSelectionContextMenu:z,onSelectionStart:N,onSelectionEnd:F,connectionMode:U=eY.Strict,connectionLineType:j=iY.Bezier,connectionLineStyle:V,connectionLineComponent:G,connectionLineContainerStyle:H,deleteKeyCode:W="Backspace",selectionKeyCode:q="Shift",selectionOnDrag:X=!1,selectionMode:Y=nY.Full,panActivationKeyCode:Q="Space",multiSelectionKeyCode:K=(QX()?"Meta":"Control"),zoomActivationKeyCode:Z=(QX()?"Meta":"Control"),snapToGrid:J=!1,snapGrid:$=ZK,onlyRenderVisibleElements:ee=!1,selectNodesOnDrag:te=!0,nodesDraggable:ne,nodesConnectable:ie,nodesFocusable:re,nodeOrigin:se=KK,edgesFocusable:ae,edgesUpdatable:oe,elementsSelectable:le,defaultViewport:ce=JK,minZoom:he=.5,maxZoom:ue=2,translateExtent:de=GK,preventScrolling:pe=!0,nodeExtent:fe,defaultMarkerColor:me="#b1b1b7",zoomOnScroll:ge=!0,zoomOnPinch:ve=!0,panOnScroll:ye=!1,panOnScrollSpeed:be=.5,panOnScrollMode:xe=tY.Free,zoomOnDoubleClick:we=!0,panOnDrag:Se=!0,onPaneClick:_e,onPaneMouseEnter:Ee,onPaneMouseMove:Ae,onPaneMouseLeave:Ce,onPaneScroll:Me,onPaneContextMenu:Te,children:Pe,onEdgeContextMenu:De,onEdgeDoubleClick:Oe,onEdgeMouseEnter:Ie,onEdgeMouseMove:Re,onEdgeMouseLeave:ke,onEdgeUpdate:Le,onEdgeUpdateStart:Be,onEdgeUpdateEnd:ze,onReconnect:Ne,onReconnectStart:Fe,onReconnectEnd:Ue,reconnectRadius:je=10,edgeUpdaterRadius:Ve=10,onNodesChange:Ge,onEdgesChange:He,noDragClassName:We="nodrag",noWheelClassName:qe="nowheel",noPanClassName:Xe="nopan",fitView:Ye=!1,fitViewOptions:Qe,connectOnClick:Ke=!0,attributionPosition:Ze,proOptions:Je,defaultEdgeOptions:$e,elevateNodesOnSelect:et=!0,elevateEdgesOnSelect:tt=!1,disableKeyboardA11y:nt=!1,autoPanOnConnect:it=!0,autoPanOnNodeDrag:rt=!0,connectionRadius:st=20,isValidConnection:at,onError:ot,style:lt,id:ct,nodeDragThreshold:ht}=t,ut=l(t,dX);const dt=ct||"1";return e.createElement("div",o(o({},ut),{},{style:o(o({},lt),$K),ref:n,className:pG(["react-flow",c]),"data-testid":"rf__wrapper",id:ct}),e.createElement(XK,null,e.createElement(VK,{onInit:f,onMove:m,onMoveStart:g,onMoveEnd:v,onNodeClick:d,onEdgeClick:p,onNodeMouseEnter:_,onNodeMouseMove:E,onNodeMouseLeave:A,onNodeContextMenu:C,onNodeDoubleClick:M,nodeTypes:h,edgeTypes:u,connectionLineType:j,connectionLineStyle:V,connectionLineComponent:G,connectionLineContainerStyle:H,selectionKeyCode:q,selectionOnDrag:X,selectionMode:Y,deleteKeyCode:W,multiSelectionKeyCode:K,panActivationKeyCode:Q,zoomActivationKeyCode:Z,onlyRenderVisibleElements:ee,selectNodesOnDrag:te,defaultViewport:ce,translateExtent:de,minZoom:he,maxZoom:ue,preventScrolling:pe,zoomOnScroll:ge,zoomOnPinch:ve,zoomOnDoubleClick:we,panOnScroll:ye,panOnScrollSpeed:be,panOnScrollMode:xe,panOnDrag:Se,onPaneClick:_e,onPaneMouseEnter:Ee,onPaneMouseMove:Ae,onPaneMouseLeave:Ce,onPaneScroll:Me,onPaneContextMenu:Te,onSelectionContextMenu:z,onSelectionStart:N,onSelectionEnd:F,onEdgeContextMenu:De,onEdgeDoubleClick:Oe,onEdgeMouseEnter:Ie,onEdgeMouseMove:Re,onEdgeMouseLeave:ke,onReconnect:null!==Ne&&void 0!==Ne?Ne:Le,onReconnectStart:null!==Fe&&void 0!==Fe?Fe:Be,onReconnectEnd:null!==Ue&&void 0!==Ue?Ue:ze,reconnectRadius:null!==je&&void 0!==je?je:Ve,defaultMarkerColor:me,noDragClassName:We,noWheelClassName:qe,noPanClassName:Xe,elevateEdgesOnSelect:tt,rfId:dt,disableKeyboardA11y:nt,nodeOrigin:se,nodeExtent:fe}),e.createElement(oQ,{nodes:i,edges:r,defaultNodes:s,defaultEdges:a,onConnect:y,onConnectStart:b,onConnectEnd:x,onClickConnectStart:w,onClickConnectEnd:S,nodesDraggable:ne,nodesConnectable:ie,nodesFocusable:re,edgesFocusable:ae,edgesUpdatable:oe,elementsSelectable:le,elevateNodesOnSelect:et,minZoom:he,maxZoom:ue,nodeExtent:fe,onNodesChange:Ge,onEdgesChange:He,snapToGrid:J,snapGrid:$,connectionMode:U,translateExtent:de,connectOnClick:Ke,defaultEdgeOptions:$e,fitView:Ye,fitViewOptions:Qe,onNodesDelete:O,onEdgesDelete:I,onNodeDragStart:T,onNodeDrag:P,onNodeDragStop:D,onSelectionDrag:L,onSelectionDragStart:k,onSelectionDragStop:B,noPanClassName:Xe,nodeOrigin:se,rfId:dt,autoPanOnConnect:it,autoPanOnNodeDrag:rt,onError:ot,connectionRadius:st,isValidConnection:at,nodeDragThreshold:ht}),e.createElement(iQ,{onSelectionChange:R}),Pe,e.createElement(PX,{proOptions:Je,position:Ze}),e.createElement(fQ,{rfId:dt,disableKeyboardA11y:nt})))}));eZ.displayName="ReactFlow";function tZ(t){return n=>{const[i,r]=(0,e.useState)(n),s=(0,e.useCallback)((e=>r((n=>t(e,n)))),[]);return[i,r,s]}}const nZ=tZ(jQ),iZ=tZ((function(e,t){return UQ(e,t)}));const rZ=["children","className"];function sZ(){return e.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 32"},e.createElement("path",{d:"M32 18.133H18.133V32h-4.266V18.133H0v-4.266h13.867V0h4.266v13.867H32z"}))}function aZ(){return e.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 5"},e.createElement("path",{d:"M0 0h32v4.2H0z"}))}function oZ(){return e.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 30"},e.createElement("path",{d:"M3.692 4.63c0-.53.4-.938.939-.938h5.215V0H4.708C2.13 0 0 2.054 0 4.63v5.216h3.692V4.631zM27.354 0h-5.2v3.692h5.17c.53 0 .984.4.984.939v5.215H32V4.631A4.624 4.624 0 0027.354 0zm.954 24.83c0 .532-.4.94-.939.94h-5.215v3.768h5.215c2.577 0 4.631-2.13 4.631-4.707v-5.139h-3.692v5.139zm-23.677.94c-.531 0-.939-.4-.939-.94v-5.138H0v5.139c0 2.577 2.13 4.707 4.708 4.707h5.138V25.77H4.631z"}))}function lZ(){return e.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 25 32"},e.createElement("path",{d:"M21.333 10.667H19.81V7.619C19.81 3.429 16.38 0 12.19 0 8 0 4.571 3.429 4.571 7.619v3.048H3.048A3.056 3.056 0 000 13.714v15.238A3.056 3.056 0 003.048 32h18.285a3.056 3.056 0 003.048-3.048V13.714a3.056 3.056 0 00-3.048-3.047zM12.19 24.533a3.056 3.056 0 01-3.047-3.047 3.056 3.056 0 013.047-3.048 3.056 3.056 0 013.048 3.048 3.056 3.056 0 01-3.048 3.047zm4.724-13.866H7.467V7.619c0-2.59 2.133-4.724 4.723-4.724 2.591 0 4.724 2.133 4.724 4.724v3.048z"}))}function cZ(){return e.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 25 32"},e.createElement("path",{d:"M21.333 10.667H19.81V7.619C19.81 3.429 16.38 0 12.19 0c-4.114 1.828-1.37 2.133.305 2.438 1.676.305 4.42 2.59 4.42 5.181v3.048H3.047A3.056 3.056 0 000 13.714v15.238A3.056 3.056 0 003.048 32h18.285a3.056 3.056 0 003.048-3.048V13.714a3.056 3.056 0 00-3.048-3.047zM12.19 24.533a3.056 3.056 0 01-3.047-3.047 3.056 3.056 0 013.047-3.048 3.056 3.056 0 013.048 3.048 3.056 3.056 0 01-3.048 3.047z"}))}const hZ=t=>{let{children:n,className:i}=t,r=l(t,rZ);return e.createElement("button",o({type:"button",className:pG(["react-flow__controls-button",i])},r),n)};hZ.displayName="ControlButton";const uZ=e=>({isInteractive:e.nodesDraggable||e.nodesConnectable||e.elementsSelectable,minZoomReached:e.transform[2]<=e.minZoom,maxZoomReached:e.transform[2]>=e.maxZoom}),dZ=t=>{let{style:n,showZoom:i=!0,showFitView:r=!0,showInteractive:s=!0,fitViewOptions:a,onZoomIn:o,onZoomOut:l,onFitView:c,onInteractiveChange:h,className:u,children:d,position:p="bottom-left"}=t;const f=CX(),[m,g]=(0,e.useState)(!1),{isInteractive:v,minZoomReached:y,maxZoomReached:b}=AX(uZ,SG),{zoomIn:x,zoomOut:w,fitView:S}=TQ();if((0,e.useEffect)((()=>{g(!0)}),[]),!m)return null;return e.createElement(TX,{className:pG(["react-flow__controls",u]),position:p,style:n,"data-testid":"rf__controls"},i&&e.createElement(e.Fragment,null,e.createElement(hZ,{onClick:()=>{x(),null===o||void 0===o||o()},className:"react-flow__controls-zoomin",title:"zoom in","aria-label":"zoom in",disabled:b},e.createElement(sZ,null)),e.createElement(hZ,{onClick:()=>{w(),null===l||void 0===l||l()},className:"react-flow__controls-zoomout",title:"zoom out","aria-label":"zoom out",disabled:y},e.createElement(aZ,null))),r&&e.createElement(hZ,{className:"react-flow__controls-fitview",onClick:()=>{S(a),null===c||void 0===c||c()},title:"fit view","aria-label":"fit view"},e.createElement(oZ,null)),s&&e.createElement(hZ,{className:"react-flow__controls-interactive",onClick:()=>{f.setState({nodesDraggable:!v,nodesConnectable:!v,elementsSelectable:!v}),null===h||void 0===h||h(!v)},title:"toggle interactivity","aria-label":"toggle interactivity"},v?e.createElement(cZ,null):e.createElement(lZ,null)),d)};dZ.displayName="Controls";var pZ,fZ=(0,e.memo)(dZ);function mZ(t){let{color:n,dimensions:i,lineWidth:r}=t;return e.createElement("path",{stroke:n,strokeWidth:r,d:"M".concat(i[0]/2," 0 V").concat(i[1]," M0 ").concat(i[1]/2," H").concat(i[0])})}function gZ(t){let{color:n,radius:i}=t;return e.createElement("circle",{cx:i,cy:i,r:i,fill:n})}!function(e){e.Lines="lines",e.Dots="dots",e.Cross="cross"}(pZ||(pZ={}));const vZ={[pZ.Dots]:"#91919a",[pZ.Lines]:"#eee",[pZ.Cross]:"#e2e2e2"},yZ={[pZ.Dots]:1,[pZ.Lines]:1,[pZ.Cross]:6},bZ=e=>({transform:e.transform,patternId:"pattern-".concat(e.rfId)});function xZ(t){let{id:n,variant:i=pZ.Dots,gap:r=20,size:s,lineWidth:a=1,offset:l=2,color:c,style:h,className:u}=t;const d=(0,e.useRef)(null),{transform:p,patternId:f}=AX(bZ,SG),m=c||vZ[i],g=s||yZ[i],v=i===pZ.Dots,y=i===pZ.Cross,b=Array.isArray(r)?r:[r,r],x=[b[0]*p[2]||1,b[1]*p[2]||1],w=g*p[2],S=y?[w,w]:x,_=v?[w/l,w/l]:[S[0]/l,S[1]/l];return e.createElement("svg",{className:pG(["react-flow__background",u]),style:o(o({},h),{},{position:"absolute",width:"100%",height:"100%",top:0,left:0}),ref:d,"data-testid":"rf__background"},e.createElement("pattern",{id:f+n,x:p[0]%x[0],y:p[1]%x[1],width:x[0],height:x[1],patternUnits:"userSpaceOnUse",patternTransform:"translate(-".concat(_[0],",-").concat(_[1],")")},v?e.createElement(gZ,{color:m,radius:w/l}):e.createElement(mZ,{dimensions:S,color:m,lineWidth:a})),e.createElement("rect",{x:"0",y:"0",width:"100%",height:"100%",fill:"url(#".concat(f+n,")")}))}xZ.displayName="Background";var wZ=(0,e.memo)(xZ);const SZ={padding:"15px",borderRadius:"8px",background:"white",minWidth:"200px",border:"2px solid #777"},_Z={textNode:e=>{let{data:t,selected:n}=e;return(0,c.jsxs)("div",{style:o(o({},SZ),{},{borderColor:n?"#ff0072":"#777"}),children:[(0,c.jsx)(HY,{type:"target",position:sY.Left,style:{width:"12px",height:"12px",background:"#555"}}),(0,c.jsx)("div",{style:{fontWeight:"bold",marginBottom:"8px"},children:t.label}),t.content&&(0,c.jsxs)("div",{style:{fontSize:"0.9em",color:"#666"},children:[t.content.substring(0,30),"..."]}),(0,c.jsx)("div",{style:{fontSize:"0.8em",color:"#999",marginTop:"5px"},children:"Text Slide"}),(0,c.jsx)(HY,{type:"source",position:sY.Right,style:{width:"12px",height:"12px",background:"#555"}})]})},imageNode:e=>{let{data:t,selected:n}=e;return(0,c.jsxs)("div",{style:o(o({},SZ),{},{borderColor:n?"#ff0072":"#4CAF50"}),children:[(0,c.jsx)(HY,{type:"target",position:sY.Left,style:{width:"12px",height:"12px",background:"#555"}}),(0,c.jsx)("div",{style:{fontWeight:"bold",marginBottom:"8px"},children:t.label}),t.url&&(0,c.jsx)("div",{style:{width:"100%",height:"100px",background:"#f0f0f0",marginBottom:"8px",backgroundImage:"url(".concat(t.url,")"),backgroundSize:"cover",backgroundPosition:"center",borderRadius:"4px"}}),(0,c.jsx)("div",{style:{fontSize:"0.8em",color:"#4CAF50",marginTop:"5px"},children:"Image Slide"}),(0,c.jsx)(HY,{type:"source",position:sY.Right,style:{width:"12px",height:"12px",background:"#555"}})]})},videoNode:e=>{let{data:t,selected:n}=e;return(0,c.jsxs)("div",{style:o(o({},SZ),{},{borderColor:n?"#ff0072":"#9C27B0"}),children:[(0,c.jsx)(HY,{type:"target",position:sY.Left,style:{width:"12px",height:"12px",background:"#555"}}),(0,c.jsx)("div",{style:{fontWeight:"bold",marginBottom:"8px"},children:t.label}),t.videoUrl&&(0,c.jsxs)("div",{style:{width:"100%",height:"100px",background:"#f0f0f0",marginBottom:"8px",borderRadius:"4px",overflow:"hidden",position:"relative"},children:[(0,c.jsx)("video",{src:t.videoUrl,style:{width:"100%",height:"100%",objectFit:"cover"}}),(0,c.jsxs)("div",{style:{position:"absolute",bottom:0,left:0,right:0,padding:"4px 8px",background:"rgba(0,0,0,0.5)",color:"white",fontSize:"0.8em"},children:[t.autoplay?"Autoplay":"Click to play"," ",t.loop?"\u2022 Loop":""]})]}),(0,c.jsx)("div",{style:{fontSize:"0.8em",color:"#9C27B0",marginTop:"5px"},children:"Video Slide"}),(0,c.jsx)(HY,{type:"source",position:sY.Right,style:{width:"12px",height:"12px",background:"#555"}})]})},apiNode:e=>{let{data:t,selected:n}=e;return(0,c.jsxs)("div",{style:o(o({},SZ),{},{borderColor:n?"#ff0072":"#2196F3"}),children:[(0,c.jsx)(HY,{type:"target",position:sY.Left,style:{width:"12px",height:"12px",background:"#555"}}),(0,c.jsx)("div",{style:{fontWeight:"bold",marginBottom:"8px"},children:t.label}),t.apiEndpoint&&(0,c.jsxs)("div",{style:{fontSize:"0.9em",color:"#666",marginBottom:"4px"},children:[t.apiMethod," ",t.apiEndpoint]}),(0,c.jsx)("div",{style:{fontSize:"0.8em",color:"#2196F3",marginTop:"5px"},children:"API Action"}),(0,c.jsx)(HY,{type:"source",position:sY.Right,style:{width:"12px",height:"12px",background:"#555"}})]})},complexObjectNode:e=>{let{data:t,selected:n}=e;return(0,c.jsxs)("div",{style:o(o({},SZ),{},{borderColor:n?"#ff0072":"#FF9800",minHeight:"250px"}),children:[(0,c.jsx)(HY,{type:"target",position:sY.Left,style:{width:"12px",height:"12px",background:"#555"}}),(0,c.jsx)("div",{style:{fontWeight:"bold",marginBottom:"8px"},children:t.label}),t.splineScene&&(0,c.jsx)("div",{style:{width:"100%",height:"200px",background:"#f0f0f0",marginBottom:"8px",borderRadius:"4px",overflow:"hidden",position:"relative"},children:(0,c.jsx)(dG,{style:{width:"100%",height:"100%",position:"absolute",top:0,left:0},scene:t.splineScene,onLoad:()=>console.log("Spline scene loaded")})}),(0,c.jsx)("div",{style:{fontSize:"0.8em",color:"#FF9800",marginTop:"5px"},children:"Complex Object"}),(0,c.jsx)(HY,{type:"source",position:sY.Right,style:{width:"12px",height:"12px",background:"#555"}})]})}},EZ={gesture:e=>{let{id:t,sourceX:n,sourceY:i,targetX:r,targetY:s,sourcePosition:a,targetPosition:o,style:l={},markerEnd:h,data:u,label:d}=e;const[p]=yY({sourceX:n,sourceY:i,sourcePosition:a,targetX:r,targetY:s,targetPosition:o});return(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)("path",{id:t,style:l,className:"react-flow__edge-path",d:p,markerEnd:h}),d&&(0,c.jsx)("text",{children:(0,c.jsx)("textPath",{href:"#".concat(t),style:{fontSize:"12px"},startOffset:"50%",textAnchor:"middle",dominantBaseline:"middle",children:d})})]})}},AZ=["Thumb_Up","Thumb_Down","Open_Palm","Closed_Fist","Victory","Pointing_Up"],CZ=[{id:"textNode",label:"Text Slide",color:"#777"},{id:"imageNode",label:"Image Slide",color:"#4CAF50"},{id:"videoNode",label:"Video Slide",color:"#9C27B0"},{id:"apiNode",label:"API Action",color:"#2196F3"},{id:"complexObjectNode",label:"Complex Object",color:"#FF9800"}],MZ=[{id:"1",type:"textNode",data:{label:"Start",content:"",type:"text"},position:{x:250,y:25}}],TZ=[],PZ=t=>{let{title:n,children:i,defaultOpen:r=!1}=t;const[s,a]=(0,e.useState)(r);return(0,c.jsxs)("div",{style:{marginTop:"15px",borderTop:"1px solid #eee"},children:[(0,c.jsxs)("button",{onClick:()=>a(!s),style:{width:"100%",padding:"10px",background:"none",border:"none",display:"flex",alignItems:"center",justifyContent:"space-between",cursor:"pointer",fontSize:"1em",fontWeight:"bold",color:"#666"},children:[n,(0,c.jsx)("span",{style:{transform:"rotate(".concat(s?180:0,"deg)"),transition:"transform 0.2s"},children:"\u25bc"})]}),s&&(0,c.jsx)("div",{style:{padding:"10px"},children:i})]})},DZ=t=>{var n,i,r,s,a,l,h,u,d,p,f,m,g,v;let{onWorkflowUpdate:y,initialWorkflow:b}=t;const[x,w,S]=nZ((null===b||void 0===b?void 0:b.nodes)||MZ),[_,E,A]=iZ((null===b||void 0===b?void 0:b.edges)||TZ),[C,M]=(0,e.useState)(null),[T,P]=(0,e.useState)(null),[D,O]=(0,e.useState)(""),[I,R]=(0,e.useState)(null);(0,e.useEffect)((()=>{b&&(w(b.nodes),E(b.edges))}),[b,w,E]),(0,e.useEffect)((()=>{R(C?C.data:null)}),[C]);const k=(0,e.useCallback)((e=>{if(!C||!I)return;const t=o(o({},I),e);R(t);const n=o(o({},C),{},{data:t});w((e=>{const t=e.map((e=>e.id===C.id?n:e));return null===y||void 0===y||y({nodes:t,edges:_}),t}))}),[C,I,_,y,w]);(0,e.useEffect)((()=>{var e;T?O((null===(e=T.data)||void 0===e?void 0:e.gesture)||""):O("")}),[T]);const L=(0,e.useCallback)((e=>{if(O(e),T){const t=o(o({},T),{},{data:{gesture:e},label:e,animated:!!e,style:{strokeWidth:2,stroke:e?"#ff0072":"#b1b1b7"}});E((e=>{const n=e.map((e=>e.id===T.id?t:e));return null===y||void 0===y||y({nodes:x,edges:n}),n}))}}),[T,x,y,E]),B=(0,e.useCallback)((e=>{E((t=>{if(t.some((t=>t.source===e.source&&t.target===e.target)))return alert("A connection already exists between these nodes!"),t;const n=o(o({},e),{},{id:"".concat(e.source,"-").concat(e.target,"-").concat(Date.now()),type:"gesture",data:{gesture:""},markerEnd:{type:rY.ArrowClosed},style:{strokeWidth:2},animated:!1,label:"Click to set gesture"}),i=EY(n,t);return null===y||void 0===y||y({nodes:x,edges:i}),P(n),i}))}),[x,y,E]),z=(0,e.useCallback)((()=>{null===y||void 0===y||y({nodes:x,edges:_})}),[x,_,y]),N=(0,e.useCallback)((e=>{var t;const n={id:"".concat(Date.now()),type:e,data:o(o(o(o(o({label:"New ".concat(null===(t=CZ.find((t=>t.id===e)))||void 0===t?void 0:t.label),content:"",type:"apiNode"===e?"api":"imageNode"===e?"image":"videoNode"===e?"video":"complexObjectNode"===e?"complexobject":"text"},"videoNode"===e?{videoUrl:"",autoplay:!1,loop:!1,playPauseGesture:"",scrubForwardGesture:"",scrubBackwardGesture:""}:{}),"imageNode"===e?{url:""}:{}),"complexObjectNode"===e?{rotationDegree:{left:{x:0,y:0},right:{x:0,y:0}}}:{}),"apiNode"===e?{apiEndpoint:"",apiMethod:"GET",apiPayload:""}:{}),{},{pointerMode:"laser"}),position:{x:300*Math.random()+100,y:300*Math.random()+100}};w((e=>{const t=[...e,n];return null===y||void 0===y||y({nodes:t,edges:_}),t}))}),[_,y,w]),F=(0,e.useCallback)(((e,t)=>{e.stopPropagation(),M(t),P(null)}),[]),U=(0,e.useCallback)(((e,t)=>{e.stopPropagation(),P(t),M(null)}),[]),j=(0,e.useMemo)((()=>_Z),[]),V=(0,e.useMemo)((()=>EZ),[]),G=e=>{if(!e)return!0;try{return new URL(e),e.includes("spline.design")}catch(t){return!1}};return(0,c.jsxs)("div",{style:{width:"100%",height:"100%",display:"flex"},onClick:()=>{M(null),P(null)},children:[(0,c.jsx)("div",{style:{flex:1,position:"relative"},onClick:e=>e.stopPropagation(),children:(0,c.jsxs)(eZ,{nodes:x,edges:_,onNodesChange:S,onEdgesChange:A,onConnect:B,onNodeDragStop:z,onNodeClick:F,onEdgeClick:U,nodeTypes:j,edgeTypes:V,connectionMode:eY.Strict,snapToGrid:!0,fitView:!0,defaultEdgeOptions:{type:"gesture",markerEnd:{type:rY.ArrowClosed},style:{strokeWidth:2}},children:[(0,c.jsx)(fZ,{}),(0,c.jsx)(wZ,{}),(0,c.jsx)(TX,{position:"top-left",style:{padding:"10px",display:"flex",gap:"10px",flexDirection:"column"},children:CZ.map((e=>(0,c.jsx)("button",{onClick:()=>N(e.id),style:{padding:"8px 16px",background:e.color,color:"white",border:"none",borderRadius:"4px",cursor:"pointer",display:"flex",alignItems:"center",gap:"8px"},children:(0,c.jsxs)("span",{children:["Add ",e.label]})},e.id)))})]})}),T&&(0,c.jsxs)("div",{style:{width:"300px",padding:"20px",background:"#f8f8f8",borderLeft:"1px solid #ddd",position:"relative"},onClick:e=>e.stopPropagation(),children:[(0,c.jsx)("button",{onClick:()=>P(null),style:{position:"absolute",top:"10px",right:"10px",background:"none",border:"none",fontSize:"20px",cursor:"pointer"},children:"\xd7"}),(0,c.jsx)("h3",{children:"Edit Connection"}),(0,c.jsxs)("div",{style:{marginBottom:"15px"},children:[(0,c.jsxs)("div",{style:{fontSize:"0.9em",color:"#666",marginBottom:"10px"},children:["From: ",null===(n=x.find((e=>e.id===T.source)))||void 0===n?void 0:n.data.label]}),(0,c.jsxs)("div",{style:{fontSize:"0.9em",color:"#666",marginBottom:"15px"},children:["To: ",null===(i=x.find((e=>e.id===T.target)))||void 0===i?void 0:i.data.label]})]}),(0,c.jsxs)("div",{children:[(0,c.jsx)("label",{style:{display:"block",marginBottom:"5px"},children:"Gesture:"}),(0,c.jsxs)("select",{value:D,onChange:e=>L(e.target.value),style:{width:"100%",padding:"8px"},children:[(0,c.jsx)("option",{value:"",children:"Select a gesture..."}),AZ.map((e=>(0,c.jsx)("option",{value:e,children:e.replace("_"," ")},e)))]})]}),(0,c.jsx)("button",{onClick:()=>{E((e=>{const t=e.filter((e=>e.id!==T.id));return null===y||void 0===y||y({nodes:x,edges:t}),t})),P(null)},style:{padding:"8px 16px",background:"#ff0072",color:"white",border:"none",borderRadius:"4px",cursor:"pointer",width:"100%",marginTop:"15px"},children:"Delete Connection"})]}),C&&I&&(0,c.jsxs)("div",{style:{position:"absolute",top:0,right:0,width:"300px",height:"100%",background:"white",boxShadow:"-2px 0 5px rgba(0,0,0,0.1)",padding:"20px",overflowY:"auto"},onClick:e=>e.stopPropagation(),children:[(0,c.jsx)("button",{onClick:()=>M(null),style:{position:"absolute",top:"10px",right:"10px",background:"none",border:"none",fontSize:"20px",cursor:"pointer"},children:"\xd7"}),(0,c.jsx)("h3",{style:{marginTop:0},children:"Edit Node"}),(0,c.jsxs)("div",{style:{marginBottom:"15px"},children:[(0,c.jsx)("label",{style:{display:"block",marginBottom:"5px"},children:"Label:"}),(0,c.jsx)("input",{type:"text",value:I.label,onChange:e=>k({label:e.target.value}),style:{width:"100%",padding:"8px",border:"1px solid #ddd",borderRadius:"4px"}})]}),"text"===I.type&&(0,c.jsx)(PZ,{title:"Content",defaultOpen:!0,children:(0,c.jsx)("textarea",{value:I.content||"",onChange:e=>k({content:e.target.value}),style:{width:"100%",height:"200px",padding:"8px",border:"1px solid #ddd",borderRadius:"4px",resize:"vertical"}})}),"image"===I.type&&(0,c.jsxs)(PZ,{title:"Image Settings",defaultOpen:!0,children:[(0,c.jsx)("input",{type:"text",value:I.url||"",onChange:e=>k({url:e.target.value}),style:{width:"100%",padding:"8px",border:"1px solid #ddd",borderRadius:"4px"},placeholder:"Enter image URL"}),I.url&&(0,c.jsx)("img",{src:I.url,alt:"Preview",style:{width:"100%",height:"auto",marginTop:"10px",borderRadius:"4px"}})]}),"complexobject"===I.type&&(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(PZ,{title:"Complex Object Settings",defaultOpen:!0,children:(0,c.jsxs)("div",{style:{marginBottom:"15px"},children:[(0,c.jsx)("label",{style:{display:"block",marginBottom:"5px"},children:"Spline Scene URL:"}),(0,c.jsx)("input",{type:"text",value:I.splineScene||"",onChange:e=>{try{new URL(e.target.value);k({splineScene:e.target.value})}catch(t){console.error("Invalid URL:",t)}},style:{width:"100%",padding:"8px",border:"1px solid #ddd",borderRadius:"4px",borderColor:G(I.splineScene)?"#ddd":"#ff0072"},placeholder:"https://prod.spline.design/..."}),I.splineScene&&G(I.splineScene)&&(0,c.jsx)("div",{style:{width:"100%",height:"400px",marginTop:"10px",borderRadius:"4px",overflow:"hidden",background:"#f0f0f0"},children:(0,c.jsx)(dG,{scene:I.splineScene,onLoad:()=>k({splineLoaded:!0})})})]})}),(0,c.jsxs)(PZ,{title:"Rotation Controls",children:[(0,c.jsxs)("div",{style:{marginBottom:"15px"},children:[(0,c.jsx)("label",{style:{display:"block",marginBottom:"5px",fontWeight:"bold"},children:"Left Rotation:"}),(0,c.jsxs)("select",{value:(null===(r=I.rotationGesture)||void 0===r?void 0:r.left)||"",onChange:e=>k({rotationGesture:o(o({},I.rotationGesture),{},{left:e.target.value})}),style:{width:"100%",padding:"8px",border:"1px solid #ddd",borderRadius:"4px",marginBottom:"10px"},children:[(0,c.jsx)("option",{value:"",children:"Select a gesture..."}),AZ.map((e=>(0,c.jsx)("option",{value:e,children:e.replace("_"," ")},e)))]}),(0,c.jsxs)("div",{style:{display:"flex",gap:"10px"},children:[(0,c.jsx)("input",{type:"number",min:"0",placeholder:"X rotation",value:(null===(s=I.rotationDegree)||void 0===s||null===(a=s.left)||void 0===a?void 0:a.x)||"",onChange:e=>{var t,n;return k({rotationDegree:o(o({},I.rotationDegree),{},{left:{x:Math.max(0,Number(e.target.value)),y:(null===(t=I.rotationDegree)||void 0===t||null===(n=t.left)||void 0===n?void 0:n.y)||0}})})},style:{width:"50%",padding:"8px",border:"1px solid #ddd",borderRadius:"4px"}}),(0,c.jsx)("input",{type:"number",min:"0",placeholder:"Y rotation",value:(null===(l=I.rotationDegree)||void 0===l||null===(h=l.left)||void 0===h?void 0:h.y)||"",onChange:e=>{var t,n;return k({rotationDegree:o(o({},I.rotationDegree),{},{left:{x:(null===(t=I.rotationDegree)||void 0===t||null===(n=t.left)||void 0===n?void 0:n.x)||0,y:Math.max(0,Number(e.target.value))}})})},style:{width:"50%",padding:"8px",border:"1px solid #ddd",borderRadius:"4px"}})]})]}),(0,c.jsxs)("div",{style:{marginTop:"15px"},children:[(0,c.jsx)("label",{style:{display:"block",marginBottom:"5px",fontWeight:"bold"},children:"Right Rotation:"}),(0,c.jsxs)("select",{value:(null===(u=I.rotationGesture)||void 0===u?void 0:u.right)||"",onChange:e=>k({rotationGesture:o(o({},I.rotationGesture),{},{right:e.target.value})}),style:{width:"100%",padding:"8px",border:"1px solid #ddd",borderRadius:"4px",marginBottom:"10px"},children:[(0,c.jsx)("option",{value:"",children:"Select a gesture..."}),AZ.map((e=>(0,c.jsx)("option",{value:e,children:e.replace("_"," ")},e)))]}),(0,c.jsxs)("div",{style:{display:"flex",gap:"10px"},children:[(0,c.jsx)("input",{type:"number",min:"0",placeholder:"X rotation",value:(null===(d=I.rotationDegree)||void 0===d||null===(p=d.right)||void 0===p?void 0:p.x)||"",onChange:e=>{var t,n;return k({rotationDegree:o(o({},I.rotationDegree),{},{right:{x:Math.max(0,Number(e.target.value)),y:(null===(t=I.rotationDegree)||void 0===t||null===(n=t.right)||void 0===n?void 0:n.y)||0}})})},style:{width:"50%",padding:"8px",border:"1px solid #ddd",borderRadius:"4px"}}),(0,c.jsx)("input",{type:"number",min:"0",placeholder:"Y rotation",value:(null===(f=I.rotationDegree)||void 0===f||null===(m=f.right)||void 0===m?void 0:m.y)||"",onChange:e=>{var t,n;return k({rotationDegree:o(o({},I.rotationDegree),{},{right:{x:(null===(t=I.rotationDegree)||void 0===t||null===(n=t.right)||void 0===n?void 0:n.x)||0,y:Math.max(0,Number(e.target.value))}})})},style:{width:"50%",padding:"8px",border:"1px solid #ddd",borderRadius:"4px"}})]})]})]})]}),"video"===I.type&&(0,c.jsxs)(c.Fragment,{children:[(0,c.jsxs)(PZ,{title:"Video Settings",defaultOpen:!0,children:[(0,c.jsx)("input",{type:"text",value:I.videoUrl||"",onChange:e=>k({videoUrl:e.target.value}),style:{width:"100%",padding:"8px",border:"1px solid #ddd",borderRadius:"4px"},placeholder:"Enter video URL"}),(0,c.jsxs)("div",{style:{marginTop:"10px"},children:[(0,c.jsxs)("label",{style:{display:"flex",alignItems:"center",marginBottom:"5px",cursor:"pointer"},children:[(0,c.jsx)("input",{type:"checkbox",checked:I.autoplay||!1,onChange:e=>k({autoplay:e.target.checked}),style:{marginRight:"8px"}}),"Autoplay"]}),(0,c.jsxs)("label",{style:{display:"flex",alignItems:"center",cursor:"pointer"},children:[(0,c.jsx)("input",{type:"checkbox",checked:I.loop||!1,onChange:e=>k({loop:e.target.checked}),style:{marginRight:"8px"}}),"Loop video"]})]}),(0,c.jsxs)("div",{style:{marginTop:"10px"},children:[(0,c.jsx)("label",{style:{display:"block",marginBottom:"5px"},children:"Scrub Amount (seconds):"}),(0,c.jsx)("input",{type:"number",min:"1",step:"1",placeholder:"Default: 5",value:I.scrubAmount||"",onChange:e=>k({scrubAmount:Number(e.target.value)}),style:{width:"100%",padding:"8px",border:"1px solid #ddd",borderRadius:"4px"}})]})]}),(0,c.jsxs)(PZ,{title:"Video Control Gestures",children:[(0,c.jsxs)("div",{style:{marginBottom:"15px"},children:[(0,c.jsx)("label",{style:{display:"block",marginBottom:"5px"},children:"Play/Pause Gesture:"}),(0,c.jsxs)("select",{value:I.playPauseGesture||"",onChange:e=>k({playPauseGesture:e.target.value}),style:{width:"100%",padding:"8px",border:"1px solid #ddd",borderRadius:"4px"},children:[(0,c.jsx)("option",{value:"",children:"Select a gesture..."}),AZ.map((e=>(0,c.jsx)("option",{value:e,children:e.replace("_"," ")},e)))]})]}),(0,c.jsxs)("div",{style:{marginBottom:"15px"},children:[(0,c.jsx)("label",{style:{display:"block",marginBottom:"5px"},children:"Scrub Forward Gesture:"}),(0,c.jsxs)("select",{value:I.scrubForwardGesture||"",onChange:e=>k({scrubForwardGesture:e.target.value}),style:{width:"100%",padding:"8px",border:"1px solid #ddd",borderRadius:"4px"},children:[(0,c.jsx)("option",{value:"",children:"Select a gesture..."}),AZ.map((e=>(0,c.jsx)("option",{value:e,children:e.replace("_"," ")},e)))]})]}),(0,c.jsxs)("div",{style:{marginBottom:"15px"},children:[(0,c.jsx)("label",{style:{display:"block",marginBottom:"5px"},children:"Scrub Backward Gesture:"}),(0,c.jsxs)("select",{value:I.scrubBackwardGesture||"",onChange:e=>k({scrubBackwardGesture:e.target.value}),style:{width:"100%",padding:"8px",border:"1px solid #ddd",borderRadius:"4px"},children:[(0,c.jsx)("option",{value:"",children:"Select a gesture..."}),AZ.map((e=>(0,c.jsx)("option",{value:e,children:e.replace("_"," ")},e)))]})]})]})]}),"api"===I.type&&(0,c.jsxs)(PZ,{title:"API Settings",defaultOpen:!0,children:[(0,c.jsxs)("div",{style:{marginBottom:"15px"},children:[(0,c.jsx)("label",{style:{display:"block",marginBottom:"5px"},children:"API Endpoint:"}),(0,c.jsx)("input",{type:"text",value:I.apiEndpoint||"",onChange:e=>k({apiEndpoint:e.target.value}),style:{width:"100%",padding:"8px",border:"1px solid #ddd",borderRadius:"4px"}})]}),(0,c.jsxs)("div",{style:{marginBottom:"15px"},children:[(0,c.jsx)("label",{style:{display:"block",marginBottom:"5px"},children:"Method:"}),(0,c.jsxs)("select",{value:I.apiMethod||"GET",onChange:e=>k({apiMethod:e.target.value}),style:{width:"100%",padding:"8px",border:"1px solid #ddd",borderRadius:"4px"},children:[(0,c.jsx)("option",{value:"GET",children:"GET"}),(0,c.jsx)("option",{value:"POST",children:"POST"}),(0,c.jsx)("option",{value:"PUT",children:"PUT"}),(0,c.jsx)("option",{value:"DELETE",children:"DELETE"})]})]}),(0,c.jsxs)("div",{style:{marginBottom:"15px"},children:[(0,c.jsx)("label",{style:{display:"block",marginBottom:"5px"},children:"Payload (JSON):"}),(0,c.jsx)("textarea",{value:I.apiPayload||"",onChange:e=>k({apiPayload:e.target.value}),style:{width:"100%",height:"150px",padding:"8px",border:"1px solid #ddd",borderRadius:"4px",fontFamily:"monospace",resize:"vertical"}})]})]}),(0,c.jsxs)(PZ,{title:"Zoom Settings",children:[(0,c.jsx)("label",{style:{display:"block",marginBottom:"5px"},children:"Zoom Point:"}),(0,c.jsxs)("div",{style:{display:"flex",gap:"10px"},children:[(0,c.jsx)("input",{type:"number",placeholder:"X %",value:(null===(g=I.zoomPoint)||void 0===g?void 0:g.x)||"",onChange:e=>{var t;return k({zoomPoint:{x:Number(e.target.value),y:(null===(t=I.zoomPoint)||void 0===t?void 0:t.y)||50}})},style:{width:"50%",padding:"8px",border:"1px solid #ddd",borderRadius:"4px"}}),(0,c.jsx)("input",{type:"number",placeholder:"Y %",value:(null===(v=I.zoomPoint)||void 0===v?void 0:v.y)||"",onChange:e=>{var t;return k({zoomPoint:{x:(null===(t=I.zoomPoint)||void 0===t?void 0:t.x)||50,y:Number(e.target.value)}})},style:{width:"50%",padding:"8px",border:"1px solid #ddd",borderRadius:"4px"}})]}),(0,c.jsx)("div",{style:{fontSize:"0.8em",color:"#666",marginTop:"5px"},children:"Enter values between 0-100 to set the zoom center point"}),(0,c.jsxs)("div",{style:{marginTop:"15px"},children:[(0,c.jsx)("label",{style:{display:"block",marginBottom:"5px"},children:"Min Zoom Level:"}),(0,c.jsx)("input",{type:"number",step:"0.1",min:"0.1",placeholder:"Default: 1",value:I.minZoom||"",onChange:e=>k({minZoom:Number(e.target.value)}),style:{width:"100%",padding:"8px",border:"1px solid #ddd",borderRadius:"4px"}})]}),(0,c.jsxs)("div",{style:{marginTop:"15px"},children:[(0,c.jsx)("label",{style:{display:"block",marginBottom:"5px"},children:"Max Zoom Level:"}),(0,c.jsx)("input",{type:"number",step:"0.1",min:"0.1",placeholder:"Default: 4",value:I.maxZoom||"",onChange:e=>k({maxZoom:Number(e.target.value)}),style:{width:"100%",padding:"8px",border:"1px solid #ddd",borderRadius:"4px"}})]}),(0,c.jsxs)("div",{style:{marginTop:"15px"},children:[(0,c.jsx)("label",{style:{display:"block",marginBottom:"5px"},children:"Zoom In Gesture:"}),(0,c.jsxs)("select",{value:I.zoomInGesture||"",onChange:e=>k({zoomInGesture:e.target.value}),style:{width:"100%",padding:"8px",border:"1px solid #ddd",borderRadius:"4px"},children:[(0,c.jsx)("option",{value:"",children:"Select a gesture..."}),AZ.map((e=>(0,c.jsx)("option",{value:e,children:e.replace("_"," ")},e)))]})]}),(0,c.jsxs)("div",{style:{marginTop:"15px"},children:[(0,c.jsx)("label",{style:{display:"block",marginBottom:"5px"},children:"Zoom Out Gesture:"}),(0,c.jsxs)("select",{value:I.zoomOutGesture||"",onChange:e=>k({zoomOutGesture:e.target.value}),style:{width:"100%",padding:"8px",border:"1px solid #ddd",borderRadius:"4px"},children:[(0,c.jsx)("option",{value:"",children:"Select a gesture..."}),AZ.map((e=>(0,c.jsx)("option",{value:e,children:e.replace("_"," ")},e)))]})]})]}),(0,c.jsxs)(PZ,{title:"Pointer Settings",children:[(0,c.jsxs)("div",{style:{marginBottom:"15px"},children:[(0,c.jsx)("label",{style:{display:"block",marginBottom:"5px"},children:"Pointer Mode:"}),(0,c.jsxs)("select",{value:I.pointerMode||"laser",onChange:e=>k({pointerMode:e.target.value}),style:{width:"100%",padding:"8px",border:"1px solid #ddd",borderRadius:"4px"},children:[(0,c.jsx)("option",{value:"laser",children:"Laser (Red Dot)"}),(0,c.jsx)("option",{value:"canvas",children:"Canvas (Writing)"})]})]}),(0,c.jsxs)("div",{style:{marginTop:"15px"},children:[(0,c.jsx)("label",{style:{display:"block",marginBottom:"5px"},children:"Pointer Color:"}),(0,c.jsx)("input",{type:"color",value:I.pointerColor||"#ff0000",onChange:e=>k({pointerColor:e.target.value}),style:{width:"100%",padding:"2px",border:"1px solid #ddd",borderRadius:"4px"}})]}),(0,c.jsxs)("div",{style:{marginTop:"15px"},children:[(0,c.jsx)("label",{style:{display:"block",marginBottom:"5px"},children:"Pointer Size:"}),(0,c.jsx)("input",{type:"number",min:"1",max:"50",step:"1",placeholder:"Default: 10",value:I.pointerSize||"",onChange:e=>k({pointerSize:Number(e.target.value)}),style:{width:"100%",padding:"8px",border:"1px solid #ddd",borderRadius:"4px"}})]}),(0,c.jsxs)("div",{style:{marginTop:"15px"},children:[(0,c.jsx)("label",{style:{display:"block",marginBottom:"5px"},children:"Pointer Start Gesture:"}),(0,c.jsxs)("select",{value:I.pointerStartGesture||"",onChange:e=>k({pointerStartGesture:e.target.value}),style:{width:"100%",padding:"8px",border:"1px solid #ddd",borderRadius:"4px"},children:[(0,c.jsx)("option",{value:"",children:"Select a gesture..."}),AZ.map((e=>(0,c.jsx)("option",{value:e,children:e.replace("_"," ")},e)))]})]}),(0,c.jsxs)("div",{style:{marginTop:"15px"},children:[(0,c.jsx)("label",{style:{display:"block",marginBottom:"5px"},children:"Pointer Stop Gesture:"}),(0,c.jsxs)("select",{value:I.pointerStopGesture||"",onChange:e=>k({pointerStopGesture:e.target.value}),style:{width:"100%",padding:"8px",border:"1px solid #ddd",borderRadius:"4px"},children:[(0,c.jsx)("option",{value:"",children:"Select a gesture..."}),AZ.map((e=>(0,c.jsx)("option",{value:e,children:e.replace("_"," ")},e)))]})]})]}),(0,c.jsx)("div",{style:{marginTop:"20px"},children:(0,c.jsx)("button",{onClick:()=>{w((e=>{const t=e.filter((e=>e.id!==C.id));return E((e=>{const n=e.filter((e=>e.source!==C.id&&e.target!==C.id));return null===y||void 0===y||y({nodes:t,edges:n}),n})),t})),M(null)},style:{padding:"8px 16px",background:"#ff0072",color:"white",border:"none",borderRadius:"4px",cursor:"pointer",width:"100%"},children:"Delete Node"})})]})]})};var OZ,IZ=n(29),RZ=n.n(IZ);var kZ="undefined"!=typeof self?self:{};function LZ(){throw Error("Invalid UTF8")}function BZ(e,t){return t=String.fromCharCode.apply(null,t),null==e?t:e+t}let zZ,NZ;const FZ="undefined"!=typeof TextDecoder;let UZ;const jZ="undefined"!=typeof TextEncoder;function VZ(e){if(jZ)e=(UZ||(UZ=new TextEncoder)).encode(e);else{let n=0;const i=new Uint8Array(3*e.length);for(let r=0;r<e.length;r++){var t=e.charCodeAt(r);if(t<128)i[n++]=t;else{if(t<2048)i[n++]=t>>6|192;else{if(t>=55296&&t<=57343){if(t<=56319&&r<e.length){const s=e.charCodeAt(++r);if(s>=56320&&s<=57343){t=1024*(t-55296)+s-56320+65536,i[n++]=t>>18|240,i[n++]=t>>12&63|128,i[n++]=t>>6&63|128,i[n++]=63&t|128;continue}r--}t=65533}i[n++]=t>>12|224,i[n++]=t>>6&63|128}i[n++]=63&t|128}}e=n===i.length?i:i.subarray(0,n)}return e}var GZ,HZ;e:{for(var WZ=["CLOSURE_FLAGS"],qZ=kZ,XZ=0;XZ<WZ.length;XZ++)if(null==(qZ=qZ[WZ[XZ]])){HZ=null;break e}HZ=qZ}var YZ,QZ=HZ&&HZ[610401301];GZ=null!=QZ&&QZ;const KZ=kZ.navigator;function ZZ(e){return!!GZ&&!!YZ&&YZ.brands.some((t=>{let{brand:n}=t;return n&&-1!=n.indexOf(e)}))}function JZ(e){var t;return(t=kZ.navigator)&&(t=t.userAgent)||(t=""),-1!=t.indexOf(e)}function $Z(){return!!GZ&&!!YZ&&YZ.brands.length>0}function eJ(){return $Z()?ZZ("Chromium"):(JZ("Chrome")||JZ("CriOS"))&&!(!$Z()&&JZ("Edge"))||JZ("Silk")}function tJ(e){return tJ[" "](e),e}YZ=KZ&&KZ.userAgentData||null,tJ[" "]=function(){};var nJ=!$Z()&&(JZ("Trident")||JZ("MSIE"));!JZ("Android")||eJ(),eJ(),JZ("Safari")&&(eJ()||!$Z()&&JZ("Coast")||!$Z()&&JZ("Opera")||!$Z()&&JZ("Edge")||($Z()?ZZ("Microsoft Edge"):JZ("Edg/"))||$Z()&&ZZ("Opera"));var iJ={},rJ=null;function sJ(){if(!rJ){rJ={};var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".split(""),t=["+/=","+/","-_=","-_.","-_"];for(let n=0;n<5;n++){const i=e.concat(t[n].split(""));iJ[n]=i;for(let e=0;e<i.length;e++){const t=i[e];void 0===rJ[t]&&(rJ[t]=e)}}}}var aJ="undefined"!=typeof Uint8Array,oJ=!nJ&&"function"==typeof btoa;function lJ(e){if(!oJ){var t;void 0===t&&(t=0),sJ(),t=iJ[t];var n=Array(Math.floor(e.length/3)),i=t[64]||"";let l=0,c=0;for(;l<e.length-2;l+=3){var r=e[l],s=e[l+1],a=e[l+2],o=t[r>>2];r=t[(3&r)<<4|s>>4],s=t[(15&s)<<2|a>>6],a=t[63&a],n[c++]=o+r+s+a}switch(o=0,a=i,e.length-l){case 2:a=t[(15&(o=e[l+1]))<<2]||i;case 1:e=e[l],n[c]=t[e>>2]+t[(3&e)<<4|o>>4]+a+i}return n.join("")}for(t="",n=0,i=e.length-10240;n<i;)t+=String.fromCharCode.apply(null,e.subarray(n,n+=10240));return t+=String.fromCharCode.apply(null,n?e.subarray(n):e),btoa(t)}const cJ=/[-_.]/g,hJ={"-":"+",_:"/",".":"="};function uJ(e){return hJ[e]||""}function dJ(e){if(!oJ)return function(e){const t=e.length;let n=3*t/4;n%3?n=Math.floor(n):-1!="=.".indexOf(e[t-1])&&(n=-1!="=.".indexOf(e[t-2])?n-2:n-1);const i=new Uint8Array(n);let r=0;return function(e,t){function n(t){for(;i<e.length;){const t=e.charAt(i++),n=rJ[t];if(null!=n)return n;if(!/^[\s\xa0]*$/.test(t))throw Error("Unknown base64 encoding at char: "+t)}return t}sJ();let i=0;for(;;){const e=n(-1),i=n(0),r=n(64),s=n(64);if(64===s&&-1===e)break;t(e<<2|i>>4),64!=r&&(t(i<<4&240|r>>2),64!=s&&t(r<<6&192|s))}}(e,(function(e){i[r++]=e})),r!==n?i.subarray(0,r):i}(e);cJ.test(e)&&(e=e.replace(cJ,uJ)),e=atob(e);const t=new Uint8Array(e.length);for(let n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}function pJ(e){return aJ&&null!=e&&e instanceof Uint8Array}var fJ={};function mJ(){return yJ||(yJ=new vJ(null,fJ))}function gJ(e){xJ(fJ);var t=e.g;return null==(t=null==t||pJ(t)?t:"string"==typeof t?dJ(t):null)?t:e.g=t}var vJ=class{h(){return new Uint8Array(gJ(this)||0)}constructor(e,t){if(xJ(t),this.g=e,null!=e&&0===e.length)throw Error("ByteString should be constructed with non-empty values")}};let yJ,bJ;function xJ(e){if(e!==fJ)throw Error("illegal external caller")}function wJ(e,t){e.__closure__error__context__984382||(e.__closure__error__context__984382={}),e.__closure__error__context__984382.severity=t}function SJ(e){return wJ(e=Error(e),"warning"),e}var _J="function"==typeof Symbol&&"symbol"==typeof Symbol(),EJ=new Set;function AJ(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return e="function"==typeof Symbol&&"symbol"==typeof Symbol()?i&&Symbol.for&&e?Symbol.for(e):null!=e?Symbol(e):Symbol():t,n&&EJ.add(e),e}var CJ=AJ("jas",void 0,!0,!0),MJ=AJ(void 0,"0di"),TJ=AJ(void 0,"2ex"),PJ=AJ(void 0,"1oa",!0),DJ=AJ(void 0,Symbol(),!0);const OJ=_J?CJ:"Ga",IJ={Ga:{value:0,configurable:!0,writable:!0,enumerable:!1}},RJ=Object.defineProperties;function kJ(e,t){_J||OJ in e||RJ(e,IJ),e[OJ]|=t}function LJ(e,t){_J||OJ in e||RJ(e,IJ),e[OJ]=t}function BJ(e){return kJ(e,34),e}function zJ(e,t){LJ(t,-30975&e)}function NJ(e,t){LJ(t,-30941&e|34)}function FJ(){return"function"==typeof BigInt}function UJ(e){return Array.prototype.slice.call(e)}var jJ,VJ={},GJ={};function HJ(e){return!(!e||"object"!=typeof e||e.Ia!==GJ)}function WJ(e){return null!==e&&"object"==typeof e&&!Array.isArray(e)&&e.constructor===Object}function qJ(e,t){if(null!=e)if("string"==typeof e)e=e?new vJ(e,fJ):mJ();else if(e.constructor!==vJ)if(pJ(e))e=e.length?new vJ(new Uint8Array(e),fJ):mJ();else{if(!t)throw Error();e=void 0}return e}function XJ(e){return!(!Array.isArray(e)||e.length)&&!!(1&e[OJ])}const YJ=[];function QJ(e){if(2&e)throw Error()}LJ(YJ,55),jJ=Object.freeze(YJ);class KJ{constructor(e,t,n){this.l=0,this.g=e,this.h=t,this.m=n}next(){if(this.l<this.g.length){const e=this.g[this.l++];return{done:!1,value:this.h?this.h.call(this.m,e):e}}return{done:!0,value:void 0}}[Symbol.iterator](){return new KJ(this.g,this.h,this.m)}}function ZJ(e){return DJ?e[DJ]:void 0}var JJ=Object.freeze({});function $J(e){return e.Qa=!0,e}var e$=$J((e=>"number"==typeof e)),t$=$J((e=>"string"==typeof e)),n$=$J((e=>"boolean"==typeof e)),i$="function"==typeof kZ.BigInt&&"bigint"==typeof kZ.BigInt(0),r$=$J((e=>i$?e>=a$&&e<=l$:"-"===e[0]?c$(e,s$):c$(e,o$)));const s$=Number.MIN_SAFE_INTEGER.toString(),a$=i$?BigInt(Number.MIN_SAFE_INTEGER):void 0,o$=Number.MAX_SAFE_INTEGER.toString(),l$=i$?BigInt(Number.MAX_SAFE_INTEGER):void 0;function c$(e,t){if(e.length>t.length)return!1;if(e.length<t.length||e===t)return!0;for(let n=0;n<e.length;n++){const i=e[n],r=t[n];if(i>r)return!1;if(i<r)return!0}}const h$="function"==typeof Uint8Array.prototype.slice;let u$,d$=0,p$=0;function f$(e){const t=e>>>0;d$=t,p$=(e-t)/4294967296>>>0}function m$(e){if(e<0){f$(-e);const[t,n]=S$(d$,p$);d$=t>>>0,p$=n>>>0}else f$(e)}function g$(e){const t=u$||(u$=new DataView(new ArrayBuffer(8)));t.setFloat32(0,+e,!0),p$=0,d$=t.getUint32(0,!0)}function v$(e,t){const n=4294967296*t+(e>>>0);return Number.isSafeInteger(n)?n:b$(e,t)}function y$(e,t){const n=2147483648&t;return n&&(t=~t>>>0,0==(e=1+~e>>>0)&&(t=t+1>>>0)),"number"==typeof(e=v$(e,t))?n?-e:e:n?"-"+e:e}function b$(e,t){if(e>>>=0,(t>>>=0)<=2097151)var n=""+(4294967296*t+e);else FJ()?n=""+(BigInt(t)<<BigInt(32)|BigInt(e)):(e=(16777215&e)+6777216*(n=16777215&(e>>>24|t<<8))+6710656*(t=t>>16&65535),n+=8147497*t,t*=2,e>=1e7&&(n+=e/1e7>>>0,e%=1e7),n>=1e7&&(t+=n/1e7>>>0,n%=1e7),n=t+x$(n)+x$(e));return n}function x$(e){return e=String(e),"0000000".slice(e.length)+e}function w$(e){if(e.length<16)m$(Number(e));else if(FJ())e=BigInt(e),d$=Number(e&BigInt(4294967295))>>>0,p$=Number(e>>BigInt(32)&BigInt(4294967295));else{const t=+("-"===e[0]);p$=d$=0;const n=e.length;for(let i=t,r=(n-t)%6+t;r<=n;i=r,r+=6){const t=Number(e.slice(i,r));p$*=1e6,d$=1e6*d$+t,d$>=4294967296&&(p$+=Math.trunc(d$/4294967296),p$>>>=0,d$>>>=0)}if(t){const[e,t]=S$(d$,p$);d$=e,p$=t}}}function S$(e,t){return t=~t,e?e=1+~e:t+=1,[e,t]}const _$="function"==typeof BigInt?BigInt.asIntN:void 0,E$="function"==typeof BigInt?BigInt.asUintN:void 0,A$=Number.isSafeInteger,C$=Number.isFinite,M$=Math.trunc;function T$(e){return null==e||"number"==typeof e?e:"NaN"===e||"Infinity"===e||"-Infinity"===e?Number(e):void 0}function P$(e){return null==e||"boolean"==typeof e?e:"number"==typeof e?!!e:void 0}const D$=/^-?([1-9][0-9]*|0)(\.[0-9]+)?$/;function O$(e){switch(typeof e){case"bigint":return!0;case"number":return C$(e);case"string":return D$.test(e);default:return!1}}function I$(e){if(null==e)return e;if("string"==typeof e&&e)e=+e;else if("number"!=typeof e)return;return C$(e)?0|e:void 0}function R$(e){if(null==e)return e;if("string"==typeof e&&e)e=+e;else if("number"!=typeof e)return;return C$(e)?e>>>0:void 0}function k$(e){if("-"===e[0])return!1;const t=e.length;return t<20||20===t&&Number(e.substring(0,6))<184467}function L$(e){return e=M$(e),A$(e)||(m$(e),e=y$(d$,p$)),e}function B$(e){var t=M$(Number(e));if(A$(t))return String(t);if(-1!==(t=e.indexOf("."))&&(e=e.substring(0,t)),t=e.length,!("-"===e[0]?t<20||20===t&&Number(e.substring(0,7))>-922337:t<19||19===t&&Number(e.substring(0,6))<922337))if(w$(e),e=d$,2147483648&(t=p$))if(FJ())e=""+(BigInt(0|t)<<BigInt(32)|BigInt(e>>>0));else{const[n,i]=S$(e,t);e="-"+b$(n,i)}else e=b$(e,t);return e}function z$(e){return null==e?e:"bigint"==typeof e?(r$(e)?e=Number(e):(e=_$(64,e),e=r$(e)?Number(e):String(e)),e):O$(e)?"number"==typeof e?L$(e):B$(e):void 0}function N$(e){if("string"!=typeof e)throw Error();return e}function F$(e){if(null!=e&&"string"!=typeof e)throw Error();return e}function U$(e){return null==e||"string"==typeof e?e:void 0}function j$(e,t,n,i){if(null!=e&&"object"==typeof e&&e.W===VJ)return e;if(!Array.isArray(e))return n?2&i?((e=t[MJ])||(BJ((e=new t).u),e=t[MJ]=e),t=e):t=new t:t=void 0,t;let r=n=0|e[OJ];return 0===r&&(r|=32&i),r|=2&i,r!==n&&LJ(e,r),new t(e)}function V$(e,t,n){if(t)e:{if(!O$(t=e))throw SJ("int64");switch(typeof t){case"string":t=B$(t);break e;case"bigint":if(e=t=_$(64,t),t$(e)){if(!/^\s*(?:-?[1-9]\d*|0)?\s*$/.test(e))throw Error(String(e))}else if(e$(e)&&!Number.isSafeInteger(e))throw Error(String(e));t=i$?BigInt(t):n$(t)?t?"1":"0":t$(t)?t.trim()||"0":String(t);break e;default:t=L$(t)}}else t=z$(e);return"string"==typeof(n=null==(e=t)?n?0:void 0:e)&&A$(t=+n)?t:n}const G$={};let H$=function(){try{return tJ(new class extends Map{constructor(){super()}}),!1}catch(e){return!0}}();class W${constructor(){this.g=new Map}get(e){return this.g.get(e)}set(e,t){return this.g.set(e,t),this.size=this.g.size,this}delete(e){return e=this.g.delete(e),this.size=this.g.size,e}clear(){this.g.clear(),this.size=this.g.size}has(e){return this.g.has(e)}entries(){return this.g.entries()}keys(){return this.g.keys()}values(){return this.g.values()}forEach(e,t){return this.g.forEach(e,t)}[Symbol.iterator](){return this.entries()}}const q$=H$?(Object.setPrototypeOf(W$.prototype,Map.prototype),Object.defineProperties(W$.prototype,{size:{value:0,configurable:!0,enumerable:!0,writable:!0}}),W$):class extends Map{constructor(){super()}};function X$(e){return e}function Y$(e){if(2&e.L)throw Error("Cannot mutate an immutable Map")}var Q$=class extends q${constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:X$,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:X$;super();let r=0|e[OJ];r|=64,LJ(e,r),this.L=r,this.S=t,this.R=n,this.Y=this.S?K$:i;for(let s=0;s<e.length;s++){const a=e[s],o=n(a[0],!1,!0);let l=a[1];t?void 0===l&&(l=null):l=i(a[1],!1,!0,void 0,void 0,r),super.set(o,l)}}na(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Z$;if(0!==this.size)return this.X(e)}X(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Z$;const t=[],n=super.entries();for(var i;!(i=n.next()).done;)(i=i.value)[0]=e(i[0]),i[1]=e(i[1]),t.push(i);return t}clear(){Y$(this),super.clear()}delete(e){return Y$(this),super.delete(this.R(e,!0,!1))}entries(){var e=this.ma();return new KJ(e,J$,this)}keys(){return this.Ha()}values(){var e=this.ma();return new KJ(e,Q$.prototype.get,this)}forEach(e,t){super.forEach(((n,i)=>{e.call(t,this.get(i),i,this)}))}set(e,t){return Y$(this),null==(e=this.R(e,!0,!1))?this:null==t?(super.delete(e),this):super.set(e,this.Y(t,!0,!0,this.S,!1,this.L))}Na(e){const t=this.R(e[0],!1,!0);e=e[1],e=this.S?void 0===e?null:e:this.Y(e,!1,!0,void 0,!1,this.L),super.set(t,e)}has(e){return super.has(this.R(e,!1,!1))}get(e){e=this.R(e,!1,!1);const t=super.get(e);if(void 0!==t){var n=this.S;return n?((n=this.Y(t,!1,!0,n,this.ra,this.L))!==t&&super.set(e,n),n):t}}ma(){return Array.from(super.keys())}Ha(){return super.keys()}[Symbol.iterator](){return this.entries()}};function K$(e,t,n,i,r,s){return e=j$(e,i,n,s),r&&(e=d0(e)),e}function Z$(e){return e}function J$(e){return[e,this.get(e)]}let $$,e0,t0;function n0(){return $$||($$=new Q$(BJ([]),void 0,void 0,void 0,G$))}function i0(e,t,n,i,r){if(null!=e){if(Array.isArray(e))e=XJ(e)?void 0:r&&2&e[OJ]?e:r0(e,t,n,void 0!==i,r);else if(WJ(e)){const s={};for(let a in e)s[a]=i0(e[a],t,n,i,r);e=s}else e=t(e,i);return e}}function r0(e,t,n,i,r){const s=i||n?0|e[OJ]:0,a=i?!!(32&s):void 0;i=UJ(e);for(let o=0;o<i.length;o++)i[o]=i0(i[o],t,n,a,r);return n&&((e=ZJ(e))&&(i[DJ]=UJ(e)),n(s,i)),i}function s0(e){return i0(e,a0,void 0,void 0,!1)}function a0(e){return e.W===VJ?e.toJSON():e instanceof Q$?e.na(s0):function(e){switch(typeof e){case"number":return isFinite(e)?e:String(e);case"bigint":return r$(e)?Number(e):String(e);case"boolean":return e?1:0;case"object":if(e)if(Array.isArray(e)){if(XJ(e))return}else{if(pJ(e))return lJ(e);if(e instanceof vJ){const t=e.g;return null==t?"":"string"==typeof t?t:e.g=lJ(t)}if(e instanceof Q$)return e.na()}}return e}(e)}function o0(e){return r0(e,a0,void 0,void 0,!1)}function l0(e,t,n){return e=c0(e,t[0],t[1],n?1:2),t!==e0&&n&&kJ(e,16384),e}function c0(e,t,n,i){if(null==e){var r=96;n?(e=[n],r|=512):e=[],t&&(r=-33521665&r|(1023&t)<<15)}else{if(!Array.isArray(e))throw Error("narr");if(2048&(r=0|e[OJ]))throw Error("farr");if(64&r)return e;if(1===i||2===i||(r|=64),n&&(r|=512,n!==e[0]))throw Error("mid");e:{if(i=(n=e).length){const e=i-1;if(WJ(n[e])){if((t=e-(512&(r|=256)?0:-1))>=1024)throw Error("pvtlmt");r=-33521665&r|(1023&t)<<15;break e}}if(t){if((t=Math.max(t,i-(512&r?0:-1)))>1024)throw Error("spvt");r=-33521665&r|(1023&t)<<15}}}return LJ(e,r),e}function h0(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:NJ;if(null!=e){if(aJ&&e instanceof Uint8Array)return t?e:new Uint8Array(e);if(Array.isArray(e)){var i=0|e[OJ];return 2&i?e:(t&&(t=0===i||!!(32&i)&&!(64&i||!(16&i))),t?(LJ(e,-12293&i|34),e):r0(e,h0,4&i?NJ:n,!0,!0))}return e.W===VJ?e=2&(i=0|(n=e.u)[OJ])?e:new e.constructor(u0(n,i,!0)):e instanceof Q$&&!(2&e.L)&&(n=BJ(e.X(h0)),e=new Q$(n,e.S,e.R,e.Y)),e}}function u0(e,t,n){const i=n||2&t?NJ:zJ,r=!!(32&t);return e=function(e,t,n){const i=UJ(e);var r=i.length;const s=256&t?i[r-1]:void 0;for(r+=s?-1:0,t=512&t?1:0;t<r;t++)i[t]=n(i[t]);if(s){t=i[t]={};for(const e in s)t[e]=n(s[e])}return(e=ZJ(e))&&(i[DJ]=UJ(e)),i}(e,t,(e=>h0(e,r,i))),kJ(e,32|(n?2:0)),e}function d0(e){const t=e.u,n=0|t[OJ];return 2&n?new e.constructor(u0(t,n,!1)):e}function p0(e,t){return f0(e=e.u,0|e[OJ],t)}function f0(e,t,n,i){if(-1===n)return null;var r=n+(512&t?0:-1);const s=e.length-1;return r>=s&&256&t?e[s][n]:i&&256&t&&null!=(t=e[s][n])?(null!=e[r]&&null!=TJ&&((r=(e=null!==bJ&&void 0!==bJ?bJ:bJ={})[TJ]||0)>=4||(e[TJ]=r+1,wJ(e=Error(),"incident"),function(e){kZ.setTimeout((()=>{throw e}),0)}(e))),t):r<=s?e[r]:void 0}function m0(e,t,n){const i=e.u;let r=0|i[OJ];return QJ(r),g0(i,r,t,n),e}function g0(e,t,n,i){const r=512&t?0:-1,s=n+r;var a=e.length-1;return s>=a&&256&t?(e[a][n]=i,t):s<=a?(e[s]=i,256&t&&n in(e=e[a])&&delete e[n],t):(void 0!==i&&(n>=(a=t>>15&1023||536870912)?null!=i&&(e[a+r]={[n]:i},LJ(e,t|=256)):e[s]=i),t)}function v0(e,t){let n=0|(e=e.u)[OJ];const i=f0(e,n,t),r=T$(i);return null!=r&&r!==i&&g0(e,n,t,r),r}function y0(e){let t=0|(e=e.u)[OJ];const n=f0(e,t,1),i=qJ(n,!0);return null!=i&&i!==n&&g0(e,t,1,i),i}function b0(){return void 0===JJ?2:4}function x0(e,t,n,i,r){const s=e.u,a=2&(e=0|s[OJ])?1:i;r=!!r;let o=0|(i=w0(s,e,t))[OJ];if(!(4&o)){4&o&&(i=UJ(i),o=N0(o,e),e=g0(s,e,t,i));let r=0,a=0;for(;r<i.length;r++){const e=n(i[r]);null!=e&&(i[a++]=e)}a<r&&(i.length=a),o=S0(o,e),n=-4097&o|20,o=n&=-8193,LJ(i,o),2&o&&Object.freeze(i)}return 1===a||4===a&&32&o?_0(o)||(r=o,o|=2,o!==r&&LJ(i,o),Object.freeze(i)):(2===a&&_0(o)&&(i=UJ(i),o=N0(o,e),o=F0(o,e,r),LJ(i,o),e=g0(s,e,t,i)),_0(o)||(t=o,o=F0(o,e,r),o!==t&&LJ(i,o))),i}function w0(e,t,n,i){return e=f0(e,t,n,i),Array.isArray(e)?e:jJ}function S0(e,t){return 0===e&&(e=N0(e,t)),1|e}function _0(e){return!!(2&e)&&!!(4&e)||!!(2048&e)}function E0(e){e=UJ(e);for(let t=0;t<e.length;t++){const n=e[t]=UJ(e[t]);Array.isArray(n[1])&&(n[1]=BJ(n[1]))}return e}function A0(e,t,n,i){let r=0|(e=e.u)[OJ];QJ(r),g0(e,r,t,("0"===i?0===Number(n):n===i)?void 0:n)}function C0(e,t,n,i,r){QJ(t);var s=!(!(64&t)&&16384&t);const a=(r=w0(e,t,n,r))!==jJ;if(s||!a){let o=s=a?0|r[OJ]:0;(!a||2&o||_0(o)||4&o&&!(32&o))&&(r=UJ(r),o=N0(o,t),t=g0(e,t,n,r)),o=-13&S0(o,t),o=F0(i?-17&o:16|o,t,!0),o!==s&&LJ(r,o)}return r}function M0(e,t){var n=Q3;return D0(T0(e=e.u),e,0|e[OJ],n)===t?t:-1}function T0(e){var t;if(_J)return null!==(t=e[PJ])&&void 0!==t?t:e[PJ]=new Map;if(PJ in e)return e[PJ];const n=new Map;return Object.defineProperty(e,PJ,{value:n}),n}function P0(e,t,n,i){const r=T0(e),s=D0(r,e,t,n);return s!==i&&(s&&(t=g0(e,t,s)),r.set(n,i)),t}function D0(e,t,n,i){let r=e.get(i);if(null!=r)return r;r=0;for(let s=0;s<i.length;s++){const e=i[s];null!=f0(t,n,e)&&(0!==r&&(n=g0(t,n,r)),r=e)}return e.set(i,r),r}function O0(e,t,n,i){let r,s=0|e[OJ];if(null!=(i=f0(e,s,n,i))&&i.W===VJ)return(t=d0(i))!==i&&g0(e,s,n,t),t.u;if(Array.isArray(i)){const e=0|i[OJ];r=2&e?l0(u0(i,e,!1),t,!0):64&e?i:l0(r,t,!0)}else r=l0(void 0,t,!0);return r!==i&&g0(e,s,n,r),r}function I0(e,t,n,i){let r=0|(e=e.u)[OJ];return(t=j$(i=f0(e,r,n,i),t,!1,r))!==i&&null!=t&&g0(e,r,n,t),t}function R0(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(null==(t=I0(e,t,n,i)))return t;if(!(2&(i=0|(e=e.u)[OJ]))){const r=d0(t);r!==t&&g0(e,i,n,t=r)}return t}function k0(e,t,n,i,r,s,a){var o=!!(2&t);const l=o?1:r;s=!!s,a&&(a=!o);var c=0|(r=w0(e=e.u,t,i))[OJ];if(!(o=!!(4&c))){var h=r,u=t;const e=!!(2&(c=S0(c,t)));e&&(u|=2);let i=!e,s=!0,a=0,o=0;for(;a<h.length;a++){const t=j$(h[a],n,!1,u);if(t instanceof n){if(!e){const e=!!(2&t.u[OJ]);i&&(i=!e),s&&(s=e)}h[o++]=t}}o<a&&(h.length=o),c|=4,c=s?16|c:-17&c,LJ(h,c=i?8|c:-9&c),e&&Object.freeze(h)}if(a&&!(8&c||!r.length&&(1===l||4===l&&32&c))){for(_0(c)&&(r=UJ(r),c=N0(c,t),t=g0(e,t,i,r)),n=r,a=c,h=0;h<n.length;h++)(c=n[h])!==(u=d0(c))&&(n[h]=u);a|=8,LJ(n,a=n.length?-17&a:16|a),c=a}return 1===l||4===l&&32&c?_0(c)||(t=c,(c|=!r.length||16&c&&(!o||32&c)?2:2048)!==t&&LJ(r,c),Object.freeze(r)):(2===l&&_0(c)&&(LJ(r=UJ(r),c=F0(c=N0(c,t),t,s)),t=g0(e,t,i,r)),_0(c)||(i=c,(c=F0(c,t,s))!==i&&LJ(r,c))),r}function L0(e,t,n){const i=0|e.u[OJ];return k0(e,i,t,n,b0(),!1,!(2&i))}function B0(e,t,n,i){return null==i&&(i=void 0),m0(e,n,i)}function z0(e,t,n,i){null==i&&(i=void 0);e:{let r=0|(e=e.u)[OJ];if(QJ(r),null==i){const i=T0(e);if(D0(i,e,r,n)!==t)break e;i.set(n,0)}else r=P0(e,r,n,t);g0(e,r,t,i)}}function N0(e,t){return-2049&(2&t?2|e:-3&e)|32}function F0(e,t,n){return 32&t&&n||(e&=-33),e}function U0(e,t,n,i){const r=0|e.u[OJ];QJ(r),e=k0(e,r,n,t,2,!0),i=null!=i?i:new n,e.push(i),e[OJ]=2&i.u[OJ]?-9&e[OJ]:-17&e[OJ]}function j0(e,t){return I$(p0(e,t))}function V0(e,t){return U$(p0(e,t))}function G0(e,t){var n;return null!==(n=v0(e,t))&&void 0!==n?n:0}function H0(e,t,n){if(null!=n&&"boolean"!=typeof n)throw e=typeof n,Error("Expected boolean but got ".concat("object"!=e?e:n?Array.isArray(n)?"array":e:"null",": ").concat(n));m0(e,t,n)}function W0(e,t,n){if(null!=n){if("number"!=typeof n)throw SJ("int32");if(!C$(n))throw SJ("int32");n|=0}m0(e,t,n)}function q0(e,t,n){if(null!=n&&"number"!=typeof n)throw Error("Value of float/double field must be a number, found ".concat(typeof n,": ").concat(n));m0(e,t,n)}function X0(e,t,n){{const a=e.u;let o=0|a[OJ];if(QJ(o),null==n)g0(a,o,t);else{var i=e=0|n[OJ],r=_0(e),s=r||Object.isFrozen(n);for(r||(e=0),s||(n=UJ(n),i=0,e=F0(e=N0(e,o),o,!0),s=!1),e|=21,r=0;r<n.length;r++){const t=n[r],a=N$(t);Object.is(t,a)||(s&&(n=UJ(n),i=0,e=F0(e=N0(e,o),o,!0),s=!1),n[r]=a)}e!==i&&(s&&(n=UJ(n),e=F0(e=N0(e,o),o,!0)),LJ(n,e)),g0(a,o,t,n)}}}function Y0(e,t,n){QJ(0|e.u[OJ]),x0(e,t,U$,2,!0).push(N$(n))}function Q0(e,t){return Error("Invalid wire type: ".concat(e," (at position ").concat(t,")"))}function K0(){return Error("Failed to read varint, encoding is invalid.")}function Z0(e,t){return Error("Tried to read past the end of the data ".concat(t," > ").concat(e))}function J0(e){if("string"==typeof e)return{buffer:dJ(e),N:!1};if(Array.isArray(e))return{buffer:new Uint8Array(e),N:!1};if(e.constructor===Uint8Array)return{buffer:e,N:!1};if(e.constructor===ArrayBuffer)return{buffer:new Uint8Array(e),N:!1};if(e.constructor===vJ)return{buffer:gJ(e)||new Uint8Array(0),N:!0};if(e instanceof Uint8Array)return{buffer:new Uint8Array(e.buffer,e.byteOffset,e.byteLength),N:!1};throw Error("Type not convertible to a Uint8Array, expected a Uint8Array, an ArrayBuffer, a base64 encoded string, a ByteString or an Array of numbers")}function $0(e,t){let n,i=0,r=0,s=0;const a=e.h;let o=e.g;do{n=a[o++],i|=(127&n)<<s,s+=7}while(s<32&&128&n);for(s>32&&(r|=(127&n)>>4),s=3;s<32&&128&n;s+=7)n=a[o++],r|=(127&n)<<s;if(o1(e,o),n<128)return t(i>>>0,r>>>0);throw K0()}function e1(e){let t=0,n=e.g;const i=n+10,r=e.h;for(;n<i;){const i=r[n++];if(t|=i,0==(128&i))return o1(e,n),!!(127&t)}throw K0()}function t1(e){const t=e.h;let n=e.g,i=t[n++],r=127&i;if(128&i&&(i=t[n++],r|=(127&i)<<7,128&i&&(i=t[n++],r|=(127&i)<<14,128&i&&(i=t[n++],r|=(127&i)<<21,128&i&&(i=t[n++],r|=i<<28,128&i&&128&t[n++]&&128&t[n++]&&128&t[n++]&&128&t[n++]&&128&t[n++])))))throw K0();return o1(e,n),r}function n1(e){return t1(e)>>>0}function i1(e){var t=e.h;const n=e.g,i=t[n],r=t[n+1],s=t[n+2];return t=t[n+3],o1(e,e.g+4),(i|r<<8|s<<16|t<<24)>>>0}function r1(e){var t=i1(e);e=2*(t>>31)+1;const n=t>>>23&255;return t&=8388607,255==n?t?NaN:e*(1/0):0==n?1401298464324817e-60*e*t:e*Math.pow(2,n-150)*(t+8388608)}function s1(e){return t1(e)}function a1(e,t){let{ba:n=!1}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};e.ba=n,t&&(t=J0(t),e.h=t.buffer,e.m=t.N,e.j=0,e.l=e.h.length,e.g=e.j)}function o1(e,t){if(e.g=t,t>e.l)throw Z0(e.l,t)}function l1(e,t){if(t<0)throw Error("Tried to read a negative byte length: ".concat(t));const n=e.g,i=n+t;if(i>e.l)throw Z0(t,e.l-n);return e.g=i,n}function c1(e,t){if(0==t)return mJ();var n=l1(e,t);return e.ba&&e.m?n=e.h.subarray(n,n+t):(e=e.h,n=n===(t=n+t)?new Uint8Array(0):h$?e.slice(n,t):new Uint8Array(e.subarray(n,t))),0==n.length?mJ():new vJ(n,fJ)}Q$.prototype.toJSON=void 0,Q$.prototype.Ia=GJ;var h1=[];function u1(e){var t=e.g;if(t.g==t.l)return!1;e.l=e.g.g;var n=n1(e.g);if(t=n>>>3,!((n&=7)>=0&&n<=5))throw Q0(n,e.l);if(t<1)throw Error("Invalid field number: ".concat(t," (at position ").concat(e.l,")"));return e.m=t,e.h=n,!0}function d1(e){switch(e.h){case 0:0!=e.h?d1(e):e1(e.g);break;case 1:o1(e=e.g,e.g+8);break;case 2:if(2!=e.h)d1(e);else{var t=n1(e.g);o1(e=e.g,e.g+t)}break;case 5:o1(e=e.g,e.g+4);break;case 3:for(t=e.m;;){if(!u1(e))throw Error("Unmatched start-group tag: stream EOF");if(4==e.h){if(e.m!=t)throw Error("Unmatched end-group tag");break}d1(e)}break;default:throw Q0(e.h,e.l)}}function p1(e,t,n){const i=e.g.l,r=n1(e.g),s=e.g.g+r;let a=s-i;if(a<=0&&(e.g.l=s,n(t,e,void 0,void 0,void 0),a=s-e.g.g),a)throw Error("Message parsing ended unexpectedly. Expected to read ".concat(r," bytes, instead read ").concat(r-a," bytes, either the data ended unexpectedly or the message misreported its own length"));return e.g.g=s,e.g.l=i,t}function f1(e){var t=n1(e.g),n=l1(e=e.g,t);if(e=e.h,FZ){var i,r=e;(i=NZ)||(i=NZ=new TextDecoder("utf-8",{fatal:!0})),t=n+t,r=0===n&&t===r.length?r:r.subarray(n,t);try{var s=i.decode(r)}catch(e){if(void 0===zZ){try{i.decode(new Uint8Array([128]))}catch(e){}try{i.decode(new Uint8Array([97])),zZ=!0}catch(e){zZ=!1}}throw!zZ&&(NZ=void 0),e}}else{t=(s=n)+t,n=[];let o,l=null;for(;s<t;){var a=e[s++];a<128?n.push(a):a<224?s>=t?LZ():(o=e[s++],a<194||128!=(192&o)?(s--,LZ()):n.push((31&a)<<6|63&o)):a<240?s>=t-1?LZ():(o=e[s++],128!=(192&o)||224===a&&o<160||237===a&&o>=160||128!=(192&(i=e[s++]))?(s--,LZ()):n.push((15&a)<<12|(63&o)<<6|63&i)):a<=244?s>=t-2?LZ():(o=e[s++],128!=(192&o)||o-144+(a<<28)>>30!=0||128!=(192&(i=e[s++]))||128!=(192&(r=e[s++]))?(s--,LZ()):(a=(7&a)<<18|(63&o)<<12|(63&i)<<6|63&r,a-=65536,n.push(55296+(a>>10&1023),56320+(1023&a)))):LZ(),n.length>=8192&&(l=BZ(l,n),n.length=0)}s=BZ(l,n)}return s}function m1(e){const t=n1(e.g);return c1(e.g,t)}function g1(e,t,n){var i=n1(e.g);for(i=e.g.g+i;e.g.g<i;)n.push(t(e.g))}var v1=[];function y1(e){return e}let b1;function x1(e,t,n){t.g?t.m(e,t.g,t.h,n):t.m(e,t.h,n)}var w1=class{constructor(e,t){this.u=c0(e,t)}toJSON(){const e=!b1;try{return e&&(b1=o0),S1(this)}finally{e&&(b1=void 0)}}l(){var e=H4;return e.g?e.l(this,e.g,e.h,!0):e.l(this,e.h,e.defaultValue,!0)}clone(){const e=this.u;return new this.constructor(u0(e,0|e[OJ],!1))}N(){return!!(2&this.u[OJ])}};function S1(e){var t=e.u;{t=(e=b1(t))!==t;let c=e.length;if(c){var n=e[c-1],i=WJ(n);i?c--:n=void 0;var r=e;if(i){e:{var s,a=n,o=!1;if(a)for(let e in a)isNaN(+e)?(null!==s&&void 0!==s?s:s={})[e]=a[e]:(i=a[e],Array.isArray(i)&&(XJ(i)||HJ(i)&&0===i.size)&&(i=null),null==i&&(o=!0),null!=i&&((null!==s&&void 0!==s?s:s={})[e]=i));if(o||(s=a),s)for(let e in s){o=s;break e}o=null}a=null==o?null!=n:o!==n}for(;c>0&&(null==(s=r[c-1])||XJ(s)||HJ(s)&&0===s.size);c--)var l=!0;(r!==e||a||l)&&(t?(l||a||o)&&(r.length=c):r=Array.prototype.slice.call(r,0,c),o&&r.push(o)),l=r}else l=e}return l}function _1(e){return e?/^\d+$/.test(e)?(w$(e),new E1(d$,p$)):null:A1||(A1=new E1(0,0))}w1.prototype.W=VJ,w1.prototype.toString=function(){try{return b1=y1,S1(this).toString()}finally{b1=void 0}};var E1=class{constructor(e,t){this.h=e>>>0,this.g=t>>>0}};let A1;function C1(e){return e?/^-?\d+$/.test(e)?(w$(e),new M1(d$,p$)):null:T1||(T1=new M1(0,0))}var M1=class{constructor(e,t){this.h=e>>>0,this.g=t>>>0}};let T1;function P1(e,t,n){for(;n>0||t>127;)e.g.push(127&t|128),t=(t>>>7|n<<25)>>>0,n>>>=7;e.g.push(t)}function D1(e,t){for(;t>127;)e.g.push(127&t|128),t>>>=7;e.g.push(t)}function O1(e,t){if(t>=0)D1(e,t);else{for(let n=0;n<9;n++)e.g.push(127&t|128),t>>=7;e.g.push(1)}}function I1(e,t){e.g.push(t>>>0&255),e.g.push(t>>>8&255),e.g.push(t>>>16&255),e.g.push(t>>>24&255)}function R1(e,t){0!==t.length&&(e.l.push(t),e.h+=t.length)}function k1(e,t,n){D1(e.g,8*t+n)}function L1(e,t){return k1(e,t,2),t=e.g.end(),R1(e,t),t.push(e.h),t}function B1(e,t){var n=t.pop();for(n=e.h+e.g.length()-n;n>127;)t.push(127&n|128),n>>>=7,e.h++;t.push(n),e.h++}function z1(e,t,n){k1(e,t,2),D1(e.g,n.length),R1(e,e.g.end()),R1(e,n)}function N1(e,t,n,i){null!=n&&(t=L1(e,t),i(n,e),B1(e,t))}function F1(){const e=class{constructor(){throw Error()}};return Object.setPrototypeOf(e,e.prototype),e}var U1=F1(),j1=F1(),V1=F1(),G1=F1(),H1=F1(),W1=F1(),q1=F1(),X1=F1(),Y1=F1(),Q1=class{constructor(e,t,n){this.g=e,this.h=t,e=U1,this.l=!!e&&n===e||!1}};function K1(e,t){return new Q1(e,t,U1)}function Z1(e,t,n,i,r){N1(e,n,l2(t,i),r)}const J1=K1((function(e,t,n,i,r){return 2===e.h&&(p1(e,O0(t,i,n),r),!0)}),Z1),$1=K1((function(e,t,n,i,r){return 2===e.h&&(p1(e,O0(t,i,n,!0),r),!0)}),Z1);var e2=Symbol(),t2=Symbol(),n2=Symbol(),i2=Symbol();let r2,s2;function a2(e,t,n,i){var r=i[e];if(r)return r;(r={}).Pa=i,r.V=function(e){switch(typeof e){case"boolean":return e0||(e0=[0,void 0,!0]);case"number":return e>0?void 0:0===e?t0||(t0=[0,void 0]):[-e,void 0];case"string":return[0,e];case"object":return e}}(i[0]);var s=i[1];let a=1;s&&s.constructor===Object&&(r.ga=s,"function"==typeof(s=i[++a])&&(r.la=!0,null!==r2&&void 0!==r2||(r2=s),null!==s2&&void 0!==s2||(s2=i[a+1]),s=i[a+=2]));const o={};for(;s&&Array.isArray(s)&&s.length&&"number"==typeof s[0]&&s[0]>0;){for(var l=0;l<s.length;l++)o[s[l]]=s;s=i[++a]}for(l=1;void 0!==s;){var c;let e;"number"==typeof s&&(l+=s,s=i[++a]);var h=void 0;if(s instanceof Q1?e=s:(e=J1,a--),null!==(c=e)&&void 0!==c&&c.l){s=i[++a],h=i;var u=a;"function"==typeof s&&(s=s(),h[u]=s),h=s}for(u=l+1,"number"==typeof(s=i[++a])&&s<0&&(u-=s,s=i[++a]);l<u;l++){const i=o[l];h?n(r,l,e,h,i):t(r,l,e,i)}}return i[e]=r}function o2(e){return Array.isArray(e)?e[0]instanceof Q1?e:[$1,e]:[e,void 0]}function l2(e,t){return e instanceof w1?e.u:Array.isArray(e)?l0(e,t,!1):void 0}function c2(e,t,n,i){const r=n.g;e[t]=i?(e,t,n)=>r(e,t,n,i):r}function h2(e,t,n,i,r){const s=n.g;let a,o;e[t]=(e,t,n)=>s(e,t,n,o||(o=a2(t2,c2,h2,i).V),a||(a=u2(i)),r)}function u2(e){let t=e[n2];if(null!=t)return t;const n=a2(t2,c2,h2,e);return t=n.la?(e,t)=>r2(e,t,n):(e,t)=>{const i=0|e[OJ];for(;u1(t)&&4!=t.h;){var r=t.m,s=n[r];if(null==s){var a=n.ga;a&&(a=a[r])&&null!=(a=d2(a))&&(s=n[r]=a)}null!=s&&s(t,e,r)||(r=(s=t).l,d1(s),s.fa?s=void 0:(a=s.g.g-r,s.g.g=r,s=c1(s.g,a)),r=e,s&&((a=r[DJ])?a.push(s):r[DJ]=[s]))}return 16384&i&&BJ(e),!0},e[n2]=t}function d2(e){const t=(e=o2(e))[0].g;if(e=e[1]){const n=u2(e),i=a2(t2,c2,h2,e).V;return(e,r,s)=>t(e,r,s,i,n)}return t}function p2(e,t,n){e[t]=n.h}function f2(e,t,n,i){let r,s;const a=n.h;e[t]=(e,t,n)=>a(e,t,n,s||(s=a2(e2,p2,f2,i).V),r||(r=m2(i)))}function m2(e){let t=e[i2];if(!t){const n=a2(e2,p2,f2,e);t=(e,t)=>g2(e,t,n),e[i2]=t}return t}function g2(e,t,n){for(var i=0|e[OJ],r=512&i?0:-1,s=e.length,a=512&i?1:0,o=s+(256&i?-1:0);a<o;a++){const i=e[a];if(null==i)continue;const s=a-r,o=v2(n,s);o&&o(t,i,s)}if(256&i){i=e[s-1];for(const e in i)r=+e,Number.isNaN(r)||null!=(s=i[r])&&(o=v2(n,r))&&o(t,s,r)}if(e=ZJ(e))for(R1(t,t.g.end()),n=0;n<e.length;n++)R1(t,gJ(e[n])||new Uint8Array(0))}function v2(e,t){var n=e[t];if(n)return n;if((n=e.ga)&&(n=n[t])){var i=(n=o2(n))[0].h;if(n=n[1]){const t=m2(n),r=a2(e2,p2,f2,n).V;n=e.la?s2(r,t):(e,n,s)=>i(e,n,s,r,t)}else n=i;return e[t]=n}}function y2(e,t){if(Array.isArray(t)){var n=0|t[OJ];if(4&n)return t;for(var i=0,r=0;i<t.length;i++){const n=e(t[i]);null!=n&&(t[r++]=n)}return r<i&&(t.length=r),LJ(t,-12289&n|5),2&n&&Object.freeze(t),t}}function b2(e,t,n){return new Q1(e,t,n)}function x2(e,t,n){return new Q1(e,t,n)}function w2(e,t,n){g0(e,0|e[OJ],t,n)}var S2=K1((function(e,t,n,i,r){return 2===e.h&&(e=p1(e,l0([void 0,void 0],i,!0),r),QJ(i=0|t[OJ]),(r=f0(t,i,n))instanceof Q$?0!=(2&r.L)?((r=r.X()).push(e),g0(t,i,n,r)):r.Na(e):Array.isArray(r)?(2&r[OJ]&&g0(t,i,n,r=E0(r)),r.push(e)):g0(t,i,n,[e]),!0)}),(function(e,t,n,i,r){if(t instanceof Q$)t.forEach(((t,s)=>{N1(e,n,l0([s,t],i,!1),r)}));else if(Array.isArray(t))for(let s=0;s<t.length;s++){const a=t[s];Array.isArray(a)&&N1(e,n,l0(a,i,!1),r)}}));function _2(e,t,n){if(t=function(e){if(null==e)return e;const t=typeof e;if("bigint"===t)return String(_$(64,e));if(O$(e)){if("string"===t)return B$(e);if("number"===t)return L$(e)}}(t),null!=t&&("string"==typeof t&&C1(t),null!=t))switch(k1(e,n,0),typeof t){case"number":e=e.g,m$(t),P1(e,d$,p$);break;case"bigint":n=BigInt.asUintN(64,t),n=new M1(Number(n&BigInt(4294967295)),Number(n>>BigInt(32))),P1(e.g,n.h,n.g);break;default:n=C1(t),P1(e.g,n.h,n.g)}}function E2(e,t,n){null!=(t=I$(t))&&null!=t&&(k1(e,n,0),O1(e.g,t))}function A2(e,t,n){null!=(t=P$(t))&&(k1(e,n,0),e.g.g.push(t?1:0))}function C2(e,t,n){null!=(t=U$(t))&&z1(e,n,VZ(t))}function M2(e,t,n,i,r){N1(e,n,l2(t,i),r)}function T2(e,t,n){null!=(t=null==t||"string"==typeof t||pJ(t)||t instanceof vJ?t:void 0)&&z1(e,n,J0(t).buffer)}function P2(e,t,n){return(5===e.h||2===e.h)&&(t=C0(t,0|t[OJ],n,!1,!1),2==e.h?g1(e,r1,t):t.push(r1(e.g)),!0)}var D2=b2((function(e,t,n){if(1!==e.h)return!1;var i=e.g;e=i1(i);const r=i1(i);i=2*(r>>31)+1;const s=r>>>20&2047;return e=4294967296*(1048575&r)+e,w2(t,n,2047==s?e?NaN:i*(1/0):0==s?5e-324*i*e:i*Math.pow(2,s-1075)*(e+4503599627370496)),!0}),(function(e,t,n){null!=(t=T$(t))&&(k1(e,n,1),e=e.g,(n=u$||(u$=new DataView(new ArrayBuffer(8)))).setFloat64(0,+t,!0),d$=n.getUint32(0,!0),p$=n.getUint32(4,!0),I1(e,d$),I1(e,p$))}),F1()),O2=b2((function(e,t,n){return 5===e.h&&(w2(t,n,r1(e.g)),!0)}),(function(e,t,n){null!=(t=T$(t))&&(k1(e,n,5),e=e.g,g$(t),I1(e,d$))}),q1),I2=x2(P2,(function(e,t,n){if(null!=(t=y2(T$,t)))for(let a=0;a<t.length;a++){var i=e,r=n,s=t[a];null!=s&&(k1(i,r,5),i=i.g,g$(s),I1(i,d$))}}),q1),R2=x2(P2,(function(e,t,n){if(null!=(t=y2(T$,t))&&t.length){k1(e,n,2),D1(e.g,4*t.length);for(let i=0;i<t.length;i++)n=e.g,g$(t[i]),I1(n,d$)}}),q1),k2=b2((function(e,t,n){return 0===e.h&&(w2(t,n,$0(e.g,y$)),!0)}),_2,W1),L2=b2((function(e,t,n){return 0===e.h&&(w2(t,n,0===(e=$0(e.g,y$))?void 0:e),!0)}),_2,W1),B2=b2((function(e,t,n){return 0===e.h&&(w2(t,n,$0(e.g,v$)),!0)}),(function(e,t,n){if(null!=(t=function(e){if(null==e)return e;var t=typeof e;if("bigint"===t)return String(E$(64,e));if(O$(e)){if("string"===t)return t=M$(Number(e)),A$(t)&&t>=0?e=String(t):(-1!==(t=e.indexOf("."))&&(e=e.substring(0,t)),k$(e)||(w$(e),e=b$(d$,p$))),e;if("number"===t)return(e=M$(e))>=0&&A$(e)?e:function(e){if(e<0){m$(e);var t=b$(d$,p$);return e=Number(t),A$(e)?e:t}return k$(t=String(e))?t:(m$(e),v$(d$,p$))}(e)}}(t))&&("string"==typeof t&&_1(t),null!=t))switch(k1(e,n,0),typeof t){case"number":e=e.g,m$(t),P1(e,d$,p$);break;case"bigint":n=BigInt.asUintN(64,t),n=new E1(Number(n&BigInt(4294967295)),Number(n>>BigInt(32))),P1(e.g,n.h,n.g);break;default:n=_1(t),P1(e.g,n.h,n.g)}}),F1()),z2=b2((function(e,t,n){return 0===e.h&&(w2(t,n,t1(e.g)),!0)}),E2,G1),N2=x2((function(e,t,n){return(0===e.h||2===e.h)&&(t=C0(t,0|t[OJ],n,!1,!1),2==e.h?g1(e,t1,t):t.push(t1(e.g)),!0)}),(function(e,t,n){if(null!=(t=y2(I$,t))&&t.length){n=L1(e,n);for(let n=0;n<t.length;n++)O1(e.g,t[n]);B1(e,n)}}),G1),F2=b2((function(e,t,n){return 0===e.h&&(w2(t,n,0===(e=t1(e.g))?void 0:e),!0)}),E2,G1),U2=b2((function(e,t,n){return 0===e.h&&(w2(t,n,e1(e.g)),!0)}),A2,j1),j2=b2((function(e,t,n){return 0===e.h&&(w2(t,n,!1===(e=e1(e.g))?void 0:e),!0)}),A2,j1),V2=x2((function(e,t,n){return 2===e.h&&(e=f1(e),C0(t,0|t[OJ],n,!1).push(e),!0)}),(function(e,t,n){if(null!=(t=y2(U$,t)))for(let a=0;a<t.length;a++){var i=e,r=n,s=t[a];null!=s&&z1(i,r,VZ(s))}}),V1),G2=b2((function(e,t,n){return 2===e.h&&(w2(t,n,""===(e=f1(e))?void 0:e),!0)}),C2,V1),H2=b2((function(e,t,n){return 2===e.h&&(w2(t,n,f1(e)),!0)}),C2,V1),W2=function(e,t){return new Q1(e,t,arguments.length>2&&void 0!==arguments[2]?arguments[2]:U1)}((function(e,t,n,i,r){return 2===e.h&&(i=l0(void 0,i,!0),C0(t,0|t[OJ],n,!0).push(i),p1(e,i,r),!0)}),(function(e,t,n,i,r){if(Array.isArray(t))for(let s=0;s<t.length;s++)M2(e,t[s],n,i,r)})),q2=K1((function(e,t,n,i,r,s){return 2===e.h&&(P0(t,0|t[OJ],s,n),p1(e,t=O0(t,i,n),r),!0)}),M2),X2=b2((function(e,t,n){return 2===e.h&&(w2(t,n,m1(e)),!0)}),T2,X1),Y2=x2((function(e,t,n){return(0===e.h||2===e.h)&&(t=C0(t,0|t[OJ],n,!1,!1),2==e.h?g1(e,n1,t):t.push(n1(e.g)),!0)}),(function(e,t,n){if(null!=(t=y2(R$,t)))for(let a=0;a<t.length;a++){var i=e,r=n,s=t[a];null!=s&&(k1(i,r,0),D1(i.g,s))}}),H1),Q2=b2((function(e,t,n){return 0===e.h&&(w2(t,n,0===(e=n1(e.g))?void 0:e),!0)}),(function(e,t,n){null!=(t=R$(t))&&null!=t&&(k1(e,n,0),D1(e.g,t))}),H1),K2=b2((function(e,t,n){return 0===e.h&&(w2(t,n,t1(e.g)),!0)}),(function(e,t,n){null!=(t=I$(t))&&(t=parseInt(t,10),k1(e,n,0),O1(e.g,t))}),Y1);class Z2{constructor(e,t){this.h=e,this.g=t,this.l=R0,this.m=B0,this.defaultValue=void 0}}function J2(e,t){return new Z2(e,t)}function $2(e,t){return(n,i)=>{if(v1.length){const e=v1.pop();e.o(i),a1(e.g,n,i),n=e}else n=new class{constructor(e,t){if(h1.length){const n=h1.pop();a1(n,e,t),e=n}else e=new class{constructor(e,t){this.h=null,this.m=!1,this.g=this.l=this.j=0,a1(this,e,t)}clear(){this.h=null,this.m=!1,this.g=this.l=this.j=0,this.ba=!1}}(e,t);this.g=e,this.l=this.g.g,this.h=this.m=-1,this.o(t)}o(){let{fa:e=!1}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.fa=e}}(n,i);try{const i=new e,s=i.u;u2(t)(s,n);var r=i}finally{n.g.clear(),n.m=-1,n.h=-1,v1.length<100&&v1.push(n)}return r}}function e3(e){return function(){const t=new class{constructor(){this.l=[],this.h=0,this.g=new class{constructor(){this.g=[]}length(){return this.g.length}end(){const e=this.g;return this.g=[],e}}}};g2(this.u,t,a2(e2,p2,f2,e)),R1(t,t.g.end());const n=new Uint8Array(t.h),i=t.l,r=i.length;let s=0;for(let e=0;e<r;e++){const t=i[e];n.set(t,s),s+=t.length}return t.l=[n],n}}var t3=class extends w1{constructor(e){super(e)}},n3=[0,G2,b2((function(e,t,n){return 2===e.h&&(w2(t,n,(e=m1(e))===mJ()?void 0:e),!0)}),(function(e,t,n){if(null!=t){if(t instanceof w1){const i=t.Ra;return void(i&&(t=i(t),null!=t&&z1(e,n,J0(t).buffer)))}if(Array.isArray(t))return}T2(e,t,n)}),X1)];let i3,r3=globalThis.trustedTypes;function s3(e){void 0===i3&&(i3=function(){let e=null;if(!r3)return e;try{const t=e=>e;e=r3.createPolicy("goog#html",{createHTML:t,createScript:t,createScriptURL:t})}catch(e){}return e}());var t=i3;return new class{constructor(e){this.g=e}toString(){return this.g+""}}(t?t.createScriptURL(e):e)}var a3=[0,z2,K2,U2,-1,N2,K2,-1],o3=class extends w1{constructor(e){super(e)}},l3=[0,U2,H2,U2,K2,-1,x2((function(e,t,n){return(0===e.h||2===e.h)&&(t=C0(t,0|t[OJ],n,!1,!1),2==e.h?g1(e,s1,t):t.push(t1(e.g)),!0)}),(function(e,t,n){if(null!=(t=y2(I$,t))&&t.length){n=L1(e,n);for(let n=0;n<t.length;n++)O1(e.g,t[n]);B1(e,n)}}),Y1),H2,-1,[0,U2,-1],K2,U2,-1],c3=[0,H2,-2],h3=class extends w1{constructor(e){super(e)}},u3=[0],d3=[0,z2,U2,1,U2,-3],p3=class extends w1{constructor(e){super(e,2)}},f3={};f3[336783863]=[0,H2,U2,-1,z2,[0,[1,2,3,4,5,6,7,8],q2,u3,q2,l3,q2,c3,q2,d3,q2,a3,q2,[0,H2,-2],q2,[0,H2,K2],q2,[0,K2,H2]],[0,H2],U2,[0,[1,3],[2,4],q2,[0,N2],-1,q2,[0,V2],-1,W2,[0,H2,-1]],H2];var m3=[0,L2,-1,j2,-3,L2,N2,G2,F2,L2,-1,j2,F2,j2,-2,G2];function g3(e,t){A0(e,2,F$(t),"")}function v3(e,t){Y0(e,3,t)}function y3(e,t){Y0(e,4,t)}var b3=class extends w1{constructor(e){super(e,500)}o(e){return B0(this,0,7,e)}},x3=[-1,{}],w3=[0,H2,1,x3],S3=[0,H2,V2,x3];function _3(e,t){U0(e,1,b3,t)}function E3(e,t){Y0(e,10,t)}function A3(e,t){Y0(e,15,t)}var C3=class extends w1{constructor(e){super(e,500)}o(e){return B0(this,0,1001,e)}},M3=[-500,W2,[-500,G2,-1,V2,-3,[-2,f3,U2],W2,n3,F2,-1,w3,S3,W2,[0,G2,j2],G2,m3,F2,V2,987,V2],4,W2,[-500,H2,-1,[-1,{}],998,H2],W2,[-500,H2,V2,-1,[-2,{},U2],997,V2,-1],F2,W2,[-500,H2,V2,x3,998,V2],V2,F2,w3,S3,W2,[0,G2,-1,x3],V2,-2,m3,G2,-1,j2,[0,j2,Q2],978,x3,W2,n3];C3.prototype.g=e3(M3);var T3=$2(C3,M3),P3=class extends w1{constructor(e){super(e)}},D3=class extends w1{constructor(e){super(e)}g(){return L0(this,P3,1)}},O3=[0,W2,[0,z2,O2,H2,-1]],I3=$2(D3,O3),R3=class extends w1{constructor(e){super(e)}},k3=class extends w1{constructor(e){super(e)}},L3=class extends w1{constructor(e){super(e)}h(){return R0(this,R3,2)}g(){return L0(this,k3,5)}},B3=$2(class extends w1{constructor(e){super(e)}},[0,V2,N2,R2,[0,K2,[0,z2,-3],[0,O2,-3],[0,z2,-1,[0,W2,[0,z2,-2]]],W2,[0,O2,-1,H2,O2]],H2,-1,k2,W2,[0,z2,O2],V2,k2]),z3=class extends w1{constructor(e){super(e)}},N3=$2(class extends w1{constructor(e){super(e)}},[0,W2,[0,O2,-4]]),F3=class extends w1{constructor(e){super(e)}},U3=$2(class extends w1{constructor(e){super(e)}},[0,W2,[0,O2,-4]]),j3=class extends w1{constructor(e){super(e)}},V3=[0,z2,-1,R2,K2],G3=class extends w1{constructor(e){super(e)}};G3.prototype.g=e3([0,O2,-4,k2]);var H3=class extends w1{constructor(e){super(e)}},W3=$2(class extends w1{constructor(e){super(e)}},[0,W2,[0,1,z2,H2,O3],k2]),q3=class extends w1{constructor(e){super(e)}},X3=class extends w1{constructor(e){super(e)}oa(){const e=y0(this);return null==e?mJ():e}},Y3=class extends w1{constructor(e){super(e)}},Q3=[1,2],K3=$2(class extends w1{constructor(e){super(e)}},[0,W2,[0,Q3,q2,[0,R2],q2,[0,X2],z2,H2],k2]),Z3=class extends w1{constructor(e){super(e)}},J3=[0,H2,z2,O2,V2,-1],$3=class extends w1{constructor(e){super(e)}},e4=[0,U2,-1],t4=class extends w1{constructor(e){super(e)}},n4=[1,2,3,4,5],i4=class extends w1{constructor(e){super(e)}g(){return null!=y0(this)}h(){return null!=V0(this,2)}},r4=class extends w1{constructor(e){super(e)}g(){var e;return null!==(e=P$(p0(this,2)))&&void 0!==e&&e}},s4=[0,X2,H2,[0,z2,k2,-1],[0,B2,k2]],a4=[0,s4,U2,[0,n4,q2,d3,q2,l3,q2,a3,q2,u3,q2,c3],K2],o4=class extends w1{constructor(e){super(e)}},l4=[0,a4,O2,-1,z2],c4=J2(502141897,o4);f3[502141897]=l4;var h4=$2(class extends w1{constructor(e){super(e)}},[0,[0,K2,-1,I2,Y2],V3]),u4=class extends w1{constructor(e){super(e)}},d4=class extends w1{constructor(e){super(e)}},p4=[0,a4,O2,[0,a4],U2],f4=[0,a4,l4,p4,O2,[0,[0,s4]]],m4=J2(508968150,d4);f3[508968150]=f4,f3[508968149]=p4;var g4=class extends w1{constructor(e){super(e)}},v4=J2(513916220,g4);f3[513916220]=[0,a4,f4,z2];var y4=class extends w1{constructor(e){super(e)}h(){return R0(this,Z3,2)}g(){m0(this,2)}},b4=[0,a4,J3];f3[478825465]=b4;var x4=class extends w1{constructor(e){super(e)}},w4=class extends w1{constructor(e){super(e)}},S4=class extends w1{constructor(e){super(e)}},_4=class extends w1{constructor(e){super(e)}},E4=class extends w1{constructor(e){super(e)}},A4=[0,a4,[0,a4],b4,-1],C4=[0,a4,O2,z2],M4=[0,a4,O2],T4=[0,a4,C4,M4,O2],P4=J2(479097054,E4);f3[479097054]=[0,a4,T4,A4],f3[463370452]=A4,f3[464864288]=C4;var D4=J2(462713202,_4);f3[462713202]=T4,f3[474472470]=M4;var O4=class extends w1{constructor(e){super(e)}},I4=class extends w1{constructor(e){super(e)}},R4=class extends w1{constructor(e){super(e)}},k4=class extends w1{constructor(e){super(e)}},L4=[0,a4,O2,-1,z2],B4=[0,a4,O2,U2];k4.prototype.g=e3([0,a4,M4,[0,a4],l4,p4,L4,B4]);var z4=class extends w1{constructor(e){super(e)}},N4=J2(456383383,z4);f3[456383383]=[0,a4,J3];var F4=class extends w1{constructor(e){super(e)}},U4=J2(476348187,F4);f3[476348187]=[0,a4,e4];var j4=class extends w1{constructor(e){super(e)}},V4=class extends w1{constructor(e){super(e)}},G4=[0,K2,-1],H4=J2(458105876,class extends w1{constructor(e){super(e)}g(){var e=this.u;const t=0|e[OJ],n=2&t;return e=function(e,t,n){var i=V4;const r=2&t;let s=!1;if(null==n){if(r)return n0();n=[]}else if(n.constructor===Q$){if(0==(2&n.L)||r)return n;n=n.X()}else Array.isArray(n)?s=!!(2&n[OJ]):n=[];if(r){if(!n.length)return n0();s||(s=!0,BJ(n))}else s&&(s=!1,n=E0(n));return s||(64&n[OJ]?n[OJ]&=-33:32&t&&kJ(n,32)),g0(e,t,2,i=new Q$(n,i,V$,void 0)),i}(e,t,f0(e,t,2)),!n&&V4&&(e.ra=!0),e}});f3[458105876]=[0,G4,S2,[!0,k2,[0,H2,-1,V2]]];var W4=class extends w1{constructor(e){super(e)}},q4=J2(458105758,W4);f3[458105758]=[0,a4,H2,G4];var X4=class extends w1{constructor(e){super(e)}},Y4=J2(443442058,X4);f3[443442058]=[0,a4,H2,z2,O2,V2,-1,U2,O2],f3[514774813]=L4;var Q4=class extends w1{constructor(e){super(e)}},K4=J2(516587230,Q4);function Z4(e,t){return t=t?t.clone():new Z3,void 0!==e.displayNamesLocale?m0(t,1,F$(e.displayNamesLocale)):void 0===e.displayNamesLocale&&m0(t,1),void 0!==e.maxResults?W0(t,2,e.maxResults):"maxResults"in e&&m0(t,2),void 0!==e.scoreThreshold?q0(t,3,e.scoreThreshold):"scoreThreshold"in e&&m0(t,3),void 0!==e.categoryAllowlist?X0(t,4,e.categoryAllowlist):"categoryAllowlist"in e&&m0(t,4),void 0!==e.categoryDenylist?X0(t,5,e.categoryDenylist):"categoryDenylist"in e&&m0(t,5),t}function J4(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";return{categories:e.map((e=>{var t,n,i,r,s,a,o;return{index:null!==(t=null!==(n=j0(e,1))&&void 0!==n?n:0)&&void 0!==t?t:-1,score:null!==(i=G0(e,2))&&void 0!==i?i:0,categoryName:null!==(r=null!==(s=V0(e,3))&&void 0!==s?s:"")&&void 0!==r?r:"",displayName:null!==(a=null!==(o=V0(e,4))&&void 0!==o?o:"")&&void 0!==a?a:""}})),headIndex:t,headName:n}}function $4(e){var t,n,i,r,s,a,o=x0(e,3,T$,b0()),l=x0(e,2,I$,b0()),c=x0(e,1,U$,b0()),h=x0(e,9,U$,b0());const u={categories:[],keypoints:[]};for(let b=0;b<o.length;b++){var d,p,f;u.categories.push({score:o[b],index:null!==(d=l[b])&&void 0!==d?d:-1,categoryName:null!==(p=c[b])&&void 0!==p?p:"",displayName:null!==(f=h[b])&&void 0!==f?f:""})}if((o=null===(t=R0(e,L3,4))||void 0===t?void 0:t.h())&&(u.boundingBox={originX:null!==(n=j0(o,1))&&void 0!==n?n:0,originY:null!==(i=j0(o,2))&&void 0!==i?i:0,width:null!==(r=j0(o,3))&&void 0!==r?r:0,height:null!==(s=j0(o,4))&&void 0!==s?s:0,angle:0}),null!==(a=R0(e,L3,4))&&void 0!==a&&a.g().length)for(const b of R0(e,L3,4).g()){var m,g,v,y;u.keypoints.push({x:null!==(m=v0(b,1))&&void 0!==m?m:0,y:null!==(g=v0(b,2))&&void 0!==g?g:0,score:null!==(v=v0(b,4))&&void 0!==v?v:0,label:null!==(y=V0(b,3))&&void 0!==y?y:""})}return u}function e5(e){const t=[];for(const a of L0(e,F3,1)){var n,i,r,s;t.push({x:null!==(n=G0(a,1))&&void 0!==n?n:0,y:null!==(i=G0(a,2))&&void 0!==i?i:0,z:null!==(r=G0(a,3))&&void 0!==r?r:0,visibility:null!==(s=G0(a,4))&&void 0!==s?s:0})}return t}function t5(e){const t=[];for(const a of L0(e,z3,1)){var n,i,r,s;t.push({x:null!==(n=G0(a,1))&&void 0!==n?n:0,y:null!==(i=G0(a,2))&&void 0!==i?i:0,z:null!==(r=G0(a,3))&&void 0!==r?r:0,visibility:null!==(s=G0(a,4))&&void 0!==s?s:0})}return t}function n5(e){return Array.from(e,(e=>e>127?e-256:e))}function i5(e,t){if(e.length!==t.length)throw Error("Cannot compute cosine similarity between embeddings of different sizes (".concat(e.length," vs. ").concat(t.length,")."));let n=0,i=0,r=0;for(let s=0;s<e.length;s++)n+=e[s]*t[s],i+=e[s]*e[s],r+=t[s]*t[s];if(i<=0||r<=0)throw Error("Cannot compute cosine similarity on embedding with 0 norm.");return n/Math.sqrt(i*r)}let r5;f3[516587230]=[0,a4,L4,B4,O2],f3[518928384]=B4;const s5=new Uint8Array([0,97,115,109,1,0,0,0,1,5,1,96,0,1,123,3,2,1,0,10,10,1,8,0,65,0,253,15,253,98,11]);async function a5(){if(void 0===r5)try{await WebAssembly.instantiate(s5),r5=!0}catch(e){r5=!1}return r5}async function o5(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(e){if(0===(arguments.length<=1?0:arguments.length-1))return s3(e[0]);let t=e[0];for(let n=0;n<(arguments.length<=1?0:arguments.length-1);n++)t+=encodeURIComponent(n+1<1||arguments.length<=n+1?void 0:arguments[n+1])+e[n+1];return s3(t)}(OZ||(OZ=function(e,t){return t||(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}([""])));const n=await a5()?"wasm_internal":"wasm_nosimd_internal";return{wasmLoaderPath:"".concat(t,"/").concat(e,"_").concat(n,".js"),wasmBinaryPath:"".concat(t,"/").concat(e,"_").concat(n,".wasm")}}var l5=class{};function c5(){var e=navigator;return"undefined"!=typeof OffscreenCanvas&&(!function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:navigator;return(e=e.userAgent).includes("Safari")&&!e.includes("Chrome")}(e)||!!((e=e.userAgent.match(/Version\/([\d]+).*Safari/))&&e.length>=1&&Number(e[1])>=17))}async function h5(e){if("function"!=typeof importScripts){const t=document.createElement("script");return t.src=e.toString(),t.crossOrigin="anonymous",new Promise(((e,n)=>{t.addEventListener("load",(()=>{e()}),!1),t.addEventListener("error",(e=>{n(e)}),!1),document.body.appendChild(t)}))}importScripts(e.toString())}function u5(e){return void 0!==e.videoWidth?[e.videoWidth,e.videoHeight]:void 0!==e.naturalWidth?[e.naturalWidth,e.naturalHeight]:void 0!==e.displayWidth?[e.displayWidth,e.displayHeight]:[e.width,e.height]}function d5(e,t,n){e.m||console.error("No wasm multistream support detected: ensure dependency inclusion of :gl_graph_runner_internal_multi_input target"),n(t=e.i.stringToNewUTF8(t)),e.i._free(t)}function p5(e,t,n){if(!e.i.canvas)throw Error("No OpenGL canvas configured.");if(n?e.i._bindTextureToStream(n):e.i._bindTextureToCanvas(),!(n=e.i.canvas.getContext("webgl2")||e.i.canvas.getContext("webgl")))throw Error("Failed to obtain WebGL context from the provided canvas. `getContext()` should only be invoked with `webgl` or `webgl2`.");e.i.gpuOriginForWebTexturesIsBottomLeft&&n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,!0),n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,t),e.i.gpuOriginForWebTexturesIsBottomLeft&&n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,!1);const[i,r]=u5(t);return!e.l||i===e.i.canvas.width&&r===e.i.canvas.height||(e.i.canvas.width=i,e.i.canvas.height=r),[i,r]}function f5(e,t,n){e.m||console.error("No wasm multistream support detected: ensure dependency inclusion of :gl_graph_runner_internal_multi_input target");const i=new Uint32Array(t.length);for(let r=0;r<t.length;r++)i[r]=e.i.stringToNewUTF8(t[r]);t=e.i._malloc(4*i.length),e.i.HEAPU32.set(i,t>>2),n(t);for(const r of i)e.i._free(r);e.i._free(t)}function m5(e,t,n){e.i.simpleListeners=e.i.simpleListeners||{},e.i.simpleListeners[t]=n}function g5(e,t,n){let i=[];e.i.simpleListeners=e.i.simpleListeners||{},e.i.simpleListeners[t]=(e,t,r)=>{t?(n(i,r),i=[]):i.push(e)}}function v5(e,t){const n=R0(e.baseOptions,i4,1)||new i4;"string"==typeof t?(m0(n,2,F$(t)),m0(n,1)):t instanceof Uint8Array&&(m0(n,1,qJ(t,!1)),m0(n,2)),B0(e.baseOptions,0,1,n)}function y5(e){try{const t=e.G.length;if(1===t)throw Error(e.G[0].message);if(t>1)throw Error("Encountered multiple errors: "+e.G.map((e=>e.message)).join(", "))}finally{e.G=[]}}function b5(e,t){e.B=Math.max(e.B,t)}function x5(e,t){e.A=new b3,g3(e.A,"PassThroughCalculator"),v3(e.A,"free_memory"),y3(e.A,"free_memory_unused_out"),E3(t,"free_memory"),_3(t,e.A)}function w5(e,t){v3(e.A,t),y3(e.A,t+"_unused_out")}function S5(e){e.g.addBoolToStream(!0,"free_memory",e.B)}l5.forVisionTasks=function(e){return o5("vision",e)},l5.forTextTasks=function(e){return o5("text",e)},l5.forGenAiExperimentalTasks=function(e){return o5("genai_experimental",e)},l5.forGenAiTasks=function(e){return o5("genai",e)},l5.forAudioTasks=function(e){return o5("audio",e)},l5.isSimdSupported=function(){return a5()};var _5=class{constructor(e){this.g=e,this.G=[],this.B=0,this.g.setAutoRenderToScreen(!1)}l(e){if(!(arguments.length>1&&void 0!==arguments[1])||arguments[1]){var t,n,i,r,s,a;const o=e.baseOptions||{};if(null!==(t=e.baseOptions)&&void 0!==t&&t.modelAssetBuffer&&null!==(n=e.baseOptions)&&void 0!==n&&n.modelAssetPath)throw Error("Cannot set both baseOptions.modelAssetPath and baseOptions.modelAssetBuffer");if(!(null!==(i=R0(this.baseOptions,i4,1))&&void 0!==i&&i.g()||null!==(r=R0(this.baseOptions,i4,1))&&void 0!==r&&r.h()||null!==(s=e.baseOptions)&&void 0!==s&&s.modelAssetBuffer||null!==(a=e.baseOptions)&&void 0!==a&&a.modelAssetPath))throw Error("Either baseOptions.modelAssetPath or baseOptions.modelAssetBuffer must be set");if(function(e,t){let n=R0(e.baseOptions,t4,3);if(!n){var i=n=new t4,r=new h3;z0(i,4,n4,r)}"delegate"in t&&("GPU"===t.delegate?(t=n,i=new o3,z0(t,2,n4,i)):(t=n,i=new h3,z0(t,4,n4,i))),B0(e.baseOptions,0,3,n)}(this,o),o.modelAssetPath)return fetch(o.modelAssetPath.toString()).then((e=>{if(e.ok)return e.arrayBuffer();throw Error("Failed to fetch model: ".concat(o.modelAssetPath," (").concat(e.status,")"))})).then((e=>{try{this.g.i.FS_unlink("/model.dat")}catch(t){}this.g.i.FS_createDataFile("/","model.dat",new Uint8Array(e),!0,!1,!1),v5(this,"/model.dat"),this.m(),this.I()}));if(o.modelAssetBuffer instanceof Uint8Array)v5(this,o.modelAssetBuffer);else if(o.modelAssetBuffer)return async function(e){const t=[];for(var n=0;;){const{done:i,value:r}=await e.read();if(i)break;t.push(r),n+=r.length}if(0===t.length)return new Uint8Array(0);if(1===t.length)return t[0];e=new Uint8Array(n),n=0;for(const i of t)e.set(i,n),n+=i.length;return e}(o.modelAssetBuffer).then((e=>{v5(this,e),this.m(),this.I()}))}return this.m(),this.I(),Promise.resolve()}I(){}da(){let e;if(this.g.da((t=>{e=T3(t)})),!e)throw Error("Failed to retrieve CalculatorGraphConfig");return e}setGraph(e,t){this.g.attachErrorListener(((e,t)=>{this.G.push(Error(t))})),this.g.La(),this.g.setGraph(e,t),this.A=void 0,y5(this)}finishProcessing(){this.g.finishProcessing(),y5(this)}close(){this.A=void 0,this.g.closeGraph()}};function E5(e,t){if(!e)throw Error("Unable to obtain required WebGL resource: ".concat(t));return e}_5.prototype.close=_5.prototype.close,function(e,t){e=e.split(".");var n,i=kZ;e[0]in i||void 0===i.execScript||i.execScript("var "+e[0]);for(;e.length&&(n=e.shift());)e.length||void 0===t?i=i[n]&&i[n]!==Object.prototype[n]?i[n]:i[n]={}:i[n]=t}("TaskRunner",_5);class A5{constructor(e,t,n,i){this.g=e,this.h=t,this.m=n,this.l=i}bind(){this.g.bindVertexArray(this.h)}close(){this.g.deleteVertexArray(this.h),this.g.deleteBuffer(this.m),this.g.deleteBuffer(this.l)}}function C5(e,t,n){const i=e.g;if(n=E5(i.createShader(n),"Failed to create WebGL shader"),i.shaderSource(n,t),i.compileShader(n),!i.getShaderParameter(n,i.COMPILE_STATUS))throw Error("Could not compile WebGL shader: ".concat(i.getShaderInfoLog(n)));return i.attachShader(e.h,n),n}function M5(e,t){const n=e.g,i=E5(n.createVertexArray(),"Failed to create vertex array");n.bindVertexArray(i);const r=E5(n.createBuffer(),"Failed to create buffer");n.bindBuffer(n.ARRAY_BUFFER,r),n.enableVertexAttribArray(e.O),n.vertexAttribPointer(e.O,2,n.FLOAT,!1,0,0),n.bufferData(n.ARRAY_BUFFER,new Float32Array([-1,-1,-1,1,1,1,1,-1]),n.STATIC_DRAW);const s=E5(n.createBuffer(),"Failed to create buffer");return n.bindBuffer(n.ARRAY_BUFFER,s),n.enableVertexAttribArray(e.I),n.vertexAttribPointer(e.I,2,n.FLOAT,!1,0,0),n.bufferData(n.ARRAY_BUFFER,new Float32Array(t?[0,1,0,0,1,0,1,1]:[0,0,0,1,1,1,1,0]),n.STATIC_DRAW),n.bindBuffer(n.ARRAY_BUFFER,null),n.bindVertexArray(null),new A5(n,i,r,s)}function T5(e,t){if(e.g){if(t!==e.g)throw Error("Cannot change GL context once initialized")}else e.g=t}function P5(e,t,n,i){return T5(e,t),e.h||(e.m(),e.C()),n?(e.s||(e.s=M5(e,!0)),n=e.s):(e.v||(e.v=M5(e,!1)),n=e.v),t.useProgram(e.h),n.bind(),e.l(),e=i(),n.g.bindVertexArray(null),e}function D5(e,t,n){return T5(e,t),e=E5(t.createTexture(),"Failed to create texture"),t.bindTexture(t.TEXTURE_2D,e),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,null!==n&&void 0!==n?n:t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,null!==n&&void 0!==n?n:t.LINEAR),t.bindTexture(t.TEXTURE_2D,null),e}function O5(e,t,n){T5(e,t),e.A||(e.A=E5(t.createFramebuffer(),"Failed to create framebuffe.")),t.bindFramebuffer(t.FRAMEBUFFER,e.A),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,n,0)}function I5(e){var t;null===(t=e.g)||void 0===t||t.bindFramebuffer(e.g.FRAMEBUFFER,null)}var R5=class{G(){return"\n  precision mediump float;\n  varying vec2 vTex;\n  uniform sampler2D inputTexture;\n  void main() {\n    gl_FragColor = texture2D(inputTexture, vTex);\n  }\n "}m(){const e=this.g;if(this.h=E5(e.createProgram(),"Failed to create WebGL program"),this.aa=C5(this,"\n  attribute vec2 aVertex;\n  attribute vec2 aTex;\n  varying vec2 vTex;\n  void main(void) {\n    gl_Position = vec4(aVertex, 0.0, 1.0);\n    vTex = aTex;\n  }",e.VERTEX_SHADER),this.Z=C5(this,this.G(),e.FRAGMENT_SHADER),e.linkProgram(this.h),!e.getProgramParameter(this.h,e.LINK_STATUS))throw Error("Error during program linking: ".concat(e.getProgramInfoLog(this.h)));this.O=e.getAttribLocation(this.h,"aVertex"),this.I=e.getAttribLocation(this.h,"aTex")}C(){}l(){}close(){if(this.h){const e=this.g;e.deleteProgram(this.h),e.deleteShader(this.aa),e.deleteShader(this.Z)}this.A&&this.g.deleteFramebuffer(this.A),this.v&&this.v.close(),this.s&&this.s.close()}},k5=class extends R5{G(){return"\n  precision mediump float;\n  uniform sampler2D backgroundTexture;\n  uniform sampler2D maskTexture;\n  uniform sampler2D colorMappingTexture;\n  varying vec2 vTex;\n  void main() {\n    vec4 backgroundColor = texture2D(backgroundTexture, vTex);\n    float category = texture2D(maskTexture, vTex).r;\n    vec4 categoryColor = texture2D(colorMappingTexture, vec2(category, 0.0));\n    gl_FragColor = mix(backgroundColor, categoryColor, categoryColor.a);\n  }\n "}C(){const e=this.g;e.activeTexture(e.TEXTURE1),this.B=D5(this,e,e.LINEAR),e.activeTexture(e.TEXTURE2),this.j=D5(this,e,e.NEAREST)}m(){super.m();const e=this.g;this.K=E5(e.getUniformLocation(this.h,"backgroundTexture"),"Uniform location"),this.T=E5(e.getUniformLocation(this.h,"colorMappingTexture"),"Uniform location"),this.J=E5(e.getUniformLocation(this.h,"maskTexture"),"Uniform location")}l(){super.l();const e=this.g;e.uniform1i(this.J,0),e.uniform1i(this.K,1),e.uniform1i(this.T,2)}close(){this.B&&this.g.deleteTexture(this.B),this.j&&this.g.deleteTexture(this.j),super.close()}},L5=class extends R5{G(){return"\n  precision mediump float;\n  uniform sampler2D maskTexture;\n  uniform sampler2D defaultTexture;\n  uniform sampler2D overlayTexture;\n  varying vec2 vTex;\n  void main() {\n    float confidence = texture2D(maskTexture, vTex).r;\n    vec4 defaultColor = texture2D(defaultTexture, vTex);\n    vec4 overlayColor = texture2D(overlayTexture, vTex);\n    // Apply the alpha from the overlay and merge in the default color\n    overlayColor = mix(defaultColor, overlayColor, overlayColor.a);\n    gl_FragColor = mix(defaultColor, overlayColor, confidence);\n  }\n "}C(){const e=this.g;e.activeTexture(e.TEXTURE1),this.j=D5(this,e),e.activeTexture(e.TEXTURE2),this.B=D5(this,e)}m(){super.m();const e=this.g;this.J=E5(e.getUniformLocation(this.h,"defaultTexture"),"Uniform location"),this.K=E5(e.getUniformLocation(this.h,"overlayTexture"),"Uniform location"),this.H=E5(e.getUniformLocation(this.h,"maskTexture"),"Uniform location")}l(){super.l();const e=this.g;e.uniform1i(this.H,0),e.uniform1i(this.J,1),e.uniform1i(this.K,2)}close(){this.j&&this.g.deleteTexture(this.j),this.B&&this.g.deleteTexture(this.B),super.close()}};function B5(e,t){switch(t){case 0:return e.g.find((e=>e instanceof Uint8Array));case 1:return e.g.find((e=>e instanceof Float32Array));case 2:return e.g.find((e=>"undefined"!=typeof WebGLTexture&&e instanceof WebGLTexture));default:throw Error("Type is not supported: ".concat(t))}}function z5(e){var t=B5(e,1);if(!t){if(t=B5(e,0))t=new Float32Array(t).map((e=>e/255));else{t=new Float32Array(e.width*e.height);const i=F5(e);var n=j5(e);if(O5(n,i,N5(e)),"iPad Simulator;iPhone Simulator;iPod Simulator;iPad;iPhone;iPod".split(";").includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"document"in self&&"ontouchend"in self.document){n=new Float32Array(e.width*e.height*4),i.readPixels(0,0,e.width,e.height,i.RGBA,i.FLOAT,n);for(let e=0,i=0;e<t.length;++e,i+=4)t[e]=n[i]}else i.readPixels(0,0,e.width,e.height,i.RED,i.FLOAT,t)}e.g.push(t)}return t}function N5(e){let t=B5(e,2);if(!t){const n=F5(e);t=V5(e);const i=z5(e),r=U5(e);n.texImage2D(n.TEXTURE_2D,0,r,e.width,e.height,0,n.RED,n.FLOAT,i),G5(e)}return t}function F5(e){if(!e.canvas)throw Error("Conversion to different image formats require that a canvas is passed when initializing the image.");return e.h||(e.h=E5(e.canvas.getContext("webgl2"),"You cannot use a canvas that is already bound to a different type of rendering context.")),e.h}function U5(e){if(e=F5(e),!H5)if(e.getExtension("EXT_color_buffer_float")&&e.getExtension("OES_texture_float_linear")&&e.getExtension("EXT_float_blend"))H5=e.R32F;else{if(!e.getExtension("EXT_color_buffer_half_float"))throw Error("GPU does not fully support 4-channel float32 or float16 formats");H5=e.R16F}return H5}function j5(e){return e.l||(e.l=new R5),e.l}function V5(e){const t=F5(e);t.viewport(0,0,e.width,e.height),t.activeTexture(t.TEXTURE0);let n=B5(e,2);return n||(n=D5(j5(e),t,e.m?t.LINEAR:t.NEAREST),e.g.push(n),e.j=!0),t.bindTexture(t.TEXTURE_2D,n),n}function G5(e){e.h.bindTexture(e.h.TEXTURE_2D,null)}var H5,W5=class{constructor(e,t,n,i,r,s,a){this.g=e,this.m=t,this.j=n,this.canvas=i,this.l=r,this.width=s,this.height=a,this.j&&0===--q5&&console.error("You seem to be creating MPMask instances without invoking .close(). This leaks resources.")}Fa(){return!!B5(this,0)}ja(){return!!B5(this,1)}P(){return!!B5(this,2)}ia(){return(e=B5(this,0))||(e=z5(this),e=new Uint8Array(e.map((e=>255*e))),this.g.push(e)),e;var e}ha(){return z5(this)}M(){return N5(this)}clone(){const e=[];for(const t of this.g){let n;if(t instanceof Uint8Array)n=new Uint8Array(t);else if(t instanceof Float32Array)n=new Float32Array(t);else{if(!(t instanceof WebGLTexture))throw Error("Type is not supported: ".concat(t));{const e=F5(this),t=j5(this);e.activeTexture(e.TEXTURE1),n=D5(t,e,this.m?e.LINEAR:e.NEAREST),e.bindTexture(e.TEXTURE_2D,n);const i=U5(this);e.texImage2D(e.TEXTURE_2D,0,i,this.width,this.height,0,e.RED,e.FLOAT,null),e.bindTexture(e.TEXTURE_2D,null),O5(t,e,n),P5(t,e,!1,(()=>{V5(this),e.clearColor(0,0,0,0),e.clear(e.COLOR_BUFFER_BIT),e.drawArrays(e.TRIANGLE_FAN,0,4),G5(this)})),I5(t),G5(this)}}e.push(n)}return new W5(e,this.m,this.P(),this.canvas,this.l,this.width,this.height)}close(){this.j&&F5(this).deleteTexture(B5(this,2)),q5=-1}};W5.prototype.close=W5.prototype.close,W5.prototype.clone=W5.prototype.clone,W5.prototype.getAsWebGLTexture=W5.prototype.M,W5.prototype.getAsFloat32Array=W5.prototype.ha,W5.prototype.getAsUint8Array=W5.prototype.ia,W5.prototype.hasWebGLTexture=W5.prototype.P,W5.prototype.hasFloat32Array=W5.prototype.ja,W5.prototype.hasUint8Array=W5.prototype.Fa;var q5=250;const X5={color:"white",lineWidth:4,radius:6};function Y5(e){return o(o({},X5),{},{fillColor:(e=e||{}).color},e)}function Q5(e,t){return e instanceof Function?e(t):e}function K5(e,t,n){return Math.max(Math.min(t,n),Math.min(Math.max(t,n),e))}function Z5(e){if(!e.l)throw Error("CPU rendering requested but CanvasRenderingContext2D not provided.");return e.l}function J5(e){if(!e.j)throw Error("GPU rendering requested but WebGL2RenderingContext not provided.");return e.j}function $5(e,t,n){if(t.P())n(t.M());else{var i;const r=t.ja()?t.ha():t.ia();e.m=null!==(i=e.m)&&void 0!==i?i:new R5;const s=J5(e);n((e=new W5([r],t.m,!1,s.canvas,e.m,t.width,t.height)).M()),e.close()}}function e6(e,t,n,i){const r=function(e){return e.g||(e.g=new k5),e.g}(e),s=J5(e),a=Array.isArray(n)?new ImageData(new Uint8ClampedArray(n),1,1):n;P5(r,s,!0,(()=>{!function(e,t,n,i){const r=e.g;if(r.activeTexture(r.TEXTURE0),r.bindTexture(r.TEXTURE_2D,t),r.activeTexture(r.TEXTURE1),r.bindTexture(r.TEXTURE_2D,e.B),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,r.RGBA,r.UNSIGNED_BYTE,n),e.H&&function(e,t){if(e!==t)return!1;e=e.entries(),t=t.entries();for(const[i,r]of e){e=i;const s=r;var n=t.next();if(n.done)return!1;const[a,o]=n.value;if(n=o,e!==a||s[0]!==n[0]||s[1]!==n[1]||s[2]!==n[2]||s[3]!==n[3])return!1}return!!t.next().done}(e.H,i))r.activeTexture(r.TEXTURE2),r.bindTexture(r.TEXTURE_2D,e.j);else{e.H=i;const t=Array(1024).fill(0);i.forEach(((e,n)=>{if(4!==e.length)throw Error("Color at index ".concat(n," is not a four-channel value."));t[4*n]=e[0],t[4*n+1]=e[1],t[4*n+2]=e[2],t[4*n+3]=e[3]})),r.activeTexture(r.TEXTURE2),r.bindTexture(r.TEXTURE_2D,e.j),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,256,1,0,r.RGBA,r.UNSIGNED_BYTE,new Uint8Array(t))}}(r,t,a,i),s.clearColor(0,0,0,0),s.clear(s.COLOR_BUFFER_BIT),s.drawArrays(s.TRIANGLE_FAN,0,4);const e=r.g;e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,null),e.activeTexture(e.TEXTURE1),e.bindTexture(e.TEXTURE_2D,null),e.activeTexture(e.TEXTURE2),e.bindTexture(e.TEXTURE_2D,null)}))}function t6(e,t,n,i){const r=J5(e),s=function(e){return e.h||(e.h=new L5),e.h}(e),a=Array.isArray(n)?new ImageData(new Uint8ClampedArray(n),1,1):n,o=Array.isArray(i)?new ImageData(new Uint8ClampedArray(i),1,1):i;P5(s,r,!0,(()=>{var e=s.g;e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,t),e.activeTexture(e.TEXTURE1),e.bindTexture(e.TEXTURE_2D,s.j),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,a),e.activeTexture(e.TEXTURE2),e.bindTexture(e.TEXTURE_2D,s.B),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,o),r.clearColor(0,0,0,0),r.clear(r.COLOR_BUFFER_BIT),r.drawArrays(r.TRIANGLE_FAN,0,4),r.bindTexture(r.TEXTURE_2D,null),(e=s.g).activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,null),e.activeTexture(e.TEXTURE1),e.bindTexture(e.TEXTURE_2D,null),e.activeTexture(e.TEXTURE2),e.bindTexture(e.TEXTURE_2D,null)}))}var n6=class{constructor(e,t){e instanceof CanvasRenderingContext2D||e instanceof OffscreenCanvasRenderingContext2D?(this.l=e,this.j=t):this.j=e}ya(e,t){if(e){var n=Z5(this);t=Y5(t),n.save();var i=n.canvas,r=0;for(const s of e)n.fillStyle=Q5(t.fillColor,{index:r,from:s}),n.strokeStyle=Q5(t.color,{index:r,from:s}),n.lineWidth=Q5(t.lineWidth,{index:r,from:s}),(e=new Path2D).arc(s.x*i.width,s.y*i.height,Q5(t.radius,{index:r,from:s}),0,2*Math.PI),n.fill(e),n.stroke(e),++r;n.restore()}}xa(e,t,n){if(e&&t){var i=Z5(this);n=Y5(n),i.save();var r=i.canvas,s=0;for(const a of t){i.beginPath(),t=e[a.start];const o=e[a.end];t&&o&&(i.strokeStyle=Q5(n.color,{index:s,from:t,to:o}),i.lineWidth=Q5(n.lineWidth,{index:s,from:t,to:o}),i.moveTo(t.x*r.width,t.y*r.height),i.lineTo(o.x*r.width,o.y*r.height)),++s,i.stroke()}i.restore()}}ua(e,t){const n=Z5(this);t=Y5(t),n.save(),n.beginPath(),n.lineWidth=Q5(t.lineWidth,{}),n.strokeStyle=Q5(t.color,{}),n.fillStyle=Q5(t.fillColor,{}),n.moveTo(e.originX,e.originY),n.lineTo(e.originX+e.width,e.originY),n.lineTo(e.originX+e.width,e.originY+e.height),n.lineTo(e.originX,e.originY+e.height),n.lineTo(e.originX,e.originY),n.stroke(),n.fill(),n.restore()}va(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[0,0,0,255];this.l?function(e,t,n,i){const r=J5(e);$5(e,t,(t=>{e6(e,t,n,i),(t=Z5(e)).drawImage(r.canvas,0,0,t.canvas.width,t.canvas.height)}))}(this,e,n,t):e6(this,e.M(),n,t)}wa(e,t,n){this.l?function(e,t,n,i){const r=J5(e);$5(e,t,(t=>{t6(e,t,n,i),(t=Z5(e)).drawImage(r.canvas,0,0,t.canvas.width,t.canvas.height)}))}(this,e,t,n):t6(this,e.M(),t,n)}close(){var e,t,n;null!==(e=this.g)&&void 0!==e&&e.close(),this.g=void 0,null!==(t=this.h)&&void 0!==t&&t.close(),this.h=void 0,null!==(n=this.m)&&void 0!==n&&n.close(),this.m=void 0}};function i6(e,t){switch(t){case 0:return e.g.find((e=>e instanceof ImageData));case 1:return e.g.find((e=>"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap));case 2:return e.g.find((e=>"undefined"!=typeof WebGLTexture&&e instanceof WebGLTexture));default:throw Error("Type is not supported: ".concat(t))}}function r6(e){var t=i6(e,0);if(!t){t=a6(e);const n=o6(e),i=new Uint8Array(e.width*e.height*4);O5(n,t,s6(e)),t.readPixels(0,0,e.width,e.height,t.RGBA,t.UNSIGNED_BYTE,i),I5(n),t=new ImageData(new Uint8ClampedArray(i.buffer),e.width,e.height),e.g.push(t)}return t}function s6(e){let t=i6(e,2);if(!t){const n=a6(e);t=l6(e);const i=i6(e,1)||r6(e);n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,i),c6(e)}return t}function a6(e){if(!e.canvas)throw Error("Conversion to different image formats require that a canvas is passed when initializing the image.");return e.h||(e.h=E5(e.canvas.getContext("webgl2"),"You cannot use a canvas that is already bound to a different type of rendering context.")),e.h}function o6(e){return e.l||(e.l=new R5),e.l}function l6(e){const t=a6(e);t.viewport(0,0,e.width,e.height),t.activeTexture(t.TEXTURE0);let n=i6(e,2);return n||(n=D5(o6(e),t),e.g.push(n),e.m=!0),t.bindTexture(t.TEXTURE_2D,n),n}function c6(e){e.h.bindTexture(e.h.TEXTURE_2D,null)}function h6(e){const t=a6(e);return P5(o6(e),t,!0,(()=>function(e,t){const n=e.canvas;if(n.width===e.width&&n.height===e.height)return t();const i=n.width,r=n.height;return n.width=e.width,n.height=e.height,e=t(),n.width=i,n.height=r,e}(e,(()=>{if(t.bindFramebuffer(t.FRAMEBUFFER,null),t.clearColor(0,0,0,0),t.clear(t.COLOR_BUFFER_BIT),t.drawArrays(t.TRIANGLE_FAN,0,4),!(e.canvas instanceof OffscreenCanvas))throw Error("Conversion to ImageBitmap requires that the MediaPipe Tasks is initialized with an OffscreenCanvas");return e.canvas.transferToImageBitmap()}))))}n6.prototype.close=n6.prototype.close,n6.prototype.drawConfidenceMask=n6.prototype.wa,n6.prototype.drawCategoryMask=n6.prototype.va,n6.prototype.drawBoundingBox=n6.prototype.ua,n6.prototype.drawConnectors=n6.prototype.xa,n6.prototype.drawLandmarks=n6.prototype.ya,n6.lerp=function(e,t,n,i,r){return K5(i*(1-(e-t)/(n-t))+r*(1-(n-e)/(n-t)),i,r)},n6.clamp=K5;var u6=class{constructor(e,t,n,i,r,s,a){this.g=e,this.j=t,this.m=n,this.canvas=i,this.l=r,this.width=s,this.height=a,(this.j||this.m)&&0===--d6&&console.error("You seem to be creating MPImage instances without invoking .close(). This leaks resources.")}Ea(){return!!i6(this,0)}ka(){return!!i6(this,1)}P(){return!!i6(this,2)}Ca(){return r6(this)}Ba(){var e=i6(this,1);return e||(s6(this),l6(this),e=h6(this),c6(this),this.g.push(e),this.j=!0),e}M(){return s6(this)}clone(){const e=[];for(const t of this.g){let n;if(t instanceof ImageData)n=new ImageData(t.data,this.width,this.height);else if(t instanceof WebGLTexture){const e=a6(this),t=o6(this);e.activeTexture(e.TEXTURE1),n=D5(t,e),e.bindTexture(e.TEXTURE_2D,n),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,this.width,this.height,0,e.RGBA,e.UNSIGNED_BYTE,null),e.bindTexture(e.TEXTURE_2D,null),O5(t,e,n),P5(t,e,!1,(()=>{l6(this),e.clearColor(0,0,0,0),e.clear(e.COLOR_BUFFER_BIT),e.drawArrays(e.TRIANGLE_FAN,0,4),c6(this)})),I5(t),c6(this)}else{if(!(t instanceof ImageBitmap))throw Error("Type is not supported: ".concat(t));s6(this),l6(this),n=h6(this),c6(this)}e.push(n)}return new u6(e,this.ka(),this.P(),this.canvas,this.l,this.width,this.height)}close(){this.j&&i6(this,1).close(),this.m&&a6(this).deleteTexture(i6(this,2)),d6=-1}};u6.prototype.close=u6.prototype.close,u6.prototype.clone=u6.prototype.clone,u6.prototype.getAsWebGLTexture=u6.prototype.M,u6.prototype.getAsImageBitmap=u6.prototype.Ba,u6.prototype.getAsImageData=u6.prototype.Ca,u6.prototype.hasWebGLTexture=u6.prototype.P,u6.prototype.hasImageBitmap=u6.prototype.ka,u6.prototype.hasImageData=u6.prototype.Ea;var d6=250;function p6(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.map((e=>{let[t,n]=e;return{start:t,end:n}}))}const f6=function(e){return class extends e{La(){this.i._registerModelResourcesGraphService()}}}((m6=class{constructor(e,t){this.l=!0,this.i=e,this.g=null,this.h=0,this.m="function"==typeof this.i._addIntToInputStream,void 0!==t?this.i.canvas=t:c5()?this.i.canvas=new OffscreenCanvas(1,1):(console.warn("OffscreenCanvas not supported and GraphRunner constructor glCanvas parameter is undefined. Creating backup canvas."),this.i.canvas=document.createElement("canvas"))}async initializeGraph(e){const t=await(await fetch(e)).arrayBuffer();e=!(e.endsWith(".pbtxt")||e.endsWith(".textproto")),this.setGraph(new Uint8Array(t),e)}setGraphFromString(e){this.setGraph((new TextEncoder).encode(e),!1)}setGraph(e,t){const n=e.length,i=this.i._malloc(n);this.i.HEAPU8.set(e,i),t?this.i._changeBinaryGraph(n,i):this.i._changeTextGraph(n,i),this.i._free(i)}configureAudio(e,t,n,i,r){this.i._configureAudio||console.warn('Attempting to use configureAudio without support for input audio. Is build dep ":gl_graph_runner_audio" missing?'),d5(this,i||"input_audio",(i=>{d5(this,r=r||"audio_header",(r=>{this.i._configureAudio(i,r,e,null!==t&&void 0!==t?t:0,n)}))}))}setAutoResizeCanvas(e){this.l=e}setAutoRenderToScreen(e){this.i._setAutoRenderToScreen(e)}setGpuBufferVerticalFlip(e){this.i.gpuOriginForWebTexturesIsBottomLeft=e}da(e){m5(this,"__graph_config__",(t=>{e(t)})),d5(this,"__graph_config__",(e=>{this.i._getGraphConfig(e,void 0)})),delete this.i.simpleListeners.__graph_config__}attachErrorListener(e){this.i.errorListener=e}attachEmptyPacketListener(e,t){this.i.emptyPacketListeners=this.i.emptyPacketListeners||{},this.i.emptyPacketListeners[e]=t}addAudioToStream(e,t,n){this.addAudioToStreamWithShape(e,0,0,t,n)}addAudioToStreamWithShape(e,t,n,i,r){const s=4*e.length;this.h!==s&&(this.g&&this.i._free(this.g),this.g=this.i._malloc(s),this.h=s),this.i.HEAPF32.set(e,this.g/4),d5(this,i,(e=>{this.i._addAudioToInputStream(this.g,t,n,e,r)}))}addGpuBufferToStream(e,t,n){d5(this,t,(t=>{const[i,r]=p5(this,e,t);this.i._addBoundTextureToStream(t,i,r,n)}))}addBoolToStream(e,t,n){d5(this,t,(t=>{this.i._addBoolToInputStream(e,t,n)}))}addDoubleToStream(e,t,n){d5(this,t,(t=>{this.i._addDoubleToInputStream(e,t,n)}))}addFloatToStream(e,t,n){d5(this,t,(t=>{this.i._addFloatToInputStream(e,t,n)}))}addIntToStream(e,t,n){d5(this,t,(t=>{this.i._addIntToInputStream(e,t,n)}))}addUintToStream(e,t,n){d5(this,t,(t=>{this.i._addUintToInputStream(e,t,n)}))}addStringToStream(e,t,n){d5(this,t,(t=>{d5(this,e,(e=>{this.i._addStringToInputStream(e,t,n)}))}))}addStringRecordToStream(e,t,n){d5(this,t,(t=>{f5(this,Object.keys(e),(i=>{f5(this,Object.values(e),(r=>{this.i._addFlatHashMapToInputStream(i,r,Object.keys(e).length,t,n)}))}))}))}addProtoToStream(e,t,n,i){d5(this,n,(n=>{d5(this,t,(t=>{const r=this.i._malloc(e.length);this.i.HEAPU8.set(e,r),this.i._addProtoToInputStream(r,e.length,t,n,i),this.i._free(r)}))}))}addEmptyPacketToStream(e,t){d5(this,e,(e=>{this.i._addEmptyPacketToInputStream(e,t)}))}addBoolVectorToStream(e,t,n){d5(this,t,(t=>{const i=this.i._allocateBoolVector(e.length);if(!i)throw Error("Unable to allocate new bool vector on heap.");for(const n of e)this.i._addBoolVectorEntry(i,n);this.i._addBoolVectorToInputStream(i,t,n)}))}addDoubleVectorToStream(e,t,n){d5(this,t,(t=>{const i=this.i._allocateDoubleVector(e.length);if(!i)throw Error("Unable to allocate new double vector on heap.");for(const n of e)this.i._addDoubleVectorEntry(i,n);this.i._addDoubleVectorToInputStream(i,t,n)}))}addFloatVectorToStream(e,t,n){d5(this,t,(t=>{const i=this.i._allocateFloatVector(e.length);if(!i)throw Error("Unable to allocate new float vector on heap.");for(const n of e)this.i._addFloatVectorEntry(i,n);this.i._addFloatVectorToInputStream(i,t,n)}))}addIntVectorToStream(e,t,n){d5(this,t,(t=>{const i=this.i._allocateIntVector(e.length);if(!i)throw Error("Unable to allocate new int vector on heap.");for(const n of e)this.i._addIntVectorEntry(i,n);this.i._addIntVectorToInputStream(i,t,n)}))}addUintVectorToStream(e,t,n){d5(this,t,(t=>{const i=this.i._allocateUintVector(e.length);if(!i)throw Error("Unable to allocate new unsigned int vector on heap.");for(const n of e)this.i._addUintVectorEntry(i,n);this.i._addUintVectorToInputStream(i,t,n)}))}addStringVectorToStream(e,t,n){d5(this,t,(t=>{const i=this.i._allocateStringVector(e.length);if(!i)throw Error("Unable to allocate new string vector on heap.");for(const n of e)d5(this,n,(e=>{this.i._addStringVectorEntry(i,e)}));this.i._addStringVectorToInputStream(i,t,n)}))}addBoolToInputSidePacket(e,t){d5(this,t,(t=>{this.i._addBoolToInputSidePacket(e,t)}))}addDoubleToInputSidePacket(e,t){d5(this,t,(t=>{this.i._addDoubleToInputSidePacket(e,t)}))}addFloatToInputSidePacket(e,t){d5(this,t,(t=>{this.i._addFloatToInputSidePacket(e,t)}))}addIntToInputSidePacket(e,t){d5(this,t,(t=>{this.i._addIntToInputSidePacket(e,t)}))}addUintToInputSidePacket(e,t){d5(this,t,(t=>{this.i._addUintToInputSidePacket(e,t)}))}addStringToInputSidePacket(e,t){d5(this,t,(t=>{d5(this,e,(e=>{this.i._addStringToInputSidePacket(e,t)}))}))}addProtoToInputSidePacket(e,t,n){d5(this,n,(n=>{d5(this,t,(t=>{const i=this.i._malloc(e.length);this.i.HEAPU8.set(e,i),this.i._addProtoToInputSidePacket(i,e.length,t,n),this.i._free(i)}))}))}addBoolVectorToInputSidePacket(e,t){d5(this,t,(t=>{const n=this.i._allocateBoolVector(e.length);if(!n)throw Error("Unable to allocate new bool vector on heap.");for(const i of e)this.i._addBoolVectorEntry(n,i);this.i._addBoolVectorToInputSidePacket(n,t)}))}addDoubleVectorToInputSidePacket(e,t){d5(this,t,(t=>{const n=this.i._allocateDoubleVector(e.length);if(!n)throw Error("Unable to allocate new double vector on heap.");for(const i of e)this.i._addDoubleVectorEntry(n,i);this.i._addDoubleVectorToInputSidePacket(n,t)}))}addFloatVectorToInputSidePacket(e,t){d5(this,t,(t=>{const n=this.i._allocateFloatVector(e.length);if(!n)throw Error("Unable to allocate new float vector on heap.");for(const i of e)this.i._addFloatVectorEntry(n,i);this.i._addFloatVectorToInputSidePacket(n,t)}))}addIntVectorToInputSidePacket(e,t){d5(this,t,(t=>{const n=this.i._allocateIntVector(e.length);if(!n)throw Error("Unable to allocate new int vector on heap.");for(const i of e)this.i._addIntVectorEntry(n,i);this.i._addIntVectorToInputSidePacket(n,t)}))}addUintVectorToInputSidePacket(e,t){d5(this,t,(t=>{const n=this.i._allocateUintVector(e.length);if(!n)throw Error("Unable to allocate new unsigned int vector on heap.");for(const i of e)this.i._addUintVectorEntry(n,i);this.i._addUintVectorToInputSidePacket(n,t)}))}addStringVectorToInputSidePacket(e,t){d5(this,t,(t=>{const n=this.i._allocateStringVector(e.length);if(!n)throw Error("Unable to allocate new string vector on heap.");for(const i of e)d5(this,i,(e=>{this.i._addStringVectorEntry(n,e)}));this.i._addStringVectorToInputSidePacket(n,t)}))}attachBoolListener(e,t){m5(this,e,t),d5(this,e,(e=>{this.i._attachBoolListener(e)}))}attachBoolVectorListener(e,t){g5(this,e,t),d5(this,e,(e=>{this.i._attachBoolVectorListener(e)}))}attachIntListener(e,t){m5(this,e,t),d5(this,e,(e=>{this.i._attachIntListener(e)}))}attachIntVectorListener(e,t){g5(this,e,t),d5(this,e,(e=>{this.i._attachIntVectorListener(e)}))}attachUintListener(e,t){m5(this,e,t),d5(this,e,(e=>{this.i._attachUintListener(e)}))}attachUintVectorListener(e,t){g5(this,e,t),d5(this,e,(e=>{this.i._attachUintVectorListener(e)}))}attachDoubleListener(e,t){m5(this,e,t),d5(this,e,(e=>{this.i._attachDoubleListener(e)}))}attachDoubleVectorListener(e,t){g5(this,e,t),d5(this,e,(e=>{this.i._attachDoubleVectorListener(e)}))}attachFloatListener(e,t){m5(this,e,t),d5(this,e,(e=>{this.i._attachFloatListener(e)}))}attachFloatVectorListener(e,t){g5(this,e,t),d5(this,e,(e=>{this.i._attachFloatVectorListener(e)}))}attachStringListener(e,t){m5(this,e,t),d5(this,e,(e=>{this.i._attachStringListener(e)}))}attachStringVectorListener(e,t){g5(this,e,t),d5(this,e,(e=>{this.i._attachStringVectorListener(e)}))}attachProtoListener(e,t,n){m5(this,e,t),d5(this,e,(e=>{this.i._attachProtoListener(e,n||!1)}))}attachProtoVectorListener(e,t,n){g5(this,e,t),d5(this,e,(e=>{this.i._attachProtoVectorListener(e,n||!1)}))}attachAudioListener(e,t,n){this.i._attachAudioListener||console.warn('Attempting to use attachAudioListener without support for output audio. Is build dep ":gl_graph_runner_audio_out" missing?'),m5(this,e,((e,n)=>{e=new Float32Array(e.buffer,e.byteOffset,e.length/4),t(e,n)})),d5(this,e,(e=>{this.i._attachAudioListener(e,n||!1)}))}finishProcessing(){this.i._waitUntilIdle()}closeGraph(){this.i._closeGraph(),this.i.simpleListeners=void 0,this.i.emptyPacketListeners=void 0}},class extends m6{get ea(){return this.i}qa(e,t,n){d5(this,t,(t=>{const[i,r]=p5(this,e,t);this.ea._addBoundTextureAsImageToStream(t,i,r,n)}))}U(e,t){m5(this,e,t),d5(this,e,(e=>{this.ea._attachImageListener(e)}))}ca(e,t){g5(this,e,t),d5(this,e,(e=>{this.ea._attachImageVectorListener(e)}))}}));var m6,g6=class extends f6{};async function v6(e,t,n){var i;return async function(e,t,n,i){return async function(e,t,n,i){return e=await(async(e,t,n,i,r)=>{if(t&&await h5(t),!self.ModuleFactory)throw Error("ModuleFactory not set.");if(n&&(await h5(n),!self.ModuleFactory))throw Error("ModuleFactory not set.");return self.Module&&r&&((t=self.Module).locateFile=r.locateFile,r.mainScriptUrlOrBlob&&(t.mainScriptUrlOrBlob=r.mainScriptUrlOrBlob)),r=await self.ModuleFactory(self.Module||r),self.ModuleFactory=self.Module=void 0,new e(r,i)})(e,n.wasmLoaderPath,n.assetLoaderPath,t,{locateFile:e=>e.endsWith(".wasm")?n.wasmBinaryPath.toString():n.assetBinaryPath&&e.endsWith(".data")?n.assetBinaryPath.toString():e}),await e.o(i),e}(e,t,n,i)}(e,null!==(i=n.canvas)&&void 0!==i?i:c5()?void 0:document.createElement("canvas"),t,n)}function y6(e,t,n,i){if(e.T){var r,s;const c=new G3;if(null!==(r=n)&&void 0!==r&&r.regionOfInterest){if(!e.pa)throw Error("This task doesn't support region-of-interest.");var a=n.regionOfInterest;if(a.left>=a.right||a.top>=a.bottom)throw Error("Expected RectF with left < right and top < bottom.");if(a.left<0||a.top<0||a.right>1||a.bottom>1)throw Error("Expected RectF values to be in [0,1].");q0(c,1,(a.left+a.right)/2),q0(c,2,(a.top+a.bottom)/2),q0(c,4,a.right-a.left),q0(c,3,a.bottom-a.top)}else q0(c,1,.5),q0(c,2,.5),q0(c,4,1),q0(c,3,1);if(null!==(s=n)&&void 0!==s&&s.rotationDegrees){var o,l;if((null===(o=n)||void 0===o?void 0:o.rotationDegrees)%90!=0)throw Error("Expected rotation to be a multiple of 90\xb0.");if(q0(c,5,-Math.PI*n.rotationDegrees/180),(null===(l=n)||void 0===l?void 0:l.rotationDegrees)%180!=0){const[e,i]=u5(t);n=G0(c,3)*i/e,a=G0(c,4)*e/i,q0(c,4,n),q0(c,3,a)}}e.g.addProtoToStream(c.g(),"mediapipe.NormalizedRect",e.T,i)}e.g.qa(t,e.aa,null!==i&&void 0!==i?i:performance.now()),e.finishProcessing()}function b6(e,t,n){var i;if(null!==(i=e.baseOptions)&&void 0!==i&&i.g())throw Error("Task is not initialized with image mode. 'runningMode' must be set to 'IMAGE'.");y6(e,t,n,e.B+1)}function x6(e,t,n,i){var r;if(null===(r=e.baseOptions)||void 0===r||!r.g())throw Error("Task is not initialized with video mode. 'runningMode' must be set to 'VIDEO'.");y6(e,t,n,i)}function w6(e,t,n,i){var r=t.data;const s=t.width,a=s*(t=t.height);if((r instanceof Uint8Array||r instanceof Float32Array)&&r.length!==a)throw Error("Unsupported channel count: "+r.length/a);return e=new W5([r],n,!1,e.g.i.canvas,e.O,s,t),i?e.clone():e}var S6=class extends _5{constructor(e,t,n,i){super(e),this.g=e,this.aa=t,this.T=n,this.pa=i,this.O=new R5}l(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if("runningMode"in e&&H0(this.baseOptions,2,!!e.runningMode&&"IMAGE"!==e.runningMode),void 0!==e.canvas&&this.g.i.canvas!==e.canvas)throw Error("You must create a new task to reset the canvas.");return super.l(e,t)}close(){this.O.close(),super.close()}};S6.prototype.close=S6.prototype.close;var _6=class extends S6{constructor(e,t){super(new g6(e,t),"image_in","norm_rect_in",!1),this.j={detections:[]},B0(e=this.h=new o4,0,1,t=new r4),q0(this.h,2,.5),q0(this.h,3,.3)}get baseOptions(){return R0(this.h,r4,1)}set baseOptions(e){B0(this.h,0,1,e)}o(e){var t,n;return"minDetectionConfidence"in e&&q0(this.h,2,null!==(t=e.minDetectionConfidence)&&void 0!==t?t:.5),"minSuppressionThreshold"in e&&q0(this.h,3,null!==(n=e.minSuppressionThreshold)&&void 0!==n?n:.3),this.l(e)}D(e,t){return this.j={detections:[]},b6(this,e,t),this.j}F(e,t,n){return this.j={detections:[]},x6(this,e,n,t),this.j}m(){var e=new C3;E3(e,"image_in"),E3(e,"norm_rect_in"),A3(e,"detections");const t=new p3;x1(t,c4,this.h);const n=new b3;g3(n,"mediapipe.tasks.vision.face_detector.FaceDetectorGraph"),v3(n,"IMAGE:image_in"),v3(n,"NORM_RECT:norm_rect_in"),y3(n,"DETECTIONS:detections"),n.o(t),_3(e,n),this.g.attachProtoVectorListener("detections",((e,t)=>{for(const n of e)e=B3(n),this.j.detections.push($4(e));b5(this,t)})),this.g.attachEmptyPacketListener("detections",(e=>{b5(this,e)})),e=e.g(),this.setGraph(new Uint8Array(e),!0)}};_6.prototype.detectForVideo=_6.prototype.F,_6.prototype.detect=_6.prototype.D,_6.prototype.setOptions=_6.prototype.o,_6.createFromModelPath=async function(e,t){return v6(_6,e,{baseOptions:{modelAssetPath:t}})},_6.createFromModelBuffer=function(e,t){return v6(_6,e,{baseOptions:{modelAssetBuffer:t}})},_6.createFromOptions=function(e,t){return v6(_6,e,t)};var E6=p6([61,146],[146,91],[91,181],[181,84],[84,17],[17,314],[314,405],[405,321],[321,375],[375,291],[61,185],[185,40],[40,39],[39,37],[37,0],[0,267],[267,269],[269,270],[270,409],[409,291],[78,95],[95,88],[88,178],[178,87],[87,14],[14,317],[317,402],[402,318],[318,324],[324,308],[78,191],[191,80],[80,81],[81,82],[82,13],[13,312],[312,311],[311,310],[310,415],[415,308]),A6=p6([263,249],[249,390],[390,373],[373,374],[374,380],[380,381],[381,382],[382,362],[263,466],[466,388],[388,387],[387,386],[386,385],[385,384],[384,398],[398,362]),C6=p6([276,283],[283,282],[282,295],[295,285],[300,293],[293,334],[334,296],[296,336]),M6=p6([474,475],[475,476],[476,477],[477,474]),T6=p6([33,7],[7,163],[163,144],[144,145],[145,153],[153,154],[154,155],[155,133],[33,246],[246,161],[161,160],[160,159],[159,158],[158,157],[157,173],[173,133]),P6=p6([46,53],[53,52],[52,65],[65,55],[70,63],[63,105],[105,66],[66,107]),D6=p6([469,470],[470,471],[471,472],[472,469]),O6=p6([10,338],[338,297],[297,332],[332,284],[284,251],[251,389],[389,356],[356,454],[454,323],[323,361],[361,288],[288,397],[397,365],[365,379],[379,378],[378,400],[400,377],[377,152],[152,148],[148,176],[176,149],[149,150],[150,136],[136,172],[172,58],[58,132],[132,93],[93,234],[234,127],[127,162],[162,21],[21,54],[54,103],[103,67],[67,109],[109,10]),I6=[...E6,...A6,...C6,...T6,...P6,...O6],R6=p6([127,34],[34,139],[139,127],[11,0],[0,37],[37,11],[232,231],[231,120],[120,232],[72,37],[37,39],[39,72],[128,121],[121,47],[47,128],[232,121],[121,128],[128,232],[104,69],[69,67],[67,104],[175,171],[171,148],[148,175],[118,50],[50,101],[101,118],[73,39],[39,40],[40,73],[9,151],[151,108],[108,9],[48,115],[115,131],[131,48],[194,204],[204,211],[211,194],[74,40],[40,185],[185,74],[80,42],[42,183],[183,80],[40,92],[92,186],[186,40],[230,229],[229,118],[118,230],[202,212],[212,214],[214,202],[83,18],[18,17],[17,83],[76,61],[61,146],[146,76],[160,29],[29,30],[30,160],[56,157],[157,173],[173,56],[106,204],[204,194],[194,106],[135,214],[214,192],[192,135],[203,165],[165,98],[98,203],[21,71],[71,68],[68,21],[51,45],[45,4],[4,51],[144,24],[24,23],[23,144],[77,146],[146,91],[91,77],[205,50],[50,187],[187,205],[201,200],[200,18],[18,201],[91,106],[106,182],[182,91],[90,91],[91,181],[181,90],[85,84],[84,17],[17,85],[206,203],[203,36],[36,206],[148,171],[171,140],[140,148],[92,40],[40,39],[39,92],[193,189],[189,244],[244,193],[159,158],[158,28],[28,159],[247,246],[246,161],[161,247],[236,3],[3,196],[196,236],[54,68],[68,104],[104,54],[193,168],[168,8],[8,193],[117,228],[228,31],[31,117],[189,193],[193,55],[55,189],[98,97],[97,99],[99,98],[126,47],[47,100],[100,126],[166,79],[79,218],[218,166],[155,154],[154,26],[26,155],[209,49],[49,131],[131,209],[135,136],[136,150],[150,135],[47,126],[126,217],[217,47],[223,52],[52,53],[53,223],[45,51],[51,134],[134,45],[211,170],[170,140],[140,211],[67,69],[69,108],[108,67],[43,106],[106,91],[91,43],[230,119],[119,120],[120,230],[226,130],[130,247],[247,226],[63,53],[53,52],[52,63],[238,20],[20,242],[242,238],[46,70],[70,156],[156,46],[78,62],[62,96],[96,78],[46,53],[53,63],[63,46],[143,34],[34,227],[227,143],[123,117],[117,111],[111,123],[44,125],[125,19],[19,44],[236,134],[134,51],[51,236],[216,206],[206,205],[205,216],[154,153],[153,22],[22,154],[39,37],[37,167],[167,39],[200,201],[201,208],[208,200],[36,142],[142,100],[100,36],[57,212],[212,202],[202,57],[20,60],[60,99],[99,20],[28,158],[158,157],[157,28],[35,226],[226,113],[113,35],[160,159],[159,27],[27,160],[204,202],[202,210],[210,204],[113,225],[225,46],[46,113],[43,202],[202,204],[204,43],[62,76],[76,77],[77,62],[137,123],[123,116],[116,137],[41,38],[38,72],[72,41],[203,129],[129,142],[142,203],[64,98],[98,240],[240,64],[49,102],[102,64],[64,49],[41,73],[73,74],[74,41],[212,216],[216,207],[207,212],[42,74],[74,184],[184,42],[169,170],[170,211],[211,169],[170,149],[149,176],[176,170],[105,66],[66,69],[69,105],[122,6],[6,168],[168,122],[123,147],[147,187],[187,123],[96,77],[77,90],[90,96],[65,55],[55,107],[107,65],[89,90],[90,180],[180,89],[101,100],[100,120],[120,101],[63,105],[105,104],[104,63],[93,137],[137,227],[227,93],[15,86],[86,85],[85,15],[129,102],[102,49],[49,129],[14,87],[87,86],[86,14],[55,8],[8,9],[9,55],[100,47],[47,121],[121,100],[145,23],[23,22],[22,145],[88,89],[89,179],[179,88],[6,122],[122,196],[196,6],[88,95],[95,96],[96,88],[138,172],[172,136],[136,138],[215,58],[58,172],[172,215],[115,48],[48,219],[219,115],[42,80],[80,81],[81,42],[195,3],[3,51],[51,195],[43,146],[146,61],[61,43],[171,175],[175,199],[199,171],[81,82],[82,38],[38,81],[53,46],[46,225],[225,53],[144,163],[163,110],[110,144],[52,65],[65,66],[66,52],[229,228],[228,117],[117,229],[34,127],[127,234],[234,34],[107,108],[108,69],[69,107],[109,108],[108,151],[151,109],[48,64],[64,235],[235,48],[62,78],[78,191],[191,62],[129,209],[209,126],[126,129],[111,35],[35,143],[143,111],[117,123],[123,50],[50,117],[222,65],[65,52],[52,222],[19,125],[125,141],[141,19],[221,55],[55,65],[65,221],[3,195],[195,197],[197,3],[25,7],[7,33],[33,25],[220,237],[237,44],[44,220],[70,71],[71,139],[139,70],[122,193],[193,245],[245,122],[247,130],[130,33],[33,247],[71,21],[21,162],[162,71],[170,169],[169,150],[150,170],[188,174],[174,196],[196,188],[216,186],[186,92],[92,216],[2,97],[97,167],[167,2],[141,125],[125,241],[241,141],[164,167],[167,37],[37,164],[72,38],[38,12],[12,72],[38,82],[82,13],[13,38],[63,68],[68,71],[71,63],[226,35],[35,111],[111,226],[101,50],[50,205],[205,101],[206,92],[92,165],[165,206],[209,198],[198,217],[217,209],[165,167],[167,97],[97,165],[220,115],[115,218],[218,220],[133,112],[112,243],[243,133],[239,238],[238,241],[241,239],[214,135],[135,169],[169,214],[190,173],[173,133],[133,190],[171,208],[208,32],[32,171],[125,44],[44,237],[237,125],[86,87],[87,178],[178,86],[85,86],[86,179],[179,85],[84,85],[85,180],[180,84],[83,84],[84,181],[181,83],[201,83],[83,182],[182,201],[137,93],[93,132],[132,137],[76,62],[62,183],[183,76],[61,76],[76,184],[184,61],[57,61],[61,185],[185,57],[212,57],[57,186],[186,212],[214,207],[207,187],[187,214],[34,143],[143,156],[156,34],[79,239],[239,237],[237,79],[123,137],[137,177],[177,123],[44,1],[1,4],[4,44],[201,194],[194,32],[32,201],[64,102],[102,129],[129,64],[213,215],[215,138],[138,213],[59,166],[166,219],[219,59],[242,99],[99,97],[97,242],[2,94],[94,141],[141,2],[75,59],[59,235],[235,75],[24,110],[110,228],[228,24],[25,130],[130,226],[226,25],[23,24],[24,229],[229,23],[22,23],[23,230],[230,22],[26,22],[22,231],[231,26],[112,26],[26,232],[232,112],[189,190],[190,243],[243,189],[221,56],[56,190],[190,221],[28,56],[56,221],[221,28],[27,28],[28,222],[222,27],[29,27],[27,223],[223,29],[30,29],[29,224],[224,30],[247,30],[30,225],[225,247],[238,79],[79,20],[20,238],[166,59],[59,75],[75,166],[60,75],[75,240],[240,60],[147,177],[177,215],[215,147],[20,79],[79,166],[166,20],[187,147],[147,213],[213,187],[112,233],[233,244],[244,112],[233,128],[128,245],[245,233],[128,114],[114,188],[188,128],[114,217],[217,174],[174,114],[131,115],[115,220],[220,131],[217,198],[198,236],[236,217],[198,131],[131,134],[134,198],[177,132],[132,58],[58,177],[143,35],[35,124],[124,143],[110,163],[163,7],[7,110],[228,110],[110,25],[25,228],[356,389],[389,368],[368,356],[11,302],[302,267],[267,11],[452,350],[350,349],[349,452],[302,303],[303,269],[269,302],[357,343],[343,277],[277,357],[452,453],[453,357],[357,452],[333,332],[332,297],[297,333],[175,152],[152,377],[377,175],[347,348],[348,330],[330,347],[303,304],[304,270],[270,303],[9,336],[336,337],[337,9],[278,279],[279,360],[360,278],[418,262],[262,431],[431,418],[304,408],[408,409],[409,304],[310,415],[415,407],[407,310],[270,409],[409,410],[410,270],[450,348],[348,347],[347,450],[422,430],[430,434],[434,422],[313,314],[314,17],[17,313],[306,307],[307,375],[375,306],[387,388],[388,260],[260,387],[286,414],[414,398],[398,286],[335,406],[406,418],[418,335],[364,367],[367,416],[416,364],[423,358],[358,327],[327,423],[251,284],[284,298],[298,251],[281,5],[5,4],[4,281],[373,374],[374,253],[253,373],[307,320],[320,321],[321,307],[425,427],[427,411],[411,425],[421,313],[313,18],[18,421],[321,405],[405,406],[406,321],[320,404],[404,405],[405,320],[315,16],[16,17],[17,315],[426,425],[425,266],[266,426],[377,400],[400,369],[369,377],[322,391],[391,269],[269,322],[417,465],[465,464],[464,417],[386,257],[257,258],[258,386],[466,260],[260,388],[388,466],[456,399],[399,419],[419,456],[284,332],[332,333],[333,284],[417,285],[285,8],[8,417],[346,340],[340,261],[261,346],[413,441],[441,285],[285,413],[327,460],[460,328],[328,327],[355,371],[371,329],[329,355],[392,439],[439,438],[438,392],[382,341],[341,256],[256,382],[429,420],[420,360],[360,429],[364,394],[394,379],[379,364],[277,343],[343,437],[437,277],[443,444],[444,283],[283,443],[275,440],[440,363],[363,275],[431,262],[262,369],[369,431],[297,338],[338,337],[337,297],[273,375],[375,321],[321,273],[450,451],[451,349],[349,450],[446,342],[342,467],[467,446],[293,334],[334,282],[282,293],[458,461],[461,462],[462,458],[276,353],[353,383],[383,276],[308,324],[324,325],[325,308],[276,300],[300,293],[293,276],[372,345],[345,447],[447,372],[352,345],[345,340],[340,352],[274,1],[1,19],[19,274],[456,248],[248,281],[281,456],[436,427],[427,425],[425,436],[381,256],[256,252],[252,381],[269,391],[391,393],[393,269],[200,199],[199,428],[428,200],[266,330],[330,329],[329,266],[287,273],[273,422],[422,287],[250,462],[462,328],[328,250],[258,286],[286,384],[384,258],[265,353],[353,342],[342,265],[387,259],[259,257],[257,387],[424,431],[431,430],[430,424],[342,353],[353,276],[276,342],[273,335],[335,424],[424,273],[292,325],[325,307],[307,292],[366,447],[447,345],[345,366],[271,303],[303,302],[302,271],[423,266],[266,371],[371,423],[294,455],[455,460],[460,294],[279,278],[278,294],[294,279],[271,272],[272,304],[304,271],[432,434],[434,427],[427,432],[272,407],[407,408],[408,272],[394,430],[430,431],[431,394],[395,369],[369,400],[400,395],[334,333],[333,299],[299,334],[351,417],[417,168],[168,351],[352,280],[280,411],[411,352],[325,319],[319,320],[320,325],[295,296],[296,336],[336,295],[319,403],[403,404],[404,319],[330,348],[348,349],[349,330],[293,298],[298,333],[333,293],[323,454],[454,447],[447,323],[15,16],[16,315],[315,15],[358,429],[429,279],[279,358],[14,15],[15,316],[316,14],[285,336],[336,9],[9,285],[329,349],[349,350],[350,329],[374,380],[380,252],[252,374],[318,402],[402,403],[403,318],[6,197],[197,419],[419,6],[318,319],[319,325],[325,318],[367,364],[364,365],[365,367],[435,367],[367,397],[397,435],[344,438],[438,439],[439,344],[272,271],[271,311],[311,272],[195,5],[5,281],[281,195],[273,287],[287,291],[291,273],[396,428],[428,199],[199,396],[311,271],[271,268],[268,311],[283,444],[444,445],[445,283],[373,254],[254,339],[339,373],[282,334],[334,296],[296,282],[449,347],[347,346],[346,449],[264,447],[447,454],[454,264],[336,296],[296,299],[299,336],[338,10],[10,151],[151,338],[278,439],[439,455],[455,278],[292,407],[407,415],[415,292],[358,371],[371,355],[355,358],[340,345],[345,372],[372,340],[346,347],[347,280],[280,346],[442,443],[443,282],[282,442],[19,94],[94,370],[370,19],[441,442],[442,295],[295,441],[248,419],[419,197],[197,248],[263,255],[255,359],[359,263],[440,275],[275,274],[274,440],[300,383],[383,368],[368,300],[351,412],[412,465],[465,351],[263,467],[467,466],[466,263],[301,368],[368,389],[389,301],[395,378],[378,379],[379,395],[412,351],[351,419],[419,412],[436,426],[426,322],[322,436],[2,164],[164,393],[393,2],[370,462],[462,461],[461,370],[164,0],[0,267],[267,164],[302,11],[11,12],[12,302],[268,12],[12,13],[13,268],[293,300],[300,301],[301,293],[446,261],[261,340],[340,446],[330,266],[266,425],[425,330],[426,423],[423,391],[391,426],[429,355],[355,437],[437,429],[391,327],[327,326],[326,391],[440,457],[457,438],[438,440],[341,382],[382,362],[362,341],[459,457],[457,461],[461,459],[434,430],[430,394],[394,434],[414,463],[463,362],[362,414],[396,369],[369,262],[262,396],[354,461],[461,457],[457,354],[316,403],[403,402],[402,316],[315,404],[404,403],[403,315],[314,405],[405,404],[404,314],[313,406],[406,405],[405,313],[421,418],[418,406],[406,421],[366,401],[401,361],[361,366],[306,408],[408,407],[407,306],[291,409],[409,408],[408,291],[287,410],[410,409],[409,287],[432,436],[436,410],[410,432],[434,416],[416,411],[411,434],[264,368],[368,383],[383,264],[309,438],[438,457],[457,309],[352,376],[376,401],[401,352],[274,275],[275,4],[4,274],[421,428],[428,262],[262,421],[294,327],[327,358],[358,294],[433,416],[416,367],[367,433],[289,455],[455,439],[439,289],[462,370],[370,326],[326,462],[2,326],[326,370],[370,2],[305,460],[460,455],[455,305],[254,449],[449,448],[448,254],[255,261],[261,446],[446,255],[253,450],[450,449],[449,253],[252,451],[451,450],[450,252],[256,452],[452,451],[451,256],[341,453],[453,452],[452,341],[413,464],[464,463],[463,413],[441,413],[413,414],[414,441],[258,442],[442,441],[441,258],[257,443],[443,442],[442,257],[259,444],[444,443],[443,259],[260,445],[445,444],[444,260],[467,342],[342,445],[445,467],[459,458],[458,250],[250,459],[289,392],[392,290],[290,289],[290,328],[328,460],[460,290],[376,433],[433,435],[435,376],[250,290],[290,392],[392,250],[411,416],[416,433],[433,411],[341,463],[463,464],[464,341],[453,464],[464,465],[465,453],[357,465],[465,412],[412,357],[343,412],[412,399],[399,343],[360,363],[363,440],[440,360],[437,399],[399,456],[456,437],[420,456],[456,363],[363,420],[401,435],[435,288],[288,401],[372,383],[383,353],[353,372],[339,255],[255,249],[249,339],[448,261],[261,255],[255,448],[133,243],[243,190],[190,133],[133,155],[155,112],[112,133],[33,246],[246,247],[247,33],[33,130],[130,25],[25,33],[398,384],[384,286],[286,398],[362,398],[398,414],[414,362],[362,463],[463,341],[341,362],[263,359],[359,467],[467,263],[263,249],[249,255],[255,263],[466,467],[467,260],[260,466],[75,60],[60,166],[166,75],[238,239],[239,79],[79,238],[162,127],[127,139],[139,162],[72,11],[11,37],[37,72],[121,232],[232,120],[120,121],[73,72],[72,39],[39,73],[114,128],[128,47],[47,114],[233,232],[232,128],[128,233],[103,104],[104,67],[67,103],[152,175],[175,148],[148,152],[119,118],[118,101],[101,119],[74,73],[73,40],[40,74],[107,9],[9,108],[108,107],[49,48],[48,131],[131,49],[32,194],[194,211],[211,32],[184,74],[74,185],[185,184],[191,80],[80,183],[183,191],[185,40],[40,186],[186,185],[119,230],[230,118],[118,119],[210,202],[202,214],[214,210],[84,83],[83,17],[17,84],[77,76],[76,146],[146,77],[161,160],[160,30],[30,161],[190,56],[56,173],[173,190],[182,106],[106,194],[194,182],[138,135],[135,192],[192,138],[129,203],[203,98],[98,129],[54,21],[21,68],[68,54],[5,51],[51,4],[4,5],[145,144],[144,23],[23,145],[90,77],[77,91],[91,90],[207,205],[205,187],[187,207],[83,201],[201,18],[18,83],[181,91],[91,182],[182,181],[180,90],[90,181],[181,180],[16,85],[85,17],[17,16],[205,206],[206,36],[36,205],[176,148],[148,140],[140,176],[165,92],[92,39],[39,165],[245,193],[193,244],[244,245],[27,159],[159,28],[28,27],[30,247],[247,161],[161,30],[174,236],[236,196],[196,174],[103,54],[54,104],[104,103],[55,193],[193,8],[8,55],[111,117],[117,31],[31,111],[221,189],[189,55],[55,221],[240,98],[98,99],[99,240],[142,126],[126,100],[100,142],[219,166],[166,218],[218,219],[112,155],[155,26],[26,112],[198,209],[209,131],[131,198],[169,135],[135,150],[150,169],[114,47],[47,217],[217,114],[224,223],[223,53],[53,224],[220,45],[45,134],[134,220],[32,211],[211,140],[140,32],[109,67],[67,108],[108,109],[146,43],[43,91],[91,146],[231,230],[230,120],[120,231],[113,226],[226,247],[247,113],[105,63],[63,52],[52,105],[241,238],[238,242],[242,241],[124,46],[46,156],[156,124],[95,78],[78,96],[96,95],[70,46],[46,63],[63,70],[116,143],[143,227],[227,116],[116,123],[123,111],[111,116],[1,44],[44,19],[19,1],[3,236],[236,51],[51,3],[207,216],[216,205],[205,207],[26,154],[154,22],[22,26],[165,39],[39,167],[167,165],[199,200],[200,208],[208,199],[101,36],[36,100],[100,101],[43,57],[57,202],[202,43],[242,20],[20,99],[99,242],[56,28],[28,157],[157,56],[124,35],[35,113],[113,124],[29,160],[160,27],[27,29],[211,204],[204,210],[210,211],[124,113],[113,46],[46,124],[106,43],[43,204],[204,106],[96,62],[62,77],[77,96],[227,137],[137,116],[116,227],[73,41],[41,72],[72,73],[36,203],[203,142],[142,36],[235,64],[64,240],[240,235],[48,49],[49,64],[64,48],[42,41],[41,74],[74,42],[214,212],[212,207],[207,214],[183,42],[42,184],[184,183],[210,169],[169,211],[211,210],[140,170],[170,176],[176,140],[104,105],[105,69],[69,104],[193,122],[122,168],[168,193],[50,123],[123,187],[187,50],[89,96],[96,90],[90,89],[66,65],[65,107],[107,66],[179,89],[89,180],[180,179],[119,101],[101,120],[120,119],[68,63],[63,104],[104,68],[234,93],[93,227],[227,234],[16,15],[15,85],[85,16],[209,129],[129,49],[49,209],[15,14],[14,86],[86,15],[107,55],[55,9],[9,107],[120,100],[100,121],[121,120],[153,145],[145,22],[22,153],[178,88],[88,179],[179,178],[197,6],[6,196],[196,197],[89,88],[88,96],[96,89],[135,138],[138,136],[136,135],[138,215],[215,172],[172,138],[218,115],[115,219],[219,218],[41,42],[42,81],[81,41],[5,195],[195,51],[51,5],[57,43],[43,61],[61,57],[208,171],[171,199],[199,208],[41,81],[81,38],[38,41],[224,53],[53,225],[225,224],[24,144],[144,110],[110,24],[105,52],[52,66],[66,105],[118,229],[229,117],[117,118],[227,34],[34,234],[234,227],[66,107],[107,69],[69,66],[10,109],[109,151],[151,10],[219,48],[48,235],[235,219],[183,62],[62,191],[191,183],[142,129],[129,126],[126,142],[116,111],[111,143],[143,116],[118,117],[117,50],[50,118],[223,222],[222,52],[52,223],[94,19],[19,141],[141,94],[222,221],[221,65],[65,222],[196,3],[3,197],[197,196],[45,220],[220,44],[44,45],[156,70],[70,139],[139,156],[188,122],[122,245],[245,188],[139,71],[71,162],[162,139],[149,170],[170,150],[150,149],[122,188],[188,196],[196,122],[206,216],[216,92],[92,206],[164,2],[2,167],[167,164],[242,141],[141,241],[241,242],[0,164],[164,37],[37,0],[11,72],[72,12],[12,11],[12,38],[38,13],[13,12],[70,63],[63,71],[71,70],[31,226],[226,111],[111,31],[36,101],[101,205],[205,36],[203,206],[206,165],[165,203],[126,209],[209,217],[217,126],[98,165],[165,97],[97,98],[237,220],[220,218],[218,237],[237,239],[239,241],[241,237],[210,214],[214,169],[169,210],[140,171],[171,32],[32,140],[241,125],[125,237],[237,241],[179,86],[86,178],[178,179],[180,85],[85,179],[179,180],[181,84],[84,180],[180,181],[182,83],[83,181],[181,182],[194,201],[201,182],[182,194],[177,137],[137,132],[132,177],[184,76],[76,183],[183,184],[185,61],[61,184],[184,185],[186,57],[57,185],[185,186],[216,212],[212,186],[186,216],[192,214],[214,187],[187,192],[139,34],[34,156],[156,139],[218,79],[79,237],[237,218],[147,123],[123,177],[177,147],[45,44],[44,4],[4,45],[208,201],[201,32],[32,208],[98,64],[64,129],[129,98],[192,213],[213,138],[138,192],[235,59],[59,219],[219,235],[141,242],[242,97],[97,141],[97,2],[2,141],[141,97],[240,75],[75,235],[235,240],[229,24],[24,228],[228,229],[31,25],[25,226],[226,31],[230,23],[23,229],[229,230],[231,22],[22,230],[230,231],[232,26],[26,231],[231,232],[233,112],[112,232],[232,233],[244,189],[189,243],[243,244],[189,221],[221,190],[190,189],[222,28],[28,221],[221,222],[223,27],[27,222],[222,223],[224,29],[29,223],[223,224],[225,30],[30,224],[224,225],[113,247],[247,225],[225,113],[99,60],[60,240],[240,99],[213,147],[147,215],[215,213],[60,20],[20,166],[166,60],[192,187],[187,213],[213,192],[243,112],[112,244],[244,243],[244,233],[233,245],[245,244],[245,128],[128,188],[188,245],[188,114],[114,174],[174,188],[134,131],[131,220],[220,134],[174,217],[217,236],[236,174],[236,198],[198,134],[134,236],[215,177],[177,58],[58,215],[156,143],[143,124],[124,156],[25,110],[110,7],[7,25],[31,228],[228,25],[25,31],[264,356],[356,368],[368,264],[0,11],[11,267],[267,0],[451,452],[452,349],[349,451],[267,302],[302,269],[269,267],[350,357],[357,277],[277,350],[350,452],[452,357],[357,350],[299,333],[333,297],[297,299],[396,175],[175,377],[377,396],[280,347],[347,330],[330,280],[269,303],[303,270],[270,269],[151,9],[9,337],[337,151],[344,278],[278,360],[360,344],[424,418],[418,431],[431,424],[270,304],[304,409],[409,270],[272,310],[310,407],[407,272],[322,270],[270,410],[410,322],[449,450],[450,347],[347,449],[432,422],[422,434],[434,432],[18,313],[313,17],[17,18],[291,306],[306,375],[375,291],[259,387],[387,260],[260,259],[424,335],[335,418],[418,424],[434,364],[364,416],[416,434],[391,423],[423,327],[327,391],[301,251],[251,298],[298,301],[275,281],[281,4],[4,275],[254,373],[373,253],[253,254],[375,307],[307,321],[321,375],[280,425],[425,411],[411,280],[200,421],[421,18],[18,200],[335,321],[321,406],[406,335],[321,320],[320,405],[405,321],[314,315],[315,17],[17,314],[423,426],[426,266],[266,423],[396,377],[377,369],[369,396],[270,322],[322,269],[269,270],[413,417],[417,464],[464,413],[385,386],[386,258],[258,385],[248,456],[456,419],[419,248],[298,284],[284,333],[333,298],[168,417],[417,8],[8,168],[448,346],[346,261],[261,448],[417,413],[413,285],[285,417],[326,327],[327,328],[328,326],[277,355],[355,329],[329,277],[309,392],[392,438],[438,309],[381,382],[382,256],[256,381],[279,429],[429,360],[360,279],[365,364],[364,379],[379,365],[355,277],[277,437],[437,355],[282,443],[443,283],[283,282],[281,275],[275,363],[363,281],[395,431],[431,369],[369,395],[299,297],[297,337],[337,299],[335,273],[273,321],[321,335],[348,450],[450,349],[349,348],[359,446],[446,467],[467,359],[283,293],[293,282],[282,283],[250,458],[458,462],[462,250],[300,276],[276,383],[383,300],[292,308],[308,325],[325,292],[283,276],[276,293],[293,283],[264,372],[372,447],[447,264],[346,352],[352,340],[340,346],[354,274],[274,19],[19,354],[363,456],[456,281],[281,363],[426,436],[436,425],[425,426],[380,381],[381,252],[252,380],[267,269],[269,393],[393,267],[421,200],[200,428],[428,421],[371,266],[266,329],[329,371],[432,287],[287,422],[422,432],[290,250],[250,328],[328,290],[385,258],[258,384],[384,385],[446,265],[265,342],[342,446],[386,387],[387,257],[257,386],[422,424],[424,430],[430,422],[445,342],[342,276],[276,445],[422,273],[273,424],[424,422],[306,292],[292,307],[307,306],[352,366],[366,345],[345,352],[268,271],[271,302],[302,268],[358,423],[423,371],[371,358],[327,294],[294,460],[460,327],[331,279],[279,294],[294,331],[303,271],[271,304],[304,303],[436,432],[432,427],[427,436],[304,272],[272,408],[408,304],[395,394],[394,431],[431,395],[378,395],[395,400],[400,378],[296,334],[334,299],[299,296],[6,351],[351,168],[168,6],[376,352],[352,411],[411,376],[307,325],[325,320],[320,307],[285,295],[295,336],[336,285],[320,319],[319,404],[404,320],[329,330],[330,349],[349,329],[334,293],[293,333],[333,334],[366,323],[323,447],[447,366],[316,15],[15,315],[315,316],[331,358],[358,279],[279,331],[317,14],[14,316],[316,317],[8,285],[285,9],[9,8],[277,329],[329,350],[350,277],[253,374],[374,252],[252,253],[319,318],[318,403],[403,319],[351,6],[6,419],[419,351],[324,318],[318,325],[325,324],[397,367],[367,365],[365,397],[288,435],[435,397],[397,288],[278,344],[344,439],[439,278],[310,272],[272,311],[311,310],[248,195],[195,281],[281,248],[375,273],[273,291],[291,375],[175,396],[396,199],[199,175],[312,311],[311,268],[268,312],[276,283],[283,445],[445,276],[390,373],[373,339],[339,390],[295,282],[282,296],[296,295],[448,449],[449,346],[346,448],[356,264],[264,454],[454,356],[337,336],[336,299],[299,337],[337,338],[338,151],[151,337],[294,278],[278,455],[455,294],[308,292],[292,415],[415,308],[429,358],[358,355],[355,429],[265,340],[340,372],[372,265],[352,346],[346,280],[280,352],[295,442],[442,282],[282,295],[354,19],[19,370],[370,354],[285,441],[441,295],[295,285],[195,248],[248,197],[197,195],[457,440],[440,274],[274,457],[301,300],[300,368],[368,301],[417,351],[351,465],[465,417],[251,301],[301,389],[389,251],[394,395],[395,379],[379,394],[399,412],[412,419],[419,399],[410,436],[436,322],[322,410],[326,2],[2,393],[393,326],[354,370],[370,461],[461,354],[393,164],[164,267],[267,393],[268,302],[302,12],[12,268],[312,268],[268,13],[13,312],[298,293],[293,301],[301,298],[265,446],[446,340],[340,265],[280,330],[330,425],[425,280],[322,426],[426,391],[391,322],[420,429],[429,437],[437,420],[393,391],[391,326],[326,393],[344,440],[440,438],[438,344],[458,459],[459,461],[461,458],[364,434],[434,394],[394,364],[428,396],[396,262],[262,428],[274,354],[354,457],[457,274],[317,316],[316,402],[402,317],[316,315],[315,403],[403,316],[315,314],[314,404],[404,315],[314,313],[313,405],[405,314],[313,421],[421,406],[406,313],[323,366],[366,361],[361,323],[292,306],[306,407],[407,292],[306,291],[291,408],[408,306],[291,287],[287,409],[409,291],[287,432],[432,410],[410,287],[427,434],[434,411],[411,427],[372,264],[264,383],[383,372],[459,309],[309,457],[457,459],[366,352],[352,401],[401,366],[1,274],[274,4],[4,1],[418,421],[421,262],[262,418],[331,294],[294,358],[358,331],[435,433],[433,367],[367,435],[392,289],[289,439],[439,392],[328,462],[462,326],[326,328],[94,2],[2,370],[370,94],[289,305],[305,455],[455,289],[339,254],[254,448],[448,339],[359,255],[255,446],[446,359],[254,253],[253,449],[449,254],[253,252],[252,450],[450,253],[252,256],[256,451],[451,252],[256,341],[341,452],[452,256],[414,413],[413,463],[463,414],[286,441],[441,414],[414,286],[286,258],[258,441],[441,286],[258,257],[257,442],[442,258],[257,259],[259,443],[443,257],[259,260],[260,444],[444,259],[260,467],[467,445],[445,260],[309,459],[459,250],[250,309],[305,289],[289,290],[290,305],[305,290],[290,460],[460,305],[401,376],[376,435],[435,401],[309,250],[250,392],[392,309],[376,411],[411,433],[433,376],[453,341],[341,464],[464,453],[357,453],[453,465],[465,357],[343,357],[357,412],[412,343],[437,343],[343,399],[399,437],[344,360],[360,440],[440,344],[420,437],[437,456],[456,420],[360,420],[420,363],[363,360],[361,401],[401,288],[288,361],[265,372],[372,353],[353,265],[390,339],[339,249],[249,390],[339,448],[448,255],[255,339]);function k6(e){e.j={faceLandmarks:[],faceBlendshapes:[],facialTransformationMatrixes:[]}}var L6=class extends S6{constructor(e,t){super(new g6(e,t),"image_in","norm_rect",!1),this.j={faceLandmarks:[],faceBlendshapes:[],facialTransformationMatrixes:[]},this.outputFacialTransformationMatrixes=this.outputFaceBlendshapes=!1,B0(e=this.h=new d4,0,1,t=new r4),this.v=new u4,B0(this.h,0,3,this.v),this.s=new o4,B0(this.h,0,2,this.s),W0(this.s,4,1),q0(this.s,2,.5),q0(this.v,2,.5),q0(this.h,4,.5)}get baseOptions(){return R0(this.h,r4,1)}set baseOptions(e){B0(this.h,0,1,e)}o(e){var t,n,i,r;return"numFaces"in e&&W0(this.s,4,null!==(t=e.numFaces)&&void 0!==t?t:1),"minFaceDetectionConfidence"in e&&q0(this.s,2,null!==(n=e.minFaceDetectionConfidence)&&void 0!==n?n:.5),"minTrackingConfidence"in e&&q0(this.h,4,null!==(i=e.minTrackingConfidence)&&void 0!==i?i:.5),"minFacePresenceConfidence"in e&&q0(this.v,2,null!==(r=e.minFacePresenceConfidence)&&void 0!==r?r:.5),"outputFaceBlendshapes"in e&&(this.outputFaceBlendshapes=!!e.outputFaceBlendshapes),"outputFacialTransformationMatrixes"in e&&(this.outputFacialTransformationMatrixes=!!e.outputFacialTransformationMatrixes),this.l(e)}D(e,t){return k6(this),b6(this,e,t),this.j}F(e,t,n){return k6(this),x6(this,e,n,t),this.j}m(){var e=new C3;E3(e,"image_in"),E3(e,"norm_rect"),A3(e,"face_landmarks");const t=new p3;x1(t,m4,this.h);const n=new b3;g3(n,"mediapipe.tasks.vision.face_landmarker.FaceLandmarkerGraph"),v3(n,"IMAGE:image_in"),v3(n,"NORM_RECT:norm_rect"),y3(n,"NORM_LANDMARKS:face_landmarks"),n.o(t),_3(e,n),this.g.attachProtoVectorListener("face_landmarks",((e,t)=>{for(const n of e)e=U3(n),this.j.faceLandmarks.push(e5(e));b5(this,t)})),this.g.attachEmptyPacketListener("face_landmarks",(e=>{b5(this,e)})),this.outputFaceBlendshapes&&(A3(e,"blendshapes"),y3(n,"BLENDSHAPES:blendshapes"),this.g.attachProtoVectorListener("blendshapes",((e,t)=>{if(this.outputFaceBlendshapes)for(const i of e){var n;e=I3(i),this.j.faceBlendshapes.push(J4(null!==(n=e.g())&&void 0!==n?n:[]))}b5(this,t)})),this.g.attachEmptyPacketListener("blendshapes",(e=>{b5(this,e)}))),this.outputFacialTransformationMatrixes&&(A3(e,"face_geometry"),y3(n,"FACE_GEOMETRY:face_geometry"),this.g.attachProtoVectorListener("face_geometry",((e,t)=>{if(this.outputFacialTransformationMatrixes)for(const o of e){var n,i,r,s,a;(e=R0(h4(o),j3,2))&&this.j.facialTransformationMatrixes.push({rows:null!==(n=null!==(i=j0(e,1))&&void 0!==i?i:0)&&void 0!==n?n:0,columns:null!==(r=null!==(s=j0(e,2))&&void 0!==s?s:0)&&void 0!==r?r:0,data:null!==(a=x0(e,3,T$,b0()).slice())&&void 0!==a?a:[]})}b5(this,t)})),this.g.attachEmptyPacketListener("face_geometry",(e=>{b5(this,e)}))),e=e.g(),this.setGraph(new Uint8Array(e),!0)}};L6.prototype.detectForVideo=L6.prototype.F,L6.prototype.detect=L6.prototype.D,L6.prototype.setOptions=L6.prototype.o,L6.createFromModelPath=function(e,t){return v6(L6,e,{baseOptions:{modelAssetPath:t}})},L6.createFromModelBuffer=function(e,t){return v6(L6,e,{baseOptions:{modelAssetBuffer:t}})},L6.createFromOptions=function(e,t){return v6(L6,e,t)},L6.FACE_LANDMARKS_LIPS=E6,L6.FACE_LANDMARKS_LEFT_EYE=A6,L6.FACE_LANDMARKS_LEFT_EYEBROW=C6,L6.FACE_LANDMARKS_LEFT_IRIS=M6,L6.FACE_LANDMARKS_RIGHT_EYE=T6,L6.FACE_LANDMARKS_RIGHT_EYEBROW=P6,L6.FACE_LANDMARKS_RIGHT_IRIS=D6,L6.FACE_LANDMARKS_FACE_OVAL=O6,L6.FACE_LANDMARKS_CONTOURS=I6,L6.FACE_LANDMARKS_TESSELATION=R6;var B6=class extends S6{constructor(e,t){super(new g6(e,t),"image_in","norm_rect",!0),B0(e=this.j=new g4,0,1,t=new r4)}get baseOptions(){return R0(this.j,r4,1)}set baseOptions(e){B0(this.j,0,1,e)}o(e){return super.l(e)}Oa(e,t,n){const i="function"!=typeof t?t:{};if(this.h="function"==typeof t?t:n,b6(this,e,null!==i&&void 0!==i?i:{}),!this.h)return this.s}m(){var e=new C3;E3(e,"image_in"),E3(e,"norm_rect"),A3(e,"stylized_image");const t=new p3;x1(t,v4,this.j);const n=new b3;g3(n,"mediapipe.tasks.vision.face_stylizer.FaceStylizerGraph"),v3(n,"IMAGE:image_in"),v3(n,"NORM_RECT:norm_rect"),y3(n,"STYLIZED_IMAGE:stylized_image"),n.o(t),_3(e,n),this.g.U("stylized_image",((e,t)=>{var n=!this.h,i=e.data,r=e.width;const s=r*(e=e.height);if(i instanceof Uint8Array)if(i.length===3*s){const t=new Uint8ClampedArray(4*s);for(let e=0;e<s;++e)t[4*e]=i[3*e],t[4*e+1]=i[3*e+1],t[4*e+2]=i[3*e+2],t[4*e+3]=255;i=new ImageData(t,r,e)}else{if(i.length!==4*s)throw Error("Unsupported channel count: "+i.length/s);i=new ImageData(new Uint8ClampedArray(i.buffer,i.byteOffset,i.length),r,e)}else if(!(i instanceof WebGLTexture))throw Error("Unsupported format: ".concat(i.constructor.name));r=new u6([i],!1,!1,this.g.i.canvas,this.O,r,e),this.s=n=n?r.clone():r,this.h&&this.h(n),b5(this,t)})),this.g.attachEmptyPacketListener("stylized_image",(e=>{this.s=null,this.h&&this.h(null),b5(this,e)})),e=e.g(),this.setGraph(new Uint8Array(e),!0)}};B6.prototype.stylize=B6.prototype.Oa,B6.prototype.setOptions=B6.prototype.o,B6.createFromModelPath=function(e,t){return v6(B6,e,{baseOptions:{modelAssetPath:t}})},B6.createFromModelBuffer=function(e,t){return v6(B6,e,{baseOptions:{modelAssetBuffer:t}})},B6.createFromOptions=function(e,t){return v6(B6,e,t)};var z6=p6([0,1],[1,2],[2,3],[3,4],[0,5],[5,6],[6,7],[7,8],[5,9],[9,10],[10,11],[11,12],[9,13],[13,14],[14,15],[15,16],[13,17],[0,17],[17,18],[18,19],[19,20]);function N6(e){e.gestures=[],e.landmarks=[],e.worldLandmarks=[],e.handedness=[]}function F6(e){return 0===e.gestures.length?{gestures:[],landmarks:[],worldLandmarks:[],handedness:[],handednesses:[]}:{gestures:e.gestures,landmarks:e.landmarks,worldLandmarks:e.worldLandmarks,handedness:e.handedness,handednesses:e.handedness}}function U6(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const n=[];for(const h of e){var i=I3(h);e=[];for(const n of i.g()){var r,s,a,o,l,c;i=t&&null!=j0(n,1)?null!==(r=j0(n,1))&&void 0!==r?r:0:-1,e.push({score:null!==(s=G0(n,2))&&void 0!==s?s:0,index:i,categoryName:null!==(a=null!==(o=V0(n,3))&&void 0!==o?o:"")&&void 0!==a?a:"",displayName:null!==(l=null!==(c=V0(n,4))&&void 0!==c?c:"")&&void 0!==l?l:""})}n.push(e)}return n}var j6=class extends S6{constructor(e,t){super(new g6(e,t),"image_in","norm_rect",!1),this.gestures=[],this.landmarks=[],this.worldLandmarks=[],this.handedness=[],B0(e=this.j=new E4,0,1,t=new r4),this.s=new _4,B0(this.j,0,2,this.s),this.C=new S4,B0(this.s,0,3,this.C),this.v=new w4,B0(this.s,0,2,this.v),this.h=new x4,B0(this.j,0,3,this.h),q0(this.v,2,.5),q0(this.s,4,.5),q0(this.C,2,.5)}get baseOptions(){return R0(this.j,r4,1)}set baseOptions(e){B0(this.j,0,1,e)}o(e){var t,n,i,r,s,a,o;if(W0(this.v,3,null!==(t=e.numHands)&&void 0!==t?t:1),"minHandDetectionConfidence"in e&&q0(this.v,2,null!==(n=e.minHandDetectionConfidence)&&void 0!==n?n:.5),"minTrackingConfidence"in e&&q0(this.s,4,null!==(i=e.minTrackingConfidence)&&void 0!==i?i:.5),"minHandPresenceConfidence"in e&&q0(this.C,2,null!==(r=e.minHandPresenceConfidence)&&void 0!==r?r:.5),e.cannedGesturesClassifierOptions){var l,c=new y4,h=c,u=Z4(e.cannedGesturesClassifierOptions,null===(l=R0(this.h,y4,3))||void 0===l?void 0:l.h());B0(h,0,2,u),B0(this.h,0,3,c)}else void 0===e.cannedGesturesClassifierOptions&&(null===(s=R0(this.h,y4,3))||void 0===s||s.g());return e.customGesturesClassifierOptions?(B0(h=c=new y4,0,2,u=Z4(e.customGesturesClassifierOptions,null===(a=R0(this.h,y4,4))||void 0===a?void 0:a.h())),B0(this.h,0,4,c)):void 0===e.customGesturesClassifierOptions&&(null===(o=R0(this.h,y4,4))||void 0===o||o.g()),this.l(e)}Ja(e,t){return N6(this),b6(this,e,t),F6(this)}Ka(e,t,n){return N6(this),x6(this,e,n,t),F6(this)}m(){var e=new C3;E3(e,"image_in"),E3(e,"norm_rect"),A3(e,"hand_gestures"),A3(e,"hand_landmarks"),A3(e,"world_hand_landmarks"),A3(e,"handedness");const t=new p3;x1(t,P4,this.j);const n=new b3;g3(n,"mediapipe.tasks.vision.gesture_recognizer.GestureRecognizerGraph"),v3(n,"IMAGE:image_in"),v3(n,"NORM_RECT:norm_rect"),y3(n,"HAND_GESTURES:hand_gestures"),y3(n,"LANDMARKS:hand_landmarks"),y3(n,"WORLD_LANDMARKS:world_hand_landmarks"),y3(n,"HANDEDNESS:handedness"),n.o(t),_3(e,n),this.g.attachProtoVectorListener("hand_landmarks",((e,t)=>{for(const a of e){e=U3(a);const t=[];for(const a of L0(e,F3,1)){var n,i,r,s;t.push({x:null!==(n=G0(a,1))&&void 0!==n?n:0,y:null!==(i=G0(a,2))&&void 0!==i?i:0,z:null!==(r=G0(a,3))&&void 0!==r?r:0,visibility:null!==(s=G0(a,4))&&void 0!==s?s:0})}this.landmarks.push(t)}b5(this,t)})),this.g.attachEmptyPacketListener("hand_landmarks",(e=>{b5(this,e)})),this.g.attachProtoVectorListener("world_hand_landmarks",((e,t)=>{for(const a of e){e=N3(a);const t=[];for(const a of L0(e,z3,1)){var n,i,r,s;t.push({x:null!==(n=G0(a,1))&&void 0!==n?n:0,y:null!==(i=G0(a,2))&&void 0!==i?i:0,z:null!==(r=G0(a,3))&&void 0!==r?r:0,visibility:null!==(s=G0(a,4))&&void 0!==s?s:0})}this.worldLandmarks.push(t)}b5(this,t)})),this.g.attachEmptyPacketListener("world_hand_landmarks",(e=>{b5(this,e)})),this.g.attachProtoVectorListener("hand_gestures",((e,t)=>{this.gestures.push(...U6(e,!1)),b5(this,t)})),this.g.attachEmptyPacketListener("hand_gestures",(e=>{b5(this,e)})),this.g.attachProtoVectorListener("handedness",((e,t)=>{this.handedness.push(...U6(e)),b5(this,t)})),this.g.attachEmptyPacketListener("handedness",(e=>{b5(this,e)})),e=e.g(),this.setGraph(new Uint8Array(e),!0)}};function V6(e){return{landmarks:e.landmarks,worldLandmarks:e.worldLandmarks,handednesses:e.handedness,handedness:e.handedness}}j6.prototype.recognizeForVideo=j6.prototype.Ka,j6.prototype.recognize=j6.prototype.Ja,j6.prototype.setOptions=j6.prototype.o,j6.createFromModelPath=function(e,t){return v6(j6,e,{baseOptions:{modelAssetPath:t}})},j6.createFromModelBuffer=function(e,t){return v6(j6,e,{baseOptions:{modelAssetBuffer:t}})},j6.createFromOptions=function(e,t){return v6(j6,e,t)},j6.HAND_CONNECTIONS=z6;var G6=class extends S6{constructor(e,t){super(new g6(e,t),"image_in","norm_rect",!1),this.landmarks=[],this.worldLandmarks=[],this.handedness=[],B0(e=this.h=new _4,0,1,t=new r4),this.s=new S4,B0(this.h,0,3,this.s),this.j=new w4,B0(this.h,0,2,this.j),W0(this.j,3,1),q0(this.j,2,.5),q0(this.s,2,.5),q0(this.h,4,.5)}get baseOptions(){return R0(this.h,r4,1)}set baseOptions(e){B0(this.h,0,1,e)}o(e){var t,n,i,r;return"numHands"in e&&W0(this.j,3,null!==(t=e.numHands)&&void 0!==t?t:1),"minHandDetectionConfidence"in e&&q0(this.j,2,null!==(n=e.minHandDetectionConfidence)&&void 0!==n?n:.5),"minTrackingConfidence"in e&&q0(this.h,4,null!==(i=e.minTrackingConfidence)&&void 0!==i?i:.5),"minHandPresenceConfidence"in e&&q0(this.s,2,null!==(r=e.minHandPresenceConfidence)&&void 0!==r?r:.5),this.l(e)}D(e,t){return this.landmarks=[],this.worldLandmarks=[],this.handedness=[],b6(this,e,t),V6(this)}F(e,t,n){return this.landmarks=[],this.worldLandmarks=[],this.handedness=[],x6(this,e,n,t),V6(this)}m(){var e=new C3;E3(e,"image_in"),E3(e,"norm_rect"),A3(e,"hand_landmarks"),A3(e,"world_hand_landmarks"),A3(e,"handedness");const t=new p3;x1(t,D4,this.h);const n=new b3;g3(n,"mediapipe.tasks.vision.hand_landmarker.HandLandmarkerGraph"),v3(n,"IMAGE:image_in"),v3(n,"NORM_RECT:norm_rect"),y3(n,"LANDMARKS:hand_landmarks"),y3(n,"WORLD_LANDMARKS:world_hand_landmarks"),y3(n,"HANDEDNESS:handedness"),n.o(t),_3(e,n),this.g.attachProtoVectorListener("hand_landmarks",((e,t)=>{for(const n of e)e=U3(n),this.landmarks.push(e5(e));b5(this,t)})),this.g.attachEmptyPacketListener("hand_landmarks",(e=>{b5(this,e)})),this.g.attachProtoVectorListener("world_hand_landmarks",((e,t)=>{for(const n of e)e=N3(n),this.worldLandmarks.push(t5(e));b5(this,t)})),this.g.attachEmptyPacketListener("world_hand_landmarks",(e=>{b5(this,e)})),this.g.attachProtoVectorListener("handedness",((e,t)=>{var n=this.handedness,i=n.push;const r=[];for(const d of e){e=I3(d);const t=[];for(const n of e.g()){var s,a,o,l,c,h,u;t.push({score:null!==(s=G0(n,2))&&void 0!==s?s:0,index:null!==(a=null!==(o=j0(n,1))&&void 0!==o?o:0)&&void 0!==a?a:-1,categoryName:null!==(l=null!==(c=V0(n,3))&&void 0!==c?c:"")&&void 0!==l?l:"",displayName:null!==(h=null!==(u=V0(n,4))&&void 0!==u?u:"")&&void 0!==h?h:""})}r.push(t)}i.call(n,...r),b5(this,t)})),this.g.attachEmptyPacketListener("handedness",(e=>{b5(this,e)})),e=e.g(),this.setGraph(new Uint8Array(e),!0)}};G6.prototype.detectForVideo=G6.prototype.F,G6.prototype.detect=G6.prototype.D,G6.prototype.setOptions=G6.prototype.o,G6.createFromModelPath=function(e,t){return v6(G6,e,{baseOptions:{modelAssetPath:t}})},G6.createFromModelBuffer=function(e,t){return v6(G6,e,{baseOptions:{modelAssetBuffer:t}})},G6.createFromOptions=function(e,t){return v6(G6,e,t)},G6.HAND_CONNECTIONS=z6;var H6=p6([0,1],[1,2],[2,3],[3,7],[0,4],[4,5],[5,6],[6,8],[9,10],[11,12],[11,13],[13,15],[15,17],[15,19],[15,21],[17,19],[12,14],[14,16],[16,18],[16,20],[16,22],[18,20],[11,23],[12,24],[23,24],[23,25],[24,26],[25,27],[26,28],[27,29],[28,30],[29,31],[30,32],[27,31],[28,32]);function W6(e){e.h={faceLandmarks:[],faceBlendshapes:[],poseLandmarks:[],poseWorldLandmarks:[],poseSegmentationMasks:[],leftHandLandmarks:[],leftHandWorldLandmarks:[],rightHandLandmarks:[],rightHandWorldLandmarks:[]}}function q6(e){try{if(!e.C)return e.h;e.C(e.h)}finally{S5(e)}}function X6(e,t){e=U3(e),t.push(e5(e))}var Y6=class extends S6{constructor(e,t){super(new g6(e,t),"input_frames_image",null,!1),this.h={faceLandmarks:[],faceBlendshapes:[],poseLandmarks:[],poseWorldLandmarks:[],poseSegmentationMasks:[],leftHandLandmarks:[],leftHandWorldLandmarks:[],rightHandLandmarks:[],rightHandWorldLandmarks:[]},this.outputPoseSegmentationMasks=this.outputFaceBlendshapes=!1,B0(e=this.j=new k4,0,1,t=new r4),this.J=new S4,B0(this.j,0,2,this.J),this.Z=new O4,B0(this.j,0,3,this.Z),this.s=new o4,B0(this.j,0,4,this.s),this.H=new u4,B0(this.j,0,5,this.H),this.v=new I4,B0(this.j,0,6,this.v),this.K=new R4,B0(this.j,0,7,this.K),q0(this.s,2,.5),q0(this.s,3,.3),q0(this.H,2,.5),q0(this.v,2,.5),q0(this.v,3,.3),q0(this.K,2,.5),q0(this.J,2,.5)}get baseOptions(){return R0(this.j,r4,1)}set baseOptions(e){B0(this.j,0,1,e)}o(e){var t,n,i,r,s,a,o;return"minFaceDetectionConfidence"in e&&q0(this.s,2,null!==(t=e.minFaceDetectionConfidence)&&void 0!==t?t:.5),"minFaceSuppressionThreshold"in e&&q0(this.s,3,null!==(n=e.minFaceSuppressionThreshold)&&void 0!==n?n:.3),"minFacePresenceConfidence"in e&&q0(this.H,2,null!==(i=e.minFacePresenceConfidence)&&void 0!==i?i:.5),"outputFaceBlendshapes"in e&&(this.outputFaceBlendshapes=!!e.outputFaceBlendshapes),"minPoseDetectionConfidence"in e&&q0(this.v,2,null!==(r=e.minPoseDetectionConfidence)&&void 0!==r?r:.5),"minPoseSuppressionThreshold"in e&&q0(this.v,3,null!==(s=e.minPoseSuppressionThreshold)&&void 0!==s?s:.3),"minPosePresenceConfidence"in e&&q0(this.K,2,null!==(a=e.minPosePresenceConfidence)&&void 0!==a?a:.5),"outputPoseSegmentationMasks"in e&&(this.outputPoseSegmentationMasks=!!e.outputPoseSegmentationMasks),"minHandLandmarksConfidence"in e&&q0(this.J,2,null!==(o=e.minHandLandmarksConfidence)&&void 0!==o?o:.5),this.l(e)}D(e,t,n){const i="function"!=typeof t?t:{};return this.C="function"==typeof t?t:n,W6(this),b6(this,e,i),q6(this)}F(e,t,n,i){const r="function"!=typeof n?n:{};return this.C="function"==typeof n?n:i,W6(this),x6(this,e,r,t),q6(this)}m(){var e=new C3;E3(e,"input_frames_image"),A3(e,"pose_landmarks"),A3(e,"pose_world_landmarks"),A3(e,"face_landmarks"),A3(e,"left_hand_landmarks"),A3(e,"left_hand_world_landmarks"),A3(e,"right_hand_landmarks"),A3(e,"right_hand_world_landmarks");const t=new p3,n=new t3;A0(n,1,F$("type.googleapis.com/mediapipe.tasks.vision.holistic_landmarker.proto.HolisticLandmarkerGraphOptions"),""),function(e,t){if(null!=t)if(Array.isArray(t))m0(e,2,o0(t));else{if(!("string"==typeof t||t instanceof vJ||pJ(t)))throw Error("invalid value in Any.value field: "+t+" expected a ByteString, a base64 encoded string, a Uint8Array or a jspb array");A0(e,2,qJ(t,!1),mJ())}}(n,this.j.g());const i=new b3;g3(i,"mediapipe.tasks.vision.holistic_landmarker.HolisticLandmarkerGraph"),U0(i,8,t3,n),v3(i,"IMAGE:input_frames_image"),y3(i,"POSE_LANDMARKS:pose_landmarks"),y3(i,"POSE_WORLD_LANDMARKS:pose_world_landmarks"),y3(i,"FACE_LANDMARKS:face_landmarks"),y3(i,"LEFT_HAND_LANDMARKS:left_hand_landmarks"),y3(i,"LEFT_HAND_WORLD_LANDMARKS:left_hand_world_landmarks"),y3(i,"RIGHT_HAND_LANDMARKS:right_hand_landmarks"),y3(i,"RIGHT_HAND_WORLD_LANDMARKS:right_hand_world_landmarks"),i.o(t),_3(e,i),x5(this,e),this.g.attachProtoListener("pose_landmarks",((e,t)=>{X6(e,this.h.poseLandmarks),b5(this,t)})),this.g.attachEmptyPacketListener("pose_landmarks",(e=>{b5(this,e)})),this.g.attachProtoListener("pose_world_landmarks",((e,t)=>{var n=this.h.poseWorldLandmarks;e=N3(e),n.push(t5(e)),b5(this,t)})),this.g.attachEmptyPacketListener("pose_world_landmarks",(e=>{b5(this,e)})),this.outputPoseSegmentationMasks&&(y3(i,"POSE_SEGMENTATION_MASK:pose_segmentation_mask"),w5(this,"pose_segmentation_mask"),this.g.U("pose_segmentation_mask",((e,t)=>{this.h.poseSegmentationMasks=[w6(this,e,!0,!this.C)],b5(this,t)})),this.g.attachEmptyPacketListener("pose_segmentation_mask",(e=>{this.h.poseSegmentationMasks=[],b5(this,e)}))),this.g.attachProtoListener("face_landmarks",((e,t)=>{X6(e,this.h.faceLandmarks),b5(this,t)})),this.g.attachEmptyPacketListener("face_landmarks",(e=>{b5(this,e)})),this.outputFaceBlendshapes&&(A3(e,"extra_blendshapes"),y3(i,"FACE_BLENDSHAPES:extra_blendshapes"),this.g.attachProtoListener("extra_blendshapes",((e,t)=>{var n,i=this.h.faceBlendshapes;this.outputFaceBlendshapes&&(e=I3(e),i.push(J4(null!==(n=e.g())&&void 0!==n?n:[]))),b5(this,t)})),this.g.attachEmptyPacketListener("extra_blendshapes",(e=>{b5(this,e)}))),this.g.attachProtoListener("left_hand_landmarks",((e,t)=>{X6(e,this.h.leftHandLandmarks),b5(this,t)})),this.g.attachEmptyPacketListener("left_hand_landmarks",(e=>{b5(this,e)})),this.g.attachProtoListener("left_hand_world_landmarks",((e,t)=>{var n=this.h.leftHandWorldLandmarks;e=N3(e),n.push(t5(e)),b5(this,t)})),this.g.attachEmptyPacketListener("left_hand_world_landmarks",(e=>{b5(this,e)})),this.g.attachProtoListener("right_hand_landmarks",((e,t)=>{X6(e,this.h.rightHandLandmarks),b5(this,t)})),this.g.attachEmptyPacketListener("right_hand_landmarks",(e=>{b5(this,e)})),this.g.attachProtoListener("right_hand_world_landmarks",((e,t)=>{var n=this.h.rightHandWorldLandmarks;e=N3(e),n.push(t5(e)),b5(this,t)})),this.g.attachEmptyPacketListener("right_hand_world_landmarks",(e=>{b5(this,e)})),e=e.g(),this.setGraph(new Uint8Array(e),!0)}};Y6.prototype.detectForVideo=Y6.prototype.F,Y6.prototype.detect=Y6.prototype.D,Y6.prototype.setOptions=Y6.prototype.o,Y6.createFromModelPath=function(e,t){return v6(Y6,e,{baseOptions:{modelAssetPath:t}})},Y6.createFromModelBuffer=function(e,t){return v6(Y6,e,{baseOptions:{modelAssetBuffer:t}})},Y6.createFromOptions=function(e,t){return v6(Y6,e,t)},Y6.HAND_CONNECTIONS=z6,Y6.POSE_CONNECTIONS=H6,Y6.FACE_LANDMARKS_LIPS=E6,Y6.FACE_LANDMARKS_LEFT_EYE=A6,Y6.FACE_LANDMARKS_LEFT_EYEBROW=C6,Y6.FACE_LANDMARKS_LEFT_IRIS=M6,Y6.FACE_LANDMARKS_RIGHT_EYE=T6,Y6.FACE_LANDMARKS_RIGHT_EYEBROW=P6,Y6.FACE_LANDMARKS_RIGHT_IRIS=D6,Y6.FACE_LANDMARKS_FACE_OVAL=O6,Y6.FACE_LANDMARKS_CONTOURS=I6,Y6.FACE_LANDMARKS_TESSELATION=R6;var Q6=class extends S6{constructor(e,t){super(new g6(e,t),"input_image","norm_rect",!0),this.j={classifications:[]},B0(e=this.h=new z4,0,1,t=new r4)}get baseOptions(){return R0(this.h,r4,1)}set baseOptions(e){B0(this.h,0,1,e)}o(e){return B0(this.h,0,2,Z4(e,R0(this.h,Z3,2))),this.l(e)}sa(e,t){return this.j={classifications:[]},b6(this,e,t),this.j}ta(e,t,n){return this.j={classifications:[]},x6(this,e,n,t),this.j}m(){var e=new C3;E3(e,"input_image"),E3(e,"norm_rect"),A3(e,"classifications");const t=new p3;x1(t,N4,this.h);const n=new b3;g3(n,"mediapipe.tasks.vision.image_classifier.ImageClassifierGraph"),v3(n,"IMAGE:input_image"),v3(n,"NORM_RECT:norm_rect"),y3(n,"CLASSIFICATIONS:classifications"),n.o(t),_3(e,n),this.g.attachProtoListener("classifications",((e,t)=>{this.j=function(e,t){const n={classifications:L0(e,H3,1).map((e=>{var t,n,i,r;return J4(null!==(t=null===(n=R0(e,D3,4))||void 0===n?void 0:n.g())&&void 0!==t?t:[],null!==(i=j0(e,2))&&void 0!==i?i:0,null!==(r=V0(e,3))&&void 0!==r?r:"")}))};return null!=z$(p0(e,2))&&(n.timestampMs=null!==(t=z$(p0(e,2)))&&void 0!==t?t:0),n}(W3(e)),b5(this,t)})),this.g.attachEmptyPacketListener("classifications",(e=>{b5(this,e)})),e=e.g(),this.setGraph(new Uint8Array(e),!0)}};Q6.prototype.classifyForVideo=Q6.prototype.ta,Q6.prototype.classify=Q6.prototype.sa,Q6.prototype.setOptions=Q6.prototype.o,Q6.createFromModelPath=function(e,t){return v6(Q6,e,{baseOptions:{modelAssetPath:t}})},Q6.createFromModelBuffer=function(e,t){return v6(Q6,e,{baseOptions:{modelAssetBuffer:t}})},Q6.createFromOptions=function(e,t){return v6(Q6,e,t)};var K6=class extends S6{constructor(e,t){super(new g6(e,t),"image_in","norm_rect",!0),this.h=new F4,this.embeddings={embeddings:[]},B0(e=this.h,0,1,t=new r4)}get baseOptions(){return R0(this.h,r4,1)}set baseOptions(e){B0(this.h,0,1,e)}o(e){var t=this.h,n=R0(this.h,$3,2);return n=n?n.clone():new $3,void 0!==e.l2Normalize?H0(n,1,e.l2Normalize):"l2Normalize"in e&&m0(n,1),void 0!==e.quantize?H0(n,2,e.quantize):"quantize"in e&&m0(n,2),B0(t,0,2,n),this.l(e)}za(e,t){return b6(this,e,t),this.embeddings}Aa(e,t,n){return x6(this,e,n,t),this.embeddings}m(){var e=new C3;E3(e,"image_in"),E3(e,"norm_rect"),A3(e,"embeddings_out");const t=new p3;x1(t,U4,this.h);const n=new b3;g3(n,"mediapipe.tasks.vision.image_embedder.ImageEmbedderGraph"),v3(n,"IMAGE:image_in"),v3(n,"NORM_RECT:norm_rect"),y3(n,"EMBEDDINGS:embeddings_out"),n.o(t),_3(e,n),this.g.attachProtoListener("embeddings_out",((e,t)=>{e=K3(e),this.embeddings=function(e,t){return{embeddings:L0(e,Y3,1).map((e=>{var t,n,i,r;const s={headIndex:null!==(t=null!==(n=j0(e,3))&&void 0!==n?n:0)&&void 0!==t?t:-1,headName:null!==(i=null!==(r=V0(e,4))&&void 0!==r?r:"")&&void 0!==i?i:""};if(void 0!==I0(e,q3,M0(e,1)))e=x0(e=R0(e,q3,M0(e,1)),1,T$,b0()),s.floatEmbedding=e.slice();else{var a,o;const t=new Uint8Array(0);s.quantizedEmbedding=null!==(a=null===(o=R0(e,X3,M0(e,2)))||void 0===o||null===(o=o.oa())||void 0===o?void 0:o.h())&&void 0!==a?a:t}return s})),timestampMs:null!==(t=z$(p0(e,2)))&&void 0!==t?t:0}}(e),b5(this,t)})),this.g.attachEmptyPacketListener("embeddings_out",(e=>{b5(this,e)})),e=e.g(),this.setGraph(new Uint8Array(e),!0)}};K6.cosineSimilarity=function(e,t){if(e.floatEmbedding&&t.floatEmbedding)e=i5(e.floatEmbedding,t.floatEmbedding);else{if(!e.quantizedEmbedding||!t.quantizedEmbedding)throw Error("Cannot compute cosine similarity between quantized and float embeddings.");e=i5(n5(e.quantizedEmbedding),n5(t.quantizedEmbedding))}return e},K6.prototype.embedForVideo=K6.prototype.Aa,K6.prototype.embed=K6.prototype.za,K6.prototype.setOptions=K6.prototype.o,K6.createFromModelPath=function(e,t){return v6(K6,e,{baseOptions:{modelAssetPath:t}})},K6.createFromModelBuffer=function(e,t){return v6(K6,e,{baseOptions:{modelAssetBuffer:t}})},K6.createFromOptions=function(e,t){return v6(K6,e,t)};var Z6=class{constructor(e,t,n){this.confidenceMasks=e,this.categoryMask=t,this.qualityScores=n}close(){var e,t;null!==(e=this.confidenceMasks)&&void 0!==e&&e.forEach((e=>{e.close()})),null===(t=this.categoryMask)||void 0===t||t.close()}};function J6(e){e.categoryMask=void 0,e.confidenceMasks=void 0,e.qualityScores=void 0}function $6(e){try{const t=new Z6(e.confidenceMasks,e.categoryMask,e.qualityScores);if(!e.j)return t;e.j(t)}finally{S5(e)}}Z6.prototype.close=Z6.prototype.close;var e8=class extends S6{constructor(e,t){super(new g6(e,t),"image_in","norm_rect",!1),this.s=[],this.outputCategoryMask=!1,this.outputConfidenceMasks=!0,this.h=new W4,this.v=new j4,B0(this.h,0,3,this.v),B0(e=this.h,0,1,t=new r4)}get baseOptions(){return R0(this.h,r4,1)}set baseOptions(e){B0(this.h,0,1,e)}o(e){var t,n;return void 0!==e.displayNamesLocale?m0(this.h,2,F$(e.displayNamesLocale)):"displayNamesLocale"in e&&m0(this.h,2),"outputCategoryMask"in e&&(this.outputCategoryMask=null!==(t=e.outputCategoryMask)&&void 0!==t&&t),"outputConfidenceMasks"in e&&(this.outputConfidenceMasks=null===(n=e.outputConfidenceMasks)||void 0===n||n),super.l(e)}I(){!function(e,t,n){const i=L0(e.da(),b3,1).filter((e=>{var t;return(null!==(t=V0(e,1))&&void 0!==t?t:"").includes("mediapipe.tasks.TensorsToSegmentationCalculator")}));if(e.s=[],i.length>1)throw Error("The graph has more than one mediapipe.tasks.TensorsToSegmentationCalculator.");1===i.length&&(null!==(t=null===(n=R0(i[0],p3,7))||void 0===n||null===(n=n.l())||void 0===n?void 0:n.g())&&void 0!==t?t:new Map).forEach(((t,n)=>{var i;e.s[Number(n)]=null!==(i=V0(t,1))&&void 0!==i?i:""}))}(this)}segment(e,t,n){const i="function"!=typeof t?t:{};return this.j="function"==typeof t?t:n,J6(this),b6(this,e,i),$6(this)}Ma(e,t,n,i){const r="function"!=typeof n?n:{};return this.j="function"==typeof n?n:i,J6(this),x6(this,e,r,t),$6(this)}Da(){return this.s}m(){var e=new C3;E3(e,"image_in"),E3(e,"norm_rect");const t=new p3;x1(t,q4,this.h);const n=new b3;g3(n,"mediapipe.tasks.vision.image_segmenter.ImageSegmenterGraph"),v3(n,"IMAGE:image_in"),v3(n,"NORM_RECT:norm_rect"),n.o(t),_3(e,n),x5(this,e),this.outputConfidenceMasks&&(A3(e,"confidence_masks"),y3(n,"CONFIDENCE_MASKS:confidence_masks"),w5(this,"confidence_masks"),this.g.ca("confidence_masks",((e,t)=>{this.confidenceMasks=e.map((e=>w6(this,e,!0,!this.j))),b5(this,t)})),this.g.attachEmptyPacketListener("confidence_masks",(e=>{this.confidenceMasks=[],b5(this,e)}))),this.outputCategoryMask&&(A3(e,"category_mask"),y3(n,"CATEGORY_MASK:category_mask"),w5(this,"category_mask"),this.g.U("category_mask",((e,t)=>{this.categoryMask=w6(this,e,!1,!this.j),b5(this,t)})),this.g.attachEmptyPacketListener("category_mask",(e=>{this.categoryMask=void 0,b5(this,e)}))),A3(e,"quality_scores"),y3(n,"QUALITY_SCORES:quality_scores"),this.g.attachFloatVectorListener("quality_scores",((e,t)=>{this.qualityScores=e,b5(this,t)})),this.g.attachEmptyPacketListener("quality_scores",(e=>{this.categoryMask=void 0,b5(this,e)})),e=e.g(),this.setGraph(new Uint8Array(e),!0)}};e8.prototype.getLabels=e8.prototype.Da,e8.prototype.segmentForVideo=e8.prototype.Ma,e8.prototype.segment=e8.prototype.segment,e8.prototype.setOptions=e8.prototype.o,e8.createFromModelPath=function(e,t){return v6(e8,e,{baseOptions:{modelAssetPath:t}})},e8.createFromModelBuffer=function(e,t){return v6(e8,e,{baseOptions:{modelAssetBuffer:t}})},e8.createFromOptions=function(e,t){return v6(e8,e,t)};var t8=class{constructor(e,t,n){this.confidenceMasks=e,this.categoryMask=t,this.qualityScores=n}close(){var e,t;null!==(e=this.confidenceMasks)&&void 0!==e&&e.forEach((e=>{e.close()})),null===(t=this.categoryMask)||void 0===t||t.close()}};t8.prototype.close=t8.prototype.close;var n8=class extends w1{constructor(e){super(e)}},i8=[0,z2,-2],r8=[0,D2,-3,U2,D2,-1],s8=[0,r8],a8=[0,r8,z2,-1],o8=class extends w1{constructor(e){super(e)}},l8=[0,D2,-1,U2],c8=class extends w1{constructor(e){super(e)}},h8=class extends w1{constructor(e){super(e)}},u8=[1,2,3,4,5,6,7,8,9,10,14,15],d8=class extends w1{constructor(e){super(e)}};d8.prototype.g=e3([0,W2,[0,u8,q2,r8,q2,[0,r8,i8],q2,s8,q2,[0,s8,i8],q2,l8,q2,[0,D2,-3,U2,K2],q2,[0,D2,-3,U2],q2,[0,H2,D2,-2,U2,z2,U2,-1,2,D2,i8],q2,a8,q2,[0,a8,i8],D2,i8,H2,q2,[0,D2,-3,U2,i8,-1],q2,[0,W2,l8]],H2,[0,H2,z2,-1,U2]]);var p8=class extends S6{constructor(e,t){super(new g6(e,t),"image_in","norm_rect_in",!1),this.outputCategoryMask=!1,this.outputConfidenceMasks=!0,this.h=new W4,this.s=new j4,B0(this.h,0,3,this.s),B0(e=this.h,0,1,t=new r4)}get baseOptions(){return R0(this.h,r4,1)}set baseOptions(e){B0(this.h,0,1,e)}o(e){var t,n;return"outputCategoryMask"in e&&(this.outputCategoryMask=null!==(t=e.outputCategoryMask)&&void 0!==t&&t),"outputConfidenceMasks"in e&&(this.outputConfidenceMasks=null===(n=e.outputConfidenceMasks)||void 0===n||n),super.l(e)}segment(e,t,n,i){const r="function"!=typeof n?n:{};this.j="function"==typeof n?n:i,this.qualityScores=this.categoryMask=this.confidenceMasks=void 0,n=this.B+1,i=new d8;const s=new h8;var a=new n8;if(W0(a,1,255),B0(s,0,12,a),t.keypoint&&t.scribble)throw Error("Cannot provide both keypoint and scribble.");if(t.keypoint){var o=new o8;H0(o,3,!0),q0(o,1,t.keypoint.x),q0(o,2,t.keypoint.y),z0(s,5,u8,o)}else{if(!t.scribble)throw Error("Must provide either a keypoint or a scribble.");for(o of(a=new c8,t.scribble))H0(t=new o8,3,!0),q0(t,1,o.x),q0(t,2,o.y),U0(a,1,o8,t);z0(s,15,u8,a)}U0(i,1,h8,s),this.g.addProtoToStream(i.g(),"drishti.RenderData","roi_in",n),b6(this,e,r);e:{try{const e=new t8(this.confidenceMasks,this.categoryMask,this.qualityScores);if(!this.j){var l=e;break e}this.j(e)}finally{S5(this)}l=void 0}return l}m(){var e=new C3;E3(e,"image_in"),E3(e,"roi_in"),E3(e,"norm_rect_in");const t=new p3;x1(t,q4,this.h);const n=new b3;g3(n,"mediapipe.tasks.vision.interactive_segmenter.InteractiveSegmenterGraph"),v3(n,"IMAGE:image_in"),v3(n,"ROI:roi_in"),v3(n,"NORM_RECT:norm_rect_in"),n.o(t),_3(e,n),x5(this,e),this.outputConfidenceMasks&&(A3(e,"confidence_masks"),y3(n,"CONFIDENCE_MASKS:confidence_masks"),w5(this,"confidence_masks"),this.g.ca("confidence_masks",((e,t)=>{this.confidenceMasks=e.map((e=>w6(this,e,!0,!this.j))),b5(this,t)})),this.g.attachEmptyPacketListener("confidence_masks",(e=>{this.confidenceMasks=[],b5(this,e)}))),this.outputCategoryMask&&(A3(e,"category_mask"),y3(n,"CATEGORY_MASK:category_mask"),w5(this,"category_mask"),this.g.U("category_mask",((e,t)=>{this.categoryMask=w6(this,e,!1,!this.j),b5(this,t)})),this.g.attachEmptyPacketListener("category_mask",(e=>{this.categoryMask=void 0,b5(this,e)}))),A3(e,"quality_scores"),y3(n,"QUALITY_SCORES:quality_scores"),this.g.attachFloatVectorListener("quality_scores",((e,t)=>{this.qualityScores=e,b5(this,t)})),this.g.attachEmptyPacketListener("quality_scores",(e=>{this.categoryMask=void 0,b5(this,e)})),e=e.g(),this.setGraph(new Uint8Array(e),!0)}};p8.prototype.segment=p8.prototype.segment,p8.prototype.setOptions=p8.prototype.o,p8.createFromModelPath=function(e,t){return v6(p8,e,{baseOptions:{modelAssetPath:t}})},p8.createFromModelBuffer=function(e,t){return v6(p8,e,{baseOptions:{modelAssetBuffer:t}})},p8.createFromOptions=function(e,t){return v6(p8,e,t)};var f8=class extends S6{constructor(e,t){super(new g6(e,t),"input_frame_gpu","norm_rect",!1),this.j={detections:[]},B0(e=this.h=new X4,0,1,t=new r4)}get baseOptions(){return R0(this.h,r4,1)}set baseOptions(e){B0(this.h,0,1,e)}o(e){return void 0!==e.displayNamesLocale?m0(this.h,2,F$(e.displayNamesLocale)):"displayNamesLocale"in e&&m0(this.h,2),void 0!==e.maxResults?W0(this.h,3,e.maxResults):"maxResults"in e&&m0(this.h,3),void 0!==e.scoreThreshold?q0(this.h,4,e.scoreThreshold):"scoreThreshold"in e&&m0(this.h,4),void 0!==e.categoryAllowlist?X0(this.h,5,e.categoryAllowlist):"categoryAllowlist"in e&&m0(this.h,5),void 0!==e.categoryDenylist?X0(this.h,6,e.categoryDenylist):"categoryDenylist"in e&&m0(this.h,6),this.l(e)}D(e,t){return this.j={detections:[]},b6(this,e,t),this.j}F(e,t,n){return this.j={detections:[]},x6(this,e,n,t),this.j}m(){var e=new C3;E3(e,"input_frame_gpu"),E3(e,"norm_rect"),A3(e,"detections");const t=new p3;x1(t,Y4,this.h);const n=new b3;g3(n,"mediapipe.tasks.vision.ObjectDetectorGraph"),v3(n,"IMAGE:input_frame_gpu"),v3(n,"NORM_RECT:norm_rect"),y3(n,"DETECTIONS:detections"),n.o(t),_3(e,n),this.g.attachProtoVectorListener("detections",((e,t)=>{for(const n of e)e=B3(n),this.j.detections.push($4(e));b5(this,t)})),this.g.attachEmptyPacketListener("detections",(e=>{b5(this,e)})),e=e.g(),this.setGraph(new Uint8Array(e),!0)}};f8.prototype.detectForVideo=f8.prototype.F,f8.prototype.detect=f8.prototype.D,f8.prototype.setOptions=f8.prototype.o,f8.createFromModelPath=async function(e,t){return v6(f8,e,{baseOptions:{modelAssetPath:t}})},f8.createFromModelBuffer=function(e,t){return v6(f8,e,{baseOptions:{modelAssetBuffer:t}})},f8.createFromOptions=function(e,t){return v6(f8,e,t)};var m8=class{constructor(e,t,n){this.landmarks=e,this.worldLandmarks=t,this.segmentationMasks=n}close(){var e;null===(e=this.segmentationMasks)||void 0===e||e.forEach((e=>{e.close()}))}};function g8(e){e.landmarks=[],e.worldLandmarks=[],e.segmentationMasks=void 0}function v8(e){try{const t=new m8(e.landmarks,e.worldLandmarks,e.segmentationMasks);if(!e.s)return t;e.s(t)}finally{S5(e)}}m8.prototype.close=m8.prototype.close;var y8=class extends S6{constructor(e,t){super(new g6(e,t),"image_in","norm_rect",!1),this.landmarks=[],this.worldLandmarks=[],this.outputSegmentationMasks=!1,B0(e=this.h=new Q4,0,1,t=new r4),this.v=new R4,B0(this.h,0,3,this.v),this.j=new I4,B0(this.h,0,2,this.j),W0(this.j,4,1),q0(this.j,2,.5),q0(this.v,2,.5),q0(this.h,4,.5)}get baseOptions(){return R0(this.h,r4,1)}set baseOptions(e){B0(this.h,0,1,e)}o(e){var t,n,i,r,s;return"numPoses"in e&&W0(this.j,4,null!==(t=e.numPoses)&&void 0!==t?t:1),"minPoseDetectionConfidence"in e&&q0(this.j,2,null!==(n=e.minPoseDetectionConfidence)&&void 0!==n?n:.5),"minTrackingConfidence"in e&&q0(this.h,4,null!==(i=e.minTrackingConfidence)&&void 0!==i?i:.5),"minPosePresenceConfidence"in e&&q0(this.v,2,null!==(r=e.minPosePresenceConfidence)&&void 0!==r?r:.5),"outputSegmentationMasks"in e&&(this.outputSegmentationMasks=null!==(s=e.outputSegmentationMasks)&&void 0!==s&&s),this.l(e)}D(e,t,n){const i="function"!=typeof t?t:{};return this.s="function"==typeof t?t:n,g8(this),b6(this,e,i),v8(this)}F(e,t,n,i){const r="function"!=typeof n?n:{};return this.s="function"==typeof n?n:i,g8(this),x6(this,e,r,t),v8(this)}m(){var e=new C3;E3(e,"image_in"),E3(e,"norm_rect"),A3(e,"normalized_landmarks"),A3(e,"world_landmarks"),A3(e,"segmentation_masks");const t=new p3;x1(t,K4,this.h);const n=new b3;g3(n,"mediapipe.tasks.vision.pose_landmarker.PoseLandmarkerGraph"),v3(n,"IMAGE:image_in"),v3(n,"NORM_RECT:norm_rect"),y3(n,"NORM_LANDMARKS:normalized_landmarks"),y3(n,"WORLD_LANDMARKS:world_landmarks"),n.o(t),_3(e,n),x5(this,e),this.g.attachProtoVectorListener("normalized_landmarks",((e,t)=>{this.landmarks=[];for(const n of e)e=U3(n),this.landmarks.push(e5(e));b5(this,t)})),this.g.attachEmptyPacketListener("normalized_landmarks",(e=>{this.landmarks=[],b5(this,e)})),this.g.attachProtoVectorListener("world_landmarks",((e,t)=>{this.worldLandmarks=[];for(const n of e)e=N3(n),this.worldLandmarks.push(t5(e));b5(this,t)})),this.g.attachEmptyPacketListener("world_landmarks",(e=>{this.worldLandmarks=[],b5(this,e)})),this.outputSegmentationMasks&&(y3(n,"SEGMENTATION_MASK:segmentation_masks"),w5(this,"segmentation_masks"),this.g.ca("segmentation_masks",((e,t)=>{this.segmentationMasks=e.map((e=>w6(this,e,!0,!this.s))),b5(this,t)})),this.g.attachEmptyPacketListener("segmentation_masks",(e=>{this.segmentationMasks=[],b5(this,e)}))),e=e.g(),this.setGraph(new Uint8Array(e),!0)}};y8.prototype.detectForVideo=y8.prototype.F,y8.prototype.detect=y8.prototype.D,y8.prototype.setOptions=y8.prototype.o,y8.createFromModelPath=function(e,t){return v6(y8,e,{baseOptions:{modelAssetPath:t}})},y8.createFromModelBuffer=function(e,t){return v6(y8,e,{baseOptions:{modelAssetBuffer:t}})},y8.createFromOptions=function(e,t){return v6(y8,e,t)},y8.POSE_CONNECTIONS=H6;const b8=["Thumb_Up","Thumb_Down","Open_Palm","Closed_Fist","Victory","Pointing_Up"],x8=t=>{let{onGestureDetected:n,className:i,showWebcam:r=!0,onCalibrationComplete:s,startCalibration:a=!0,onThresholdsUpdate:l}=t;const h=(0,e.useRef)(null),[u,d]=(0,e.useState)(!0),[p,f]=(0,e.useState)(a),[m,g]=(0,e.useState)(0),[v,y]=(0,e.useState)(null),[b,x]=(0,e.useState)({}),[w,S]=(0,e.useState)(0),[_,E]=(0,e.useState)(!1),A=(0,e.useRef)(0),C=(0,e.useRef)(null);if((0,e.useEffect)((()=>{a&&(f(!0),g(0),S(0),y(null),E(!1),A.current=0)}),[a]),(0,e.useEffect)((()=>((async()=>{try{const e=await l5.forVisionTasks("https://cdn.jsdelivr.net/npm/@mediapipe/tasks-vision@0.10.0/wasm");C.current=await j6.createFromOptions(e,{baseOptions:{modelAssetPath:"https://storage.googleapis.com/mediapipe-models/gesture_recognizer/gesture_recognizer/float16/1/gesture_recognizer.task",delegate:"CPU"},runningMode:"VIDEO",numHands:1,minHandDetectionConfidence:.3,minHandPresenceConfidence:.3,minTrackingConfidence:.3}),d(!1)}catch(e){console.error("Failed to initialize gesture recognizer:",e),d(!1)}})(),()=>{C.current&&C.current.close()})),[]),(0,e.useEffect)((()=>{let e,t=-1;const i=async()=>{var r;if(null!==(r=h.current)&&void 0!==r&&r.video&&C.current&&!u&&!_){const e=h.current.video;if(4===e.readyState&&e.currentTime!==t){t=e.currentTime;try{var a,c;const t=C.current.recognizeForVideo(e,performance.now());if(null!==(a=t.gestures)&&void 0!==a&&a.length&&null!==(c=t.gestures[0])&&void 0!==c&&c.length){const e=t.gestures[0][0];if(p&&m<b8.length){const t=b8[m];e.categoryName===t&&(A.current+=e.score,y(t),S((e=>{const n=e+1;if(30===n){const e=A.current/30;x((n=>{const i=o(o({},n),{},{[t]:Math.min(.6*e,.6)});return null===l||void 0===l||l(i),i})),setTimeout((()=>{E(!0),setTimeout((()=>{m<b8.length-1?(A.current=0,S(0),y(null),g(m+1),E(!1)):(f(!1),null===s||void 0===s||s())}),1e3)}),500)}return n})))}else if(!p&&"None"!==e.categoryName){const t=b[e.categoryName]||.7;e.score>=t&&(null===n||void 0===n||n({gesture:e.categoryName,confidence:e.score,timestamp:Date.now()}))}}}catch(d){console.error("Error during gesture recognition:",d)}}}e=requestAnimationFrame(i)};return i(),()=>{e&&cancelAnimationFrame(e)}}),[u,n,p,m,s,_,b,l]),!r&&!p)return null;const M=m===b8.length-1;return(0,c.jsx)("div",{className:i,style:{position:"relative",width:p?"100vw":"100%",height:p?"100vh":"100%"},children:u?(0,c.jsx)("div",{children:"Loading gesture recognizer..."}):(0,c.jsxs)("div",{style:{position:"relative",width:"100%",height:"100%"},children:[(0,c.jsx)(RZ(),{ref:h,mirrored:!0,style:{width:"100%",height:"100%",objectFit:"cover"},videoConstraints:{facingMode:"user",width:1280,height:720}}),p&&(0,c.jsx)("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,background:"rgba(0,0,0,0.7)",color:"white",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:"20px",textAlign:"center"},children:_?(0,c.jsx)("div",{style:{fontSize:"1.5em",color:"#4CAF50"},children:M?"Calibration complete!":"Great! Moving to next gesture..."}):(0,c.jsxs)(c.Fragment,{children:[(0,c.jsxs)("h2",{children:["Calibration Step ",m+1,"/",b8.length]}),(0,c.jsxs)("div",{style:{fontSize:"1.5em",margin:"20px 0"},children:["Please show the gesture: ",b8[m].replace("_"," ")]}),(0,c.jsx)("div",{style:{fontSize:"1.2em",color:"#666"},children:"Hold the gesture steady..."}),(0,c.jsx)("div",{style:{width:"200px",height:"20px",background:"#333",borderRadius:"10px",margin:"20px 0",overflow:"hidden"},children:(0,c.jsx)("div",{style:{width:"".concat(w/30*100,"%"),height:"100%",background:"#4CAF50",transition:"width 0.3s ease"}})}),v&&(0,c.jsxs)("div",{style:{marginTop:"10px",color:v===b8[m]?"#4CAF50":"#ff0072"},children:["Detected: ",v.replace("_"," ")]})]})})]})})},w8={arial:"Arial, sans-serif",times:"Times New Roman, serif",helvetica:"Helvetica, sans-serif",georgia:"Georgia, serif",verdana:"Verdana, sans-serif",courier:"Courier New, monospace",comic:"Comic Sans MS, cursive",impact:"Impact, sans-serif"},S8=t=>{let{nodes:n,currentNodeId:i,setCurrentNodeId:r,setFontFamily:s}=t;const[a,o]=(0,e.useState)(null),[l,c]=(0,e.useState)(!1),[h,u]=(0,e.useState)(null),d=(0,e.useRef)(null),p=((0,e.useRef)(null),(0,e.useRef)(n.findIndex((e=>e.id===i)))),f=(0,e.useRef)(i),m=(0,e.useRef)(null),g=(0,e.useRef)(),v="webkitSpeechRecognition"in window,y=(0,e.useCallback)((()=>{const e=n.findIndex((e=>e.id===i));if(console.log("Current index:",e,"Total nodes:",n.length),e<n.length-1){const t=n[e+1].id;console.log("Moving to next node:",t,"from current:",i),r(t),f.current=t}else console.log("Already at last slide")}),[n,i,r]),b=(0,e.useCallback)((()=>{const e=n.findIndex((e=>e.id===i));if(e>0){const t=n[e-1].id;console.log("Moving to previous node:",t),r(t)}}),[n,i,r]),x=(0,e.useCallback)((e=>{console.log("Looking for node with title:",e),console.log("Available nodes:",n);const t=n.find((t=>{var n,i;return(null===(n=t.data)||void 0===n||null===(i=n.label)||void 0===i?void 0:i.toLowerCase())===e.toLowerCase()}));t?(console.log("Found node, setting ID to:",t.id),r(t.id)):console.log("No node found with title:",e)}),[n,r]),w=(0,e.useCallback)((e=>{u(e),g.current&&clearTimeout(g.current),g.current=setTimeout((()=>{u(null)}),3e3)}),[]),S=(0,e.useCallback)((()=>{if(0===n.length)return void w("No slides available");const e=n.filter((e=>!n.some((t=>{var n,i;return null===(n=t.data)||void 0===n||null===(i=n.edges)||void 0===i?void 0:i.some((t=>t.target===e.id))})))),t=e.length>0?e:n;console.log("Candidate nodes for first slide:",t.length);const i=t.reduce(((e,t)=>{const n=e.position||{x:1/0,y:1/0},i=t.position||{x:1/0,y:1/0};return i.x<n.x||Math.abs(i.x-n.x)<=50&&i.y<n.y?t:e}),t[0]);console.log("Moving to leftmost-top node:",i.id),p.current=0,f.current=i.id,r(i.id)}),[n,w,r]),_=(0,e.useCallback)((()=>{S()}),[S]),E=(0,e.useCallback)((e=>{const t=Date.now();m.current&&t-m.current.timestamp<1500?console.log("Debouncing command:",e):(m.current={command:e,timestamp:t},console.log("Processing command:",e),setTimeout((()=>{if(e.includes("next"))console.log("Executing next command"),y();else if(e.includes("previous")||e.includes("back"))b();else if(e.includes("restart"))_();else if(e.includes("go to")){const t=e.replace("go to","").trim();console.log("Navigating to slide:",t),x(t)}else if(e.startsWith("change font to ")){const t=e.replace("change font to ","").trim(),n=Object.entries(w8).find((e=>{let[n]=e;return t.includes(n.toLowerCase())}));n&&s(n[1])}}),100))}),[y,b,_,x,s]);(0,e.useEffect)((()=>{if(v&&!d.current){d.current=new window.webkitSpeechRecognition;const e=d.current;e.continuous=!0,e.interimResults=!1,e.lang="en-US",e.onresult=e=>{const t=e.results,n=t[t.length-1];if(n){const e=n[0].transcript.toLowerCase().trim();console.log("Raw command:",e),E(e)}},e.onerror=e=>{console.log("Recognition error:",e.error),"not-allowed"!==e.error&&"service-not-allowed"!==e.error||(w("Speech recognition error: ".concat(e.error)),c(!1),d.current&&d.current.stop())},e.onstart=()=>{console.log("Recognition started"),c(!0)},e.onend=()=>{console.log("Recognition ended"),c(!1)}}}),[v,E]),(0,e.useEffect)((()=>{p.current=n.findIndex((e=>e.id===i)),f.current=i,console.log("Current index updated to:",p.current,"for node:",i)}),[i,n]);const A=n.map((e=>{var t;return{title:(null===(t=e.data)||void 0===t?void 0:t.label)||"",id:e.id}}));(0,e.useEffect)((()=>{if("undefined"===typeof window)return;const e=window.SpeechRecognition||window.webkitSpeechRecognition;if(!e)return void console.log("Speech recognition not supported");const t=new e;t.continuous=!1,t.interimResults=!1,t.onresult=e=>{const t=e.results[0][0].transcript.toLowerCase();console.log("Command:",t),(e=>{if(e.includes("restart"))_();else if(e.includes("next"))y();else if(e.includes("previous")||e.includes("back"))b();else if(e.includes("go to")){const t=e.match(/go to (.*)/i);if(t){const e=t[1].toLowerCase();setTimeout((()=>{x(e)}),1e3)}}else if(e.startsWith("change font to ")||e.startsWith("set font to ")){const t=e.match(/(?:change|set) font to (.*)/i);if(t&&t[1]){const e=t[1].trim(),n=Object.entries(w8).find((t=>{let[n]=t;return e.includes(n.toLowerCase())}));n&&(console.log("Changing font to:",n[1]),s(n[1]),document.querySelectorAll("button").forEach((e=>{e.style.fontFamily=n[1]})))}}})(t)},o(t)}),[]);const C=(0,e.useCallback)((()=>{if("webkitSpeechRecognition"in window)if(l)console.log("Already listening, ignoring start request");else try{console.log("Creating new recognition instance");const e=new(0,window.webkitSpeechRecognition);d.current=e,e.continuous=!0,e.interimResults=!1,e.lang="en-US",e.onstart=()=>{console.log("Recognition started"),c(!0)},e.onend=()=>{console.log("Recognition ended"),l&&d.current===e&&(console.log("Scheduling restart..."),setTimeout((()=>{if(l&&d.current===e){console.log("Restarting recognition...");try{e.start()}catch(h){console.error("Failed to restart recognition:",h),c(!1),d.current=null}}}),100))},e.onerror=e=>{console.log("Recognition error:",e.error),"not-allowed"!==e.error&&"service-not-allowed"!==e.error||(w("Speech recognition error: ".concat(e.error)),c(!1),d.current=null)},e.onresult=e=>{const t=e.results,n=t[t.length-1];if(n){const e=n[0].transcript.toLowerCase().trim();console.log("Raw command:",e),E(e)}},console.log("Starting recognition"),e.start()}catch(e){console.error("Error starting recognition:",e),c(!1),d.current=null}else console.log("Speech recognition not supported")}),[l,E]),M=(0,e.useCallback)((()=>{l?(console.log("Stopping recognition manually"),c(!1),d.current&&(d.current.stop(),d.current=null)):console.log("Already stopped, ignoring stop request")}),[l]);return(0,e.useEffect)((()=>{const e=e=>{"Space"!==e.code||e.altKey||e.ctrlKey||e.metaKey||(e.preventDefault(),console.log("".concat(l?"Stopping":"Starting"," recognition via spacebar")),l?M():C())};return window.addEventListener("keydown",e),()=>{window.removeEventListener("keydown",e)}}),[l,C,M]),{isListening:l,startListening:C,stopListening:M,isSupported:v,error:h,handleNextSlide:y,handlePreviousSlide:b,handleFirstSlide:_,handleNavigateToTitle:x,slides:A}},_8=(0,e.createContext)(void 0);function E8(t){let{children:n}=t;const[i,r]=(0,e.useState)((()=>{try{const e=localStorage.getItem("preferredFont");if(e&&Object.values(w8).includes(e))return e}catch(e){console.error("Error reading font preference:",e)}return w8.arial}));return(0,c.jsx)(_8.Provider,{value:{fontFamily:i,setFontFamily:e=>{try{localStorage.setItem("preferredFont",e),r(e)}catch(t){console.error("Error saving font preference:",t)}}},children:n})}const A8=(e,t,n)=>e+(t-e)*n,C8=t=>{let{color:n="#ff0000",size:i=10}=t;const r=(0,e.useRef)(null),[s,a]=(0,e.useState)(null),[o,l]=(0,e.useState)({x:-100,y:-100});return(0,e.useEffect)((()=>{(async()=>{try{const e=await l5.forVisionTasks("https://cdn.jsdelivr.net/npm/@mediapipe/tasks-vision@0.10.0/wasm"),t=await G6.createFromOptions(e,{baseOptions:{modelAssetPath:"https://storage.googleapis.com/mediapipe-models/hand_landmarker/hand_landmarker/float16/1/hand_landmarker.task",delegate:"CPU"},runningMode:"IMAGE",minHandDetectionConfidence:.2,minTrackingConfidence:.2});a(t)}catch(e){console.error("Error initializing hand landmarker:",e)}})()}),[]),(0,e.useEffect)((()=>{let e;const t=async()=>{var n;if(null!==(n=r.current)&&void 0!==n&&n.video&&s&&4===r.current.video.readyState){const e=r.current.video,t=await s.detect(e);if(t&&t.landmarks&&t.landmarks.length>0){const e=t.landmarks[0][8],n=(1-e.x)*window.innerWidth,i=e.y*window.innerHeight;l((e=>({x:A8(e.x,n,.3),y:A8(e.y,i,.3)})))}}e=requestAnimationFrame(t)};return t(),()=>cancelAnimationFrame(e)}),[s]),(0,e.useEffect)((()=>()=>{s&&s.close()}),[s]),(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(RZ(),{ref:r,audio:!1,videoConstraints:{facingMode:"user",width:1280,height:720},style:{position:"absolute",top:0,left:0,width:"0px",height:"0px",opacity:0}}),(0,c.jsx)("div",{style:{position:"fixed",left:o.x,top:o.y,width:"".concat(i,"px"),height:"".concat(i,"px"),borderRadius:"50%",backgroundColor:n,transform:"translate(-50%, -50%)",pointerEvents:"none",zIndex:1e3}})]})},M8=(e,t,n)=>e+(t-e)*n,T8=t=>{let{color:n="#ff0000",size:i=10}=t;const r=(0,e.useRef)(null),s=(0,e.useRef)(null),[a,o]=e.useState(null),l=(0,e.useRef)(null);return(0,e.useEffect)((()=>{(async()=>{try{const e=await l5.forVisionTasks("https://cdn.jsdelivr.net/npm/@mediapipe/tasks-vision@0.10.0/wasm"),t=await G6.createFromOptions(e,{baseOptions:{modelAssetPath:"https://storage.googleapis.com/mediapipe-models/hand_landmarker/hand_landmarker/float16/1/hand_landmarker.task",delegate:"CPU"},runningMode:"IMAGE",minHandDetectionConfidence:.2,minTrackingConfidence:.2});o(t)}catch(e){console.error("Error initializing hand landmarker:",e)}})()}),[]),(0,e.useEffect)((()=>()=>{a&&a.close()}),[a]),(0,e.useEffect)((()=>{const e=()=>{s.current&&(s.current.width=window.innerWidth,s.current.height=window.innerHeight)};return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)}),[]),(0,e.useEffect)((()=>{let e;const t=async()=>{var o;if(null!==(o=r.current)&&void 0!==o&&o.video&&a&&4===r.current.video.readyState&&s.current){const e=r.current.video,t=await a.detect(e),o=s.current.getContext("2d");if(t&&t.landmarks&&t.landmarks.length>0&&o){const e=t.landmarks[0][8],r=(1-e.x)*window.innerWidth,s=e.y*window.innerHeight;if(l.current){const e=l.current,t=M8(e.x,r,.2),a=M8(e.y,s,.2);o.strokeStyle=n,o.lineWidth=i,o.lineCap="round",o.beginPath(),o.moveTo(e.x,e.y),o.lineTo(t,a),o.stroke(),l.current={x:t,y:a}}else l.current={x:r,y:s},o.beginPath(),o.arc(r,s,i/2,0,2*Math.PI),o.fillStyle=n,o.fill()}else l.current=null}e=requestAnimationFrame(t)};return t(),()=>cancelAnimationFrame(e)}),[a,n,i]),(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(RZ(),{ref:r,audio:!1,videoConstraints:{facingMode:"user",width:1280,height:720},style:{position:"absolute",top:0,left:0,width:"0px",height:"0px",opacity:0}}),(0,c.jsx)("canvas",{ref:s,style:{position:"fixed",top:0,left:0,width:"100%",height:"100%",pointerEvents:"none",zIndex:1e3}})]})},P8="gesture_calibration_thresholds",D8=t=>{var n,i,r,s,a,l,h,u,d,p,f,m,g,v,y,b,x,w,S,_,E;let{workflow:A}=t;const[C,M]=(0,e.useState)("1"),[T,P]=(0,e.useState)(!1),[D,O]=(0,e.useState)(!0),[I,R]=(0,e.useState)(!0),[k,L]=(0,e.useState)(!0),[B,z]=(0,e.useState)(1),[N,F]=(0,e.useState)(null),U=(0,e.useRef)(),[j,V]=(0,e.useState)(!1),[G,H]=(0,e.useState)((()=>{try{const e=localStorage.getItem(P8);if(e){const t=JSON.parse(e);if(["Thumb_Up","Thumb_Down","Open_Palm","Closed_Fist","Victory","Pointing_Up"].every((e=>"number"===typeof t[e])))return O(!1),t}return{}}catch(LZ){return console.error("Failed to load thresholds:",LZ),{}}})),[W,q]=(0,e.useState)(null),[X,Y]=(0,e.useState)(null),Q=(0,e.useRef)(null),K=(0,e.useRef)(0),[Z,J]=(0,e.useState)({}),[$,ee]=(0,e.useState)(1),te=(0,e.useRef)(0),ne=A.nodes.find((e=>e.id===C)),{fontFamily:ie,setFontFamily:re}=function(){const t=(0,e.useContext)(_8);if(void 0===t)throw new Error("useTheme must be used within a ThemeProvider");return t}(),[se,ae]=(0,e.useState)([]),{isListening:oe,startListening:le,stopListening:ce,isSupported:he,error:ue}=S8({nodes:A.nodes,currentNodeId:C,setCurrentNodeId:M,setFontFamily:re});(0,e.useEffect)((()=>{console.log("Current node ID changed:",C)}),[C]),(0,e.useEffect)((()=>{console.log("Font family changed:",ie)}),[ie]);const de=(null===ne||void 0===ne||null===(n=ne.data)||void 0===n?void 0:n.pointerMode)||"laser",pe=(0,e.useCallback)((()=>{var e;return(null===ne||void 0===ne||null===(e=ne.data)||void 0===e?void 0:e.scrubAmount)||5}),[ne]);(0,e.useEffect)((()=>()=>{U.current&&cancelAnimationFrame(U.current)}),[]);const fe=(0,e.useCallback)((()=>null!==ne&&void 0!==ne&&ne.data?{min:ne.data.minZoom||1,max:ne.data.maxZoom||4}:{min:1,max:4}),[ne]),me=(0,e.useCallback)((e=>{var t,n;if(null===ne||void 0===ne||null===(t=ne.data)||void 0===t||null===(n=t.rotationDegree)||void 0===n||!n[e]||!ne.data.splineScene)return;const i=Z[ne.data.splineScene];if(!i)return;const r=i.getAllObjects().find((e=>"chips"===e.name||"Scene"===e.name||"Text"===e.name||"group"===e.name||"swing Scene"===e.name));if(r){const t=ne.data.rotationDegree[e],n="left"===e?-1:1;r.rotation.x=r.rotation.x+t.x*Math.PI*n/180,r.rotation.y=r.rotation.y+t.y*Math.PI*n/180}else console.log("No suitable object found for rotation")}),[Z,ne]),ge=(0,e.useCallback)((e=>{U.current&&cancelAnimationFrame(U.current);const{min:t,max:n}=fe(),i=()=>{z((r=>{const s="in"===e?Math.min(r+.05,n):Math.max(r-.05,t);return("in"===e&&s<n||"out"===e&&s>t)&&(U.current=requestAnimationFrame(i)),s}))};U.current=requestAnimationFrame(i)}),[fe]),ve=(0,e.useCallback)((e=>{var t;if(Z[null===ne||void 0===ne||null===(t=ne.data)||void 0===t?void 0:t.splineScene]){U.current&&cancelAnimationFrame(U.current);const{min:t,max:n}=fe(),i=()=>{var r;const s=$*("in"===e?.8:1.2);return"out"===e&&s>=n?(cancelAnimationFrame(U.current),n):"in"===e&&s<=t?(cancelAnimationFrame(U.current),t):(Z[null===ne||void 0===ne||null===(r=ne.data)||void 0===r?void 0:r.splineScene].setZoom(s),ee(s),void(U.current=requestAnimationFrame(i)))};U.current=requestAnimationFrame(i)}}),[Z,null===ne||void 0===ne||null===(i=ne.data)||void 0===i?void 0:i.splineScene,$,fe]),ye=(0,e.useCallback)((e=>{var t,n,i,r,s,a;const o=Date.now();if(o-te.current<1e3)return;if(null!==ne&&void 0!==ne&&null!==(t=ne.data)&&void 0!==t&&t.pointerStartGesture&&e.gesture===ne.data.pointerStartGesture)return void V(!0);if(null!==ne&&void 0!==ne&&null!==(n=ne.data)&&void 0!==n&&n.pointerStopGesture&&e.gesture===ne.data.pointerStopGesture)return void V(!1);const l=A.edges.filter((t=>{var n;return t.source===C&&(null===(n=t.data)||void 0===n?void 0:n.gesture)===e.gesture}));if("video"===(null===ne||void 0===ne||null===(i=ne.data)||void 0===i?void 0:i.type)&&Q.current){if(e.gesture===ne.data.playPauseGesture){const e=Date.now();return void(e-K.current>=1e3&&(Q.current.paused?Q.current.play():Q.current.pause(),K.current=e))}if(e.gesture===ne.data.scrubForwardGesture){const e=pe();return void(Q.current.currentTime=Math.min(Q.current.currentTime+e,Q.current.duration))}if(e.gesture===ne.data.scrubBackwardGesture){const e=pe();return void(Q.current.currentTime=Math.max(Q.current.currentTime-e,0))}}if(null!==ne&&void 0!==ne&&ne.data.zoomPoint&&"complexobject"!==(null===ne||void 0===ne||null===(r=ne.data)||void 0===r?void 0:r.type)){if(e.gesture===ne.data.zoomInGesture)return F(ne.data.zoomPoint),void ge("in");if(e.gesture===ne.data.zoomOutGesture)return F(ne.data.zoomPoint),void ge("out")}if("complexobject"===(null===ne||void 0===ne||null===(s=ne.data)||void 0===s?void 0:s.type)){if(e.gesture===ne.data.zoomInGesture)return F(ne.data.zoomPoint),void ve("in");if(e.gesture===ne.data.zoomOutGesture)return F(ne.data.zoomPoint),void ve("out")}if("complexobject"===(null===ne||void 0===ne||null===(a=ne.data)||void 0===a?void 0:a.type)){var c,h;if(e.gesture===(null===(c=ne.data.rotationGesture)||void 0===c?void 0:c.left))return void me("left");if(e.gesture===(null===(h=ne.data.rotationGesture)||void 0===h?void 0:h.right))return void me("right")}l.length>0&&(te.current=o,z(1),F(null),M(l[0].target))}),[C,A.edges,ne,ge,me,ve,pe]),be=(0,e.useCallback)((()=>{O(!1)}),[]),xe=(0,e.useCallback)((e=>{H(e);try{localStorage.setItem(P8,JSON.stringify(e))}catch(LZ){console.error("Failed to save thresholds:",LZ)}}),[]);(0,e.useEffect)((()=>{(async()=>{var e;if("api"===(null===ne||void 0===ne||null===(e=ne.data)||void 0===e?void 0:e.type))try{Y(null),q(null);const e="https://cors-anywhere.herokuapp.com/",t=ne.data.apiEndpoint,n=t.startsWith("http")?e+t:t,i=await fetch(n,{method:ne.data.apiMethod||"GET",headers:{"Content-Type":"application/json",Origin:window.location.origin},body:ne.data.apiPayload?JSON.parse(ne.data.apiPayload):void 0});if(!i.ok)throw new Error("API call failed: ".concat(i.statusText));const r=await i.json();q(r)}catch(ue){Y(ue instanceof Error?ue.message:"Failed to execute API call"),console.error("API call error:",ue)}})()}),[ne]);const we=A.edges.filter((e=>e.source===C));return(0,e.useEffect)((()=>(he&&!oe&&le(),()=>{oe&&ce()})),[he,oe,le,ce]),(0,c.jsx)("div",{className:"presentation-mode",style:{fontFamily:ie,height:"100vh",width:"100vw",position:"relative"},children:(0,c.jsxs)("div",{className:"presentation-content",style:{fontFamily:ie},children:[(0,c.jsxs)("div",{className:"controls",children:[!D&&(0,c.jsxs)("div",{style:{position:"absolute",top:0,right:0,width:"200px",height:"150px",zIndex:10,background:"#f8f8f8",borderRadius:"0 0 0 8px",boxShadow:"0 2px 4px rgba(0,0,0,0.1)"},children:[(0,c.jsx)(x8,{onGestureDetected:ye,showWebcam:k,startCalibration:!1,onThresholdsUpdate:xe}),(0,c.jsxs)("div",{style:{position:"absolute",bottom:-40,left:0,right:0,display:"flex",justifyContent:"center",gap:"10px"},children:[(0,c.jsx)("button",{onClick:()=>O(!0),style:{padding:"8px 16px",background:"#4CAF50",color:"white",border:"none",borderRadius:"4px",cursor:"pointer",fontSize:"12px"},children:"Recalibrate"}),(0,c.jsx)("button",{onClick:()=>P(!T),style:{padding:"8px 16px",background:"#2196F3",color:"white",border:"none",borderRadius:"4px",cursor:"pointer",fontSize:"12px"},children:"Settings"})]})]}),D&&(0,c.jsx)("div",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",zIndex:100},children:(0,c.jsx)(x8,{onGestureDetected:ye,startCalibration:!0,onCalibrationComplete:be,onThresholdsUpdate:xe})}),T&&!D&&(0,c.jsxs)("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",background:"white",padding:"20px",borderRadius:"8px",boxShadow:"0 4px 12px rgba(0,0,0,0.15)",zIndex:100,minWidth:"300px"},children:[(0,c.jsx)("h3",{style:{marginTop:0},children:"Settings"}),(0,c.jsx)("div",{style:{marginBottom:"20px"},children:(0,c.jsxs)("label",{style:{display:"block",marginBottom:"5px",cursor:"pointer"},children:[(0,c.jsx)("input",{type:"checkbox",checked:I,onChange:e=>R(e.target.checked),style:{marginRight:"10px"}}),"Show Available Gestures"]})}),(0,c.jsx)("div",{style:{marginBottom:"20px"},children:(0,c.jsxs)("label",{style:{display:"block",marginBottom:"5px",cursor:"pointer"},children:[(0,c.jsx)("input",{type:"checkbox",checked:k,onChange:e=>L(e.target.checked),style:{marginRight:"10px"}}),"Show Webcam Preview"]})}),(0,c.jsxs)("div",{style:{marginBottom:"20px"},children:[(0,c.jsx)("div",{style:{fontWeight:"bold",marginBottom:"10px"},children:"Gesture Thresholds:"}),(0,c.jsx)("div",{style:{maxHeight:"150px",overflowY:"auto",background:"#f5f5f5",borderRadius:"4px",padding:"10px"},children:Object.entries(G).map((e=>{let[t,n]=e;return(0,c.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"5px 0"},children:[(0,c.jsx)("span",{children:t.replace("_"," ")}),(0,c.jsxs)("span",{style:{color:"#666",background:"#fff",padding:"2px 8px",borderRadius:"4px",fontSize:"0.9em"},children:[(100*n).toFixed(1),"%"]})]},t)}))})]}),(0,c.jsx)("button",{onClick:()=>P(!1),style:{padding:"8px 16px",background:"#ff0072",color:"white",border:"none",borderRadius:"4px",cursor:"pointer",width:"100%"},children:"Close"})]})]}),!D&&(0,c.jsxs)("div",{style:{width:"100%",height:"100%",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:"20px",overflow:"hidden"},children:[(0,c.jsx)("div",{style:{fontSize:"2em",marginBottom:"20px",transform:1!==B?"scale(".concat(B,")"):void 0,transformOrigin:N?"".concat(N.x,"% ").concat(N.y,"%"):"center center",transition:"transform 0.1s ease-out"},children:(null===ne||void 0===ne||null===(r=ne.data)||void 0===r?void 0:r.label)||"No content"}),"complexobject"===(null===ne||void 0===ne||null===(s=ne.data)||void 0===s?void 0:s.type)?(0,c.jsxs)("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"20px"},children:[(0,c.jsx)("div",{style:{maxWidth:"800px",width:"100%",height:"500px",transform:1!==B?"scale(".concat(B,")"):void 0,transformOrigin:N?"".concat(N.x,"% ").concat(N.y,"%"):"center center",transition:"transform 0.1s ease-out",background:"#f0f0f0",borderRadius:"8px",overflow:"hidden"},children:ne.data.splineScene&&(0,c.jsx)(dG,{scene:ne.data.splineScene,onLoad:e=>{J((t=>o(o({},t),{},{[ne.data.splineScene]:e})))}})}),(0,c.jsx)("div",{style:{fontSize:"1.5em",maxWidth:"800px",textAlign:"center",color:"#333"},children:(null===ne||void 0===ne||null===(a=ne.data)||void 0===a?void 0:a.label)||"No content"})]}):null,"image"===(null===ne||void 0===ne||null===(l=ne.data)||void 0===l?void 0:l.type)?(0,c.jsx)("div",{style:{maxWidth:"800px",width:"100%",marginBottom:"20px",transform:1!==B?"scale(".concat(B,")"):void 0,transformOrigin:N?"".concat(N.x,"% ").concat(N.y,"%"):"center center",transition:"transform 0.1s ease-out"},children:(0,c.jsx)("img",{src:ne.data.url,alt:ne.data.label,style:{width:"100%",height:"auto",borderRadius:"8px",boxShadow:"0 4px 12px rgba(0,0,0,0.1)"}})}):"video"===(null===ne||void 0===ne||null===(h=ne.data)||void 0===h?void 0:h.type)?(0,c.jsx)("div",{style:{maxWidth:"800px",width:"100%",marginBottom:"20px",transform:1!==B?"scale(".concat(B,")"):void 0,transformOrigin:N?"".concat(N.x,"% ").concat(N.y,"%"):"center center",transition:"transform 0.1s ease-out"},children:(0,c.jsx)("video",{ref:Q,src:ne.data.videoUrl,controls:!0,autoPlay:ne.data.autoplay,loop:ne.data.loop,style:{width:"100%",height:"auto",borderRadius:"8px",boxShadow:"0 4px 12px rgba(0,0,0,0.1)"}})}):"api"===(null===ne||void 0===ne||null===(u=ne.data)||void 0===u?void 0:u.type)?(0,c.jsxs)(c.Fragment,{children:[X&&(0,c.jsxs)("div",{style:{color:"#ff0072",padding:"10px",background:"#fff0f4",borderRadius:"4px",marginTop:"10px",maxWidth:"800px",width:"100%"},children:[(0,c.jsx)("strong",{children:"Error:"})," ",X]}),W&&(0,c.jsxs)("div",{style:{marginTop:"20px",maxWidth:"800px",width:"100%"},children:[(0,c.jsx)("div",{style:{fontWeight:"bold",marginBottom:"10px"},children:"API Response:"}),(0,c.jsx)("pre",{style:{background:"#f8f8f8",padding:"15px",borderRadius:"8px",overflow:"auto",maxHeight:"300px"},children:JSON.stringify(W,null,2)})]})]}):"complexobject"===(null===ne||void 0===ne||null===(d=ne.data)||void 0===d?void 0:d.type)?(0,c.jsxs)(c.Fragment,{children:[(null===(p=ne.data.rotationGesture)||void 0===p?void 0:p.left)&&(0,c.jsxs)("div",{style:{margin:"8px 0",padding:"8px",background:"white",borderRadius:"4px",display:"flex",alignItems:"center",gap:"10px"},children:[(0,c.jsx)("span",{style:{color:"#FF9800",fontWeight:"bold"},children:ne.data.rotationGesture.left}),(0,c.jsx)("span",{style:{color:"#666"},children:"\u2192"}),(0,c.jsx)("span",{children:"Rotate Left"})]}),(null===(f=ne.data.rotationGesture)||void 0===f?void 0:f.right)&&(0,c.jsxs)("div",{style:{margin:"8px 0",padding:"8px",background:"white",borderRadius:"4px",display:"flex",alignItems:"center",gap:"10px"},children:[(0,c.jsx)("span",{style:{color:"#FF9800",fontWeight:"bold"},children:ne.data.rotationGesture.right}),(0,c.jsx)("span",{style:{color:"#666"},children:"\u2192"}),(0,c.jsx)("span",{children:"Rotate Right"})]})]}):(0,c.jsx)("div",{style:{fontSize:"1.2em",marginBottom:"20px",whiteSpace:"pre-wrap",maxWidth:"800px",textAlign:"left"},children:null===ne||void 0===ne||null===(m=ne.data)||void 0===m?void 0:m.content}),I&&(0,c.jsxs)("div",{style:{marginTop:"20px",padding:"15px",background:"rgba(240,240,240,0.9)",borderRadius:"8px",maxWidth:"400px",width:"100%"},children:[(0,c.jsx)("div",{style:{fontWeight:"bold",marginBottom:"10px",color:"#666"},children:"Available Gestures:"}),we.map((e=>{var t,n;return(0,c.jsxs)("div",{style:{margin:"8px 0",padding:"8px",background:"white",borderRadius:"4px",display:"flex",alignItems:"center",gap:"10px"},children:[(0,c.jsx)("span",{style:{color:"#ff0072",fontWeight:"bold"},children:null===(t=e.data)||void 0===t?void 0:t.gesture}),(0,c.jsx)("span",{style:{color:"#666"},children:"\u2192"}),(0,c.jsx)("span",{children:null===(n=A.nodes.find((t=>t.id===e.target)))||void 0===n?void 0:n.data.label})]},e.id)})),(null===ne||void 0===ne||null===(g=ne.data)||void 0===g?void 0:g.pointerStartGesture)&&(0,c.jsxs)("div",{style:{margin:"8px 0",padding:"8px",background:"white",borderRadius:"4px",display:"flex",alignItems:"center",gap:"10px"},children:[(0,c.jsx)("span",{style:{color:"#4CAF50",fontWeight:"bold"},children:ne.data.pointerStartGesture}),(0,c.jsx)("span",{style:{color:"#666"},children:"\u2192"}),(0,c.jsxs)("span",{children:["Start ","laser"===ne.data.pointerMode?"Laser":"Drawing"," Pointer"]})]}),(null===ne||void 0===ne||null===(v=ne.data)||void 0===v?void 0:v.pointerStopGesture)&&(0,c.jsxs)("div",{style:{margin:"8px 0",padding:"8px",background:"white",borderRadius:"4px",display:"flex",alignItems:"center",gap:"10px"},children:[(0,c.jsx)("span",{style:{color:"#4CAF50",fontWeight:"bold"},children:ne.data.pointerStopGesture}),(0,c.jsx)("span",{style:{color:"#666"},children:"\u2192"}),(0,c.jsxs)("span",{children:["Stop ","laser"===ne.data.pointerMode?"Laser":"Drawing"," Pointer"]})]}),(null===ne||void 0===ne||null===(y=ne.data)||void 0===y?void 0:y.zoomInGesture)&&(0,c.jsxs)("div",{style:{margin:"8px 0",padding:"8px",background:"white",borderRadius:"4px",display:"flex",alignItems:"center",gap:"10px"},children:[(0,c.jsx)("span",{style:{color:"#2196F3",fontWeight:"bold"},children:ne.data.zoomInGesture}),(0,c.jsx)("span",{style:{color:"#666"},children:"\u2192"}),(0,c.jsx)("span",{children:"Zoom In"})]}),(null===ne||void 0===ne||null===(b=ne.data)||void 0===b?void 0:b.zoomOutGesture)&&(0,c.jsxs)("div",{style:{margin:"8px 0",padding:"8px",background:"white",borderRadius:"4px",display:"flex",alignItems:"center",gap:"10px"},children:[(0,c.jsx)("span",{style:{color:"#2196F3",fontWeight:"bold"},children:ne.data.zoomOutGesture}),(0,c.jsx)("span",{style:{color:"#666"},children:"\u2192"}),(0,c.jsx)("span",{children:"Zoom Out"})]}),"video"===(null===ne||void 0===ne||null===(x=ne.data)||void 0===x?void 0:x.type)&&(0,c.jsxs)(c.Fragment,{children:[ne.data.playPauseGesture&&(0,c.jsxs)("div",{style:{margin:"8px 0",padding:"8px",background:"white",borderRadius:"4px",display:"flex",alignItems:"center",gap:"10px"},children:[(0,c.jsx)("span",{style:{color:"#9C27B0",fontWeight:"bold"},children:ne.data.playPauseGesture}),(0,c.jsx)("span",{style:{color:"#666"},children:"\u2192"}),(0,c.jsx)("span",{children:"Play/Pause Video"})]}),ne.data.scrubForwardGesture&&(0,c.jsxs)("div",{style:{margin:"8px 0",padding:"8px",background:"white",borderRadius:"4px",display:"flex",alignItems:"center",gap:"10px"},children:[(0,c.jsx)("span",{style:{color:"#9C27B0",fontWeight:"bold"},children:ne.data.scrubForwardGesture}),(0,c.jsx)("span",{style:{color:"#666"},children:"\u2192"}),(0,c.jsx)("span",{children:"Fast Forward"})]}),ne.data.scrubBackwardGesture&&(0,c.jsxs)("div",{style:{margin:"8px 0",padding:"8px",background:"white",borderRadius:"4px",display:"flex",alignItems:"center",gap:"10px"},children:[(0,c.jsx)("span",{style:{color:"#9C27B0",fontWeight:"bold"},children:ne.data.scrubBackwardGesture}),(0,c.jsx)("span",{style:{color:"#666"},children:"\u2192"}),(0,c.jsx)("span",{children:"Rewind"})]})]})]})]}),j&&("laser"===de?(0,c.jsx)(C8,{color:(null===ne||void 0===ne||null===(w=ne.data)||void 0===w?void 0:w.pointerColor)||"#ff0000",size:(null===ne||void 0===ne||null===(S=ne.data)||void 0===S?void 0:S.pointerSize)||10}):(0,c.jsx)(T8,{color:(null===ne||void 0===ne||null===(_=ne.data)||void 0===_?void 0:_.pointerColor)||"#ff0000",size:(null===ne||void 0===ne||null===(E=ne.data)||void 0===E?void 0:E.pointerSize)||10}))]})})},O8=t=>{let{onGenerate:n,onClose:i}=t;const[r,s]=(0,e.useState)(""),[a,o]=(0,e.useState)("idle"),l=()=>(0,c.jsx)("div",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",backgroundColor:"rgba(255,255,255,0.9)",display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"8px"},children:(0,c.jsxs)("div",{style:{textAlign:"center"},children:[(0,c.jsx)("div",{className:"loading-spinner",style:{width:"40px",height:"40px",border:"4px solid #f3f3f3",borderTop:"4px solid #3498db",borderRadius:"50%",animation:"spin 1s linear infinite",margin:"0 auto 20px"}}),(0,c.jsx)("p",{style:{color:"#333",fontWeight:"bold"},children:"generating-workflow"===a?"Generating Presentation Workflow...":"Generating Images..."})]})});return(0,c.jsxs)("div",{style:{position:"fixed",top:0,left:0,width:"100%",height:"100%",backgroundColor:"rgba(0,0,0,0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3},children:[(0,c.jsxs)("div",{style:{background:"white",padding:"20px",borderRadius:"8px",width:"400px",position:"relative"},children:[(0,c.jsx)("h3",{children:"Generate Presentation"}),(0,c.jsx)("textarea",{value:r,onChange:e=>s(e.target.value),placeholder:"Topic...",style:{width:"100%",height:"100px",marginBottom:"10px"},disabled:"idle"!==a}),(0,c.jsxs)("div",{style:{display:"flex",justifyContent:"flex-end",gap:"10px"},children:[(0,c.jsx)("button",{onClick:i,disabled:"idle"!==a,children:"Cancel"}),(0,c.jsx)("button",{onClick:async()=>{try{o("generating-workflow"),await new Promise((e=>setTimeout(e,100))),await n(r)}finally{o("idle")}},disabled:"idle"!==a,children:"Generate"})]}),"idle"!==a&&(0,c.jsx)(l,{})]}),(0,c.jsx)("style",{children:"\n          @keyframes spin {\n            0% { transform: rotate(0deg); }\n            100% { transform: rotate(360deg); }\n          }\n        "})]})};const I8="RFC3986",R8={RFC1738:e=>String(e).replace(/%20/g,"+"),RFC3986:e=>String(e)},k8=(Object.prototype.hasOwnProperty,Array.isArray),L8=(()=>{const e=[];for(let t=0;t<256;++t)e.push("%"+((t<16?"0":"")+t.toString(16)).toUpperCase());return e})();const B8=1024;function z8(e,t){if(k8(e)){const n=[];for(let i=0;i<e.length;i+=1)n.push(t(e[i]));return n}return t(e)}const N8=Object.prototype.hasOwnProperty,F8={brackets:e=>String(e)+"[]",comma:"comma",indices:(e,t)=>String(e)+"["+t+"]",repeat:e=>String(e)},U8=Array.isArray,j8=Array.prototype.push,V8=function(e,t){j8.apply(e,U8(t)?t:[t])},G8=Date.prototype.toISOString,H8={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:"indices",charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encodeDotInKeys:!1,encoder:(e,t,n,i,r)=>{if(0===e.length)return e;let s=e;if("symbol"===typeof e?s=Symbol.prototype.toString.call(e):"string"!==typeof e&&(s=String(e)),"iso-8859-1"===n)return escape(s).replace(/%u[0-9a-f]{4}/gi,(function(e){return"%26%23"+parseInt(e.slice(2),16)+"%3B"}));let a="";for(let o=0;o<s.length;o+=B8){const e=s.length>=B8?s.slice(o,o+B8):s,t=[];for(let n=0;n<e.length;++n){let i=e.charCodeAt(n);45===i||46===i||95===i||126===i||i>=48&&i<=57||i>=65&&i<=90||i>=97&&i<=122||"RFC1738"===r&&(40===i||41===i)?t[t.length]=e.charAt(n):i<128?t[t.length]=L8[i]:i<2048?t[t.length]=L8[192|i>>6]+L8[128|63&i]:i<55296||i>=57344?t[t.length]=L8[224|i>>12]+L8[128|i>>6&63]+L8[128|63&i]:(n+=1,i=65536+((1023&i)<<10|1023&e.charCodeAt(n)),t[t.length]=L8[240|i>>18]+L8[128|i>>12&63]+L8[128|i>>6&63]+L8[128|63&i])}a+=t.join("")}return a},encodeValuesOnly:!1,format:I8,formatter:R8[I8],indices:!1,serializeDate:e=>G8.call(e),skipNulls:!1,strictNullHandling:!1};const W8={};function q8(e,t,n,i,r,s,a,o,l,c,h,u,d,p,f,m,g,v){let y=e,b=v,x=0,w=!1;for(;void 0!==(b=b.get(W8))&&!w;){const t=b.get(e);if(x+=1,"undefined"!==typeof t){if(t===x)throw new RangeError("Cyclic object value");w=!0}"undefined"===typeof b.get(W8)&&(x=0)}if("function"===typeof c?y=c(t,y):y instanceof Date?y=null===d||void 0===d?void 0:d(y):"comma"===n&&U8(y)&&(y=z8(y,(function(e){return e instanceof Date?null===d||void 0===d?void 0:d(e):e}))),null===y){if(s)return l&&!m?l(t,H8.encoder,g,"key",p):t;y=""}if(function(e){return"string"===typeof e||"number"===typeof e||"boolean"===typeof e||"symbol"===typeof e||"bigint"===typeof e}(y)||function(e){return!(!e||"object"!==typeof e)&&!!(e.constructor&&e.constructor.isBuffer&&e.constructor.isBuffer(e))}(y)){if(l){const e=m?t:l(t,H8.encoder,g,"key",p);return[(null===f||void 0===f?void 0:f(e))+"="+(null===f||void 0===f?void 0:f(l(y,H8.encoder,g,"value",p)))]}return[(null===f||void 0===f?void 0:f(t))+"="+(null===f||void 0===f?void 0:f(String(y)))]}const S=[];if("undefined"===typeof y)return S;let _;if("comma"===n&&U8(y))m&&l&&(y=z8(y,l)),_=[{value:y.length>0?y.join(",")||null:void 0}];else if(U8(c))_=c;else{const e=Object.keys(y);_=h?e.sort(h):e}const E=o?String(t).replace(/\./g,"%2E"):String(t),A=i&&U8(y)&&1===y.length?E+"[]":E;if(r&&U8(y)&&0===y.length)return A+"[]";for(let C=0;C<_.length;++C){const t=_[C],b="object"===typeof t&&"undefined"!==typeof t.value?t.value:y[t];if(a&&null===b)continue;const w=u&&o?t.replace(/\./g,"%2E"):t,E=U8(y)?"function"===typeof n?n(A,w):A:A+(u?"."+w:"["+w+"]");v.set(e,x);const M=new WeakMap;M.set(W8,v),V8(S,q8(b,E,n,i,r,s,a,o,"comma"===n&&m&&U8(y)?null:l,c,h,u,d,p,f,m,g,M))}return S}function X8(e){let t=e;const n=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:H8;if("undefined"!==typeof e.allowEmptyArrays&&"boolean"!==typeof e.allowEmptyArrays)throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if("undefined"!==typeof e.encodeDotInKeys&&"boolean"!==typeof e.encodeDotInKeys)throw new TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(null!==e.encoder&&"undefined"!==typeof e.encoder&&"function"!==typeof e.encoder)throw new TypeError("Encoder has to be a function.");const t=e.charset||H8.charset;if("undefined"!==typeof e.charset&&"utf-8"!==e.charset&&"iso-8859-1"!==e.charset)throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");let n=I8;if("undefined"!==typeof e.format){if(!N8.call(R8,e.format))throw new TypeError("Unknown format option provided.");n=e.format}const i=R8[n];let r,s=H8.filter;if(("function"===typeof e.filter||U8(e.filter))&&(s=e.filter),r=e.arrayFormat&&e.arrayFormat in F8?e.arrayFormat:"indices"in e?e.indices?"indices":"repeat":H8.arrayFormat,"commaRoundTrip"in e&&"boolean"!==typeof e.commaRoundTrip)throw new TypeError("`commaRoundTrip` must be a boolean, or absent");const a="undefined"===typeof e.allowDots?!0===!!e.encodeDotInKeys||H8.allowDots:!!e.allowDots;return{addQueryPrefix:"boolean"===typeof e.addQueryPrefix?e.addQueryPrefix:H8.addQueryPrefix,allowDots:a,allowEmptyArrays:"boolean"===typeof e.allowEmptyArrays?!!e.allowEmptyArrays:H8.allowEmptyArrays,arrayFormat:r,charset:t,charsetSentinel:"boolean"===typeof e.charsetSentinel?e.charsetSentinel:H8.charsetSentinel,commaRoundTrip:!!e.commaRoundTrip,delimiter:"undefined"===typeof e.delimiter?H8.delimiter:e.delimiter,encode:"boolean"===typeof e.encode?e.encode:H8.encode,encodeDotInKeys:"boolean"===typeof e.encodeDotInKeys?e.encodeDotInKeys:H8.encodeDotInKeys,encoder:"function"===typeof e.encoder?e.encoder:H8.encoder,encodeValuesOnly:"boolean"===typeof e.encodeValuesOnly?e.encodeValuesOnly:H8.encodeValuesOnly,filter:s,format:n,formatter:i,serializeDate:"function"===typeof e.serializeDate?e.serializeDate:H8.serializeDate,skipNulls:"boolean"===typeof e.skipNulls?e.skipNulls:H8.skipNulls,sort:"function"===typeof e.sort?e.sort:null,strictNullHandling:"boolean"===typeof e.strictNullHandling?e.strictNullHandling:H8.strictNullHandling}}(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{});let i,r;"function"===typeof n.filter?(r=n.filter,t=r("",t)):U8(n.filter)&&(r=n.filter,i=r);const s=[];if("object"!==typeof t||null===t)return"";const a=F8[n.arrayFormat],o="comma"===a&&n.commaRoundTrip;i||(i=Object.keys(t)),n.sort&&i.sort(n.sort);const l=new WeakMap;for(let u=0;u<i.length;++u){const e=i[u];n.skipNulls&&null===t[e]||V8(s,q8(t[e],e,a,o,n.allowEmptyArrays,n.strictNullHandling,n.skipNulls,n.encodeDotInKeys,n.encode?n.encoder:null,n.filter,n.sort,n.allowDots,n.serializeDate,n.format,n.formatter,n.encodeValuesOnly,n.charset,l))}const c=s.join(n.delimiter);let h=!0===n.addQueryPrefix?"?":"";return n.charsetSentinel&&("iso-8859-1"===n.charset?h+="utf8=%26%2310003%3B&":h+="utf8=%E2%9C%93&"),c.length>0?h+c:""}function Y8(e){var t,n,i,r=2;for("undefined"!=typeof Symbol&&(n=Symbol.asyncIterator,i=Symbol.iterator);r--;){if(n&&null!=(t=e[n]))return t.call(e);if(i&&null!=(t=e[i]))return new Q8(t.call(e));n="@@asyncIterator",i="@@iterator"}throw new TypeError("Object is not async iterable")}function Q8(e){function t(e){if(Object(e)!==e)return Promise.reject(new TypeError(e+" is not an object."));var t=e.done;return Promise.resolve(e.value).then((function(e){return{value:e,done:t}}))}return Q8=function(e){this.s=e,this.n=e.next},Q8.prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(e){var n=this.s.return;return void 0===n?Promise.resolve({value:e,done:!0}):t(n.apply(this.s,arguments))},throw:function(e){var n=this.s.return;return void 0===n?Promise.reject(e):t(n.apply(this.s,arguments))}},new Q8(e)}function K8(e,t){this.v=e,this.k=t}function Z8(e){return new K8(e,0)}function J8(e){return function(){return new $8(e.apply(this,arguments))}}function $8(e){var t,n;function i(t,n){try{var s=e[t](n),a=s.value,o=a instanceof K8;Promise.resolve(o?a.v:a).then((function(n){if(o){var l="return"===t?"return":"next";if(!a.k||n.done)return i(l,n);n=e[l](n).value}r(s.done?"return":"normal",n)}),(function(e){i("throw",e)}))}catch(e){r("throw",e)}}function r(e,r){switch(e){case"return":t.resolve({value:r,done:!0});break;case"throw":t.reject(r);break;default:t.resolve({value:r,done:!1})}(t=t.next)?i(t.key,t.arg):n=null}this._invoke=function(e,r){return new Promise((function(s,a){var o={key:e,arg:r,resolve:s,reject:a,next:null};n?n=n.next=o:(t=n=o,i(e,r))}))},"function"!=typeof e.return&&(this.return=void 0)}$8.prototype["function"==typeof Symbol&&Symbol.asyncIterator||"@@asyncIterator"]=function(){return this},$8.prototype.next=function(e){return this._invoke("next",e)},$8.prototype.throw=function(e){return this._invoke("throw",e)},$8.prototype.return=function(e){return this._invoke("return",e)};const e9="4.83.0";let t9,n9,i9,r9,s9,a9,o9,l9,c9,h9=!1,u9=null,d9=null,p9=null,f9=null;class m9{constructor(e){this.body=e}get[Symbol.toStringTag](){return"MultipartBody"}}t9||function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{auto:!1};if(h9)throw new Error("you must `import 'openai/shims/".concat(e.kind,"'` before importing anything else from openai"));if(t9)throw new Error("can't `import 'openai/shims/".concat(e.kind,"'` after `import 'openai/shims/").concat(t9,"'`"));h9=t.auto,t9=e.kind,n9=e.fetch,u9=e.Request,d9=e.Response,p9=e.Headers,i9=e.FormData,f9=e.Blob,r9=e.File,s9=e.ReadableStream,a9=e.getMultipartRequestOptions,o9=e.getDefaultAgent,l9=e.fileFromPath,c9=e.isFsReadStream}(function(){let{manuallyImported:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const t=e?"You may need to use polyfills":"Add one of these imports before your first `import \u2026 from 'openai'`:\n- `import 'openai/shims/node'` (if you're running on Node)\n- `import 'openai/shims/web'` (otherwise)\n";let n,i,r,s;try{n=fetch,i=Request,r=Response,s=Headers}catch(a){throw new Error("this environment is missing the following Web Fetch API type: ".concat(a.message,". ").concat(t))}return{kind:"web",fetch:n,Request:i,Response:r,Headers:s,FormData:"undefined"!==typeof FormData?FormData:class{constructor(){throw new Error("file uploads aren't supported in this environment yet as 'FormData' is undefined. ".concat(t))}},Blob:"undefined"!==typeof Blob?Blob:class{constructor(){throw new Error("file uploads aren't supported in this environment yet as 'Blob' is undefined. ".concat(t))}},File:"undefined"!==typeof File?File:class{constructor(){throw new Error("file uploads aren't supported in this environment yet as 'File' is undefined. ".concat(t))}},ReadableStream:"undefined"!==typeof ReadableStream?ReadableStream:class{constructor(){throw new Error("streaming isn't supported in this environment yet as 'ReadableStream' is undefined. ".concat(t))}},getMultipartRequestOptions:async(e,t)=>o(o({},t),{},{body:new m9(e)}),getDefaultAgent:e=>{},fileFromPath:()=>{throw new Error("The `fileFromPath` function is only supported in Node. See the README for more details: https://www.github.com/openai/openai-node#file-uploads")},isFsReadStream:e=>!1}}(),{auto:!0});class g9 extends Error{}class v9 extends g9{constructor(e,t,n,i){super("".concat(v9.makeMessage(e,t,n))),this.status=e,this.headers=i,this.request_id=null===i||void 0===i?void 0:i["x-request-id"],this.error=t;const r=t;this.code=null===r||void 0===r?void 0:r.code,this.param=null===r||void 0===r?void 0:r.param,this.type=null===r||void 0===r?void 0:r.type}static makeMessage(e,t,n){const i=null!==t&&void 0!==t&&t.message?"string"===typeof t.message?t.message:JSON.stringify(t.message):t?JSON.stringify(t):n;return e&&i?"".concat(e," ").concat(i):e?"".concat(e," status code (no body)"):i||"(no status code or body)"}static generate(e,t,n,i){if(!e||!i)return new b9({message:n,cause:y7(t)});const r=null===t||void 0===t?void 0:t.error;return 400===e?new w9(e,r,n,i):401===e?new S9(e,r,n,i):403===e?new _9(e,r,n,i):404===e?new E9(e,r,n,i):409===e?new A9(e,r,n,i):422===e?new C9(e,r,n,i):429===e?new M9(e,r,n,i):e>=500?new T9(e,r,n,i):new v9(e,r,n,i)}}class y9 extends v9{constructor(){let{message:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super(void 0,void 0,e||"Request was aborted.",void 0)}}class b9 extends v9{constructor(e){let{message:t,cause:n}=e;super(void 0,void 0,t||"Connection error.",void 0),n&&(this.cause=n)}}class x9 extends b9{constructor(){let{message:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super({message:null!==e&&void 0!==e?e:"Request timed out."})}}class w9 extends v9{}class S9 extends v9{}class _9 extends v9{}class E9 extends v9{}class A9 extends v9{}class C9 extends v9{}class M9 extends v9{}class T9 extends v9{}class P9 extends g9{constructor(){super("Could not parse response content as the length limit was reached")}}class D9 extends g9{constructor(){super("Could not parse response content as the request was rejected by the content filter")}}class O9{constructor(){this.buffer=[],this.trailingCR=!1}decode(e){let t=this.decodeText(e);if(this.trailingCR&&(t="\r"+t,this.trailingCR=!1),t.endsWith("\r")&&(this.trailingCR=!0,t=t.slice(0,-1)),!t)return[];const n=O9.NEWLINE_CHARS.has(t[t.length-1]||"");let i=t.split(O9.NEWLINE_REGEXP);return n&&i.pop(),1!==i.length||n?(this.buffer.length>0&&(i=[this.buffer.join("")+i[0],...i.slice(1)],this.buffer=[]),n||(this.buffer=[i.pop()||""]),i):(this.buffer.push(i[0]),[])}decodeText(e){if(null==e)return"";if("string"===typeof e)return e;if("undefined"!==typeof Buffer){if(e instanceof Buffer)return e.toString();if(e instanceof Uint8Array)return Buffer.from(e).toString();throw new g9("Unexpected: received non-Uint8Array (".concat(e.constructor.name,') stream chunk in an environment with a global "Buffer" defined, which this library assumes to be Node. Please report this error.'))}if("undefined"!==typeof TextDecoder){var t;if(e instanceof Uint8Array||e instanceof ArrayBuffer)return null!==(t=this.textDecoder)&&void 0!==t||(this.textDecoder=new TextDecoder("utf8")),this.textDecoder.decode(e);throw new g9("Unexpected: received non-Uint8Array/ArrayBuffer (".concat(e.constructor.name,") in a web platform. Please report this error."))}throw new g9("Unexpected: neither Buffer nor TextDecoder are available as globals. Please report this error.")}flush(){if(!this.buffer.length&&!this.trailingCR)return[];const e=[this.buffer.join("")];return this.buffer=[],this.trailingCR=!1,e}}function I9(e){if(e[Symbol.asyncIterator])return e;const t=e.getReader();return{async next(){try{const e=await t.read();return null!==e&&void 0!==e&&e.done&&t.releaseLock(),e}catch(LZ){throw t.releaseLock(),LZ}},async return(){const e=t.cancel();return t.releaseLock(),await e,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}O9.NEWLINE_CHARS=new Set(["\n","\r"]),O9.NEWLINE_REGEXP=/\r\n|[\n\r]/g;class R9{constructor(e,t){this.iterator=e,this.controller=t}static fromSSEResponse(e,t){let n=!1;function i(){return i=J8((function*(){if(n)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");n=!0;let i=!1;try{var r,s=!1,a=!1;try{for(var o,l=Y8(function(e,t){return k9.apply(this,arguments)}(e,t));s=!(o=yield Z8(l.next())).done;s=!1){const e=o.value;if(!i)if(e.data.startsWith("[DONE]"))i=!0;else if(null===e.event){let t;try{t=JSON.parse(e.data)}catch(LZ){throw console.error("Could not parse message into JSON:",e.data),console.error("From chunk:",e.raw),LZ}if(t&&t.error)throw new v9(void 0,t.error,void 0,void 0);yield t}else{let t;try{t=JSON.parse(e.data)}catch(LZ){throw console.error("Could not parse message into JSON:",e.data),console.error("From chunk:",e.raw),LZ}if("error"==e.event)throw new v9(void 0,t.error,t.message,void 0);yield{event:e.event,data:t}}}}catch(c){a=!0,r=c}finally{try{s&&null!=l.return&&(yield Z8(l.return()))}finally{if(a)throw r}}i=!0}catch(LZ){if(LZ instanceof Error&&"AbortError"===LZ.name)return;throw LZ}finally{i||t.abort()}})),i.apply(this,arguments)}return new R9((function(){return i.apply(this,arguments)}),t)}static fromReadableStream(e,t){let n=!1;function i(){return(i=J8((function*(){const t=new O9,n=I9(e);var i,r=!1,s=!1;try{for(var a,o=Y8(n);r=!(a=yield Z8(o.next())).done;r=!1){const e=a.value;for(const n of t.decode(e))yield n}}catch(l){s=!0,i=l}finally{try{r&&null!=o.return&&(yield Z8(o.return()))}finally{if(s)throw i}}for(const e of t.flush())yield e}))).apply(this,arguments)}function r(){return r=J8((function*(){if(n)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");n=!0;let e=!1;try{var r,s=!1,a=!1;try{for(var o,l=Y8(function(){return i.apply(this,arguments)}());s=!(o=yield Z8(l.next())).done;s=!1){const t=o.value;e||t&&(yield JSON.parse(t))}}catch(c){a=!0,r=c}finally{try{s&&null!=l.return&&(yield Z8(l.return()))}finally{if(a)throw r}}e=!0}catch(LZ){if(LZ instanceof Error&&"AbortError"===LZ.name)return;throw LZ}finally{e||t.abort()}})),r.apply(this,arguments)}return new R9((function(){return r.apply(this,arguments)}),t)}[Symbol.asyncIterator](){return this.iterator()}tee(){const e=[],t=[],n=this.iterator(),i=i=>({next:()=>{if(0===i.length){const i=n.next();e.push(i),t.push(i)}return i.shift()}});return[new R9((()=>i(e)),this.controller),new R9((()=>i(t)),this.controller)]}toReadableStream(){const e=this;let t;const n=new TextEncoder;return new s9({async start(){t=e[Symbol.asyncIterator]()},async pull(e){try{const{value:i,done:r}=await t.next();if(r)return e.close();const s=n.encode(JSON.stringify(i)+"\n");e.enqueue(s)}catch(i){e.error(i)}},async cancel(){var e,n;await(null===(e=(n=t).return)||void 0===e?void 0:e.call(n))}})}}function k9(){return k9=J8((function*(e,t){if(!e.body)throw t.abort(),new g9("Attempted to iterate over a response with no body");const n=new z9,i=new O9,r=I9(e.body);var s,a=!1,o=!1;try{for(var l,c=Y8(function(e){return L9.apply(this,arguments)}(r));a=!(l=yield Z8(c.next())).done;a=!1){const e=l.value;for(const t of i.decode(e)){const e=n.decode(t);e&&(yield e)}}}catch(h){o=!0,s=h}finally{try{a&&null!=c.return&&(yield Z8(c.return()))}finally{if(o)throw s}}for(const u of i.flush()){const e=n.decode(u);e&&(yield e)}})),k9.apply(this,arguments)}function L9(){return L9=J8((function*(e){let t=new Uint8Array;var n,i=!1,r=!1;try{for(var s,a=Y8(e);i=!(s=yield Z8(a.next())).done;i=!1){const e=s.value;{if(null==e)continue;const n=e instanceof ArrayBuffer?new Uint8Array(e):"string"===typeof e?(new TextEncoder).encode(e):e;let i,r=new Uint8Array(t.length+n.length);for(r.set(t),r.set(n,t.length),t=r;-1!==(i=B9(t));)yield t.slice(0,i),t=t.slice(i)}}}catch(o){r=!0,n=o}finally{try{i&&null!=a.return&&(yield Z8(a.return()))}finally{if(r)throw n}}t.length>0&&(yield t)})),L9.apply(this,arguments)}function B9(e){for(let t=0;t<e.length-2;t++){if(10===e[t]&&10===e[t+1])return t+2;if(13===e[t]&&13===e[t+1])return t+2;if(13===e[t]&&10===e[t+1]&&t+3<e.length&&13===e[t+2]&&10===e[t+3])return t+4}return-1}class z9{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;const e={event:this.event,data:this.data.join("\n"),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],e}if(this.chunks.push(e),e.startsWith(":"))return null;let[t,n,i]=function(e,t){const n=e.indexOf(t);if(-1!==n)return[e.substring(0,n),t,e.substring(n+t.length)];return[e,"",""]}(e,":");return i.startsWith(" ")&&(i=i.substring(1)),"event"===t?this.event=i:"data"===t&&this.data.push(i),null}}const N9=e=>null!=e&&"object"===typeof e&&"string"===typeof e.url&&"function"===typeof e.blob,F9=e=>null!=e&&"object"===typeof e&&"string"===typeof e.name&&"number"===typeof e.lastModified&&U9(e),U9=e=>null!=e&&"object"===typeof e&&"number"===typeof e.size&&"string"===typeof e.type&&"function"===typeof e.text&&"function"===typeof e.slice&&"function"===typeof e.arrayBuffer,j9=e=>F9(e)||N9(e)||c9(e);async function V9(e,t,n){var i,r;if(e=await e,F9(e))return e;if(N9(e)){var s;const i=await e.blob();t||(t=null!==(s=new URL(e.url).pathname.split(/[\\/]/).pop())&&void 0!==s?s:"unknown_file");const r=U9(i)?[await i.arrayBuffer()]:[i];return new r9(r,t,n)}const a=await async function(e){let t=[];if("string"===typeof e||ArrayBuffer.isView(e)||e instanceof ArrayBuffer)t.push(e);else if(U9(e))t.push(await e.arrayBuffer());else{var n;if(!H9(e))throw new Error("Unexpected data type: ".concat(typeof e,"; constructor: ").concat(null===e||void 0===e||null===(n=e.constructor)||void 0===n?void 0:n.name,"; props: ").concat(function(e){const t=Object.getOwnPropertyNames(e);return"[".concat(t.map((e=>'"'.concat(e,'"'))).join(", "),"]")}(e)));var i,r=!1,s=!1;try{for(var a,o=Y8(e);r=!(a=await o.next()).done;r=!1){const e=a.value;t.push(e)}}catch(l){s=!0,i=l}finally{try{r&&null!=o.return&&await o.return()}finally{if(s)throw i}}}return t}(e);if(t||(t=null!==(i=function(e){var t;return G9(e.name)||G9(e.filename)||(null===(t=G9(e.path))||void 0===t?void 0:t.split(/[\\/]/).pop())}(e))&&void 0!==i?i:"unknown_file"),null===(r=n)||void 0===r||!r.type){var l;const e=null===(l=a[0])||void 0===l?void 0:l.type;"string"===typeof e&&(n=o(o({},n),{},{type:e}))}return new r9(a,t,n)}const G9=e=>"string"===typeof e?e:"undefined"!==typeof Buffer&&e instanceof Buffer?String(e):void 0,H9=e=>null!=e&&"object"===typeof e&&"function"===typeof e[Symbol.asyncIterator],W9=e=>e&&"object"===typeof e&&e.body&&"MultipartBody"===e[Symbol.toStringTag],q9=async e=>{const t=await X9(e.body);return a9(t,e)},X9=async e=>{const t=new i9;return await Promise.all(Object.entries(e||{}).map((e=>{let[n,i]=e;return Y9(t,n,i)}))),t},Y9=async(e,t,n)=>{if(void 0!==n){if(null==n)throw new TypeError('Received null for "'.concat(t,"\"; to pass null in FormData, you must use the string 'null'"));if("string"===typeof n||"number"===typeof n||"boolean"===typeof n)e.append(t,String(n));else if(j9(n)){const i=await V9(n);e.append(t,i)}else if(Array.isArray(n))await Promise.all(n.map((n=>Y9(e,t+"[]",n))));else{if("object"!==typeof n)throw new TypeError("Invalid value given to form, expected a string, number, boolean, object, Array, File or Blob but got ".concat(n," instead"));await Promise.all(Object.entries(n).map((n=>{let[i,r]=n;return Y9(e,"".concat(t,"[").concat(i,"]"),r)})))}}},Q9=["signal"];var K9,Z9=function(e,t,n,i,r){if("m"===i)throw new TypeError("Private method is not writable");if("a"===i&&!r)throw new TypeError("Private accessor was defined without a setter");if("function"===typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===i?r.call(e,n):r?r.value=n:t.set(e,n),n},J9=function(e,t,n,i){if("a"===n&&!i)throw new TypeError("Private accessor was defined without a getter");if("function"===typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?i:"a"===n?i.call(e):i?i.value:t.get(e)};async function $9(e){const{response:t}=e;if(e.options.stream)return E7("response",t.status,t.url,t.headers,t.body),e.options.__streamClass?e.options.__streamClass.fromSSEResponse(t,e.controller):R9.fromSSEResponse(t,e.controller);if(204===t.status)return null;if(e.options.__binaryResponse)return t;const n=t.headers.get("content-type");if((null===n||void 0===n?void 0:n.includes("application/json"))||(null===n||void 0===n?void 0:n.includes("application/vnd.api+json"))){const e=await t.json();return E7("response",t.status,t.url,t.headers,e),e7(e,t)}const i=await t.text();return E7("response",t.status,t.url,t.headers,i),i}function e7(e,t){return!e||"object"!==typeof e||Array.isArray(e)?e:Object.defineProperty(e,"_request_id",{value:t.headers.get("x-request-id"),enumerable:!1})}class t7 extends Promise{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:$9;super((e=>{e(null)})),this.responsePromise=e,this.parseResponse=t}_thenUnwrap(e){return new t7(this.responsePromise,(async t=>e7(e(await this.parseResponse(t),t),t.response)))}asResponse(){return this.responsePromise.then((e=>e.response))}async withResponse(){const[e,t]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:t,request_id:t.headers.get("x-request-id")}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(this.parseResponse)),this.parsedPromise}then(e,t){return this.parse().then(e,t)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}}class n7{constructor(e){let{baseURL:t,maxRetries:n=2,timeout:i=6e5,httpAgent:r,fetch:s}=e;this.baseURL=t,this.maxRetries=v7("maxRetries",n),this.timeout=v7("timeout",i),this.httpAgent=r,this.fetch=null!==s&&void 0!==s?s:n9}authHeaders(e){return{}}defaultHeaders(e){return o(o({Accept:"application/json","Content-Type":"application/json","User-Agent":this.getUserAgent()},d7()),this.authHeaders(e))}validateHeaders(e,t){}defaultIdempotencyKey(){return"stainless-node-retry-".concat(A7())}get(e,t){return this.methodRequest("get",e,t)}post(e,t){return this.methodRequest("post",e,t)}patch(e,t){return this.methodRequest("patch",e,t)}put(e,t){return this.methodRequest("put",e,t)}delete(e,t){return this.methodRequest("delete",e,t)}methodRequest(e,t,n){return this.request(Promise.resolve(n).then((async n=>{const i=n&&U9(null===n||void 0===n?void 0:n.body)?new DataView(await n.body.arrayBuffer()):(null===n||void 0===n?void 0:n.body)instanceof DataView?n.body:(null===n||void 0===n?void 0:n.body)instanceof ArrayBuffer?new DataView(n.body):n&&ArrayBuffer.isView(null===n||void 0===n?void 0:n.body)?new DataView(n.body.buffer):null===n||void 0===n?void 0:n.body;return o(o({method:e,path:t},n),{},{body:i})})))}getAPIList(e,t,n){return this.requestAPIList(t,o({method:"get",path:e},n))}calculateContentLength(e){if("string"===typeof e){if("undefined"!==typeof Buffer)return Buffer.byteLength(e,"utf8").toString();if("undefined"!==typeof TextEncoder){return(new TextEncoder).encode(e).length.toString()}}else if(ArrayBuffer.isView(e))return e.byteLength.toString();return null}buildRequest(e){var t,n,i,r,s,a;let{retryCount:l=0}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};e=o({},e);const{method:c,path:h,query:u,headers:d={}}=e,p=ArrayBuffer.isView(e.body)||e.__binaryRequest&&"string"===typeof e.body?e.body:W9(e.body)?e.body.body:e.body?JSON.stringify(e.body,null,2):null,f=this.calculateContentLength(p),m=this.buildURL(h,u);"timeout"in e&&v7("timeout",e.timeout),e.timeout=null!==(t=e.timeout)&&void 0!==t?t:this.timeout;const g=null!==(n=null!==(i=e.httpAgent)&&void 0!==i?i:this.httpAgent)&&void 0!==n?n:o9(m),v=e.timeout+1e3;"number"===typeof(null===g||void 0===g||null===(r=g.options)||void 0===r?void 0:r.timeout)&&v>(null!==(s=g.options.timeout)&&void 0!==s?s:0)&&(g.options.timeout=v),this.idempotencyHeader&&"get"!==c&&(e.idempotencyKey||(e.idempotencyKey=this.defaultIdempotencyKey()),d[this.idempotencyHeader]=e.idempotencyKey);const y=this.buildHeaders({options:e,headers:d,contentLength:f,retryCount:l});return{req:o(o(o({method:c},p&&{body:p}),{},{headers:y},g&&{agent:g}),{},{signal:null!==(a=e.signal)&&void 0!==a?a:null}),url:m,timeout:e.timeout}}buildHeaders(e){let{options:t,headers:n,contentLength:i,retryCount:r}=e;const s={};i&&(s["content-length"]=i);const a=this.defaultHeaders(t);return S7(s,a),S7(s,n),W9(t.body)&&"node"!==t9&&delete s["content-type"],void 0===C7(a,"x-stainless-retry-count")&&void 0===C7(n,"x-stainless-retry-count")&&(s["x-stainless-retry-count"]=String(r)),void 0===C7(a,"x-stainless-timeout")&&void 0===C7(n,"x-stainless-timeout")&&t.timeout&&(s["x-stainless-timeout"]=String(t.timeout)),this.validateHeaders(s,n),s}async prepareOptions(e){}async prepareRequest(e,t){let{url:n,options:i}=t}parseHeaders(e){return e?Symbol.iterator in e?Object.fromEntries(Array.from(e).map((e=>[...e]))):o({},e):{}}makeStatusError(e,t,n,i){return v9.generate(e,t,n,i)}request(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return new t7(this.makeRequest(e,t))}async makeRequest(e,t){var n,i;const r=await e,s=null!==(n=r.maxRetries)&&void 0!==n?n:this.maxRetries;null==t&&(t=s),await this.prepareOptions(r);const{req:a,url:o,timeout:l}=this.buildRequest(r,{retryCount:s-t});if(await this.prepareRequest(a,{url:o,options:r}),E7("request",o,r,a.headers),null!==(i=r.signal)&&void 0!==i&&i.aborted)throw new y9;const c=new AbortController,h=await this.fetchWithTimeout(o,a,l,c).catch(y7);if(h instanceof Error){var u;if(null!==(u=r.signal)&&void 0!==u&&u.aborted)throw new y9;if(t)return this.retryRequest(r,t);if("AbortError"===h.name)throw new x9;throw new b9({cause:h})}const d=s7(h.headers);if(!h.ok){if(t&&this.shouldRetry(h)){const e="retrying, ".concat(t," attempts remaining");return E7("response (error; ".concat(e,")"),h.status,o,d),this.retryRequest(r,t,d)}const e=await h.text().catch((e=>y7(e).message)),n=p7(e),i=n?void 0:e;E7("response (error; ".concat(t?"(error; no more retries left)":"(error; not retryable)",")"),h.status,o,d,i);throw this.makeStatusError(h.status,n,i,d)}return{response:h,options:r,controller:c}}requestAPIList(e,t){const n=this.makeRequest(t,null);return new r7(this,n,e)}buildURL(e,t){const n=m7(e)?new URL(e):new URL(this.baseURL+(this.baseURL.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),i=this.defaultQuery();return x7(i)||(t=o(o({},i),t)),"object"===typeof t&&t&&!Array.isArray(t)&&(n.search=this.stringifyQuery(t)),n.toString()}stringifyQuery(e){return Object.entries(e).filter((e=>{let[t,n]=e;return"undefined"!==typeof n})).map((e=>{let[t,n]=e;if("string"===typeof n||"number"===typeof n||"boolean"===typeof n)return"".concat(encodeURIComponent(t),"=").concat(encodeURIComponent(n));if(null===n)return"".concat(encodeURIComponent(t),"=");throw new g9("Cannot stringify type ".concat(typeof n,"; Expected string, number, boolean, or null. If you need to pass nested query parameters, you can manually encode them, e.g. { query: { 'foo[key1]': value1, 'foo[key2]': value2 } }, and please open a GitHub issue requesting better support for your use case."))})).join("&")}async fetchWithTimeout(e,t,n,i){const r=t||{},{signal:s}=r,a=l(r,Q9);s&&s.addEventListener("abort",(()=>i.abort()));const c=setTimeout((()=>i.abort()),n),h=o({signal:i.signal},a);return h.method&&(h.method=h.method.toUpperCase()),this.fetch.call(void 0,e,h).finally((()=>{clearTimeout(c)}))}shouldRetry(e){const t=e.headers.get("x-should-retry");return"true"===t||"false"!==t&&(408===e.status||(409===e.status||(429===e.status||e.status>=500)))}async retryRequest(e,t,n){let i;const r=null===n||void 0===n?void 0:n["retry-after-ms"];if(r){const e=parseFloat(r);Number.isNaN(e)||(i=e)}const s=null===n||void 0===n?void 0:n["retry-after"];if(s&&!i){const e=parseFloat(s);i=Number.isNaN(e)?Date.parse(s)-Date.now():1e3*e}if(!(i&&0<=i&&i<6e4)){var a;const n=null!==(a=e.maxRetries)&&void 0!==a?a:this.maxRetries;i=this.calculateDefaultRetryTimeoutMillis(t,n)}return await g7(i),this.makeRequest(e,t-1)}calculateDefaultRetryTimeoutMillis(e,t){const n=t-e;return Math.min(.5*Math.pow(2,n),8)*(1-.25*Math.random())*1e3}getUserAgent(){return"".concat(this.constructor.name,"/JS ").concat(e9)}}class i7{constructor(e,t,n,i){K9.set(this,void 0),Z9(this,K9,e,"f"),this.options=i,this.response=t,this.body=n}hasNextPage(){return!!this.getPaginatedItems().length&&null!=this.nextPageInfo()}async getNextPage(){const e=this.nextPageInfo();if(!e)throw new g9("No next page expected; please check `.hasNextPage()` before calling `.getNextPage()`.");const t=o({},this.options);if("params"in e&&"object"===typeof t.query)t.query=o(o({},t.query),e.params);else if("url"in e){const n=[...Object.entries(t.query||{}),...e.url.searchParams.entries()];for(const[t,i]of n)e.url.searchParams.set(t,i);t.query=void 0,t.path=e.url.toString()}return await J9(this,K9,"f").requestAPIList(this.constructor,t)}iterPages(){var e=this;return J8((function*(){let t=e;for(yield t;t.hasNextPage();)t=yield Z8(t.getNextPage()),yield t}))()}[(K9=new WeakMap,Symbol.asyncIterator)](){var e=this;return J8((function*(){var t,n=!1,i=!1;try{for(var r,s=Y8(e.iterPages());n=!(r=yield Z8(s.next())).done;n=!1){const e=r.value;for(const t of e.getPaginatedItems())yield t}}catch(a){i=!0,t=a}finally{try{n&&null!=s.return&&(yield Z8(s.return()))}finally{if(i)throw t}}}))()}}class r7 extends t7{constructor(e,t,n){super(t,(async t=>new n(e,t.response,await $9(t),t.options)))}[Symbol.asyncIterator](){var e=this;return J8((function*(){const t=yield Z8(e);var n,i=!1,r=!1;try{for(var s,a=Y8(t);i=!(s=yield Z8(a.next())).done;i=!1){const e=s.value;yield e}}catch(o){r=!0,n=o}finally{try{i&&null!=a.return&&(yield Z8(a.return()))}finally{if(r)throw n}}}))()}}const s7=e=>new Proxy(Object.fromEntries(e.entries()),{get(e,t){const n=t.toString();return e[n.toLowerCase()]||e[n]}}),a7={method:!0,path:!0,query:!0,body:!0,headers:!0,maxRetries:!0,stream:!0,timeout:!0,httpAgent:!0,signal:!0,idempotencyKey:!0,__metadata:!0,__binaryRequest:!0,__binaryResponse:!0,__streamClass:!0},o7=e=>"object"===typeof e&&null!==e&&!x7(e)&&Object.keys(e).every((e=>w7(a7,e))),l7=()=>{var e,t;if("undefined"!==typeof Deno&&null!=Deno.build)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":e9,"X-Stainless-OS":h7(Deno.build.os),"X-Stainless-Arch":c7(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":"string"===typeof Deno.version?Deno.version:null!==(e=null===(t=Deno.version)||void 0===t?void 0:t.deno)&&void 0!==e?e:"unknown"};if("undefined"!==typeof EdgeRuntime)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":e9,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"other:".concat(EdgeRuntime),"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":process.version};if("[object process]"===Object.prototype.toString.call("undefined"!==typeof process?process:0))return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":e9,"X-Stainless-OS":h7(process.platform),"X-Stainless-Arch":c7(process.arch),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":process.version};const n=function(){if("undefined"===typeof navigator||!navigator)return null;const e=[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}];for(const{key:t,pattern:n}of e){const e=n.exec(navigator.userAgent);if(e){const n=e[1]||0,i=e[2]||0,r=e[3]||0;return{browser:t,version:"".concat(n,".").concat(i,".").concat(r)}}}return null}();return n?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":e9,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"browser:".concat(n.browser),"X-Stainless-Runtime-Version":n.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":e9,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}};const c7=e=>"x32"===e?"x32":"x86_64"===e||"x64"===e?"x64":"arm"===e?"arm":"aarch64"===e||"arm64"===e?"arm64":e?"other:".concat(e):"unknown",h7=e=>(e=e.toLowerCase()).includes("ios")?"iOS":"android"===e?"Android":"darwin"===e?"MacOS":"win32"===e?"Windows":"freebsd"===e?"FreeBSD":"openbsd"===e?"OpenBSD":"linux"===e?"Linux":e?"Other:".concat(e):"Unknown";let u7;const d7=()=>null!==u7&&void 0!==u7?u7:u7=l7(),p7=e=>{try{return JSON.parse(e)}catch(t){return}},f7=/^[a-z][a-z0-9+.-]*:/i,m7=e=>f7.test(e),g7=e=>new Promise((t=>setTimeout(t,e))),v7=(e,t)=>{if("number"!==typeof t||!Number.isInteger(t))throw new g9("".concat(e," must be an integer"));if(t<0)throw new g9("".concat(e," must be a positive integer"));return t},y7=e=>{if(e instanceof Error)return e;if("object"===typeof e&&null!==e)try{return new Error(JSON.stringify(e))}catch(t){}return new Error(e)},b7=e=>{var t,n,i,r;return"undefined"!==typeof process?null!==(t=null===(n={NODE_ENV:"production",PUBLIC_URL:"/SignWave",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0})||void 0===n||null===(n=n[e])||void 0===n?void 0:n.trim())&&void 0!==t?t:void 0:"undefined"!==typeof Deno?null===(i=Deno.env)||void 0===i||null===(r=i.get)||void 0===r||null===(r=r.call(i,e))||void 0===r?void 0:r.trim():void 0};function x7(e){if(!e)return!0;for(const t in e)return!1;return!0}function w7(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function S7(e,t){for(const n in t){if(!w7(t,n))continue;const i=n.toLowerCase();if(!i)continue;const r=t[n];null===r?delete e[i]:void 0!==r&&(e[i]=r)}}const _7=new Set(["authorization","api-key"]);function E7(e){var t;if("undefined"!==typeof process&&"true"===(null===(t=process)||void 0===t||null===(t={NODE_ENV:"production",PUBLIC_URL:"/SignWave",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0})||void 0===t?void 0:t.DEBUG)){for(var n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];const t=i.map((e=>{if(!e)return e;if(e.headers){const t=o(o({},e),{},{headers:o({},e.headers)});for(const n in e.headers)_7.has(n.toLowerCase())&&(t.headers[n]="REDACTED");return t}let t=null;for(const n in e)_7.has(n.toLowerCase())&&(null!==t&&void 0!==t||(t=o({},e)),t[n]="REDACTED");return null!==t&&void 0!==t?t:e}));console.log("OpenAI:DEBUG:".concat(e),...t)}}const A7=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(e=>{const t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})),C7=(e,t)=>{const n=t.toLowerCase();if((e=>"function"===typeof(null===e||void 0===e?void 0:e.get))(e)){var i;const r=(null===(i=t[0])||void 0===i?void 0:i.toUpperCase())+t.substring(1).replace(/([^\w])(\w)/g,((e,t,n)=>t+n.toUpperCase()));for(const i of[t,n,t.toUpperCase(),r]){const t=e.get(i);if(t)return t}}for(const[r,s]of Object.entries(e))if(r.toLowerCase()===n)return Array.isArray(s)?(s.length<=1||console.warn("Received ".concat(s.length," entries for the ").concat(t," header, using the first entry.")),s[0]):s};function M7(e){return null!=e&&"object"===typeof e&&!Array.isArray(e)}class T7{constructor(e){this._client=e}}class P7 extends T7{create(e,t){var n;return this._client.post("/completions",o(o({body:e},t),{},{stream:null!==(n=e.stream)&&void 0!==n&&n}))}}class D7 extends T7{create(e,t){var n;return this._client.post("/chat/completions",o(o({body:e},t),{},{stream:null!==(n=e.stream)&&void 0!==n&&n}))}}class O7 extends T7{constructor(){super(...arguments),this.completions=new D7(this._client)}}O7.Completions=D7;class I7 extends T7{create(e,t){return this._client.post("/embeddings",o({body:e},t))}}class R7 extends i7{constructor(e,t,n,i){super(e,t,n,i),this.data=n.data||[],this.object=n.object}getPaginatedItems(){var e;return null!==(e=this.data)&&void 0!==e?e:[]}nextPageParams(){return null}nextPageInfo(){return null}}class k7 extends i7{constructor(e,t,n,i){super(e,t,n,i),this.data=n.data||[]}getPaginatedItems(){var e;return null!==(e=this.data)&&void 0!==e?e:[]}nextPageParams(){const e=this.nextPageInfo();if(!e)return null;if("params"in e)return e.params;const t=Object.fromEntries(e.url.searchParams);return Object.keys(t).length?t:null}nextPageInfo(){var e;const t=this.getPaginatedItems();if(!t.length)return null;const n=null===(e=t[t.length-1])||void 0===e?void 0:e.id;return n?{params:{after:n}}:null}}class L7 extends T7{create(e,t){return this._client.post("/files",q9(o({body:e},t)))}retrieve(e,t){return this._client.get("/files/".concat(e),t)}list(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;return o7(e)?this.list({},e):this._client.getAPIList("/files",B7,o({query:e},t))}del(e,t){return this._client.delete("/files/".concat(e),t)}content(e,t){return this._client.get("/files/".concat(e,"/content"),o(o({},t),{},{headers:o({Accept:"application/binary"},null===t||void 0===t?void 0:t.headers),__binaryResponse:!0}))}retrieveContent(e,t){return this._client.get("/files/".concat(e,"/content"),t)}async waitForProcessing(e){let{pollInterval:t=5e3,maxWait:n=18e5}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const i=new Set(["processed","error","deleted"]),r=Date.now();let s=await this.retrieve(e);for(;!s.status||!i.has(s.status);)if(await g7(t),s=await this.retrieve(e),Date.now()-r>n)throw new x9({message:"Giving up on waiting for file ".concat(e," to finish processing after ").concat(n," milliseconds.")});return s}}class B7 extends k7{}L7.FileObjectsPage=B7;class z7 extends T7{createVariation(e,t){return this._client.post("/images/variations",q9(o({body:e},t)))}edit(e,t){return this._client.post("/images/edits",q9(o({body:e},t)))}generate(e,t){return this._client.post("/images/generations",o({body:e},t))}}class N7 extends T7{create(e,t){return this._client.post("/audio/speech",o(o({body:e},t),{},{headers:o({Accept:"application/octet-stream"},null===t||void 0===t?void 0:t.headers),__binaryResponse:!0}))}}class F7 extends T7{create(e,t){return this._client.post("/audio/transcriptions",q9(o(o({body:e},t),{},{__metadata:{model:e.model}})))}}class U7 extends T7{create(e,t){return this._client.post("/audio/translations",q9(o(o({body:e},t),{},{__metadata:{model:e.model}})))}}class j7 extends T7{constructor(){super(...arguments),this.transcriptions=new F7(this._client),this.translations=new U7(this._client),this.speech=new N7(this._client)}}j7.Transcriptions=F7,j7.Translations=U7,j7.Speech=N7;class V7 extends T7{create(e,t){return this._client.post("/moderations",o({body:e},t))}}class G7 extends T7{retrieve(e,t){return this._client.get("/models/".concat(e),t)}list(e){return this._client.getAPIList("/models",H7,e)}del(e,t){return this._client.delete("/models/".concat(e),t)}}class H7 extends R7{}G7.ModelsPage=H7;class W7 extends T7{list(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0;return o7(t)?this.list(e,{},t):this._client.getAPIList("/fine_tuning/jobs/".concat(e,"/checkpoints"),q7,o({query:t},n))}}class q7 extends k7{}W7.FineTuningJobCheckpointsPage=q7;class X7 extends T7{constructor(){super(...arguments),this.checkpoints=new W7(this._client)}create(e,t){return this._client.post("/fine_tuning/jobs",o({body:e},t))}retrieve(e,t){return this._client.get("/fine_tuning/jobs/".concat(e),t)}list(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;return o7(e)?this.list({},e):this._client.getAPIList("/fine_tuning/jobs",Y7,o({query:e},t))}cancel(e,t){return this._client.post("/fine_tuning/jobs/".concat(e,"/cancel"),t)}listEvents(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0;return o7(t)?this.listEvents(e,{},t):this._client.getAPIList("/fine_tuning/jobs/".concat(e,"/events"),Q7,o({query:t},n))}}class Y7 extends k7{}class Q7 extends k7{}X7.FineTuningJobsPage=Y7,X7.FineTuningJobEventsPage=Q7,X7.Checkpoints=W7,X7.FineTuningJobCheckpointsPage=q7;class K7 extends T7{constructor(){super(...arguments),this.jobs=new X7(this._client)}}K7.Jobs=X7,K7.FineTuningJobsPage=Y7,K7.FineTuningJobEventsPage=Q7;class Z7 extends T7{create(e,t){return this._client.post("/assistants",o(o({body:e},t),{},{headers:o({"OpenAI-Beta":"assistants=v2"},null===t||void 0===t?void 0:t.headers)}))}retrieve(e,t){return this._client.get("/assistants/".concat(e),o(o({},t),{},{headers:o({"OpenAI-Beta":"assistants=v2"},null===t||void 0===t?void 0:t.headers)}))}update(e,t,n){return this._client.post("/assistants/".concat(e),o(o({body:t},n),{},{headers:o({"OpenAI-Beta":"assistants=v2"},null===n||void 0===n?void 0:n.headers)}))}list(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;return o7(e)?this.list({},e):this._client.getAPIList("/assistants",J7,o(o({query:e},t),{},{headers:o({"OpenAI-Beta":"assistants=v2"},null===t||void 0===t?void 0:t.headers)}))}del(e,t){return this._client.delete("/assistants/".concat(e),o(o({},t),{},{headers:o({"OpenAI-Beta":"assistants=v2"},null===t||void 0===t?void 0:t.headers)}))}}class J7 extends k7{}function $7(e){return"function"===typeof e.parse}Z7.AssistantsPage=J7;const eee=e=>"assistant"===(null===e||void 0===e?void 0:e.role),tee=e=>"function"===(null===e||void 0===e?void 0:e.role),nee=e=>"tool"===(null===e||void 0===e?void 0:e.role);var iee,ree,see,aee,oee,lee,cee,hee,uee,dee,pee,fee,mee,gee=function(e,t,n,i,r){if("m"===i)throw new TypeError("Private method is not writable");if("a"===i&&!r)throw new TypeError("Private accessor was defined without a setter");if("function"===typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===i?r.call(e,n):r?r.value=n:t.set(e,n),n},vee=function(e,t,n,i){if("a"===n&&!i)throw new TypeError("Private accessor was defined without a getter");if("function"===typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?i:"a"===n?i.call(e):i?i.value:t.get(e)};class yee{constructor(){iee.add(this),this.controller=new AbortController,ree.set(this,void 0),see.set(this,(()=>{})),aee.set(this,(()=>{})),oee.set(this,void 0),lee.set(this,(()=>{})),cee.set(this,(()=>{})),hee.set(this,{}),uee.set(this,!1),dee.set(this,!1),pee.set(this,!1),fee.set(this,!1),gee(this,ree,new Promise(((e,t)=>{gee(this,see,e,"f"),gee(this,aee,t,"f")})),"f"),gee(this,oee,new Promise(((e,t)=>{gee(this,lee,e,"f"),gee(this,cee,t,"f")})),"f"),vee(this,ree,"f").catch((()=>{})),vee(this,oee,"f").catch((()=>{}))}_run(e){setTimeout((()=>{e().then((()=>{this._emitFinal(),this._emit("end")}),vee(this,iee,"m",mee).bind(this))}),0)}_connected(){this.ended||(vee(this,see,"f").call(this),this._emit("connect"))}get ended(){return vee(this,uee,"f")}get errored(){return vee(this,dee,"f")}get aborted(){return vee(this,pee,"f")}abort(){this.controller.abort()}on(e,t){return(vee(this,hee,"f")[e]||(vee(this,hee,"f")[e]=[])).push({listener:t}),this}off(e,t){const n=vee(this,hee,"f")[e];if(!n)return this;const i=n.findIndex((e=>e.listener===t));return i>=0&&n.splice(i,1),this}once(e,t){return(vee(this,hee,"f")[e]||(vee(this,hee,"f")[e]=[])).push({listener:t,once:!0}),this}emitted(e){return new Promise(((t,n)=>{gee(this,fee,!0,"f"),"error"!==e&&this.once("error",n),this.once(e,t)}))}async done(){gee(this,fee,!0,"f"),await vee(this,oee,"f")}_emit(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];if(vee(this,uee,"f"))return;"end"===e&&(gee(this,uee,!0,"f"),vee(this,lee,"f").call(this));const r=vee(this,hee,"f")[e];if(r&&(vee(this,hee,"f")[e]=r.filter((e=>!e.once)),r.forEach((e=>{let{listener:t}=e;return t(...n)}))),"abort"===e){const e=n[0];return vee(this,fee,"f")||null!==r&&void 0!==r&&r.length||Promise.reject(e),vee(this,aee,"f").call(this,e),vee(this,cee,"f").call(this,e),void this._emit("end")}if("error"===e){const e=n[0];vee(this,fee,"f")||null!==r&&void 0!==r&&r.length||Promise.reject(e),vee(this,aee,"f").call(this,e),vee(this,cee,"f").call(this,e),this._emit("end")}}_emitFinal(){}}function bee(e){return"auto-parseable-response-format"===(null===e||void 0===e?void 0:e.$brand)}function xee(e){return"auto-parseable-tool"===(null===e||void 0===e?void 0:e.$brand)}function wee(e,t){const n=e.choices.map((e=>{var n,i;if("length"===e.finish_reason)throw new P9;if("content_filter"===e.finish_reason)throw new D9;return o(o({},e),{},{message:o(o({},e.message),{},{tool_calls:null!==(n=null===(i=e.message.tool_calls)||void 0===i?void 0:i.map((e=>function(e,t){var n;const i=null===(n=e.tools)||void 0===n?void 0:n.find((e=>{var n;return(null===(n=e.function)||void 0===n?void 0:n.name)===t.function.name}));return o(o({},t),{},{function:o(o({},t.function),{},{parsed_arguments:xee(i)?i.$parseRaw(t.function.arguments):null!==i&&void 0!==i&&i.function.strict?JSON.parse(t.function.arguments):null})})}(t,e))))&&void 0!==n?n:[],parsed:e.message.content&&!e.message.refusal?See(t,e.message.content):null})})}));return o(o({},e),{},{choices:n})}function See(e,t){var n,i;if("json_schema"!==(null===(n=e.response_format)||void 0===n?void 0:n.type))return null;if("json_schema"===(null===(i=e.response_format)||void 0===i?void 0:i.type)){if("$parseRaw"in e.response_format){return e.response_format.$parseRaw(t)}return JSON.parse(t)}return null}function _ee(e,t){var n;if(!e)return!1;const i=null===(n=e.tools)||void 0===n?void 0:n.find((e=>{var n;return(null===(n=e.function)||void 0===n?void 0:n.name)===t.function.name}));return xee(i)||(null===i||void 0===i?void 0:i.function.strict)||!1}function Eee(e){var t,n;return!!bee(e.response_format)||null!==(t=null===(n=e.tools)||void 0===n?void 0:n.some((e=>xee(e)||"function"===e.type&&!0===e.function.strict)))&&void 0!==t&&t}ree=new WeakMap,see=new WeakMap,aee=new WeakMap,oee=new WeakMap,lee=new WeakMap,cee=new WeakMap,hee=new WeakMap,uee=new WeakMap,dee=new WeakMap,pee=new WeakMap,fee=new WeakMap,iee=new WeakSet,mee=function(e){if(gee(this,dee,!0,"f"),e instanceof Error&&"AbortError"===e.name&&(e=new y9),e instanceof y9)return gee(this,pee,!0,"f"),this._emit("abort",e);if(e instanceof g9)return this._emit("error",e);if(e instanceof Error){const t=new g9(e.message);return t.cause=e,this._emit("error",t)}return this._emit("error",new g9(String(e)))};const Aee=["function_call","stream"],Cee=["tool_choice","stream"],Mee=["function_call"];var Tee,Pee,Dee,Oee,Iee,Ree,kee,Lee,Bee=function(e,t,n,i){if("a"===n&&!i)throw new TypeError("Private accessor was defined without a getter");if("function"===typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?i:"a"===n?i.call(e):i?i.value:t.get(e)};const zee=10;class Nee extends yee{constructor(){super(...arguments),Tee.add(this),this._chatCompletions=[],this.messages=[]}_addChatCompletion(e){var t;this._chatCompletions.push(e),this._emit("chatCompletion",e);const n=null===(t=e.choices[0])||void 0===t?void 0:t.message;return n&&this._addMessage(n),e}_addMessage(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if("content"in e||(e.content=null),this.messages.push(e),t)if(this._emit("message",e),(tee(e)||nee(e))&&e.content)this._emit("functionCallResult",e.content);else if(eee(e)&&e.function_call)this._emit("functionCall",e.function_call);else if(eee(e)&&e.tool_calls)for(const n of e.tool_calls)"function"===n.type&&this._emit("functionCall",n.function)}async finalChatCompletion(){await this.done();const e=this._chatCompletions[this._chatCompletions.length-1];if(!e)throw new g9("stream ended without producing a ChatCompletion");return e}async finalContent(){return await this.done(),Bee(this,Tee,"m",Pee).call(this)}async finalMessage(){return await this.done(),Bee(this,Tee,"m",Dee).call(this)}async finalFunctionCall(){return await this.done(),Bee(this,Tee,"m",Oee).call(this)}async finalFunctionCallResult(){return await this.done(),Bee(this,Tee,"m",Iee).call(this)}async totalUsage(){return await this.done(),Bee(this,Tee,"m",Ree).call(this)}allChatCompletions(){return[...this._chatCompletions]}_emitFinal(){const e=this._chatCompletions[this._chatCompletions.length-1];e&&this._emit("finalChatCompletion",e);const t=Bee(this,Tee,"m",Dee).call(this);t&&this._emit("finalMessage",t);const n=Bee(this,Tee,"m",Pee).call(this);n&&this._emit("finalContent",n);const i=Bee(this,Tee,"m",Oee).call(this);i&&this._emit("finalFunctionCall",i);const r=Bee(this,Tee,"m",Iee).call(this);null!=r&&this._emit("finalFunctionCallResult",r),this._chatCompletions.some((e=>e.usage))&&this._emit("totalUsage",Bee(this,Tee,"m",Ree).call(this))}async _createChatCompletion(e,t,n){const i=null===n||void 0===n?void 0:n.signal;i&&(i.aborted&&this.controller.abort(),i.addEventListener("abort",(()=>this.controller.abort()))),Bee(this,Tee,"m",kee).call(this,t);const r=await e.chat.completions.create(o(o({},t),{},{stream:!1}),o(o({},n),{},{signal:this.controller.signal}));return this._connected(),this._addChatCompletion(wee(r,t))}async _runChatCompletion(e,t,n){for(const i of t.messages)this._addMessage(i,!1);return await this._createChatCompletion(e,t,n)}async _runFunctions(e,t,n){const i="function",{function_call:r="auto",stream:s}=t,a=l(t,Aee),c="string"!==typeof r&&(null===r||void 0===r?void 0:r.name),{maxChatCompletions:h=zee}=n||{},u={};for(const o of t.functions)u[o.name||o.function.name]=o;const d=t.functions.map((e=>({name:e.name||e.function.name,parameters:e.parameters,description:e.description})));for(const o of t.messages)this._addMessage(o,!1);for(let l=0;l<h;++l){var p;const t=null===(p=(await this._createChatCompletion(e,o(o({},a),{},{function_call:r,functions:d,messages:[...this.messages]}),n)).choices[0])||void 0===p?void 0:p.message;if(!t)throw new g9("missing message in ChatCompletion response");if(!t.function_call)return;const{name:s,arguments:l}=t.function_call,h=u[s];if(!h){const e="Invalid function_call: ".concat(JSON.stringify(s),". Available options are: ").concat(d.map((e=>JSON.stringify(e.name))).join(", "),". Please try again");this._addMessage({role:i,name:s,content:e});continue}if(c&&c!==s){const e="Invalid function_call: ".concat(JSON.stringify(s),". ").concat(JSON.stringify(c)," requested. Please try again");this._addMessage({role:i,name:s,content:e});continue}let m;try{m=$7(h)?await h.parse(l):l}catch(f){this._addMessage({role:i,name:s,content:f instanceof Error?f.message:String(f)});continue}const g=await h.function(m,this),v=Bee(this,Tee,"m",Lee).call(this,g);if(this._addMessage({role:i,name:s,content:v}),c)return}}async _runTools(e,t,n){var i;const r="tool",{tool_choice:s="auto",stream:a}=t,c=l(t,Cee),h="string"!==typeof s&&(null===s||void 0===s||null===(i=s.function)||void 0===i?void 0:i.name),{maxChatCompletions:u=zee}=n||{},d=t.tools.map((e=>{if(xee(e)){if(!e.$callback)throw new g9("Tool given to `.runTools()` that does not have an associated function");return{type:"function",function:{function:e.$callback,name:e.function.name,description:e.function.description||"",parameters:e.function.parameters,parse:e.$parseRaw,strict:!0}}}return e})),p={};for(const o of d)"function"===o.type&&(p[o.function.name||o.function.function.name]=o.function);const f="tools"in t?d.map((e=>"function"===e.type?{type:"function",function:{name:e.function.name||e.function.function.name,parameters:e.function.parameters,description:e.function.description,strict:e.function.strict}}:e)):void 0;for(const o of t.messages)this._addMessage(o,!1);for(let l=0;l<u;++l){var m,g;const t=null===(m=(await this._createChatCompletion(e,o(o({},c),{},{tool_choice:s,tools:f,messages:[...this.messages]}),n)).choices[0])||void 0===m?void 0:m.message;if(!t)throw new g9("missing message in ChatCompletion response");if(null===(g=t.tool_calls)||void 0===g||!g.length)return;for(const e of t.tool_calls){if("function"!==e.type)continue;const t=e.id,{name:n,arguments:i}=e.function,s=p[n];if(!s){const e="Invalid tool_call: ".concat(JSON.stringify(n),". Available options are: ").concat(Object.keys(p).map((e=>JSON.stringify(e))).join(", "),". Please try again");this._addMessage({role:r,tool_call_id:t,content:e});continue}if(h&&h!==n){const e="Invalid tool_call: ".concat(JSON.stringify(n),". ").concat(JSON.stringify(h)," requested. Please try again");this._addMessage({role:r,tool_call_id:t,content:e});continue}let a;try{a=$7(s)?await s.parse(i):i}catch(v){const e=v instanceof Error?v.message:String(v);this._addMessage({role:r,tool_call_id:t,content:e});continue}const o=await s.function(a,this),l=Bee(this,Tee,"m",Lee).call(this,o);if(this._addMessage({role:r,tool_call_id:t,content:l}),h)return}}}}Tee=new WeakSet,Pee=function(){var e;return null!==(e=Bee(this,Tee,"m",Dee).call(this).content)&&void 0!==e?e:null},Dee=function(){let e=this.messages.length;for(;e-- >0;){const i=this.messages[e];if(eee(i)){var t,n;const{function_call:e}=i,r=o(o({},l(i,Mee)),{},{content:null!==(t=i.content)&&void 0!==t?t:null,refusal:null!==(n=i.refusal)&&void 0!==n?n:null});return e&&(r.function_call=e),r}}throw new g9("stream ended without producing a ChatCompletionMessage with role=assistant")},Oee=function(){for(let n=this.messages.length-1;n>=0;n--){var e;const i=this.messages[n];if(eee(i)&&null!==i&&void 0!==i&&i.function_call)return i.function_call;var t;if(eee(i)&&null!==i&&void 0!==i&&null!==(e=i.tool_calls)&&void 0!==e&&e.length)return null===(t=i.tool_calls.at(-1))||void 0===t?void 0:t.function}},Iee=function(){for(let e=this.messages.length-1;e>=0;e--){const t=this.messages[e];if(tee(t)&&null!=t.content)return t.content;if(nee(t)&&null!=t.content&&"string"===typeof t.content&&this.messages.some((e=>{var n;return"assistant"===e.role&&(null===(n=e.tool_calls)||void 0===n?void 0:n.some((e=>"function"===e.type&&e.id===t.tool_call_id)))})))return t.content}},Ree=function(){const e={completion_tokens:0,prompt_tokens:0,total_tokens:0};for(const{usage:t}of this._chatCompletions)t&&(e.completion_tokens+=t.completion_tokens,e.prompt_tokens+=t.prompt_tokens,e.total_tokens+=t.total_tokens);return e},kee=function(e){if(null!=e.n&&e.n>1)throw new g9("ChatCompletion convenience helpers only support n=1 at this time. To use n>1, please use chat.completions.create() directly.")},Lee=function(e){return"string"===typeof e?e:void 0===e?"undefined":JSON.stringify(e)};class Fee extends Nee{static runFunctions(e,t,n){const i=new Fee,r=o(o({},n),{},{headers:o(o({},null===n||void 0===n?void 0:n.headers),{},{"X-Stainless-Helper-Method":"runFunctions"})});return i._run((()=>i._runFunctions(e,t,r))),i}static runTools(e,t,n){const i=new Fee,r=o(o({},n),{},{headers:o(o({},null===n||void 0===n?void 0:n.headers),{},{"X-Stainless-Helper-Method":"runTools"})});return i._run((()=>i._runTools(e,t,r))),i}_addMessage(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super._addMessage(e,t),eee(e)&&e.content&&this._emit("content",e.content)}}const Uee={STR:1,NUM:2,ARR:4,OBJ:8,NULL:16,BOOL:32,NAN:64,INFINITY:128,MINUS_INFINITY:256,INF:384,SPECIAL:496,ATOM:499,COLLECTION:12,ALL:511};class jee extends Error{}class Vee extends Error{}const Gee=(e,t)=>{const n=e.length;let i=0;const r=e=>{throw new jee("".concat(e," at position ").concat(i))},s=e=>{throw new Vee("".concat(e," at position ").concat(i))},a=()=>(u(),i>=n&&r("Unexpected end of input"),'"'===e[i]?o():"{"===e[i]?l():"["===e[i]?c():"null"===e.substring(i,i+4)||Uee.NULL&t&&n-i<4&&"null".startsWith(e.substring(i))?(i+=4,null):"true"===e.substring(i,i+4)||Uee.BOOL&t&&n-i<4&&"true".startsWith(e.substring(i))?(i+=4,!0):"false"===e.substring(i,i+5)||Uee.BOOL&t&&n-i<5&&"false".startsWith(e.substring(i))?(i+=5,!1):"Infinity"===e.substring(i,i+8)||Uee.INFINITY&t&&n-i<8&&"Infinity".startsWith(e.substring(i))?(i+=8,1/0):"-Infinity"===e.substring(i,i+9)||Uee.MINUS_INFINITY&t&&1<n-i&&n-i<9&&"-Infinity".startsWith(e.substring(i))?(i+=9,-1/0):"NaN"===e.substring(i,i+3)||Uee.NAN&t&&n-i<3&&"NaN".startsWith(e.substring(i))?(i+=3,NaN):h()),o=()=>{const a=i;let o=!1;for(i++;i<n&&('"'!==e[i]||o&&"\\"===e[i-1]);)o="\\"===e[i]&&!o,i++;if('"'==e.charAt(i))try{return JSON.parse(e.substring(a,++i-Number(o)))}catch(LZ){s(String(LZ))}else if(Uee.STR&t)try{return JSON.parse(e.substring(a,i-Number(o))+'"')}catch(LZ){return JSON.parse(e.substring(a,e.lastIndexOf("\\"))+'"')}r("Unterminated string literal")},l=()=>{i++,u();const s={};try{for(;"}"!==e[i];){if(u(),i>=n&&Uee.OBJ&t)return s;const r=o();u(),i++;try{const e=a();Object.defineProperty(s,r,{value:e,writable:!0,enumerable:!0,configurable:!0})}catch(LZ){if(Uee.OBJ&t)return s;throw LZ}u(),","===e[i]&&i++}}catch(LZ){if(Uee.OBJ&t)return s;r("Expected '}' at end of object")}return i++,s},c=()=>{i++;const n=[];try{for(;"]"!==e[i];)n.push(a()),u(),","===e[i]&&i++}catch(LZ){if(Uee.ARR&t)return n;r("Expected ']' at end of array")}return i++,n},h=()=>{if(0===i){"-"===e&&Uee.NUM&t&&r("Not sure what '-' is");try{return JSON.parse(e)}catch(LZ){if(Uee.NUM&t)try{return"."===e[e.length-1]?JSON.parse(e.substring(0,e.lastIndexOf("."))):JSON.parse(e.substring(0,e.lastIndexOf("e")))}catch(LZ){}s(String(LZ))}}const a=i;for("-"===e[i]&&i++;e[i]&&!",]}".includes(e[i]);)i++;i!=n||Uee.NUM&t||r("Unterminated number literal");try{return JSON.parse(e.substring(a,i))}catch(LZ){"-"===e.substring(a,i)&&Uee.NUM&t&&r("Not sure what '-' is");try{return JSON.parse(e.substring(a,e.lastIndexOf("e")))}catch(LZ){s(String(LZ))}}},u=()=>{for(;i<n&&" \n\r\t".includes(e[i]);)i++};return a()},Hee=e=>function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Uee.ALL;if("string"!==typeof e)throw new TypeError("expecting str, got ".concat(typeof e));if(!e.trim())throw new Error("".concat(e," is empty"));return Gee(e.trim(),t)}(e,Uee.ALL^Uee.NUM),Wee=["choices"],qee=["delta","finish_reason","index","logprobs"],Xee=["content","refusal"],Yee=["content","refusal","function_call","role","tool_calls"],Qee=["index","id","type","function"],Kee=["id","choices","created","model","system_fingerprint"],Zee=["message","finish_reason","index","logprobs"],Jee=["content","function_call","tool_calls"],$ee=["function","type","id"],ete=["arguments","name"];var tte,nte,ite,rte,ste,ate,ote,lte,cte,hte,ute,dte,pte=function(e,t,n,i,r){if("m"===i)throw new TypeError("Private method is not writable");if("a"===i&&!r)throw new TypeError("Private accessor was defined without a setter");if("function"===typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===i?r.call(e,n):r?r.value=n:t.set(e,n),n},fte=function(e,t,n,i){if("a"===n&&!i)throw new TypeError("Private accessor was defined without a getter");if("function"===typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?i:"a"===n?i.call(e):i?i.value:t.get(e)};class mte extends Nee{constructor(e){super(),tte.add(this),nte.set(this,void 0),ite.set(this,void 0),rte.set(this,void 0),pte(this,nte,e,"f"),pte(this,ite,[],"f")}get currentChatCompletionSnapshot(){return fte(this,rte,"f")}static fromReadableStream(e){const t=new mte(null);return t._run((()=>t._fromReadableStream(e))),t}static createChatCompletion(e,t,n){const i=new mte(t);return i._run((()=>i._runChatCompletion(e,o(o({},t),{},{stream:!0}),o(o({},n),{},{headers:o(o({},null===n||void 0===n?void 0:n.headers),{},{"X-Stainless-Helper-Method":"stream"})})))),i}async _createChatCompletion(e,t,n){var i;super._createChatCompletion;const r=null===n||void 0===n?void 0:n.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",(()=>this.controller.abort()))),fte(this,tte,"m",ste).call(this);const s=await e.chat.completions.create(o(o({},t),{},{stream:!0}),o(o({},n),{},{signal:this.controller.signal}));this._connected();var a,l=!1,c=!1;try{for(var h,u=Y8(s);l=!(h=await u.next()).done;l=!1){const e=h.value;fte(this,tte,"m",ote).call(this,e)}}catch(d){c=!0,a=d}finally{try{l&&null!=u.return&&await u.return()}finally{if(c)throw a}}if(null!==(i=s.controller.signal)&&void 0!==i&&i.aborted)throw new y9;return this._addChatCompletion(fte(this,tte,"m",hte).call(this))}async _fromReadableStream(e,t){var n;const i=null===t||void 0===t?void 0:t.signal;i&&(i.aborted&&this.controller.abort(),i.addEventListener("abort",(()=>this.controller.abort()))),fte(this,tte,"m",ste).call(this),this._connected();const r=R9.fromReadableStream(e,this.controller);let s;var a,o=!1,l=!1;try{for(var c,h=Y8(r);o=!(c=await h.next()).done;o=!1){const e=c.value;s&&s!==e.id&&this._addChatCompletion(fte(this,tte,"m",hte).call(this)),fte(this,tte,"m",ote).call(this,e),s=e.id}}catch(u){l=!0,a=u}finally{try{o&&null!=h.return&&await h.return()}finally{if(l)throw a}}if(null!==(n=r.controller.signal)&&void 0!==n&&n.aborted)throw new y9;return this._addChatCompletion(fte(this,tte,"m",hte).call(this))}[(nte=new WeakMap,ite=new WeakMap,rte=new WeakMap,tte=new WeakSet,ste=function(){this.ended||pte(this,rte,void 0,"f")},ate=function(e){let t=fte(this,ite,"f")[e.index];return t||(t={content_done:!1,refusal_done:!1,logprobs_content_done:!1,logprobs_refusal_done:!1,done_tool_calls:new Set,current_tool_call_index:null},fte(this,ite,"f")[e.index]=t,t)},ote=function(e){if(this.ended)return;const t=fte(this,tte,"m",dte).call(this,e);this._emit("chunk",e,t);for(const S of e.choices){var n,i,r,s,a,o,l,c;const e=t.choices[S.index];var h,u,d,p,f,m;if(null!=S.delta.content&&"assistant"===(null===(n=e.message)||void 0===n?void 0:n.role)&&null!==(i=e.message)&&void 0!==i&&i.content&&(this._emit("content",S.delta.content,e.message.content),this._emit("content.delta",{delta:S.delta.content,snapshot:e.message.content,parsed:e.message.parsed})),null!=S.delta.refusal&&"assistant"===(null===(r=e.message)||void 0===r?void 0:r.role)&&null!==(s=e.message)&&void 0!==s&&s.refusal&&this._emit("refusal.delta",{delta:S.delta.refusal,snapshot:e.message.refusal}),null!=(null===(a=S.logprobs)||void 0===a?void 0:a.content)&&"assistant"===(null===(o=e.message)||void 0===o?void 0:o.role))this._emit("logprobs.content.delta",{content:null===(h=S.logprobs)||void 0===h?void 0:h.content,snapshot:null!==(u=null===(d=e.logprobs)||void 0===d?void 0:d.content)&&void 0!==u?u:[]});if(null!=(null===(l=S.logprobs)||void 0===l?void 0:l.refusal)&&"assistant"===(null===(c=e.message)||void 0===c?void 0:c.role))this._emit("logprobs.refusal.delta",{refusal:null===(p=S.logprobs)||void 0===p?void 0:p.refusal,snapshot:null!==(f=null===(m=e.logprobs)||void 0===m?void 0:m.refusal)&&void 0!==f?f:[]});const _=fte(this,tte,"m",ate).call(this,e);e.finish_reason&&(fte(this,tte,"m",cte).call(this,e),null!=_.current_tool_call_index&&fte(this,tte,"m",lte).call(this,e,_.current_tool_call_index));for(const t of null!==(g=S.delta.tool_calls)&&void 0!==g?g:[]){var g;_.current_tool_call_index!==t.index&&(fte(this,tte,"m",cte).call(this,e),null!=_.current_tool_call_index&&fte(this,tte,"m",lte).call(this,e,_.current_tool_call_index)),_.current_tool_call_index=t.index}for(const t of null!==(v=S.delta.tool_calls)&&void 0!==v?v:[]){var v,y;const n=null===(y=e.message.tool_calls)||void 0===y?void 0:y[t.index];var b,x,w;if(null!==n&&void 0!==n&&n.type)if("function"===(null===n||void 0===n?void 0:n.type))this._emit("tool_calls.function.arguments.delta",{name:null===(b=n.function)||void 0===b?void 0:b.name,index:t.index,arguments:n.function.arguments,parsed_arguments:n.function.parsed_arguments,arguments_delta:null!==(x=null===(w=t.function)||void 0===w?void 0:w.arguments)&&void 0!==x?x:""});else null===n||void 0===n||n.type}}},lte=function(e,t){var n;if(fte(this,tte,"m",ate).call(this,e).done_tool_calls.has(t))return;const i=null===(n=e.message.tool_calls)||void 0===n?void 0:n[t];if(!i)throw new Error("no tool call snapshot");if(!i.type)throw new Error("tool call snapshot missing `type`");if("function"===i.type){var r;const e=null===(r=fte(this,nte,"f"))||void 0===r||null===(r=r.tools)||void 0===r?void 0:r.find((e=>"function"===e.type&&e.function.name===i.function.name));this._emit("tool_calls.function.arguments.done",{name:i.function.name,index:t,arguments:i.function.arguments,parsed_arguments:xee(e)?e.$parseRaw(i.function.arguments):null!==e&&void 0!==e&&e.function.strict?JSON.parse(i.function.arguments):null})}else i.type},cte=function(e){var t,n;const i=fte(this,tte,"m",ate).call(this,e);if(e.message.content&&!i.content_done){i.content_done=!0;const t=fte(this,tte,"m",ute).call(this);this._emit("content.done",{content:e.message.content,parsed:t?t.$parseRaw(e.message.content):null})}e.message.refusal&&!i.refusal_done&&(i.refusal_done=!0,this._emit("refusal.done",{refusal:e.message.refusal})),null!==(t=e.logprobs)&&void 0!==t&&t.content&&!i.logprobs_content_done&&(i.logprobs_content_done=!0,this._emit("logprobs.content.done",{content:e.logprobs.content})),null!==(n=e.logprobs)&&void 0!==n&&n.refusal&&!i.logprobs_refusal_done&&(i.logprobs_refusal_done=!0,this._emit("logprobs.refusal.done",{refusal:e.logprobs.refusal}))},hte=function(){if(this.ended)throw new g9("stream has ended, this shouldn't happen");const e=fte(this,rte,"f");if(!e)throw new g9("request ended without sending any chunks");return pte(this,rte,void 0,"f"),pte(this,ite,[],"f"),function(e,t){const{id:n,choices:i,created:r,model:s,system_fingerprint:a}=e,c=l(e,Kee),h=o(o({},c),{},{id:n,choices:i.map((t=>{var n;let{message:i,finish_reason:r,index:s,logprobs:a}=t,c=l(t,Zee);if(!r)throw new g9("missing finish_reason for choice ".concat(s));const{content:h=null,function_call:u,tool_calls:d}=i,p=l(i,Jee),f=i.role;if(!f)throw new g9("missing role for choice ".concat(s));if(u){var m;const{arguments:e,name:t}=u;if(null==e)throw new g9("missing function_call.arguments for choice ".concat(s));if(!t)throw new g9("missing function_call.name for choice ".concat(s));return o(o({},c),{},{message:{content:h,function_call:{arguments:e,name:t},role:f,refusal:null!==(m=i.refusal)&&void 0!==m?m:null},finish_reason:r,index:s,logprobs:a})}var g;return o(o({},c),{},d?{index:s,finish_reason:r,logprobs:a,message:o(o({},p),{},{role:f,content:h,refusal:null!==(g=i.refusal)&&void 0!==g?g:null,tool_calls:d.map(((t,n)=>{const{function:i,type:r,id:a}=t,c=l(t,$ee),h=i||{},{arguments:u,name:d}=h,p=l(h,ete);if(null==a)throw new g9("missing choices[".concat(s,"].tool_calls[").concat(n,"].id\n").concat(gte(e)));if(null==r)throw new g9("missing choices[".concat(s,"].tool_calls[").concat(n,"].type\n").concat(gte(e)));if(null==d)throw new g9("missing choices[".concat(s,"].tool_calls[").concat(n,"].function.name\n").concat(gte(e)));if(null==u)throw new g9("missing choices[".concat(s,"].tool_calls[").concat(n,"].function.arguments\n").concat(gte(e)));return o(o({},c),{},{id:a,type:r,function:o(o({},p),{},{name:d,arguments:u})})}))})}:{message:o(o({},p),{},{content:h,role:f,refusal:null!==(n=i.refusal)&&void 0!==n?n:null}),finish_reason:r,index:s,logprobs:a})})),created:r,model:s,object:"chat.completion"},a?{system_fingerprint:a}:{});return function(e,t){return t&&Eee(t)?wee(e,t):o(o({},e),{},{choices:e.choices.map((e=>{var t;return o(o({},e),{},{message:o(o({},e.message),{},{parsed:null,tool_calls:null!==(t=e.message.tool_calls)&&void 0!==t?t:[]})})}))})}(h,t)}(e,fte(this,nte,"f"))},ute=function(){var e;const t=null===(e=fte(this,nte,"f"))||void 0===e?void 0:e.response_format;return bee(t)?t:null},dte=function(e){var t,n,i,r;let s=fte(this,rte,"f");const{choices:a}=e,c=l(e,Wee);s?Object.assign(s,c):s=pte(this,rte,o(o({},c),{},{choices:[]}),"f");for(const g of e.choices){const{delta:e,finish_reason:a,index:c,logprobs:v=null}=g,y=l(g,qee);let b=s.choices[c];if(b||(b=s.choices[c]=o({finish_reason:a,index:c,message:{},logprobs:v},y)),v)if(b.logprobs){const{content:e,refusal:i}=v,r=l(v,Xee);var h,u;if(Object.assign(b.logprobs,r),e)null!==(h=(t=b.logprobs).content)&&void 0!==h||(t.content=[]),b.logprobs.content.push(...e);if(i)null!==(u=(n=b.logprobs).refusal)&&void 0!==u||(n.refusal=[]),b.logprobs.refusal.push(...i)}else b.logprobs=Object.assign({},v);if(a&&(b.finish_reason=a,fte(this,nte,"f")&&Eee(fte(this,nte,"f")))){if("length"===a)throw new P9;if("content_filter"===a)throw new D9}if(Object.assign(b,y),!e)continue;const{content:x,refusal:w,function_call:S,role:_,tool_calls:E}=e,A=l(e,Yee);var d;if(Object.assign(b.message,A),w&&(b.message.refusal=(b.message.refusal||"")+w),_&&(b.message.role=_),S)if(b.message.function_call){if(S.name&&(b.message.function_call.name=S.name),S.arguments)null!==(d=(i=b.message.function_call).arguments)&&void 0!==d||(i.arguments=""),b.message.function_call.arguments+=S.arguments}else b.message.function_call=S;if(x&&(b.message.content=(b.message.content||"")+x,!b.message.refusal&&fte(this,tte,"m",ute).call(this)&&(b.message.parsed=Hee(b.message.content))),E){b.message.tool_calls||(b.message.tool_calls=[]);for(const e of E){var p,f,m;const{index:t,id:n,type:i,function:s}=e,a=l(e,Qee),o=null!==(p=(r=b.message.tool_calls)[t])&&void 0!==p?p:r[t]={};Object.assign(o,a),n&&(o.id=n),i&&(o.type=i),s&&(null!==(f=o.function)&&void 0!==f||(o.function={name:null!==(m=s.name)&&void 0!==m?m:"",arguments:""})),null!==s&&void 0!==s&&s.name&&(o.function.name=s.name),null!==s&&void 0!==s&&s.arguments&&(o.function.arguments+=s.arguments,_ee(fte(this,nte,"f"),o)&&(o.function.parsed_arguments=Hee(o.function.arguments)))}}}return s},Symbol.asyncIterator)](){const e=[],t=[];let n=!1;return this.on("chunk",(n=>{const i=t.shift();i?i.resolve(n):e.push(n)})),this.on("end",(()=>{n=!0;for(const e of t)e.resolve(void 0);t.length=0})),this.on("abort",(e=>{n=!0;for(const n of t)n.reject(e);t.length=0})),this.on("error",(e=>{n=!0;for(const n of t)n.reject(e);t.length=0})),{next:async()=>{if(!e.length)return n?{value:void 0,done:!0}:new Promise(((e,n)=>t.push({resolve:e,reject:n}))).then((e=>e?{value:e,done:!1}:{value:void 0,done:!0}));return{value:e.shift(),done:!1}},return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new R9(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}}function gte(e){return JSON.stringify(e)}class vte extends mte{static fromReadableStream(e){const t=new vte(null);return t._run((()=>t._fromReadableStream(e))),t}static runFunctions(e,t,n){const i=new vte(null),r=o(o({},n),{},{headers:o(o({},null===n||void 0===n?void 0:n.headers),{},{"X-Stainless-Helper-Method":"runFunctions"})});return i._run((()=>i._runFunctions(e,t,r))),i}static runTools(e,t,n){const i=new vte(t),r=o(o({},n),{},{headers:o(o({},null===n||void 0===n?void 0:n.headers),{},{"X-Stainless-Helper-Method":"runTools"})});return i._run((()=>i._runTools(e,t,r))),i}}class yte extends T7{parse(e,t){return function(e){for(const t of null!==e&&void 0!==e?e:[]){if("function"!==t.type)throw new g9("Currently only `function` tool types support auto-parsing; Received `".concat(t.type,"`"));if(!0!==t.function.strict)throw new g9("The `".concat(t.function.name,"` tool is not marked with `strict: true`. Only strict function tools can be auto-parsed"))}}(e.tools),this._client.chat.completions.create(e,o(o({},t),{},{headers:o(o({},null===t||void 0===t?void 0:t.headers),{},{"X-Stainless-Helper-Method":"beta.chat.completions.parse"})}))._thenUnwrap((t=>wee(t,e)))}runFunctions(e,t){return e.stream?vte.runFunctions(this._client,e,t):Fee.runFunctions(this._client,e,t)}runTools(e,t){return e.stream?vte.runTools(this._client,e,t):Fee.runTools(this._client,e,t)}stream(e,t){return mte.createChatCompletion(this._client,e,t)}}class bte extends T7{constructor(){super(...arguments),this.completions=new yte(this._client)}}!function(e){e.Completions=yte}(bte||(bte={}));class xte extends T7{create(e,t){return this._client.post("/realtime/sessions",o(o({body:e},t),{},{headers:o({"OpenAI-Beta":"assistants=v2"},null===t||void 0===t?void 0:t.headers)}))}}class wte extends T7{constructor(){super(...arguments),this.sessions=new xte(this._client)}}wte.Sessions=xte;var Ste,_te,Ete,Ate,Cte,Mte,Tte,Pte,Dte,Ote,Ite,Rte,kte,Lte,Bte,zte,Nte,Fte,Ute,jte,Vte,Gte,Hte=function(e,t,n,i){if("a"===n&&!i)throw new TypeError("Private accessor was defined without a getter");if("function"===typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?i:"a"===n?i.call(e):i?i.value:t.get(e)},Wte=function(e,t,n,i,r){if("m"===i)throw new TypeError("Private method is not writable");if("a"===i&&!r)throw new TypeError("Private accessor was defined without a setter");if("function"===typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===i?r.call(e,n):r?r.value=n:t.set(e,n),n};class qte extends yee{constructor(){super(...arguments),Ste.add(this),_te.set(this,[]),Ete.set(this,{}),Ate.set(this,{}),Cte.set(this,void 0),Mte.set(this,void 0),Tte.set(this,void 0),Pte.set(this,void 0),Dte.set(this,void 0),Ote.set(this,void 0),Ite.set(this,void 0),Rte.set(this,void 0),kte.set(this,void 0)}[(_te=new WeakMap,Ete=new WeakMap,Ate=new WeakMap,Cte=new WeakMap,Mte=new WeakMap,Tte=new WeakMap,Pte=new WeakMap,Dte=new WeakMap,Ote=new WeakMap,Ite=new WeakMap,Rte=new WeakMap,kte=new WeakMap,Ste=new WeakSet,Symbol.asyncIterator)](){const e=[],t=[];let n=!1;return this.on("event",(n=>{const i=t.shift();i?i.resolve(n):e.push(n)})),this.on("end",(()=>{n=!0;for(const e of t)e.resolve(void 0);t.length=0})),this.on("abort",(e=>{n=!0;for(const n of t)n.reject(e);t.length=0})),this.on("error",(e=>{n=!0;for(const n of t)n.reject(e);t.length=0})),{next:async()=>{if(!e.length)return n?{value:void 0,done:!0}:new Promise(((e,n)=>t.push({resolve:e,reject:n}))).then((e=>e?{value:e,done:!1}:{value:void 0,done:!0}));return{value:e.shift(),done:!1}},return:async()=>(this.abort(),{value:void 0,done:!0})}}static fromReadableStream(e){const t=new qte;return t._run((()=>t._fromReadableStream(e))),t}async _fromReadableStream(e,t){var n;const i=null===t||void 0===t?void 0:t.signal;i&&(i.aborted&&this.controller.abort(),i.addEventListener("abort",(()=>this.controller.abort()))),this._connected();const r=R9.fromReadableStream(e,this.controller);var s,a=!1,o=!1;try{for(var l,c=Y8(r);a=!(l=await c.next()).done;a=!1){const e=l.value;Hte(this,Ste,"m",Lte).call(this,e)}}catch(h){o=!0,s=h}finally{try{a&&null!=c.return&&await c.return()}finally{if(o)throw s}}if(null!==(n=r.controller.signal)&&void 0!==n&&n.aborted)throw new y9;return this._addRun(Hte(this,Ste,"m",Bte).call(this))}toReadableStream(){return new R9(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}static createToolAssistantStream(e,t,n,i,r){const s=new qte;return s._run((()=>s._runToolAssistantStream(e,t,n,i,o(o({},r),{},{headers:o(o({},null===r||void 0===r?void 0:r.headers),{},{"X-Stainless-Helper-Method":"stream"})})))),s}async _createToolAssistantStream(e,t,n,i,r){var s;const a=null===r||void 0===r?void 0:r.signal;a&&(a.aborted&&this.controller.abort(),a.addEventListener("abort",(()=>this.controller.abort())));const l=o(o({},i),{},{stream:!0}),c=await e.submitToolOutputs(t,n,l,o(o({},r),{},{signal:this.controller.signal}));this._connected();var h,u=!1,d=!1;try{for(var p,f=Y8(c);u=!(p=await f.next()).done;u=!1){const e=p.value;Hte(this,Ste,"m",Lte).call(this,e)}}catch(m){d=!0,h=m}finally{try{u&&null!=f.return&&await f.return()}finally{if(d)throw h}}if(null!==(s=c.controller.signal)&&void 0!==s&&s.aborted)throw new y9;return this._addRun(Hte(this,Ste,"m",Bte).call(this))}static createThreadAssistantStream(e,t,n){const i=new qte;return i._run((()=>i._threadAssistantStream(e,t,o(o({},n),{},{headers:o(o({},null===n||void 0===n?void 0:n.headers),{},{"X-Stainless-Helper-Method":"stream"})})))),i}static createAssistantStream(e,t,n,i){const r=new qte;return r._run((()=>r._runAssistantStream(e,t,n,o(o({},i),{},{headers:o(o({},null===i||void 0===i?void 0:i.headers),{},{"X-Stainless-Helper-Method":"stream"})})))),r}currentEvent(){return Hte(this,Ite,"f")}currentRun(){return Hte(this,Rte,"f")}currentMessageSnapshot(){return Hte(this,Cte,"f")}currentRunStepSnapshot(){return Hte(this,kte,"f")}async finalRunSteps(){return await this.done(),Object.values(Hte(this,Ete,"f"))}async finalMessages(){return await this.done(),Object.values(Hte(this,Ate,"f"))}async finalRun(){if(await this.done(),!Hte(this,Mte,"f"))throw Error("Final run was not received.");return Hte(this,Mte,"f")}async _createThreadAssistantStream(e,t,n){var i;const r=null===n||void 0===n?void 0:n.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",(()=>this.controller.abort())));const s=o(o({},t),{},{stream:!0}),a=await e.createAndRun(s,o(o({},n),{},{signal:this.controller.signal}));this._connected();var l,c=!1,h=!1;try{for(var u,d=Y8(a);c=!(u=await d.next()).done;c=!1){const e=u.value;Hte(this,Ste,"m",Lte).call(this,e)}}catch(p){h=!0,l=p}finally{try{c&&null!=d.return&&await d.return()}finally{if(h)throw l}}if(null!==(i=a.controller.signal)&&void 0!==i&&i.aborted)throw new y9;return this._addRun(Hte(this,Ste,"m",Bte).call(this))}async _createAssistantStream(e,t,n,i){var r;const s=null===i||void 0===i?void 0:i.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",(()=>this.controller.abort())));const a=o(o({},n),{},{stream:!0}),l=await e.create(t,a,o(o({},i),{},{signal:this.controller.signal}));this._connected();var c,h=!1,u=!1;try{for(var d,p=Y8(l);h=!(d=await p.next()).done;h=!1){const e=d.value;Hte(this,Ste,"m",Lte).call(this,e)}}catch(f){u=!0,c=f}finally{try{h&&null!=p.return&&await p.return()}finally{if(u)throw c}}if(null!==(r=l.controller.signal)&&void 0!==r&&r.aborted)throw new y9;return this._addRun(Hte(this,Ste,"m",Bte).call(this))}static accumulateDelta(e,t){for(const[n,i]of Object.entries(t)){if(!e.hasOwnProperty(n)){e[n]=i;continue}let t=e[n];if(null!==t&&void 0!==t)if("index"!==n&&"type"!==n){if("string"===typeof t&&"string"===typeof i)t+=i;else if("number"===typeof t&&"number"===typeof i)t+=i;else{if(!M7(t)||!M7(i)){if(Array.isArray(t)&&Array.isArray(i)){if(t.every((e=>"string"===typeof e||"number"===typeof e))){t.push(...i);continue}for(const e of i){if(!M7(e))throw new Error("Expected array delta entry to be an object but got: ".concat(e));const n=e.index;if(null==n)throw console.error(e),new Error("Expected array delta entry to have an `index` property");if("number"!==typeof n)throw new Error("Expected array delta entry `index` property to be a number but got ".concat(n));const i=t[n];null==i?t.push(e):t[n]=this.accumulateDelta(i,e)}continue}throw Error("Unhandled record type: ".concat(n,", deltaValue: ").concat(i,", accValue: ").concat(t))}t=this.accumulateDelta(t,i)}e[n]=t}else e[n]=i;else e[n]=i}return e}_addRun(e){return e}async _threadAssistantStream(e,t,n){return await this._createThreadAssistantStream(t,e,n)}async _runAssistantStream(e,t,n,i){return await this._createAssistantStream(t,e,n,i)}async _runToolAssistantStream(e,t,n,i,r){return await this._createToolAssistantStream(n,e,t,i,r)}}Lte=function(e){if(!this.ended)switch(Wte(this,Ite,e,"f"),Hte(this,Ste,"m",Fte).call(this,e),e.event){case"thread.created":break;case"thread.run.created":case"thread.run.queued":case"thread.run.in_progress":case"thread.run.requires_action":case"thread.run.completed":case"thread.run.failed":case"thread.run.cancelling":case"thread.run.cancelled":case"thread.run.expired":Hte(this,Ste,"m",Gte).call(this,e);break;case"thread.run.step.created":case"thread.run.step.in_progress":case"thread.run.step.delta":case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":Hte(this,Ste,"m",Nte).call(this,e);break;case"thread.message.created":case"thread.message.in_progress":case"thread.message.delta":case"thread.message.completed":case"thread.message.incomplete":Hte(this,Ste,"m",zte).call(this,e);break;case"error":throw new Error("Encountered an error event in event processing - errors should be processed earlier")}},Bte=function(){if(this.ended)throw new g9("stream has ended, this shouldn't happen");if(!Hte(this,Mte,"f"))throw Error("Final run has not been received");return Hte(this,Mte,"f")},zte=function(e){const[t,n]=Hte(this,Ste,"m",jte).call(this,e,Hte(this,Cte,"f"));Wte(this,Cte,t,"f"),Hte(this,Ate,"f")[t.id]=t;for(const i of n){const e=t.content[i.index];"text"==(null===e||void 0===e?void 0:e.type)&&this._emit("textCreated",e.text)}switch(e.event){case"thread.message.created":this._emit("messageCreated",e.data);break;case"thread.message.in_progress":break;case"thread.message.delta":if(this._emit("messageDelta",e.data.delta,t),e.data.delta.content)for(const n of e.data.delta.content){if("text"==n.type&&n.text){let e=n.text,i=t.content[n.index];if(!i||"text"!=i.type)throw Error("The snapshot associated with this text delta is not text or missing");this._emit("textDelta",e,i.text)}if(n.index!=Hte(this,Tte,"f")){if(Hte(this,Pte,"f"))switch(Hte(this,Pte,"f").type){case"text":this._emit("textDone",Hte(this,Pte,"f").text,Hte(this,Cte,"f"));break;case"image_file":this._emit("imageFileDone",Hte(this,Pte,"f").image_file,Hte(this,Cte,"f"))}Wte(this,Tte,n.index,"f")}Wte(this,Pte,t.content[n.index],"f")}break;case"thread.message.completed":case"thread.message.incomplete":if(void 0!==Hte(this,Tte,"f")){const t=e.data.content[Hte(this,Tte,"f")];if(t)switch(t.type){case"image_file":this._emit("imageFileDone",t.image_file,Hte(this,Cte,"f"));break;case"text":this._emit("textDone",t.text,Hte(this,Cte,"f"))}}Hte(this,Cte,"f")&&this._emit("messageDone",e.data),Wte(this,Cte,void 0,"f")}},Nte=function(e){const t=Hte(this,Ste,"m",Ute).call(this,e);switch(Wte(this,kte,t,"f"),e.event){case"thread.run.step.created":this._emit("runStepCreated",e.data);break;case"thread.run.step.delta":const n=e.data.delta;if(n.step_details&&"tool_calls"==n.step_details.type&&n.step_details.tool_calls&&"tool_calls"==t.step_details.type)for(const e of n.step_details.tool_calls)e.index==Hte(this,Dte,"f")?this._emit("toolCallDelta",e,t.step_details.tool_calls[e.index]):(Hte(this,Ote,"f")&&this._emit("toolCallDone",Hte(this,Ote,"f")),Wte(this,Dte,e.index,"f"),Wte(this,Ote,t.step_details.tool_calls[e.index],"f"),Hte(this,Ote,"f")&&this._emit("toolCallCreated",Hte(this,Ote,"f")));this._emit("runStepDelta",e.data.delta,t);break;case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":Wte(this,kte,void 0,"f");"tool_calls"==e.data.step_details.type&&Hte(this,Ote,"f")&&(this._emit("toolCallDone",Hte(this,Ote,"f")),Wte(this,Ote,void 0,"f")),this._emit("runStepDone",e.data,t)}},Fte=function(e){Hte(this,_te,"f").push(e),this._emit("event",e)},Ute=function(e){switch(e.event){case"thread.run.step.created":return Hte(this,Ete,"f")[e.data.id]=e.data,e.data;case"thread.run.step.delta":let t=Hte(this,Ete,"f")[e.data.id];if(!t)throw Error("Received a RunStepDelta before creation of a snapshot");let n=e.data;if(n.delta){const i=qte.accumulateDelta(t,n.delta);Hte(this,Ete,"f")[e.data.id]=i}return Hte(this,Ete,"f")[e.data.id];case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":case"thread.run.step.in_progress":Hte(this,Ete,"f")[e.data.id]=e.data}if(Hte(this,Ete,"f")[e.data.id])return Hte(this,Ete,"f")[e.data.id];throw new Error("No snapshot available")},jte=function(e,t){let n=[];switch(e.event){case"thread.message.created":return[e.data,n];case"thread.message.delta":if(!t)throw Error("Received a delta with no existing snapshot (there should be one from message creation)");let i=e.data;if(i.delta.content)for(const e of i.delta.content)if(e.index in t.content){let n=t.content[e.index];t.content[e.index]=Hte(this,Ste,"m",Vte).call(this,e,n)}else t.content[e.index]=e,n.push(e);return[t,n];case"thread.message.in_progress":case"thread.message.completed":case"thread.message.incomplete":if(t)return[t,n];throw Error("Received thread message event with no existing snapshot")}throw Error("Tried to accumulate a non-message event")},Vte=function(e,t){return qte.accumulateDelta(t,e)},Gte=function(e){switch(Wte(this,Rte,e.data,"f"),e.event){case"thread.run.created":case"thread.run.queued":case"thread.run.in_progress":case"thread.run.cancelling":break;case"thread.run.requires_action":case"thread.run.cancelled":case"thread.run.failed":case"thread.run.completed":case"thread.run.expired":Wte(this,Mte,e.data,"f"),Hte(this,Ote,"f")&&(this._emit("toolCallDone",Hte(this,Ote,"f")),Wte(this,Ote,void 0,"f"))}};class Xte extends T7{create(e,t,n){return this._client.post("/threads/".concat(e,"/messages"),o(o({body:t},n),{},{headers:o({"OpenAI-Beta":"assistants=v2"},null===n||void 0===n?void 0:n.headers)}))}retrieve(e,t,n){return this._client.get("/threads/".concat(e,"/messages/").concat(t),o(o({},n),{},{headers:o({"OpenAI-Beta":"assistants=v2"},null===n||void 0===n?void 0:n.headers)}))}update(e,t,n,i){return this._client.post("/threads/".concat(e,"/messages/").concat(t),o(o({body:n},i),{},{headers:o({"OpenAI-Beta":"assistants=v2"},null===i||void 0===i?void 0:i.headers)}))}list(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0;return o7(t)?this.list(e,{},t):this._client.getAPIList("/threads/".concat(e,"/messages"),Yte,o(o({query:t},n),{},{headers:o({"OpenAI-Beta":"assistants=v2"},null===n||void 0===n?void 0:n.headers)}))}del(e,t,n){return this._client.delete("/threads/".concat(e,"/messages/").concat(t),o(o({},n),{},{headers:o({"OpenAI-Beta":"assistants=v2"},null===n||void 0===n?void 0:n.headers)}))}}class Yte extends k7{}Xte.MessagesPage=Yte;class Qte extends T7{retrieve(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},r=arguments.length>4?arguments[4]:void 0;return o7(i)?this.retrieve(e,t,n,{},i):this._client.get("/threads/".concat(e,"/runs/").concat(t,"/steps/").concat(n),o(o({query:i},r),{},{headers:o({"OpenAI-Beta":"assistants=v2"},null===r||void 0===r?void 0:r.headers)}))}list(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=arguments.length>3?arguments[3]:void 0;return o7(n)?this.list(e,t,{},n):this._client.getAPIList("/threads/".concat(e,"/runs/").concat(t,"/steps"),Kte,o(o({query:n},i),{},{headers:o({"OpenAI-Beta":"assistants=v2"},null===i||void 0===i?void 0:i.headers)}))}}class Kte extends k7{}Qte.RunStepsPage=Kte;const Zte=["include"];class Jte extends T7{constructor(){super(...arguments),this.steps=new Qte(this._client)}create(e,t,n){var i;const{include:r}=t,s=l(t,Zte);return this._client.post("/threads/".concat(e,"/runs"),o(o({query:{include:r},body:s},n),{},{headers:o({"OpenAI-Beta":"assistants=v2"},null===n||void 0===n?void 0:n.headers),stream:null!==(i=t.stream)&&void 0!==i&&i}))}retrieve(e,t,n){return this._client.get("/threads/".concat(e,"/runs/").concat(t),o(o({},n),{},{headers:o({"OpenAI-Beta":"assistants=v2"},null===n||void 0===n?void 0:n.headers)}))}update(e,t,n,i){return this._client.post("/threads/".concat(e,"/runs/").concat(t),o(o({body:n},i),{},{headers:o({"OpenAI-Beta":"assistants=v2"},null===i||void 0===i?void 0:i.headers)}))}list(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0;return o7(t)?this.list(e,{},t):this._client.getAPIList("/threads/".concat(e,"/runs"),$te,o(o({query:t},n),{},{headers:o({"OpenAI-Beta":"assistants=v2"},null===n||void 0===n?void 0:n.headers)}))}cancel(e,t,n){return this._client.post("/threads/".concat(e,"/runs/").concat(t,"/cancel"),o(o({},n),{},{headers:o({"OpenAI-Beta":"assistants=v2"},null===n||void 0===n?void 0:n.headers)}))}async createAndPoll(e,t,n){const i=await this.create(e,t,n);return await this.poll(e,i.id,n)}createAndStream(e,t,n){return qte.createAssistantStream(e,this._client.beta.threads.runs,t,n)}async poll(e,t,n){const i=o(o({},null===n||void 0===n?void 0:n.headers),{},{"X-Stainless-Poll-Helper":"true"});for(null!==n&&void 0!==n&&n.pollIntervalMs&&(i["X-Stainless-Custom-Poll-Interval"]=n.pollIntervalMs.toString());;){const{data:r,response:s}=await this.retrieve(e,t,o(o({},n),{},{headers:o(o({},null===n||void 0===n?void 0:n.headers),i)})).withResponse();switch(r.status){case"queued":case"in_progress":case"cancelling":let e=5e3;if(null!==n&&void 0!==n&&n.pollIntervalMs)e=n.pollIntervalMs;else{const t=s.headers.get("openai-poll-after-ms");if(t){const n=parseInt(t);isNaN(n)||(e=n)}}await g7(e);break;case"requires_action":case"incomplete":case"cancelled":case"completed":case"failed":case"expired":return r}}}stream(e,t,n){return qte.createAssistantStream(e,this._client.beta.threads.runs,t,n)}submitToolOutputs(e,t,n,i){var r;return this._client.post("/threads/".concat(e,"/runs/").concat(t,"/submit_tool_outputs"),o(o({body:n},i),{},{headers:o({"OpenAI-Beta":"assistants=v2"},null===i||void 0===i?void 0:i.headers),stream:null!==(r=n.stream)&&void 0!==r&&r}))}async submitToolOutputsAndPoll(e,t,n,i){const r=await this.submitToolOutputs(e,t,n,i);return await this.poll(e,r.id,i)}submitToolOutputsStream(e,t,n,i){return qte.createToolAssistantStream(e,t,this._client.beta.threads.runs,n,i)}}class $te extends k7{}Jte.RunsPage=$te,Jte.Steps=Qte,Jte.RunStepsPage=Kte;class ene extends T7{constructor(){super(...arguments),this.runs=new Jte(this._client),this.messages=new Xte(this._client)}create(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;return o7(e)?this.create({},e):this._client.post("/threads",o(o({body:e},t),{},{headers:o({"OpenAI-Beta":"assistants=v2"},null===t||void 0===t?void 0:t.headers)}))}retrieve(e,t){return this._client.get("/threads/".concat(e),o(o({},t),{},{headers:o({"OpenAI-Beta":"assistants=v2"},null===t||void 0===t?void 0:t.headers)}))}update(e,t,n){return this._client.post("/threads/".concat(e),o(o({body:t},n),{},{headers:o({"OpenAI-Beta":"assistants=v2"},null===n||void 0===n?void 0:n.headers)}))}del(e,t){return this._client.delete("/threads/".concat(e),o(o({},t),{},{headers:o({"OpenAI-Beta":"assistants=v2"},null===t||void 0===t?void 0:t.headers)}))}createAndRun(e,t){var n;return this._client.post("/threads/runs",o(o({body:e},t),{},{headers:o({"OpenAI-Beta":"assistants=v2"},null===t||void 0===t?void 0:t.headers),stream:null!==(n=e.stream)&&void 0!==n&&n}))}async createAndRunPoll(e,t){const n=await this.createAndRun(e,t);return await this.runs.poll(n.thread_id,n.id,t)}createAndRunStream(e,t){return qte.createThreadAssistantStream(e,this._client.beta.threads,t)}}ene.Runs=Jte,ene.RunsPage=$te,ene.Messages=Xte,ene.MessagesPage=Yte;class tne extends T7{create(e,t,n){return this._client.post("/vector_stores/".concat(e,"/files"),o(o({body:t},n),{},{headers:o({"OpenAI-Beta":"assistants=v2"},null===n||void 0===n?void 0:n.headers)}))}retrieve(e,t,n){return this._client.get("/vector_stores/".concat(e,"/files/").concat(t),o(o({},n),{},{headers:o({"OpenAI-Beta":"assistants=v2"},null===n||void 0===n?void 0:n.headers)}))}list(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0;return o7(t)?this.list(e,{},t):this._client.getAPIList("/vector_stores/".concat(e,"/files"),nne,o(o({query:t},n),{},{headers:o({"OpenAI-Beta":"assistants=v2"},null===n||void 0===n?void 0:n.headers)}))}del(e,t,n){return this._client.delete("/vector_stores/".concat(e,"/files/").concat(t),o(o({},n),{},{headers:o({"OpenAI-Beta":"assistants=v2"},null===n||void 0===n?void 0:n.headers)}))}async createAndPoll(e,t,n){const i=await this.create(e,t,n);return await this.poll(e,i.id,n)}async poll(e,t,n){const i=o(o({},null===n||void 0===n?void 0:n.headers),{},{"X-Stainless-Poll-Helper":"true"});for(null!==n&&void 0!==n&&n.pollIntervalMs&&(i["X-Stainless-Custom-Poll-Interval"]=n.pollIntervalMs.toString());;){const r=await this.retrieve(e,t,o(o({},n),{},{headers:i})).withResponse(),s=r.data;switch(s.status){case"in_progress":let e=5e3;if(null!==n&&void 0!==n&&n.pollIntervalMs)e=n.pollIntervalMs;else{const t=r.response.headers.get("openai-poll-after-ms");if(t){const n=parseInt(t);isNaN(n)||(e=n)}}await g7(e);break;case"failed":case"completed":return s}}}async upload(e,t,n){const i=await this._client.files.create({file:t,purpose:"assistants"},n);return this.create(e,{file_id:i.id},n)}async uploadAndPoll(e,t,n){const i=await this.upload(e,t,n);return await this.poll(e,i.id,n)}}class nne extends k7{}tne.VectorStoreFilesPage=nne;class ine extends T7{create(e,t,n){return this._client.post("/vector_stores/".concat(e,"/file_batches"),o(o({body:t},n),{},{headers:o({"OpenAI-Beta":"assistants=v2"},null===n||void 0===n?void 0:n.headers)}))}retrieve(e,t,n){return this._client.get("/vector_stores/".concat(e,"/file_batches/").concat(t),o(o({},n),{},{headers:o({"OpenAI-Beta":"assistants=v2"},null===n||void 0===n?void 0:n.headers)}))}cancel(e,t,n){return this._client.post("/vector_stores/".concat(e,"/file_batches/").concat(t,"/cancel"),o(o({},n),{},{headers:o({"OpenAI-Beta":"assistants=v2"},null===n||void 0===n?void 0:n.headers)}))}async createAndPoll(e,t,n){const i=await this.create(e,t);return await this.poll(e,i.id,n)}listFiles(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=arguments.length>3?arguments[3]:void 0;return o7(n)?this.listFiles(e,t,{},n):this._client.getAPIList("/vector_stores/".concat(e,"/file_batches/").concat(t,"/files"),nne,o(o({query:n},i),{},{headers:o({"OpenAI-Beta":"assistants=v2"},null===i||void 0===i?void 0:i.headers)}))}async poll(e,t,n){const i=o(o({},null===n||void 0===n?void 0:n.headers),{},{"X-Stainless-Poll-Helper":"true"});for(null!==n&&void 0!==n&&n.pollIntervalMs&&(i["X-Stainless-Custom-Poll-Interval"]=n.pollIntervalMs.toString());;){const{data:r,response:s}=await this.retrieve(e,t,o(o({},n),{},{headers:i})).withResponse();switch(r.status){case"in_progress":let e=5e3;if(null!==n&&void 0!==n&&n.pollIntervalMs)e=n.pollIntervalMs;else{const t=s.headers.get("openai-poll-after-ms");if(t){const n=parseInt(t);isNaN(n)||(e=n)}}await g7(e);break;case"failed":case"cancelled":case"completed":return r}}}async uploadAndPoll(e,t,n){var i;let{files:r,fileIds:s=[]}=t;if(null==r||0==r.length)throw new Error("No `files` provided to process. If you've already uploaded files you should use `.createAndPoll()` instead");const a=null!==(i=null===n||void 0===n?void 0:n.maxConcurrency)&&void 0!==i?i:5,o=Math.min(a,r.length),l=this._client,c=r.values(),h=[...s];const u=Array(o).fill(c).map((async function(e){for(let t of e){const e=await l.files.create({file:t,purpose:"assistants"},n);h.push(e.id)}}));return await(async e=>{const t=await Promise.allSettled(e),n=t.filter((e=>"rejected"===e.status));if(n.length){for(const e of n)console.error(e.reason);throw new Error("".concat(n.length," promise(s) failed - see the above errors"))}const i=[];for(const r of t)"fulfilled"===r.status&&i.push(r.value);return i})(u),await this.createAndPoll(e,{file_ids:h})}}class rne extends T7{constructor(){super(...arguments),this.files=new tne(this._client),this.fileBatches=new ine(this._client)}create(e,t){return this._client.post("/vector_stores",o(o({body:e},t),{},{headers:o({"OpenAI-Beta":"assistants=v2"},null===t||void 0===t?void 0:t.headers)}))}retrieve(e,t){return this._client.get("/vector_stores/".concat(e),o(o({},t),{},{headers:o({"OpenAI-Beta":"assistants=v2"},null===t||void 0===t?void 0:t.headers)}))}update(e,t,n){return this._client.post("/vector_stores/".concat(e),o(o({body:t},n),{},{headers:o({"OpenAI-Beta":"assistants=v2"},null===n||void 0===n?void 0:n.headers)}))}list(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;return o7(e)?this.list({},e):this._client.getAPIList("/vector_stores",sne,o(o({query:e},t),{},{headers:o({"OpenAI-Beta":"assistants=v2"},null===t||void 0===t?void 0:t.headers)}))}del(e,t){return this._client.delete("/vector_stores/".concat(e),o(o({},t),{},{headers:o({"OpenAI-Beta":"assistants=v2"},null===t||void 0===t?void 0:t.headers)}))}}class sne extends k7{}rne.VectorStoresPage=sne,rne.Files=tne,rne.VectorStoreFilesPage=nne,rne.FileBatches=ine;class ane extends T7{constructor(){super(...arguments),this.realtime=new wte(this._client),this.vectorStores=new rne(this._client),this.chat=new bte(this._client),this.assistants=new Z7(this._client),this.threads=new ene(this._client)}}ane.Realtime=wte,ane.VectorStores=rne,ane.VectorStoresPage=sne,ane.Assistants=Z7,ane.AssistantsPage=J7,ane.Threads=ene;class one extends T7{create(e,t){return this._client.post("/batches",o({body:e},t))}retrieve(e,t){return this._client.get("/batches/".concat(e),t)}list(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;return o7(e)?this.list({},e):this._client.getAPIList("/batches",lne,o({query:e},t))}cancel(e,t){return this._client.post("/batches/".concat(e,"/cancel"),t)}}class lne extends k7{}one.BatchesPage=lne;class cne extends T7{create(e,t,n){return this._client.post("/uploads/".concat(e,"/parts"),q9(o({body:t},n)))}}class hne extends T7{constructor(){super(...arguments),this.parts=new cne(this._client)}create(e,t){return this._client.post("/uploads",o({body:e},t))}cancel(e,t){return this._client.post("/uploads/".concat(e,"/cancel"),t)}complete(e,t,n){return this._client.post("/uploads/".concat(e,"/complete"),o({body:t},n))}}hne.Parts=cne;const une=["baseURL","apiKey","organization","project"];var dne;class pne extends n7{constructor(){var e,t,n;let i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{baseURL:r=b7("OPENAI_BASE_URL"),apiKey:s=b7("OPENAI_API_KEY"),organization:a=(null!==(e=b7("OPENAI_ORG_ID"))&&void 0!==e?e:null),project:c=(null!==(t=b7("OPENAI_PROJECT_ID"))&&void 0!==t?t:null)}=i,h=l(i,une);if(void 0===s)throw new g9("The OPENAI_API_KEY environment variable is missing or empty; either provide it, or instantiate the OpenAI client with an apiKey option, like new OpenAI({ apiKey: 'My API Key' }).");const u=o(o({apiKey:s,organization:a,project:c},h),{},{baseURL:r||"https://api.openai.com/v1"});if(!u.dangerouslyAllowBrowser&&"undefined"!==typeof window&&"undefined"!==typeof window.document&&"undefined"!==typeof navigator)throw new g9("It looks like you're running in a browser-like environment.\n\nThis is disabled by default, as it risks exposing your secret API credentials to attackers.\nIf you understand the risks and have appropriate mitigations in place,\nyou can set the `dangerouslyAllowBrowser` option to `true`, e.g.,\n\nnew OpenAI({ apiKey, dangerouslyAllowBrowser: true });\n\nhttps://help.openai.com/en/articles/5112595-best-practices-for-api-key-safety\n");super({baseURL:u.baseURL,timeout:null!==(n=u.timeout)&&void 0!==n?n:6e5,httpAgent:u.httpAgent,maxRetries:u.maxRetries,fetch:u.fetch}),this.completions=new P7(this),this.chat=new O7(this),this.embeddings=new I7(this),this.files=new L7(this),this.images=new z7(this),this.audio=new j7(this),this.moderations=new V7(this),this.models=new G7(this),this.fineTuning=new K7(this),this.beta=new ane(this),this.batches=new one(this),this.uploads=new hne(this),this._options=u,this.apiKey=s,this.organization=a,this.project=c}defaultQuery(){return this._options.defaultQuery}defaultHeaders(e){return o(o({},super.defaultHeaders(e)),{},{"OpenAI-Organization":this.organization,"OpenAI-Project":this.project},this._options.defaultHeaders)}authHeaders(e){return{Authorization:"Bearer ".concat(this.apiKey)}}stringifyQuery(e){return X8(e,{arrayFormat:"brackets"})}}dne=pne,pne.OpenAI=dne,pne.DEFAULT_TIMEOUT=6e5,pne.OpenAIError=g9,pne.APIError=v9,pne.APIConnectionError=b9,pne.APIConnectionTimeoutError=x9,pne.APIUserAbortError=y9,pne.NotFoundError=E9,pne.ConflictError=A9,pne.RateLimitError=M9,pne.BadRequestError=w9,pne.AuthenticationError=S9,pne.InternalServerError=T9,pne.PermissionDeniedError=_9,pne.UnprocessableEntityError=C9,pne.toFile=V9,pne.fileFromPath=l9,pne.Completions=P7,pne.Chat=O7,pne.Embeddings=I7,pne.Files=L7,pne.FileObjectsPage=B7,pne.Images=z7,pne.Audio=j7,pne.Moderations=V7,pne.Models=G7,pne.ModelsPage=H7,pne.FineTuning=K7,pne.Beta=ane,pne.Batches=one,pne.BatchesPage=lne,pne.Uploads=hne;new Set(["/completions","/chat/completions","/embeddings","/audio/transcriptions","/audio/translations","/audio/speech","/images/generations"]);const fne=pne,mne="gesture_presentation_workflow",gne={nodes:[{id:"1",type:"textNode",data:{label:"Start",content:"",type:"text"},position:{x:250,y:25}}],edges:[]};const vne=function(){const[t,n]=(0,e.useState)("edit"),[i,r]=(0,e.useState)((()=>{const e=new URLSearchParams(window.location.search).get("url");e&&fetch(e).then((e=>e.json())).then((e=>{e&&Array.isArray(e.nodes)&&Array.isArray(e.edges)?(r(e),setTimeout((()=>{window.history.replaceState({},"",window.location.pathname),window.location.reload()}),100)):alert("Invalid workflow format in the provided URL")})).catch((e=>{console.error("Error loading workflow from URL:",e),alert("Failed to load workflow from URL. Check console for details.")}));const t=localStorage.getItem(mne);if(!t)return gne;try{const e=JSON.parse(t);return e&&Array.isArray(e.nodes)&&Array.isArray(e.edges)?e:gne}catch(LZ){return console.error("Failed to parse saved workflow:",LZ),gne}}));(0,e.useEffect)((()=>{try{localStorage.setItem(mne,JSON.stringify(i))}catch(LZ){console.error("Failed to save workflow:",LZ)}}),[i]);const s=(0,e.useCallback)((e=>{r(e)}),[]);async function a(e,t){const n=await Promise.all(e.nodes.map((async e=>{if("imageNode"===e.type&&e.data.label)try{const n=await async function(e,t){try{const n=(await t.images.generate({model:"stability.stable-diffusion-3.5-large",prompt:e,n:1,size:"400x400"})).data[0].b64_json;return"data:image/png;base64,".concat(n)}catch(n){throw console.error("Error generating project image:",n),n}}(e.data.content,t);return o(o({},e),{},{data:o(o({},e.data),{},{url:n})})}catch(n){return console.error("Error generating image for node ".concat(e.id,":"),n),e}return e})));return o(o({},e),{},{nodes:n})}const[l,h]=(0,e.useState)(!1);return(0,c.jsxs)("div",{className:"App",children:[(0,c.jsxs)("header",{className:"App-header",children:[(0,c.jsxs)("button",{onClick:()=>n("edit"===t?"present":"edit"),children:["Switch to ","edit"===t?"Presentation":"Edit"," Mode"]}),"edit"===t&&(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)("button",{onClick:()=>h(!0),children:"Generate Presentation"}),(0,c.jsx)("button",{onClick:()=>{const e="data:text/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(i)),t=document.createElement("a");t.setAttribute("href",e),t.setAttribute("download","presentation_workflow.json"),document.body.appendChild(t),t.click(),t.remove()},children:"Export Workflow"}),(0,c.jsx)("button",{onClick:()=>{const e=document.createElement("input");e.type="file",e.accept=".json",e.onchange=e=>{var t;const n=null===(t=e.target.files)||void 0===t?void 0:t[0];if(n){const e=new FileReader;e.onload=e=>{try{var t;const n=null===(t=e.target)||void 0===t?void 0:t.result,i=JSON.parse(n);i&&Array.isArray(i.nodes)&&Array.isArray(i.edges)?(r(i),setTimeout((()=>window.location.reload()),100)):alert("Invalid workflow format")}catch(n){alert("Error reading file: "+n)}},e.readAsText(n)}},e.click()},children:"Import Workflow"}),(0,c.jsx)("button",{onClick:()=>{const e=prompt("Enter URL to workflow JSON file:");e&&(window.location.href="".concat(window.location.pathname,"?url=").concat(encodeURIComponent(e)))},children:"Load from URL"})]})]}),(0,c.jsx)("main",{children:"edit"===t?(0,c.jsx)(DZ,{onWorkflowUpdate:s,initialWorkflow:i}):(0,c.jsx)(D8,{workflow:i})}),l&&(0,c.jsx)(O8,{onGenerate:async e=>{const t=new fne.OpenAI({baseURL:"https://api.ai.it.cornell.edu",apiKey:{NODE_ENV:"production",PUBLIC_URL:"/SignWave",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}.REACT_APP_OPENAI_API_KEY,dangerouslyAllowBrowser:!0});try{const s=await async function(e,t){const n=(await t.chat.completions.create({model:"anthropic.claude-3.5-sonnet.v2",messages:[{role:"system",content:'\nYou are a helpful assistant that generates JSON objects representing gesture-controlled presentation workflows. The JSON object must have exactly two top-level keys: "nodes" and "edges".\n\nNodes:\n- "nodes" is an array of node objects. Each node object must include exactly the following fields:\n  \u2022 "id": a unique string identifier.\n  \u2022 "type": a string that is one of: "textNode" and "imageNode".\n  \u2022 "data": an object that must include:\n       - "label": string, the title of the slide.\n       - "content": string, a description.\n       - "type": string corresponding to the node type ("text" for textNode, "image" for imageNode).\n\n       For an imageNode include:\n             \u2022 "url": string (image URL). **Always use "https://picsum.photos/x" where x is a random number between 100 and 800.**\n             \u2022 "zoomPoint": an object with numeric "x" and "y" **Always set to 40 and 50 respectively**,\n             \u2022 "zoomInGesture": string **Always set to "Victory"**,\n             \u2022 "zoomOutGesture": string **Always set to "Closed_Fist"**,\n       For a textNode include pointer configuration:\n             \u2022 "pointerStartGesture": string **Always set to "Pointing_Up"**,\n             \u2022 "pointerStopGesture": string **Always set to "Closed_Fist"**,\n             \u2022 "pointerMode": string **Randomly choose between "laser" and "canvas"**.\n             \u2022 "pointerColor": string **Randomly choose between "#ff0072" and "#00ff72"**.\n             \u2022 "pointerSize": number **Randomly choose between 10 and 20**.\n\n\n  \u2022 "position": an object with two numeric fields "x" and "y" (keep the x values of consecutive nodes spaced out 350 apart, let y vary slightly).\n\nEdges:\n- "edges" is an array of edge objects. Each edge object must include exactly the following fields:\n  \u2022 "id": a unique string identifier.\n  \u2022 "type": the string "gesture".\n  \u2022 "source": a string (the id of the source node).\n  \u2022 "target": a string (the id of the target node).\n  \u2022 "data": an object that must include:\n         - "gesture": a string **Alternate between "Thumb_Up" and "Thumb_Down" for each pair of consecutive nodes**.\n  \u2022 "markerEnd": an object with:\n         - "type": string **Always set to "arrowclosed"**.\n  \u2022 "style": an object with:\n         - "strokeWidth": number **Always set to 2**,\n         - "stroke": string **Always set to "#ff0072"**.\n  \u2022 "animated": boolean.\n  \u2022 "label": string.\n\nExample Output:\n{\n  "nodes": [\n    {\n      "id": "1",\n      "type": "textNode",\n      "data": {\n        "label": "Example Title",\n        "content": "Example Content",\n        "type": "text",\n        "pointerMode": "laser",\n        "pointerStartGesture": "Pointing_Up",\n        "pointerStopGesture": "Closed_Fist"\n      },\n      "position": { "x": -15, "y": 45 }\n    },\n    {\n      "id": "2",\n      "type": "imageNode",\n      "data": {\n        "label": "Example Image",\n        "content": "Example description of the image",\n        "type": "image",\n        "url": "https://picsum.photos/400",\n        "pointerMode": "laser",\n        "zoomPoint": { "x": 40, "y": 50 },\n        "zoomInGesture": "Open_Palm",\n        "zoomOutGesture": "Victory",\n        "pointerStartGesture": "Pointing_Up",\n        "pointerStopGesture": "Closed_Fist"\n      },\n      "position": { "x": 330, "y": 30 }\n    },\n    {\n      "id": "3",\n      "type": "textNode",\n      "data": {\n        "label": "Example End",\n        "content": "Thank you!",\n        "type": "text",\n        "pointerMode": "laser"\n      },\n      "position": { "x": 1140, "y": 150 }\n    }\n  ],\n  "edges": [\n    {\n      "id": "1",\n      "type": "gesture",\n      "source": "1",\n      "target": "2",\n      "data": { "gesture": "Thumb_Up" },\n      "markerEnd": { "type": "arrowclosed" },\n      "style": { "strokeWidth": 2, "stroke": "#ff0072" },\n      "animated": true,\n      "label": "Thumb_Up"\n    },\n    {\n      "id": "2",\n      "type": "gesture",\n      "source": "2",\n      "target": "3",\n      "data": { "gesture": "Thumb_Down" },\n      "markerEnd": { "type": "arrowclosed" },\n      "style": { "strokeWidth": 2, "stroke": "#ff0072" },\n      "animated": true,\n      "label": "Thumb_Down"\n    }\n  ]\n}\n\nNote: Do NOT use only one type of node. Do NOT provide any additional text in your response.\n'},{role:"user",content:"Provide the JSON object and include a textNode with 'label' and 'content' related to: "+e}]})).choices[0].message.content.replace(/```(json)?/g,"").trim();return JSON.parse(n)}(e,t);if(s&&Array.isArray(s.nodes)&&Array.isArray(s.edges)){var n,i;const e=null===(n=document.querySelector("textarea"))||void 0===n||null===(i=n.closest("div"))||void 0===i?void 0:i.querySelector("p");e&&(e.textContent="Generating Images..."),await new Promise((e=>setTimeout(e,100)));const o=await a(s,t);localStorage.setItem(mne,JSON.stringify(o)),r(o)}else console.error("Generated workflow does not match expected format.")}catch(s){console.error("Error generating presentation:",s)}h(!1)},onClose:()=>h(!1)})]})},yne=e=>{e&&e instanceof Function&&n.e(453).then(n.bind(n,453)).then((t=>{let{getCLS:n,getFID:i,getFCP:r,getLCP:s,getTTFB:a}=t;n(e),i(e),r(e),s(e),a(e)}))};t.createRoot(document.getElementById("root")).render((0,c.jsx)(e.StrictMode,{children:(0,c.jsx)(E8,{children:(0,c.jsx)(vne,{})})})),yne()})()})();
//# sourceMappingURL=main.b9134e21.js.map